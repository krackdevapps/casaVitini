const casaVitini = {
    administracion: {
        reservas: {
            arranque: async () => {
                const main = document.querySelector("main")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                const directorios = granuladoURL.directorios
                const parametros = granuladoURL.parametros

                main.setAttribute("zonaCSS", "/administracion/reservas")
                const botones = document.querySelectorAll("[componente=botonAdministracion]")
                botones.forEach((boton) => {
                    boton.addEventListener("click", (boton) => {
                        boton.preventDefault()
                        const vista = boton.target.getAttribute("vista")
                        const navegacion = {
                            vista: vista,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    })
                })

                if (parametros.reserva) {
                    main.innerHTML = null
                    main.setAttribute("zonaCSS", "administracion/reservas/detallesReserva")
                    casaVitini.administracion.reservas.detallesReserva.reservaUI.ui({
                        reservaUID: parametros.reserva
                    })
                } else if (comandoInicial !== "reservas") {
                    casaVitini.ui.componentes.urlDesconocida()
                    const boton = document.createElement("a")
                    boton.classList.add(
                        "botonV1",
                        "comportamientoBoton",
                        "areaSinDecoracionPredeterminada",
                        "margin10"
                    )
                    boton.innerText = "Ir a Reservas"
                    boton.setAttribute("href", "/administracion/reservas")
                    boton.setAttribute("vista", "/administracion/reservas")
                    boton.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    main.appendChild(boton)
                }
            },
            buscador: {
                arranque: () => {
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")

                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                    const directorios = granuladoURL.directorios

                    if (Object.keys(granuladoURL.parametros).length === 0) {

                        main.setAttribute("zonaCSS", "administracion/reservas/buscador")
                        casaVitini.administracion.reservas.buscador.buscadorUI()
                    } else if (Object.keys(granuladoURL.parametros).length > 0) {

                        main.setAttribute("zonaCSS", "administracion/reservas/buscador")
                        casaVitini.administracion.reservas.buscador.buscadorUI()
                        const transaccion = {
                            zona: "administracion/reservas/buscador/listarReservas",
                            tipoConstruccionGrid: "total",
                            origen: "url",
                            instanciaUID: instanciaUID,
                            ...granuladoURL.parametros,
                        }
                        transaccion.pagina = transaccion.pagina ? Number(transaccion.pagina) : 1

                        if (transaccion.por_terminos) {
                            transaccion.tipoConsulta = "porTerminos"
                            transaccion.termino = decodeURI(transaccion.por_terminos)
                            delete transaccion.por_terminos
                            const selectorCampoBuscador = document.querySelector("[componenteCampo=buscadorPorId]")
                            selectorCampoBuscador.value = decodeURI(transaccion.termino)
                        }
                        if (transaccion.rango) {
                            transaccion.tipoConsulta = "rango"
                            transaccion.tipoCoincidencia = transaccion.rango.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                            delete transaccion.rango
                            casaVitini.administracion.reservas.buscador.seleccionarRango(transaccion.tipoCoincidencia)
                        }
                        if (transaccion.tipoConsulta) {
                            transaccion.tipoConsulta = transaccion.tipoConsulta.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                        }
                        if (transaccion.nombre_columna) {
                            transaccion.nombreColumna = transaccion.nombre_columna.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                            delete transaccion.nombre_columna
                        }
                        if (transaccion.sentido_columna) {
                            transaccion.sentidoColumna = transaccion.sentido_columna
                            delete transaccion.sentido_columna
                        }
                        if (transaccion.fecha_entrada) {
                            transaccion.fechaEntrada = transaccion.fecha_entrada
                            delete transaccion.fecha_entrada
                            const selectorContenedorFecha = document.querySelector("[calendario=entrada]")
                            selectorContenedorFecha.setAttribute("memoriaVolatil", transaccion.fechaEntrada)

                            selectorContenedorFecha.querySelector("[fechaUI=fechaInicio]").innerText = transaccion.fechaEntrada
                        }
                        if (transaccion.fecha_salida) {
                            transaccion.fechaSalida = transaccion.fecha_salida
                            delete transaccion.fecha_salida
                            const selectorContenedorFecha = document.querySelector("[calendario=salida]")
                            selectorContenedorFecha.setAttribute("memoriaVolatil", transaccion.fechaSalida)
                            selectorContenedorFecha.querySelector("[fechaUI=fechaFin]").innerText = transaccion.fechaSalida
                        }
                        casaVitini.administracion.reservas.buscador.mostrarReservasResueltas(transaccion)
                    } else {
                        casaVitini.ui.componentes.urlDesconocida()
                    }
                },
                buscadorUI: (url) => {
                    const instanciaUID_contenedorFechas = casaVitini.utilidades.codigoFechaInstancia()

                    const marcoElastico = document.createElement("div")
                    marcoElastico.classList.add("marcoElasticoRelativo")
                    marcoElastico.setAttribute("componente", "marcoElastico")
                    const espacioReservas = document.createElement("div")
                    espacioReservas.setAttribute("componente", "espacioReservas")
                    espacioReservas.classList.add("administracion_reservas_espacioReservas")
                    const contenedorBotonesGlobales = document.createElement("div")
                    contenedorBotonesGlobales.classList.add("administracion_reservas_contenedorBotonesGlobales")
                    const botonVerHoy = document.createElement("a")
                    botonVerHoy.classList.add("adminitracion_reservas_contenedorBotonesGlobales")
                    botonVerHoy.setAttribute("boton", "botonVerHoy")
                    botonVerHoy.addEventListener("click", casaVitini.administracion.reservas.buscador.verReservasHoy)
                    botonVerHoy.innerText = "Ver entradas hoy"
                    contenedorBotonesGlobales.appendChild(botonVerHoy)
                    const botonReservasPendientes = document.createElement("a")
                    botonReservasPendientes.classList.add("adminitracion_reservas_contenedorBotonesGlobales")
                    botonReservasPendientes.innerText = "Reservas pendientes de revisiÃ³n"
                    botonReservasPendientes.setAttribute("vista", "/administracion/reservas/pendientes_de_revision")
                    botonReservasPendientes.setAttribute("href", "/administracion/reservas/pendientes_de_revision")
                    botonReservasPendientes.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    contenedorBotonesGlobales.appendChild(botonReservasPendientes)
                    const botonCrearReserva = document.createElement("a")
                    botonCrearReserva.classList.add("adminitracion_reservas_contenedorBotonesGlobales")
                    botonCrearReserva.innerText = "Crear una nueva reserva"
                    botonCrearReserva.setAttribute("vista", "/administracion/reservas/nueva")
                    botonCrearReserva.setAttribute("href", "/administracion/reservas/nueva")
                    botonCrearReserva.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    contenedorBotonesGlobales.appendChild(botonCrearReserva)
                    espacioReservas.appendChild(contenedorBotonesGlobales)
                    //Debera de ser un grid de dos uno para el boton y el otro para el resto
                    let buscadorUI = document.createElement("nav")
                    buscadorUI.classList.add("navegacionZonaAdministracion")
                    buscadorUI.setAttribute("componente", "navegacionZonaAdministracion")
                    let bloqueContenedor = document.createElement("div")
                    bloqueContenedor.classList.add("reservasBloqueContenedor")
                    const buscadorPorPalaba = document.createElement("input")
                    buscadorPorPalaba.classList.add("campoBuscadorIdReservas")
                    buscadorPorPalaba.setAttribute("componenteCampo", "buscadorPorId")
                    buscadorPorPalaba.setAttribute("origenBusqueda", "porTerminos")
                    buscadorPorPalaba.setAttribute("step", "any")
                    buscadorPorPalaba.setAttribute("placeholder", "Escribe para buscar reservas")
                    buscadorPorPalaba.addEventListener("input", casaVitini.administracion.reservas.buscador.buscadorReservas)
                    espacioReservas.appendChild(buscadorPorPalaba)
                    let buscadorReservasPorFecha = document.createElement("div")
                    buscadorReservasPorFecha.classList.add("adminsitracionReservasBuscador")
                    bloqueContenedor.appendChild(buscadorReservasPorFecha)
                    let bloqueFechas = document.createElement("div")
                    bloqueFechas.classList.add("adminsitracionBloqueSelecionDias")
                    bloqueFechas.setAttribute("instanciaUID_contenedorFechas", instanciaUID_contenedorFechas)

                    buscadorReservasPorFecha.appendChild(bloqueFechas)
                    let bloqueFechaEntrada = document.createElement("div")
                    bloqueFechaEntrada.classList.add("diaEntradaNuevoAdministracion")
                    bloqueFechaEntrada.classList.add("administracionFormatoBloqueDiaNuevo")
                    bloqueFechaEntrada.setAttribute("calendario", "entrada")
                    bloqueFechaEntrada.setAttribute("paralizadorevento", "ocultadorCalendarios")
                    //bloqueFechaEntrada.addEventListener("click", casaVitini.administracion.reservas.buscador.constructorCalendario)
                    bloqueFechaEntrada.addEventListener("click", async () => {
                        await casaVitini.ui.componentes.calendario.configurarCalendario({
                            perfilMes: "calendario_entrada_perfilSimple",
                            contenedorOrigenIDV: "[calendario=entrada]",
                            instanciaUID_contenedorFechas,
                            rangoIDV: "inicioRango",
                            metodoSelectorDia: null
                        })
                    })

                    bloqueFechaEntrada.setAttribute("componenteBuscador", "compartidoID")
                    bloqueFechas.appendChild(bloqueFechaEntrada)
                    let textoFechaEntrada = document.createElement("div")
                    textoFechaEntrada.classList.add("textoDiaNuevoAdministracion")
                    textoFechaEntrada.innerText = "Fecha de entrada"
                    bloqueFechaEntrada.appendChild(textoFechaEntrada)
                    let fechaEntradaElemento = document.createElement("div")
                    fechaEntradaElemento.classList.add("fechaNuevo")
                    fechaEntradaElemento.setAttribute("fechaUI", "fechaInicio")
                    fechaEntradaElemento.innerText = "(Seleccionar)"
                    bloqueFechaEntrada.appendChild(fechaEntradaElemento)
                    let bloqueFechaSalida = document.createElement("div")
                    bloqueFechaSalida.classList.add("diaEntradaNuevoAdministracion")
                    bloqueFechaSalida.classList.add("administracionFormatoBloqueDiaNuevo")
                    bloqueFechaSalida.setAttribute("calendario", "salida")
                    bloqueFechaSalida.setAttribute("componenteBuscador", "compartidoID")
                    //bloqueFechaSalida.addEventListener("click", casaVitini.administracion.reservas.buscador.constructorCalendario)
                    bloqueFechaSalida.addEventListener("click", async () => {
                        await casaVitini.ui.componentes.calendario.configurarCalendario({
                            perfilMes: "calendario_salida_perfilSimple",
                            contenedorOrigenIDV: "[calendario=salida]",
                            instanciaUID_contenedorFechas,
                            rangoIDV: "finalRango",
                            metodoSelectorDia: null
                        })
                    })
                    bloqueFechaSalida.setAttribute("paralizadorevento", "ocultadorCalendarios")
                    bloqueFechas.appendChild(bloqueFechaSalida)
                    let textoFechaSalida = document.createElement("div")
                    textoFechaSalida.classList.add("textoDiaNuevoAdministracion")
                    textoFechaSalida.innerText = "Fecha de salida"
                    bloqueFechaSalida.appendChild(textoFechaSalida)
                    let fechaSalidaElemento = document.createElement("div")
                    fechaSalidaElemento.classList.add("fechaNuevo")
                    fechaSalidaElemento.setAttribute("fechaUI", "fechaFin")
                    fechaSalidaElemento.innerText = "(Seleccionar)"
                    bloqueFechaSalida.appendChild(fechaSalidaElemento)
                    let selectorRango = document.createElement("div")
                    selectorRango.classList.add("selectorRango")
                    let opcionRango = document.createElement("p")
                    opcionRango.classList.add("selectorRangoOpcion")
                    opcionRango.setAttribute("selectorRango", "cualquieraQueCoincida")
                    opcionRango.innerText = "Cualquiera que coincida"
                    opcionRango.addEventListener("click", () => {
                        casaVitini.administracion.reservas.buscador.seleccionarRango("cualquieraQueCoincida")
                    })
                    selectorRango.appendChild(opcionRango)
                    opcionRango = document.createElement("p")
                    opcionRango.classList.add("selectorRangoOpcion")
                    opcionRango.setAttribute("selectorRango", "soloDentroDelRango")
                    opcionRango.innerText = "Solo dentro del rango"
                    opcionRango.addEventListener("click", () => {
                        casaVitini.administracion.reservas.buscador.seleccionarRango("soloDentroDelRango")
                    })
                    selectorRango.appendChild(opcionRango)
                    opcionRango = document.createElement("p")
                    opcionRango.classList.add("selectorRangoOpcion")
                    opcionRango.setAttribute("selectorRango", "porFechaDeEntrada")
                    opcionRango.innerText = "Por fecha de entradas"
                    opcionRango.addEventListener("click", () => {
                        casaVitini.administracion.reservas.buscador.seleccionarRango("porFechaDeEntrada")
                    })
                    selectorRango.appendChild(opcionRango)
                    opcionRango = document.createElement("p")
                    opcionRango.classList.add("selectorRangoOpcion")
                    opcionRango.setAttribute("selectorRango", "porFechaDeSalida")
                    opcionRango.innerText = "Por fecha de salida"
                    opcionRango.addEventListener("click", () => {
                        casaVitini.administracion.reservas.buscador.seleccionarRango("porFechaDeSalida")
                    })
                    selectorRango.appendChild(opcionRango)
                    buscadorReservasPorFecha.appendChild(selectorRango)
                    let botonMostrarReservas = document.createElement(("div"))
                    botonMostrarReservas.classList.add("botonMostrarDisponibilidad")
                    botonMostrarReservas.setAttribute("boton", "mostrarReservas")
                    botonMostrarReservas.setAttribute("origenBusqueda", "porFecha")
                    botonMostrarReservas.addEventListener("click", casaVitini.administracion.reservas.buscador.mostrarReservasPorRango)
                    buscadorUI.appendChild(bloqueContenedor)
                    botonMostrarReservas.innerText = "Mostrar reservas"
                    buscadorReservasPorFecha.appendChild(botonMostrarReservas)
                    espacioReservas.appendChild(buscadorUI)


                    const contenedorResultados = document.createElement("div")
                    contenedorResultados.setAttribute("contenedor", "resultados")
                    contenedorResultados.classList.add(
                        "flexVertical",
                    )
                    espacioReservas.appendChild(contenedorResultados)


                    const contenedorFiltros = document.createElement("div")
                    contenedorFiltros.setAttribute("contenedor", "filtros")
                    contenedorResultados.appendChild(contenedorFiltros)


                    const contenedorEncontrados = document.createElement("div")
                    contenedorEncontrados.setAttribute("contenedor", "encontrados")
                    contenedorResultados.appendChild(contenedorEncontrados)


                    marcoElastico.appendChild(espacioReservas)
                    const seccion = document.querySelector("main")
                    seccion.appendChild(marcoElastico)
                },
                seleccionarDia: (dia) => {
                    let diaSeleccionadoComoElemento = dia.target;
                    let calendario = document.querySelector("[componente=bloqueCalendario] [componente=marcoCalendario]")
                    let calendarioIO = calendario.getAttribute("calendarioIO")
                    let diaSeleccionado = dia.target.getAttribute("dia")
                    diaSeleccionado = diaSeleccionado.padStart(2, "0")
                    diaSeleccionado = Number(diaSeleccionado)
                    let anoSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("ano")
                    anoSeleccionado = anoSeleccionado.padStart(4, "0")
                    anoSeleccionado = Number(anoSeleccionado)
                    let mesSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("mes")
                    mesSeleccionado = mesSeleccionado.padStart(2, "0")
                    mesSeleccionado = Number(mesSeleccionado)
                    const fechaSeleccionadaUI = `${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}`
                    const selectorDias = document.querySelectorAll("[calendarioIO] [dia]")
                    selectorDias.forEach((dia) => {
                        //dia.classList.remove("calendarioDiaDisponible")
                        dia.classList.remove("calendarioDiaReserva")
                        dia.classList.remove("calendarioDiaSeleccionado")
                    })
                    if (diaSeleccionadoComoElemento.getAttribute("estadoDia") === "seleccionado") {
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        if (calendarioIO === "entrada") {
                            document.querySelector("[calendario=entrada]").removeAttribute("memoriaVolatil")
                            document.querySelector("#fechaEntrada").innerText = "Seleccionar"
                        }
                        if (calendarioIO === "salida") {
                            document.querySelector("[calendario=salida]").removeAttribute("memoriaVolatil")
                            document.querySelector("#fechaSalida").innerText = "Seleccionar"
                        }
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        diaSeleccionadoComoElemento.removeAttribute("estadoDia")

                    }
                    const diasDisponibles = document.querySelectorAll("[estado=disponible]")
                    diasDisponibles.forEach(diaDisponible => {
                        diaDisponible.removeAttribute("estadoDia")
                        diaDisponible.style.background = ""
                        diaDisponible.style.color = ""
                    })
                    diaSeleccionadoComoElemento.setAttribute("estadoDia", "seleccionado")
                    diaSeleccionadoComoElemento.classList.add("calendarioDiaSeleccionado")
                    let fechaEntradaSeleccionada = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoEntrada
                    let mesSeleccionadoEntrada
                    let anoSeleccionadoEntrada
                    let datosFechaEntradaSeleccionada
                    if (fechaEntradaSeleccionada) {
                        const fechaEntradaSeleccionada_array = fechaEntradaSeleccionada.split("/")
                        diaSeleccionadoEntrada = fechaEntradaSeleccionada_array[0]
                        diaSeleccionadoEntrada = Number(diaSeleccionadoEntrada)
                        mesSeleccionadoEntrada = fechaEntradaSeleccionada_array[1]
                        mesSeleccionadoEntrada = Number(mesSeleccionadoEntrada)
                        anoSeleccionadoEntrada = fechaEntradaSeleccionada_array[2]
                        anoSeleccionadoEntrada = Number(anoSeleccionadoEntrada)
                        datosFechaEntradaSeleccionada = "existen"
                    }
                    let fechaSalidaSelecionda = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoSalida
                    let mesSeleccionadoSalida
                    let anoSeleccionadoSalida
                    let datosFechaSalidaSeleccionada
                    if (fechaSalidaSelecionda) {
                        const fechaSalidaSelecionda_array = fechaSalidaSelecionda.split("/")
                        diaSeleccionadoSalida = fechaSalidaSelecionda_array[0]
                        diaSeleccionadoSalida = Number(diaSeleccionadoSalida)
                        mesSeleccionadoSalida = fechaSalidaSelecionda_array[1]
                        mesSeleccionadoSalida = Number(mesSeleccionadoSalida)
                        anoSeleccionadoSalida = fechaSalidaSelecionda_array[2]
                        anoSeleccionadoSalida = Number(anoSeleccionadoSalida)
                        datosFechaSalidaSeleccionada = "existen"
                    }
                    if (calendarioIO === "entrada") {
                        document.querySelector("[calendario=entrada]").setAttribute("memoriaVolatil", fechaSeleccionadaUI)
                        document.querySelector("#fechaEntrada").innerText = fechaSeleccionadaUI
                        if (fechaSalidaSelecionda) {
                            if (mesSeleccionadoSalida === mesSeleccionado && anoSeleccionado === anoSeleccionadoSalida) {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado && Number(dia.getAttribute("dia")) < diaSeleccionadoSalida) {
                                        // dia.classList.remove("calendarioDiaDisponible")
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                    }
                    if (calendarioIO === "salida") {
                        document.querySelector("[calendario=salida]").setAttribute("memoriaVolatil", fechaSeleccionadaUI)
                        document.querySelector("#fechaSalida").innerText = fechaSeleccionadaUI
                        if (fechaEntradaSeleccionada) {
                            if (mesSeleccionadoEntrada === mesSeleccionado && anoSeleccionado === anoSeleccionadoEntrada) {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado && Number(dia.getAttribute("dia")) > diaSeleccionadoEntrada) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                    }
                },
                mostrarDetallesReserva: (transaccion) => {
                    transaccion.preventDefault()
                    transaccion.stopPropagation()
                    const reserva = transaccion.target.parentNode.getAttribute("reserva")
                    const vista = "/administracion/reservas/" + reserva
                    const navegacion = {
                        vista: vista,
                        tipoOrigen: "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(navegacion)
                },
                constructorGridReservas: (metadatos) => {
                    let reservas = metadatos.reservas
                    let metadatosBusqueda = { ...metadatos }
                    delete metadatosBusqueda.reservas
                    delete metadatosBusqueda.totalReservas
                    delete metadatosBusqueda.paginasTotales
                    let gridConstruido = document.querySelector("[componenteID=gridReservas]")
                    let constructorGrid = document.createElement("div")
                    constructorGrid.setAttribute("class", "administracionGridReservas")
                    constructorGrid.setAttribute("componenteID", "gridReservas")
                    constructorGrid.setAttribute("metadatosBusqueda", JSON.stringify(metadatosBusqueda))
                    let selectorTitulosColumnas = document.querySelectorAll("[componenteGrid=celdaTituloColumna]")
                    selectorTitulosColumnas.forEach((celdaTituloColumna) => {
                        celdaTituloColumna.style.removeProperty("background")
                        celdaTituloColumna.querySelector("[sentidoIconos]")?.remove()
                    })
                    let icononombreColumna
                    let descripcionnombreColumna
                    if (metadatos.sentidoColumna === "ascendente") {
                        icononombreColumna = "/componentes/iconos/ascendente.svg"
                        descripcionnombreColumna = "Ordenar acendentemente esta columna"
                    }
                    if (metadatos.sentidoColumna === "descendente") {
                        icononombreColumna = "/componentes/iconos/descendente.svg"
                        descripcionnombreColumna = "Ordenar descendentemente esta columna"
                    }
                    if (metadatos.tipoConstruccionGrid === "soloLista") {
                        let columnaSeleccionada = document.querySelector(`[componenteGrid=celdaTituloColumna][nombreColumna=${metadatos.nombreColumna}]`)
                        // columnaSeleccionada.setAttribute("nombreColumna", metadatos.sentidoColumna)
                        columnaSeleccionada.style.background = "#ffffff80"
                        const iconoColumna = document.createElement("img");
                        iconoColumna.src = icononombreColumna;
                        iconoColumna.alt = descripcionnombreColumna;
                        iconoColumna.classList.add("icononombreColumna");
                        iconoColumna.setAttribute("sentidoIconos", metadatos.sentidoColumna)
                        columnaSeleccionada.appendChild(iconoColumna)
                        let metadatosBusqueda = document.querySelector("[metadatosBusqueda]").getAttribute("metadatosBusqueda")
                        metadatosBusqueda = JSON.parse(metadatosBusqueda)
                        metadatosBusqueda.nombreColumna = metadatos.nombreColumna
                        metadatosBusqueda.sentidoColumna = metadatos.sentidoColumna
                        metadatosBusqueda = JSON.stringify(metadatosBusqueda)
                        document.querySelector("[metadatosBusqueda]").setAttribute("metadatosBusqueda", metadatosBusqueda)
                    }
                    let titulosColumnas = ["Reserva", "Fecha de entrada", "Fecha de salida", "Estado de la reserva", "Estado del pago"]
                    let nombreColumnas = ["reservaUID", "fechaEntrada", "fechaSalida", "estadoReserva", "estadoPago"]
                    let classesTitulos = ["idColumna", "entradaColumna", "salidaColuma", "estadoColumna", "pagoColumna"]
                    titulosColumnas.forEach((tituloColumna, ciclo) => {
                        let columnaElemento = document.createElement("div")
                        columnaElemento.innerText = tituloColumna
                        columnaElemento.classList.add(classesTitulos[ciclo])
                        columnaElemento.classList.add("administracionReservasColumnaTitulo")
                        columnaElemento.setAttribute("nombreColumna", nombreColumnas[ciclo])
                        columnaElemento.setAttribute("componenteGrid", "celdaTituloColumna")
                        columnaElemento.addEventListener("click", casaVitini.administracion.reservas.buscador.ordenarPorColumna)
                        if (metadatos.nombreColumna === nombreColumnas[ciclo]) {
                            columnaElemento.style.background = "#ffffff80"
                            columnaElemento.setAttribute("nombreColumna", metadatos.sentidoColumna)
                            const iconoColumna = document.createElement("img");
                            iconoColumna.src = icononombreColumna;
                            iconoColumna.alt = descripcionnombreColumna;
                            iconoColumna.classList.add("icononombreColumna");
                            iconoColumna.setAttribute("sentidoIconos", metadatos.sentidoColumna)
                            columnaElemento.appendChild(iconoColumna)
                        }
                        if (metadatos.tipoConstruccionGrid === "soloLista") {
                        } else {
                            constructorGrid.appendChild(columnaElemento)
                        }
                    })
                    if (metadatos.tipoConstruccionGrid === "soloLista") {
                        let selectorFilasGrid = document.querySelectorAll("[componenteGrid=fila]")
                        selectorFilasGrid.forEach((filaGrid) => {
                            filaGrid.remove()
                        })
                    }
                    reservas.forEach((bloqueReserva) => {
                        let reserva = bloqueReserva.reserva
                        let fechaEntrada = bloqueReserva.fechaEntrada
                        let fechaSalida = bloqueReserva.fechaSalida
                        let estado = bloqueReserva.estadoReserva
                        let pago = bloqueReserva.estadoPago
                        let celdaReserva = document.createElement("div")
                        celdaReserva.setAttribute("class", "administracionCeldaEstiloCompartido")
                        celdaReserva.innerText = reserva
                        let celdaFechaEntrada = document.createElement("div")
                        celdaFechaEntrada.setAttribute("class", "administracionCeldaEstiloCompartido")
                        celdaFechaEntrada.innerText = fechaEntrada
                        let celdaFechaSalida = document.createElement("div")
                        celdaFechaSalida.setAttribute("class", "administracionCeldaEstiloCompartido")
                        celdaFechaSalida.innerText = fechaSalida
                        let celdaEstado = document.createElement("div")
                        celdaEstado.setAttribute("class", "administracionCeldaEstiloCompartido")
                        celdaEstado.innerText = estado
                        let celdaPago = document.createElement("div")
                        celdaPago.setAttribute("class", "administracionCeldaEstiloCompartido")
                        celdaPago.innerText = pago
                        let fila = document.createElement("a")
                        fila.setAttribute("class", "adminitracionReservasFila")
                        fila.setAttribute("reserva", reserva)
                        fila.setAttribute("href", "/administracion/reservas/" + reserva)
                        fila.setAttribute("componenteGrid", "fila")
                        fila.setAttribute("vista", "/administracion/reservas/" + reserva)
                        fila.addEventListener("click", casaVitini.administracion.reservas.buscador.mostrarDetallesReserva)
                        fila.appendChild(celdaReserva)
                        fila.appendChild(celdaFechaEntrada)
                        fila.appendChild(celdaFechaSalida)
                        fila.appendChild(celdaEstado)
                        fila.appendChild(celdaPago)
                        if (metadatos.tipoConstruccionGrid === "soloLista") {
                            gridConstruido.appendChild(fila)
                        } else {
                            constructorGrid.appendChild(fila)
                        }
                    })
                    if (metadatos.tipoConstruccionGrid === "soloLista") {
                    } else {
                        document.querySelector("[componenteID=gridReservas]")?.remove()
                        document.querySelector(".marcoElasticoRelativo")?.appendChild(constructorGrid)
                    }
                },
                cambiarPagina: (cambiarPagina) => {
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const gridUID = cambiarPagina.gridUID
                    const tipoBoton = cambiarPagina.componenteID
                    const gridEnlazado = document.querySelector(`[gridUID=${gridUID}]`)
                    const nombreColumna = gridEnlazado?.getAttribute("nombreColumnaSeleccionada")
                    const sentidoColumna = gridEnlazado?.getAttribute("sentidoColumna")
                    const terminoBusqueda = gridEnlazado?.getAttribute("terminoBusqueda")
                    const paginaActual = Number(gridEnlazado.getAttribute("numeroPagina"))
                    const parametros = JSON.parse(gridEnlazado.getAttribute("parametros"))
                    const paginaTipo = cambiarPagina.paginaTipo
                    const transacccion = {
                        nombreColumna: nombreColumna,
                        sentidoColumna: sentidoColumna,
                        buscar: terminoBusqueda,
                        tipoBusqueda: "rapido",
                        paginaTipo: paginaTipo,
                        instanciaUID: instanciaUID
                    }
                    if (tipoBoton === "numeroPagina") {
                        const numeroPagina = cambiarPagina.numeroPagina
                        transacccion.pagina = Number(numeroPagina)
                    }
                    if (tipoBoton === "botonAdelantePaginacion") {
                        const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                        let mueveNavegadorHaciaAdelante = "Desactivado";
                        if (Number(posicionRelativa) === 10) {
                            mueveNavegadorHaciaAdelante = "Activado"
                        }
                        transacccion.pagina = paginaActual + 1
                        transacccion.moverHaciaAdelanteNavegacion = mueveNavegadorHaciaAdelante
                        transacccion.sentidoNavegacion = "Adelante"
                    }
                    if (tipoBoton === "botonAtrasPaginacion") {
                        const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                        let mueveNavegadorHaciaAtras = "Desactivado";
                        if (Number(posicionRelativa) === 1) {
                            mueveNavegadorHaciaAtras = "Activado"
                        }
                        transacccion.pagina = paginaActual - 1
                        transacccion.mueveNavegadorHaciaAtras = mueveNavegadorHaciaAtras
                        transacccion.sentidoNavegacion = "Atras"
                    }
                    transacccion.origen = "botonNumeroPagina"
                    transacccion.tipoConstruccionGrid = "soloLista"
                    transacccion.zona = "administracion/reservas/buscador/listarReservas"
                    Object.assign(transacccion, parametros);
                    casaVitini.administracion.reservas.buscador.mostrarReservasResueltas(transacccion)
                },
                constructorCalendario: async (boton) => {
                    const botonID = boton.target.getAttribute("calendario")
                    const alturaDinamicaArriba = casaVitini.utilidades.observador.medirPorJerarquiaDom.vertical.desdeAbajoDelElemento(boton.target.closest("[calendario]")) + 20
                    const bloqueCalendario = document.querySelector("[componente=bloqueCalendario]")
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const selectorCalendario = document.querySelector("[contenedor=calendario]")
                    const fechaEntradaVolatil_Humana = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoEntrada
                    let mesSeleccionadoEntrada
                    let anoSeleccionadoEntrada
                    let datosFechaEntradaSeleccionada
                    if (fechaEntradaVolatil_Humana) {
                        const fechaEntradaAarray = fechaEntradaVolatil_Humana.split("/")
                        diaSeleccionadoEntrada = Number(fechaEntradaAarray[0])
                        mesSeleccionadoEntrada = Number(fechaEntradaAarray[1])
                        anoSeleccionadoEntrada = Number(fechaEntradaAarray[2])
                    }
                    const fechaSalidaVolatil_Humana = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoSalida
                    let mesSeleccionadoSalida
                    let anoSeleccionadoSalida
                    let datosFechaSalidaSeleccionada
                    if (fechaSalidaVolatil_Humana) {
                        const fechaSaliraArray = fechaSalidaVolatil_Humana.split("/")
                        diaSeleccionadoSalida = Number(fechaSaliraArray[0])
                        mesSeleccionadoSalida = Number(fechaSaliraArray[1])
                        anoSeleccionadoSalida = Number(fechaSaliraArray[2])
                    }
                    if (botonID === "entrada") {
                        if (selectorCalendario?.getAttribute("calendarioIO") === "salida") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                        }
                        if (selectorCalendario?.getAttribute("calendarioIO") === "entrada") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                        }
                        if (fechaEntradaVolatil_Humana) {
                            const calendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                tipoFecha: "entrada",
                                diaSeleccionado: diaSeleccionadoEntrada,
                                mes: Number(mesSeleccionadoEntrada),
                                ano: Number(anoSeleccionadoEntrada)
                            }
                            const tipoFecha = {
                                tipoFecha: "entrada",
                                almacenamientoCalendarioID: "AdministracionCalendario",
                                perfilMes: "calendario_entrada_perfilSimple",
                                calendarioIO: "entrada",
                                mensajeInfo: "Selecciona una fecha de entrada para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        } else {
                            const calendario = {
                                tipo: "actual",
                                comando: "construyeObjeto",
                                tipoFecha: "entrada",
                                //"diaSeleccionado": almacenamientoAdministracion.Entrada.Dia,
                                //"mes": almacenamientoAdministracion.Entrada.Mes,
                                //"ano": almacenamientoAdministracion.Entrada.Ano
                            }
                            const tipoFecha = {
                                tipoFecha: "entrada",
                                almacenamientoCalendarioID: "administracionCalendario",
                                perfilMes: "calendario_entrada_perfilSimple",
                                calendarioIO: "entrada",
                                mensajeInfo: "Selecciona una fecha de entrada para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        }
                    }
                    if (botonID === "salida") {
                        if (selectorCalendario?.getAttribute("calendarioIO") === "salida") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                        }
                        if (selectorCalendario?.getAttribute("calendarioIO") === "entrada") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            //
                        }
                        if (!fechaEntradaVolatil_Humana && !fechaSalidaVolatil_Humana) {
                            const calendario = {
                                tipo: "actual",
                                comando: "construyeObjeto",
                                tipoFecha: "salida",
                            }
                            const tipoFecha = {
                                tipoFecha: "salida",
                                almacenamientoCalendarioID: "administracionCalendario",
                                perfilMes: "calendario_salida_perfilSimple",
                                calendarioIO: "salida",
                                mensajeInfo: "Selecciona una fecha de salida para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        }
                        if (fechaEntradaVolatil_Humana && !fechaSalidaVolatil_Humana) {
                            const calendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                tipoFecha: "salida",
                                diaSeleccionado: diaSeleccionadoEntrada,
                                mes: Number(mesSeleccionadoEntrada),
                                ano: Number(anoSeleccionadoEntrada)
                            }
                            //let Dia_Entrada_Selecioando = Number(reservaLocal.Entrada.Dia)
                            const tipoFecha = {
                                tipoFecha: "salida",
                                almacenamientoCalendarioID: "administracionCalendario",
                                perfilMes: "calendario_salida_perfilSimple",
                                calendarioIO: "salida",
                                mensajeInfo: "Selecciona una fecha de salida para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.tiempo = "presente"
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        }
                        if (fechaSalidaVolatil_Humana) {
                            const calendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                tipoFecha: "salida",
                                diaSeleccionado: diaSeleccionadoSalida,
                                mes: Number(mesSeleccionadoSalida),
                                ano: Number(anoSeleccionadoSalida)
                            }
                            //let Dia_Entrada_Selecioando = Number(reservaLocal.Entrada.Dia)
                            const tipoFecha = {
                                tipoFecha: "salida",
                                almacenamientoCalendarioID: "administracionCalendario",
                                perfilMes: "calendario_salida_perfilSimple",
                                calendarioIO: "salida",
                                mensajeInfo: "Selecciona una fecha de salida para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        }
                    }
                },
                seleccionarRango: (rangoIDV) => {
                    let rangos = document.querySelectorAll("[selectorRango]")
                    rangos.forEach((rango) => {
                        let rangoPorCiclo = rango.getAttribute("selectorRango")
                        if (rangoPorCiclo === rangoIDV) {
                            rango.style.background = "#0800ff"
                            rango.style.color = "white"
                            rango.setAttribute("estadoSelecion", "activado")
                        } else {
                            rango.style.removeProperty("background")
                            rango.style.removeProperty("color")
                            rango.removeAttribute("estadoSelecion")
                        }
                    })
                },
                resolverReservas: async (transaccion) => {
                    try {
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            const error = respuestaServidor?.error
                            throw new Error(error)
                            //casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        respuestaServidor
                    } catch (errorCapturado) {
                        throw errorCapturado
                    }
                },
                mostrarReservasResueltas: async function (transaccion) {
                    const instanciaUID = transaccion.instanciaUID
                    delete transaccion.instanciaUID
                    const origen = transaccion.origen
                    delete transaccion.origen
                    const tipoConstruccionGrid = transaccion.tipoConstruccionGrid
                    delete transaccion.tipoConstruccionGrid
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    delete transaccion.granuladoURL
                    const consultaDeEntrada = transaccion.tipoConsulta
                    const paginaTipo = transaccion.paginaTipo
                    delete transaccion.paginaTipo
                    const selectorCuadradoFechaEntrada = document.querySelector("[calendario=entrada]")
                    const selectorFechaEntradaUI = selectorCuadradoFechaEntrada?.querySelector("[fechaUI=fechaInicio]")
                    const selectorCuadradoFechaSalida = document.querySelector("[calendario=salida]")
                    const selectorFechaSalidaUI = selectorCuadradoFechaSalida?.querySelector("[fechaUI=fechaFin]")

                    if (transaccion.parametros?.rango) {
                        if (fechaEntrada) {
                            transaccion.fechaEntrada = fechaEntrada
                            const estructurarFecha = fechaEntrada.split("/")
                            const memoriaVolatil = {
                                dia: estructurarFecha[0],
                                mes: estructurarFecha[1],
                                ano: estructurarFecha[2]
                            }
                            selectorCuadradoFechaEntrada.setAttribute("memoriaVolatil", JSON.stringify(memoriaVolatil))
                            selectorFechaEntradaUI.innerText = fechaEntrada
                        }
                        if (fechaSalida) {
                            transaccion.fechaEntrada = fechaSalida
                            const estructurarFecha = fechaSalida.split("/")
                            const memoriaVolatil = {
                                dia: estructurarFecha[0],
                                mes: estructurarFecha[1],
                                ano: estructurarFecha[2]
                            }
                            selectorCuadradoFechaSalida.setAttribute("memoriaVolatil", JSON.stringify(memoriaVolatil))
                            selectorFechaSalidaUI.innerText = fechaSalida
                        }
                        transaccion.rango = transaccion.rango ? tranformaDeGuionBajoACAmello(transaccion.rango) : ""
                        if (transaccion.rango) {
                            const selectorRango = document.querySelector(`[selectorRango=${transaccion.rango}]`)
                            selectorRango.style.background = "rgb(8, 0, 255)"
                            selectorRango.style.color = "white"
                        }
                        if (transaccion.tipoConsulta === "hoy") {
                            const selectorRango = document.querySelector(`[selectorRango=porFechaDeEntrada]`)
                            selectorRango.style.background = "rgb(8, 0, 255)"
                            selectorRango.style.color = "white"
                            selectorCuadradoFechaEntrada.setAttribute("memoriaVolatil", JSON.stringify(memoriaVolatil))
                            selectorFechaEntradaUI.innerText = fechaEntrada
                        }
                        transaccion.tipoCoincidencia = transaccion.rango
                    }
                    if (transaccion.parametros?.porTerminos) {
                        const campoBuscador = document.querySelector("[componenteCampo=buscadorPorId]")
                        campoBuscador.value = transaccion.porTerminos
                        const selectorRangos = document.querySelectorAll(`[selectorRango]`)
                        selectorRangos.forEach((selectorRango) => {
                            selectorRango.removeAttribute("style")
                        })
                        selectorCuadradoFechaEntrada.removeAttribute("memoriaVolatil")
                        selectorFechaEntradaUI.innerText = "Seleccionar"
                        selectorCuadradoFechaSalida.removeAttribute("memoriaVolatil")
                        selectorFechaSalidaUI.innerText = "Seleccionar"
                    }
                    //const resolverReservas = await casaVitini.administracion.reservas.buscador.resolverReservas(transaccion)
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                    const instanciaRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) {
                        return
                    }
                    if (!respuestaServidor) {
                        return
                    }
                    //document.querySelector("[gridUID=gridReservas]")?.remove()
                    if (respuestaServidor?.error) {
                        document.querySelector("[componente=estadoBusqueda]").innerText = respuestaServidor?.error
                        return
                    }
                    if (respuestaServidor?.totalReservas === 0) {
                        document.querySelector("[gridUID=gridReservas]")?.remove()
                        document.querySelector("[componenteID=navegacionPaginacion]")?.remove()
                        document.querySelector("[componente=estadoBusqueda]").innerText = "No se han encontrado reservas"
                        return
                    }
                    if (transaccion.tipoConsulta === "hoy") {
                        const selectorRango = document.querySelector(`[selectorRango=porFechaDeEntrada]`)
                        selectorRango.style.background = "rgb(8, 0, 255)"
                        selectorRango.style.color = "white"
                        selectorFechaEntradaUI.innerText = respuestaServidor.fechaEntrada
                    }

                    document.querySelector("[componente=estadoBusqueda]")?.remove()
                    const reservas = respuestaServidor.reservas
                    const buscar = respuestaServidor.buscar
                    const paginasTotales = respuestaServidor.paginasTotales
                    const paginaActual = respuestaServidor.pagina
                    const nombreColumna = respuestaServidor.nombreColumna
                    const sentidoColumna = respuestaServidor.sentidoColumna
                    const tipoConsulta = respuestaServidor.tipoConsulta
                    const tipoCoincidencia = respuestaServidor.tipoCoincidencia
                    const termino = respuestaServidor.termino
                    const fechaEntrada = respuestaServidor.fechaEntrada
                    const fechaSalida = respuestaServidor.fechaSalida




                    const columnasGrid = [
                        {
                            columnaUI: "Reserva",
                            columnaIDV: "reserva",
                            columnaClase: "idColumna"
                        },
                        {
                            columnaUI: "Fecha de entrada",
                            columnaIDV: "fechaEntrada",
                            columnaClase: "entradaColumna"
                        },
                        {
                            columnaUI: "Fecha de salida",
                            columnaIDV: "fechaSalida",
                            columnaClase: "salidaColuma"
                        },
                        {
                            columnaUI: "Estado de la reserva",
                            columnaIDV: "estadoReserva",
                            columnaClase: "estadoColumna"
                        },
                        {
                            columnaUI: "Titular de la reserva",
                            columnaIDV: "nombreCompleto",
                            columnaClase: "pagoColumna"
                        },
                        {
                            columnaUI: "Pasaporte del titular",
                            columnaIDV: "pasaporteTitular",
                            columnaClase: "pagoColumna"
                        },
                        {
                            columnaUI: "Correo del titular",
                            columnaIDV: "mailTitular",
                            columnaClase: "pagoColumna"
                        },
                        {
                            columnaUI: "Fecha de la reserva",
                            columnaIDV: "fechaCreacion",
                            columnaClase: "pagoColumna"
                        },
                    ]
                    const parametros = {
                        tipoConsulta: transaccion.tipoConsulta,
                        tipoCoincidencia: transaccion.tipoCoincidencia,
                        fechaEntrada: transaccion.fechaEntrada,
                        fechaSalida: transaccion.fechaSalida,
                        termino: transaccion.termino
                    }
                    if (consultaDeEntrada === "hoy") {
                        parametros.tipoConsulta = "rango"
                        parametros.tipoCoincidencia = tipoCoincidencia
                        parametros.fechaEntrada = fechaEntrada
                    }
                    const dectectorBuscador = granuladoURL.directorios[granuladoURL.directorios.length - 1].toLowerCase()
                    if (dectectorBuscador !== "buscador") {
                        granuladoURL.directoriosFusion = granuladoURL.directoriosFusion + "/buscador"
                    }
                    const parametrosFinales = {}
                    if (tipoConsulta === "porTerminos") {
                        parametrosFinales.por_terminos = encodeURIComponent(termino);
                    }
                    if (tipoConsulta === "rango") {
                        parametrosFinales.rango = tipoCoincidencia.replace(/([a-z])([A-Z])/g, "$1_$2").toLowerCase()
                        if (tipoCoincidencia === "cualquieraQueCoincida" || tipoCoincidencia === "soloDentroDelRango") {
                            parametrosFinales.fecha_entrada = fechaEntrada.replaceAll("/", "-")
                            parametrosFinales.fecha_salida = fechaSalida.replaceAll("/", "-")
                        }
                        if (tipoCoincidencia === "porFechaDeSalida") {
                            parametrosFinales.fecha_salida = fechaSalida.replaceAll("/", "-")
                        }
                        if (tipoCoincidencia === "porFechaDeEntrada") {
                            parametrosFinales.fecha_entrada = fechaEntrada.replaceAll("/", "-")
                        }
                    }
                    if (paginaActual > 1 && paginasTotales > 1) {
                        parametrosFinales.pagina = paginaActual
                    }
                    if (nombreColumna) {
                        parametrosFinales.pagina = paginaActual
                        parametrosFinales.nombre_columna = nombreColumna.replace(/([a-z])([A-Z])/g, "$1_$2").toLowerCase();
                        parametrosFinales.sentido_columna = sentidoColumna
                    }
                    const estructuraParametrosFinales = []
                    for (const [parametroFinal, valorFinal] of Object.entries(parametrosFinales)) {
                        const estructura = `${parametroFinal}:${valorFinal}`
                        estructuraParametrosFinales.push(estructura)
                    }
                    let parametrosURLFInal = ""
                    if (estructuraParametrosFinales.length > 0) {
                        parametrosURLFInal = "/" + estructuraParametrosFinales.join("/")
                    }
                    this.selectorFiltro.ui({
                        columnas: columnasGrid,
                        columnaSeleccioanda: nombreColumna,
                        sentidoSeleccionado: sentidoColumna,
                        destino: "[contenedor=filtros]"
                    })

                    this.constructorTarjetas({
                        tarjetas: reservas,
                        destino: "[contenedor=encontrados]"

                    })

                    const constructorURLFinal = granuladoURL.directoriosFusion + parametrosURLFInal
                    const metadatosGrid = {
                        filas: reservas,
                        sentidoColumna: sentidoColumna,
                        nombreColumna: nombreColumna,
                        tipoConstruccionGrid: tipoConstruccionGrid,
                        buscar: buscar,
                        pagina: paginaActual,
                        destino: "[contenedor=encontrados]",
                        columnasGrid: columnasGrid,
                        gridUID: "gridReservas",
                        numeroColumnas: 8,
                        metodoColumna: "casaVitini.administracion.reservas.buscador.ordenarPorColumna",
                        metodoFila: "casaVitini.administracion.reservas.buscador.resolverFila",
                        mascaraHref: {
                            urlStatica: "/administracion/reservas/reserva:",
                            parametro: "reservaUID"
                        },
                        parametros: parametros,
                        //mascaraURL: constructorURLFinal
                    }
                    casaVitini.ui.componentes.grid(metadatosGrid)



                    const metadatosPaginador = {
                        paginaActual: paginaActual,
                        paginasTotales: paginasTotales,
                        destino: "[componente=espacioReservas]",
                        metodoBoton: "casaVitini.administracion.reservas.buscador.cambiarPagina",
                        gridUID: "gridReservas",
                        granuladoURL: {
                            parametros: parametrosFinales,
                            directoriosFusion: granuladoURL.directoriosFusion
                        }
                    }
                    casaVitini.ui.componentes.paginador(metadatosPaginador)
                    transaccion.tipoConstruccionGrid = "soloLista"
                    const titulo = "Administar reservas"
                    const estado = {
                        zona: constructorURLFinal,
                        EstadoInternoZona: "estado",
                        tipoCambio: "parcial",
                        componenteExistente: "navegacionZonaAdministracion",
                        funcionPersonalizada: "casaVitini.administracion.reservas.buscador.mostrarReservasResueltas",
                        datosPaginacion: transaccion
                    }
                    if (origen === "url" || origen === "botonMostrarReservas") {
                        window.history.replaceState(estado, titulo, constructorURLFinal);
                    }
                    if ((origen === "botonNumeroPagina" && paginaTipo === "otra") || origen === "tituloColumna") {
                        window.history.pushState(estado, titulo, constructorURLFinal);
                    }
                    if (origen === "botonNumeroPagina" && paginaTipo === "actual") {
                        window.history.replaceState(estado, titulo, constructorURLFinal);
                    }
                },
                constructorTarjetas: (data) => {
                    const reservas = data.tarjetas
                    const destino = data.destino

                    const contenedorTarjetas = document.querySelector("[contenedor=tarjetas]")
                    contenedorTarjetas?.remove()

                    const contenedor = document.createElement("div")
                    contenedor.setAttribute("contenedor", "tarjetas")
                    contenedor.classList.add(
                        "flexVertical",
                        "gap6"
                    )


                    reservas.forEach(reserva => {
                        const reservaUID = reserva.reservaUID
                        const fechaEntrada = reserva.fechaEntrada
                        const fechaSalida = reserva.fechaSalida
                        const estadoReservaIDV = reserva.estadoReservaIDV
                        const nombreCompleto = reserva.nombreCompleto
                        const pasaporteTitular = reserva.pasaporteTitular
                        const mailTitular = reserva.mailTitular
                        const fechaCreacion = reserva.fechaCreacion

                        const tarjeta = document.createElement("a")
                        tarjeta.setAttribute("componente", "tarjeta")
                        tarjeta.classList.add(
                            "flexVertical",
                            "gap6",
                            "tarjeta",
                            "borderRadius10",
                            "backgroundGrey1",
                            "padding10",
                            "areaSinDecoracionPredeterminada",
                            "ratonDefault",
                            "comportamientoBoton"
                        )
                        tarjeta.href = `/administracion/reservas/reserva:${reservaUID}`
                        tarjeta.setAttribute("vista", `/administracion/reservas/reserva:${reservaUID}`)
                        tarjeta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        contenedor.appendChild(tarjeta)



                        const contenedorReservaUD = document.createElement("div")
                        contenedorReservaUD.classList.add(
                            "flexVertical"
                        )
                        tarjeta.appendChild(contenedorReservaUD)

                        const tituloReservaUID = document.createElement("div")
                        tituloReservaUID.innerHTML = "Reserva UID"
                        contenedorReservaUD.appendChild(tituloReservaUID)

                        const dataReservaUID = document.createElement("div")
                        dataReservaUID.classList.add(
                            "negrita",
                            "textoElipsis"
                        )
                        dataReservaUID.innerText = reservaUID
                        contenedorReservaUD.appendChild(dataReservaUID)

                        const contenedorGlobal = document.createElement("div")
                        contenedorGlobal.classList.add(
                            "flexVertical",
                            "gap6",
                            "contenedorGlobal"
                        )
                        tarjeta.appendChild(contenedorGlobal)





                        const contenedorEstado = document.createElement("div")
                        contenedorEstado.classList.add(
                            "flexVertical"
                        )
                        contenedorGlobal.appendChild(contenedorEstado)

                        const tituloEstado = document.createElement("div")
                        tituloEstado.innerHTML = "Estado"
                        contenedorEstado.appendChild(tituloEstado)

                        const dataEstado = document.createElement("div")
                        dataEstado.classList.add(
                            "negrita"
                        )
                        dataEstado.innerText = estadoReservaIDV
                        contenedorEstado.appendChild(dataEstado)

                        const contenedorFechaCreacion = document.createElement("div")
                        contenedorFechaCreacion.classList.add(
                            "flexVertical"
                        )
                        contenedorGlobal.appendChild(contenedorFechaCreacion)

                        const tituloFechaCreacion = document.createElement("div")
                        tituloFechaCreacion.innerHTML = "Fecha de creaciÃ³n"
                        contenedorFechaCreacion.appendChild(tituloFechaCreacion)

                        const dataCreacion = document.createElement("div")
                        dataCreacion.classList.add(
                            "negrita"
                        )
                        dataCreacion.innerText = fechaCreacion
                        contenedorFechaCreacion.appendChild(dataCreacion)


                        const contenedorFechas = document.createElement("div")
                        contenedorFechas.classList.add(
                            "gap6",
                            "contenedorFechas",
                            "elementosExpandidos"
                        )
                        tarjeta.appendChild(contenedorFechas)

                        const contenedorFechaEntrada = document.createElement("div")
                        contenedorFechaEntrada.classList.add(
                            "flexVertical"
                        )
                        contenedorFechas.appendChild(contenedorFechaEntrada)

                        const tituloEntrada = document.createElement("div")
                        tituloEntrada.innerText = "Fecha entrada"
                        contenedorFechaEntrada.appendChild(tituloEntrada)

                        const dataEntrada = document.createElement("div")
                        dataEntrada.classList.add(
                            "negrita"
                        )
                        dataEntrada.innerText = fechaEntrada
                        contenedorFechaEntrada.appendChild(dataEntrada)

                        const contenedorFechaSalida = document.createElement("div")
                        contenedorFechaSalida.classList.add(
                            "flexVertical"
                        )
                        contenedorFechas.appendChild(contenedorFechaSalida)

                        const tituloSalida = document.createElement("div")
                        tituloSalida.innerText = "Fecha salida"
                        contenedorFechaSalida.appendChild(tituloSalida)

                        const dataSalida = document.createElement("div")
                        dataSalida.classList.add(
                            "negrita",
                            "textDerecha"
                        )
                        dataSalida.innerText = fechaSalida
                        contenedorFechaSalida.appendChild(dataSalida)



                        const contenedorTitular = document.createElement("div")
                        contenedorTitular.classList.add(
                            "flexVertical",
                        )
                        if (nombreCompleto) {
                            tarjeta.appendChild(contenedorTitular)

                        }
                        //tarjeta.appendChild(contenedorTitular)


                        const tituloTitular = document.createElement("div")
                        tituloTitular.innerText = "Titular"
                        contenedorTitular.appendChild(tituloTitular)


                        const dataNombreTitular = document.createElement("div")
                        dataNombreTitular.classList.add(
                            "negrita",
                            "textoElipsis"

                        )
                        dataNombreTitular.innerText = nombreCompleto || "(Reserva sin titular)"
                        contenedorTitular.appendChild(dataNombreTitular)


                        const dataMailTitular = document.createElement("div")
                        dataMailTitular.classList.add(
                            "textoElipsis"
                        )
                        dataMailTitular.innerText = mailTitular
                        contenedorTitular.appendChild(dataMailTitular)

                        const dataPasaporteTitular = document.createElement("div")
                        dataPasaporteTitular.classList.add(
                            "textoElipsis"
                        )
                        dataPasaporteTitular.innerText = pasaporteTitular
                        contenedorTitular.appendChild(dataPasaporteTitular)

                    })
                    document.querySelector(destino).appendChild(contenedor)
                },
                selectorFiltro: {
                    ui: function (data) {
                        const destino = data.destino
                        const columnas = data.columnas


                        const columnaSeleccioanda = data?.columnaSeleccioanda || null
                        const sentidoSeleccionado = data?.sentidoSeleccionado || null


                        const selectorFiltroOrden = document.querySelector("[contenedor=filtrosOrden]")
                        if (selectorFiltroOrden) {
                            const selectorOrdenPorColumna = selectorFiltroOrden.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = selectorFiltroOrden.querySelector("[selector=sentido]")

                            if (columnaSeleccioanda) {
                                selectorOrdenPorColumna.value = columnaSeleccioanda
                            } else {
                                selectorOrdenPorColumna.selectedIndex = 0
                            }
                            if (sentidoSeleccionado) {
                                selectorSentido.value = sentidoSeleccionado
                            } else {
                                selectorSentido.selectedIndex = 0
                            }
                            return
                        }

                        const contenedorFiltrosOrden = document.createElement("div")
                        contenedorFiltrosOrden.classList.add(
                            "gap6",
                            "flexDerecha"
                        )
                        contenedorFiltrosOrden.setAttribute("contenedor", "filtrosOrden")

                        const botonReseteo = document.createElement("div")
                        botonReseteo.classList.add(
                            "selector",
                            "textoCentrado",
                            "comportamientoBoton",
                            "noSelecionable",
                            "ratonDefault"
                        )
                        botonReseteo.innerText = "Resetear filtros"
                        botonReseteo.addEventListener("click", (e) => {
                            const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                            const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = contenedor.querySelector("[selector=sentido]")
                            selectorColumna.selectedIndex = 0
                            selectorSentido.selectedIndex = 0
                            this.pasarela(e)
                        })
                        contenedorFiltrosOrden.appendChild(botonReseteo)



                        const selectorColumna = document.createElement("select")
                        selectorColumna.setAttribute("selector", "ordenPorColumna")
                        selectorColumna.addEventListener("change", this.pasarela)
                        selectorColumna.classList.add(
                            "selector",
                            "textoCentrado",
                            "comportamientoBoton"

                        )
                        contenedorFiltrosOrden.appendChild(selectorColumna)
                        const opcionPreterminada = document.createElement("option");
                        opcionPreterminada.disabled = "true"
                        opcionPreterminada.value = ""
                        opcionPreterminada.text = "Ordenar por columna";
                        if (!columnaSeleccioanda) {
                            opcionPreterminada.selected = "true"
                        }
                        selectorColumna.add(opcionPreterminada)

                        columnas.forEach((columna) => {
                            const columnaUI = columna.columnaUI
                            const columnaIDV = columna.columnaIDV
                            const opcion = document.createElement("option");
                            opcion.value = columnaIDV;
                            opcion.text = columnaUI;
                            if (columnaSeleccioanda === columnaIDV) {

                                opcion.selected = "true"
                            }
                            selectorColumna.add(opcion);
                        })

                        const selectorSentido = document.createElement("select")
                        selectorSentido.setAttribute("selector", "sentido")
                        selectorSentido.addEventListener("change", this.pasarela)

                        selectorSentido.classList.add(
                            "selector",
                            "textoCentrado",
                            "comportamientoBoton"

                        )
                        contenedorFiltrosOrden.appendChild(selectorSentido)
                        const opcionSentido = document.createElement("option");
                        opcionSentido.disabled = "true"
                        opcionSentido.value = ""
                        opcionSentido.text = "Sentido";
                        if (!sentidoSeleccionado) {
                            opcionSentido.selected = "true"
                        }
                        selectorSentido.add(opcionSentido)

                        const sentidos = [
                            {
                                sentidoUI: "Ascendente",
                                sentidoIDV: "ascendente"
                            },
                            {
                                sentidoUI: "Descendente",
                                sentidoIDV: "descendente"
                            }
                        ]

                        sentidos.forEach((sentido) => {
                            const sentidoUI = sentido.sentidoUI
                            const sentidoIDV = sentido.sentidoIDV
                            const opcion = document.createElement("option");
                            opcion.value = sentidoIDV;
                            opcion.text = sentidoUI;
                            if (sentidoSeleccionado === sentidoIDV) {

                                opcion.selected = "true"
                            }
                            selectorSentido.add(opcion);
                        })
                        document.querySelector(destino).appendChild(contenedorFiltrosOrden)
                    },
                    pasarela: (e) => {
                        const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                        const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                        const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]").value
                        const selectorSentido = contenedor.querySelector("[selector=sentido]").value
                        const ui = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        const numeroPagina = ui.querySelector("[gridUID]").getAttribute("numeroPagina")
                        let parametros = ui.querySelector("[gridUID]").getAttribute("parametros")
                        parametros = parametros ? JSON.parse(parametros) : {}
                        const transaccion = {
                            zona: "administracion/reservas/buscador/listarReservas",
                            pagina: Number(numeroPagina),
                            tipoConstruccionGrid: "soloLista",
                            origen: "tituloColumna",
                            instanciaUID: instanciaUID
                        }

                        transaccion.sentidoColumna = selectorSentido
                        transaccion.nombreColumna = selectorColumna


                        for (const [parametro, valor] of Object.entries(parametros)) {
                            transaccion[parametro] = valor
                        }
                        casaVitini.administracion.reservas.buscador.mostrarReservasResueltas(transaccion)
                    }
                },
                ordenarPorColumna: async (columna) => {
                    const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                    const nombreColumna = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("nombreColumna")
                    const selectorColumnasentido = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("sentidoColumna")
                    const numeroPagina = columna.target.closest("[gridUID]").getAttribute("numeroPagina")
                    let parametros = columna.target.closest("[gridUID]").getAttribute("parametros")
                    parametros = parametros ? JSON.parse(parametros) : {}
                    let sentidoColumna
                    const transaccion = {
                        zona: "administracion/reservas/buscador/listarReservas",
                        pagina: Number(numeroPagina),
                        tipoConstruccionGrid: "soloLista",
                        origen: "tituloColumna",
                        instanciaUID: instanciaUID
                    }

                    if (selectorColumnasentido === "ascendente") {
                        transaccion.sentidoColumna = "descendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    if (!selectorColumnasentido) {
                        transaccion.sentidoColumna = "ascendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    for (const [parametro, valor] of Object.entries(parametros)) {
                        transaccion[parametro] = valor
                    }
                    casaVitini.administracion.reservas.buscador.mostrarReservasResueltas(transaccion)
                },
                verReservasHoy: () => {
                    const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")

                    const espacioReservas = document.querySelector("[contenedor=encontrados]")
                    const buscadorUI = document.querySelector("[componente=navegacionZonaAdministracion]")
                    document.querySelector("[componente=estadoBusqueda]")?.remove()
                    document.querySelector("[gridUID=gridReservas]")?.remove()
                    document.querySelector("[componenteID=navegacionPaginacion]")?.remove()
                    document.querySelector("[contenedor=filtrosOrden]")?.remove()
                    espacioReservas.innerHTML = null
                    casaVitini.administracion.reservas.buscador.limpiarFormularioBusqueda()
                    const estadoBusquedaUI = document.createElement("div")
                    estadoBusquedaUI.classList.add("buscadorClientesEstadoBusqueda")
                    estadoBusquedaUI.setAttribute("componente", "estadoBusqueda")
                    estadoBusquedaUI.innerText = "Buscando..."
                    buscadorUI.parentNode.insertBefore(estadoBusquedaUI, buscadorUI.nextSibling);

                    const peticion = {
                        zona: "administracion/reservas/buscador/listarReservas",
                        pagina: 1,
                        tipoConsulta: "hoy",
                        tipoConstruccionGrid: "total",
                        origen: "url",
                        instanciaUID: instanciaUID,
                        rango: "porFechaEntrada"
                    }
                    casaVitini.administracion.reservas.buscador.mostrarReservasResueltas(peticion)
                },
                mostrarReservasPorRango: () => {
                    const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")

                    const fechaEntrada = document.querySelector("[calendario=entrada]")?.getAttribute("memoriaVolatil")
                    const fechaSalida = document.querySelector("[calendario=salida]")?.getAttribute("memoriaVolatil")
                    const buscadorUI = document.querySelector("[componente=navegacionZonaAdministracion]")

                    const tipoRango = document.querySelector("[estadoSelecion=activado]")?.getAttribute("selectorRango")
                    document.querySelector("[gridUID=gridReservas]")?.remove()
                    document.querySelector("[componente=estadoBusqueda]")?.remove()
                    document.querySelector("[componenteID=navegacionPaginacion]")?.remove()
                    document.querySelector("[contenedor=filtrosOrden]")?.remove()

                    const espacioReservas = document.querySelector("[contenedor=encontrados]")
                    espacioReservas.innerHTML = null

                    const estadoBusquedaUI = document.createElement("div")
                    estadoBusquedaUI.classList.add("buscadorClientesEstadoBusqueda")
                    estadoBusquedaUI.setAttribute("componente", "estadoBusqueda")
                    estadoBusquedaUI.innerText = "Buscando..."
                    buscadorUI.parentNode.insertBefore(estadoBusquedaUI, buscadorUI.nextSibling);

                    const selectorCampoBuscador = document.querySelector("[componenteCampo=buscadorPorId]")
                    selectorCampoBuscador.value = null
                    const peticion = {
                        zona: "administracion/reservas/buscador/listarReservas",
                        pagina: 1,
                        tipoConsulta: "rango",
                        tipoCoincidencia: tipoRango,
                        fechaEntrada: fechaEntrada,
                        fechaSalida: fechaSalida,
                        origen: "botonMostrarReservas",
                        tipoConstruccionGrid: "total",
                        instanciaUID: instanciaUID
                    }

                    casaVitini.administracion.reservas.buscador.mostrarReservasResueltas(peticion)
                },
                buscadorReservas: (reserva) => {
                    const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                    const espacioReservas = document.querySelector("[contenedor=encontrados]")
                    const buscadorUI = document.querySelector("[componente=navegacionZonaAdministracion]")
                    clearTimeout(casaVitini.componentes.temporizador);
                    document.querySelector("[componente=resultadosSinReservas]")?.remove()
                    document.querySelector("[gridUID=gridReservas")?.remove()
                    document.querySelector("[componenteID=navegacionPaginacion]")?.remove()
                    document.querySelector("[componente=estadoBusqueda]")?.remove()
                    document.querySelector("[contenedor=filtrosOrden]")?.remove()
                    espacioReservas.innerHTML = null

                    const estadoBusquedaUI = document.createElement("div")
                    estadoBusquedaUI.classList.add("buscadorClientesEstadoBusqueda")
                    estadoBusquedaUI.setAttribute("componente", "estadoBusqueda")
                    estadoBusquedaUI.innerText = "Buscando..."
                    buscadorUI.parentNode.insertBefore(estadoBusquedaUI, buscadorUI.nextSibling);

                    casaVitini.administracion.reservas.buscador.limpiarFormularioBusqueda()
                    const terminoBusqueda = reserva.target.value
                    if (terminoBusqueda.length === 0) {
                        clearTimeout(casaVitini.componentes.temporizador);
                        document.querySelector("[gridUID=gridReservas")?.remove()
                        document.querySelector("[componenteID=navegacionPaginacion]")?.remove()
                        document.querySelector("[componente=estadoBusqueda]")?.remove()
                        const vistaActual = document.getElementById("uiNavegacion").getAttribute("vistaActual")
                        const resetUrl = "/administracion/reservas"
                        const titulo = "casavitini"
                        const estado = {
                            zona: vistaActual,
                            estadoInternoZona: "estado",
                            tipoCambio: "total"
                        }
                        window.history.replaceState(estado, titulo, resetUrl);
                        return
                    }
                    casaVitini.componentes.temporizador = setTimeout(() => {
                        const peticion = {
                            zona: "administracion/reservas/buscador/listarReservas",
                            pagina: Number("1"),
                            tipoConsulta: "porTerminos",
                            termino: terminoBusqueda,
                            origen: "botonMostrarReservas",
                            tipoConstruccionGrid: "total",
                            instanciaUID: instanciaUID
                        }
                        casaVitini.administracion.reservas.buscador.mostrarReservasResueltas(peticion);
                    }, 1500);
                },
                limpiarFormularioBusqueda: () => {
                    const selectorCuadradoFechaEntrada = document.querySelector("[calendario=entrada]")
                    const selectorFechaEntradaUI = selectorCuadradoFechaEntrada.querySelector("[fechaUI=fechaInicio]")
                    const selectorCuadradoFechaSalida = document.querySelector("[calendario=salida]")
                    const selectorFechaSalidaUI = selectorCuadradoFechaSalida.querySelector("[fechaUI=fechaFin]")
                    selectorCuadradoFechaEntrada.removeAttribute("memoriaVolatil")
                    selectorFechaEntradaUI.innerText = "(Seleccionar)"
                    selectorCuadradoFechaSalida.removeAttribute("memoriaVolatil")
                    selectorFechaSalidaUI.innerText = "(Seleccionar)"
                    const selectorRangos = document.querySelectorAll(`[selectorRango]`)
                    selectorRangos.forEach((selectorRango) => {
                        selectorRango.removeAttribute("style")
                    })
                },
                resolverFila: (transaccion) => {
                    transaccion.preventDefault()
                    transaccion.stopPropagation()
                    const href = transaccion.target.closest("[href]").getAttribute("href")
                    const navegacion = {
                        vista: href,
                        tipoOrigen: "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(navegacion)
                },
            },
            nuevaReserva: {
                arranque: () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/reservas/nueva")
                    const instanciaUID_contenedorFechas = casaVitini.utilidades.codigoFechaInstancia()
                    const selectorRangoUI = main.querySelector("[contenedor=selectorRango]")
                    selectorRangoUI.setAttribute("instanciaUID_contenedorFechas", instanciaUID_contenedorFechas)
                    const selectorBotonEntrada = document.querySelector("[calendario=entrada]")
                    selectorBotonEntrada.addEventListener("click", async () => {
                        await casaVitini.ui.componentes.calendario.configurarCalendario({
                            perfilMes: "calendario_entrada_perfilSimple",
                            contenedorOrigenIDV: "[calendario=entrada]",
                            instanciaUID_contenedorFechas,
                            rangoIDV: "inicioRango",
                            metodoSelectorDia: null,
                            seleccionableDiaLimite: "no"
                        })
                    })

                    const selectorBotonSalida = document.querySelector("[calendario=salida]")
                    selectorBotonSalida.addEventListener("click", async () => {
                        await casaVitini.ui.componentes.calendario.configurarCalendario({
                            perfilMes: "calendario_salida_perfilSimple",
                            contenedorOrigenIDV: "[calendario=salida]",
                            instanciaUID_contenedorFechas,
                            rangoIDV: "finalRango",
                            metodoSelectorDia: null,
                            seleccionableDiaLimite: "no"
                        })
                    })

                    document.querySelector("[componente=botonBuscarAlojamiento]").addEventListener("click", casaVitini.administracion.reservas.nuevaReserva.buscarAlojamiento)
                    document.querySelector("[componente=botonConfirmarReserva]").addEventListener("click", casaVitini.administracion.reservas.nuevaReserva.confirmarReservaNueva)
                },
                constructorCalendario: async (boton) => {
                    const botonID = boton.target.closest("[calendario]").getAttribute("componente")
                    let fechaEntradaSelecionda = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    let fechaSalidaSelecionda = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const alturaDinamicaArriba = casaVitini.utilidades.observador.medirPorJerarquiaDom.vertical.desdeAbajoDelElemento(boton.target.closest("[componente]"))
                    const bloqueCalendario = document.querySelector("[componente=bloqueCalendario]")
                    const calendario = document.querySelector("[contenedor=calendario]")
                    if (botonID === "fechaEntrada") {
                        if (calendario?.getAttribute("calendarioIO") === "entrada") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                        }
                        if (calendario?.getAttribute("calendarioIO") === "salida") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            //
                        }
                        let resolucionCalendario
                        if (fechaEntradaSelecionda) {
                            const fechaEntradaSelecionda_array = fechaEntradaSelecionda.split("/")
                            let mesEntradaSeleccionado = fechaEntradaSelecionda_array[1]
                            let anoEntradaSeleccionado = fechaEntradaSelecionda_array[2]
                            resolucionCalendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                mes: Number(mesEntradaSeleccionado),
                                ano: Number(anoEntradaSeleccionado)
                            }
                        } else {
                            resolucionCalendario = {
                                tipo: "actual",
                                comando: "construyeObjeto"
                            }
                        }
                        const metadatosCalendario = {
                            tipoFecha: "entrada",
                            almacenamientoCalendarioID: "administracionCalendario",
                            perfilMes: "calendario_entrada_perfilSimple",
                            calendarioIO: "entrada",
                            mensajeInfo: "Selecciona la fecha de entrada para esta reserva nueva",
                            alturaDinamica: alturaDinamicaArriba,
                            instanciaUID: instanciaUID,
                            metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia"
                        }
                        casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(metadatosCalendario)
                        document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                        const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(resolucionCalendario)
                        calendarioResuelto.instanciaUID = instanciaUID
                        await casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                    }
                    if (botonID === "fechaSalida") {
                        if (calendario?.getAttribute("calendarioIO") === "salida") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                        }
                        if (calendario?.getAttribute("calendarioIO") === "entrada") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            //
                        }
                        let resolucionCalendario
                        if (fechaEntradaSelecionda && !fechaSalidaSelecionda) {
                            const fechaEntradaSelecionda_array = fechaEntradaSelecionda.split("/")
                            let mesEntradaSeleccionado = fechaEntradaSelecionda_array[1]
                            let anoEntradaSeleccionado = fechaEntradaSelecionda_array[2]
                            resolucionCalendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                mes: Number(mesEntradaSeleccionado),
                                ano: Number(anoEntradaSeleccionado)
                            }
                        }
                        if (fechaSalidaSelecionda) {
                            const fechaSalidaSelecionda_array = fechaSalidaSelecionda.split("/")
                            let mesSalidaSeleccionado = fechaSalidaSelecionda_array[1]
                            let anoSalidaSeleccionado = fechaSalidaSelecionda_array[2]
                            resolucionCalendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                mes: Number(mesSalidaSeleccionado),
                                ano: Number(anoSalidaSeleccionado)
                            }
                        }
                        if (!fechaEntradaSelecionda && !fechaSalidaSelecionda) {
                            resolucionCalendario = {
                                tipo: "actual",
                                comando: "construyeObjeto"
                            }
                        }
                        let metadatosCalendario = {
                            tipoFecha: "salida",
                            almacenamientoCalendarioID: "administracionCalendario",
                            perfilMes: "calendario_salida_perfilSimple",
                            calendarioIO: "salida",
                            mensajeInfo: "Selecciona la fecha de salida para esta reserva nueva",
                            alturaDinamica: alturaDinamicaArriba,
                            instanciaUID: instanciaUID,
                            metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia"
                        }
                        casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(metadatosCalendario)
                        document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                        const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(resolucionCalendario)
                        calendarioResuelto.instanciaUID = instanciaUID
                        casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                    }
                },
                seleccionarDia: (dia) => {
                    let diaSeleccionadoComoElemento = dia.target;
                    let calendario = document.querySelector("[componente=bloqueCalendario] [componente=marcoCalendario]")
                    let calendarioIO = calendario.getAttribute("calendarioIO")
                    let diaSeleccionado = dia.target.getAttribute("dia")
                    diaSeleccionado = diaSeleccionado.padStart(2, "0")
                    diaSeleccionado = Number(diaSeleccionado)
                    let anoSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("ano")
                    anoSeleccionado = anoSeleccionado.padStart(4, "0")
                    anoSeleccionado = Number(anoSeleccionado)
                    let mesSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("mes")
                    mesSeleccionado = mesSeleccionado.padStart(2, "0")
                    mesSeleccionado = Number(mesSeleccionado)
                    const fechaSeleccionadaUI = `${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}`
                    let selectorDias = document.querySelectorAll("[calendarioIO] [dia]")
                    selectorDias.forEach((dia) => {
                        //dia.classList.remove("calendarioDiaDisponible")
                        dia.classList.remove("calendarioDiaReserva")
                        dia.classList.remove("calendarioDiaSeleccionado")
                    })
                    if (diaSeleccionadoComoElemento.getAttribute("estadoDia") === "seleccionado") {
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        if (calendarioIO === "entrada") {
                            document.querySelector("[calendario=entrada]").removeAttribute("memoriaVolatil")
                            document.querySelector("[dataReserva=fechaEntrada]").innerText = "Seleccionar fecha de entrada"
                        }
                        if (calendarioIO === "salida") {
                            document.querySelector("[calendario=salida]").removeAttribute("memoriaVolatil")
                            document.querySelector("[dataReserva=fechaSalida]").innerText = "Seleccionar fecha de salida"
                        }
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        diaSeleccionadoComoElemento.removeAttribute("estadoDia")

                    }
                    let diasDisponibles = document.querySelectorAll("[estado=disponible]")
                    diasDisponibles.forEach(diaDisponible => {
                        diaDisponible.removeAttribute("estadoDia")
                        diaDisponible.style.background = ""
                        diaDisponible.style.color = ""
                    })
                    diaSeleccionadoComoElemento.setAttribute("estadoDia", "seleccionado")
                    diaSeleccionadoComoElemento.classList.add("calendarioDiaSeleccionado")
                    let fechaEntradaSelecionda = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoEntrada
                    let mesSeleccionadoEntrada
                    let anoSeleccionadoEntrada
                    if (fechaEntradaSelecionda) {
                        const fechaEntradaSelecionda_array = fechaEntradaSelecionda.split("/")
                        diaSeleccionadoEntrada = fechaEntradaSelecionda_array[0]
                        diaSeleccionadoEntrada = Number(diaSeleccionadoEntrada)
                        mesSeleccionadoEntrada = fechaEntradaSelecionda_array[1]
                        mesSeleccionadoEntrada = Number(mesSeleccionadoEntrada)
                        anoSeleccionadoEntrada = fechaEntradaSelecionda_array[2]
                        anoSeleccionadoEntrada = Number(anoSeleccionadoEntrada)
                        datosFechaEntradaSeleccionada = "existen"
                    }
                    let fechaSalidaSelecionda = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoSalida
                    let mesSeleccionadoSalida
                    let anoSeleccionadoSalida
                    if (fechaSalidaSelecionda) {
                        const fechaSalidaSelecionda_array = fechaSalidaSelecionda.split("/")
                        diaSeleccionadoSalida = fechaSalidaSelecionda_array[0]
                        diaSeleccionadoSalida = Number(diaSeleccionadoSalida)
                        mesSeleccionadoSalida = fechaSalidaSelecionda_array[1]
                        mesSeleccionadoSalida = Number(mesSeleccionadoSalida)
                        anoSeleccionadoSalida = fechaSalidaSelecionda_array[2]
                        anoSeleccionadoSalida = Number(anoSeleccionadoSalida)
                        datosFechaSalidaSeleccionada = "existen"
                    }
                    if (calendarioIO === "entrada") {
                        document.querySelector("[calendario=entrada]").setAttribute("memoriaVolatil", fechaSeleccionadaUI)
                        document.querySelector("[dataReserva=fechaEntrada]").innerText = fechaSeleccionadaUI
                        if (fechaSalidaSelecionda) {
                            if (mesSeleccionadoSalida === mesSeleccionado && anoSeleccionado === anoSeleccionadoSalida) {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado && Number(dia.getAttribute("dia")) < diaSeleccionadoSalida) {
                                        // dia.classList.remove("calendarioDiaDisponible")
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEachEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                    }
                    if (calendarioIO === "salida") {
                        document.querySelector("[calendario=salida]").setAttribute("memoriaVolatil", fechaSeleccionadaUI)
                        document.querySelector("[dataReserva=fechaSalida]").innerText = fechaSeleccionadaUI
                        if (fechaEntradaSelecionda) {
                            if (mesSeleccionadoEntrada === mesSeleccionado && anoSeleccionado === anoSeleccionadoEntrada) {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado && Number(dia.getAttribute("dia")) > diaSeleccionadoEntrada) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                    }
                },
                buscarAlojamiento: async () => {
                    try {
                        const fechaEntrada = document.querySelector("[calendario=entrada]")?.getAttribute("memoriaVolatil")
                        const fechaSalida = document.querySelector("[calendario=salida]")?.getAttribute("memoriaVolatil")

                        document.querySelectorAll("[componente=advertenciaIntegrada]").forEach((advertenciaRenderizada) => {
                            advertenciaRenderizada.remove()
                        })
                        const selectorContenedorBoton = document.querySelector("[componente=espacioBotonConfirmarReserva]")
                        selectorContenedorBoton.classList.add("elementoOcultoInicialmente")
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const selectorBloqueEspacioApartamentos = document.querySelector("[componente=espacioApartamento]")
                        selectorBloqueEspacioApartamentos.classList.remove("elementoOcultoInicialmente")
                        selectorBloqueEspacioApartamentos.setAttribute("instanciaUID", instanciaUID)
                        selectorBloqueEspacioApartamentos.innerHTML = null
                        const advertenciaInmersivaUI = document.createElement("div")
                        advertenciaInmersivaUI.setAttribute("class", "advertenciaIntegrada")
                        advertenciaInmersivaUI.setAttribute("componente", "advertenciaIntegrada")
                        const marcoElastico = document.createElement("div")
                        marcoElastico.classList.add("marcoElasticoError")
                        const spinnerContainer = document.createElement("div");
                        spinnerContainer.setAttribute("componente", "iconoCargaEnlace");
                        spinnerContainer.classList.add("lds", "spinner");
                        for (let i = 0; i < 12; i++) {
                            const div = document.createElement("div");
                            spinnerContainer.appendChild(div);
                        }

                        marcoElastico.appendChild(spinnerContainer)
                        const info = document.createElement("div")
                        info.setAttribute("class", "advertenciaInfoFlujoPago")
                        info.setAttribute("componente", "mensajeFlujoPasarela")
                        info.innerText = "Buscando alojamiento..."
                        marcoElastico.appendChild(info)
                        const boton = document.createElement("div")
                        boton.setAttribute("class", "errorBoton")
                        boton.innerText = "Cancelar"
                        boton.addEventListener("click", (e) => {
                            selectorBloqueEspacioApartamentos.classList.add("elementoOcultoInicialmente")
                            selectorBloqueEspacioApartamentos.removeAttribute("instanciaUID")
                            e.target.closest("[componente=advertenciaIntegrada]").remove()
                        })
                        marcoElastico.appendChild(boton)
                        advertenciaInmersivaUI.appendChild(marcoElastico)
                        selectorBloqueEspacioApartamentos.appendChild(advertenciaInmersivaUI)

                        const transaccion = {
                            zona: "administracion/reservas/nuevaReserva/apartamentosDisponiblesAdministracion",
                            fechaEntrada: fechaEntrada,
                            fechaSalida: fechaSalida
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) {
                            return
                        }
                        if (respuestaServidor?.error) {
                            instanciaRenderizada.querySelector("[componente=advertenciaIntegrada]").remove()
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const apartamenosDisponiblesArray = respuestaServidor?.ok.apartamentosDisponibles
                            const configuracionesAlojamiento = respuestaServidor.configuracionesAlojamiento

                            if (apartamenosDisponiblesArray.length === 0) {
                                const infoNoDisponibilidad = document.createElement("div")
                                infoNoDisponibilidad.classList.add("adminitracion_reservas_crearReserva_infoSinAlojamiento")
                                infoNoDisponibilidad.innerText = "No hay ningÃºn alojamiento disponible para las fechas seleccionadas.Eso es debido a reservas donde estÃ¡n estos apartamentos, bloqueos en estas fechas o configuraciones no disponibles.Para tener una visiÃ³n sobre esta situaciÃ³n, puede ir al calendario, donde podrÃ¡ ver lo que ocurre.Para ver todos los eventos, selecciona la capa Global del calendario.Inicialmente, el calendario tiene esta capa predeterminadamente seleccionada."
                                document.querySelector(`[instanciaUID="${instanciaUID}"]`).innerHTML = null
                                document.querySelector(`[instanciaUID="${instanciaUID}"]`).appendChild(infoNoDisponibilidad)
                                return
                            }
                            const apartamentosDisponiblesUI = document.createElement("apartamentosDisponibles")
                            apartamentosDisponiblesUI.classList.add("espacioApartamentosDipsoniblesCrearReserva")
                            apartamentosDisponiblesUI.setAttribute("componente", "apartamentosDisponibles")
                            for (const [apartamentoIDV, configuracion] of Object.entries(configuracionesAlojamiento)) {
                                const apartamentoUI = configuracion.apartamentoUI
                                const habitaciones = configuracion.habitaciones
                                const bloqueApartamentoUI = document.createElement("div")
                                bloqueApartamentoUI.classList.add("bloqueApartamentoUI")
                                bloqueApartamentoUI.setAttribute("apartamentoIDV", apartamentoIDV)
                                const tituloApartamentoUI = document.createElement("p")
                                tituloApartamentoUI.classList.add("tituloApartamentoUI")
                                tituloApartamentoUI.innerText = apartamentoUI
                                bloqueApartamentoUI.appendChild(tituloApartamentoUI)
                                const bloqueHabiaciones = document.createElement("div")
                                bloqueHabiaciones.classList.add("bloqueHabiaciones")
                                bloqueApartamentoUI.appendChild(bloqueHabiaciones)
                                for (const [habitacionIDV, detallesHabitacion] of Object.entries(habitaciones)) {
                                    const tituloHabitacion = document.createElement("div")
                                    tituloHabitacion.classList.add("tituloHabitacion")
                                    tituloHabitacion.innerText = detallesHabitacion.habitacionUI
                                    bloqueHabiaciones.appendChild(tituloHabitacion)
                                }
                                const botonSeleccionarApartamento = document.createElement("div")
                                botonSeleccionarApartamento.classList.add("botonSeleccionarApartamento")
                                botonSeleccionarApartamento.setAttribute("apartamentoIDV", apartamentoIDV)
                                botonSeleccionarApartamento.innerText = "Seleccionar " + apartamentoUI
                                botonSeleccionarApartamento.addEventListener("click", casaVitini.administracion.reservas.nuevaReserva.seleccionarApartamento)
                                bloqueApartamentoUI.appendChild(botonSeleccionarApartamento)
                                apartamentosDisponiblesUI.appendChild(bloqueApartamentoUI)
                            }
                            document.querySelector(`[instanciaUID="${instanciaUID}"]`).innerHTML = null
                            document.querySelector(`[instanciaUID="${instanciaUID}"]`).appendChild(apartamentosDisponiblesUI)

                        }
                    } catch (errorCapturado) {
                        throw errorCapturado
                    }
                },
                seleccionarApartamento: (apartamento) => {
                    let selectorEspacioBotonConfimrar = document.querySelector("[componente=espacioBotonConfirmarReserva]")
                    if (apartamento.target.getAttribute("estado")) {
                        apartamento.target.removeAttribute("style")
                        apartamento.target.removeAttribute("estado")
                        let contadorApartamentosSeleccionados = document.querySelectorAll("[estado=seleccionado]")
                        if (contadorApartamentosSeleccionados.length > 0) {
                            selectorEspacioBotonConfimrar.classList.remove("elementoOcultoInicialmente")
                        } else {
                            selectorEspacioBotonConfimrar.classList.add("elementoOcultoInicialmente")
                        }
                        return
                    }
                    apartamento.target.style.background = "blue"
                    apartamento.target.style.color = "white"
                    apartamento.target.setAttribute("estado", "seleccionado")
                    let contadorApartamentosSeleccionados = document.querySelectorAll("[estado=seleccionado]")
                    if (contadorApartamentosSeleccionados.length > 0) {
                        selectorEspacioBotonConfimrar.classList.remove("elementoOcultoInicialmente")
                    } else {
                        selectorEspacioBotonConfimrar.classList.add("elementoOcultoInicialmente")
                    }
                },
                confirmarReservaNueva: async () => {
                    const fechaEntrada = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    const fechaSalida = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    const estadoInicialIDV = document.querySelector("[selector=estadoInicialReserva]").value

                    const apartamentos = []
                    document.querySelectorAll("[estado=seleccionado]").forEach((apartamentoSeleccionado) => {
                        const apartamentoIDV = apartamentoSeleccionado.getAttribute("apartamentoIDV")
                        apartamentos.push(apartamentoIDV)
                    })
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const metadatosPantallaCarga = {
                        mensaje: "Creando reserva...",
                        instanciaUID,
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                    const transaccion = {
                        zona: "administracion/reservas/nuevaReserva/crearReservaSimpleAdministrativa",
                        fechaEntrada: fechaEntrada,
                        fechaSalida: fechaSalida,
                        estadoInicialIDV: estadoInicialIDV,
                        apartamentos: apartamentos
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const pantallaDeCargaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (pantallaDeCargaRenderizada) {
                        if (respuestaServidor?.error) {
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas();
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const vista = `/administracion/reservas/reserva:${respuestaServidor?.reservaUID}`
                            const navegacion = {
                                vista: vista,
                                tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                }
            },
            detallesReserva: {
                reservaUI: {
                    ui: async function (data) {
                        const main = document.querySelector("main")
                        main.setAttribute("ui", "reservaUI")
                        const reservaUID = data.reservaUID
                        const granuladoURL = casaVitini.utilidades.granuladorURL()

                        const posicionReservaUID = granuladoURL.directorios.findIndex(directorio => directorio === "reservas") + 1;
                        const parametros = granuladoURL.parametros
                        //const reservaUID = parametros.reserva
                        const posicionCategoriaGlobalInicial = (posicionReservaUID + 1)
                        const categoriaGlobalInicial = granuladoURL.rawArray[3]

                        const transaccion = {
                            zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                            reservaUID: reservaUID,
                            capas: [
                                "titular",
                                "desgloseFinanciero"
                            ]
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            return casaVitini.ui.componentes.mensajeSimple({
                                titulo: respuestaServidor?.error,
                            })
                        }
                        if (respuestaServidor?.ok) {

                            const detallesReserva = respuestaServidor.ok
                            const global = detallesReserva.global
                            const detallesTitular = detallesReserva?.titular
                            const contenedorFinanciero = detallesReserva.contenedorFinanciero
                            const reservaUID = global.reservaUID

                            const porcentajeTranscurrido = global.porcentajeTranscurrido

                            const detallesDeLaReserva = respuestaServidor.reserva
                            const estadoReservaIDV = global.estadoReservaIDV
                            const estadoPagoIDV = global.estadoPagoIDV
                            const fechaCreacion = global.fechaCreacion
                            const origenIDV = global.origenIDV
                            const fechaEntrada = global.fechaEntrada
                            const fechaSalida = global.fechaSalida
                            const totalReserva = contenedorFinanciero?.desgloseFinanciero?.global?.totales?.totalFinal ?? "Sin informaciÃ³n"

                            const fechaInicio_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaEntrada)
                            const fechaFinal_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaSalida)

                            const titulo = document.querySelector(".titulo")
                            //titulo.innerText = "Reserva"
                            titulo?.remove()
                            let estadoReservaUI
                            if (estadoReservaIDV === "cancelada") {
                                estadoReservaUI = "Cancelada"
                            }
                            if (estadoReservaIDV === "confirmada") {
                                estadoReservaUI = "Confirmada"
                            }
                            if (estadoReservaIDV === "pendiente") {
                                estadoReservaUI = "Pendiente"
                            }
                            let estadoPagoUI
                            if (estadoPagoIDV === "pagado") {
                                estadoPagoUI = "Pagado"
                            }
                            if (estadoPagoIDV === "noPagado") {
                                estadoPagoUI = "No pagado"
                            }
                            if (estadoPagoIDV === "pagadoParcialmente") {
                                estadoPagoUI = "Pagado parcialmente"
                            }
                            if (estadoPagoIDV === "pagadoSuperadamente") {
                                estadoPagoUI = "Pagado superadamente"
                            }
                            let nombreCompletoTitular = "(NÃ­ngun titular asignado)"

                            if (detallesTitular.nombreTitular) {
                                nombreCompletoTitular = detallesTitular.nombreTitular
                            }
                            let origenUI
                            if (origenIDV === "cliente") {
                                origenUI = "Cliente"
                            }
                            if (origenIDV === "administracion") {
                                origenUI = "AdminitraciÃ³n"
                            }
                            const marcoElastico = document.createElement("div")
                            marcoElastico.classList.add("marcoElasticoRelativo")
                            marcoElastico.setAttribute("componente", "marcoElastico")
                            //Crear el elemento div principal
                            const divPrincipal = document.createElement("div");
                            divPrincipal.setAttribute("reservaUID", reservaUID)

                            divPrincipal.setAttribute("componente", "detalleReserva");
                            divPrincipal.classList.add(
                                "flexVertical",
                                "gap6"
                            )

                            marcoElastico.appendChild(divPrincipal);

                            const contenedorPendiente = document.createElement("div")
                            if (estadoReservaIDV !== "pendiente") {
                                contenedorPendiente.style.display = "none"
                            }
                            contenedorPendiente.setAttribute("contenedor", "pendiente")
                            contenedorPendiente.classList.add(
                                "gap6",
                                "borderRadius8",
                                "contenedorPendiente"
                            )
                            divPrincipal.appendChild(contenedorPendiente);

                            const botonAceptar = document.createElement("div")
                            botonAceptar.classList.add(
                                "botonV1",
                                "comportamientoBoton"
                            )
                            botonAceptar.innerText = "Aceptar reserva"
                            botonAceptar.addEventListener("click", () => {
                                this.estado.aceptarReserva({
                                    reservaUID
                                })
                            })
                            contenedorPendiente.appendChild(botonAceptar);

                            const botonRechazar = document.createElement("div")
                            botonRechazar.classList.add(
                                "botonV1",
                                "comportamientoBoton"
                            )
                            botonRechazar.innerText = "Rechazar reserva"
                            botonRechazar.addEventListener("click", () => {
                                casaVitini.administracion.reservas.detallesReserva.reservaUI.estado.rechazarReserva({
                                    reservaUID
                                })
                            })
                            contenedorPendiente.appendChild(botonRechazar);


                            //Crear el elemento div.reservaDetallesBloqueGeneral
                            const divBloqueGeneral = document.createElement("div");
                            divBloqueGeneral.setAttribute("class", "reservaDetallesBloqueGeneral");
                            const divInformacionGeneral = document.createElement("div");
                            divInformacionGeneral.setAttribute("class", "administracionReservasDetalesMarcoEnvolventeInformacionGeneral");
                            const contenedorReseervaUID = document.createElement("div");
                            contenedorReseervaUID.setAttribute("class", "administracion_reservas_detallesReserva_contenedorReservaUID");
                            const pTitulo1 = document.createElement("p");
                            pTitulo1.setAttribute("class", "adminsitracionReservasTituloNombre marginCeroparaP");
                            pTitulo1.textContent = "Reserva";
                            const pDato1 = document.createElement("p");
                            pDato1.classList.add(
                                "contenedroTextoEspansivo"
                            );
                            pDato1.setAttribute("dataReserva", "reservaID");
                            pDato1.setAttribute("componente", "reservaUID_" + reservaUID)
                            pDato1.textContent = reservaUID;
                            contenedorReseervaUID.appendChild(pTitulo1);
                            contenedorReseervaUID.appendChild(pDato1);
                            const contenedorRestoGlobal = document.createElement("div")
                            contenedorRestoGlobal.classList.add("administracion_reservas_detallesReserva_contenedorRestoGlobal")
                            const bloqueTitular = document.createElement("div");
                            bloqueTitular.setAttribute("class", "administracion_reservas_detallesReserva_panel_bloqueTitular");
                            bloqueTitular.setAttribute("contenedor", "titularUID")
                            bloqueTitular.addEventListener("click", this.titular.desplegarUI)
                            if (detallesTitular?.tipoTitularIDV === "titularCliente") {
                                bloqueTitular.setAttribute("titularUID", detallesTitular.clienteUID)
                            }
                            if (detallesTitular) {
                                bloqueTitular.setAttribute("tipoTitular", detallesTitular.tipoTitularIDV)
                            }
                            const tituloTitular = document.createElement("p");
                            tituloTitular.setAttribute("class", "adminsitracionReservasTituloNombre marginCeroparaP");
                            tituloTitular.textContent = "Titular de la reserva";
                            const nombreTitular = document.createElement("p");
                            nombreTitular.setAttribute("class", "marginCeroparaP");
                            nombreTitular.classList.add("contenedroTextoEspansivo");
                            nombreTitular.setAttribute("dataReserva", "nombreTitular");
                            nombreTitular.textContent = nombreCompletoTitular;
                            bloqueTitular.appendChild(tituloTitular);
                            bloqueTitular.appendChild(nombreTitular);
                            const divBloqueDual2 = document.createElement("div");
                            divBloqueDual2.setAttribute("class", "administracionReservaBloqueDual");
                            const pTitulo2 = document.createElement("p");
                            pTitulo2.setAttribute("class", "adminsitracionReservasTituloNombre marginCeroparaP");
                            pTitulo2.textContent = "Fecha de creaciÃ³n UTC";
                            const pDato2 = document.createElement("p");
                            pDato2.setAttribute("class", "marginCeroparaP");
                            pDato2.setAttribute("dataReserva", "nada");
                            pDato2.classList.add("adminsitracion_reservas_detallesReserva_contenedorDatoGlobal");
                            pDato2.textContent = fechaCreacion;
                            divBloqueDual2.appendChild(pTitulo2);
                            divBloqueDual2.appendChild(pDato2);
                            const divBloqueDual3 = document.createElement("div");
                            divBloqueDual3.setAttribute("class", "administracionReservaBloqueDual");
                            const pTitulo3 = document.createElement("p");
                            pTitulo3.setAttribute("class", "adminsitracionReservasTituloNombre marginCeroparaP");
                            pTitulo3.textContent = "Origen de la reserva";
                            const pDato3 = document.createElement("p");
                            pDato3.setAttribute("class", "marginCeroparaP");
                            pDato3.setAttribute("dataReserva", "origen");
                            pDato3.classList.add("adminsitracion_reservas_detallesReserva_contenedorDatoGlobal");
                            pDato3.textContent = origenUI;
                            divBloqueDual3.appendChild(pTitulo3);
                            divBloqueDual3.appendChild(pDato3);
                            const divBloqueDual4 = document.createElement("div");
                            divBloqueDual4.setAttribute("class", "administracion_reservas_detallesReserva_panel_bloqueTitular");
                            divBloqueDual4.setAttribute("contenedor", "estadoReservaIDV")
                            const pTitulo4 = document.createElement("p");
                            pTitulo4.setAttribute("class", "adminsitracionReservasTituloNombre marginCeroparaP");
                            pTitulo4.textContent = "Estado de la reserva";
                            const pDato4 = document.createElement("p");
                            pDato4.setAttribute("class", "marginCeroparaP");
                            pDato4.setAttribute("dataReserva", "estado");
                            pDato4.setAttribute("estadoReservaIDV", estadoReservaIDV);
                            pDato4.classList.add("adminsitracion_reservas_detallesReserva_contenedorDatoGlobal");
                            pDato4.textContent = estadoReservaUI;
                            divBloqueDual4.addEventListener("click", (e) => {
                                this.estado.panelExpandidoUI({
                                    reservaUID,
                                    estadoActual: e.target.closest("[contenedor=estadoReservaIDV]")
                                        .querySelector("[estadoReservaIDV]")
                                        .getAttribute("estadoReservaIDV")
                                })
                            })
                            divBloqueDual4.appendChild(pTitulo4);

                            divBloqueDual4.appendChild(pDato4);
                            const divBloqueDual5 = document.createElement("div");
                            divBloqueDual5.setAttribute("class", "administracionReservaBloqueDual");
                            const pTitulo5 = document.createElement("p");
                            pTitulo5.setAttribute("class", "adminsitracionReservasTituloNombre marginCeroparaP");
                            pTitulo5.textContent = "Estado del pago";
                            const pDato5 = document.createElement("p");
                            pDato5.setAttribute("class", "marginCeroparaP");
                            pDato5.setAttribute("dataReserva", "estadoPago");
                            pDato5.classList.add("adminsitracion_reservas_detallesReserva_contenedorDatoGlobal");
                            pDato5.textContent = estadoPagoUI;
                            divBloqueDual5.appendChild(pTitulo5);
                            divBloqueDual5.appendChild(pDato5);
                            const divBloqueDual6 = document.createElement("div");
                            divBloqueDual6.setAttribute("class", "administracionReservaBloqueDual");
                            const pTitulo6 = document.createElement("p");
                            pTitulo6.setAttribute("class", "adminsitracionReservasTituloNombre marginCeroparaP");
                            pTitulo6.textContent = "Total";
                            const pDato6 = document.createElement("p");
                            pDato6.setAttribute("class", "marginCeroparaP");
                            pDato6.setAttribute("dataReserva", "totalReservaConImpuestos");
                            pDato6.classList.add("adminsitracion_reservas_detallesReserva_contenedorDatoGlobal");
                            pDato6.textContent = totalReserva;
                            divBloqueDual6.appendChild(pTitulo6);
                            divBloqueDual6.appendChild(pDato6);
                            divInformacionGeneral.appendChild(contenedorReseervaUID);
                            contenedorRestoGlobal.appendChild(bloqueTitular);
                            contenedorRestoGlobal.appendChild(divBloqueDual2);
                            contenedorRestoGlobal.appendChild(divBloqueDual3);
                            contenedorRestoGlobal.appendChild(divBloqueDual4);
                            contenedorRestoGlobal.appendChild(divBloqueDual5);
                            contenedorRestoGlobal.appendChild(divBloqueDual6);
                            //Anadir divInformacionGeneral a divBloqueGeneral
                            divInformacionGeneral.appendChild(contenedorRestoGlobal);
                            divBloqueGeneral.appendChild(divInformacionGeneral);
                            divPrincipal.appendChild(divBloqueGeneral);



                            const nombreClaseDinamica = `barraProgresso-anchoDinamico-${reservaUID}`;
                            if (!document.querySelector(`.${nombreClaseDinamica}`)) {
                                // Si no existe, crea un nuevo estilo
                                const style = document.createElement('style');
                                style.innerHTML = `
                                    .${nombreClaseDinamica} {
                                        width: ${porcentajeTranscurrido}%;
                                `;
                                document.querySelector("main").appendChild(style);
                            }


                            const contenedorProgreso = document.createElement("div")
                            contenedorProgreso.classList.add(
                                "backgroundGrey1",
                                "borderRadius8",
                            )
                            contenedorProgreso.style.height = "20px"
                            contenedorProgreso.style.overflow = "hidden"
                            divPrincipal.appendChild(contenedorProgreso);
                            const barraProgresso = document.createElement("div")
                            barraProgresso.setAttribute("componente", "progreso")
                            barraProgresso.classList.add(
                                "barraProgresso",
                                nombreClaseDinamica
                            )
                            //barraProgresso.style.background = "grey"
                            //barraProgresso.style.width = porcentajeTranscurrido + "%"



                            contenedorProgreso.appendChild(barraProgresso);
                            casaVitini.administracion.reservas.detallesReserva.reservaUI.fechas.seleccionarDia
                            const contenedorFechasUI = casaVitini.ui.componentes.componentesComplejos.contenedorFechasUI({
                                //metodoSelectorDia: "casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.componentes.pasarelaSelectorDia",
                                nombreContenedor: "rangoReserva",
                                modo: "administracion",
                                nombreFechaEntrada: "Fecha entrada",
                                nombreSalidaEntrada: "Fecha salida",
                                configuracionCalendarioInicio: {
                                    rangoIDV: "inicioRango",
                                    contenedorOrigenIDV: "[calendario=entrada]",
                                    perfilMes: "calendario_entrada_asistido_detallesReserva_conPasado",
                                    mensajeInfo: "Selecciona la fecha de entrada que quieras actualizar en esta reserva",
                                    metodoSelectorDia: "casaVitini.administracion.reservas.detallesReserva.reservaUI.fechas.seleccionarDia",
                                },

                                configuracionCalendarioFinal: {
                                    rangoIDV: "finalRango",
                                    contenedorOrigenIDV: "[calendario=salida]",
                                    perfilMes: "calendario_salida_asistido_detallesReserva_conPasado",
                                    metodoSelectorDia: "casaVitini.administracion.reservas.detallesReserva.reservaUI.fechas.seleccionarDia",
                                    mensajeInfo: "Selecciona la fecha de salida que quieras actualizar en esta reserva.",

                                }
                            })
                            divPrincipal.appendChild(contenedorFechasUI);

                            const selectorEntrada = contenedorFechasUI.querySelector("[calendario=entrada]")
                            const selectorSalida = contenedorFechasUI.querySelector("[calendario=salida]")

                            selectorEntrada.setAttribute("memoriaVolatil", fechaEntrada)
                            selectorSalida.setAttribute("memoriaVolatil", fechaSalida)

                            const fechaEntradaUI = selectorEntrada.querySelector("[fechaUI=fechaInicio]")
                            const fechaSalidaUI = selectorSalida.querySelector("[fechaUI=fechaFin]")

                            fechaEntradaUI.innerText = fechaInicio_humana
                            fechaSalidaUI.innerText = fechaFinal_humana



                            //Crear el elemento div.resertaDetallesPropuestaCambioFechaReserva
                            const divPropuestaCambioFecha = document.createElement("div");
                            divPropuestaCambioFecha.setAttribute("class", "resertaDetallesPropuestaCambioFechaReserva");
                            divPropuestaCambioFecha.setAttribute("componente", "espacioPropuestaCambioFechaReserva");
                            //Anadir divPropuestaCambioFecha al div principal
                            divPrincipal.appendChild(divPropuestaCambioFecha);
                            const contenedorCategoriasGlobales = document.createElement("div")
                            contenedorCategoriasGlobales.classList.add("administracion_reservas_detallesReserva_contenedorCategoriasGlobales")
                            const contenedorMenuExpandido = document.createElement("div")
                            contenedorMenuExpandido.classList.add("administracion_reservas_detallesReserva_contenedorMenuExpandido")

                            const contenedorBotones = this.categorias.categoriasGlobalesBotonesUI({
                                rectangularidad: "horizontal",
                                reservaUID: reservaUID
                            })
                            contenedorMenuExpandido.appendChild(contenedorBotones);
                            //Menu categorias reserva responsiba
                            const marcoMenuResponsivo = document.createElement("div");
                            marcoMenuResponsivo.setAttribute("class", "administracion_reserva_detallesReserva_marcoMenuResponsivo");
                            marcoMenuResponsivo.innerText = "MenÃº reserva"
                            marcoMenuResponsivo.addEventListener("click", () => {
                                document.body.style.overflow = "hidden";
                                this.categorias.desplegarMenuResponsivo(reservaUID)
                            })
                            contenedorCategoriasGlobales.appendChild(marcoMenuResponsivo);
                            contenedorCategoriasGlobales.appendChild(contenedorMenuExpandido);
                            divPrincipal.appendChild(contenedorCategoriasGlobales);
                            const contenedorDinamico = document.createElement("div")
                            contenedorDinamico.classList.add("administracion_reservas_detallesReserva_contenedorDinamico")
                            contenedorDinamico.setAttribute("componente", "contenedorDinamico")
                            divPrincipal.appendChild(contenedorDinamico)
                            const reservaDetallesBloqueAlojamineto = document.createElement("div");
                            reservaDetallesBloqueAlojamineto.setAttribute("class", "reservaDetallesBloqueAlojamineto");
                            reservaDetallesBloqueAlojamineto.setAttribute("componente", "marcoAlojamiento");
                            //divPrincipal.appendChild(reservaDetallesBloqueAlojamineto);
                            //Crear el elemento div.resertaDetallesEspacioTotales
                            const divEspacioTotales = document.createElement("div");
                            divEspacioTotales.setAttribute("class", "resertaDtallesEspacioTotales");
                            divEspacioTotales.setAttribute("componente", "espacioTotalesReserva");
                            //Anadir divEspacioTotales al div principal
                            //divPrincipal.appendChild(divEspacioTotales);
                            //Anadir el div principal al contenedor
                            //marcoElastico.style.marginTop = "100px"
                            const seccion = document.querySelector("main:not([estado=obsoleto])")
                            seccion.appendChild(marcoElastico)
                            if (categoriaGlobalInicial) {

                                const categoriaCammelCase = categoriaGlobalInicial.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                                const metadatos = {
                                    categoria: categoriaCammelCase,
                                    origen: "url",
                                    reservaUID: reservaUID
                                }
                                await this.categorias.controladorCategorias(metadatos)
                            } else {

                                const directoriosFusionLimpios = []
                                granuladoURL.directorios.forEach((directorio, indice) => {
                                    if (indice <= posicionReservaUID) {
                                        directoriosFusionLimpios.push(directorio)
                                    }
                                })
                                //const directoriosFusion = "/" + directoriosFusionLimpios.join("/") + "/reserva:" + reservaUID
                                const categoriaAGuardarURL = (categoriaGlobalInicial) => {
                                    if (categoriaGlobalInicial) {
                                        return "/" + categoriaGlobalInicial
                                    } else {
                                        return ""
                                    }
                                }

                                const directoriosFusion = "/administracion/reservas/reserva:" + reservaUID + categoriaAGuardarURL(categoriaGlobalInicial)

                                const componentesExistenteUID = "reservaUID_" + reservaUID
                                const titulo = "Casa Vitini"
                                const estado = {
                                    zona: directoriosFusion,
                                    EstadoInternoZona: "estado",
                                    tipoCambio: "parcial",
                                    componenteExistente: componentesExistenteUID,
                                    funcionPersonalizada: "casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias"
                                }
                                window.history.replaceState(estado, titulo, directoriosFusion);
                            }
                        }
                    },
                    fechas: {
                        seleccionarDia: (dia_) => {
                            const diaSeleccionado = dia_.target.getAttribute("dia").padStart(2, "0")
                            const diaSeleccionadoComoElemento = dia_.target;
                            const calendario = diaSeleccionadoComoElemento.closest("[componente=marcoCalendario]")
                            const calendarioIO = calendario.getAttribute("calendarioIO")
                            if (diaSeleccionadoComoElemento.getAttribute("estadoDia") === "seleccionado") {
                                diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                                if (calendarioIO === "entrada") {
                                    //  diaSeleccionadoComoElemento.removeAttribute("style")
                                    document.querySelector("[componente=bloquePropuestaNuevaFechaEntrada]")?.remove()
                                    diaSeleccionadoComoElemento.style.background = ""
                                    diaSeleccionadoComoElemento.style.color = ""
                                }
                                if (calendarioIO === "salida") {
                                    document.querySelector("[componente=bloquePropuestaNuevaFechaSalida]")?.remove()
                                    diaSeleccionadoComoElemento.style.background = ""
                                    diaSeleccionadoComoElemento.style.color = ""
                                }
                                diaSeleccionadoComoElemento.removeAttribute("estadoDia")
                                casaVitini.administracion.reservas.detallesReserva.reservaUI.fechas.controladorZonaPropuestasCambioFechas()

                            }
                            document.querySelectorAll("[estado=disponible]").forEach(diaDisponible => {
                                // diaDisponible.removeAttribute("style")
                                diaDisponible.removeAttribute("estadoDia")
                                diaDisponible.style.background = ""
                                diaDisponible.style.color = ""
                            });
                            diaSeleccionadoComoElemento.style.background = "red"
                            diaSeleccionadoComoElemento.style.color = "white"
                            diaSeleccionadoComoElemento.setAttribute("estadoDia", "seleccionado")
                            const anoSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("ano").padStart(4, "0")
                            const mesSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("mes").padStart(2, "0")
                            const selectorPropuestaCambioFecha = document.querySelector("[componente=espacioPropuestaCambioFechaReserva]")
                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            if (calendarioIO === "entrada") {

                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                const contenedorPropuesta = document.createElement("div")
                                contenedorPropuesta.classList.add(
                                    "contenedorPropuesta",
                                    "flexVertical",
                                    "gap6"
                                )
                                const tituloPropuesta = document.createElement("p")
                                tituloPropuesta.classList.add("detallesReservaTituloCancelarReserva")
                                tituloPropuesta.innerText = "Propuesta de cambio de la fecha de entrada de la reserva " + reservaUID
                                tituloPropuesta.style.color = "black"
                                contenedorPropuesta.appendChild(tituloPropuesta)
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("detallesReservaCancelarBoton")
                                botonCancelar.innerText = "Cerrar propuesta y volver atrÃ¡s"
                                botonCancelar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                contenedorPropuesta.appendChild(botonCancelar)
                                const infoPropuesta = document.createElement("div")
                                infoPropuesta.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                infoPropuesta.innerText = `Has propuesto cambiar la fecha de entrada de esta reserva a ${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}. Si quieres confirmar la propuesta y cambiar la reserva, pulsa en el botÃ³n de confirmar de abajo. Si deseas cancelar, pulsa en el botÃ³n cancelar de arriba. Cuando puedes el botÃ³n confirmar, se realizarÃ¡ una Ãºltima verificaciÃ³n para comprobar que los dÃ­as siguen disponibles.`
                                contenedorPropuesta.appendChild(infoPropuesta)

                                const informacionImplicacion = document.createElement("div")
                                informacionImplicacion.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                informacionImplicacion.innerText = `Aviso importante: Cuando se quitan dÃ­as a una reserva, si luego se vuelven a aÃ±adir esos dÃ­as, los precios se insertan al precio actual del mercado establecido en el hub de precios base y de comportamientos. Siempre puede alterar los precios de la reserva mediante el sistema de sobre control.`
                                contenedorPropuesta.appendChild(informacionImplicacion)

                                const botonAceptarPropuesta = document.createElement("div")
                                botonAceptarPropuesta.classList.add("detallesReservaCancelarBoton")
                                botonAceptarPropuesta.setAttribute("componente", "botonConfirmarCancelarReserva")
                                botonAceptarPropuesta.innerText = "Confirmar propuesta y aplicar nueva fecha de entrada a la reserva"
                                botonAceptarPropuesta.addEventListener("click", () => {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const nuevaFecha = {
                                        fechaSolicitada_ISO: `${anoSeleccionado}-${mesSeleccionado}-${diaSeleccionado}`,
                                        reservaUID: reservaUID,
                                        sentidoRango: "pasado"
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.fechas.confirmarCambioFecha(nuevaFecha)
                                })
                                contenedorPropuesta.appendChild(botonAceptarPropuesta)
                                const propuestaUI = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                propuestaUI.querySelector("[contenedor=contenidoAdvertenciaInmersiva]").appendChild(contenedorPropuesta)
                                document.querySelector("main").appendChild(propuestaUI)
                            }
                            if (calendarioIO === "salida") {

                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                const contenedorPropuesta = document.createElement("div")
                                contenedorPropuesta.classList.add(
                                    "contenedorPropuesta",
                                    "flexVertical",
                                    "gap6"
                                )
                                const tituloPropuesta = document.createElement("p")
                                tituloPropuesta.classList.add("detallesReservaTituloCancelarReserva")
                                tituloPropuesta.innerText = "Propuesta de cambio de la fecha de salida de la reserva " + reservaUID
                                tituloPropuesta.style.color = "black"
                                contenedorPropuesta.appendChild(tituloPropuesta)
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("detallesReservaCancelarBoton")
                                botonCancelar.innerText = "Cerrar propuesta y volver atrÃ¡s"
                                botonCancelar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                contenedorPropuesta.appendChild(botonCancelar)
                                const infoPropuesta = document.createElement("div")
                                infoPropuesta.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                infoPropuesta.innerText = `Has propuesto cambiar la fecha de salida de la reserva a ${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}. Si quieres confirmar la propuesta y cambiar la reserva, pulsa en el botÃ³n de confirmar de abajo. Si deseas cancelar, pulsa en el botÃ³n cancelar de arriba. Cuando puedes el botÃ³n confirmar, se realizarÃ¡ una Ãºltima verificaciÃ³n para comprobar que los dÃ­as siguen disponibles.`
                                contenedorPropuesta.appendChild(infoPropuesta)

                                const informacionImplicacion = document.createElement("div")
                                informacionImplicacion.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                informacionImplicacion.innerText = `Aviso importante: Cuando se quitan dÃ­as a una reserva, si luego se vuelven a aÃ±adir esos dÃ­as, los precios se insertan al precio actual del mercado establecido en el hub de precios base y de comportamientos. Siempre puede alterar los precios de la reserva mediante el sistema de sobre control`
                                contenedorPropuesta.appendChild(informacionImplicacion)


                                const botonAceptarPropuesta = document.createElement("div")
                                botonAceptarPropuesta.classList.add("detallesReservaCancelarBoton")
                                botonAceptarPropuesta.setAttribute("componente", "botonConfirmarCancelarReserva")
                                botonAceptarPropuesta.innerText = "Confirmar propuesta y aplicar nueva fecha de salida a la reserva"
                                botonAceptarPropuesta.addEventListener("click", () => {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const nuevaFecha = {
                                        fechaSolicitada_ISO: `${anoSeleccionado}-${mesSeleccionado}-${diaSeleccionado}`,
                                        reservaUID: reservaUID,
                                        sentidoRango: "futuro"
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.fechas.confirmarCambioFecha(nuevaFecha)
                                })
                                contenedorPropuesta.appendChild(botonAceptarPropuesta)
                                const propuestaUI = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                propuestaUI.querySelector("[contenedor=contenidoAdvertenciaInmersiva]").appendChild(contenedorPropuesta)
                                document.querySelector("main").appendChild(propuestaUI)
                            }
                        },
                        confirmarCambioFecha: async (propuesta) => {
                            const instanciaUID_pantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                            const sentidoRango = propuesta.sentidoRango
                            const reservaUID = propuesta.reservaUID
                            const fechaSolicitada_ISO = propuesta.fechaSolicitada_ISO
                            const transaccion = {
                                zona: "administracion/reservas/detallesReserva/global/confirmarModificarFechaReserva",
                                reservaUID: String(reservaUID),
                                sentidoRango: sentidoRango,
                                fechaSolicitada_ISO: fechaSolicitada_ISO
                            }

                            const mensajes = {
                                pasado: [
                                    "Confirmando la nueva fecha de entrada, por favor espere...",
                                    "No se puede establecer la fecha de entrada porque los apartamentos de esta reserva estÃ¡n en otro evento que ocurre al mismo tiempo.A continuaciÃ³n tienes una lista de los eventos que entran en conflicto.",
                                ],
                                futuro: [
                                    "Confirmando la nueva fecha de salida, por favor espere...",
                                    "No se puede establecer la fecha de salida porque los apartamentos de esta reserva estÃ¡n en otro evento que ocurre al mismo tiempo.A continuaciÃ³n tienes una lista de los eventos que entran en conflicto."
                                ]
                            }
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID_pantallaDeCarga,
                                mensaje: mensajes[sentidoRango][0]
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const pantallaDeCargaRenderizada = document.querySelector(`[componente=advertenciaInmersiva][instanciaUID="${instanciaUID_pantallaDeCarga}"]`)

                            if (!pantallaDeCargaRenderizada) {
                                return
                            }
                            if (respuestaServidor?.error) {
                                const detallesError = respuestaServidor?.error

                                const eventos = detallesError.eventos
                                if (eventos) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const contenedorError = document.createElement("div")
                                    contenedorError.classList.add("contenedorErrorPropuesta")
                                    const tituloPropuesta = document.createElement("p")
                                    tituloPropuesta.classList.add("detallesReservaTituloCancelarReserva")
                                    tituloPropuesta.innerText = "No se puede cambiar la fecha debido a otros eventos ya existentes."
                                    tituloPropuesta.style.color = "black"
                                    contenedorError.appendChild(tituloPropuesta)
                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("detallesReservaCancelarBoton")
                                    botonCancelar.innerText = "Cerrar y volver a la reserva"
                                    botonCancelar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                    contenedorError.appendChild(botonCancelar)
                                    const infoPropuesta = document.createElement("div")
                                    infoPropuesta.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                    infoPropuesta.innerText = mensajes[sentidoRango][1]
                                    contenedorError.appendChild(infoPropuesta)
                                    for (const detallesDelEvento of eventos) {
                                        const fechaEntrada = detallesDelEvento.fechaEntrada
                                        const fechaSalida = detallesDelEvento.fechaSalida
                                        const fechaEntrada_array = fechaEntrada.split("-")
                                        const fechaSalida_array = fechaSalida.split("-")
                                        const fechaEntrada_Humana = `${fechaEntrada_array[2]}/${fechaEntrada_array[1]}/${fechaEntrada_array[0]}`
                                        const fechaSalida_Humana = `${fechaSalida_array[2]}/${fechaSalida_array[1]}/${fechaSalida_array[0]}`
                                        const eventoUID = detallesDelEvento.uid
                                        const tipoElemento = detallesDelEvento.tipoElemento
                                        const descripcion = detallesDelEvento.descripcion
                                        const contenedorEvento = document.createElement("div")
                                        contenedorEvento.classList.add("contenedorEvento")
                                        const tipoEvento = document.createElement("div")
                                        tipoEvento.classList.add("negrita")
                                        tipoEvento.innerText = tipoElemento.toUpperCase()
                                        contenedorEvento.appendChild(tipoEvento)
                                        const nombreDato = document.createElement("div")
                                        nombreDato.innerText = "Rango del evento"
                                        contenedorEvento.appendChild(nombreDato)
                                        const fechaEvento = document.createElement("div")
                                        //fechaEvento.classList.add()
                                        fechaEvento.innerText = `${fechaEntrada_Humana} >>> ${fechaSalida_Humana}`
                                        contenedorEvento.appendChild(fechaEvento)
                                        if (tipoElemento === "reserva") {
                                            const botonIrAlEvento = document.createElement("a")
                                            botonIrAlEvento.classList.add("botonIrAlEvento")
                                            botonIrAlEvento.innerText = "Ir a los detalles de la reserva"
                                            botonIrAlEvento.setAttribute("href", "/administracion/reservas/" + eventoUID)
                                            botonIrAlEvento.setAttribute("vista", "/administracion/reservas/" + eventoUID)
                                            botonIrAlEvento.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                            contenedorEvento.appendChild(botonIrAlEvento)
                                        }
                                        if (tipoElemento === "bloqueo") {
                                            const apartamentoIDV = detallesDelEvento.apartamentoIDV
                                            const botonIrAlEvento = document.createElement("a")
                                            botonIrAlEvento.classList.add("botonIrAlEvento")
                                            botonIrAlEvento.innerText = "Ir a los detalles del bloqueo"
                                            botonIrAlEvento.setAttribute("href", "/administracion/bloqueos/" + apartamentoIDV + "/" + eventoUID)
                                            botonIrAlEvento.setAttribute("vista", "/administracion/bloqueos/" + apartamentoIDV + "/" + eventoUID)
                                            botonIrAlEvento.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                            contenedorEvento.appendChild(botonIrAlEvento)
                                        }
                                        if (tipoElemento === "eventoCalendarioSincronizado" && descripcion) {
                                            const regex = /Reservation URL: (https:\/\/www\.airbnb\.com\/hosting\/reservations\/details\/[A-Za-z0-9]+)/;
                                            const match = descripcion.match(regex);
                                            const urlEvento = match?.[1] ?? "No se encontrÃ³ la URL en el texto proporcionado.";
                                            const botonIrAlEvento = document.createElement("a")
                                            botonIrAlEvento.classList.add("botonIrAlEvento")
                                            botonIrAlEvento.innerText = "Ir a los detalles del calendario sincronizado"
                                            botonIrAlEvento.setAttribute("href", urlEvento)
                                            botonIrAlEvento.setAttribute("vista", urlEvento)
                                            contenedorEvento.appendChild(botonIrAlEvento)
                                        }
                                        if (tipoElemento === "eventoCalendarioSincronizado" && !descripcion) {
                                            const botonIrAlEvento = document.createElement("a")
                                            botonIrAlEvento.classList.add("infoEventoSinDetalles")
                                            botonIrAlEvento.innerText = "Este evento es de un calendario externo sincronizado y no ofrece detalles del mismo"
                                            contenedorEvento.appendChild(botonIrAlEvento)
                                        }
                                        contenedorError.appendChild(contenedorEvento)
                                    }
                                    const mensajeError = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    mensajeError.querySelector("[contenedor=contenidoAdvertenciaInmersiva]").appendChild(contenedorError)
                                    document.querySelector("main").appendChild(mensajeError)
                                    pantallaDeCargaRenderizada.remove()
                                    //falta la pantalla de error con los elementos
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                } else {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor.error)
                                }


                            }
                            if (respuestaServidor?.ok) {

                                pantallaDeCargaRenderizada?.remove()
                                const sentidoRangoRespueata = respuestaServidor.sentidoRango
                                const fecha_ISO = respuestaServidor.fecha_ISO
                                const fechaArray_ISO = fecha_ISO.split("-")
                                const fecha_Humano = `${fechaArray_ISO[2]}/${fechaArray_ISO[1]}/${fechaArray_ISO[0]}`
                                //const totalFinal = respuestaServidor.desgloseFinanciero.global.totales.totalFinal
                                //const selectorTotalFinal = document.querySelector(`[reservaUID="${reservaUID}"]`).querySelector("[dataReserva=totalReservaConImpuestos]")
                                //selectorTotalFinal.innerText = totalFinal

                                casaVitini.administracion.reservas.detallesReserva.reservaUI.actualizarReservaRenderizada()
                                if (sentidoRangoRespueata === "pasado" && pantallaDeCargaRenderizada) {
                                    const selectorFechaEntrada = document.querySelector("[calendario=entrada]")
                                    const selectorFechaEntradaUI = document.querySelector("[fechaUI=fechaInicio]")
                                    selectorFechaEntrada.setAttribute("memoriaVolatil", fecha_ISO)
                                    selectorFechaEntradaUI.innerText = fecha_Humano
                                }
                                if (sentidoRangoRespueata === "futuro" && pantallaDeCargaRenderizada) {
                                    const selectorFechaSalida = document.querySelector("[calendario=salida]")
                                    const selectorFechaSalidaUI = document.querySelector("[fechaUI=fechaFin]")
                                    selectorFechaSalida.setAttribute("memoriaVolatil", fecha_ISO)
                                    selectorFechaSalidaUI.innerText = fecha_Humano
                                }
                            }
                        },
                        controladorZonaPropuestasCambioFechas: () => {
                            const selectorZonaPropuestas = document.querySelector("[componente=espacioPropuestaCambioFechaReserva]").childElementCount
                            if (selectorZonaPropuestas > 0) {
                                document.querySelector("[componente=espacioPropuestaCambioFechaReserva]").style.display = "grid"
                            } else {
                                document.querySelector("[componente=espacioPropuestaCambioFechaReserva]").style.display = "none"
                            }
                        },
                        cancelarPropuestaCambioFecha: (propuesta) => {
                            propuesta.target.parentNode.remove()
                            casaVitini.administracion.reservas.detallesReserva.reservaUI.fechas.controladorZonaPropuestasCambioFechas()
                        },

                    },
                    titular: {
                        desplegarUI: async () => {
                            document.body.style.overflow = "hidden";
                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const advertenciaInmersivaIU = document.createElement("div")
                            advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                            advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                            advertenciaInmersivaIU.setAttribute("instanciaUID", instanciaUID)
                            const contenedorAdvertenciaInmersiva = document.createElement("div")
                            contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                            const contenidoAdvertenciaInmersiva = document.createElement("div")
                            contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                            contenidoAdvertenciaInmersiva.setAttribute("espacio", "gestionTitular")
                            const mensajeSpinner = "Esperando al servidor...."
                            const spinner = casaVitini.ui.componentes.spinner(mensajeSpinner)
                            contenidoAdvertenciaInmersiva.appendChild(spinner)
                            contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                            advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                            document.querySelector("main").appendChild(advertenciaInmersivaIU)
                            const transaccion = {
                                zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                                reservaUID: reservaUID,
                                capas: [
                                    "titular"
                                ]
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                const detallesTitular = respuestaServidor.ok.titular

                                const tipoTitularIDV = detallesTitular?.tipoTitularIDV
                                const seleccionarInstanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                if (seleccionarInstanciaRenderizada) {
                                    seleccionarInstanciaRenderizada.querySelector("[contenedor=spinner]")?.remove()
                                    seleccionarInstanciaRenderizada.style.justifyContent = "flex - start";
                                    const destinoRenderizado = seleccionarInstanciaRenderizada.querySelector("[espacio=gestionTitular]")
                                    if (!tipoTitularIDV) {
                                        const titulo = "AÃ±adir titular a la reserva"
                                        const tituloUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.titulo(titulo)
                                        destinoRenderizado.appendChild(tituloUI)
                                        const info = "Esta reserva ahora mismo no tiene ningÃºn titular asignado.Para aÃ±adir un titular a la reserva, puedes buscar con el campo de bÃºsqueda inferior un cliente existente para asociarlo como titular.TambiÃ©n puedes crear un cliente nuevo rellenando el formulario para crear un cliente y aÃ±adirlo como titular a esta reserva."
                                        const infoUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.infoUI(info)
                                        destinoRenderizado.appendChild(infoUI)

                                        const buscadorUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.UI({
                                            instanciaUID
                                        })
                                        destinoRenderizado.appendChild(buscadorUI)

                                        const nuevoClienteUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.nuevoCliente.UI({
                                            instanciaUID
                                        })
                                        destinoRenderizado.appendChild(nuevoClienteUI)
                                        const botonCerrar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCerrar()
                                        destinoRenderizado.appendChild(botonCerrar)
                                    } else if (tipoTitularIDV === "titularCliente") {

                                        const metadatosRespuestaUnificada = {
                                            clienteUID: detallesTitular.clienteUID,
                                            nombreCompleto: detallesTitular.nombreTitular,
                                            pasaporte: detallesTitular.pasaporteTitular,
                                            mailTitular: detallesTitular.mailTitular,
                                            telefonoTitular: detallesTitular.telefonoTitular,
                                            instanciaUID: instanciaUID,
                                            reservaUID: reservaUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                    } else if (tipoTitularIDV === "titularPool") {
                                        const metadatosTitualPool = {
                                            nombreTitular: detallesTitular.nombreTitular,
                                            pasaporteTitular: detallesTitular.pasaporteTitular,
                                            mailTitular: detallesTitular.mailTitular,
                                            telefonoTitular: detallesTitular.telefonoTitular,
                                            instanciaUID: instanciaUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.titularPool.UI(metadatosTitualPool)
                                    }
                                }
                            }
                        },
                        componentes: {
                            buscadorRapido: {
                                UI: function (data) {
                                    const instanciaUID = data.instanciaUID

                                    if (!instanciaUID) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        const error = "El componente buscador en casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.UI necesita la instancia que la invoca"
                                        return casaVitini.ui.componentes.advertenciaInmersiva(error)
                                    }
                                    const contenedor = document.createElement("div")
                                    contenedor.classList.add("administracion_reservas_detallesReservas_gestionTitular_contenedorBuscador")
                                    contenedor.setAttribute("contenedor", "buscador")
                                    const info = document.createElement("div")
                                    info.classList.add("adminsitracion_reservas_detallesReservas_gestionTitular_infoBuscador")
                                    //contenedor.appendChild(info)
                                    const campoBuscador = document.createElement("input")
                                    campoBuscador.classList.add("administracion_reservas_detallesReserva_gestionTitular_campoBuscador")
                                    campoBuscador.placeholder = "Buscar un cliente existente"
                                    campoBuscador.setAttribute("instanciaUID", instanciaUID)
                                    campoBuscador.setAttribute("campo", "buscador")
                                    campoBuscador.addEventListener("input", (e) => {
                                        this.listaResultadosUI({
                                            e,
                                        })
                                    })
                                    contenedor.appendChild(campoBuscador)
                                    return contenedor
                                },
                                listaResultadosUI: async (data) => {
                                    const elemento = data.e
                                    const tipoIndividuo = data.tipoIndividuo
                                    const terminoBusqueda = elemento.target.value
                                    const instanciaUIDContenedor = elemento.target.getAttribute("instanciaUID")
                                    const instanciaUIDBuscador = casaVitini.utilidades.codigoFechaInstancia()
                                    if (!instanciaUIDContenedor) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        const error = "El componente buscador en casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.motor necesita la instancia que la invoca"
                                        casaVitini.ui.vista.advertenciaInmersiva(error)
                                    }
                                    const alturaDinamica = window.scrollY + elemento.target.getBoundingClientRect().bottom;
                                    const horizontalDinamico = elemento.target.offsetLeft;
                                    const anchoDinamico = elemento.target.getBoundingClientRect().width;
                                    const selectorListaResultadosBuscadorRapidoRenderiaza = document.querySelectorAll("[componente=buscadorRapidoCliente]")
                                    selectorListaResultadosBuscadorRapidoRenderiaza.forEach((listaRenderizada) => {
                                        listaRenderizada.remove()
                                    })
                                    const campoVacio = elemento.target.value.length

                                    if (campoVacio === 0) {
                                        clearTimeout(casaVitini.componentes.temporizador);
                                        document.querySelector(`[instanciaUID="${instanciaUIDContenedor}"]`).querySelector(`[instanciaUIDBuscador]`)?.remove()
                                        return
                                    }
                                    const listaResultados = document.createElement("div")
                                    listaResultados.setAttribute("componente", "buscadorRapidoCliente")
                                    listaResultados.setAttribute("instanciaUIDBuscador", instanciaUIDBuscador)
                                    listaResultados.classList.add("administracion_reservas_detallesReservas_gestionTitular_listaBuscador")
                                    listaResultados.style.top = (alturaDinamica + 4) + "px"
                                    //listaResultados.style.marginLeft = (horizontalDinamico + 4) + "px"
                                    listaResultados.style.marginLeft = "0px"
                                    listaResultados.style.width = anchoDinamico + "px"
                                    listaResultados.innerText = null
                                    const info = document.createElement("p")
                                    info.classList.add("infoBuscando")
                                    info.setAttribute("componente", "info")
                                    info.innerText = "Buscando..."
                                    listaResultados.appendChild(info)
                                    document.addEventListener("mousedown", (e) => {
                                        if (e.target.getAttribute("componente") === "elementoResultadosBuscadorRapido") {
                                            e.preventDefault()
                                        }
                                    })
                                    const instanciaUIDRenderizada = document.querySelector(`[instanciaUID="${instanciaUIDContenedor}"] [contenedor=buscador]`)
                                    instanciaUIDRenderizada.appendChild(listaResultados)
                                    clearTimeout(casaVitini.componentes.temporizador);
                                    casaVitini.componentes.temporizador = setTimeout(() => {
                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.transactor({
                                            terminoBusqueda: terminoBusqueda,
                                            instanciaUIDBuscador: instanciaUIDBuscador,
                                            instanciaUIDContenedor: instanciaUIDContenedor,
                                        })
                                    }, 1500);
                                },
                                transactor: async (data) => {
                                    const instanciaUIDBuscador = data.instanciaUIDBuscador
                                    const terminoBusqueda = data.terminoBusqueda
                                    const instanciaUIDContenedor = data.instanciaUIDContenedor
                                    const transaccion = {
                                        zona: "administracion/clientes/buscar",
                                        tipoBusqueda: "rapido",
                                        buscar: terminoBusqueda
                                    }
                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                                    const listaBuscadorRenderizada = document.querySelector(`[instanciaUIDBuscador="${instanciaUIDBuscador}"]`)
                                    if (!listaBuscadorRenderizada) {
                                        return
                                    }
                                    if (respuestaServidor?.error) {
                                        return listaBuscadorRenderizada.querySelector("[componente=info]").innerHTML = respuestaServidor?.error
                                    }
                                    const resultadosClientes = respuestaServidor?.clientes
                                    if (resultadosClientes.length === 0) {
                                        return listaBuscadorRenderizada.querySelector("[componente=info]").innerHTML = "Nada encontrado"
                                    }
                                    listaBuscadorRenderizada.innerHTML = null

                                    resultadosClientes.forEach((clienteEncontrado) => {
                                        const clienteUID = clienteEncontrado.clienteUID
                                        const nombre = clienteEncontrado.nombre
                                        const primerApellido = clienteEncontrado.primerApellido
                                        const segundoApellido = clienteEncontrado.segundoApellido
                                        const pasaporte = clienteEncontrado.pasaporte
                                        const bloqueCliente = document.createElement("div")
                                        bloqueCliente.classList.add("administracionReservaDetallesBuscadorRapidoBloqueCliente")
                                        bloqueCliente.setAttribute("clienteUID", clienteUID)
                                        bloqueCliente.setAttribute("nombreUI", nombre)
                                        bloqueCliente.setAttribute("primerApellidoUI", primerApellido)
                                        bloqueCliente.setAttribute("segundoApellidoUI", segundoApellido)
                                        bloqueCliente.setAttribute("pasaporte", pasaporte)
                                        bloqueCliente.setAttribute("componente", "elementoResultadosBuscadorRapido")

                                        bloqueCliente.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.asociarCliente({
                                                clienteUID: clienteUID,
                                                instanciaUIDContenedor: instanciaUIDContenedor
                                            })
                                        })



                                        const filaNombre = document.createElement("p")
                                        filaNombre.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaNombre")
                                        filaNombre.innerText = `${nombre} ${primerApellido} ${segundoApellido}`
                                        filaNombre.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                        bloqueCliente.appendChild(filaNombre)
                                        const filaPasaporte = document.createElement("p")
                                        filaPasaporte.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaPasaporte")
                                        filaPasaporte.innerText = pasaporte
                                        filaPasaporte.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                        bloqueCliente.appendChild(filaPasaporte)
                                        listaBuscadorRenderizada.appendChild(bloqueCliente)
                                    })
                                },
                                asociarCliente: async (data) => {
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const clienteUID = data.clienteUID
                                    const instanciaUIDContenedor = data.instanciaUIDContenedor
                                    const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                    const opcionesPantallaDeCarga = {
                                        instanciaUID: instanciaUIDPantallaDeCarga,
                                        mensaje: "Asociando cliente a la titularidad de esta reserva"
                                    }
                                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                    const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)

                                    const respuestaServidor = await casaVitini.shell.servidor({
                                        zona: "administracion/reservas/detallesReserva/gestionTitular/asociarTitular",
                                        clienteUID: String(clienteUID),
                                        reservaUID: reservaUID
                                    })

                                    if (respuestaServidor?.error) {
                                        pantallaDeCargaRenderizada?.remove()
                                        casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        //casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        pantallaDeCargaRenderizada?.remove()
                                        const nuevoClienteUID = respuestaServidor.clienteUID
                                        const nombreCompleto = respuestaServidor.nombreCompleto
                                        const nombre = respuestaServidor.nombre
                                        const primerApellido = respuestaServidor.primerApellido
                                        const segundoApellido = respuestaServidor.segundoApellido
                                        const clienteUID = respuestaServidor.clienteUID
                                        const mail = respuestaServidor.mail
                                        const pasaporte = respuestaServidor.pasaporte
                                        const telefono = respuestaServidor.telefono
                                        const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                        const selectorNombreTitular = document.querySelector(`[dataReserva=nombreTitular]`)
                                        if (selectorNombreTitularRenderizado && selectorNombreTitular) {
                                            selectorNombreTitular.innerText = nombreCompleto
                                            const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                            selectorBloqueTitular.setAttribute("tipoTitular", "titularCliente")
                                            selectorBloqueTitular.setAttribute("titularUID", nuevoClienteUID)
                                        }
                                        const metadatosRespuestaUnificada = {
                                            clienteUID: clienteUID,
                                            nombreCompleto: nombreCompleto,
                                            pasaporte: pasaporte,
                                            mailTitular: mail,
                                            telefonoTitular: telefono,
                                            instanciaUID: instanciaUIDContenedor,
                                            reservaUID: reservaUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                    }
                                }
                            },
                            nuevoCliente: {
                                UI: (data) => {
                                    const instanciaUID = data.instanciaUID

                                    const tituloNuevoCliente = "Crear un nuevo titular e insertarlo en la reserva"
                                    const tituloBotonCrear = "Crear cliente e insertarlo en la reserva como titular"

                                    const nuevoClienteUI = document.createElement("div")
                                    nuevoClienteUI.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI")
                                    nuevoClienteUI.setAttribute("formulario", "nuevoCliente")

                                    const info = document.createElement("p")
                                    info.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_info")
                                    info.classList.add("negrita")
                                    info.innerText = tituloNuevoCliente
                                    nuevoClienteUI.appendChild(info)
                                    const campoNombre = document.createElement("input")
                                    campoNombre.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                    campoNombre.setAttribute("campo", "nombre")
                                    campoNombre.setAttribute("formulario", "AnadirPernoctante")
                                    campoNombre.placeholder = "Nombre(obligatiorio)"
                                    nuevoClienteUI.appendChild(campoNombre)
                                    const primerApellido = document.createElement("input")
                                    primerApellido.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                    primerApellido.setAttribute("campo", "primerApellido")
                                    primerApellido.setAttribute("formulario", "AnadirPernoctante")
                                    primerApellido.placeholder = "Primer apellido"
                                    nuevoClienteUI.appendChild(primerApellido)
                                    const segundoApellido = document.createElement("input")
                                    segundoApellido.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                    segundoApellido.setAttribute("campo", "segundoApellido")
                                    segundoApellido.setAttribute("formulario", "AnadirPernoctante")
                                    segundoApellido.placeholder = "Segundo apellido"
                                    nuevoClienteUI.appendChild(segundoApellido)
                                    const pasaporte = document.createElement("input")
                                    pasaporte.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                    pasaporte.setAttribute("campo", "pasaporte")
                                    pasaporte.setAttribute("formulario", "AnadirPernoctante")
                                    pasaporte.placeholder = "Pasaporte(obligatorio)"
                                    nuevoClienteUI.appendChild(pasaporte)
                                    const telefono = document.createElement("input")
                                    telefono.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                    telefono.setAttribute("campo", "telefono")
                                    telefono.setAttribute("formulario", "AnadirPernoctante")
                                    telefono.placeholder = "TelÃ©fono"
                                    nuevoClienteUI.appendChild(telefono)
                                    const correoElecotronico = document.createElement("input")
                                    correoElecotronico.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                    correoElecotronico.setAttribute("campo", "correoElectronico")
                                    correoElecotronico.setAttribute("formulario", "AnadirPernoctante")
                                    correoElecotronico.placeholder = "Correo electrÃ³nico"
                                    nuevoClienteUI.appendChild(correoElecotronico)
                                    const botonGuardarNuevoCliente = document.createElement("div")
                                    botonGuardarNuevoCliente.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_botonV1")
                                    botonGuardarNuevoCliente.innerText = tituloBotonCrear

                                    botonGuardarNuevoCliente.addEventListener("click", () => {
                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.nuevoCliente.transactor(instanciaUID)
                                    })


                                    nuevoClienteUI.appendChild(botonGuardarNuevoCliente)
                                    return nuevoClienteUI
                                },
                                transactor: async (instanciaUID) => {
                                    const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                    const opcionesPantallaDeCarga = {
                                        instanciaUID: instanciaUIDPantallaDeCarga,
                                        mensaje: "Asociando cliente a la titularidad de esta reserva"
                                    }
                                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                    const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const campos = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`).querySelectorAll("[campo]")
                                    const metadatos = {
                                        zona: "administracion/reservas/detallesReserva/gestionTitular/crearTitular",
                                        reservaUID: String(reservaUID)
                                    }
                                    campos.forEach((campo) => {
                                        const nombreCampo = campo.getAttribute("campo")
                                        const valorCampo = campo.value
                                        metadatos[nombreCampo] = valorCampo
                                    })
                                    const respuestaServidor = await casaVitini.shell.servidor(metadatos)
                                    if (respuestaServidor?.error) {
                                        pantallaDeCargaRenderizada?.remove()
                                        casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        //casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        pantallaDeCargaRenderizada?.remove()

                                        const nuevoClienteUID = respuestaServidor.clienteUID
                                        const nombreCompleto = respuestaServidor.nombreCompleto
                                        const clienteUID = respuestaServidor.clienteUID
                                        const mail = respuestaServidor.mail
                                        const telefono = respuestaServidor.telefono
                                        const pasaporte = respuestaServidor.pasaporte
                                        const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                        const selectorNombreTitular = document.querySelector(`[dataReserva=nombreTitular]`)
                                        if (selectorNombreTitularRenderizado && selectorNombreTitular) {
                                            selectorNombreTitular.innerText = nombreCompleto
                                            const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                            selectorBloqueTitular.setAttribute("tipoTitular", "titularCliente")
                                            selectorBloqueTitular.setAttribute("titularUID", nuevoClienteUID)
                                        }
                                        const metadatosRespuestaUnificada = {
                                            clienteUID: clienteUID,
                                            nombreCompleto: nombreCompleto,
                                            pasaporte: pasaporte,
                                            mailTitular: mail,
                                            telefonoTitular: telefono,
                                            instanciaUID: instanciaUID,
                                            reservaUID: reservaUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                    }
                                }
                            },
                            desasociarClienteComoTitular: async (metadatos) => {
                                const instanciaUID = metadatos.instanciaUID
                                const reservaUID = metadatos.reservaUID
                                const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                const opcionesPantallaDeCarga = {
                                    instanciaUID: instanciaUIDPantallaDeCarga,
                                    mensaje: "Desasociando cliente como titular de la reserva"
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                const metadatosPantallaDeCarga = {
                                    zona: "administracion/reservas/detallesReserva/gestionTitular/desasociarClienteComoTitular",
                                    reservaUID: String(reservaUID)
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(metadatosPantallaDeCarga)
                                if (respuestaServidor?.error) {
                                    pantallaDeCargaRenderizada?.remove()
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    pantallaDeCargaRenderizada?.remove()
                                    const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`).querySelector(`[dataReserva=nombreTitular]`)
                                    if (selectorNombreTitularRenderizado) {
                                        selectorNombreTitularRenderizado.innerText = "(NÃ­ngun titular asignado)"
                                        const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                        selectorBloqueTitular.removeAttribute("tipoTitular")
                                        selectorBloqueTitular.removeAttribute("titularUID")
                                    }
                                    const selectorDestinoRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"] [espacio=gestionTitular]`)
                                    if (selectorDestinoRenderizado) {
                                        selectorDestinoRenderizado.innerHTML = null
                                        const titulo = "AÃ±adir titular a la reserva"
                                        const tituloUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.titulo(titulo)
                                        selectorDestinoRenderizado.appendChild(tituloUI)
                                        const info = "Esta reserva ahora mismo no tiene ningÃºn titular asignado.Para aÃ±adir un titular a la reserva, puedes buscar con el campo de bÃºsqueda inferior un cliente existente para asociarlo como titular.TambiÃ©n puedes crear un cliente nuevo rellenando el formulario para crear un cliente y aÃ±adirlo como titular a esta reserva."
                                        const infoUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.infoUI(info)
                                        selectorDestinoRenderizado.appendChild(infoUI)
                                        const buscadorUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.UI({
                                            instanciaUID
                                        })
                                        selectorDestinoRenderizado.appendChild(buscadorUI)
                                        const nuevoClienteUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.nuevoCliente.UI({
                                            instanciaUID
                                        })
                                        selectorDestinoRenderizado.appendChild(nuevoClienteUI)
                                        const botonCerrar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCerrar()
                                        selectorDestinoRenderizado.appendChild(botonCerrar)
                                    }
                                }
                            },
                            detallesDelTitularUI: (detallesDelTitular) => {
                                const clienteUID = detallesDelTitular.clienteUID
                                const nombreTitular = detallesDelTitular.nombreTitular
                                const pasaporteTitular = detallesDelTitular.pasaporteTitular
                                const tipoTitular = detallesDelTitular.tipoTitular
                                const mailTitular = detallesDelTitular.mailTitular ? detallesDelTitular.mailTitular : "(Sin mail)"
                                const telefonoTitular = detallesDelTitular.telefonoTitular ? detallesDelTitular.telefonoTitular : "(Sin TelÃ©fono)"
                                const detallesRapidosDelTitular = document.createElement("div")
                                detallesRapidosDelTitular.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedorGlobal")
                                //Nombre completo titular
                                let contenedorDato = document.createElement("div")
                                contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                let nombreDato = document.createElement("div")
                                nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                nombreDato.innerText = "Nombre completo del titular"
                                contenedorDato.appendChild(nombreDato)
                                let valorDato = document.createElement("div")
                                valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                valorDato.classList.add("negrita")
                                valorDato.innerText = nombreTitular
                                contenedorDato.appendChild(valorDato)
                                detallesRapidosDelTitular.appendChild(contenedorDato)
                                //Pasaporte titular
                                contenedorDato = document.createElement("div")
                                contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                nombreDato = document.createElement("div")
                                nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                nombreDato.innerText = "Pasaporte"
                                contenedorDato.appendChild(nombreDato)
                                valorDato = document.createElement("div")
                                valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                valorDato.classList.add("negrita")
                                valorDato.innerText = pasaporteTitular
                                contenedorDato.appendChild(valorDato)
                                detallesRapidosDelTitular.appendChild(contenedorDato)
                                //telefono titular
                                contenedorDato = document.createElement("div")
                                contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                nombreDato = document.createElement("div")
                                nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                nombreDato.innerText = "TelÃ©fono"
                                contenedorDato.appendChild(nombreDato)
                                valorDato = document.createElement("div")
                                valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                valorDato.classList.add("negrita")
                                valorDato.innerText = telefonoTitular
                                contenedorDato.appendChild(valorDato)
                                detallesRapidosDelTitular.appendChild(contenedorDato)
                                //mail titular
                                contenedorDato = document.createElement("div")
                                contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                nombreDato = document.createElement("div")
                                nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                nombreDato.innerText = "e - Mail"
                                contenedorDato.appendChild(nombreDato)
                                valorDato = document.createElement("div")
                                valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                valorDato.classList.add("negrita")
                                valorDato.innerText = mailTitular
                                contenedorDato.appendChild(valorDato)
                                detallesRapidosDelTitular.appendChild(contenedorDato)
                                return detallesRapidosDelTitular
                            },
                            detallesDelTitularPoolUI: (detallesDelTitular) => {
                                const nombreTitular = detallesDelTitular.nombreTitular
                                const pasaporteTitular = detallesDelTitular.pasaporteTitular
                                const tipoTitular = "Titular pool"
                                const mailtular = detallesDelTitular.mailTitular ? detallesDelTitular.mailTitular : "(Sin mail)"
                                const telefonoTitular = detallesDelTitular.telefonoTitular ? detallesDelTitular.telefonoTitular : "(Sin TelÃ©fono)"
                                const detallesRapidosDelTitular = document.createElement("div")
                                detallesRapidosDelTitular.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedorGlobal")
                                //Nombre completo titular
                                let contenedorDato = document.createElement("div")
                                contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                let nombreDato = document.createElement("div")
                                nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                nombreDato.innerText = "Nombre completo del titular"
                                contenedorDato.appendChild(nombreDato)
                                let valorDato = document.createElement("div")
                                valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                valorDato.classList.add("negrita")
                                valorDato.innerText = nombreTitular
                                contenedorDato.appendChild(valorDato)
                                detallesRapidosDelTitular.appendChild(contenedorDato)
                                //Pasaporte titular
                                contenedorDato = document.createElement("div")
                                contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                nombreDato = document.createElement("div")
                                nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                nombreDato.innerText = "Pasaporte"
                                contenedorDato.appendChild(nombreDato)
                                valorDato = document.createElement("div")
                                valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                valorDato.classList.add("negrita")
                                valorDato.innerText = pasaporteTitular
                                contenedorDato.appendChild(valorDato)
                                detallesRapidosDelTitular.appendChild(contenedorDato)
                                //telefono titular
                                contenedorDato = document.createElement("div")
                                contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                nombreDato = document.createElement("div")
                                nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                nombreDato.innerText = "TelÃ©fono"
                                contenedorDato.appendChild(nombreDato)
                                valorDato = document.createElement("div")
                                valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                valorDato.classList.add("negrita")
                                valorDato.innerText = telefonoTitular
                                contenedorDato.appendChild(valorDato)
                                detallesRapidosDelTitular.appendChild(contenedorDato)
                                //mail titular
                                contenedorDato = document.createElement("div")
                                contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                nombreDato = document.createElement("div")
                                nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                nombreDato.innerText = "e - Mail"
                                contenedorDato.appendChild(nombreDato)
                                valorDato = document.createElement("div")
                                valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                valorDato.classList.add("negrita")
                                valorDato.innerText = mailtular
                                contenedorDato.appendChild(valorDato)
                                detallesRapidosDelTitular.appendChild(contenedorDato)
                                return detallesRapidosDelTitular
                            },
                            botonCerrarFormularioNuevoCliente: () => {
                                const boton = document.createElement("div")
                                boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                boton.innerHTML = "Cerrar gestiÃ³n del titular de la reserva"
                                boton.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                boton
                            },
                            botonCerrar: () => {
                                const boton = document.createElement("div")
                                boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                boton.innerHTML = "Cerrar gestiÃ³n del titular de la reserva"
                                boton.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                return boton
                            },
                            botonDesasociar: (metadatos) => {
                                const boton = document.createElement("div")
                                boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                boton.innerHTML = "Desasociar cliente como titular"
                                boton.setAttribute("boton", "desasociarTitular")
                                boton.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.desasociarClienteComoTitular(metadatos)
                                })
                                return boton
                            },
                            botonCambiarTitular: (instanciaUID) => {
                                const boton = document.createElement("div")
                                boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                boton.innerHTML = "Cambiar titular"
                                boton.setAttribute("boton", "cambiarTitular")
                                boton.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.cambiarTitular(instanciaUID)
                                })
                                return boton
                            },
                            botonIrALaFichaDelClinete: (clienteUID) => {
                                const boton = document.createElement("a")
                                boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                boton.innerHTML = "Ir a la ficha del cliente"
                                boton.setAttribute("href", "/administracion/clientes/" + clienteUID)
                                boton.setAttribute("vista", "/administracion/clientes/" + clienteUID)
                                boton.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                return boton
                            },
                            titulo: (titulo) => {
                                const tituloUI = document.createElement("p")
                                tituloUI.classList.add("detallesReservaTituloCancelarReserva")
                                tituloUI.innerText = titulo
                                return tituloUI
                            },
                            infoUI: (info) => {
                                const infoUI = document.createElement("p")
                                infoUI.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                infoUI.innerText = info
                                return infoUI
                            },
                            botonCerrarCambiarTitular: (instanciaUID) => {
                                const boton = document.createElement("div")
                                boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                boton.innerHTML = "Cerrar formulario para cambiar de titular"
                                boton.setAttribute("boton", "cerrarCambiarTitular")
                                boton.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.cancelarCambiarTitular(instanciaUID)
                                })
                                return boton
                            },
                            cambiarTitular: (instanciaUID) => {
                                const selectorBotonCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cambiarTitular]`)
                                const selectorBotonDesasociar = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=desasociarTitular]`)
                                selectorBotonCambiarTitular.style.display = "none"
                                selectorBotonDesasociar.style.display = "none"
                                const selectorNuevoClienteUI = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`)
                                selectorNuevoClienteUI.removeAttribute("style")
                                const selectorBuscadorRapidoClienteUI = document.querySelector(`[instanciaUID="${instanciaUID}"] [contenedor=buscador]`)
                                selectorBuscadorRapidoClienteUI.removeAttribute("style")
                                const selectorbotonCerrarCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cerrarCambiarTitular]`)
                                selectorbotonCerrarCambiarTitular.removeAttribute("style")
                            },
                            respuestaUnificadaUI: (metadatos) => {
                                const clienteUID = metadatos.clienteUID
                                const nombreCompleto = metadatos.nombreCompleto
                                const pasaporte = metadatos.pasaporte
                                const mailTitular = metadatos.mailTitular
                                const telefono = metadatos.telefonoTitular
                                const instanciaUID = metadatos.instanciaUID
                                const reservaUID = metadatos.reservaUID
                                const selectorDestinoRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"] [espacio=gestionTitular]`)
                                if (selectorDestinoRenderizado) {
                                    selectorDestinoRenderizado.innerHTML = null
                                    const titulo = "Detalles del titular"
                                    const tituloUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.titulo(titulo)
                                    selectorDestinoRenderizado.appendChild(tituloUI)
                                    const info = "Vista rÃ¡pida de los detalles del titular de la reserva.Puedes cambiar el titular de la reserva si lo necesitas o desasociar el titular.TambiÃ©n puedes cambiar el titular, esto te permite rellenar los datos mientras ves los datos del actual titular por si fuera necesario."
                                    const infoUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.infoUI(info)
                                    selectorDestinoRenderizado.appendChild(infoUI)
                                    const detallesDelTitular = {
                                        clienteUID: clienteUID,
                                        nombreTitular: nombreCompleto,
                                        pasaporteTitular: pasaporte,
                                        tipoTitular: "titularCliente",
                                        mailTitular: mailTitular,
                                        telefonoTitular: telefono,
                                    }
                                    const detallesDelTitularUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.detallesDelTitularUI(detallesDelTitular)
                                    selectorDestinoRenderizado.appendChild(detallesDelTitularUI)
                                    const botonIrALaFichaDelClinete = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonIrALaFichaDelClinete(detallesDelTitular.clienteUID)
                                    selectorDestinoRenderizado.appendChild(botonIrALaFichaDelClinete)
                                    const botonCambiarTitular = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCambiarTitular(instanciaUID)
                                    selectorDestinoRenderizado.appendChild(botonCambiarTitular)
                                    const buscadorUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.UI({
                                        instanciaUID
                                    })
                                    buscadorUI.style.display = "none"

                                    selectorDestinoRenderizado.appendChild(buscadorUI)

                                    const nuevoClienteUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.nuevoCliente.UI({
                                        instanciaUID
                                    })
                                    nuevoClienteUI.style.display = "none"
                                    selectorDestinoRenderizado.appendChild(nuevoClienteUI)
                                    const metadatosBotonDesasociar = {
                                        instanciaUID: instanciaUID,
                                        reservaUID: reservaUID
                                    }
                                    const botonCerrarCambiarTitular = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCerrarCambiarTitular(instanciaUID)
                                    botonCerrarCambiarTitular.style.display = "none"
                                    selectorDestinoRenderizado.appendChild(botonCerrarCambiarTitular)
                                    const botonDesasociar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonDesasociar(metadatosBotonDesasociar)
                                    selectorDestinoRenderizado.appendChild(botonDesasociar)
                                    const botonCerrar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCerrar()
                                    selectorDestinoRenderizado.appendChild(botonCerrar)
                                }
                            },
                            cancelarCambiarTitular: (instanciaUID) => {
                                const selectorBotonCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cambiarTitular]`)
                                const selectorBotonDesasociar = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=desasociarTitular]`)
                                selectorBotonCambiarTitular.removeAttribute("style")
                                selectorBotonDesasociar.removeAttribute("style")
                                const selectorNuevoClienteUI = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`)
                                selectorNuevoClienteUI.style.display = "none"
                                const selectorBuscadorRapidoClienteUI = document.querySelector(`[instanciaUID="${instanciaUID}"] [contenedor=buscador]`)
                                selectorBuscadorRapidoClienteUI.style.display = "none"
                                const selectorbotonCerrarCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cerrarCambiarTitular]`)
                                selectorbotonCerrarCambiarTitular.style.display = "none"
                            },
                            titularPool: {
                                UI: async (metadatos) => {
                                    const nombreTitular = metadatos.nombreTitular
                                    const pasaporteTitular = metadatos.pasaporteTitular
                                    const mailTitular = metadatos.mailTitular
                                    const telefonoTitular = metadatos.telefonoTitular
                                    const tipoTitular = metadatos.tipoTitular
                                    const instanciaUID = metadatos.instanciaUID
                                    const selectorDestinoRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"] [espacio=gestionTitular]`)
                                    if (selectorDestinoRenderizado) {
                                        const titulo = "Datos del titular no verificado (POOL)"
                                        const tituloUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.titulo(titulo)
                                        selectorDestinoRenderizado.appendChild(tituloUI)
                                        const info = "Vista de los datos del titular Pool.Estos datos provienen del cliente.Por lo tanto, deben de verificarse con la base de datos de clientes."
                                        const infoUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.infoUI(info)
                                        selectorDestinoRenderizado.appendChild(infoUI)
                                        const detallesDelTitular = {
                                            //clienteUID: clienteUID,
                                            nombreTitular: nombreTitular,
                                            pasaporteTitular: pasaporteTitular,
                                            tipoTitular: "titularCliente",
                                            mailTitular: mailTitular,
                                            telefonoTitular: telefonoTitular,
                                        }
                                        const detallesDelTitularUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.detallesDelTitularUI(detallesDelTitular)
                                        selectorDestinoRenderizado.appendChild(detallesDelTitularUI)
                                        const info2 = "Primero usÃ© en el campo de bÃºsqueda para ver si existe ya una ficha del cliente para poder asociarlo.Si no existiera la ficha del cliente, puede crear una en el formulario de abajo.Si selecciona un cliente existente o crea una nueva ficha del cliente, desde aquÃ­, se asociarÃ¡ automÃ¡ticamente como titular de esta reserva."
                                        const infoUI2 = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.infoUI(info2)
                                        selectorDestinoRenderizado.appendChild(infoUI2)

                                        const buscadorUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.UI({
                                            instanciaUID
                                        })
                                        selectorDestinoRenderizado.appendChild(buscadorUI)

                                        const nuevoClienteUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.nuevoCliente.UI({
                                            instanciaUID
                                        })


                                        selectorDestinoRenderizado.appendChild(nuevoClienteUI)
                                        const botonCerrar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCerrar()
                                        selectorDestinoRenderizado.appendChild(botonCerrar)
                                    }
                                    //Obtenemos datos
                                }
                            }
                        }
                    },
                    estado: {
                        aceptarReserva: async function (data) {
                            const reservaUID = data.reservaUID
                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                            const instanciaUID_aceptarReserva = pantallaInmersiva.getAttribute("instanciaUID")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = `Confirmas que aceptas la reserva ${reservaUID}`
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = "AAl confirmar una reserva pendiente, cambiarÃ¡s el estado de pendiente.Ha confirmado.La reserva dejarÃ¡ de ser visible desde la secciÃ³n de reservas confirmadas.Si necesitas volver a poner la reserva en estado pendiente, pulsa en el estado de la reserva para poder cambiarla."

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = "Comfirmar y aceptar reserva"
                            botonAceptar.addEventListener("click", () => {
                                this.confirmarNuevoEstado({
                                    reservaUID,
                                    instanciaUID_aceptarReserva,
                                    nuevoEstado: "confirmada"
                                })
                            })
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar y volver"
                            document.querySelector("main").appendChild(pantallaInmersiva)

                        },
                        rechazarReserva: async function (data) {
                            const reservaUID = data.reservaUID
                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()

                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                            const instanciaUID_aceptarReserva = pantallaInmersiva.getAttribute("instanciaUID")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = `Confirmas que rechazas la reserva ${reservaUID}`
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = "Rechazar una reserva implica cancelar la reserva."

                            const botonRechazar = constructor.querySelector("[boton=aceptar]")
                            botonRechazar.innerText = "Rechazar reserva"
                            botonRechazar.addEventListener("click", (e) => {
                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.confirmaCancelacion({
                                    tipoBloqueoIDV: "sinBloqueo"
                                })
                            })

                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cerrar y volver"
                            document.querySelector("main").appendChild(pantallaInmersiva)

                        },
                        ponerReservaEnPendiente: async function (data) {
                            const reservaUID = data.reservaUID
                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                            const instanciaUID_aceptarReserva = pantallaInmersiva.getAttribute("instanciaUID")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = `Confirmas que aceptas la reserva ${reservaUID}`
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = "Al confirmar una reserva pendiente, cambiarÃ¡s el estado de pendiente.Ha confirmado.La reserva dejarÃ¡ de ser visible desde la secciÃ³n de reservas confirmadas.Si necesitas volver a poner la reserva en estado pendiente, pulsa en el estado de la reserva para poder cambiarla"

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = "Comfirmar y aceptar reserva"
                            botonAceptar.addEventListener("click", () => {
                                this.confirmarNuevoEstado({
                                    reservaUID,
                                    instanciaUID_aceptarReserva,
                                    nuevoEstado: "pendiente"
                                })
                            })
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar y volver"
                            document.querySelector("main").appendChild(pantallaInmersiva)

                        },
                        confirmarNuevoEstado: async function (data) {
                            const reservaUID = data.reservaUID
                            const nuevoEstado = data.nuevoEstado
                            const instanciaUID_aceptarReserva = data.instanciaUID_aceptarReserva

                            const ui = document.querySelector(`[instanciaUID="${instanciaUID_aceptarReserva}"]`)
                            const contenedor = ui.querySelector("[componente=constructor]")
                            contenedor.innerHTML = null

                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Aceptando reserva un momento por favor..."
                            })
                            contenedor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/reservas/detallesReserva/global/actualizarEstadoReserva",
                                reservaUID: String(reservaUID),
                                nuevoEstado
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const uiRenderizada = document.querySelector(`[reservaUID="${reservaUID}"]`)
                            if (!uiRenderizada) { return }
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas();

                            if (respuestaServidor?.error) {
                                return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                const estadoUI = uiRenderizada.querySelector("[dataReserva=estado]")
                                const contenedorPendienteUI = uiRenderizada.querySelector("[contenedor=pendiente]")
                                const estadoActual = respuestaServidor.estadoActual


                                if (estadoActual === "pendiente") {
                                    estadoUI.innerText = "Pendiente"
                                    estadoUI.setAttribute("estadoReservaIDV", "pendiente")
                                    contenedorPendienteUI.style.display = "grid"

                                }
                                if (estadoActual === "confirmada") {
                                    estadoUI.innerText = "Confirmada"
                                    estadoUI.setAttribute("estadoReservaIDV", "confirmada")
                                    contenedorPendienteUI.style.display = "none"
                                }

                            }

                        },
                        panelExpandidoUI: async function (data) {
                            const reservaUID = data.reservaUID
                            const estadoActual = data.estadoActual

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                            const instanciaUID_aceptarReserva = pantallaInmersiva.getAttribute("instanciaUID")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = `Estado de la reserva ${reservaUID}`
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")

                            if (estadoActual === "confirmada") {
                                mensaje.innerText = "El estado actual de la reserva es confirmado.Si se necesita, puedes cambiar el estado de esta reserva a pendiente.Esto permitirÃ¡ insertar la reserva en reservas pendientes de revisiÃ³n"

                                const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                botonAceptar.innerText = "Pasar el estado de esta reserva a pendiente de revisiÃ³n"
                                botonAceptar.addEventListener("click", () => {
                                    this.confirmarNuevoEstado({
                                        reservaUID,
                                        instanciaUID_aceptarReserva,
                                        nuevoEstado: "pendiente"
                                    })
                                })
                            } else
                                if (estadoActual === "pendiente") {
                                    mensaje.innerText = "El estado de esta reserva es pendiente, en este estado es recomendable revisar la reserva para tomar la decisiÃ³n de aceptarla o rechazarla.Es recomendable revisar las reservas pendientes y aceptar o rechazarlas para mantener la lista de reservas pendientes sin saturar."
                                    const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                    botonAceptar.innerText = "Aceptar reserva"
                                    botonAceptar.addEventListener("click", () => {
                                        this.confirmarNuevoEstado({
                                            reservaUID,
                                            instanciaUID_aceptarReserva,
                                            nuevoEstado: "confirmada"
                                        })
                                    })
                                } else if (estadoActual === "cancelada") {
                                    titulo.innerText = `La reserva ${reservaUID} esta cancelada`
                                    mensaje.innerText = "Esta reserva estÃ¡ cancelada.Las reservas canceladas no pueden revertir su estado.Puede eliminar definitivamente la reserva de la base de datos para que no estÃ© almacenada desde el apartado de cancelar reserva dentro de la reserva."

                                    const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                    botonAceptar.remove()
                                }

                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar y volver"
                            document.querySelector("main").appendChild(pantallaInmersiva)

                        }
                    },
                    categorias: {
                        desplegarMenuResponsivo: (reservaUID) => {
                            const advertenciaInmersivaIU = document.createElement("div")
                            advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                            advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                            advertenciaInmersivaIU.setAttribute("contenedor", "menuResponsivoDesplegado")
                            const contenedorAdvertenciaInmersiva = document.createElement("div")
                            contenedorAdvertenciaInmersiva.classList.add("administracion_reservas_detallesReservas_contenedorAdvertencaiInmersiva")
                            const contenidoAdvertenciaInmersiva = document.createElement("div")
                            contenidoAdvertenciaInmersiva.classList.add("adminsitracion_reservas_detallesReserva_contenedorGlobalResponsivo")
                            contenidoAdvertenciaInmersiva.setAttribute("contenedor", "contenidoAdvertenciaInmersiva")
                            const contenedor = document.createElement("div")
                            contenedor.classList.add("administracion_reservas_detallesReservas_contenedorBotonesEnPanelGlobalResponsivo")
                            //divBotones.appendChild(botonAplicarDescuento);
                            const botonCerrar = document.createElement("a");
                            botonCerrar.setAttribute("class", "adminitracion_reservas_DetallesReserva_botonCategoria");
                            botonCerrar.textContent = "Cerrar";
                            botonCerrar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                            contenedor.appendChild(botonCerrar);
                            const metadatosMenuResponsivo = {
                                rectangularidad: "vertical",
                                reservaUID: reservaUID
                            }
                            const contenedorBotonesCategoriasGlobales = casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.categoriasGlobalesBotonesUI(metadatosMenuResponsivo)
                            contenedor.appendChild(contenedorBotonesCategoriasGlobales)
                            contenidoAdvertenciaInmersiva.appendChild(contenedor)
                            contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                            advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                            document.querySelector("main").appendChild(advertenciaInmersivaIU)
                            //bug
                            //const selectorPreRenderizacion = contenedor
                            //    .querySelector("[contenedor=menuResponsivoDesplegado]")
                            //    .querySelector("[componete=panelDetallesReserva]")
                        },
                        ocultaCategorias: () => {
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas();
                            casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias()
                            document.querySelector("[componente=contenedorDinamico]").innerHTML = null
                        },
                        limpiarMenusCategorias: () => {
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas();
                            document.querySelector("[componente=iconoLineaMiscelanea]").removeAttribute("style")
                            const botonesCategoria = document.querySelectorAll("[categoriaReserva]")
                            botonesCategoria.forEach((boton) => {
                                boton.removeAttribute("style")
                                boton.setAttribute("estadoCategoria", "otra")
                            })
                            document.querySelector("[componente=contenedorDinamico]").innerHTML = null
                        },
                        categoriasGlobalesBotonesUI: (metadatos) => {
                            const rectangularidad = metadatos.rectangularidad
                            const reservaUID = metadatos.reservaUID
                            let css
                            if (rectangularidad === "horizontal") {
                                css = "administracion_reserva_detallesReserva_marcoMenuExpandido_horizontal"
                            }
                            if (rectangularidad === "vertical") {
                                css = "administracion_reserva_detallesReserva_marcoMenuExpandido_vertical"
                            }
                            const divBotones = document.createElement("div");
                            divBotones.setAttribute("class", css);
                            divBotones.setAttribute("componente", "panelDetallesReserva")
                            //Crear el primer botÃ³n: p.botonSimpleV2 - AÃ±adir apartamento
                            const botonNuevaReserva = document.createElement("a");
                            botonNuevaReserva.setAttribute("class", "adminitracion_reservas_DetallesReserva_botonCategoria");
                            botonNuevaReserva.setAttribute("categoriaReserva", "alojamiento");
                            botonNuevaReserva.setAttribute("href", "/administracion/reservas/reserva:" + reservaUID + "/alojamiento");
                            botonNuevaReserva.addEventListener("click", (e) => {
                                e.preventDefault()
                                const metadatos = {
                                    categoria: "alojamiento",
                                    origen: "botonCategoria",
                                    reservaUID: reservaUID
                                }
                                casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.controladorCategorias(metadatos)
                            })
                            botonNuevaReserva.textContent = "Alojamiento";
                            divBotones.appendChild(botonNuevaReserva);
                            //Crear el tercer botÃ³n: p.botonSimpleV2 - Calcular precio
                            const botonCalcularPrecio = document.createElement("a");
                            botonCalcularPrecio.setAttribute("class", "adminitracion_reservas_DetallesReserva_botonCategoria");
                            botonCalcularPrecio.setAttribute("componente", "botonCalcularPrecioReserva");
                            botonCalcularPrecio.setAttribute("categoriaReserva", "enlacesDePago");
                            botonCalcularPrecio.setAttribute("href", "/administracion/reservas/reserva:" + reservaUID + "/enlaces_de_pago");
                            botonCalcularPrecio.addEventListener("click", (e) => {
                                e.preventDefault()
                                const metadatos = {
                                    categoria: "enlacesDePago",
                                    origen: "botonCategoria",
                                    reservaUID: reservaUID
                                }
                                casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.controladorCategorias(metadatos)
                            })
                            botonCalcularPrecio.textContent = "Enlaces de pago";
                            divBotones.appendChild(botonCalcularPrecio);
                            //divBotones.appendChild(botonAplicarDescuento);
                            const botonDetallesDelPago = document.createElement("a");
                            botonDetallesDelPago.setAttribute("class", "adminitracion_reservas_DetallesReserva_botonCategoria");
                            botonDetallesDelPago.setAttribute("categoriaReserva", "transacciones");
                            botonDetallesDelPago.setAttribute("href", "/administracion/reservas/reserva:" + reservaUID + "/transacciones");
                            botonDetallesDelPago.textContent = "Transacciones";
                            botonDetallesDelPago.addEventListener("click", (e) => {
                                e.preventDefault()
                                const metadatos = {
                                    categoria: "transacciones",
                                    origen: "botonCategoria",
                                    reservaUID: reservaUID
                                }
                                casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.controladorCategorias(metadatos)
                            })
                            divBotones.appendChild(botonDetallesDelPago);
                            //divBotones.appendChild(botonAplicarDescuento);
                            const botonEnlacePago = document.createElement("a");
                            botonEnlacePago.setAttribute("class", "adminitracion_reservas_DetallesReserva_botonCategoria");
                            botonEnlacePago.setAttribute("categoriaReserva", "desgloseTotal");
                            botonEnlacePago.setAttribute("href", "/administracion/reservas/reserva:" + reservaUID + "/desglose_total");
                            botonEnlacePago.innerText = "Desglose del total";
                            botonEnlacePago.addEventListener("click", (e) => {
                                e.preventDefault()
                                const metadatos = {
                                    categoria: "desgloseTotal",
                                    origen: "botonCategoria",
                                    reservaUID: reservaUID
                                }
                                casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.controladorCategorias(metadatos)
                            })
                            divBotones.appendChild(botonEnlacePago);
                            const botonServicios = document.createElement("a");
                            botonServicios.setAttribute("class", "adminitracion_reservas_DetallesReserva_botonCategoria");
                            botonServicios.setAttribute("categoriaReserva", "servicios");
                            botonServicios.setAttribute("href", "/administracion/reservas/reserva:" + reservaUID + "/servicios");
                            botonServicios.innerText = "Servicios";
                            botonServicios.addEventListener("click", (e) => {
                                e.preventDefault()
                                const metadatos = {
                                    categoria: "servicios",
                                    origen: "botonCategoria",
                                    reservaUID: reservaUID
                                }
                                casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.controladorCategorias(metadatos)
                            })
                            divBotones.appendChild(botonServicios);
                            //Crear el quinto botÃ³n: p.botonSimpleV2 - Cancelar reserva
                            const botonCancelarReserva = document.createElement("a");
                            botonCancelarReserva.setAttribute("class", "adminitracion_reservas_DetallesReserva_botonCategoria");
                            botonCancelarReserva.setAttribute("categoriaReserva", "cancelarReserva");
                            botonCancelarReserva.setAttribute("href", "/administracion/reservas/reserva:" + reservaUID + "/cancelar_reserva");
                            botonCancelarReserva.addEventListener("click", (e) => {
                                e.preventDefault()
                                const metadatos = {
                                    categoria: "cancelarReserva",
                                    origen: "botonCategoria",
                                    reservaUID: reservaUID
                                }
                                casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.controladorCategorias(metadatos)
                            })
                            botonCancelarReserva.textContent = "Cancelar reserva";
                            divBotones.appendChild(botonCancelarReserva);
                            const botonMiscelanea = document.createElement("a");
                            botonMiscelanea.setAttribute("class", "adminitracion_reservas_DetallesReserva_botonCategoria");
                            botonMiscelanea.setAttribute("categoriaReserva", "miscelanea");
                            botonMiscelanea.setAttribute("href", "/administracion/reservas/reserva:" + reservaUID + "/miscelanea");
                            botonMiscelanea.addEventListener("click", (e) => {
                                e.preventDefault()
                                const metadatos = {
                                    categoria: "miscelanea",
                                    origen: "botonCategoria",
                                    reservaUID: reservaUID
                                }
                                casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.controladorCategorias(metadatos)
                            })
                            const lineaMiscelanea = document.createElement("div")
                            lineaMiscelanea.setAttribute("componente", "iconoLineaMiscelanea")
                            lineaMiscelanea.classList.add("administracion_reservas_detallesReseerva_iconoMiscelanea")
                            //lineaMiscelanea.setAttribute("href", "/administracion/reservas/" + reservaUID + "/alojamiento");
                            botonMiscelanea.appendChild(lineaMiscelanea);
                            divBotones.appendChild(botonMiscelanea);
                            //Anadir divBotones al div principal
                            return divBotones;
                        },
                        controladorCategorias: async (metadatos) => {
                            const origen = metadatos.origen
                            const categoriaALaQueIr = metadatos.categoria
                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")

                            const selectorBotonCategoriaRenderizado = document.querySelector(`[categoriaReserva="${categoriaALaQueIr}"]`)
                            const estadoCategoria = selectorBotonCategoriaRenderizado?.getAttribute("estadoCategoria")
                            const categoriaActual = document.querySelector("[estadoCategoria=actual]")?.getAttribute("categoriaReserva")
                            const funcionPersonalizada = `casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.${categoriaALaQueIr}.arranque`
                            //casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias()
                            const constructorDireccionFuncion = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales[categoriaALaQueIr]?.arranque
                            if (typeof constructorDireccionFuncion === "function") {
                                await casaVitini.administracion.reservas.detallesReserva.categoriasGlobales[categoriaALaQueIr]?.arranque();
                                const granuladoURL = casaVitini.utilidades.granuladorURL()
                                const posicionReservaUID = granuladoURL.directorios.findIndex(directorio => directorio === "reservas") + 1;
                                const directoriosFusionLimpios = []
                                granuladoURL.directorios.forEach((directorio, indice) => {
                                    if (indice <= posicionReservaUID) {
                                        directoriosFusionLimpios.push(directorio)
                                    }
                                })

                                const posicionCategoriaGlobalInicial = (posicionReservaUID + 1)
                                const categoriaGlobalInicial = granuladoURL.directorios[posicionCategoriaGlobalInicial]
                                const tranformadorASnakeCase = categoriaALaQueIr.replace(/[A-Z]/g, palabra => `_${palabra.toLowerCase()}`);


                                //const directoriosFusion = "/" + directoriosFusionLimpios.join("/") + "/reserva:" + reservaUID + "/" + tranformadorASnakeCase

                                const directoriosFusion = "/administracion/reservas/reserva:" + reservaUID + "/" + tranformadorASnakeCase
                                const componentesExistenteUID = "reservaUID_" + reservaUID
                                const titulo = "Casa Vitini"

                                const estado = {
                                    zona: directoriosFusion,
                                    EstadoInternoZona: "estado",
                                    tipoCambio: "parcial",
                                    componenteExistente: componentesExistenteUID,
                                    funcionPersonalizada: funcionPersonalizada
                                }
                                if (!categoriaActual) {
                                    //
                                    // window.history.replaceState(estado, titulo, directoriosFusion);
                                }
                                if (categoriaALaQueIr !== categoriaActual) {
                                    if (origen === "url") {
                                        window.history.replaceState(estado, titulo, directoriosFusion);
                                    }
                                    if (origen === "botonCategoria" && (estadoCategoria === "otra" || !estadoCategoria)) {
                                        window.history.pushState(estado, titulo, directoriosFusion);
                                    }
                                    if (origen === "botonCategoria" && estadoCategoria === "actual") {
                                        window.history.replaceState(estado, titulo, directoriosFusion);
                                    }
                                }
                            } else {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                const mensaje = "El controlador de categorÃ­as no encuentra la funciÃ³n"
                                casaVitini.ui.componentes.advertenciaInmersiva(mensaje)
                            }
                        },
                    },
                    actualizarReservaRenderizada: async () => {
                        const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                        const instanciaUID = document.querySelector("main").getAttribute("instanciaUID")
                        const selectorEstadoPago = document.querySelector("[dataReserva=estadoPago]")
                        const selectorTotalConImpuestos = document.querySelector("[dataReserva=totalReservaConImpuestos]")
                        selectorEstadoPago.innerText = "Obteniendo..."
                        selectorTotalConImpuestos.innerText = "Recalculando..."

                        const instanciaUID_paraSelectores = casaVitini.utilidades.codigoFechaInstancia()
                        selectorTotalConImpuestos.setAttribute("instanciaUID", instanciaUID_paraSelectores)

                        // Por cojones hay que isertar un identificador UNICO e UNIVERSARL a estao del pago y TOTAL, para peticiones variables en distintos tiempos



                        const transaccion = {
                            zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                            reservaUID: String(reservaUID),
                            capas: [
                                "titular",
                                "desgloseFinanciero"
                            ]
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const selectorUIRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_paraSelectores}"]`)
                        if (!selectorUIRenderizada) {
                            return
                        }
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {

                            const porcentajeTranscurrido = respuestaServidor.ok.global.porcentajeTranscurrido
                            const estadoPago = respuestaServidor.ok.global.estadoPagoIDV
                            const estadoPagoUI = {
                                pagado: "Pagado",
                                noPagado: "No pagado",
                                pagadoSuperadamente: "Pagado superadamente",
                                pagadoParcialmente: "Pagado parcialmente"
                            }
                            const totalConImpuestos = respuestaServidor.ok.contenedorFinanciero.desgloseFinanciero?.global?.totales?.totalFinal ?
                                respuestaServidor.ok.contenedorFinanciero.desgloseFinanciero?.global?.totales?.totalFinal + "$" :
                                "Sin informaciÃ³n"
                            selectorEstadoPago.innerText = estadoPagoUI[estadoPago]
                            selectorTotalConImpuestos.innerText = totalConImpuestos
                            const section = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            const selectorListaDePagosRenderizada = section.querySelector("[contenedorID=transacciones]")
                            const selectorDesgloseFinancieroUIRenderizado = section.querySelector("[componente=contenedorDesgloseTotal]")
                            const selectorProgreso = section.querySelector("[componente=progreso]")
                            selectorProgreso.style.width = porcentajeTranscurrido + "%"

                            if (selectorListaDePagosRenderizada) {
                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.actualizarDatosGlobalesPago({
                                    reservaUID
                                })
                            }
                            if (selectorDesgloseFinancieroUIRenderizado) {
                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                    reservaUID
                                })
                            }

                        }
                    },
                    rechazarReserva: {
                        UI: (metadatos) => {
                            const reservaUID = metadatos.reservaUID
                            const origen = metadatos.origen
                            const e = metadatos.e
                            const uiRenderizada = e.target.closest("[componente=advertenciaInmersiva]")

                            const contenedor = uiRenderizada.querySelector("[componente=constructor]")

                            contenedor.innerHTML = null

                            const instanciaUID_listaReservasPendientes = metadatos.instanciaUID_listaReservasPendientes
                            uiRenderizada.style.transition = "background 500ms"
                            uiRenderizada.style.background = "rgba(255, 0, 0, 0.3)"

                            const instanciaUID_opcionesReserva = uiRenderizada.getAttribute("instanciaUID")
                            const contenedorCancelacion = document.createElement("div")
                            contenedorCancelacion.classList.add("administracion_reservas_detallesReservas_cancelarReserva_contenedorCancelacion")
                            const tituloCancelarReserva = document.createElement("p")
                            tituloCancelarReserva.classList.add("detallesReservaTituloCancelarReserva")
                            tituloCancelarReserva.innerText = "Rechazar y eliminar la reserva " + reservaUID
                            tituloCancelarReserva.style.color = "red"
                            contenedorCancelacion.appendChild(tituloCancelarReserva)
                            const botonCancelarProcesoCancelacion = document.createElement("div")
                            botonCancelarProcesoCancelacion.classList.add("detallesReservaCancelarBoton")
                            botonCancelarProcesoCancelacion.innerText = "Cerrar y volver atras"
                            botonCancelarProcesoCancelacion.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                            contenedorCancelacion.appendChild(botonCancelarProcesoCancelacion)
                            const bloqueBloqueoApartamentos = document.createElement("div")
                            bloqueBloqueoApartamentos.classList.add(
                                "flexVertical",
                                "gap6"
                            )
                            const tituloBloquoApartamentos = document.createElement("div")
                            tituloBloquoApartamentos.classList.add(
                                "padding10"
                            )
                            // tituloBloquoApartamentos.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                            tituloBloquoApartamentos.innerText = "Rechazar la reserva elimina la reserva del sistema y libera los apartamentos, haciÃ©ndolos de nuevo disponibles para reservas.Para rechazar la reserva y eliminarla irreversiblemente junto con toda su informaciÃ³n relacionada, debe escribir su contraseÃ±a de usuario y su cuenta debe tener autorizaciÃ³n administrativa."
                            bloqueBloqueoApartamentos.appendChild(tituloBloquoApartamentos)
                            const campo = document.createElement("input")
                            campo.classList.add("administracion_reserva_detallesReserva_cancelarReserva_eliminarReserva_campo")
                            campo.setAttribute("campo", "clave")
                            campo.type = "password"
                            campo.placeholder = "Escriba la contraseÃ±a de su VitiniID"
                            bloqueBloqueoApartamentos.appendChild(campo)
                            contenedorCancelacion.appendChild(bloqueBloqueoApartamentos)
                            const bloqueBotones = document.createElement("div")
                            bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                            const botonCancelar = document.createElement("div")
                            botonCancelar.classList.add("administracion_reserva_detallesReserva_cancelarReserva_eliminarReserva_botonV1")
                            botonCancelar.setAttribute("componente", "botonConfirmarCancelarReserva")
                            botonCancelar.innerText = "Eliminar la reserva irreversiblemente."
                            botonCancelar.addEventListener("click", () => {
                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.eliminarReservaIrreversiblemente.confirmar({
                                    reservaUID,
                                    instanciaUID: instanciaUID_opcionesReserva,
                                    origen
                                })
                            })
                            bloqueBloqueoApartamentos.appendChild(botonCancelar)
                            contenedorCancelacion.appendChild(bloqueBotones)
                            contenedor.appendChild(contenedorCancelacion)
                        },
                    },


                },
                categoriasGlobales: {
                    alojamiento: {
                        arranque: async () => {
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias()
                            document.querySelector(`[categoriaReserva=alojamiento]`).setAttribute("estadoCategoria", "actual")
                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const botonAlojamiento = document.querySelector("[categoriaReserva=alojamiento]")
                            botonAlojamiento.style.background = "blue"
                            botonAlojamiento.style.color = "white"
                            const contenedorDinamico = document.querySelector("[componente=contenedorDinamico]")
                            contenedorDinamico.innerHTML = null

                            const marcoAlojamiento = document.createElement("div");
                            marcoAlojamiento.setAttribute("class", "reservaDetallesBloqueAlojamineto");
                            marcoAlojamiento.setAttribute("componente", "marcoAlojamiento");
                            marcoAlojamiento.setAttribute("instanciaUID", instanciaUID)
                            const mensajeSpinner = "Esperando a Casa Vitini..."
                            const spinnerPorRenderizar = casaVitini.ui.componentes.spinnerSimple(mensajeSpinner)
                            marcoAlojamiento.appendChild(spinnerPorRenderizar)
                            contenedorDinamico.appendChild(marcoAlojamiento)
                            const transaccion = {
                                zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                                reservaUID: reservaUID,
                                capas: [
                                    "alojamiento",
                                    "pernoctantes",
                                ]
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaDestino = document.querySelector(`[componente=marcoAlojamiento][instanciaUID="${instanciaUID}"]`)
                            if (!instanciaDestino) { }
                            instanciaDestino.innerHTML = null

                            if (respuestaServidor?.error) {
                                const errorUI = document.createElement("p")
                                errorUI.classList.add("errorCategorialGlobal")
                                errorUI.innerText = respuestaServidor?.error
                                instanciaDestino.appendChild(errorUI)
                            }
                            if (respuestaServidor?.ok) {
                                const detallesReserva = respuestaServidor.ok
                                const alojamiento = detallesReserva.alojamiento
                                const pernoctantes = detallesReserva.pernoctantes

                                const divPernoctantesSinAlojamiento = document.createElement("div");
                                divPernoctantesSinAlojamiento.setAttribute("class", "resertaDetallesPernoctantesSinAlojameinto elementoOcultoInicialmente");
                                divPernoctantesSinAlojamiento.setAttribute("componente", "espacioPernoctantesSinAlojamiento");
                                const tituloPernoctantesSinHabitacion = document.createElement("div")
                                tituloPernoctantesSinHabitacion.classList.add("administracion_reservas_detallesReservas_tituloPernoctantesSinHabitacion")
                                tituloPernoctantesSinHabitacion.innerText = "Pernoctantes asociados a esta reserva sin habitaciÃ³n asignada"
                                divPernoctantesSinAlojamiento.appendChild(tituloPernoctantesSinHabitacion)
                                const contenedorPernoctantesSinHabitacion = document.createElement("div")
                                contenedorPernoctantesSinHabitacion.classList.add("administracion_reservas_detallesReserva_contenedorPernoctantesSinHabitacion")
                                contenedorPernoctantesSinHabitacion.setAttribute("componente", "contenedorPernoctantesSinHabitacion");
                                divPernoctantesSinAlojamiento.appendChild(contenedorPernoctantesSinHabitacion)
                                instanciaDestino.appendChild(divPernoctantesSinAlojamiento)
                                const contenedorAlojamientoUI = document.createElement("div")
                                contenedorAlojamientoUI.classList.add("administracionReservaDetallesBloqueContendioAlojamiento")
                                contenedorAlojamientoUI.setAttribute("componente", "contenedorIntermedioAlojamiento")
                                const botonAnadirApartamento = document.createElement("p");
                                botonAnadirApartamento.setAttribute("class", "adminitracion_reservas_DetallesReserva_botonCategoria");
                                botonAnadirApartamento.setAttribute("componenteBoton", "anadirApartamento");
                                botonAnadirApartamento.setAttribute("componente", "menuDesplegable");
                                botonAnadirApartamento.addEventListener("click",
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.abrirMenuReservas)
                                botonAnadirApartamento.textContent = "AÃ±adir apartamento";
                                contenedorAlojamientoUI.appendChild(botonAnadirApartamento)
                                const espacioAlojamiento = document.createElement("div")
                                espacioAlojamiento.classList.add("reservasDetallesBloqueAlojamiennto")
                                espacioAlojamiento.setAttribute("componente", "espacioAlojamiento")
                                instanciaDestino.appendChild(contenedorAlojamientoUI)
                                instanciaDestino.appendChild(espacioAlojamiento)
                                for (const [apartamentoIDV, configuracionApartamento] of Object.entries(alojamiento)) {
                                    const apartamentoUID = configuracionApartamento.apartamentoUID
                                    const apartamentoUI = configuracionApartamento.apartamentoUI
                                    const configuracionesHabitacion = configuracionApartamento.habitaciones

                                    const apartamentoComponenteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.apatamentoUI({
                                        apartamentoIDV: apartamentoIDV,
                                        apartamentoUID: apartamentoUID,
                                        apartamentoUI: apartamentoUI
                                    })
                                    const apartamentoTituloComponenteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.apartamentoTituloUI({
                                        apartamentoIDV: apartamentoIDV,
                                        apartamentoUID: apartamentoUID,
                                        apartamentoUI: apartamentoUI
                                    })
                                    apartamentoComponenteUI.appendChild(apartamentoTituloComponenteUI)
                                    delete configuracionApartamento.uid
                                    for (const [habitacionIDV, configuracionHabitacion] of Object.entries(configuracionesHabitacion)) {

                                        const habitacionUID = configuracionHabitacion.habitacionUID
                                        const habitacionUI = configuracionHabitacion.habitacionUI
                                        const camas = configuracionHabitacion.camas


                                        const habitacionComponenteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.habitacionUI({
                                            habitacionIDV: habitacionIDV,
                                            habitacionUID: habitacionUID,
                                            apartamentoIDV: apartamentoIDV,
                                            habitacionUI: habitacionUI,
                                        })

                                        const habitacionTituloComponenteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.habitacionTituloUI({
                                            habitacionIDV: habitacionIDV,
                                            habitacionUID: habitacionUID,
                                            apartamentoIDV: apartamentoIDV,
                                            habitacionUI: habitacionUI,
                                        })
                                        habitacionComponenteUI.appendChild(habitacionTituloComponenteUI)

                                        const camaComponenteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.camas.contenedorCamasUI({
                                            habitacionIDV: habitacionIDV,
                                            habitacionUI: habitacionUI,
                                            apartamentoUI: apartamentoUI,
                                            apartamentoIDV: apartamentoIDV,
                                            habitacionUID: habitacionUID,
                                            camas: camas,
                                            reservaUID: reservaUID
                                        })
                                        habitacionComponenteUI.appendChild(camaComponenteUI)

                                        apartamentoComponenteUI.appendChild(habitacionComponenteUI)
                                    }
                                    espacioAlojamiento.appendChild(apartamentoComponenteUI)
                                }

                                for (const detallesPernoctante of pernoctantes) {
                                    const tipoPernoctante = detallesPernoctante.tipoPernoctante
                                    const nombreCompleto = detallesPernoctante.nombreCompleto
                                    const pasaporte = detallesPernoctante.pasaporte
                                    const clienteUID = detallesPernoctante?.clienteUID
                                    const habitacionUID = detallesPernoctante?.habitacionUID
                                    const pernoctanteUID = detallesPernoctante.pernoctanteUID
                                    const fechaCheckIn = detallesPernoctante.fechaCheckIn
                                    const fechaCheckOutAdelantado = detallesPernoctante.fechaCheckOutAdelantado
                                    const metadatos = {
                                        tipoPernoctante,
                                        clienteUID,
                                        pernoctanteUID,
                                        fechaCheckIn,
                                        fechaCheckOutAdelantado,
                                        nombreCompleto,
                                        pasaporte
                                    }
                                    if (habitacionUID) {
                                        metadatos.estadoAlojamiento = "alojado"
                                    } else {
                                        metadatos.estadoAlojamiento = "noAlojado"
                                    }
                                    const bloquePernoctantes = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI(metadatos)

                                    const nombrePernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI(metadatos)
                                    bloquePernoctantes.appendChild(nombrePernoctante)
                                    const identificacionPernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI(metadatos)
                                    bloquePernoctantes.appendChild(identificacionPernoctante)

                                    if (habitacionUID) {
                                        const selectorHabitacionUID = document.querySelector(`[habitacionUID="${habitacionUID}"]`)
                                        selectorHabitacionUID.appendChild(bloquePernoctantes)
                                    } else {
                                        contenedorPernoctantesSinHabitacion.appendChild(bloquePernoctantes)
                                        divPernoctantesSinAlojamiento.classList.remove("elementoOcultoInicialmente")
                                    }
                                }
                                contenedorDinamico.appendChild(instanciaDestino)
                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.componentesUI.controlEspacioAlojamiento()
                            }
                        },
                        componentesUI: {
                            controlEspacioAlojamiento: () => {
                                const selectorMarcoAlojameinto = document.querySelector("[componente=marcoAlojamiento]")
                                const selectorApartamentos = document.querySelectorAll("[componente=marcoAlojamiento] [apartamentoIDV]")
                                if (selectorApartamentos.length > 0) {
                                    document.querySelector("[componente=infoSinAlojamiento]")?.remove()
                                } else {
                                    const infoNoAlojamiento = document.createElement("div")
                                    infoNoAlojamiento.classList.add("reservas_detalles_infoDesgloseNo")
                                    infoNoAlojamiento.setAttribute("componente", "infoSinAlojamiento")
                                    infoNoAlojamiento.innerText = "Esta reserva no contiene ningÃºn apartamento."
                                    selectorMarcoAlojameinto.appendChild(infoNoAlojamiento)
                                }
                            },
                            bannerReservaMenus: () => {
                                const main = document.querySelector("main")
                                const reservaUID = main.querySelector("[reservaUID]").getAttribute("reservaUID")

                                const banner = document.createElement("div")
                                banner.classList.add(
                                    "flexVertical",
                                    // "borderRadius12",
                                    // "backgroundGrey1",
                                    // "padding14"
                                )
                                const titulo = document.createElement("p")
                                titulo.innerText = "Reserva"
                                banner.appendChild(titulo)

                                const reservaUID_UI = document.createElement("p")
                                reservaUID_UI.classList.add(
                                    "negrita"
                                )
                                reservaUID_UI.innerText = reservaUID
                                banner.appendChild(reservaUID_UI)
                                return banner
                            },
                            bannerAlojamiento: (data) => {
                                const apartamentoUI = data.apartamentoUI
                                const apartamentoIDV = data.apartamentoIDV

                                const banner = document.createElement("div")
                                banner.classList.add(
                                    "flexVertical",
                                    // "borderRadius12",
                                    // "backgroundGrey1",
                                    // "padding14"
                                )
                                const titulo = document.createElement("p")
                                titulo.innerText = "Alojamiento"
                                banner.appendChild(titulo)

                                const habitacionUI = document.createElement("p")
                                habitacionUI.classList.add(
                                    "negrita"
                                )
                                habitacionUI.innerText = `${apartamentoUI} (${apartamentoIDV})`
                                banner.appendChild(habitacionUI)
                                return banner

                            },
                            bannerHabitacion: (data) => {
                                const habitacionUI = data.habitacionUI
                                const habitacionIDV = data.habitacionIDV

                                const banner = document.createElement("div")
                                banner.classList.add(
                                    "flexVertical",
                                    // "borderRadius12",
                                    // "backgroundGrey1",
                                    // "padding14"
                                )
                                const titulo = document.createElement("p")
                                titulo.innerText = "HabitaciÃ³n del alojamiento"
                                banner.appendChild(titulo)

                                const habitacionUI_UI = document.createElement("p")
                                habitacionUI_UI.classList.add(
                                    "negrita"
                                )
                                habitacionUI_UI.innerText = `${habitacionUI} (${habitacionIDV})`
                                banner.appendChild(habitacionUI_UI)
                                return banner

                            }
                        },
                        habitaciones: {
                            habitacionUI: (metadatos) => {
                                const habitacionUI = document.createElement("div")
                                habitacionUI.classList.add("adminitracionReservasDetallesBloqueHabitacion")
                                habitacionUI.setAttribute("habitacionIDV", metadatos.habitacionIDV)
                                habitacionUI.setAttribute("habitacionUID", metadatos.habitacionUID)

                                return habitacionUI
                            },
                            habitacionTituloUI: function (metadatos) {
                                const habitacionUI = metadatos.habitacionUI
                                const habitacionIDV = metadatos.habitacionIDV
                                const habitacionTituloUI = document.createElement("div")
                                habitacionTituloUI.classList.add("adminitracionReservasDetallesTituloHabitacion")
                                habitacionTituloUI.setAttribute("componente", "menuDesplegable")
                                habitacionTituloUI.setAttribute("habitacionUI", habitacionUI)
                                habitacionTituloUI.addEventListener("click", (e) => {
                                    const habitacionUID = e.target.closest("[habitacionUID]").getAttribute("habitacionUID")
                                    const apartamentoUI = e.target.closest("[apartamentoUI]").getAttribute("apartamentoUI")
                                    const apartamentoIDV = e.target.closest("[apartamentoIDV]").getAttribute("apartamentoIDV")


                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.opcionesHabitacion({
                                        habitacionUID,
                                        habitacionUI,
                                        apartamentoUI,
                                        habitacionIDV,
                                        apartamentoIDV

                                    })
                                })
                                habitacionTituloUI.innerText = metadatos.habitacionUI
                                return habitacionTituloUI
                            },
                            selectorCambioHabitacionUI: (pernoctanteUID) => {
                                const selectorCambioHabitacionUI = document.createElement("div")
                                selectorCambioHabitacionUI.classList.add("reservaDetallesCambioPernoctante")
                                selectorCambioHabitacionUI.classList.add("parpadea")
                                selectorCambioHabitacionUI.setAttribute("componente", "botonMoverCliente")
                                selectorCambioHabitacionUI.innerText = "Cambiar aquÃ­ al pernoctante seleccionado"
                                selectorCambioHabitacionUI.addEventListener("click", (e) => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.cambiarDeHabitacion.cambiarPernoctanteHabitacion(pernoctanteUID, e)
                                })
                                return selectorCambioHabitacionUI
                            },
                            propuestaEliminarHabitacionUI: (datosEliminacion) => {
                                const opcionPernoctantes = datosEliminacion.opcionesPernoctantes
                                const habitacionUID = datosEliminacion.habitacionUID
                                const habitacionUI = document
                                    .querySelector(`[habitacionUID="${habitacionUID}"]`)
                                    .querySelector("[habitacionUI]")
                                    .getAttribute("habitacionUI")
                                let mensajeUI
                                if (opcionPernoctantes === "conservar") {
                                    mensajeUI = `Â¿Confirmas eliminar la ${habitacionUI} del apartamento pero conservar los pernoctantes de esta habitaciÃ³n en la reserva, en la zona de pernoctantes en la reserva sin alojamiento?`
                                }
                                if (opcionPernoctantes === "eliminar") {
                                    mensajeUI = `Â¿Confirmas eliminar la ${habitacionUI} del apartamento junto con los pernoctantes que contiene de la reserva?`
                                }
                                let botonMenajeUI
                                if (opcionPernoctantes === "eliminar") {
                                    botonMenajeUI = `Eliminar la ${habitacionUI} del apartamento y los pernoctantes que contiene de la reserva`
                                }
                                if (opcionPernoctantes === "conservar") {
                                    botonMenajeUI = `Eliminar la ${habitacionUI} del apartamento pero conservar a sus pernoctantes en la reserva`
                                }

                                const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                                const titulo = constructor.querySelector("[componente=titulo]")
                                titulo.innerText = "Confirmar la eliminaciÃ³n"
                                const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                mensaje.innerText = mensajeUI

                                const contenedorEspacio = constructor.querySelector("[componente=contenedor]")


                                const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                botonAceptar.innerText = botonMenajeUI
                                botonAceptar.addEventListener("click", () => {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const datosEliminacion = {
                                        habitacionUID: habitacionUID,
                                        opcionPernoctantes: opcionPernoctantes,
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.eliminarHabitacion(datosEliminacion)
                                })

                                const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                botonCancelar.innerText = "Cancelar la eliminaciÃ³n"

                                document.querySelector("main").appendChild(pantallaInmersiva)


                            },
                            opcionesHabitacion: async (data) => {
                                const main = document.querySelector("main")
                                const habitacionUID = data.habitacionUID
                                const habitacionUI = data.habitacionUI
                                const apartamentoUI = data.apartamentoUI
                                const apartamentoIDV = data.apartamentoIDV
                                const habitacionIDV = data.habitacionIDV


                                const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                main.appendChild(ui)
                                const contenedor = ui.querySelector("[componente=contenedor]")

                                const titulo = document.createElement("div")
                                titulo.classList.add(
                                    "titulo"
                                )
                                titulo.innerText = `Opciones de la ${habitacionUI} en ${apartamentoUI}`
                                contenedor.appendChild(titulo)


                                const banner = document.createElement("div")
                                banner.classList.add(
                                    "flexVertical",
                                    "borderRadius12",
                                    "backgroundGrey1",
                                    "padding14",
                                    "gap6"
                                )
                                contenedor.appendChild(banner)


                                const bannerReserva = casaVitini.
                                    administracion.
                                    reservas.
                                    detallesReserva.
                                    categoriasGlobales.
                                    alojamiento.
                                    componentesUI.
                                    bannerReservaMenus()
                                banner.appendChild(bannerReserva)

                                const bannerAlojamiento = casaVitini.
                                    administracion.
                                    reservas.
                                    detallesReserva.
                                    categoriasGlobales.
                                    alojamiento.
                                    componentesUI.
                                    bannerAlojamiento({
                                        apartamentoUI: apartamentoUI,
                                        apartamentoIDV: apartamentoIDV

                                    })
                                banner.appendChild(bannerAlojamiento)

                                const bannerHabitacion = casaVitini.
                                    administracion.
                                    reservas.
                                    detallesReserva.
                                    categoriasGlobales.
                                    alojamiento.
                                    componentesUI.
                                    bannerHabitacion({
                                        habitacionUI: habitacionUI,
                                        habitacionIDV: habitacionIDV

                                    })
                                banner.appendChild(bannerHabitacion)

                                const opcionAddPernoctante = document.createElement("p")
                                opcionAddPernoctante.classList.add("opcionCambioCama")
                                opcionAddPernoctante.innerText = `AÃ±adir pernoctante en la ${habitacionUI}`
                                opcionAddPernoctante.addEventListener("click", () => {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctante.nuevoPernoctanteUI({
                                        habitacionUID,
                                        habitacionUI,
                                        apartamentoUI,
                                        habitacionIDV,
                                        apartamentoIDV
                                    })
                                })
                                contenedor.appendChild(opcionAddPernoctante)


                                const infoElimiacion = document.createElement("p")
                                infoElimiacion.classList.add(
                                    "padding6"
                                )
                                infoElimiacion.innerText = "Opciones de eliminaciÃ³n de la habitaciÃ³n"
                                contenedor.append(infoElimiacion)

                                const opcionEliminarHabSinPernoc = document.createElement("p")
                                opcionEliminarHabSinPernoc.classList.add("opcionCambioCama")
                                opcionEliminarHabSinPernoc.innerText = `Eliminar la ${habitacionUI} pero mantener los pernoctantes que contiene asignados a esta reserva`
                                opcionEliminarHabSinPernoc.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.propuestaEliminarHabitacionUI({
                                        opcionesPernoctantes: "conservar",
                                        habitacionUID: habitacionUID
                                    })
                                })
                                contenedor.appendChild(opcionEliminarHabSinPernoc)


                                const eliminarHabYPernoc = document.createElement("p")
                                eliminarHabYPernoc.classList.add("opcionCambioCama")
                                eliminarHabYPernoc.innerText = `Eliminar la ${habitacionUI} y tambien los pernoctantes que contiene de la reserva`
                                eliminarHabYPernoc.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.propuestaEliminarHabitacionUI({
                                        opcionesPernoctantes: "eliminar",
                                        habitacionUID: habitacionUID
                                    })
                                })
                                contenedor.appendChild(eliminarHabYPernoc)

                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("boton")
                                botonCancelar.setAttribute("boton", "cancelar")
                                botonCancelar.innerText = "Cerrar y volver a la reserva"
                                botonCancelar.addEventListener("click", () => {
                                    return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                })
                                contenedor.appendChild(botonCancelar)
                            },
                            eliminarHabitacion: async (datosElimiacion) => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const habitacionUID = datosElimiacion.habitacionUID
                                const opcionPernoctantes = datosElimiacion.opcionPernoctantes
                                const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                const opcionesPantallaDeCarga = {
                                    instanciaUID: instanciaUIDPantallaDeCarga,
                                    mensaje: "Eliminando habitaciÃ³n..."
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                const pantallaDeCargaRenderizada = document
                                    .querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/alojamiento/eliminarHabitacionReserva",
                                    reservaUID: String(reservaUID),
                                    habitacionUID: String(habitacionUID),
                                    pernoctantes: opcionPernoctantes
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                pantallaDeCargaRenderizada?.remove()
                                if (respuestaServidor?.error) {
                                    if (!pantallaDeCargaRenderizada) {

                                    }
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    if (opcionPernoctantes === "eliminar") {
                                        document.querySelector(`[habitacionUID="${habitacionUID}"]`)?.remove()
                                    }
                                    if (opcionPernoctantes === "conservar") {
                                        const selectorPernoctantesHabitacion = document
                                            .querySelectorAll(`[habitacionUID="${habitacionUID}"] [tipoCliente]`)
                                        selectorPernoctantesHabitacion.forEach((pernoctanteSeleccionado) => {
                                            const nombreCompleto = pernoctanteSeleccionado.querySelector("[componente=nombreCompleto]").innerText
                                            const pasaporte = pernoctanteSeleccionado.querySelector("[componente=pasaporte]").innerText
                                            const tipoCliente = pernoctanteSeleccionado.getAttribute("tipoCliente")
                                            const pernoctanteUID = pernoctanteSeleccionado.getAttribute("pernoctanteUID")
                                            const clienteUID = pernoctanteSeleccionado.getAttribute("clienteUID")
                                            const fechaCheckIn = pernoctanteSeleccionado.getAttribute("fechaCheckIn")
                                            const fechaCheckOut = pernoctanteSeleccionado.getAttribute("fechaCheckOut")
                                            const datosPernoctante = {
                                                tipoPernoctante: tipoCliente,
                                                clienteUID: clienteUID,
                                                pernoctanteUID: pernoctanteUID,
                                                estadoAlojamiento: "noAlojado",
                                                fechaCheckIn: fechaCheckIn,
                                                fechaCheckOutAdelantado: fechaCheckOut
                                            }
                                            const bloquePernoctantes = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI(datosPernoctante)
                                            const datosNombre = {
                                                nombreCompleto: nombreCompleto,
                                            }
                                            const nombrePernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI(datosNombre)
                                            bloquePernoctantes.appendChild(nombrePernoctante)
                                            const datosPasaporte = {
                                                pasaporte: pasaporte,
                                            }
                                            const identificacionPernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI(datosPasaporte)
                                            bloquePernoctantes.appendChild(identificacionPernoctante)
                                            if (document.querySelector("[reservaUID]").getAttribute("reservaUID") === reservaUID) {
                                                const zonaDestino = document.querySelector(`[componente=contenedorPernoctantesSinHabitacion]`)
                                                zonaDestino.appendChild(bloquePernoctantes)
                                            }
                                        })
                                        document.querySelector(`[habitacionUID="${habitacionUID}"]`)?.remove()
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.controlEspacioPernoctantesSinAlojamiento()
                                }
                            },

                        },
                        apartamentos: {
                            apatamentoUI: (metadatos) => {
                                const apartamento = document.createElement("div")
                                apartamento.classList.add("adminitracionReservasDetallesBloqueApartamento")
                                apartamento.setAttribute("apartamentoIDV", metadatos.apartamentoIDV)
                                apartamento.setAttribute("apartamentoUID", metadatos.apartamentoUID)
                                apartamento.setAttribute("apartamentoUI", metadatos.apartamentoUI)
                                return apartamento
                            },
                            apartamentoTituloUI: (metadatos) => {
                                const apartamentoTitulo = document.createElement("div")
                                apartamentoTitulo.classList.add("administracionReservasDetallesTituloApartamento")
                                apartamentoTitulo.setAttribute("componente", "menuDesplegable")
                                apartamentoTitulo.innerText = metadatos.apartamentoUI
                                apartamentoTitulo.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.opcionesApartamento)
                                return apartamentoTitulo
                            },
                            propuestaEliminarApartamentoUI: (datosElimiacion) => {
                                //hacer propesta de eliminar apartamento
                                const apartamentoUID = datosElimiacion.apartamentoUID
                                const apartamentoUI = datosElimiacion.apartamentoUI
                                const tipoBloqueo = datosElimiacion.tipoBloqueo
                                let mensajeUI
                                if (tipoBloqueo === "sinBloqueo") {
                                    mensajeUI = `Â¿Confirmas eliminar el ${apartamentoUI} y liberarlo para que estÃ© disponible para reservar pÃºblicamente? Los pernoctantes de este apartamento no se eliminarÃ¡n de la reserva`
                                }
                                if (tipoBloqueo === "permanente") {
                                    mensajeUI = `Â¿Confirmas eliminar el ${apartamentoUI} y bloquearlo indefinidamente? (Hay desbloquearlo manualmente) Los pernoctantes de este apartamento no se eliminarÃ¡n de la reserva`
                                }
                                if (tipoBloqueo === "rangoTemporal") {
                                    mensajeUI = `Â¿Confirmas eliminar el ${apartamentoUI} y bloquearlo durante el mismo rango de fechas que esta reserva? Los pernoctantes de este apartamento no se eliminarÃ¡n de la reserva`
                                }
                                let botonMenajeUI
                                if (tipoBloqueo === "permanente") {
                                    botonMenajeUI = `Eliminar el ${apartamentoUI} de la reserva y bloquearlo indefinidamente`
                                }
                                if (tipoBloqueo === "sinBloqueo") {
                                    botonMenajeUI = `Eliminar la ${apartamentoUI} de la reserva y liberarlo para que se pueda reservas`
                                }
                                if (tipoBloqueo === "rangoTemporal") {
                                    botonMenajeUI = `Eliminar la ${apartamentoUI} de la reserva y bloquearlo durante el mismo rango que la reserva`
                                }



                                const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                                const titulo = constructor.querySelector("[componente=titulo]")
                                titulo.innerText = "Confirmar la eliminaciÃ³n"
                                const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                mensaje.innerText = mensajeUI

                                const contenedorEspacio = constructor.querySelector("[componente=contenedor]")

                                const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                botonAceptar.innerText = botonMenajeUI
                                botonAceptar.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.eliminarApartamento({
                                        apartamentoUID: apartamentoUID,
                                        tipoBloqueo: tipoBloqueo,
                                    })
                                })
                                const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                botonCancelar.innerText = "Cancelar la eliminaciÃ³n"

                                document.querySelector("main").appendChild(pantallaInmersiva)

                            },
                            abrirMenuReservas: async () => {
                                const main = document.querySelector("main")

                                const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                const instanciaUID = ui.getAttribute("instanciaUID")
                                const contenedor = ui.querySelector("[componente=contenedor]")
                                main.appendChild(ui)

                                const spinner = casaVitini.ui.componentes.spinnerSimple()
                                contenedor.appendChild(spinner)

                                const botonCerrar = document.createElement("div")
                                botonCerrar.classList.add(
                                    "botonV1",
                                    "comportamientoBoton"
                                )
                                botonCerrar.innerText = "Cerrar y volver"
                                botonCerrar.addEventListener("click", () => {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                })
                                contenedor.appendChild(botonCerrar)


                                const fechaEntrada = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                                const fechaSalida = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/alojamiento/apartamentosDisponiblesParaAnadirAReserva",
                                    fechaEntrada: fechaEntrada,
                                    fechaSalida: fechaSalida
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                contenedor.innerHTML = null

                                const botonCerrar1 = document.createElement("div")
                                botonCerrar1.classList.add(
                                    "botonV1",
                                    "comportamientoBoton"
                                )
                                botonCerrar1.innerText = "Cerrar y volver"
                                botonCerrar1.addEventListener("click", () => {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                })
                                contenedor.appendChild(botonCerrar1)

                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const apartamentosDisponibles = respuestaServidor?.ok.apartamentosDisponibles
                                    const apartamentosNoDisponibles = respuestaServidor?.ok.apartamentosNoDisponibles
                                    if (apartamentosDisponibles.length > 0) {
                                        const bloqueApartamentos = document.createElement("div")
                                        bloqueApartamentos.classList.add("reservaDetalles_menu_apartamentosDipsonbiles")
                                        const tituloApartamentoComponenteUIs = document.createElement("div")
                                        tituloApartamentoComponenteUIs.classList.add("reservaDetalles_menu_titutloapartamentosDisponibles")
                                        tituloApartamentoComponenteUIs.innerText = "Apartamentos disponibles"
                                        bloqueApartamentos.appendChild(tituloApartamentoComponenteUIs)
                                        for (const detallesApartamento of apartamentosDisponibles) {
                                            const apartamentoUI = document.createElement("div")
                                            apartamentoUI.classList.add("menuFlotanteOpcionAnadirApartamento")
                                            apartamentoUI.innerText = detallesApartamento.apartamentoUI
                                            apartamentoUI.addEventListener("click", (e) => {
                                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.anadirApartamento({

                                                    instanciaUID_contenedorUI: instanciaUID,
                                                    apartamentoIDV: detallesApartamento.apartamentoIDV
                                                })
                                            })
                                            bloqueApartamentos.appendChild(apartamentoUI)
                                        }
                                        contenedor.appendChild(bloqueApartamentos)
                                    }
                                    if (apartamentosNoDisponibles.length > 0) {
                                        const bloqueApartamentos = document.createElement("div")
                                        bloqueApartamentos.classList.add("reservaDetalles_menu_apartamentosNoDipsonbiles")
                                        const tituloApartamentoComponenteUIs = document.createElement("div")
                                        tituloApartamentoComponenteUIs.classList.add("reservaDetalles_menu_titutloapartamentosDisponibles")
                                        tituloApartamentoComponenteUIs.innerText = "Apartamentos no disponibles"
                                        bloqueApartamentos.appendChild(tituloApartamentoComponenteUIs)
                                        for (const detallesApartamento of apartamentosNoDisponibles) {
                                            const apartamentoUI = document.createElement("div")
                                            apartamentoUI.classList.add("menuFlotanteOpcionApartamentoNoDisponible")
                                            apartamentoUI.innerText = detallesApartamento.apartamentoUI
                                            bloqueApartamentos.appendChild(apartamentoUI)
                                        }
                                        contenedor.appendChild(bloqueApartamentos)
                                    }
                                }

                            },
                            opcionesApartamento: async (apartamento) => {

                                const main = document.querySelector("main")
                                const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                const reservaUID = main.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const instanciaUID = ui.getAttribute("instanciaUID")

                                main.appendChild(ui)
                                const contenedor = ui.querySelector("[componente=contenedor]")
                                const spinner = casaVitini.ui.componentes.spinner({
                                    mensaje: "Obteniendo las opciones del apartamento..."
                                })
                                contenedor.appendChild(spinner)

                                const contenedorApartmeanto = apartamento.target.closest("[apartamentoIDV]")
                                const apartamentoIDV = contenedorApartmeanto.getAttribute("apartamentoIDV")
                                const apartamentoUID = contenedorApartmeanto.getAttribute("apartamentoUID")
                                const apartamentoUI = apartamento.target.innerText

                                const respuestaServidor = await casaVitini.shell.servidor({
                                    zona: "administracion/reservas/detallesReserva/alojamiento/estadoHabitacionesApartamento",
                                    reservaUID: reservaUID,
                                    apartamentoUID: apartamentoUID
                                })
                                contenedor.innerHTML = null

                                const titulo = document.createElement("div")
                                titulo.classList.add(
                                    "titulo"
                                )
                                titulo.innerText = `Opciones del ${apartamentoUI}`
                                contenedor.appendChild(titulo)

                                const banner = document.createElement("div")
                                banner.classList.add(
                                    "flexVertical",
                                    "borderRadius12",
                                    "backgroundGrey1",
                                    "padding14",
                                    "gap6"
                                )
                                contenedor.appendChild(banner)


                                const bannerReserva = casaVitini.
                                    administracion.
                                    reservas.
                                    detallesReserva.
                                    categoriasGlobales.
                                    alojamiento.
                                    componentesUI.
                                    bannerReservaMenus()
                                banner.appendChild(bannerReserva)

                                const bannerAlojamiento = casaVitini.
                                    administracion.
                                    reservas.
                                    detallesReserva.
                                    categoriasGlobales.
                                    alojamiento.
                                    componentesUI.
                                    bannerAlojamiento({
                                        apartamentoUI: apartamentoUI,
                                        apartamentoIDV: apartamentoIDV
                                    })
                                banner.appendChild(bannerAlojamiento)


                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor.error)
                                }


                                const opcionesEliminacion = function (selector) {



                                    if (selector === "sinBloqueo") {
                                        const opcion = document.createElement("p")
                                        opcion.classList.add("opcionCambioCama")
                                        opcion.setAttribute("componente", "menuVolatil")
                                        opcion.innerText = `Eliminar ${apartamentoUI} y liberarlo para que este disponible para reservar`
                                        opcion.addEventListener("click", () => {
                                            casaVitini.shell.controladoresUI.limpiarTodoElementoFlotante()
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.propuestaEliminarApartamentoUI({
                                                apartamentoUID: apartamentoUID,
                                                apartamentoUI: apartamentoUI,
                                                tipoBloqueo: "sinBloqueo"
                                            })
                                        })
                                        return opcion
                                    }
                                    if (selector === "bloqueoPermanente") {
                                        const opcion = document.createElement("p")
                                        opcion.classList.add("opcionCambioCama")
                                        opcion.innerText = `Eliminar ${apartamentoUI} bloquearlo permanentemente. (DeberÃ¡ desbloquearlo manualmente el bloqueo permanente)`
                                        opcion.setAttribute("componente", "menuVolatil")
                                        opcion.addEventListener("click", () => {
                                            casaVitini.shell.controladoresUI.limpiarTodoElementoFlotante()
                                            const datosPropuestaElimiacion = {
                                                apartamentoUID: apartamentoUID,
                                                apartamentoUI: apartamentoUI,
                                                tipoBloqueo: "permanente"
                                            }
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.propuestaEliminarApartamentoUI(datosPropuestaElimiacion)
                                        })
                                        return opcion


                                    }
                                    if (selector === "bloqueoTemporal") {
                                        const opcion = document.createElement("p")
                                        opcion.classList.add("opcionCambioCama")
                                        opcion.setAttribute("componente", "menuVolatil")
                                        opcion.innerText = `Eliminar ${apartamentoUI} y mantenerlo bloqueado en el rango de fechas de esta reserva`
                                        opcion.addEventListener("click", () => {
                                            casaVitini.shell.controladoresUI.limpiarTodoElementoFlotante()
                                            const datosPropuestaElimiacion = {
                                                apartamentoUID: apartamentoUID,
                                                apartamentoUI: apartamentoUI,
                                                tipoBloqueo: "rangoTemporal"
                                            }
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.propuestaEliminarApartamentoUI(datosPropuestaElimiacion)
                                        })
                                        return opcion


                                    }
                                }
                                if (respuestaServidor?.info) {
                                    const opcionApartamento = document.createElement("p")
                                    opcionApartamento.classList.add("opcionDeInformacion")
                                    opcionApartamento.setAttribute("componente", "menuVolatil")
                                    opcionApartamento.innerText = respuestaServidor?.info
                                    contenedor.appendChild(opcionApartamento)

                                    const opcionSinBloqueo = opcionesEliminacion("sinBloqueo")
                                    contenedor.appendChild(opcionSinBloqueo)

                                }
                                if (respuestaServidor?.ok) {

                                    const habitacionesApartamento = respuestaServidor?.ok
                                    if (habitacionesApartamento.length === 0) {
                                        const opcionApartamento = document.createElement("p")
                                        opcionApartamento.classList.add(
                                            "padding6",
                                            "negrita"
                                        )
                                        opcionApartamento.innerText = `Este apartamento tiene ya todas las habitaciones implementadas en la reserva, segÃºn su configuraciÃ³n de alojamiento.`
                                        contenedor.appendChild(opcionApartamento)
                                    } else if (habitacionesApartamento.length > 0) {

                                        const infoHabitaciones = document.createElement("p")
                                        infoHabitaciones.classList.add(
                                            "padding6"
                                        )
                                        infoHabitaciones.innerText = `Lista de habitaciones disponbiles`
                                        contenedor.appendChild(infoHabitaciones)


                                        habitacionesApartamento.forEach((habitacion) => {
                                            const opcionApartamento = document.createElement("p")
                                            opcionApartamento.classList.add("opcionCambioCama")
                                            opcionApartamento.setAttribute("componente", "menuVolatil")
                                            opcionApartamento.innerText = `Anadir ${habitacion.habitacionUI}`
                                            opcionApartamento.addEventListener("click", async () => {

                                                const instanciaUID_pantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()

                                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta({
                                                    instanciaUID: instanciaUID_pantallaDeCarga,
                                                    mensaje: "Obteniendo habitaciÃ³nes..."
                                                })

                                                const transaccion = {
                                                    zona: "administracion/reservas/detallesReserva/alojamiento/anadirHabitacionAlApartamentoEnReserva",
                                                    reservaUID: String(reservaUID),
                                                    apartamentoUID: String(apartamentoUID),
                                                    habitacionIDV: habitacion.habitacionIDV
                                                }
                                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                                const pantallaDeCargaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_pantallaDeCarga}"]`)
                                                if (!pantallaDeCargaRenderizada) {
                                                    return
                                                }
                                                pantallaDeCargaRenderizada?.remove()

                                                if (respuestaServidor?.error) {
                                                    return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                                }
                                                if (respuestaServidor?.ok) {
                                                    const uiContenedor = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                                    if (!uiContenedor) {
                                                        return
                                                    }
                                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()

                                                    const bloqueHabitacionUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.habitacionUI({
                                                        habitacionIDV: habitacion.habitacionIDV,
                                                        habitacionUID: respuestaServidor?.nuevoUID,
                                                        apartamentoIDV: apartamentoIDV
                                                    })

                                                    const nombreHabitacionUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.habitacionTituloUI({
                                                        habitacionIDV: habitacion.habitacionIDV,
                                                        habitacionUID: respuestaServidor?.nuevoUID,
                                                        apartamentoIDV: apartamentoIDV,
                                                        habitacionUI: habitacion.habitacionUI,

                                                    })
                                                    bloqueHabitacionUI.appendChild(nombreHabitacionUI)

                                                    const camaComponenteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.camas.contenedorCamasUI({
                                                        habitacionIDV: habitacion.habitacionIDV,
                                                        apartamentoIDV: apartamentoIDV,
                                                        habitacionUID: respuestaServidor?.nuevoUID,
                                                        camas: {
                                                            compartida: {
                                                                camaUI: "Sin cama asignada"
                                                            },
                                                            fisicas: []
                                                        },
                                                        reservaUID: reservaUID
                                                    })
                                                    bloqueHabitacionUI.appendChild(camaComponenteUI)
                                                    document.querySelector(`[apartamentoUID="${apartamentoUID}"]`).appendChild(bloqueHabitacionUI)
                                                }
                                            })
                                            contenedor.appendChild(opcionApartamento)
                                        })
                                    }



                                    const infoEliminacion = document.createElement("p")
                                    infoEliminacion.classList.add(
                                        "padding6"
                                    )
                                    infoEliminacion.innerText = `Opciones de eliminaciÃ³n del ${apartamentoUI}`
                                    contenedor.appendChild(infoEliminacion)

                                    const opcionSinBloqueo = opcionesEliminacion("sinBloqueo")
                                    contenedor.appendChild(opcionSinBloqueo)


                                    const infoEliminacionConBloqueo = document.createElement("p")
                                    infoEliminacionConBloqueo.classList.add(
                                        "padding6"
                                    )
                                    infoEliminacionConBloqueo.innerText = `Eliminar el ${apartamentoUI} aplicando un bloqueo`
                                    contenedor.appendChild(infoEliminacionConBloqueo)

                                    const opcionbloqueoTemporal = opcionesEliminacion("bloqueoTemporal")
                                    contenedor.appendChild(opcionbloqueoTemporal)
                                    const opcionbloqueoPermanente = opcionesEliminacion("bloqueoPermanente")
                                    contenedor.appendChild(opcionbloqueoPermanente)
                                }


                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("boton")
                                botonCancelar.setAttribute("boton", "cancelar")
                                botonCancelar.innerText = "Cerrar y volver a la reserva"
                                botonCancelar.addEventListener("click", () => {
                                    return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                })
                                contenedor.appendChild(botonCancelar)
                            },
                            anadirApartamento: async (data) => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const apartamentoIDV = data.apartamentoIDV
                                const instanciaUI_conteneodrUI = data.instanciaUID_contenedorUI
                                const instanciaUID_pantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()

                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta({
                                    instanciaUID: instanciaUID_pantallaDeCarga,
                                    mensaje: "Eliminando habitaciÃ³n..."
                                })


                                const respuestaServidor = await casaVitini.shell.servidor({
                                    zona: "administracion/reservas/detallesReserva/alojamiento/anadirApartamentoReserva",
                                    reservaUID: String(reservaUID),
                                    apartamentoIDV: apartamentoIDV
                                })
                                const pantallaDeCargaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_pantallaDeCarga}"]`)
                                if (!pantallaDeCargaRenderizada) {
                                    return
                                }
                                pantallaDeCargaRenderizada?.remove()

                                if (respuestaServidor?.error) {
                                    return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {

                                    const uiContenedor = document.querySelector(`[instanciaUID="${instanciaUI_conteneodrUI}"]`)
                                    if (!uiContenedor) {
                                        return
                                    }

                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()

                                    const apartamentoComponenteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.apatamentoUI({
                                        apartamentoIDV: apartamentoIDV,
                                        apartamentoUID: respuestaServidor?.nuevoUID,
                                        apartamentoUI: respuestaServidor?.apartamentoUI
                                    })

                                    const tituloApartamentoComponenteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.apartamentos.apartamentoTituloUI({
                                        apartamentoUI: respuestaServidor?.apartamentoUI
                                    })
                                    apartamentoComponenteUI.appendChild(tituloApartamentoComponenteUI)
                                    //const selectorEspacioAlojamiento = document.querySelector("[componente=contenedorIntermedioAlojamiento]")
                                    //if (!selectorEspacioAlojamiento) {
                                    //    const selectorMarcoAlojameinto = document.querySelector("[componente=marcoAlojamiento]")
                                    //    selectorMarcoAlojameinto.innerHTML = null
                                    //    const contenedorAlojamientoUI = document.createElement("div")
                                    //    contenedorAlojamientoUI.classList.add("administracionReservaDetallesBloqueContendioAlojamiento")
                                    //    contenedorAlojamientoUI.setAttribute("componente", "contenedorIntermedioAlojamiento")
                                    //    const espacioAlojamiento = document.createElement("div")
                                    //    espacioAlojamiento.classList.add("reservasDetallesBloqueAlojamiennto")
                                    //    espacioAlojamiento.setAttribute("componente", "espacioAlojamiento")
                                    //    contenedorAlojamientoUI.appendChild(espacioAlojamiento)
                                    //    selectorMarcoAlojameinto.appendChild(contenedorAlojamientoUI)
                                    //}
                                    document.querySelector("[componente=espacioAlojamiento]").appendChild(apartamentoComponenteUI)
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.componentesUI.controlEspacioAlojamiento()
                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.actualizarReservaRenderizada()
                                }
                            },
                            eliminarApartamento: async (metadatos) => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const tipoBloqueo = metadatos.tipoBloqueo
                                const apartamentoUID = metadatos.apartamentoUID
                                const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                                const opcionesPantallaDeCarga = {
                                    instanciaUID: instanciaUID,
                                    mensaje: "Eliminando habitaciÃ³n..."
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)

                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/alojamiento/eliminarApartamentoReserva",
                                    reservaUID: reservaUID,
                                    apartamentoUID: apartamentoUID,
                                    tipoBloqueo: tipoBloqueo
                                }

                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const pantallaDeCargaRenderizada = document
                                    .querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUID}"]`)
                                pantallaDeCargaRenderizada?.remove()
                                if (!pantallaDeCargaRenderizada) {
                                    return
                                }
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const selectorPernoctantesHabitacion = document.querySelectorAll(`[apartamentoUID="${apartamentoUID}"] [pernoctanteUID]`)
                                    selectorPernoctantesHabitacion.forEach((pernoctanteSeleccionado) => {
                                        const nombreCompleto = pernoctanteSeleccionado.querySelector("[componente=nombreCompleto]").innerText
                                        const pasaporte = pernoctanteSeleccionado.querySelector("[componente=pasaporte]").innerText
                                        const tipoCliente = pernoctanteSeleccionado.getAttribute("tipoCliente")
                                        const pernoctanteUID = pernoctanteSeleccionado.getAttribute("pernoctanteUID")
                                        const clienteUID = pernoctanteSeleccionado.getAttribute("clienteUID")
                                        const fechaCheckIn = pernoctanteSeleccionado.getAttribute("fechaCheckIn")
                                        const fechaCheckOut = pernoctanteSeleccionado.getAttribute("fechaCheckOut")

                                        const bloquePernoctantes = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI({
                                            tipoPernoctante: tipoCliente,
                                            clienteUID: clienteUID,
                                            pernoctanteUID: pernoctanteUID,
                                            estadoAlojamiento: "noAlojado",
                                            fechaCheckIn: fechaCheckIn,
                                            fechaCheckOutAdelantado: fechaCheckOut
                                        })

                                        const nombrePernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI({
                                            nombreCompleto: nombreCompleto,
                                        })
                                        bloquePernoctantes.appendChild(nombrePernoctante)

                                        const identificacionPernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI({
                                            pasaporte: pasaporte,
                                        })
                                        bloquePernoctantes.appendChild(identificacionPernoctante)
                                        const zonaDestino = document.querySelector(`[componente=contenedorPernoctantesSinHabitacion]`)
                                        zonaDestino.appendChild(bloquePernoctantes)
                                        zonaDestino.classList.remove("elementoOcultoInicialmente")
                                    })
                                    casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                                    document.querySelector(`[apartamentoUID="${apartamentoUID}"]`).remove()
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.componentesUI.controlEspacioAlojamiento()
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.controlEspacioPernoctantesSinAlojamiento()
                                }
                                if (respuestaServidor?.estadoDesgloseFinanciero === "actualizar") {
                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.actualizarReservaRenderizada()
                                }
                            },
                        },
                        camas: {
                            contenedorCamasUI: function (data) {

                                const camas = data.camas
                                const habitacionIDV = data.habitacionIDV
                                const apartamentoIDV = data.apartamentoIDV
                                const apartamentoUI = data.apartamentoUI
                                const habitacionUID = data.habitacionUID
                                const habitacionUI = data.habitacionUI
                                const reservaUID = data.reservaUID

                                const camaCompartida = camas.compartida
                                const contenedorCamasFisicas = camas.fisicas

                                const contenedorCamasUI = document.createElement("div")
                                contenedorCamasUI.classList.add(
                                    "flexVertical",
                                    "gap6",
                                    "padding2",

                                )
                                contenedorCamasUI.setAttribute("contenedor", "camas")

                                const camaCompartidaUI = document.createElement("div")
                                camaCompartidaUI.classList.add(
                                    "padding10",
                                    "comportamientoBoton",
                                    "borderRadius6",
                                    "backgroundGrey1"

                                )
                                camaCompartidaUI.setAttribute("contenedor", "camaCompartida")
                                camaCompartidaUI.setAttribute("componente", "menuDesplegable")
                                camaCompartidaUI.innerText = camaCompartida.camaUI
                                camaCompartidaUI.addEventListener("click", (e) => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.camas.anadirCama(e, {
                                        apartamentoIDV,
                                        apartamentoUI,
                                        habitacionIDV,
                                        habitacionUID,
                                        habitacionUI
                                    })
                                })
                                contenedorCamasUI.appendChild(camaCompartidaUI)

                                if (contenedorCamasFisicas.length > 0) {
                                    const contenedorCamasFisicasUI = this.contenedorCamasFisicas()
                                    contenedorCamasUI.appendChild(contenedorCamasFisicasUI)

                                    contenedorCamasFisicas.forEach((camaFisica) => {
                                        const componenteUID = camaFisica.componenteUID
                                        const camaIDV = camaFisica.camaIDV
                                        const camaUI = camaFisica.camaUI

                                        const camaFisicaUI = this.camaFisicaUI({
                                            componenteUID,
                                            camaIDV,
                                            reservaUID,
                                            habitacionUID,
                                            habitacionUI,
                                            camaUI,
                                        })
                                        contenedorCamasFisicasUI.appendChild(camaFisicaUI)
                                    })
                                }

                                return contenedorCamasUI
                            },
                            camaFisicaUI: (data) => {
                                const componenteUID = data.componenteUID
                                const camaIDV = data.camaIDV
                                const reservaUID = data.reservaUID
                                const camaUI = data.camaUI
                                const habitacionUI = data.habitacionUI
                                const habitacionUID = data.habitacionUID



                                const camaFisicaUI = document.createElement("div")
                                camaFisicaUI.classList.add(
                                    "padding10",
                                    "comportamientoBoton",
                                    "borderRadius6",
                                    "backgroundGrey1"
                                )
                                camaFisicaUI.setAttribute("componente", "menuDesplegable")
                                camaFisicaUI.setAttribute("camaIDV", camaIDV)
                                camaFisicaUI.setAttribute("componenteUID", componenteUID)
                                camaFisicaUI.innerText = camaUI
                                camaFisicaUI.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.camas.eliminarCamaFisica.ui({
                                        camaUI,
                                        componenteUID,
                                        habitacionUI,
                                        reservaUID,
                                        camaIDV,
                                        habitacionUID
                                    })
                                })
                                return camaFisicaUI
                            },
                            contenedorCamasFisicas: () => {
                                const contenedorCamasFisicasUI = document.createElement("div")
                                contenedorCamasFisicasUI.setAttribute("contenedor", "camasFisicas")
                                contenedorCamasFisicasUI.classList.add(
                                    "flexVertical",
                                    "gap6",
                                )
                                const titulo = document.createElement("div")
                                titulo.classList.add(
                                    "padding10"
                                )
                                titulo.innerText = "Camas extra"
                                contenedorCamasFisicasUI.appendChild(titulo)
                                return contenedorCamasFisicasUI
                            },
                            eliminarCamaFisica: {
                                ui: function (data) {

                                    const camaUI = data.camaUI
                                    const componenteUID = data.componenteUID
                                    const habitacionUI = data.habitacionUI
                                    const reservaUID = data.reservaUID
                                    const camaIDV = data.camaIDV
                                    const habitacionUID = data.habitacionUID

                                    const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                    const instanciaUID_pantallaInmersia = pantallaInmersiva.getAttribute("instanciaUID")
                                    const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                                    const titulo = constructor.querySelector("[componente=titulo]")
                                    titulo.innerText = `Eliminar ${camaUI}`
                                    const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                    mensaje.innerText = `Confirmar eliminar la cama fÃ­sica ${camaUI} de la habitaciÃ³n ${habitacionUI} de la reserva ${reservaUID}, Â¿EstÃ¡s de acuerdo?`

                                    const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                    botonAceptar.innerText = "Eliminar cama fÃ­sica"
                                    botonAceptar.addEventListener("click", () => {
                                        this.confirmar({
                                            componenteUID,
                                            habitacionUI,
                                            reservaUID,
                                            camaIDV,
                                            habitacionUID,
                                            instanciaUID_pantallaInmersia
                                        })
                                    })
                                    const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                    botonCancelar.innerText = "Cancelar y volver"

                                    document.querySelector("main").appendChild(pantallaInmersiva)

                                },
                                confirmar: async (data) => {

                                    const componenteUID = data.componenteUID
                                    const habitacionUI = data.habitacionUI
                                    const reservaUID = data.reservaUID
                                    const camaIDV = data.camaIDV
                                    const habitacionUID = data.habitacionUID

                                    const instanciaUID_pantallaInmersia = data.instanciaUID_pantallaInmersia
                                    const instanciaUID_pantallaCarga = casaVitini.utilidades.codigoFechaInstancia()
                                    const mensaje = "Eliminado cama..."
                                    const datosPantallaSuperpuesta = {
                                        instanciaUID: instanciaUID_pantallaCarga,
                                        mensaje: mensaje
                                    }
                                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/alojamiento/eliminarCamaFisicaDeHabitacion",
                                        componenteUID: String(componenteUID),
                                        habitacionUI: String(habitacionUI),
                                        reservaUID: String(reservaUID)
                                    }
                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                                    document.querySelector(`[instanciaUID="${instanciaUID_pantallaCarga}"]`)?.remove()

                                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_pantallaInmersia}"]`)
                                    if (!instanciaRenderizada) { return }
                                    instanciaRenderizada.remove()

                                    if (respuestaServidor?.error) {
                                        casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        const contenedorSelectorCamas = document
                                            .querySelector(`[reservaUID="${reservaUID}"]`)
                                            .querySelector(`[habitacionUID="${habitacionUID}"]`)
                                            .querySelector(`[contenedor=camasFisicas]`)

                                        const selectorCamaObsoleta = contenedorSelectorCamas
                                            .querySelector(`[componenteUID="${componenteUID}"]`)


                                        selectorCamaObsoleta?.remove()

                                        const selectorCamasFisicasRestantes = contenedorSelectorCamas
                                            .querySelectorAll(`[componenteUID]`)

                                        if (selectorCamasFisicasRestantes.length === 0) {
                                            contenedorSelectorCamas?.remove()
                                        }
                                    }
                                }
                            },
                            anadirCama: async (elementoCama, data) => {
                                const apartamentoUI = data.apartamentoUI
                                const apartamentoIDV = data.apartamentoIDV
                                const habitacionIDV = data.habitacionIDV
                                const habitacionUID = data.habitacionUID
                                const habitacionUI = data.habitacionUI

                                const main = document.querySelector("main")
                                const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                const reservaUID = main.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const instanciaUID = ui.getAttribute("instanciaUID")

                                main.appendChild(ui)
                                const contenedor = ui.querySelector("[componente=contenedor]")
                                const spinner = casaVitini.ui.componentes.spinner({
                                    mensaje: "Obteniendo camas del apartamento..."
                                })
                                contenedor.appendChild(spinner)


                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/alojamiento/listarTipoCamasHabitacion",
                                    apartamentoIDV: apartamentoIDV,
                                    habitacionIDV: habitacionIDV
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                                contenedor.innerHTML = null
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }

                                if (respuestaServidor.ok) {
                                    const titulo = document.createElement("div")
                                    titulo.classList.add(
                                        "titulo"
                                    )
                                    titulo.innerText = `Camas disponibles para ${habitacionUI} en ${apartamentoUI}`
                                    contenedor.appendChild(titulo)


                                    const banner = document.createElement("div")
                                    banner.classList.add(
                                        "flexVertical",
                                        "borderRadius12",
                                        "backgroundGrey1",
                                        "padding14",
                                        "gap6"
                                    )
                                    contenedor.appendChild(banner)


                                    const bannerReserva = casaVitini.
                                        administracion.
                                        reservas.
                                        detallesReserva.
                                        categoriasGlobales.
                                        alojamiento.
                                        componentesUI.
                                        bannerReservaMenus()
                                    banner.appendChild(bannerReserva)

                                    const bannerAlojamiento = casaVitini.
                                        administracion.
                                        reservas.
                                        detallesReserva.
                                        categoriasGlobales.
                                        alojamiento.
                                        componentesUI.
                                        bannerAlojamiento({
                                            apartamentoUI: apartamentoUI,
                                            apartamentoIDV: apartamentoIDV

                                        })
                                    banner.appendChild(bannerAlojamiento)

                                    const bannerHabitacion = casaVitini.
                                        administracion.
                                        reservas.
                                        detallesReserva.
                                        categoriasGlobales.
                                        alojamiento.
                                        componentesUI.
                                        bannerHabitacion({
                                            habitacionUI: habitacionUI,
                                            habitacionIDV: habitacionIDV

                                        })
                                    banner.appendChild(bannerHabitacion)

                                    const contenedorCamasCompartidas = document.createElement("div")
                                    contenedorCamasCompartidas.classList.add(
                                        "flexVertical",
                                        "gap6",
                                        // "padding6"
                                    )
                                    contenedor.appendChild(contenedorCamasCompartidas)

                                    const tituloCamasCompartidas = document.createElement("div")
                                    tituloCamasCompartidas.classList.add(
                                        "padding6"
                                    )
                                    tituloCamasCompartidas.innerText = "Camas compartidas"
                                    contenedorCamasCompartidas.appendChild(tituloCamasCompartidas)

                                    respuestaServidor.listaCamasDisponiblesPorHabitacion.forEach(cama => {
                                        const camaIDV = cama.camaIDV
                                        const camaUI = cama.camaUI
                                        const tipoCama = document.createElement("p")
                                        tipoCama.classList.add("opcionCambioCama")
                                        tipoCama.setAttribute("componente", "opcionesCama")
                                        tipoCama.setAttribute("camaIDV", camaIDV)
                                        tipoCama.innerText = camaUI

                                        tipoCama.addEventListener("click", async () => {
                                            const instanciaUID_alojamientoRenderizado = document.querySelector("[componente=marcoAlojamiento]").getAttribute("instanciaUID")
                                            const transaccion = {
                                                zona: "administracion/reservas/detallesReserva/alojamiento/gestionarCamasDeHabitacion",
                                                reservaUID,
                                                habitacionUID: String(habitacionUID),
                                                nuevaCamaIDV: camaIDV,
                                                tipoIDV: "compartida"
                                            }
                                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()

                                            if (respuestaServidor?.error) {
                                                casaVitini.shell.controladoresUI.limpiarTodoElementoFlotante()
                                                casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                            }
                                            if (respuestaServidor?.ok) {

                                                const nuevoUID = respuestaServidor?.nuevoUID
                                                const selectorTituloCama = document.querySelector(`[habitacionUID="${habitacionUID}"] [contenedor=camas] [contenedor=camaCompartida]`)
                                                selectorTituloCama.innerText = camaUI
                                                selectorTituloCama.setAttribute("camaIDV", camaIDV)
                                                if (nuevoUID) {
                                                    selectorTituloCama.setAttribute("camaUID", nuevoUID)
                                                }
                                            }
                                        })
                                        contenedorCamasCompartidas.appendChild(tipoCama)
                                    })

                                    if (respuestaServidor.listaCamasFisicas.length > 0) {
                                        const contenedorCamasFisicas = document.createElement("div")
                                        contenedorCamasFisicas.classList.add(
                                            "flexVertical",
                                            "gap6",
                                            // "padding6"
                                        )
                                        contenedor.appendChild(contenedorCamasFisicas)

                                        const tituloCamasFisicas = document.createElement("div")
                                        tituloCamasFisicas.classList.add(
                                            "padding6"
                                        )
                                        tituloCamasFisicas.innerText = "Camas fÃ­sicas"
                                        contenedorCamasFisicas.appendChild(tituloCamasFisicas)
                                        respuestaServidor.listaCamasFisicas.forEach(cama => {
                                            const camaIDV = cama.camaIDV
                                            const camaUI = cama.camaUI
                                            const tipoCama = document.createElement("p")
                                            tipoCama.classList.add("opcionCambioCama")
                                            tipoCama.setAttribute("componente", "opcionesCama")
                                            tipoCama.setAttribute("camaIDV", camaIDV)
                                            tipoCama.innerText = camaUI
                                            tipoCama.addEventListener("click", async () => {
                                                const transaccion = {
                                                    zona: "administracion/reservas/detallesReserva/alojamiento/gestionarCamasDeHabitacion",
                                                    reservaUID,
                                                    habitacionUID: String(habitacionUID),
                                                    nuevaCamaIDV: String(camaIDV),
                                                    tipoIDV: "fisica"
                                                }
                                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()


                                                if (respuestaServidor?.error) {
                                                    casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                                }
                                                if (respuestaServidor?.ok) {
                                                    const camaIDV = respuestaServidor.camaIDV
                                                    const componenteUID = respuestaServidor.componenteUID
                                                    const camaUI = respuestaServidor.camaUI


                                                    const selectorContenedorCamas = document.querySelector(`[habitacionUID="${habitacionUID}"] [contenedor=camas]`)
                                                    if (!selectorContenedorCamas) {
                                                        return
                                                    }

                                                    const selectorContenedorCamasFisicasRenderizados = selectorContenedorCamas.querySelector("[contenedor=camasFisicas]")
                                                    if (!selectorContenedorCamasFisicasRenderizados) {
                                                        const contenedorCamasFisicasUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.camas.contenedorCamasFisicas()
                                                        selectorContenedorCamas.appendChild(contenedorCamasFisicasUI)
                                                    }

                                                    const contenedorCamasFisicas_renderizado = selectorContenedorCamas.querySelector("[contenedor=camasFisicas]")
                                                    const camaFisicaUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.camas.camaFisicaUI({
                                                        componenteUID: componenteUID,
                                                        camaIDV: camaIDV,
                                                        reservaUID: reservaUID,
                                                        camaUI: camaUI,
                                                        habitacionUI: habitacionUI,
                                                        habitacionUID: habitacionUID
                                                    })
                                                    contenedorCamasFisicas_renderizado.appendChild(camaFisicaUI)
                                                }
                                            })
                                            contenedorCamasFisicas.appendChild(tipoCama)
                                        })
                                    }


                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("boton")
                                    botonCancelar.setAttribute("boton", "cancelar")
                                    botonCancelar.innerText = "Cerrar y volver a la reserva"
                                    botonCancelar.addEventListener("click", () => {
                                        return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    })
                                    contenedor.appendChild(botonCancelar)
                                }

                            },
                        },
                        pernoctantes: {
                            pernoctanteUI: function (metadatos) {
                                const estadoAlojamiento = metadatos.estadoAlojamiento
                                const tipoPernoctante = metadatos.tipoPernoctante
                                const fechaCheckIn = metadatos.fechaCheckIn
                                const fechaCheckOutAdelantado = metadatos.fechaCheckOutAdelantado
                                const clienteUID = metadatos.clienteUID
                                const pernoctanteUID = metadatos.pernoctanteUID
                                const pernoctanteUI = document.createElement("div")
                                if (estadoAlojamiento === "alojado") {
                                    pernoctanteUI.classList.add("adminitracionReservasDetallesBloquePernoctantes")
                                }
                                if (estadoAlojamiento === "noAlojado") {
                                    pernoctanteUI.classList.add("adminitracionReservasDetallesBloquePernoctantesNoAlojado")
                                }
                                pernoctanteUI.setAttribute("tipoCliente", tipoPernoctante)
                                pernoctanteUI.setAttribute("estadoAlojamiento", estadoAlojamiento)
                                pernoctanteUI.setAttribute("componente", "contenedorPernocanteHabitacion")
                                pernoctanteUI.addEventListener("click", () => {
                                    this.detallesPernoctante.ui({
                                        pernoctanteUID
                                    })
                                })
                                pernoctanteUI.setAttribute("clienteUID", clienteUID)
                                pernoctanteUI.setAttribute("contenedor", "pernoctante")
                                pernoctanteUI.setAttribute("componente", "menuDesplegable")
                                pernoctanteUI.setAttribute("pernoctanteUID", pernoctanteUID)
                                if (tipoPernoctante === "clientePool") {
                                    const tipoPernoctanteUI = document.createElement("div")
                                    tipoPernoctanteUI.classList.add("administracion_reservas_detallesReserva_tituloPendienteComprobacion")
                                    tipoPernoctanteUI.classList.add("parpadea")
                                    tipoPernoctanteUI.setAttribute("componente", "pendienteComprobacion")
                                    tipoPernoctanteUI.innerText = "Pendiente de comprobaciÃ³n documental"
                                    pernoctanteUI.appendChild(tipoPernoctanteUI)
                                }
                                if (tipoPernoctante === "cliente") {
                                    if (!fechaCheckIn) {
                                        const tipoPernoctanteUI = document.createElement("div")
                                        tipoPernoctanteUI.classList.add("administracion_reservas_detallesReserva_tituloCheckIn")
                                        //tipoPernoctanteUI.classList.add("parpadea")
                                        tipoPernoctanteUI.setAttribute("componente", "checkInInfo")
                                        tipoPernoctanteUI.innerText = "Pendiente de checkin"
                                        pernoctanteUI.appendChild(tipoPernoctanteUI)
                                    } else {
                                        pernoctanteUI.setAttribute("fechaCheckIn", fechaCheckIn)
                                        const tipoPernoctanteUI = document.createElement("div")
                                        tipoPernoctanteUI.classList.add("administracion_reservas_detallesReserva_tituloCheckIn")
                                        //tipoPernoctanteUI.classList.add("parpadea")
                                        tipoPernoctanteUI.setAttribute("componente", "checkInInfo")
                                        tipoPernoctanteUI.innerText = "> " + fechaCheckIn
                                        pernoctanteUI.appendChild(tipoPernoctanteUI)
                                    }
                                    if (fechaCheckOutAdelantado) {
                                        pernoctanteUI.setAttribute("fechaCheckOut", fechaCheckOutAdelantado)
                                        const tipoPernoctanteUI = document.createElement("div")
                                        tipoPernoctanteUI.classList.add("administracion_reservas_detallesReserva_tituloCheckIn")
                                        tipoPernoctanteUI.classList.add("letraRoja")
                                        tipoPernoctanteUI.setAttribute("componente", "checkOutInfo")
                                        tipoPernoctanteUI.innerText = "< " + fechaCheckOutAdelantado
                                        pernoctanteUI.appendChild(tipoPernoctanteUI)
                                    } else {
                                        const tipoPernoctanteUI = document.createElement("div")
                                        tipoPernoctanteUI.classList.add("administracion_reservas_detallesReserva_tituloCheckIn")
                                        tipoPernoctanteUI.classList.add("letraRoja")
                                        tipoPernoctanteUI.style.display = "none"
                                        tipoPernoctanteUI.setAttribute("componente", "checkOutInfo")
                                        //tipoPernoctanteUI.innerText = "< " + fechaCheckOutAdelantado
                                        pernoctanteUI.appendChild(tipoPernoctanteUI)
                                    }
                                }
                                return pernoctanteUI
                            },
                            pernoctanteNombreUI: (metadatos) => {
                                const pernoctanteNombreUI = document.createElement("div")
                                pernoctanteNombreUI.classList.add("adminitracionReservasDetallesNombrePernoctante")
                                pernoctanteNombreUI.setAttribute("componente", "nombreCompleto")
                                pernoctanteNombreUI.innerText = metadatos.nombreCompleto
                                return pernoctanteNombreUI
                            },
                            pernoctantePasaporteUI: (metadatos) => {
                                const pernoctantePasaporteUI = document.createElement("div")
                                pernoctantePasaporteUI.classList.add("adminitracionReservasDetallesIdentificacionPernoctante")
                                pernoctantePasaporteUI.setAttribute("componente", "pasaporte")
                                pernoctantePasaporteUI.innerText = metadatos.pasaporte
                                return pernoctantePasaporteUI
                            },
                            propuestaCambioPernoctanteUI: (propuesta) => {
                                let clienteUID = propuesta.target.getAttribute("clienteUID")
                                let clientePoolUID = propuesta.target.getAttribute("clientePoolUID")
                                let nombreUI = propuesta.target.getAttribute("nombreUI")
                                let primerApellidoUI = propuesta.target.getAttribute("primerApellidoUI")
                                let segundoApellidoUI = propuesta.target.getAttribute("segundoApellidoUI")
                                let pasaporte = propuesta.target.getAttribute("pasaporte")
                                let bloquePropuestaCambio = document.createElement("div")
                                bloquePropuestaCambio.classList.add("administracionReservaDetallesPropuedaCambioClientePool")
                                bloquePropuestaCambio.setAttribute("componente", "contenedorPropuestaCliente")
                                let tituloPropuestaCambio = document.createElement("p")
                                tituloPropuestaCambio.classList.add("administracionReservaDetallesPropuedaCambioClientePoolTitulo")
                                tituloPropuestaCambio.setAttribute("componente", "tituloCambioPropuesta")
                                tituloPropuestaCambio.innerText = "Â¿Confirmas la propuesta seleccionada?"
                                bloquePropuestaCambio.appendChild(tituloPropuestaCambio)
                                let nombreCompletoPropuesta = document.createElement("p")
                                nombreCompletoPropuesta.classList.add("administracionReservaDetallesPropuedaCambioClientePoolnombreCompletoPropuesta")
                                nombreCompletoPropuesta.setAttribute("componente", "nombrePropuesto")
                                nombreCompletoPropuesta.innerText = `${nombreUI} ${primerApellidoUI} ${segundoApellidoUI}`
                                bloquePropuestaCambio.appendChild(nombreCompletoPropuesta)
                                let pasaportePropuesta = document.createElement("p")
                                pasaportePropuesta.classList.add("administracionReservaDetallesPropuedaCambioClientePoolpasaportePropuesta")
                                pasaportePropuesta.innerText = pasaporte
                                bloquePropuestaCambio.appendChild(pasaportePropuesta)
                                let botonOpcionesCliente = document.createElement("p")
                                botonOpcionesCliente.classList.add("administracionReservaDetallesPropuedaCambioClientePoolbotonOpcione")
                                botonOpcionesCliente.setAttribute("componente", "botonConfirmarPropuesta")
                                botonOpcionesCliente.setAttribute("clienteUID_", clienteUID)
                                botonOpcionesCliente.setAttribute("clientePoolUID", clientePoolUID)
                                botonOpcionesCliente.setAttribute("nombreUI", nombreUI)
                                botonOpcionesCliente.setAttribute("primerApellidoUI", primerApellidoUI)
                                botonOpcionesCliente.setAttribute("segundoApellidoUI", segundoApellidoUI)
                                botonOpcionesCliente.setAttribute("pasaporte", pasaporte)
                                botonOpcionesCliente.innerText = "Confirmar"
                                botonOpcionesCliente.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.confirmarPropuestaCambioCliente)
                                bloquePropuestaCambio.appendChild(botonOpcionesCliente)
                                botonOpcionesCliente = document.createElement("p")
                                botonOpcionesCliente.classList.add("administracionReservaDetallesPropuedaCambioClientePoolbotonOpcione")
                                botonOpcionesCliente.setAttribute("componente", "botonCancelarPropuesta")
                                botonOpcionesCliente.innerText = "Cancelar"
                                botonOpcionesCliente.addEventListener("click", () => {
                                    let selectorContenedoresPropuesta = document.querySelectorAll("[componente=contenedorPropuestaCliente]")
                                    selectorContenedoresPropuesta.forEach((contenedorPropueda) => {
                                        contenedorPropueda.remove()
                                    })
                                    document.querySelector("[componente=buscadorRapido]").style.removeProperty("display")
                                    let selectorComponentesOcultables = document.querySelectorAll("[componente=botonOpcionClientePool]")
                                    selectorComponentesOcultables.forEach((elementoOcultable) => {
                                        elementoOcultable.style.removeProperty("display")
                                    })
                                })
                                bloquePropuestaCambio.appendChild(botonOpcionesCliente)
                                document.querySelector("[componente=buscadorRapido]").style.display = "none"
                                let selectorComponentesOcultables = document.querySelectorAll("[componente=botonOpcionClientePool]")
                                selectorComponentesOcultables.forEach((elementoOcultable) => {
                                    elementoOcultable.style.display = "none"
                                })
                                let selectorPasaporte = document.querySelector("[componente=opcionesCliente]")
                                let botonCerrar = document.querySelector("[componente=botonCerrarOpciones]")
                                selectorPasaporte.insertBefore(bloquePropuestaCambio, botonCerrar);
                            },
                            propuestaEliminarPernoctanteUI: (datosEliminacion) => {
                                const tipoEliminacion = datosEliminacion.tipoEliminacion
                                const pernoctanteUID = datosEliminacion.pernoctanteUID

                                const nombreCompleto = document
                                    .querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                    .querySelector("[componente=nombreCompleto]")
                                    .innerText
                                const pasaporte = document
                                    .querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                    .querySelector("[componente=pasaporte]")
                                    .innerText

                                let mensajeUI
                                if (tipoEliminacion === "habitacion") {
                                    mensajeUI = "Confirmas la eliminaciÃ³n de este pernoctante de la habitaciÃ³n pero no de la reserva.Este pernoctante pasarÃ¡ a la secciÃ³n de pernoctantes asociados a la reserva pero sin alojamiento asignado"
                                }
                                if (tipoEliminacion === "reserva") {
                                    mensajeUI = "Â¿Confirmas la eliminaciÃ³n de este pernoctante de la reserva? Si confirmas la eliminaciÃ³n el pernoctante serÃ¡ eliminado de esta reserva."
                                }
                                const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                                const titulo = constructor.querySelector("[componente=titulo]")
                                titulo.innerText = "Confirmar la elimiaciÃ³n"
                                const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                mensaje.innerText = mensajeUI

                                const contenedorEspacio = constructor.querySelector("[componente=contenedor]")
                                const nombreCompletoPropuesta = document.createElement("p")
                                nombreCompletoPropuesta.classList.add("administracionReservaDetallesPropuedaCambioClientePoolnombreCompletoPropuesta")
                                nombreCompletoPropuesta.setAttribute("componente", "nombrePropuesto")
                                nombreCompletoPropuesta.innerText = nombreCompleto
                                contenedorEspacio.appendChild(nombreCompletoPropuesta)
                                const pasaportePropuesta = document.createElement("p")
                                pasaportePropuesta.classList.add("administracionReservaDetallesPropuedaCambioClientePoolpasaportePropuesta")
                                pasaportePropuesta.innerText = pasaporte
                                contenedorEspacio.appendChild(pasaportePropuesta)

                                let botonMenajeUI
                                if (tipoEliminacion === "habitacion") {
                                    botonMenajeUI = "Eliminar de la habitaciÃ³n"
                                }
                                if (tipoEliminacion === "reserva") {
                                    botonMenajeUI = "Eliminar de la reserva"
                                }

                                const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                botonAceptar.innerText = botonMenajeUI
                                botonAceptar.addEventListener("click", () => {
                                    const metadatosTipoEliminacion = {
                                        pernoctanteUID: pernoctanteUID,
                                        tipoEliminacion: tipoEliminacion
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.eliminarPernoctante(metadatosTipoEliminacion)
                                })
                                const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                botonCancelar.innerText = "Cancelar la eliminaciÃ³n"

                                document.querySelector("main").appendChild(pantallaInmersiva)
                            },
                            checkin: {
                                UI: async (pernoctanteUID) => {

                                    const main = document.querySelector("main")
                                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    const instanciaUID = ui.getAttribute("instanciaUID")
                                    ui.setAttribute("contenedor", "checkin")
                                    main.appendChild(ui)
                                    const contenedor = ui.querySelector("[componente=contenedor]")

                                    const pernoctanteElemento = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                    const nombreCompleto = pernoctanteElemento.querySelector("[componente=nombreCompleto]").innerText
                                    const pasaporte = pernoctanteElemento.querySelector("[componente=pasaporte]").innerText

                                    const tituloCancelarReserva = document.createElement("p")
                                    tituloCancelarReserva.classList.add("detallesReservaTituloCancelarReserva")
                                    tituloCancelarReserva.innerText = "Realizar checkin"
                                    contenedor.appendChild(tituloCancelarReserva)
                                    const datosTitular = {
                                        nombreCompleto: nombreCompleto,
                                        pasaporte: pasaporte
                                    }
                                    const pernoctanteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkin.detallesDelTitularUI(datosTitular)
                                    contenedor.appendChild(pernoctanteUI)
                                    const instanciaUID_Calendario = casaVitini.utilidades.codigoFechaInstancia()
                                    const metadatosCalendario = {
                                        tipoFecha: "entrada",
                                        almacenamientoCalendarioID: "administracionCalendario",
                                        perfilMes: "calendario_entrada_asistido_detallesReserva_checkIn_conPasado",
                                        calendarioIO: "entrada",
                                        mensajeInfo: "Selecciona el dÃ­a de checkin",
                                        alturaDinamica: "10",
                                        instanciaUID: instanciaUID_Calendario,
                                        metodoSelectorDia: "casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkin.seleccionarDia"
                                    }
                                    const calendarioIncrustado = casaVitini.ui.componentes.calendario.constructorCalendarioIncrustado(metadatosCalendario)
                                    contenedor.appendChild(calendarioIncrustado)
                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("administracion_reservas_detallesReservas_check_botonConfirmar")
                                    botonCancelar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                    botonCancelar.innerText = "Seleccionar una fecha del checkin"
                                    botonCancelar.addEventListener("click", (e) => {
                                        const datosCheckIn = {
                                            fechaCheckIn: e.target.getAttribute("fechaCheckIn"),
                                            pernoctanteUID: pernoctanteUID,
                                            instanciaUID: instanciaUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkin.confirmar(datosCheckIn)
                                    }
                                    )
                                    contenedor.appendChild(botonCancelar)
                                    const infoEliminarReserva = document.createElement("div")
                                    infoEliminarReserva.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                    infoEliminarReserva.style.marginTop = "50px"
                                    infoEliminarReserva.innerText = "TambiÃ©n puedes eliminar irreversiblemente una reserva.La eliminaciÃ³n irreversible de una reserva borra la informaciÃ³n de la reserva, asÃ­ como los pagos asociados a la reserva y toda la informaciÃ³n relacionada con la reserva.A diferencia de la cancelaciÃ³n, los datos dejarÃ¡n de estar disponibles."
                                    const selectorCheckIn = document
                                        .querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        .getAttribute("fechaCheckIn")

                                    if (selectorCheckIn) {
                                        contenedor.setAttribute("fechaCheckIn", selectorCheckIn)
                                        const botonEliminarCheckIn = document.createElement("div")
                                        botonEliminarCheckIn.classList.add("administracion_reservas_detallesReserva_cancelarReserva_botonV1")
                                        botonEliminarCheckIn.setAttribute("componente", "botonConfirmarCancelarReserva")
                                        botonEliminarCheckIn.innerText = "Eliminar checkin"
                                        botonEliminarCheckIn.addEventListener("click", () => {
                                            const eliminarCheckIN = {
                                                pernoctanteUID,
                                                instanciaUID
                                            }
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkin.eliminar(eliminarCheckIN)
                                        })
                                        contenedor.appendChild(botonEliminarCheckIn)
                                    }
                                    const selectorCheckOutAdelantado = document
                                        .querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        .getAttribute("fechaCheckOut")
                                    if (selectorCheckOutAdelantado) {
                                        contenedor.setAttribute("fechaCheckOut", selectorCheckOutAdelantado)
                                    }
                                    const botonCancelarCheckin = document.createElement("div")
                                    botonCancelarCheckin.classList.add("administracion_reservas_detallesReserva_cancelarReserva_botonV1")
                                    botonCancelarCheckin.setAttribute("componente", "botonConfirmarCancelarReserva")
                                    botonCancelarCheckin.innerText = "Cancelar checkin y volver a la reserva"
                                    botonCancelarCheckin.addEventListener("click", () => {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()

                                    })
                                    contenedor.appendChild(botonCancelarCheckin)

                                    const fechaEntrada = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                                    const fechaEntradaArray = fechaEntrada.split("-")
                                    const mesEntrada = fechaEntradaArray[1]
                                    const anoEntrada = fechaEntradaArray[0]

                                    const resolucionCalendario = {
                                        tipo: "personalizado",
                                        comando: "construyeObjeto",
                                        ano: Number(anoEntrada),
                                        mes: Number(mesEntrada)
                                    }
                                    if (selectorCheckIn) {
                                        const fechaCheckInArray = selectorCheckIn.split("-")
                                        const mesCheckIn = Number(fechaCheckInArray[1])
                                        const anoCheckIn = Number(fechaCheckInArray[0])
                                        resolucionCalendario.mes = mesCheckIn
                                        resolucionCalendario.ano = anoCheckIn
                                    }


                                    const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(resolucionCalendario)



                                    calendarioResuelto.instanciaUID = instanciaUID_Calendario
                                    calendarioResuelto.pernoctanteUID = pernoctanteUID
                                    await casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                                },
                                detallesDelTitularUI: (detallesDelTitular) => {
                                    const nombreCompleto = detallesDelTitular.nombreCompleto
                                    const pasaporte = detallesDelTitular.pasaporte
                                    const detallesRapidosDelTitular = document.createElement("div")
                                    detallesRapidosDelTitular.classList.add("administracion_reservas_detallesReserva_checkin_infoTitular_contenedorGlobal")
                                    //Nombre completo titular
                                    let contenedorDato = document.createElement("div")
                                    contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                    let nombreDato = document.createElement("div")
                                    nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                    nombreDato.innerText = "Nombre del pernoctante"
                                    contenedorDato.appendChild(nombreDato)
                                    let valorDato = document.createElement("div")
                                    valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                    valorDato.classList.add("negrita")
                                    valorDato.setAttribute("componente", "nombreCompleto")
                                    valorDato.innerText = nombreCompleto
                                    contenedorDato.appendChild(valorDato)
                                    detallesRapidosDelTitular.appendChild(contenedorDato)
                                    //Pasaporte titular
                                    contenedorDato = document.createElement("div")
                                    contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                    nombreDato = document.createElement("div")
                                    nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                    nombreDato.innerText = "Pasaporte del pernoctante"
                                    contenedorDato.appendChild(nombreDato)
                                    valorDato = document.createElement("div")
                                    valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                    valorDato.classList.add("negrita")
                                    valorDato.setAttribute("componente", "pasaporte")
                                    valorDato.innerText = pasaporte
                                    contenedorDato.appendChild(valorDato)
                                    detallesRapidosDelTitular.appendChild(contenedorDato)
                                    return detallesRapidosDelTitular
                                },
                                seleccionarDia: (dia) => {
                                    const diaSeleccionado = dia.target.getAttribute("dia").padStart(2, "0")
                                    const diaSeleccionadoComoElemento = dia.target;
                                    const instanciaUID_contenedorCheckIn = dia.target.closest("[contenedor=checkin][instanciaUID]")?.getAttribute("instanciaUID")
                                    const calendario = diaSeleccionadoComoElemento.closest("[componente=marcoCalendario]")
                                    const calendarioIO = calendario.getAttribute("calendarioIO")
                                    if (diaSeleccionadoComoElemento.getAttribute("estadoDia") === "seleccionado") {
                                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                                        if (calendarioIO === "entrada") {
                                            const selectorBotonConfirmar = document
                                                .querySelector(`[instanciaUID="${instanciaUID_contenedorCheckIn}"]`)
                                                .querySelector("[componente=botonConfirmarCancelarReserva]")
                                            selectorBotonConfirmar.innerText = "Seleccionar una fecha del checkin"
                                            selectorBotonConfirmar.removeAttribute("style")
                                            diaSeleccionadoComoElemento.style.background = ""
                                            diaSeleccionadoComoElemento.style.color = ""
                                            selectorBotonConfirmar.removeAttribute("fechaCheckIn")
                                        } else if (calendarioIO === "salida") {
                                            document.querySelector("[componente=bloquePropuestaNuevaFechaSalida]")?.remove()
                                            diaSeleccionadoComoElemento.style.background = ""
                                            diaSeleccionadoComoElemento.style.color = ""
                                        }
                                        diaSeleccionadoComoElemento.removeAttribute("estadoDia")
                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.fechas.controladorZonaPropuestasCambioFechas()

                                    }
                                    calendario.querySelectorAll("[estadoDia=seleccionado]").forEach(diasDelCalendario => {
                                        // diaDisponible.removeAttribute("style")
                                        diasDelCalendario.removeAttribute("estadoDia")
                                        diasDelCalendario.style.background = ""
                                        diasDelCalendario.style.color = ""
                                    });
                                    diaSeleccionadoComoElemento.style.background = "green"
                                    diaSeleccionadoComoElemento.style.color = "white"
                                    diaSeleccionadoComoElemento.setAttribute("estadoDia", "seleccionado")
                                    const anoSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("ano").padStart(4, "0")
                                    const mesSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("mes").padStart(2, "0")
                                    if (calendarioIO === "entrada") {

                                        const selectorBotonConfirmar = document
                                            .querySelector(`[instanciaUID="${instanciaUID_contenedorCheckIn}"]`)
                                            .querySelector("[componente=botonConfirmarCancelarReserva]")
                                        selectorBotonConfirmar.innerText = `Confirmar checkin para el ${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}`
                                        selectorBotonConfirmar.style.pointerEvents = "all"
                                        selectorBotonConfirmar.setAttribute("fechaCheckIn", `${anoSeleccionado}-${mesSeleccionado}-${diaSeleccionado}`)
                                        selectorBotonConfirmar.style.fontWeight = "bold"
                                    }
                                },
                                confirmar: async (checkIn) => {
                                    const pernoctanteUID = checkIn.pernoctanteUID
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const fechaCheckIn = checkIn.fechaCheckIn
                                    const instanciaUID = checkIn.instanciaUID
                                    const instanciaUID_localProceso = casaVitini.utilidades.codigoFechaInstancia()
                                    const metadatosPantallaCarga = {
                                        mensaje: "Esperando al servidor...",
                                        instanciaUID: instanciaUID_localProceso,
                                    }
                                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                    const estadoReserva = {
                                        zona: "administracion/reservas/detallesReserva/pernoctantes/confirmarFechaCheckIn",
                                        pernoctanteUID: String(pernoctanteUID),
                                        fechaCheckIn: fechaCheckIn,
                                        reservaUID: String(reservaUID)
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(estadoReserva)

                                    const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUID_localProceso}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                    selectorPantallaDeCarga.forEach((pantalla) => {
                                        pantalla.remove()
                                    })
                                    const selectorInstanciaRaiz = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                    if (!selectorInstanciaRaiz) {

                                    }
                                    if (respuestaServidor?.error) {
                                        casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        const selectorPernoctante = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        selectorPernoctante.setAttribute("fechaCheckIn", fechaCheckIn)
                                        const selectorCheckInInfo = selectorPernoctante.querySelector(`[componente=checkInInfo]`)
                                        selectorCheckInInfo.innerText = "> " + fechaCheckIn
                                    }
                                },
                                eliminar: async (data) => {
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const pernoctanteUID = data.pernoctanteUID
                                    const instanciaUID = data.instanciaUID
                                    const instanciaUID_localProceso = casaVitini.utilidades.codigoFechaInstancia()
                                    const metadatosPantallaCarga = {
                                        mensaje: "Esperando al servidor...",
                                        instanciaUID: instanciaUID_localProceso,
                                    }
                                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                    const estadoReserva = {
                                        zona: "administracion/reservas/detallesReserva/pernoctantes/eliminarCheckIN",
                                        pernoctanteUID: String(pernoctanteUID),
                                        reservaUID: String(reservaUID)
                                    }
                                    const respuestaServidor = await casaVitini.shell.servidor(estadoReserva)
                                    const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUID_localProceso}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                    selectorPantallaDeCarga.forEach((pantalla) => {
                                        pantalla.remove()
                                    })
                                    const selectorInstanciaRaiz = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                    if (!selectorInstanciaRaiz) {

                                    }
                                    if (respuestaServidor?.error) {
                                        casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        const selectorPernoctante = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        selectorPernoctante.removeAttribute("fechaCheckIn")
                                        const selectorCheckInInfo = selectorPernoctante.querySelector(`[componente=checkInInfo]`)
                                        selectorCheckInInfo.innerText = "Pendiente de checkin"
                                        selectorPernoctante.removeAttribute("fechaCheckOut")
                                        const selectorCheckOutInfo = selectorPernoctante.querySelector(`[componente=checkOutInfo]`)
                                        selectorCheckOutInfo.style.display = "none"
                                        selectorCheckOutInfo.innerText = null
                                    }
                                }
                            },
                            checkout: {
                                UI: async (pernoctanteUID) => {
                                    document.body.style.overflow = "hidden";
                                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                                    const pernoctanteElemento = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                    const nombreCompleto = pernoctanteElemento.querySelector("[componente=nombreCompleto]").innerText
                                    const pasaporte = pernoctanteElemento.querySelector("[componente=pasaporte]").innerText
                                    const advertenciaInmersivaIU = document.createElement("div")
                                    advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                                    advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                                    advertenciaInmersivaIU.setAttribute("contenedor", "checkout")
                                    advertenciaInmersivaIU.setAttribute("instanciaUID", instanciaUID)
                                    advertenciaInmersivaIU.style.justifyContent = "flex - start"
                                    const contenedorAdvertenciaInmersiva = document.createElement("div")
                                    contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                    const contenidoAdvertenciaInmersiva = document.createElement("div")
                                    contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                    contenidoAdvertenciaInmersiva.setAttribute("contenedor", "contenidoAdvertenciaInmersiva")
                                    const contenedor = document.createElement("div")
                                    contenedor.classList.add("administracion_reservas_detallesReservas_check_contenedor")
                                    const tituloCancelarReserva = document.createElement("p")
                                    tituloCancelarReserva.classList.add("detallesReservaTituloCancelarReserva")
                                    tituloCancelarReserva.innerText = "Checkout adelantado"
                                    contenedor.appendChild(tituloCancelarReserva)
                                    const datosTitular = {
                                        nombreCompleto: nombreCompleto,
                                        pasaporte: pasaporte
                                    }
                                    const pernoctanteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkout.detallesDelTitularUI(datosTitular)
                                    contenedor.appendChild(pernoctanteUI)
                                    const instanciaUID_Calendario = casaVitini.utilidades.codigoFechaInstancia()
                                    const metadatosCalendario = {
                                        tipoFecha: "salida",
                                        almacenamientoCalendarioID: "administracionCalendario",
                                        perfilMes: "calendario_salida_asistido_detallesReserva_checkOut_conPasado",
                                        calendarioIO: "salida",
                                        mensajeInfo: "Selecciona el dÃ­a de checkout adelantado",
                                        alturaDinamica: "10",
                                        instanciaUID: instanciaUID_Calendario,
                                        metodoSelectorDia: "casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkout.seleccionarDia"
                                    }
                                    const calendarioIncrustado = casaVitini.ui.componentes.calendario.constructorCalendarioIncrustado(metadatosCalendario)
                                    contenedor.appendChild(calendarioIncrustado)
                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("administracion_reservas_detallesReservas_check_botonConfirmar")
                                    botonCancelar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                    botonCancelar.innerText = "Seleccionar una fecha del checkout adelantado"
                                    botonCancelar.addEventListener("click", (e) => {
                                        const datosCheckIn = {
                                            fechaCheckOut: e.target.getAttribute("fechaCheckOut"),
                                            pernoctanteUID: pernoctanteUID,
                                            instanciaUID: instanciaUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkout.confirmar(datosCheckIn)
                                    }
                                    )
                                    contenedor.appendChild(botonCancelar)
                                    const infoEliminarReserva = document.createElement("div")
                                    infoEliminarReserva.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                    infoEliminarReserva.style.marginTop = "50px"
                                    infoEliminarReserva.innerText = "TambiÃ©n puedes eliminar irreversiblemente una reserva.La eliminaciÃ³n irreversible de una reserva borra la informaciÃ³n de la reserva, asÃ­ como los pagos asociados a la reserva y toda la informaciÃ³n relacionada con la reserva.A diferencia de la cancelaciÃ³n, los datos dejarÃ¡n de estar disponibles."
                                    const selectorCheckOut = document
                                        .querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        .getAttribute("fechaCheckOut")
                                    if (selectorCheckOut) {
                                        advertenciaInmersivaIU.setAttribute("fechaCheckOut", selectorCheckOut)
                                        const botonEliminar = document.createElement("div")
                                        botonEliminar.classList.add("administracion_reservas_detallesReserva_cancelarReserva_botonV1")
                                        botonEliminar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                        botonEliminar.innerText = "Eliminar checkout adelantado"
                                        botonEliminar.addEventListener("click", () => {
                                            const eliminarCheckOut = {
                                                pernoctanteUID: pernoctanteUID,
                                                instanciaUID: instanciaUID
                                            }
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkout.eliminar(eliminarCheckOut)
                                        })
                                        contenedor.appendChild(botonEliminar)
                                    }
                                    const selectorCheckIn = document
                                        .querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        .getAttribute("fechaCheckIn")
                                    if (selectorCheckIn) {
                                        advertenciaInmersivaIU.setAttribute("fechaCheckIn", selectorCheckIn)
                                    }
                                    const botonCancelarCheckin = document.createElement("div")
                                    botonCancelarCheckin.classList.add("administracion_reservas_detallesReserva_cancelarReserva_botonV1")
                                    botonCancelarCheckin.setAttribute("componente", "botonConfirmarCancelarReserva")
                                    botonCancelarCheckin.innerText = "Cancelar checkout adelantado y volver a la reserva"
                                    botonCancelarCheckin.addEventListener("click", () => {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        //document.querySelector(`[instanciaUID="${instanciaUID}"]`).remove()
                                    })
                                    contenedor.appendChild(botonCancelarCheckin)
                                    contenidoAdvertenciaInmersiva.appendChild(contenedor)
                                    contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                    advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                                    document.querySelector("main").appendChild(advertenciaInmersivaIU)
                                    const fechaSalida = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                                    const fechaSalidaArray = fechaSalida.split("-")
                                    const mesSalida = fechaSalidaArray[1]
                                    const anoSalida = fechaSalidaArray[0]
                                    const resolucionCalendario = {
                                        tipo: "personalizado",
                                        comando: "construyeObjeto",
                                        mes: Number(mesSalida),
                                        ano: Number(anoSalida),
                                    }

                                    if (selectorCheckOut) {
                                        const fechaCheckOutArray = selectorCheckOut.split("-")
                                        const mesCheckOut = Number(fechaCheckOutArray[1])
                                        const anoCheckOut = Number(fechaCheckOutArray[0])
                                        resolucionCalendario.mes = mesCheckOut
                                        resolucionCalendario.ano = anoCheckOut
                                    }

                                    const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(resolucionCalendario)
                                    calendarioResuelto.instanciaUID = instanciaUID_Calendario
                                    calendarioResuelto.pernoctanteUID = pernoctanteUID
                                    await casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                                },
                                detallesDelTitularUI: (detallesDelTitular) => {
                                    const nombreCompleto = detallesDelTitular.nombreCompleto
                                    const pasaporte = detallesDelTitular.pasaporte
                                    const detallesRapidosDelTitular = document.createElement("div")
                                    detallesRapidosDelTitular.classList.add("administracion_reservas_detallesReserva_checkin_infoTitular_contenedorGlobal")
                                    //Nombre completo titular
                                    let contenedorDato = document.createElement("div")
                                    contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                    let nombreDato = document.createElement("div")
                                    nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                    nombreDato.innerText = "Nombre del pernoctante"
                                    contenedorDato.appendChild(nombreDato)
                                    let valorDato = document.createElement("div")
                                    valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                    valorDato.classList.add("negrita")
                                    valorDato.setAttribute("componente", "nombreCompleto")
                                    valorDato.innerText = nombreCompleto
                                    contenedorDato.appendChild(valorDato)
                                    detallesRapidosDelTitular.appendChild(contenedorDato)
                                    //Pasaporte titular
                                    contenedorDato = document.createElement("div")
                                    contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                    nombreDato = document.createElement("div")
                                    nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                    nombreDato.innerText = "Pasaporte del pernoctante"
                                    contenedorDato.appendChild(nombreDato)
                                    valorDato = document.createElement("div")
                                    valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                    valorDato.classList.add("negrita")
                                    valorDato.setAttribute("componente", "pasaporte")
                                    valorDato.innerText = pasaporte
                                    contenedorDato.appendChild(valorDato)
                                    detallesRapidosDelTitular.appendChild(contenedorDato)
                                    return detallesRapidosDelTitular
                                },
                                seleccionarDia: (dia) => {
                                    const diaSeleccionado = dia.target.getAttribute("dia").padStart(2, "0")
                                    const diaSeleccionadoComoElemento = dia.target;
                                    const instanciaUID_contenedorCheckOut = dia.target.closest("[contenedor=checkout][instanciaUID]")?.getAttribute("instanciaUID")
                                    const calendario = diaSeleccionadoComoElemento.closest("[componente=marcoCalendario]")
                                    const calendarioIO = calendario.getAttribute("calendarioIO")
                                    if (diaSeleccionadoComoElemento.getAttribute("estadoDia") === "seleccionado") {
                                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                                        if (calendarioIO === "salida") {
                                            const selectorBotonConfirmar = document
                                                .querySelector(`[instanciaUID="${instanciaUID_contenedorCheckOut}"]`)
                                                .querySelector("[componente=botonConfirmarCancelarReserva]")
                                            selectorBotonConfirmar.innerText = "Seleccionar una fecha del checkout adelantado"
                                            selectorBotonConfirmar.removeAttribute("style")
                                            diaSeleccionadoComoElemento.style.background = ""
                                            diaSeleccionadoComoElemento.style.color = ""
                                            selectorBotonConfirmar.removeAttribute("fechaCheckOut")
                                        }
                                        diaSeleccionadoComoElemento.removeAttribute("estadoDia")
                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.fechas.controladorZonaPropuestasCambioFechas()

                                    }
                                    calendario.querySelectorAll("[estadoDia=seleccionado]").forEach(diasDelCalendario => {
                                        // diaDisponible.removeAttribute("style")
                                        diasDelCalendario.removeAttribute("estadoDia")
                                        diasDelCalendario.style.background = ""
                                        diasDelCalendario.style.color = ""
                                    });
                                    diaSeleccionadoComoElemento.style.background = "green"
                                    diaSeleccionadoComoElemento.style.color = "white"
                                    diaSeleccionadoComoElemento.setAttribute("estadoDia", "seleccionado")
                                    const anoSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("ano").padStart(4, "0")
                                    const mesSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("mes").padStart(2, "0")
                                    const selectorPropuestaCambioFecha = document.querySelector("[componente=espacioPropuestaCambioFechaReserva]")
                                    if (calendarioIO === "salida") {
                                        const selectorBotonConfirmar = document
                                            .querySelector(`[instanciaUID="${instanciaUID_contenedorCheckOut}"]`)
                                            .querySelector("[componente=botonConfirmarCancelarReserva]")
                                        selectorBotonConfirmar.innerText = `Confirmar checkout adelantador para el ${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}`
                                        selectorBotonConfirmar.style.pointerEvents = "all"
                                        selectorBotonConfirmar.setAttribute("fechaCheckOut", `${anoSeleccionado}-${mesSeleccionado}-${diaSeleccionado}`)
                                        selectorBotonConfirmar.style.fontWeight = "bold"
                                    }
                                },
                                confirmar: async (checkOut) => {
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const pernoctanteUID = checkOut.pernoctanteUID
                                    const fechaCheckOut = checkOut.fechaCheckOut
                                    const instanciaUID = checkOut.instanciaUID
                                    const instanciaUID_localProceso = casaVitini.utilidades.codigoFechaInstancia()
                                    const metadatosPantallaCarga = {
                                        mensaje: "Esperando al servidor...",
                                        instanciaUID: instanciaUID_localProceso,
                                    }
                                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                    const estadoReserva = {
                                        zona: "administracion/reservas/detallesReserva/pernoctantes/confirmarFechaCheckOutAdelantado",
                                        reservaUID: String(reservaUID),
                                        pernoctanteUID: String(pernoctanteUID),
                                        fechaCheckOut: fechaCheckOut
                                    }
                                    const respuestaServidor = await casaVitini.shell.servidor(estadoReserva)
                                    const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUID_localProceso}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                    selectorPantallaDeCarga.forEach((pantalla) => {
                                        pantalla.remove()
                                    })
                                    const selectorInstanciaRaiz = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                    if (!selectorInstanciaRaiz) {

                                    }
                                    if (respuestaServidor?.error) {
                                        casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        const selectorPernoctante = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        selectorPernoctante.setAttribute("fechaCheckOut", fechaCheckOut)
                                        const selectorCheckInInfo = selectorPernoctante.querySelector(`[componente=checkOutInfo]`)
                                        selectorCheckInInfo.innerText = "< " + fechaCheckOut
                                        selectorCheckInInfo.removeAttribute("style")
                                    }
                                },
                                eliminar: async (checkOut) => {
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const pernoctanteUID = checkOut.pernoctanteUID
                                    const instanciaUID = checkOut.instanciaUID
                                    const instanciaUID_localProceso = casaVitini.utilidades.codigoFechaInstancia()
                                    const metadatosPantallaCarga = {
                                        mensaje: "Esperando al servidor...",
                                        instanciaUID: instanciaUID_localProceso,
                                    }
                                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                    const estadoReserva = {
                                        zona: "administracion/reservas/detallesReserva/pernoctantes/eliminarCheckOutAdelantado",
                                        pernoctanteUID: String(pernoctanteUID),
                                        reservaUID: String(reservaUID)
                                    }
                                    const respuestaServidor = await casaVitini.shell.servidor(estadoReserva)
                                    const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUID_localProceso}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                    selectorPantallaDeCarga.forEach((pantalla) => {
                                        pantalla.remove()
                                    })
                                    const selectorInstanciaRaiz = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                    if (!selectorInstanciaRaiz) {

                                    }
                                    if (respuestaServidor?.error) {
                                        casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        const selectorPernoctante = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        selectorPernoctante.removeAttribute("fechacheckout")
                                        const selectorCheckInInfo = selectorPernoctante.querySelector(`[componente=checkOutInfo]`)
                                        selectorCheckInInfo.style.display = "none"
                                        selectorCheckInInfo.innerText = null
                                    }
                                }
                            },
                            detallesPernoctante: {
                                ui: async function (data) {
                                    const pernoctanteUID = data.pernoctanteUID
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")

                                    const main = document.querySelector("main")
                                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    main.appendChild(ui)
                                    const instanciaUID = ui.getAttribute("instanciaUID")
                                    const contenedor = ui.querySelector("[componente=contenedor]")

                                    const mensajeSpinner = "Esperando al servidor...."
                                    const spinner = casaVitini.ui.componentes.spinner(mensajeSpinner)
                                    contenedor.appendChild(spinner)

                                    const respuestaServidor = await casaVitini.shell.servidor({
                                        zona: "administracion/reservas/detallesReserva/pernoctantes/detallesDelPernoctantePorPernoctaneUID",
                                        reservaUID,
                                        pernoctanteUID: String(pernoctanteUID)
                                    })

                                    const uiRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                    if (!uiRenderizada) { return }

                                    contenedor.innerHTML = null
                                    contenedor.style.justifyContent = "flex - start";

                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {

                                        const data = respuestaServidor.ok


                                        /*
                                        {
                                            "ok": {
                                                "pernoctante": {
                                                    "componenteUID": 1609,
                                                    "reservaUID": 2587,
                                                    "habitacionUID": 3090,
                                                    "clienteUID": 557,
                                                    "fechaCheckIn": null,
                                                    "fechaCheckOutAdelantado": null
                                                },
                                                "cliente": {
                                                    "clienteUID": 557,
                                                    "telefono": "978789""",
                                                    "mail": "",
                                                    "nombreCompleto": "dfgdfg"" undefined ",
                                                    "pasaporte": "45646"Â¡"",
                                                    "tipoPernoctante": "cliente"
                                                }
                                            }
                                        }
                                         */

                                        const datosCliente = data.cliente
                                        const datosPernoctante = data.pernoctante

                                        const pernoctanteUID = datosPernoctante.componenteUID
                                        const habitacionUID = datosPernoctante.habitacionUID

                                        const nombreCompleto = datosCliente.nombreCompleto
                                        const pasaporte = datosCliente.pasaporte
                                        const tipoPernoctante = datosCliente.tipoPernoctante
                                        const fechaCheckIn = datosPernoctante.fechaCheckIn
                                        const fechaCheckOutAdelantado = datosPernoctante.fechaCheckOutAdelantado


                                        if (tipoPernoctante === "cliente") {
                                            const clienteUID = datosCliente.clienteUID
                                            const mail = datosCliente.mail
                                            const telefono = datosCliente.telefono

                                            this.componentes.respuestaUnificadaUI({
                                                clienteUID,
                                                nombreCompleto,
                                                pernoctanteUID,
                                                telefono,
                                                pasaporte,
                                                mail,
                                                instanciaUID,
                                                fechaCheckIn,
                                                fechaCheckOutAdelantado,
                                                reservaUID,
                                                habitacionUID
                                            })
                                        }
                                        if (tipoPernoctante === "clientePool") {
                                            const metadatosTitualPool = {
                                                nombreTitular: detallesTitular.nombreTitular,
                                                pasaporteTitular: detallesTitular.pasaporteTitular,
                                                mailTitular: detallesTitular.mailTitular,
                                                telefonoTitular: detallesTitular.telefonoTitular,
                                                instanciaUID: instanciaUID
                                            }
                                            this.componentes.titularPool.UI(metadatosTitualPool)
                                        }

                                    }
                                },
                                anadirPernoctanteUI: (habitacion) => {
                                    const apartamentoUI = habitacion.apartamentoUI
                                    const habitacionUID = habitacion.habitacionUID
                                    const habitacionUI = habitacion.habitacionUI
                                    const origen = habitacion.origen

                                    const main = document.querySelector("main")
                                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    const reservaUID = main.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const instanciaUID = ui.getAttribute("instanciaUID")

                                    main.appendChild(ui)
                                    const contenedor = ui.querySelector("[componente=contenedor]")
                                    const spinner = casaVitini.ui.componentes.spinnerSimple()
                                    //contenedor.appendChild(spinner)

                                    const titulo = document.createElement("div")
                                    titulo.classList.add(
                                        "titulo"
                                    )
                                    titulo.innerText = `AÃ±adir un nuevo pernoctante en la ${habitacionUI} del ${apartamentoUI}`
                                    contenedor.appendChild(titulo)

                                    const nuevoClienteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctante.componentes.nuevoCliente.UI({
                                        instanciaUID,
                                    })
                                    contenedor.appendChild(nuevoClienteUI)
                                    //const botonCerrar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCerrar()
                                    //contenedor.appendChild(botonCerrar)

                                    const botonVolver = document.createElement("div")
                                    botonVolver.classList.add("boton")
                                    botonVolver.setAttribute("boton", "cancelar")
                                    botonVolver.innerText = `Volver a las opciones de la ${habitacionUI}`
                                    botonVolver.addEventListener("click", () => {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.opcionesHabitacion({
                                            habitacionUID,
                                            habitacionUI,
                                            apartamentoUI
                                        })
                                    })
                                    contenedor.appendChild(botonVolver)

                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("boton")
                                    botonCancelar.setAttribute("boton", "cancelar")
                                    botonCancelar.innerText = "Cerrar y volver a la reserva"
                                    botonCancelar.addEventListener("click", () => {
                                        return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    })
                                    contenedor.appendChild(botonCancelar)

                                },
                                componentes: {
                                    buscadorRapido: {
                                        UI: function (data) {
                                            const instanciaUID = data.instanciaUID
                                            const tipoIndividuo = data.tipoIndividuo

                                            if (!instanciaUID) {
                                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                const error = "El componente buscador en casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.UI necesita la instancia que la invoca"
                                                return casaVitini.ui.componentes.advertenciaInmersiva(error)
                                            }
                                            const contenedor = document.createElement("div")
                                            contenedor.classList.add("administracion_reservas_detallesReservas_gestionTitular_contenedorBuscador")
                                            contenedor.setAttribute("contenedor", "buscador")
                                            const info = document.createElement("div")
                                            info.classList.add("adminsitracion_reservas_detallesReservas_gestionTitular_infoBuscador")
                                            //contenedor.appendChild(info)
                                            const campoBuscador = document.createElement("input")
                                            campoBuscador.classList.add("administracion_reservas_detallesReserva_gestionTitular_campoBuscador")
                                            campoBuscador.placeholder = "Buscar un cliente existente"
                                            campoBuscador.setAttribute("instanciaUID", instanciaUID)
                                            campoBuscador.setAttribute("campo", "buscador")
                                            campoBuscador.addEventListener("input", (e) => {
                                                this.listaResultadosUI({
                                                    e,
                                                    tipoIndividuo
                                                })
                                            })
                                            contenedor.appendChild(campoBuscador)
                                            return contenedor
                                        },
                                        listaResultadosUI: async (data) => {
                                            const elemento = data.e
                                            const tipoIndividuo = data.tipoIndividuo
                                            const terminoBusqueda = elemento.target.value
                                            const instanciaUIDContenedor = elemento.target.getAttribute("instanciaUID")
                                            const instanciaUIDBuscador = casaVitini.utilidades.codigoFechaInstancia()
                                            if (!instanciaUIDContenedor) {
                                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                const error = "El componente buscador en casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.motor necesita la instancia que la invoca"
                                                casaVitini.ui.vista.advertenciaInmersiva(error)
                                            }
                                            const alturaDinamica = window.scrollY + elemento.target.getBoundingClientRect().bottom;
                                            const horizontalDinamico = elemento.target.offsetLeft;
                                            const anchoDinamico = elemento.target.getBoundingClientRect().width;
                                            const selectorListaResultadosBuscadorRapidoRenderiaza = document.querySelectorAll("[componente=buscadorRapidoCliente]")
                                            selectorListaResultadosBuscadorRapidoRenderiaza.forEach((listaRenderizada) => {
                                                listaRenderizada.remove()
                                            })
                                            const campoVacio = elemento.target.value.length

                                            if (campoVacio === 0) {
                                                clearTimeout(casaVitini.componentes.temporizador);
                                                document.querySelector(`[instanciaUID="${instanciaUIDContenedor}"]`).querySelector(`[instanciaUIDBuscador]`)?.remove()
                                                return
                                            }
                                            const listaResultados = document.createElement("div")
                                            listaResultados.setAttribute("componente", "buscadorRapidoCliente")
                                            listaResultados.setAttribute("instanciaUIDBuscador", instanciaUIDBuscador)
                                            listaResultados.classList.add("administracion_reservas_detallesReservas_gestionTitular_listaBuscador")
                                            listaResultados.style.top = (alturaDinamica + 4) + "px"
                                            //listaResultados.style.marginLeft = (horizontalDinamico + 4) + "px"
                                            listaResultados.style.marginLeft = "0px"
                                            listaResultados.style.width = anchoDinamico + "px"
                                            listaResultados.innerText = null
                                            const info = document.createElement("p")
                                            info.classList.add("infoBuscando")
                                            info.innerText = "Buscando..."
                                            listaResultados.appendChild(info)
                                            document.addEventListener("mousedown", (e) => {
                                                if (e.target.getAttribute("componente") === "elementoResultadosBuscadorRapido") {
                                                    e.preventDefault()
                                                }
                                            })
                                            const instanciaUIDRenderizada = document.querySelector(`[instanciaUID="${instanciaUIDContenedor}"] [contenedor=buscador]`)
                                            instanciaUIDRenderizada.appendChild(listaResultados)
                                            clearTimeout(casaVitini.componentes.temporizador);
                                            casaVitini.componentes.temporizador = setTimeout(() => {
                                                casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.transactor({
                                                    terminoBusqueda: terminoBusqueda,
                                                    instanciaUIDBuscador: instanciaUIDBuscador,
                                                    instanciaUIDContenedor: instanciaUIDContenedor,
                                                    tipoIndividuo
                                                })
                                            }, 1500);
                                        },
                                        transactor: async (data) => {
                                            const instanciaUIDBuscador = data.instanciaUIDBuscador
                                            const terminoBusqueda = data.terminoBusqueda
                                            const instanciaUIDContenedor = data.instanciaUIDContenedor
                                            const tipoIndividuo = data.tipoIndividuo
                                            const transaccion = {
                                                zona: "administracion/clientes/buscar",
                                                tipoBusqueda: "rapido",
                                                buscar: terminoBusqueda
                                            }
                                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                                            const listaBuscadorRenderizada = document.querySelector(`[instanciaUIDBuscador="${instanciaUIDBuscador}"]`)
                                            if (!listaBuscadorRenderizada) {
                                                return
                                            }
                                            if (respuestaServidor?.error) {
                                                listaBuscadorRenderizada.remove()
                                                return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                            }

                                            listaBuscadorRenderizada.innerHTML = null
                                            const resultadosClientes = respuestaServidor?.clientes
                                            resultadosClientes.forEach((clienteEncontrado) => {
                                                const cliente = clienteEncontrado.uid
                                                const nombre = clienteEncontrado.nombre
                                                const primerApellido = clienteEncontrado.primerApellido
                                                const segundoApellido = clienteEncontrado.segundoApellido
                                                const pasaporte = clienteEncontrado.pasaporte
                                                const bloqueCliente = document.createElement("div")
                                                bloqueCliente.classList.add("administracionReservaDetallesBuscadorRapidoBloqueCliente")
                                                bloqueCliente.setAttribute("clienteUID", cliente)
                                                bloqueCliente.setAttribute("nombreUI", nombre)
                                                bloqueCliente.setAttribute("primerApellidoUI", primerApellido)
                                                bloqueCliente.setAttribute("segundoApellidoUI", segundoApellido)
                                                bloqueCliente.setAttribute("pasaporte", pasaporte)
                                                bloqueCliente.setAttribute("componente", "elementoResultadosBuscadorRapido")

                                                if (tipoIndividuo === "titular") {
                                                    bloqueCliente.addEventListener("click", () => {
                                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.asociarCliente({
                                                            clienteUID: cliente,
                                                            instanciaUIDContenedor: instanciaUIDContenedor
                                                        })
                                                    })
                                                }
                                                if (tipoIndividuo === "pernoctante") {
                                                    //bloqueCliente.addEventListener("click", () => {
                                                    //    casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.asociarCliente({
                                                    //        clienteUID: cliente,
                                                    //        instanciaUIDContenedor: instanciaUIDContenedor
                                                    //    })
                                                    //})
                                                }

                                                const filaNombre = document.createElement("p")
                                                filaNombre.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaNombre")
                                                filaNombre.innerText = `${nombre} ${primerApellido} ${segundoApellido}`
                                                filaNombre.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                                bloqueCliente.appendChild(filaNombre)
                                                const filaPasaporte = document.createElement("p")
                                                filaPasaporte.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaPasaporte")
                                                filaPasaporte.innerText = pasaporte
                                                filaPasaporte.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                                bloqueCliente.appendChild(filaPasaporte)
                                                listaBuscadorRenderizada.appendChild(bloqueCliente)
                                            })
                                        },
                                        asociarCliente: async (metadatos) => {
                                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                            const clienteUID = metadatos.clienteUID
                                            const instanciaUIDContenedor = metadatos.instanciaUIDContenedor
                                            const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                            const opcionesPantallaDeCarga = {
                                                instanciaUID: instanciaUIDPantallaDeCarga,
                                                mensaje: "Asociando cliente a la titularidad de esta reserva"
                                            }
                                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                            const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                            const transaccion = {
                                                zona: "administracion/reservas/gestionTitular/asociarTitular",
                                                clienteUID: Number(clienteUID),
                                                reservaUID: reservaUID
                                            }
                                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                            if (respuestaServidor?.error) {
                                                pantallaDeCargaRenderizada?.remove()
                                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                            }
                                            if (respuestaServidor?.ok) {
                                                //casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                pantallaDeCargaRenderizada?.remove()
                                                const nuevoClienteUID = respuestaServidor.clienteUID
                                                const nombreCompleto = respuestaServidor.nombreCompleto
                                                const nombre = respuestaServidor.nombre
                                                const primerApellido = respuestaServidor.primerApellido
                                                const segundoApellido = respuestaServidor.segundoApellido
                                                const clienteUID = respuestaServidor.clienteUID
                                                const mail = respuestaServidor.mail
                                                const pasaporte = respuestaServidor.pasaporte
                                                const telefono = respuestaServidor.telefono
                                                const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                                const selectorNombreTitular = document.querySelector(`[dataReserva=nombreTitular]`)
                                                if (selectorNombreTitularRenderizado && selectorNombreTitular) {
                                                    selectorNombreTitular.innerText = nombreCompleto
                                                    const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                                    selectorBloqueTitular.setAttribute("tipoTitular", "titularCliente")
                                                    selectorBloqueTitular.setAttribute("titularUID", nuevoClienteUID)
                                                }
                                                const metadatosRespuestaUnificada = {
                                                    clienteUID: clienteUID,
                                                    nombreCompleto: nombreCompleto,
                                                    pasaporte: pasaporte,
                                                    mail: mail,
                                                    telefono: telefono,
                                                    instanciaUID: instanciaUIDContenedor,
                                                    reservaUID: reservaUID
                                                }
                                                casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                            }
                                        }
                                    },
                                    nuevoCliente: {
                                        UI: (data) => {
                                            const instanciaUID = data.instanciaUID
                                            const tipoIndividuo = data.tipoIndividuo
                                            let tituloNuevoCliente
                                            let tituloBotonCrear

                                            if (tipoIndividuo === "pernoctante") {
                                                tituloNuevoCliente = "Crear un nuevo cliente e insertarlo en la reserva"
                                                tituloBotonCrear = "Crear nuevo cliente e insertarlo en la reserva como pernoctante"
                                            } else if (tipoIndividuo === "titular") {
                                                tituloNuevoCliente = "Crear un nuevo titular e insertarlo en la reserva"
                                                tituloBotonCrear = "Crear cliente e insertarlo en la reserva como titular 11"
                                            }

                                            const nuevoClienteUI = document.createElement("div")
                                            nuevoClienteUI.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI")
                                            nuevoClienteUI.setAttribute("formulario", "nuevoCliente")
                                            const buscadorUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.UI({
                                                instanciaUID,
                                                tipoIndividuo
                                            })
                                            nuevoClienteUI.appendChild(buscadorUI)
                                            const info = document.createElement("p")
                                            info.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_info")
                                            info.classList.add("negrita")
                                            info.innerText = tituloNuevoCliente
                                            nuevoClienteUI.appendChild(info)
                                            const campoNombre = document.createElement("input")
                                            campoNombre.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            campoNombre.setAttribute("campo", "nombre")
                                            campoNombre.setAttribute("formulario", "AnadirPernoctante")
                                            campoNombre.placeholder = "Nombre(obligatiorio)"
                                            nuevoClienteUI.appendChild(campoNombre)
                                            const primerApellido = document.createElement("input")
                                            primerApellido.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            primerApellido.setAttribute("campo", "primerApellido")
                                            primerApellido.setAttribute("formulario", "AnadirPernoctante")
                                            primerApellido.placeholder = "Primer apellido"
                                            nuevoClienteUI.appendChild(primerApellido)
                                            const segundoApellido = document.createElement("input")
                                            segundoApellido.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            segundoApellido.setAttribute("campo", "segundoApellido")
                                            segundoApellido.setAttribute("formulario", "AnadirPernoctante")
                                            segundoApellido.placeholder = "Segundo apellido"
                                            nuevoClienteUI.appendChild(segundoApellido)
                                            const pasaporte = document.createElement("input")
                                            pasaporte.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            pasaporte.setAttribute("campo", "pasaporte")
                                            pasaporte.setAttribute("formulario", "AnadirPernoctante")
                                            pasaporte.placeholder = "Pasaporte(obligatorio)"
                                            nuevoClienteUI.appendChild(pasaporte)
                                            const telefono = document.createElement("input")
                                            telefono.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            telefono.setAttribute("campo", "telefono")
                                            telefono.setAttribute("formulario", "AnadirPernoctante")
                                            telefono.placeholder = "TelÃ©fono"
                                            nuevoClienteUI.appendChild(telefono)
                                            const correoElecotronico = document.createElement("input")
                                            correoElecotronico.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            correoElecotronico.setAttribute("campo", "correoElectronico")
                                            correoElecotronico.setAttribute("formulario", "AnadirPernoctante")
                                            correoElecotronico.placeholder = "Correo electrÃ³nico"
                                            nuevoClienteUI.appendChild(correoElecotronico)
                                            const botonGuardarNuevoCliente = document.createElement("div")
                                            botonGuardarNuevoCliente.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_botonV1")
                                            botonGuardarNuevoCliente.innerText = tituloBotonCrear

                                            if (tipoIndividuo === "titular") {
                                                botonGuardarNuevoCliente.addEventListener("click", () => {
                                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.nuevoCliente.transactor(instanciaUID)
                                                })
                                            }
                                            if (tipoIndividuo === "pernoctante") {
                                                botonGuardarNuevoCliente.addEventListener("click", () => {
                                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.anadirPernoctante(instanciaUID)
                                                })
                                            }


                                            nuevoClienteUI.appendChild(botonGuardarNuevoCliente)
                                            return nuevoClienteUI
                                        },
                                        transactor: async (instanciaUID) => {
                                            const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                            const opcionesPantallaDeCarga = {
                                                instanciaUID: instanciaUIDPantallaDeCarga,
                                                mensaje: "Asociando cliente a la titularidad de esta reserva"
                                            }
                                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                            const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                            const campos = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`).querySelectorAll("[campo]")
                                            const metadatos = {
                                                zona: "administracion/reservas/gestionTitular/crearTitular",
                                                reservaUID: reservaUID
                                            }
                                            campos.forEach((campo) => {
                                                const nombreCampo = campo.getAttribute("campo")
                                                const valorCampo = campo.value
                                                metadatos[nombreCampo] = valorCampo
                                            })
                                            const respuestaServidor = await casaVitini.shell.servidor(metadatos)
                                            if (respuestaServidor?.error) {
                                                pantallaDeCargaRenderizada?.remove()
                                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                            }
                                            if (respuestaServidor?.ok) {
                                                //casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                pantallaDeCargaRenderizada?.remove()
                                                const nuevoClienteUID = respuestaServidor.clienteUID
                                                const nombreCompleto = respuestaServidor.nombreCompleto
                                                const clienteUID = respuestaServidor.clienteUID
                                                const mail = respuestaServidor.mail
                                                const telefono = respuestaServidor.telefono
                                                const pasaporte = respuestaServidor.pasaporte
                                                const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                                const selectorNombreTitular = document.querySelector(`[dataReserva=nombreTitular]`)
                                                if (selectorNombreTitularRenderizado && selectorNombreTitular) {
                                                    selectorNombreTitular.innerText = nombreCompleto
                                                    const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                                    selectorBloqueTitular.setAttribute("tipoTitular", "titularCliente")
                                                    selectorBloqueTitular.setAttribute("titularUID", nuevoClienteUID)
                                                }
                                                const metadatosRespuestaUnificada = {
                                                    clienteUID: clienteUID,
                                                    nombreCompleto: nombreCompleto,
                                                    pasaporte: pasaporte,
                                                    mail: mail,
                                                    telefono: telefono,
                                                    instanciaUID: instanciaUID,
                                                    reservaUID: reservaUID
                                                }
                                                casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                            }
                                        }
                                    },
                                    desasociarClienteComoTitular: async (metadatos) => {
                                        const instanciaUID = metadatos.instanciaUID
                                        const reservaUID = metadatos.reservaUID
                                        const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                        const opcionesPantallaDeCarga = {
                                            instanciaUID: instanciaUIDPantallaDeCarga,
                                            mensaje: "Desasociando cliente como titular de la reserva"
                                        }
                                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                        const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                        const metadatosPantallaDeCarga = {
                                            zona: "administracion/reservas/gestionTitular/desasociarClienteComoTitular",
                                            reservaUID: reservaUID
                                        }
                                        const respuestaServidor = await casaVitini.shell.servidor(metadatosPantallaDeCarga)
                                        if (respuestaServidor?.error) {
                                            pantallaDeCargaRenderizada?.remove()
                                            casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                        }
                                        if (respuestaServidor?.ok) {
                                            pantallaDeCargaRenderizada?.remove()
                                            const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                            const selectorNombreTitular = document.querySelector(`[dataReserva=nombreTitular]`)
                                            if (selectorNombreTitularRenderizado && selectorNombreTitular) {
                                                selectorNombreTitular.innerText = "(NingÃºn titular asignado)"
                                                const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                                selectorBloqueTitular.removeAttribute("tipoTitular")
                                                selectorBloqueTitular.removeAttribute("titularUID")
                                            }
                                            const selectorDestinoRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"] [espacio=gestionTitular]`)
                                            if (selectorDestinoRenderizado) {
                                                selectorDestinoRenderizado.innerHTML = null
                                                const titulo = "AÃ±adir titular a la reserva"
                                                const tituloUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.titulo(titulo)
                                                selectorDestinoRenderizado.appendChild(tituloUI)
                                                const info = "Esta reserva ahora mismo no tiene ningÃºn titular asignado.Para aÃ±adir un titular a la reserva, puedes buscar con el campo de bÃºsqueda inferior un cliente existente para asociarlo como titular.TambiÃ©n puedes crear un cliente nuevo rellenando el formulario para crear un cliente y aÃ±adirlo como titular a esta reserva."
                                                const infoUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.infoUI(info)
                                                selectorDestinoRenderizado.appendChild(infoUI)
                                                const nuevoClienteUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.nuevoCliente.UI({
                                                    instanciaUID
                                                })
                                                selectorDestinoRenderizado.appendChild(nuevoClienteUI)
                                                const botonCerrar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCerrar()
                                                selectorDestinoRenderizado.appendChild(botonCerrar)
                                            }
                                        }
                                    },
                                    detallesDelTitularUI: (detallesDelTitular) => {

                                        const clienteUID = detallesDelTitular.clienteUID
                                        const nombreTitular = detallesDelTitular.nombreTitular
                                        const pasaporteTitular = detallesDelTitular.pasaporte
                                        const tipoTitular = detallesDelTitular.tipoTitular
                                        const mailTitular = detallesDelTitular.mail ? detallesDelTitular.mail : "(Sin mail)"
                                        const telefonoTitular = detallesDelTitular.telefono ? detallesDelTitular.telefono : "(Sin telefono)"
                                        const detallesRapidosDelTitular = document.createElement("div")
                                        detallesRapidosDelTitular.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedorGlobal")
                                        //Nombre completo titular
                                        let contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        let nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "Nombre completo del titular"
                                        contenedorDato.appendChild(nombreDato)
                                        let valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = nombreTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //Pasaporte titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "Pasaporte"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = pasaporteTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //telefono titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "TelÃ©fono"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = telefonoTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //mail titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "e - Mail"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = mailTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        return detallesRapidosDelTitular
                                    },
                                    detallesDelTitularPoolUI: (detallesDelTitular) => {
                                        const nombreTitular = detallesDelTitular.nombreTitular
                                        const pasaporteTitular = detallesDelTitular.pasaporteTitular
                                        const tipoTitular = "Titular pool"
                                        const mailTitular = detallesDelTitular.mailTitular ? detallesDelTitular.mailTitular : "(Sin mail)"
                                        const telefonoTitular = detallesDelTitular.telefonoTitular ? detallesDelTitular.telefonoTitular : "(Sin telefono)"
                                        const detallesRapidosDelTitular = document.createElement("div")
                                        detallesRapidosDelTitular.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedorGlobal")
                                        //Nombre completo titular
                                        let contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        let nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "Nombre completo del titular"
                                        contenedorDato.appendChild(nombreDato)
                                        let valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = nombreTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //Pasaporte titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "Pasaporte"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = pasaporteTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //telefono titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "TelÃ©fono"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = telefonoTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //mail titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "e - Mail"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = mailTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        return detallesRapidosDelTitular
                                    },
                                    botonCerrarFormularioNuevoCliente: () => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerHTML = "Cerrar gestiÃ³n del pernoctante"
                                        boton.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                        boton
                                    },
                                    botonCerrar: () => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("boton")
                                        boton.innerHTML = "Cerrar gestiÃ³n del pernoctante"
                                        boton.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                        return boton
                                    },
                                    botonIrALaFichaDelClinete: (clienteUID) => {
                                        const boton = document.createElement("a")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerHTML = "Ir a la ficha del cliente"
                                        boton.setAttribute("href", "/administracion/clientes/" + clienteUID)
                                        boton.setAttribute("vista", "/administracion/clientes/" + clienteUID)
                                        boton.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                        return boton
                                    },
                                    botonCambiarDeHabitacion: (pernoctanteUID) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerText = "Cambiar de habitaciÃ³n"
                                        boton.setAttribute("componente", "botonOpcionClientePool")
                                        boton.addEventListener("click", () => {
                                            document.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.cambiarDeHabitacion.ocultarSelectoresCambioHabitacion)
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.cambiarDeHabitacion.mostrasSelectorCambioPernoctanteHabitacion(pernoctanteUID)
                                        })
                                        return boton
                                    },
                                    botonAsignarAHabitacion: (pernoctanteUID) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerText = "Asignar a una habitaciÃ³n"
                                        boton.setAttribute("componente", "botonOpcionClientePool")
                                        boton.addEventListener("click", () => {
                                            document.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.cambiarDeHabitacion.ocultarSelectoresCambioHabitacion)
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.cambiarDeHabitacion.mostrasSelectorCambioPernoctanteHabitacion(pernoctanteUID)
                                        })
                                        return boton
                                    },

                                    botonEliminarPernoctanteDeLaReserva: (pernoctanteUID) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.setAttribute("componente", "botonOpcionClientePool")
                                        boton.innerText = "Eliminar pernoctante de la reserva"
                                        boton.addEventListener("click", () => {
                                            const datosEliminacion = {
                                                tipoEliminacion: "reserva",
                                                pernoctanteUID: pernoctanteUID
                                            }
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.propuestaEliminarPernoctanteUI(datosEliminacion)
                                        })
                                        return boton
                                    },
                                    botonModificarCheckIn: (pernoctanteUID) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add(
                                            "administracion_reservas_detallesReservas_gestionTitular_botonCerrar",
                                            "negrita"
                                        )
                                        boton.setAttribute("componente", "botonOpcionClientePool")
                                        boton.setAttribute("tipoEliminacion", "habitacion")
                                        boton.innerText = "Modificar checkin"
                                        boton.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkin.UI(pernoctanteUID)
                                        })
                                        return boton
                                    },
                                    botonCheckOutAdelantado: (pernoctanteUID) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add(
                                            "administracion_reservas_detallesReservas_gestionTitular_botonCerrar",
                                            "negrita"
                                        )
                                        boton.setAttribute("componente", "botonOpcionClientePool")
                                        boton.setAttribute("tipoEliminacion", "habitacion")
                                        boton.innerText = "Checkout Adelantado"
                                        boton.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkout.UI(pernoctanteUID)
                                        })
                                        return boton
                                    },
                                    botonCheckIn: (pernoctanteUID) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add(
                                            "administracion_reservas_detallesReservas_gestionTitular_botonCerrar",
                                            "negrita"
                                        )
                                        boton.setAttribute("componente", "botonOpcionClientePool")
                                        boton.innerText = ">>> Realizar checkin"
                                        boton.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkin.UI(pernoctanteUID)
                                        })
                                        return boton
                                    },
                                    botonEliminarPernoctaneDeLaHabitacion: (pernoctanteUID) => {
                                        //Eliminar pernoctane de la habitacion
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.setAttribute("componente", "botonOpcionClientePool")
                                        boton.innerText = "Eliminar pernoctante solo de la habitaciÃ³n y mantenerlo en la reserva"
                                        boton.addEventListener("click", () => {
                                            const datosEliminacion = {
                                                tipoEliminacion: "habitacion",
                                                pernoctanteUID: pernoctanteUID
                                            }
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.propuestaEliminarPernoctanteUI(datosEliminacion)
                                        })
                                        return boton
                                    },
                                    titulo: (titulo) => {
                                        const tituloUI = document.createElement("p")
                                        tituloUI.classList.add("detallesReservaTituloCancelarReserva")
                                        tituloUI.innerText = titulo
                                        return tituloUI
                                    },
                                    infoUI: (info) => {
                                        const infoUI = document.createElement("p")
                                        infoUI.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                        infoUI.innerText = info
                                        return infoUI
                                    },
                                    botonCerrarCambiarTitular: (instanciaUID) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerHTML = "Cerrar formulario para cambiar de titular"
                                        boton.setAttribute("boton", "cerrarCambiarTitular")
                                        boton.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.cancelarCambiarTitular(instanciaUID)
                                        })
                                        return boton
                                    },
                                    cambiarTitular: (instanciaUID) => {
                                        const selectorBotonCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cambiarTitular]`)
                                        const selectorBotonDesasociar = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=desasociarTitular]`)
                                        selectorBotonCambiarTitular.style.display = "none"
                                        selectorBotonDesasociar.style.display = "none"
                                        const selectorNuevoClienteUI = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`)
                                        selectorNuevoClienteUI.removeAttribute("style")
                                        const selectorbotonCerrarCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cerrarCambiarTitular]`)
                                        selectorbotonCerrarCambiarTitular.removeAttribute("style")
                                    },
                                    respuestaUnificadaUI: function (data) {
                                        const clienteUID = data.clienteUID
                                        const nombreCompleto = data.nombreCompleto
                                        const pasaporte = data.pasaporte
                                        const mail = data.mail
                                        const pernoctanteUID = data.pernoctanteUID
                                        const telefono = data.telefono
                                        const instanciaUID = data.instanciaUID
                                        const fechaCheckIn = data.fechaCheckIn
                                        const fechaCheckOutAdelantado = data.fechaCheckOutAdelantado
                                        const habitacionUID = data.habitacionUID

                                        const ui = document.querySelector(`[instanciaUID="${instanciaUID}"]`).querySelector("[componente=contenedor]")
                                        if (ui) {

                                            const selectorPernoctante = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                            const apartamentoUI = selectorPernoctante.closest("[apartamentoUI]").getAttribute("apartamentoUI")
                                            const apartamentoIDV = selectorPernoctante.closest("[apartamentoIDV]").getAttribute("apartamentoIDV")
                                            const habitacionUI = selectorPernoctante.closest("[habitacionIDV]").querySelector("[habitacionUI]").getAttribute("habitacionUI")
                                            const habitacionIDV = selectorPernoctante.closest("[habitacionIDV]").getAttribute("habitacionIDV")


                                            const titulo = "Detalles del pernoctante"
                                            const tituloUI = this.titulo(titulo)
                                            ui.appendChild(tituloUI)
                                            const info = "Vista rÃ¡pida de los detalles del pernoctante"
                                            const infoUI = this.infoUI(info)
                                            ui.appendChild(infoUI)


                                            const banner = document.createElement("div")
                                            banner.classList.add(
                                                "flexVertical",
                                                "borderRadius12",
                                                "backgroundGrey1",
                                                "padding14",
                                                "gap6"
                                            )
                                            ui.appendChild(banner)


                                            const bannerReserva = casaVitini.
                                                administracion.
                                                reservas.
                                                detallesReserva.
                                                categoriasGlobales.
                                                alojamiento.
                                                componentesUI.
                                                bannerReservaMenus()
                                            banner.appendChild(bannerReserva)

                                            const bannerAlojamiento = casaVitini.
                                                administracion.
                                                reservas.
                                                detallesReserva.
                                                categoriasGlobales.
                                                alojamiento.
                                                componentesUI.
                                                bannerAlojamiento({
                                                    apartamentoUI: apartamentoUI,
                                                    apartamentoIDV: apartamentoIDV

                                                })
                                            banner.appendChild(bannerAlojamiento)

                                            const bannerHabitacion = casaVitini.
                                                administracion.
                                                reservas.
                                                detallesReserva.
                                                categoriasGlobales.
                                                alojamiento.
                                                componentesUI.
                                                bannerHabitacion({
                                                    habitacionUI: habitacionUI,
                                                    habitacionIDV: habitacionIDV

                                                })
                                            banner.appendChild(bannerHabitacion)

                                            const detallesDelTitularUI = this.detallesDelTitularUI({
                                                clienteUID: clienteUID,
                                                nombreTitular: nombreCompleto,
                                                pasaporte: pasaporte,
                                                tipoTitular: "titularCliente",
                                                mail: mail,
                                                telefono: telefono,
                                            })
                                            ui.appendChild(detallesDelTitularUI)


                                            const infoCheck = document.createElement("p")
                                            infoCheck.classList.add(
                                                "padding6"
                                            )
                                            infoCheck.innerText = "Operaciones de CheckIn CheckOut"
                                            ui.appendChild(infoCheck)

                                            if (!fechaCheckIn) {
                                                const botonCheckIn = this.botonCheckIn(pernoctanteUID)
                                                ui.appendChild(botonCheckIn)
                                            } else {
                                                const botonModificarCheckIn = this.botonModificarCheckIn(pernoctanteUID)
                                                ui.appendChild(botonModificarCheckIn)
                                                const botonCheckOutAdelantado = this.botonCheckOutAdelantado(pernoctanteUID)
                                                ui.appendChild(botonCheckOutAdelantado)
                                            }

                                            const infoGlobalCambioHab = document.createElement("p")
                                            infoGlobalCambioHab.classList.add(
                                                "padding6"
                                            )
                                            infoGlobalCambioHab.innerText = "Informacion y cambio de habitaciÃ³n"
                                            ui.appendChild(infoGlobalCambioHab)

                                            const botonIrALaFichaDelClinete = this.botonIrALaFichaDelClinete(clienteUID)
                                            ui.appendChild(botonIrALaFichaDelClinete)


                                            if (habitacionUID) {
                                                const botonCambiarDeHabitacion = this.botonCambiarDeHabitacion(pernoctanteUID)
                                                ui.appendChild(botonCambiarDeHabitacion)

                                            } else {
                                                const botonAsignarAHabitacion = this.botonAsignarAHabitacion(pernoctanteUID)
                                                ui.appendChild(botonAsignarAHabitacion)

                                            }

                                            const infoElim = document.createElement("p")
                                            infoElim.classList.add(
                                                "padding6"
                                            )
                                            infoElim.innerText = "Operaciones de eliminaciÃ³n del pernoctante"
                                            ui.appendChild(infoElim)

                                            const botonEliminarPernoctanteDeLaReserva = this.botonEliminarPernoctanteDeLaReserva(pernoctanteUID)
                                            ui.appendChild(botonEliminarPernoctanteDeLaReserva)

                                            if (habitacionUID) {
                                                const botonEliminarPernoctaneDeLaHabitacion = this.botonEliminarPernoctaneDeLaHabitacion(pernoctanteUID)
                                                ui.appendChild(botonEliminarPernoctaneDeLaHabitacion)
                                            }

                                            const botonCerrar = this.botonCerrar()
                                            ui.appendChild(botonCerrar)
                                        }
                                    },
                                    cancelarCambiarTitular: (instanciaUID) => {
                                        const selectorBotonCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cambiarTitular]`)
                                        const selectorBotonDesasociar = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=desasociarTitular]`)
                                        selectorBotonCambiarTitular.removeAttribute("style")
                                        selectorBotonDesasociar.removeAttribute("style")
                                        const selectorNuevoClienteUI = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`)
                                        selectorNuevoClienteUI.style.display = "none"
                                        const selectorbotonCerrarCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cerrarCambiarTitular]`)
                                        selectorbotonCerrarCambiarTitular.style.display = "none"
                                    },
                                },
                                gestionPernoctantePorComprobar: {
                                    desplegarUI: async (pernoctanteUID) => {
                                        const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                                        const advertenciaInmersivaIU = document.createElement("div")
                                        advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                                        advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                                        advertenciaInmersivaIU.setAttribute("instanciaUID", instanciaUID)
                                        advertenciaInmersivaIU.setAttribute("pernoctanteUID", pernoctanteUID)
                                        const contenedorAdvertenciaInmersiva = document.createElement("div")
                                        contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                        const contenidoAdvertenciaInmersiva = document.createElement("div")
                                        contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                        contenidoAdvertenciaInmersiva.setAttribute("espacio", "gestionPernoctantePorComprobar")
                                        const mensajeSpinner = "Esperando al servidor...."
                                        const spinner = casaVitini.ui.componentes.spinner(mensajeSpinner)
                                        contenidoAdvertenciaInmersiva.appendChild(spinner)
                                        contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                        advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                                        document.body.appendChild(advertenciaInmersivaIU)
                                        const transaccion = {
                                            zona: "administracion/reservas/detallesDelPernoctantePorPernoctaneUID",
                                            reservaUID: reservaUID,
                                            pernoctanteUID: Number(pernoctanteUID)
                                        }
                                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                        if (respuestaServidor?.error) {
                                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                        }
                                        if (respuestaServidor?.pernoctanteUID) {
                                            const pernoctanteUID = respuestaServidor.pernoctanteUID
                                            const nombreCompleto = respuestaServidor.nombreCompleto
                                            const pasaporte = respuestaServidor.pasaporte
                                            const seleccionarInstanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                            if (seleccionarInstanciaRenderizada) {
                                                seleccionarInstanciaRenderizada.querySelector("[contenedor=spinner]")?.remove()
                                                seleccionarInstanciaRenderizada.style.justifyContent = "flex - start";
                                                //const destinoRenderizado = seleccionarInstanciaRenderizada.querySelector("[espacio=gestionPernoctantePorComprobar]")
                                                const metadatosTitualPool = {
                                                    instanciaUID: instanciaUID,
                                                    pernoctanteUID: pernoctanteUID,
                                                    nombreCompleto: nombreCompleto,
                                                    pasaporte: pasaporte
                                                }
                                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.titularPool.UI(metadatosTitualPool)
                                            }
                                        }
                                    },
                                    componentes: {
                                        buscadorRapido: {
                                            UI: (instanciaUID) => {
                                                if (!instanciaUID) {
                                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                    const error = "El componente buscador en casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.UI necesita la instancia que la invoca"
                                                    casaVitini.ui.componentes.advertenciaInmersiva(error)
                                                }
                                                const contenedor = document.createElement("div")
                                                contenedor.classList.add("administracion_reservas_detallesReservas_gestionTitular_contenedorBuscador")
                                                contenedor.setAttribute("contenedor", "buscador")
                                                const info = document.createElement("div")
                                                info.classList.add("adminsitracion_reservas_detallesReservas_gestionTitular_infoBuscador")
                                                //contenedor.appendChild(info)
                                                const campoBuscador = document.createElement("input")
                                                campoBuscador.classList.add("administracion_reservas_detallesReserva_gestionTitular_campoBuscador")
                                                campoBuscador.placeholder = "Buscar un cliente existente"
                                                campoBuscador.setAttribute("campo", "buscador")
                                                campoBuscador.addEventListener("input", (e) => {
                                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.buscadorRapido.listaResultadosUI(e, instanciaUID)
                                                })
                                                contenedor.appendChild(campoBuscador)
                                                const resultadosBuscador = document.createElement("div")
                                                resultadosBuscador.classList.add("administracion_reservas_detallesReserva_gestionTitular_resultadosBuscador")
                                                resultadosBuscador.setAttribute("contenedor", "resultadosBuscador")
                                                //contenedor.appendChild(resultadosBuscador)
                                                contenedor
                                            },
                                            listaResultadosUI: async (e, instanciaUID) => {
                                                const terminoBusqueda = e.target.value
                                                const instanciaUIDBuscador = casaVitini.utilidades.codigoFechaInstancia()
                                                const alturaDinamica = window.scrollY + e.target.getBoundingClientRect().bottom;
                                                const anchoDinamico = e.target.getBoundingClientRect().width;
                                                const horizontalDinamicoJerarquico = casaVitini.utilidades.observador.medirPorJerarquiaDom.horizontal(e.target);
                                                const selectorListaResultadosBuscadorRapidoRenderiaza = document.querySelectorAll("[componente=buscadorRapidoCliente]")
                                                selectorListaResultadosBuscadorRapidoRenderiaza.forEach((listaRenderizada) => {
                                                    listaRenderizada.remove()
                                                })
                                                const campoVacio = e.target.value.length
                                                if (campoVacio === 0) {
                                                    clearTimeout(casaVitini.componentes.temporizador);
                                                    ;
                                                }
                                                const listaResultados = document.createElement("div")
                                                listaResultados.setAttribute("componente", "buscadorRapidoCliente")
                                                listaResultados.setAttribute("instanciaUIDBuscador", instanciaUIDBuscador)
                                                listaResultados.classList.add("administracion_reservas_detallesReservas_gestionTitular_listaBuscador")
                                                listaResultados.style.top = (alturaDinamica + 4) + "px"
                                                listaResultados.style.left = (horizontalDinamicoJerarquico + 0) + "px"
                                                listaResultados.style.width = anchoDinamico + "px"
                                                listaResultados.innerText = null
                                                listaResultados.innerText = "Buscando..."
                                                document.addEventListener("mousedown", (e) => {
                                                    if (e.target.getAttribute("componente") === "elementoResultadosBuscadorRapido") {
                                                        e.preventDefault()
                                                    }
                                                })
                                                const instanciaUIDRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"] [contenedor=buscador]`)
                                                instanciaUIDRenderizada.appendChild(listaResultados)
                                                clearTimeout(casaVitini.componentes.temporizador);
                                                casaVitini.componentes.temporizador = setTimeout(() => {
                                                    const metadatos = {
                                                        terminoBusqueda: terminoBusqueda,
                                                        instanciaUIDBuscador: instanciaUIDBuscador,
                                                        instanciaUID: instanciaUID
                                                    }
                                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.buscadorRapido.transactor(metadatos)
                                                }, 1500);
                                            },
                                            transactor: async (metadatos) => {
                                                const instanciaUIDBuscador = metadatos.instanciaUIDBuscador
                                                const terminoBusqueda = metadatos.terminoBusqueda
                                                const instanciaUID = metadatos.instanciaUID
                                                const transaccion = {
                                                    zona: "administracion/clientes/buscar",
                                                    tipoBusqueda: "rapido",
                                                    buscar: terminoBusqueda
                                                }
                                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                                if (respuestaServidor?.error) {

                                                }
                                                const listaBuscadorRenderizada = document.querySelector(`[instanciaUIDBuscador="${instanciaUIDBuscador}"]`)
                                                if (!listaBuscadorRenderizada) {

                                                }
                                                listaBuscadorRenderizada.innerHTML = null
                                                const resultadosClientes = respuestaServidor?.clientes
                                                resultadosClientes.forEach((clienteEncontrado) => {
                                                    const cliente = clienteEncontrado.uid
                                                    const nombre = clienteEncontrado.nombre
                                                    const primerApellido = clienteEncontrado.primerApellido
                                                    const segundoApellido = clienteEncontrado.segundoApellido
                                                    const pasaporte = clienteEncontrado.pasaporte
                                                    const bloqueCliente = document.createElement("div")
                                                    bloqueCliente.classList.add("administracionReservaDetallesBuscadorRapidoBloqueCliente")
                                                    bloqueCliente.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                                    bloqueCliente.addEventListener("click", () => {
                                                        const metadatos = {
                                                            clienteUID: cliente,
                                                            nombre: nombre,
                                                            primerApellido: primerApellido,
                                                            segundoApellido: segundoApellido,
                                                            pasaporte: pasaporte,
                                                            instanciaUID: instanciaUID
                                                        }
                                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.propuestaDeCambioPernoctantePoolPorClienteEnHabitacion(metadatos)
                                                    })
                                                    const filaNombre = document.createElement("p")
                                                    filaNombre.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaNombre")
                                                    filaNombre.innerText = `${nombre} ${primerApellido} ${segundoApellido}`
                                                    filaNombre.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                                    bloqueCliente.appendChild(filaNombre)
                                                    const filaPasaporte = document.createElement("p")
                                                    filaPasaporte.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaPasaporte")
                                                    filaPasaporte.innerText = pasaporte
                                                    filaPasaporte.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                                    bloqueCliente.appendChild(filaPasaporte)
                                                    listaBuscadorRenderizada.appendChild(bloqueCliente)
                                                })
                                            },
                                            asociarClienteComoTitular: async (metadatos) => {
                                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                                const clienteUID = metadatos.clienteUID
                                                const instanciaUIDContenedor = metadatos.instanciaUIDContenedor
                                                const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                                const opcionesPantallaDeCarga = {
                                                    instanciaUID: instanciaUIDPantallaDeCarga,
                                                    mensaje: "Asociando cliente a la titularidad de esta reserva"
                                                }
                                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                                const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                                const transaccion = {
                                                    zona: "administracion/reservas/gestionTitular/asociarTitular",
                                                    clienteUID: Number(clienteUID),
                                                    reservaUID: reservaUID
                                                }
                                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                                if (respuestaServidor?.error) {
                                                    pantallaDeCargaRenderizada?.remove()
                                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                                }
                                                if (respuestaServidor?.ok) {
                                                    //casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                    pantallaDeCargaRenderizada?.remove()
                                                    const nuevoClienteUID = respuestaServidor.clienteUID
                                                    const nombreCompleto = respuestaServidor.nombreCompleto
                                                    const nombre = respuestaServidor.nombre
                                                    const primerApellido = respuestaServidor.primerApellido
                                                    const segundoApellido = respuestaServidor.segundoApellido
                                                    const clienteUID = respuestaServidor.clienteUID
                                                    const mail = respuestaServidor.mail
                                                    const pasaporte = respuestaServidor.pasaporte
                                                    const telefono = respuestaServidor.telefono
                                                    const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                                    const selectorNombreTitular = document.querySelector(`[dataReserva=nombreTitular]`)
                                                    if (selectorNombreTitularRenderizado && selectorNombreTitular) {
                                                        selectorNombreTitular.innerText = nombreCompleto
                                                        const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                                        selectorBloqueTitular.setAttribute("tipoTitular", "titularCliente")
                                                        selectorBloqueTitular.setAttribute("titularUID", nuevoClienteUID)
                                                    }
                                                    const metadatosRespuestaUnificada = {
                                                        clienteUID: clienteUID,
                                                        nombreCompleto: nombreCompleto,
                                                        pasaporte: pasaporte,
                                                        mail: mail,
                                                        telefono: telefono,
                                                        instanciaUID: instanciaUIDContenedor,
                                                        reservaUID: reservaUID
                                                    }
                                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                                }
                                            }
                                        },
                                        nuevoCliente: {
                                            UI: (data) => {
                                                const instancaiUID = data.instanciaUID
                                                const tituloBajoBuscador = data.titulBajoBuscador || "tituloBajoBuscador"
                                                const tituloBotonCrear = data.tituloBotonCrear || "tituloBotonCrear1"


                                                const nuevoClienteUI = document.createElement("div")
                                                nuevoClienteUI.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI")
                                                nuevoClienteUI.setAttribute("formulario", "nuevoCliente")
                                                const info = document.createElement("p")
                                                info.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_info")
                                                info.classList.add("negrita")
                                                info.innerText = tituloBajoBuscador
                                                nuevoClienteUI.appendChild(info)
                                                const campoNombre = document.createElement("input")
                                                campoNombre.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                                campoNombre.setAttribute("campo", "nombre")
                                                campoNombre.setAttribute("formulario", "AnadirPernoctante")
                                                campoNombre.placeholder = "Nombre(obligatiorio)"
                                                nuevoClienteUI.appendChild(campoNombre)
                                                const primerApellido = document.createElement("input")
                                                primerApellido.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                                primerApellido.setAttribute("campo", "primerApellido")
                                                primerApellido.setAttribute("formulario", "AnadirPernoctante")
                                                primerApellido.placeholder = "Primer apellido"
                                                nuevoClienteUI.appendChild(primerApellido)
                                                const segundoApellido = document.createElement("input")
                                                segundoApellido.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                                segundoApellido.setAttribute("campo", "segundoApellido")
                                                segundoApellido.setAttribute("formulario", "AnadirPernoctante")
                                                segundoApellido.placeholder = "Segundo apellido"
                                                nuevoClienteUI.appendChild(segundoApellido)
                                                const pasaporte = document.createElement("input")
                                                pasaporte.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                                pasaporte.setAttribute("campo", "pasaporte")
                                                pasaporte.setAttribute("formulario", "AnadirPernoctante")
                                                pasaporte.placeholder = "Pasaporte(obligatorio)"
                                                nuevoClienteUI.appendChild(pasaporte)
                                                const telefono = document.createElement("input")
                                                telefono.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                                telefono.setAttribute("campo", "telefono")
                                                telefono.setAttribute("formulario", "AnadirPernoctante")
                                                telefono.placeholder = "TelÃ©fono"
                                                nuevoClienteUI.appendChild(telefono)
                                                const correoElecotronico = document.createElement("input")
                                                correoElecotronico.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                                correoElecotronico.setAttribute("campo", "correoElectronico")
                                                correoElecotronico.setAttribute("formulario", "AnadirPernoctante")
                                                correoElecotronico.placeholder = "Correo electrÃ³nico"
                                                nuevoClienteUI.appendChild(correoElecotronico)
                                                const botonGuardarNuevoCliente = document.createElement("div")
                                                botonGuardarNuevoCliente.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_botonV1")
                                                botonGuardarNuevoCliente.innerText = tituloBotonCrear
                                                botonGuardarNuevoCliente.addEventListener("click", () => {
                                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.guardarNuevoClienteYSustituirloPorElClientePoolActual(instanciaUID)
                                                })
                                                nuevoClienteUI.appendChild(botonGuardarNuevoCliente)
                                                return nuevoClienteUI
                                            },
                                            transactor: async (instanciaUID) => {
                                                const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                                const opcionesPantallaDeCarga = {
                                                    instanciaUID: instanciaUIDPantallaDeCarga,
                                                    mensaje: "Asociando cliente a la titularidad de esta reserva"
                                                }
                                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                                const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                                const campos = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`).querySelectorAll("[campo]")
                                                const metadatos = {
                                                    zona: "administracion/reservas/gestionTitular/crearTitular",
                                                    reservaUID: reservaUID
                                                }
                                                campos.forEach((campo) => {
                                                    const nombreCampo = campo.getAttribute("campo")
                                                    const valorCampo = campo.value
                                                    metadatos[nombreCampo] = valorCampo
                                                })
                                                const respuestaServidor = await casaVitini.shell.servidor(metadatos)
                                                if (respuestaServidor?.error) {
                                                    pantallaDeCargaRenderizada?.remove()
                                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                                }
                                                if (respuestaServidor?.ok) {
                                                    //casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                    pantallaDeCargaRenderizada?.remove()
                                                    const nuevoClienteUID = respuestaServidor.clienteUID
                                                    const nombreCompleto = respuestaServidor.nombreCompleto
                                                    const clienteUID = respuestaServidor.clienteUID
                                                    const mail = respuestaServidor.mail
                                                    const telefono = respuestaServidor.telefono
                                                    const pasaporte = respuestaServidor.pasaporte
                                                    const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                                    const selectorNombreTitular = document.querySelector(`[dataReserva=nombreTitular]`)
                                                    if (selectorNombreTitularRenderizado && selectorNombreTitular) {
                                                        selectorNombreTitular.innerText = nombreCompleto
                                                        const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                                        selectorBloqueTitular.setAttribute("tipoTitular", "titularCliente")
                                                        selectorBloqueTitular.setAttribute("titularUID", nuevoClienteUID)
                                                    }
                                                    const metadatosRespuestaUnificada = {
                                                        clienteUID: clienteUID,
                                                        nombreCompleto: nombreCompleto,
                                                        pasaporte: pasaporte,
                                                        mail: mail,
                                                        telefono: telefono,
                                                        instanciaUID: instanciaUID,
                                                        reservaUID: reservaUID
                                                    }
                                                    casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                                }
                                            }
                                        },
                                        detallesDelTitularUI: (detallesDelTitular) => {
                                            const nombreCompleto = detallesDelTitular.nombreCompleto
                                            const pasaporte = detallesDelTitular.pasaporte
                                            const detallesRapidosDelTitular = document.createElement("div")
                                            detallesRapidosDelTitular.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedorGlobal")
                                            //Nombre completo titular
                                            let contenedorDato = document.createElement("div")
                                            contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                            let nombreDato = document.createElement("div")
                                            nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                            nombreDato.innerText = "Nombre completo del pernoctante a comprobar"
                                            contenedorDato.appendChild(nombreDato)
                                            let valorDato = document.createElement("div")
                                            valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                            valorDato.classList.add("negrita")
                                            valorDato.setAttribute("componente", "nombreCompleto")
                                            valorDato.innerText = nombreCompleto
                                            contenedorDato.appendChild(valorDato)
                                            detallesRapidosDelTitular.appendChild(contenedorDato)
                                            //Pasaporte titular
                                            contenedorDato = document.createElement("div")
                                            contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                            nombreDato = document.createElement("div")
                                            nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                            nombreDato.innerText = "Pasaporte del pernoctante a comprobar"
                                            contenedorDato.appendChild(nombreDato)
                                            valorDato = document.createElement("div")
                                            valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                            valorDato.classList.add("negrita")
                                            valorDato.setAttribute("componente", "pasaporte")
                                            valorDato.innerText = pasaporte
                                            contenedorDato.appendChild(valorDato)
                                            detallesRapidosDelTitular.appendChild(contenedorDato)
                                            detallesRapidosDelTitular
                                        },
                                        botonCerrarFormularioNuevoCliente: () => {
                                            const boton = document.createElement("div")
                                            boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                            boton.innerHTML = "Cerrar gestiÃ³n del titular de la reserva"
                                            boton.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                            boton
                                        },
                                        botonCerrar: () => {
                                            const boton = document.createElement("div")
                                            boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                            boton.innerHTML = "Cerrar gestiÃ³n del pernoctante de la reserva"
                                            boton.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                            boton
                                        },
                                        titulo: (titulo) => {
                                            const tituloUI = document.createElement("p")
                                            tituloUI.classList.add("detallesReservaTituloCancelarReserva")
                                            tituloUI.innerText = titulo
                                            tituloUI
                                        },
                                        infoUI: (info) => {
                                            const infoUI = document.createElement("p")
                                            infoUI.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                            infoUI.innerText = info
                                            infoUI
                                        },
                                        titularPool: {
                                            UI: async (metadatos) => {
                                                const instanciaUID = metadatos.instanciaUID
                                                const pernoctanteUID = metadatos.pernoctanteUID
                                                const nombreCompleto = metadatos.nombreCompleto
                                                const pasaporte = metadatos.pasaporte
                                                const selectorDestinoRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"] [espacio=gestionPernoctantePorComprobar]`)
                                                if (selectorDestinoRenderizado) {
                                                    document.querySelector(`[instanciaUID="${instanciaUID}"]`).setAttribute("pernoctanteUID", pernoctanteUID)
                                                    const titulo = "Pernoctane por comprobar (POOL)"
                                                    const tituloUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.titulo(titulo)
                                                    selectorDestinoRenderizado.appendChild(tituloUI)
                                                    const info = "Los datos del pernoctante deben de comprobarse antes de guardarse en la base de datos de los clientes."
                                                    const infoUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.infoUI(info)
                                                    selectorDestinoRenderizado.appendChild(infoUI)
                                                    const detallesDelTitular = {
                                                        nombreCompleto: nombreCompleto,
                                                        pasaporte: pasaporte
                                                    }
                                                    const detallesDelTitularUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.detallesDelTitularUI(detallesDelTitular)
                                                    selectorDestinoRenderizado.appendChild(detallesDelTitularUI)
                                                    const info2 = "Primero use en el campo de bÃºsqueda para ver si existe ya una ficha del cliente para poder asociarlo.Si no existiera la ficha del cliente puede crear una en el formulario de abajo.Si selecciona un cliente existente o crea una nueva ficha del cliente desde aquÃ­ se asociarÃ¡ automÃ¡ticamente como titular de esta reserva"
                                                    const infoUI2 = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.infoUI(info2)
                                                    selectorDestinoRenderizado.appendChild(infoUI2)
                                                    const buscadorUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.buscadorRapido.UI(instanciaUID)
                                                    selectorDestinoRenderizado.appendChild(buscadorUI)
                                                    const nuevoClienteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.nuevoCliente.UI({
                                                        instanciaUID
                                                    })
                                                    selectorDestinoRenderizado.appendChild(nuevoClienteUI)
                                                    const botonCerrar = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.botonCerrar()
                                                    selectorDestinoRenderizado.appendChild(botonCerrar)
                                                    //Obtenemos datos
                                                }
                                            }
                                        },
                                        propuestaDeCambioPernoctantePoolPorClienteEnHabitacion: (propuesta) => {
                                            const clienteUID = propuesta.clienteUID
                                            const nombre = propuesta.nombre
                                            const primerApellido = propuesta.primerApellido
                                            const segundoApellido = propuesta.segundoApellido
                                            const pasaporte = propuesta.pasaporte
                                            const instanciaUID = propuesta.instanciaUID
                                            const nombreCompletoPool = document.querySelector(`[instanciaUID="${instanciaUID}"]`).querySelector("[componente=nombreCompleto]").innerText
                                            const pasaportePool = document.querySelector(`[instanciaUID="${instanciaUID}"]`).querySelector("[componente=pasaporte]").innerText
                                            const pernoctanteUID = document
                                                .querySelector(`[instanciaUID="${instanciaUID}"]`)
                                                .getAttribute("pernoctanteUID")
                                            const contenedorRenderizad = document
                                                .querySelector(`[instanciaUID="${instanciaUID}"]`)
                                                .querySelector("[espacio=gestionPernoctantePorComprobar]")
                                            const contenidoAdvertenciaInmersiva = document.createElement("div")
                                            contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                            contenidoAdvertenciaInmersiva.setAttribute("contenedor", "contenidoAdvertenciaInmersiva")
                                            const titulo = "Propuesta de verificacion"
                                            const tituloUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.titulo(titulo)
                                            contenidoAdvertenciaInmersiva.appendChild(tituloUI)
                                            let info = document.createElement("div")
                                            info.setAttribute("class", "advertenciaInfoFlujoPago")
                                            info.setAttribute("componente", "mensajeFlujoPasarela")
                                            info.innerText = "Revise los datos y, si estÃ¡n verificados documentalmente, puede guardarlos.Este proceso reemplazarÃ¡ los datos verificados por los anteriores datos no revisados."
                                            contenidoAdvertenciaInmersiva.appendChild(info)
                                            info = document.createElement("div")
                                            info.setAttribute("class", "advertenciaInfoFlujoPago")
                                            info.setAttribute("componente", "mensajeFlujoPasarela")
                                            info.innerText = "Pernoctante no verificado por el que se va a proceder a la sustituciÃ³n."
                                            contenidoAdvertenciaInmersiva.appendChild(info)
                                            const datosDetallesDelTitularUI = {
                                                nombreCompleto: nombreCompletoPool,
                                                pasaporte: pasaportePool
                                            }
                                            const detallesDelTitularUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.detallesDelTitularUI(datosDetallesDelTitularUI)
                                            contenidoAdvertenciaInmersiva.appendChild(detallesDelTitularUI)
                                            info = document.createElement("div")
                                            info.setAttribute("class", "advertenciaInfoFlujoPago")
                                            info.setAttribute("componente", "mensajeFlujoPasarela")
                                            info.innerText = "Pernoctante final que sustituirÃ¡ al anterior con datos verificados."
                                            contenidoAdvertenciaInmersiva.appendChild(info)
                                            const datosPernoctanteVerificado = {
                                                nombreCompleto: `${nombre}${primerApellido}${segundoApellido}`,
                                                pasaporte: pasaporte
                                            }
                                            const pernoctanteVerificadoUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.detallesDelTitularUI(datosPernoctanteVerificado)
                                            contenidoAdvertenciaInmersiva.appendChild(pernoctanteVerificadoUI)
                                            const botonAceptarPropuesta = document.createElement("div")
                                            botonAceptarPropuesta.setAttribute("class", "errorBoton")
                                            botonAceptarPropuesta.innerText = "Aceptar propuesta"
                                            botonAceptarPropuesta.addEventListener("click", () => {
                                                const confimarPropuesta = {
                                                    clienteUID: clienteUID,
                                                    instanciaUID: instanciaUID
                                                }
                                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.confirmarPropuesta(confimarPropuesta)
                                            })
                                            contenidoAdvertenciaInmersiva.appendChild(botonAceptarPropuesta)
                                            const botonAtras = document.createElement("div")
                                            botonAtras.setAttribute("class", "errorBoton")
                                            botonAtras.innerText = "Volver a atras"
                                            botonAtras.addEventListener("click", (e) => {
                                                const metadatosTitualPool = {
                                                    instanciaUID: instanciaUID,
                                                    pernoctanteUID: pernoctanteUID,
                                                    nombreCompleto: nombreCompletoPool,
                                                    pasaporte: pasaportePool
                                                }
                                                contenedorRenderizad.innerHTML = null
                                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.componentes.titularPool.UI(metadatosTitualPool)
                                            })
                                            contenidoAdvertenciaInmersiva.appendChild(botonAtras)
                                            const botonCancelar = document.createElement("div")
                                            botonCancelar.setAttribute("class", "errorBoton")
                                            botonCancelar.innerText = "Cancelar y cerrar"
                                            botonCancelar.addEventListener("click", () => {
                                                document.querySelector(`[instanciaUID="${instanciaUID}"]`).remove()
                                            })
                                            contenidoAdvertenciaInmersiva.appendChild(botonCancelar)
                                            //contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                            //advertenciaInmersivaUI.appendChild(contenedorAdvertenciaInmersiva)
                                            contenedorRenderizad.innerHTML = null
                                            contenedorRenderizad.appendChild(contenidoAdvertenciaInmersiva)
                                        },
                                        confirmarPropuesta: async (propuesta) => {
                                            const instanciaUID = propuesta.instanciaUID
                                            const clienteUID = propuesta.clienteUID
                                            const pernoctanteUID_DesdeInstancia = document.querySelector(`[instanciaUID="${instanciaUID}"]`).getAttribute("pernoctanteUID")
                                            const instanciaUID_pantallaPropuestaConfirmada = casaVitini.utilidades.codigoFechaInstancia()
                                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                            const metadatosPantallaCarga = {
                                                mensaje: "Esperando al servidor...",
                                                instanciaUID: instanciaUID_pantallaPropuestaConfirmada,
                                            }
                                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                            const transaccion = {
                                                zona: "administracion/reservas/cambiarTipoCliente",
                                                reservaUID: reservaUID,
                                                pernoctanteUID: Number(pernoctanteUID_DesdeInstancia),
                                                clienteUID: Number(clienteUID)
                                            }
                                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                            const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUID_pantallaPropuestaConfirmada}"]`)
                                            if (!selectorPantallaDeCarga) {

                                            }
                                            selectorPantallaDeCarga.forEach((pantalla) => {
                                                pantalla.remove()
                                            })
                                            if (respuestaServidor?.error) {
                                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                            }
                                            if (respuestaServidor?.ok) {
                                                const habitacionUID = respuestaServidor.habitacionUID
                                                const pernoctanteUID = respuestaServidor.pernoctanteUID
                                                const nombreCompleto = respuestaServidor.nombreCompleto
                                                const pasaporte = respuestaServidor.pasaporte
                                                const selectorInstanciaRaiz = document.querySelectorAll(`[instanciaUID="${instanciaUID}"]`)
                                                selectorInstanciaRaiz.forEach((pantalla) => {
                                                    pantalla.remove()
                                                })
                                                const selectorContenedorPernoctanteAntiguo = document.querySelector(`[contenedor=pernoctante][pernoctanteUID="${pernoctanteUID}"]`)
                                                selectorContenedorPernoctanteAntiguo.remove()
                                                if (habitacionUID) {
                                                    const selectorHabitacion = document.querySelector(`[habitacionUID="${habitacionUID}"]`)
                                                    let metadatos = {
                                                        tipoPernoctante: "cliente",
                                                        clienteUID: clienteUID,
                                                        pernoctanteUID: pernoctanteUID,
                                                        estadoAlojamiento: "alojado",
                                                    }
                                                    const bloquePernoctantes = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI(metadatos)
                                                    metadatos = {
                                                        nombreCompleto: nombreCompleto,
                                                    }
                                                    const nombrePernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI(metadatos)
                                                    bloquePernoctantes.appendChild(nombrePernoctante)
                                                    metadatos = {
                                                        pasaporte: pasaporte,
                                                    }
                                                    const identificacionPernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI(metadatos)
                                                    bloquePernoctantes.appendChild(identificacionPernoctante)
                                                    selectorHabitacion.appendChild(bloquePernoctantes)
                                                } else {
                                                    const metadatosBloquePernoctantes = {
                                                        tipoPernoctante: "cliente",
                                                        clienteUID: clienteUID,
                                                        pernoctanteUID: pernoctanteUID,
                                                        estadoAlojamiento: "noAlojado"
                                                    }
                                                    const bloquePernoctantes = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI(metadatosBloquePernoctantes)
                                                    const metadatosNombreUi = {
                                                        nombreCompleto: nombreCompleto,
                                                    }
                                                    const nombrePernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI(metadatosNombreUi)
                                                    bloquePernoctantes.appendChild(nombrePernoctante)
                                                    const metadatosPasaporte = {
                                                        pasaporte: pasaporte,
                                                    }
                                                    const identificacionPernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI(metadatosPasaporte)
                                                    bloquePernoctantes.appendChild(identificacionPernoctante)
                                                    const zonaDestino = document.querySelector(`[componente=contenedorPernoctantesSinHabitacion]`)
                                                    zonaDestino.appendChild(bloquePernoctantes)
                                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.controlEspacioPernoctantesSinAlojamiento()
                                                }
                                            }
                                        },

                                    }
                                },
                            },
                            cambiarDeHabitacion: {
                                mostrasSelectorCambioPernoctanteHabitacion: (pernoctanteUID) => {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()

                                    const habitacionActual = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)?.closest("[habitacionUID]")?.getAttribute("habitacionUID")



                                    const selectorHabitaciones = document.querySelectorAll("[habitacionIDV]")
                                    const selectorBotonAsignarAHabitacionRenderizado = document.querySelectorAll("[componente=botonMoverCliente]")

                                    selectorBotonAsignarAHabitacionRenderizado.forEach(botonRenderizado => {
                                        botonRenderizado.remove()
                                    });


                                    selectorHabitaciones.forEach((habitacion) => {
                                        const habitacionUID = habitacion.getAttribute("habitacionUID")
                                        if (habitacionUID !== habitacionActual) {
                                            const bloqueSelectorCambio = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.habitaciones.selectorCambioHabitacionUI(pernoctanteUID)
                                            habitacion.appendChild(bloqueSelectorCambio)
                                        }
                                    })
                                },
                                ocultarSelectoresCambioHabitacion: (e) => {
                                    const componente = e.target?.getAttribute("componente")
                                    if (componente === "botonOpcionClientePool") {
                                        return
                                    }
                                    const selectorBotonMoverCliente = document.querySelectorAll("[componente=botonMoverCliente]")
                                    selectorBotonMoverCliente.forEach(selectorBotonMoverCliente => {
                                        selectorBotonMoverCliente.remove()
                                    })
                                    document.removeEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.cambiarDeHabitacion.ocultarSelectoresCambioHabitacion)
                                },
                                cambiarPernoctanteHabitacion: async (pernoctanteUID, e) => {
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const habitacionUID = e.target.closest("[habitacionUID]").getAttribute("habitacionUID")
                                    const pernoctante = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                    const clienteUID = pernoctante.getAttribute("clienteUID")
                                    const tipoCliente = pernoctante.getAttribute("tipoCliente")
                                    const nombrePernoctante = pernoctante.querySelector("[componente=nombreCompleto]").innerText
                                    const pasaportePernoctante = pernoctante.querySelector(`[componente=pasaporte]`).innerText
                                    const fechaCheckIn = pernoctante.getAttribute("fechaCheckIn")
                                    const fechaCheckOutAdelantado = pernoctante.getAttribute("fechaCheckOut")
                                    document.querySelectorAll("[componente=botonMoverCliente]").forEach(botonMover => {
                                        botonMover.remove()
                                    })
                                    document.querySelectorAll("[componente=opcionesCliente]").forEach(opcionesCliente => {
                                        opcionesCliente.remove()
                                    })
                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/alojamiento/cambiarPernoctanteDeHabitacion",
                                        reservaUID: String(reservaUID),
                                        habitacionDestinoUID: String(habitacionUID),
                                        pernoctanteUID: String(pernoctanteUID)
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    if (respuestaServidor?.error) {
                                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                            .remove()
                                        const datoPernoctante = {
                                            tipoPernoctante: tipoCliente,
                                            clienteUID: clienteUID,
                                            pernoctanteUID: pernoctanteUID,
                                            estadoAlojamiento: "alojado",
                                            fechaCheckIn: fechaCheckIn,
                                            fechaCheckOutAdelantado: fechaCheckOutAdelantado,
                                        }
                                        const bloqueClienteMover = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI(datoPernoctante)
                                        const datosNombre = {
                                            nombreCompleto: nombrePernoctante
                                        }
                                        const pernoctanteNombreUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI(datosNombre)
                                        bloqueClienteMover.appendChild(pernoctanteNombreUI)
                                        const datosPasaporte = {
                                            pasaporte: pasaportePernoctante
                                        }
                                        const pernoctantePasaporteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI(datosPasaporte)
                                        bloqueClienteMover.appendChild(pernoctantePasaporteUI)
                                        const selectorHabitacionDestino = document.querySelector(`[habitacionUID="${habitacionUID}"]`)
                                        selectorHabitacionDestino?.appendChild(bloqueClienteMover)
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.controlEspacioPernoctantesSinAlojamiento()
                                    }
                                },
                            },
                            menuPrincipalPernoctante: (pernoctante) => {
                                const pernoctanteElemento = pernoctante.target.closest("[pernoctanteUID]")
                                const pernoctanteUID = pernoctanteElemento.getAttribute("pernoctanteUID")
                                const clienteUID = pernoctanteElemento.getAttribute("clienteUID")
                                const menuYaRenderizado = document.querySelector(`[componente=menuVolatil][pernoctanteUID="${pernoctanteUID}"]`)
                                if (menuYaRenderizado) {
                                    document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarMenusVolatiles)
                                    casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                                } else {
                                    document.querySelectorAll("[componente=menuVolatil]").forEach((menuRenderizado) => {
                                        menuRenderizado.remove()
                                    })
                                }
                                const selectorOpcionesApartamento = document.querySelector(`[componente=menuVolatil][clienteUID="${clienteUID}"]`)
                                if (selectorOpcionesApartamento) {
                                    casaVitini.shell.controladoresUI.ocultarMenusVolatiles()

                                }
                                casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                                screen.orientation?.removeEventListener("change", casaVitini.shell.controladoresUI.ocultarMenusVolatiles);
                                screen.orientation?.addEventListener("change", casaVitini.shell.controladoresUI.ocultarMenusVolatiles);
                                window.removeEventListener("resize", casaVitini.shell.controladoresUI.controlHorizotnalVetana)
                                window.addEventListener("resize", casaVitini.shell.controladoresUI.controlHorizotnalVetana)

                                const alturaDinamica = window.scrollY + pernoctanteElemento.getBoundingClientRect().bottom;
                                const horizontalDinamicoJerarquico = casaVitini.utilidades.observador.medirPorJerarquiaDom.horizontal(pernoctanteElemento);
                                let tipoCliente = pernoctanteElemento.getAttribute("tipoCliente")
                                let bloqueCliente = pernoctanteElemento
                                const estadoAlojamiento = pernoctanteElemento.getAttribute("estadoAlojamiento")
                                if (!tipoCliente) {
                                    tipoCliente = pernoctanteElemento.parentElement.getAttribute("tipoCliente")
                                    bloqueCliente = pernoctanteElemento.parentElement
                                }
                                const opcionesClientePool = document.querySelectorAll("[componente=opcionesCliente]")
                                opcionesClientePool.forEach((opcionClientePool) => {
                                    opcionClientePool.parentElement.style.removeProperty("background")
                                    opcionClientePool.remove()
                                })
                                const bloqueOpcionesCliente = document.createElement("div")
                                bloqueOpcionesCliente.classList.add("administracionReservasDetallesBloqueOpcionesCliente")
                                bloqueOpcionesCliente.setAttribute("contenedor", "opcionesCliente")
                                bloqueOpcionesCliente.setAttribute("componente", "menuVolatil")
                                bloqueOpcionesCliente.setAttribute("clienteUID", clienteUID)
                                bloqueOpcionesCliente.setAttribute("pernoctanteUID", pernoctanteUID)
                                bloqueOpcionesCliente.setAttribute("tipoCliente", tipoCliente)
                                bloqueOpcionesCliente.style.top = (alturaDinamica + 4) + "px"
                                bloqueOpcionesCliente.style.left = (horizontalDinamicoJerarquico) + "px"
                                if (tipoCliente === "cliente" && estadoAlojamiento === "alojado") {
                                    const selectorCheckIn = document
                                        .querySelector(`[pernoctanteUID="${pernoctanteUID}"]`).getAttribute("fechaCheckIn")
                                    if (selectorCheckIn) {
                                        const botonRealizarCheckin = document.createElement("div")
                                        botonRealizarCheckin.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                        botonRealizarCheckin.setAttribute("componente", "botonOpcionClientePool")
                                        botonRealizarCheckin.setAttribute("tipoEliminacion", "habitacion")
                                        botonRealizarCheckin.innerText = "Modificar checkin"
                                        botonRealizarCheckin.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkin.UI(pernoctanteUID)
                                        })
                                        bloqueOpcionesCliente.appendChild(botonRealizarCheckin)
                                        const botonCheckOutAdelantado = document.createElement("div")
                                        botonCheckOutAdelantado.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                        botonCheckOutAdelantado.setAttribute("componente", "botonOpcionClientePool")
                                        botonCheckOutAdelantado.setAttribute("tipoEliminacion", "habitacion")
                                        botonCheckOutAdelantado.innerText = "Checkout Adelantado"
                                        botonCheckOutAdelantado.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkout.UI(pernoctanteUID)
                                        })
                                        bloqueOpcionesCliente.appendChild(botonCheckOutAdelantado)
                                    } else {
                                        const botonRealizarCheckin = document.createElement("div")
                                        botonRealizarCheckin.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                        botonRealizarCheckin.setAttribute("componente", "botonOpcionClientePool")
                                        botonRealizarCheckin.innerText = ">>> Realizar checkin"
                                        botonRealizarCheckin.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.checkin.UI(pernoctanteUID)
                                        })
                                        bloqueOpcionesCliente.appendChild(botonRealizarCheckin)
                                    }
                                    //Eliminar pernoctane de la habitacion
                                    const botonOpcionCliente = document.createElement("div")
                                    botonOpcionCliente.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                    botonOpcionCliente.setAttribute("componente", "botonOpcionClientePool")
                                    botonOpcionCliente.innerText = "Eliminar pernoctante de la habitaciÃ³n"
                                    botonOpcionCliente.addEventListener("click", () => {
                                        const datosEliminacion = {
                                            tipoEliminacion: "habitacion",
                                            pernoctanteUID: pernoctanteUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.propuestaEliminarPernoctanteUI(datosEliminacion)
                                    })
                                    bloqueOpcionesCliente.appendChild(botonOpcionCliente)
                                }
                                if (tipoCliente === "cliente") {
                                    //Ir a detalles de clinete
                                    botonOpcionCliente = document.createElement("a")
                                    botonOpcionCliente.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                    botonOpcionCliente.setAttribute("vista", "/administracion/clientes/" + clienteUID)
                                    botonOpcionCliente.setAttribute("href", "/administracion/clientes/" + clienteUID)
                                    botonOpcionCliente.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                    botonOpcionCliente.innerText = "Ir a detalles del cliente"
                                    bloqueOpcionesCliente.appendChild(botonOpcionCliente)
                                }
                                if (tipoCliente === "clientePool") {
                                    //Buscador rapido clinete
                                    const campoBuscador = document.createElement("div")
                                    campoBuscador.classList.add("administracion_reservas_detallesReservas_botonCheckIn")
                                    campoBuscador.setAttribute("buscadorUID", "clientePoolCheckInAsociacion")
                                    campoBuscador.innerText = "Verificar comprobaciÃ³n documental"
                                    campoBuscador.setAttribute("componente", "buscadorRapido")
                                    campoBuscador.addEventListener("click", () => {
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctantePorComprobar.desplegarUI(pernoctanteUID)
                                    })
                                    bloqueOpcionesCliente.appendChild(campoBuscador)
                                    //Crear cliente nuevo
                                    let botonOpcionCliente = document.createElement("div")
                                    botonOpcionCliente.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                    botonOpcionCliente.innerText = "Crear cliente nuevo"
                                    botonOpcionCliente.setAttribute("origen", "opcionesClientePool")
                                    botonOpcionCliente.setAttribute("componente", "botonOpcionClientePool")
                                    botonOpcionCliente.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.anadirPernoctanteUI)
                                    //bloqueOpcionesCliente.appendChild(botonOpcionCliente)
                                }
                                if (estadoAlojamiento === "alojado") {
                                    //Cambiar habitacion
                                    botonOpcionCliente = document.createElement("div")
                                    botonOpcionCliente.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                    botonOpcionCliente.innerText = "Cambiar de habitaciÃ³n"
                                    botonOpcionCliente.setAttribute("componente", "botonOpcionClientePool")
                                    botonOpcionCliente.addEventListener("click", () => {
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.cambiarDeHabitacion.mostrasSelectorCambioPernoctanteHabitacion(pernoctanteUID)
                                    })
                                    bloqueOpcionesCliente.appendChild(botonOpcionCliente)
                                    //Eliminar pernoctane de la habitacion y de la reserva
                                    botonOpcionCliente = document.createElement("div")
                                    botonOpcionCliente.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                    botonOpcionCliente.setAttribute("componente", "botonOpcionClientePool")
                                    botonOpcionCliente.innerText = "Eliminar pernoctante de la habitaciÃ³n y de la reserva"
                                    botonOpcionCliente.addEventListener("click", () => {
                                        const datosEliminacion = {
                                            tipoEliminacion: "reserva",
                                            pernoctanteUID: pernoctanteUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.propuestaEliminarPernoctanteUI(datosEliminacion)
                                    })
                                    bloqueOpcionesCliente.appendChild(botonOpcionCliente)
                                    ///
                                }
                                if (estadoAlojamiento === "noAlojado") {
                                    //Cambiar habitacion
                                    botonOpcionCliente = document.createElement("div")
                                    botonOpcionCliente.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                    botonOpcionCliente.innerText = "Asignar a una habitaciÃ³n"
                                    botonOpcionCliente.setAttribute("componente", "botonOpcionClientePool")
                                    botonOpcionCliente.addEventListener("click", () => {
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.cambiarDeHabitacion.mostrasSelectorCambioPernoctanteHabitacion(pernoctanteUID)
                                    })
                                    bloqueOpcionesCliente.appendChild(botonOpcionCliente)
                                    //Eliminar pernoctane de la habitacion y de la reserva
                                    botonOpcionCliente = document.createElement("div")
                                    botonOpcionCliente.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                    botonOpcionCliente.setAttribute("componente", "botonOpcionClientePool")
                                    botonOpcionCliente.setAttribute("pernoctanteUID_", pernoctanteUID)
                                    //botonOpcionCliente.setAttribute("nombreCompleto_", nombreCompleto)
                                    botonOpcionCliente.setAttribute("clienteUID_", clienteUID)
                                    //botonOpcionCliente.setAttribute("pasaporte_", pasaporte)
                                    botonOpcionCliente.setAttribute("tipoEliminacion", "reserva")
                                    botonOpcionCliente.innerText = "Eliminar pernoctancte de la reserva"
                                    botonOpcionCliente.addEventListener("click", () => {
                                        const datosEliminacion = {
                                            tipoEliminacion: "reserva",
                                            pernoctanteUID: pernoctanteUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.propuestaEliminarPernoctanteUI(datosEliminacion)
                                    })
                                    bloqueOpcionesCliente.appendChild(botonOpcionCliente)
                                    ///
                                }
                                //Cerrar opciones del pernoctante
                                botonOpcionCliente = document.createElement("div")
                                botonOpcionCliente.classList.add("administracionReservasDetallesBotonOpcionCliente")
                                botonOpcionCliente.setAttribute("componente", "botonCerrarOpciones")
                                botonOpcionCliente.innerText = "Cerrar opciones del pernoctante"
                                botonOpcionCliente.addEventListener("click", (e) => {
                                    e.stopPropagation()
                                    let selectorFilasCliente = document.querySelectorAll("[componente=contenedorPernocanteHabitacion]")
                                    selectorFilasCliente.forEach((filaCliente) => {
                                        filaCliente.style.removeProperty("background")
                                    })
                                    const selectorContenedoresOpcionCliente = document.querySelectorAll("[contenedor=opcionesCliente]")
                                    selectorContenedoresOpcionCliente.forEach((contenedor) => {
                                        contenedor.remove()
                                    })
                                    document.querySelector("[componente=bloqueCalendario]")?.remove()
                                })
                                bloqueOpcionesCliente.appendChild(botonOpcionCliente)
                                document.querySelector("main:not([estado=obsoleto]").appendChild(bloqueOpcionesCliente)
                                document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarMenusVolatiles)
                            },
                            eliminarPernoctante: async (metadatos) => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const pernoctanteUID = metadatos.pernoctanteUID
                                const pernoctante = document
                                    .querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                const tipoPernoctante = pernoctante.getAttribute("tipoCliente")
                                const tipoEliminacion = metadatos.tipoEliminacion
                                const clienteUID = pernoctante.getAttribute("clienteUID")
                                const nombreCompleto = pernoctante.querySelector("[componente=nombreCompleto]").innerText
                                const pasaporte = pernoctante.querySelector("[componente=pasaporte]").innerHTML
                                const fechaCheckIn = pernoctante.getAttribute("fechaCheckIn")
                                const fechaCheckOut = pernoctante.getAttribute("fechaCheckOut")
                                const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/pernoctantes/eliminarPernoctanteReserva",
                                    reservaUID: String(reservaUID),
                                    pernoctanteUID: String(pernoctanteUID),
                                    tipoEliminacion: tipoEliminacion
                                }

                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                const metadatosPantallaCarga = {
                                    mensaje: "Esperando al servidor...",
                                    instanciaUID: instanciaUIDPantallaDeCarga,
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUIDPantallaDeCarga}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                selectorPantallaDeCarga.forEach((pantalla) => {
                                    pantalla.remove()
                                })
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    if (tipoEliminacion === "habitacion") {
                                        const metadatosPernoctante = {
                                            tipoPernoctante: "cliente",
                                            clienteUID: clienteUID,
                                            pernoctanteUID: pernoctanteUID,
                                            tipoPernoctante: tipoPernoctante,
                                            estadoAlojamiento: "noAlojado",
                                            fechaCheckIn: fechaCheckIn,
                                            fechaCheckOutAdelantado: fechaCheckOut
                                        }
                                        const bloquePernoctantes = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI(metadatosPernoctante)
                                        const metadatosNombre = {
                                            nombreCompleto: nombreCompleto,
                                            clienteUID: clienteUID,
                                        }
                                        const nombrePernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI(metadatosNombre)
                                        bloquePernoctantes.appendChild(nombrePernoctante)
                                        const metadatosPasaporte = {
                                            pasaporte: pasaporte,
                                            clienteUID: clienteUID
                                        }
                                        const selectorPernoctanteRenderizado = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        selectorPernoctanteRenderizado.remove()
                                        const identificacionPernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI(metadatosPasaporte)
                                        bloquePernoctantes.appendChild(identificacionPernoctante)
                                        const zonaDestino = document.querySelector(`[componente=contenedorPernoctantesSinHabitacion]`)
                                        zonaDestino.appendChild(bloquePernoctantes)
                                        zonaDestino.classList.remove("elementoOcultoInicialmente")
                                    }
                                    if (tipoEliminacion === "reserva") {
                                        const selectorPernoctanteRenderizado = document.querySelector(`[pernoctanteUID="${pernoctanteUID}"]`)
                                        selectorPernoctanteRenderizado.remove()
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.controlEspacioPernoctantesSinAlojamiento()
                                }
                            },
                            controlEspacioPernoctantesSinAlojamiento: () => {
                                const selectorMarcoPernoctantesSinAlojamiento = document.querySelector("[componente=espacioPernoctantesSinAlojamiento]")
                                const selectorPernoctantes = selectorMarcoPernoctantesSinAlojamiento.querySelectorAll("[contenedor=pernoctante]")
                                if (selectorPernoctantes.length > 0) {
                                    selectorMarcoPernoctantesSinAlojamiento.classList.remove("elementoOcultoInicialmente")
                                } else {
                                    selectorMarcoPernoctantesSinAlojamiento.classList.add("elementoOcultoInicialmente")
                                }
                            },
                            gestionPernoctante: {
                                desplegarUIPernoctante: async function () {
                                    document.body.style.overflow = "hidden";
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                                    const advertenciaInmersivaIU = document.createElement("div")
                                    advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                                    advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                                    advertenciaInmersivaIU.setAttribute("instanciaUID", instanciaUID)
                                    const contenedorAdvertenciaInmersiva = document.createElement("div")
                                    contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                    const contenidoAdvertenciaInmersiva = document.createElement("div")
                                    contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                    contenidoAdvertenciaInmersiva.setAttribute("espacio", "gestionTitular")
                                    const mensajeSpinner = "Esperando al servidor...."
                                    const spinner = casaVitini.ui.componentes.spinner(mensajeSpinner)
                                    contenidoAdvertenciaInmersiva.appendChild(spinner)
                                    contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                    advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                                    document.querySelector("main").appendChild(advertenciaInmersivaIU)
                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/pernoctantes/detallesDelPernoctantePorPernoctaneUID",
                                        reservaUID: reservaUID,
                                        pernoctanteUID: pernoctanteUID
                                    }
                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        consle.log("respies", respuestaServidor)
                                        /*
                                        {
                                            "ok": {
                                                "pernoctanteUID": 1586,
                                                "nombreCompleto": "rajoiCo nEspacio undefined ",
                                                "pasaporte": "234234234",
                                                "tipoPernoctante": "cliente"
                                            }
                                        }
                                         */

                                        const pernoctanteUID = respuestaServidor.pernoctanteUID
                                        const nombreCompleto = respuestaServidor.nombreCompleto
                                        const pasaporte = respuestaServidor.pasaporte
                                        const tipoPernoctante = respuestaServidor.tipoPernoctante

                                        const detallesTitular = respuestaServidor.ok.titular
                                        const tipoTitularIDV = detallesTitular?.tipoTitularIDV
                                        const seleccionarInstanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                        if (seleccionarInstanciaRenderizada) {
                                            seleccionarInstanciaRenderizada.querySelector("[contenedor=spinner]")?.remove()
                                            seleccionarInstanciaRenderizada.style.justifyContent = "flex - start";
                                            const destinoRenderizado = seleccionarInstanciaRenderizada.querySelector("[espacio=gestionTitular]")
                                            if (!detallesTitular) {
                                                const titulo = "AÃ±adir pernoctante a la reserva"
                                                const tituloUI = this.componentes.titulo(titulo)
                                                destinoRenderizado.appendChild(tituloUI)
                                                const info = "Esta reserva ahora mismo no tiene ningÃºn titular asignado.Para aÃ±adir un titular a la reserva, puedes buscar con el campo de bÃºsqueda inferior un cliente existente para asociarlo como titular.TambiÃ©n puedes crear un cliente nuevo rellenando el formulario para crear un cliente y aÃ±adirlo como titular a esta reserva."
                                                const infoUI = this.componentes.infoUI(info)
                                                destinoRenderizado.appendChild(infoUI)
                                                const nuevoClienteUI = this.componentes.nuevoCliente.UI({
                                                    instanciaUID
                                                })
                                                destinoRenderizado.appendChild(nuevoClienteUI)
                                                const botonCerrar = this.componentes.botonCerrar()
                                                destinoRenderizado.appendChild(botonCerrar)
                                            }
                                            if (tipoTitularIDV === "titularCliente") {
                                                const metadatosRespuestaUnificada = {
                                                    clienteUID: detallesTitular.clienteUID,
                                                    nombreCompleto: detallesTitular.nombreTitular,
                                                    pasaporte: detallesTitular.pasaporteTitular,
                                                    mail: detallesTitular.mailTitular,
                                                    telefono: detallesTitular.telefonoTitular,
                                                    instanciaUID: instanciaUID,
                                                    reservaUID: reservaUID
                                                }
                                                this.componentes.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                            }
                                            if (tipoTitularIDV === "titularPool") {
                                                const metadatosTitualPool = {
                                                    nombreTitular: detallesTitular.nombreTitular,
                                                    pasaporteTitular: detallesTitular.pasaporteTitular,
                                                    mailTitular: detallesTitular.mailTitular,
                                                    telefonoTitular: detallesTitular.telefonoTitular,
                                                    instanciaUID: instanciaUID
                                                }
                                                this.componentes.titularPool.UI(metadatosTitualPool)
                                            }
                                        }
                                    }
                                },
                                nuevoPernoctanteUI: async function (data) {
                                    const habitacionIDV = data.habitacionIDV
                                    const apartamentoIDV = data.apartamentoIDV
                                    const habitacionUID = data.habitacionUID
                                    const habitacionUI = data.habitacionUI
                                    const apartamentoUI = data.apartamentoUI

                                    const main = document.querySelector("main")
                                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    ui.setAttribute("operacion", "crearCliente")
                                    ui.setAttribute("habitacionUID", habitacionUID)

                                    const instanciaUID_ui = ui.getAttribute("instanciaUID")

                                    main.appendChild(ui)
                                    const contenedor = ui.querySelector("[componente=contenedor]")


                                    const titulo = `AÃ±adir pernoctante en la ${habitacionUI} del ${apartamentoUI}`
                                    const tituloUI = this.componentes.titulo(titulo)
                                    contenedor.appendChild(tituloUI)


                                    const banner = document.createElement("div")
                                    banner.classList.add(
                                        "flexVertical",
                                        "borderRadius12",
                                        "backgroundGrey1",
                                        "padding14",
                                        "gap6"
                                    )
                                    contenedor.appendChild(banner)


                                    const bannerReserva = casaVitini.
                                        administracion.
                                        reservas.
                                        detallesReserva.
                                        categoriasGlobales.
                                        alojamiento.
                                        componentesUI.
                                        bannerReservaMenus()
                                    banner.appendChild(bannerReserva)

                                    const bannerAlojamiento = casaVitini.
                                        administracion.
                                        reservas.
                                        detallesReserva.
                                        categoriasGlobales.
                                        alojamiento.
                                        componentesUI.
                                        bannerAlojamiento({
                                            apartamentoUI: apartamentoUI,
                                            apartamentoIDV: apartamentoIDV

                                        })
                                    banner.appendChild(bannerAlojamiento)

                                    const bannerHabitacion = casaVitini.
                                        administracion.
                                        reservas.
                                        detallesReserva.
                                        categoriasGlobales.
                                        alojamiento.
                                        componentesUI.
                                        bannerHabitacion({
                                            habitacionUI: habitacionUI,
                                            habitacionIDV: habitacionIDV

                                        })
                                    banner.appendChild(bannerHabitacion)

                                    const info = "AÃ±ade un pernoctante en la habitaciÃ³n, en el buscador rÃ¡pido puedes buscar si ya existe el cliente a aÃ±adir como pernoctante o puedes crear uno directamente aquÃ­ y aÃ±adirlo a la habitaciÃ³n"
                                    const infoUI = this.componentes.infoUI(info)
                                    contenedor.appendChild(infoUI)

                                    const buscadorUI = this.componentes.buscadorRapido.UI()
                                    contenedor.appendChild(buscadorUI)
                                    const nuevoClienteUI = this.componentes.nuevoCliente.UI({
                                        operacion: "crearCliente",
                                        habitacionUID
                                    })

                                    //guardarNuevoClienteYAnadirloComoPernoctnante
                                    contenedor.appendChild(nuevoClienteUI)
                                    const botonCerrar = this.componentes.botonCerrar()
                                    contenedor.appendChild(botonCerrar)

                                },
                                componentes: {
                                    buscadorRapido: {
                                        UI: function () {
                                            const contenedor = document.createElement("div")
                                            contenedor.classList.add("administracion_reservas_detallesReservas_gestionTitular_contenedorBuscador")
                                            contenedor.setAttribute("contenedor", "buscador")
                                            const info = document.createElement("div")
                                            info.classList.add("adminsitracion_reservas_detallesReservas_gestionTitular_infoBuscador")
                                            //contenedor.appendChild(info)
                                            const campoBuscador = document.createElement("input")
                                            campoBuscador.classList.add("administracion_reservas_detallesReserva_gestionTitular_campoBuscador")
                                            campoBuscador.placeholder = "Buscar un cliente existente"
                                            campoBuscador.setAttribute("campo", "buscador")
                                            campoBuscador.addEventListener("input", (e) => {
                                                this.listaResultadosUI({
                                                    e
                                                })
                                            })
                                            contenedor.appendChild(campoBuscador)
                                            return contenedor
                                        },
                                        listaResultadosUI: async function (data) {
                                            const evento = data.e
                                            const elemento = evento.target
                                            const terminoBusqueda = elemento.value

                                            const instanciaUIDBuscador = casaVitini.utilidades.codigoFechaInstancia()

                                            const selectorListaResultadosBuscadorRapidoRenderiaza = document.querySelectorAll("[componente=buscadorRapidoCliente]")
                                            selectorListaResultadosBuscadorRapidoRenderiaza.forEach((listaRenderizada) => {
                                                listaRenderizada.remove()
                                            })
                                            const campoVacio = elemento.value.length
                                            if (campoVacio === 0) {
                                                clearTimeout(casaVitini.componentes.temporizador);
                                                elemento.closest(`[contenedor=buscador]`).querySelector(`[instanciaUIDBuscador]`)?.remove()
                                                return
                                            }
                                            const listaResultados = document.createElement("div")
                                            listaResultados.setAttribute("componente", "buscadorRapidoCliente")
                                            listaResultados.setAttribute("instanciaUIDBuscador", instanciaUIDBuscador)
                                            listaResultados.classList.add("administracion_reservas_detallesReservas_gestionTitular_listaBuscador")

                                            listaResultados.innerText = null
                                            const info = document.createElement("p")
                                            info.classList.add("infoBuscando")
                                            info.setAttribute("componente", "info")

                                            info.innerText = "Buscando..."
                                            listaResultados.appendChild(info)

                                            const instanciaUIDRenderizada = elemento.closest(`[contenedor=buscador]`)
                                            instanciaUIDRenderizada.appendChild(listaResultados)
                                            clearTimeout(casaVitini.componentes.temporizador);
                                            casaVitini.componentes.temporizador = setTimeout(() => {
                                                this.transactor({
                                                    terminoBusqueda: terminoBusqueda,
                                                    instanciaUIDBuscador: instanciaUIDBuscador,

                                                })
                                            }, 1500);
                                        },
                                        transactor: async function (data) {
                                            const terminoBusqueda = data.terminoBusqueda
                                            const instanciaUIDBuscador = data.instanciaUIDBuscador

                                            const transaccion = {
                                                zona: "administracion/clientes/buscar",
                                                tipoBusqueda: "rapido",
                                                buscar: terminoBusqueda
                                            }
                                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                                            const listaBuscadorRenderizada = document.querySelector(`[instanciaUIDBuscador="${instanciaUIDBuscador}"]`)
                                            if (!listaBuscadorRenderizada) {
                                                return
                                            }
                                            if (respuestaServidor?.error) {
                                                return listaBuscadorRenderizada.querySelector("[componente=info]").innerHTML = respuestaServidor?.error
                                            }

                                            const resultadosClientes = respuestaServidor?.clientes
                                            if (resultadosClientes.length === 0) {
                                                return listaBuscadorRenderizada.querySelector("[componente=info]").innerHTML = "Nada encontrado"
                                            }
                                            listaBuscadorRenderizada.innerHTML = null
                                            resultadosClientes.forEach((clienteEncontrado) => {
                                                const clienteUID = clienteEncontrado.clienteUID
                                                const nombre = clienteEncontrado.nombre
                                                const primerApellido = clienteEncontrado.primerApellido
                                                const segundoApellido = clienteEncontrado.segundoApellido
                                                const pasaporte = clienteEncontrado.pasaporte
                                                const bloqueCliente = document.createElement("div")
                                                bloqueCliente.classList.add("administracionReservaDetallesBuscadorRapidoBloqueCliente")
                                                bloqueCliente.setAttribute("clienteUID", clienteUID)
                                                bloqueCliente.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                                bloqueCliente.addEventListener("click", (e) => {

                                                    const habitacionUID = e.target.closest("[operacion]").getAttribute("habitacionUID")
                                                    const operacion = e.target.closest("[operacion]").getAttribute("operacion")
                                                    if (operacion === "crearCliente") {

                                                        this.anadirPernoctanteTransaccion({
                                                            e,
                                                            clienteUID,
                                                            habitacionUID,

                                                        })
                                                    }
                                                    if (operacion === "sustituirClientePoolPorClienteVitini") {
                                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.gestionPernoctante.componentes.buscadorRapido.asociarCliente({
                                                            clienteUID: clienteUID,
                                                        })
                                                    }


                                                })



                                                const filaNombre = document.createElement("p")
                                                filaNombre.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaNombre")
                                                filaNombre.innerText = `${nombre} ${primerApellido} ${segundoApellido}`
                                                filaNombre.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                                bloqueCliente.appendChild(filaNombre)
                                                const filaPasaporte = document.createElement("p")
                                                filaPasaporte.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaPasaporte")
                                                filaPasaporte.innerText = pasaporte
                                                filaPasaporte.setAttribute("componente", "elementoResultadosBuscadorRapido")
                                                bloqueCliente.appendChild(filaPasaporte)
                                                listaBuscadorRenderizada.appendChild(bloqueCliente)
                                            })
                                        },
                                        asociarCliente: async (data) => {
                                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                            const clienteUID = data.clienteUID
                                            const instanciaUIDContenedor = data.instanciaUIDContenedor
                                            const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                            const opcionesPantallaDeCarga = {
                                                instanciaUID: instanciaUIDPantallaDeCarga,
                                                mensaje: "Asociando cliente a la titularidad de esta reserva"
                                            }
                                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                            const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)

                                            const respuestaServidor = await casaVitini.shell.servidor({
                                                zona: "administracion/reservas/detallesReserva/gestionTitular/asociarTitular",
                                                clienteUID: String(clienteUID),
                                                reservaUID: reservaUID
                                            })

                                            if (respuestaServidor?.error) {
                                                pantallaDeCargaRenderizada?.remove()
                                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                            }
                                            if (respuestaServidor?.ok) {
                                                //casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                pantallaDeCargaRenderizada?.remove()
                                                const nuevoClienteUID = respuestaServidor.clienteUID
                                                const nombreCompleto = respuestaServidor.nombreCompleto
                                                const nombre = respuestaServidor.nombre
                                                const primerApellido = respuestaServidor.primerApellido
                                                const segundoApellido = respuestaServidor.segundoApellido
                                                const clienteUID = respuestaServidor.clienteUID
                                                const mail = respuestaServidor.mail
                                                const pasaporte = respuestaServidor.pasaporte
                                                const telefono = respuestaServidor.telefono
                                                const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                                const selectorNombreTitular = document.querySelector(`[dataReserva=nombreTitular]`)
                                                if (selectorNombreTitularRenderizado && selectorNombreTitular) {
                                                    selectorNombreTitular.innerText = nombreCompleto
                                                    const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                                    selectorBloqueTitular.setAttribute("tipoTitular", "titularCliente")
                                                    selectorBloqueTitular.setAttribute("titularUID", nuevoClienteUID)
                                                }
                                                const metadatosRespuestaUnificada = {
                                                    clienteUID: clienteUID,
                                                    nombreCompleto: nombreCompleto,
                                                    pasaporte: pasaporte,
                                                    mail: mail,
                                                    telefono: telefono,
                                                    instanciaUID: instanciaUIDContenedor,
                                                    reservaUID: reservaUID
                                                }
                                                casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                            }
                                        },
                                        anadirPernoctanteTransaccion: async (data) => {
                                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                            const clienteUID = data.clienteUID
                                            const habitacionUID = data.habitacionUID
                                            const e = data.e
                                            const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                            const instanciaUID_nuevoPernoctanteUI = e.target.closest("[operacion=crearCliente]").getAttribute("instanciaUID")

                                            const metadatosPantallaCarga = {
                                                mensaje: "Esperando al servidor...",
                                                instanciaUID: instanciaUIDPantallaDeCarga,
                                            }
                                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)

                                            const respuestaServidor = await casaVitini.shell.servidor({
                                                zona: "administracion/reservas/detallesReserva/alojamiento/anadirPernoctanteHabitacion",
                                                reservaUID,
                                                clienteUID: String(clienteUID),
                                                habitacionUID
                                            })

                                            const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUIDPantallaDeCarga}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                            selectorPantallaDeCarga.forEach((pantalla) => {
                                                pantalla.remove()
                                            })
                                            const selectorBloqueAnadirPernoctante = document.querySelector(`[instanciaUID="${instanciaUID_nuevoPernoctanteUI}"]`)
                                            if (!selectorBloqueAnadirPernoctante) {
                                                return
                                            }
                                            if (respuestaServidor?.error) {
                                                return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                            }
                                            if (respuestaServidor?.ok) {
                                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()

                                                const pernoctante = respuestaServidor.pernoctante
                                                const cliente = respuestaServidor.cliente

                                                const clienteUID = cliente.clienteUID
                                                const pernoctanteUID = pernoctante.componenteUID
                                                const nombre = cliente.nombre
                                                const primerApellido = cliente.primerApellido
                                                const segundoApellido = cliente.segundoApellido
                                                const pasaporte = cliente.pasaporte


                                                const bloquePernoctantes = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI({
                                                    tipoPernoctante: "cliente",
                                                    clienteUID: clienteUID,
                                                    pernoctanteUID: pernoctanteUID,
                                                    estadoAlojamiento: "alojado"
                                                })

                                                const nombrePernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI({
                                                    nombreCompleto: `${nombre} ${primerApellido} ${segundoApellido}`,
                                                    clienteUID: clienteUID,
                                                })
                                                bloquePernoctantes.appendChild(nombrePernoctante)

                                                const identificacionPernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI({
                                                    pasaporte: pasaporte,
                                                    clienteUID: clienteUID
                                                })
                                                bloquePernoctantes.appendChild(identificacionPernoctante)



                                                const habitacionDestino = document.querySelector(`[habitacionUID="${habitacionUID}"]`)
                                                habitacionDestino.appendChild(bloquePernoctantes)
                                            }
                                        },
                                    },
                                    nuevoCliente: {
                                        UI: function (data) {

                                            const operacion = data.operacion

                                            let tituloNuevoCliente
                                            let tituloBotonCrear
                                            if (operacion === "crearCliente") {
                                                tituloNuevoCliente = "Crear un nuevo cliente e insertarlo en la reserva como pernoctante"
                                                tituloBotonCrear = "Crear cliente e insertarlo en la reserva como pernoctante"
                                            }
                                            if (operacion === "sustituirClientePool") {
                                                tituloNuevoCliente = "Crear un nuevo cliente e insertarlo en la reserva sustituyendolo por el cliente pool"
                                                tituloBotonCrear = "Crear cliente y sustituirlo por el cliente pool"
                                            }


                                            const nuevoClienteUI = document.createElement("div")
                                            nuevoClienteUI.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI")
                                            nuevoClienteUI.setAttribute("formulario", "nuevoCliente")

                                            const info = document.createElement("p")
                                            info.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_info")
                                            info.classList.add("negrita")
                                            info.innerText = tituloNuevoCliente
                                            nuevoClienteUI.appendChild(info)
                                            const campoNombre = document.createElement("input")
                                            campoNombre.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            campoNombre.setAttribute("campo", "nombre")
                                            campoNombre.setAttribute("formulario", "AnadirPernoctante")
                                            campoNombre.placeholder = "Nombre(obligatiorio)"
                                            nuevoClienteUI.appendChild(campoNombre)
                                            const primerApellido = document.createElement("input")
                                            primerApellido.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            primerApellido.setAttribute("campo", "primerApellido")
                                            primerApellido.setAttribute("formulario", "AnadirPernoctante")
                                            primerApellido.placeholder = "Primer apellido"
                                            nuevoClienteUI.appendChild(primerApellido)
                                            const segundoApellido = document.createElement("input")
                                            segundoApellido.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            segundoApellido.setAttribute("campo", "segundoApellido")
                                            segundoApellido.setAttribute("formulario", "AnadirPernoctante")
                                            segundoApellido.placeholder = "Segundo apellido"
                                            nuevoClienteUI.appendChild(segundoApellido)
                                            const pasaporte = document.createElement("input")
                                            pasaporte.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            pasaporte.setAttribute("campo", "pasaporte")
                                            pasaporte.setAttribute("formulario", "AnadirPernoctante")
                                            pasaporte.placeholder = "Pasaporte(obligatorio)"
                                            nuevoClienteUI.appendChild(pasaporte)
                                            const telefono = document.createElement("input")
                                            telefono.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            telefono.setAttribute("campo", "telefono")
                                            telefono.setAttribute("formulario", "AnadirPernoctante")
                                            telefono.placeholder = "TelÃ©fono"
                                            nuevoClienteUI.appendChild(telefono)
                                            const correoElecotronico = document.createElement("input")
                                            correoElecotronico.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_campo")
                                            correoElecotronico.setAttribute("campo", "correoElectronico")
                                            correoElecotronico.setAttribute("formulario", "AnadirPernoctante")
                                            correoElecotronico.placeholder = "Correo electrÃ³nico"
                                            nuevoClienteUI.appendChild(correoElecotronico)
                                            const botonGuardarNuevoCliente = document.createElement("div")
                                            botonGuardarNuevoCliente.setAttribute("boton", "crearCliente")
                                            botonGuardarNuevoCliente.classList.add("administracion_reservas_detallesReservas_gestionTitular_nuevoClienteUI_botonV1")
                                            botonGuardarNuevoCliente.innerText = tituloBotonCrear

                                            if (operacion === "crearCliente") {
                                                botonGuardarNuevoCliente.addEventListener("click", (e) => {
                                                    this.guardarNuevoClienteYAnadirloComoPernoctnante({
                                                        e
                                                    })
                                                })
                                            }

                                            if (operacion === "sustituirClientePool") {
                                                botonGuardarNuevoCliente.addEventListener("click", (e) => {

                                                })
                                            }

                                            nuevoClienteUI.appendChild(botonGuardarNuevoCliente)
                                            return nuevoClienteUI
                                        },
                                        transactor: async function (instanciaUID) {
                                            const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                            const opcionesPantallaDeCarga = {
                                                instanciaUID: instanciaUIDPantallaDeCarga,
                                                mensaje: "Asociando cliente a la titularidad de esta reserva"
                                            }
                                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(opcionesPantallaDeCarga)
                                            const pantallaDeCargaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                            const campos = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`).querySelectorAll("[campo]")
                                            const metadatos = {
                                                zona: "administracion/reservas/gestionTitular/crearTitular",
                                                reservaUID: reservaUID
                                            }
                                            campos.forEach((campo) => {
                                                const nombreCampo = campo.getAttribute("campo")
                                                const valorCampo = campo.value
                                                metadatos[nombreCampo] = valorCampo
                                            })
                                            const respuestaServidor = await casaVitini.shell.servidor(metadatos)
                                            if (respuestaServidor?.error) {
                                                pantallaDeCargaRenderizada?.remove()
                                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                            }
                                            if (respuestaServidor?.ok) {
                                                //casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                pantallaDeCargaRenderizada?.remove()
                                                const nuevoClienteUID = respuestaServidor.clienteUID
                                                const nombreCompleto = respuestaServidor.nombreCompleto
                                                const clienteUID = respuestaServidor.clienteUID
                                                const mail = respuestaServidor.mail
                                                const telefono = respuestaServidor.telefono
                                                const pasaporte = respuestaServidor.pasaporte
                                                const selectorNombreTitularRenderizado = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                                const selectorNombreTitular = document.querySelector(`[dataReserva=nombreTitular]`)
                                                if (selectorNombreTitularRenderizado && selectorNombreTitular) {
                                                    selectorNombreTitular.innerText = nombreCompleto
                                                    const selectorBloqueTitular = document.querySelector(`[contenedor=titularUID]`)
                                                    selectorBloqueTitular.setAttribute("tipoTitular", "titularCliente")
                                                    selectorBloqueTitular.setAttribute("titularUID", nuevoClienteUID)
                                                }
                                                const metadatosRespuestaUnificada = {
                                                    clienteUID: clienteUID,
                                                    nombreCompleto: nombreCompleto,
                                                    pasaporte: pasaporte,
                                                    mail: mail,
                                                    telefono: telefono,
                                                    instanciaUID: instanciaUID,
                                                    reservaUID: reservaUID
                                                }
                                                this.respuestaUnificadaUI(metadatosRespuestaUnificada)
                                            }
                                        },
                                        guardarNuevoClienteYSustituirloPorElClientePoolActual: async (instanciaUID) => {
                                            const pernoctanteUID_DesdeInstancia = document.querySelector(`[instanciaUID="${instanciaUID}"]`).getAttribute("pernoctanteUID")
                                            const instanciaUID_pantallaPropuestaConfirmada = casaVitini.utilidades.codigoFechaInstancia()
                                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                            const campos = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`).querySelectorAll("[campo]")
                                            const metadatosPantallaCarga = {
                                                mensaje: "Esperando al servidor...",
                                                instanciaUID: instanciaUID_pantallaPropuestaConfirmada,
                                            }
                                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                            const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUID_pantallaPropuestaConfirmada}"]`)
                                            const transaccion = {
                                                zona: "administracion/reservas/guardarNuevoClienteYSustituirloPorElClientePoolActual",
                                                reserva: Number(reservaUID),
                                                pernoctanteUID: Number(pernoctanteUID_DesdeInstancia)
                                            }
                                            campos.forEach((campo) => {
                                                const nombreCampo = campo.getAttribute("campo")
                                                const valorCampo = campo.value
                                                transaccion[nombreCampo] = valorCampo
                                            })
                                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                            if (!selectorPantallaDeCarga) {

                                            }
                                            selectorPantallaDeCarga.forEach((pantalla) => {
                                                pantalla.remove()
                                            })
                                            if (respuestaServidor?.error) {
                                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                            }
                                            if (respuestaServidor?.ok) {
                                                const nuevoClienteUID = respuestaServidor.nuevoClienteUID
                                                const nombreCompleto = respuestaServidor.nombreCompleto
                                                const pasaporte = respuestaServidor.pasaporte
                                                const habitacionUID = respuestaServidor.habitacionUID
                                                const selectorInstanciaRaiz = document.querySelectorAll(`[instanciaUID="${instanciaUID}"]`)
                                                selectorInstanciaRaiz.forEach((pantalla) => {
                                                    pantalla.remove()
                                                })
                                                const selectorContenedorPernoctanteAntiguo = document.querySelector(`[contenedor=pernoctante][pernoctanteUID="${pernoctanteUID_DesdeInstancia}"]`)
                                                selectorContenedorPernoctanteAntiguo.remove()
                                                if (habitacionUID) {
                                                    const selectorHabitacion = document.querySelector(`[habitacionUID="${habitacionUID}"]`)
                                                    let metadatos = {
                                                        tipoPernoctante: "cliente",
                                                        clienteUID: nuevoClienteUID,
                                                        pernoctanteUID: pernoctanteUID_DesdeInstancia,
                                                        estadoAlojamiento: "alojado",
                                                    }
                                                    const bloquePernoctantes = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI(metadatos)
                                                    metadatos = {
                                                        nombreCompleto: nombreCompleto,
                                                    }
                                                    const nombrePernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI(metadatos)
                                                    bloquePernoctantes.appendChild(nombrePernoctante)
                                                    metadatos = {
                                                        pasaporte: pasaporte,
                                                    }
                                                    const identificacionPernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI(metadatos)
                                                    bloquePernoctantes.appendChild(identificacionPernoctante)
                                                    selectorHabitacion.appendChild(bloquePernoctantes)
                                                } else {
                                                    const metadatosBloquePernoctantes = {
                                                        tipoPernoctante: "cliente",
                                                        clienteUID: nuevoClienteUID,
                                                        pernoctanteUID: pernoctanteUID_DesdeInstancia,
                                                        estadoAlojamiento: "noAlojado"
                                                    }
                                                    const bloquePernoctantes = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI(metadatosBloquePernoctantes)
                                                    const metadatosNombreUi = {
                                                        nombreCompleto: nombreCompleto,
                                                    }
                                                    const nombrePernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI(metadatosNombreUi)
                                                    bloquePernoctantes.appendChild(nombrePernoctante)
                                                    const metadatosPasaporte = {
                                                        pasaporte: pasaporte,
                                                    }
                                                    const identificacionPernoctante = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI(metadatosPasaporte)
                                                    bloquePernoctantes.appendChild(identificacionPernoctante)
                                                    const zonaDestino = document.querySelector(`[componente=contenedorPernoctantesSinHabitacion]`)
                                                    zonaDestino.appendChild(bloquePernoctantes)
                                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.controlEspacioPernoctantesSinAlojamiento()
                                                }
                                            }
                                        },
                                        guardarNuevoClienteYAnadirloComoPernoctnante: async (data) => {

                                            const e = data.e
                                            const contenedor = e.target.closest("[operacion]")
                                            const instanciaUID_contenedorNuevoPernoctanteUI = contenedor.getAttribute("instanciaUID")
                                            const habitacionUID = contenedor.getAttribute("habitacionUID")
                                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                            const campos = e.target.closest("[formulario=nuevoCliente]").querySelectorAll(`[campo]`)
                                            const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()

                                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta({
                                                mensaje: "Creando cliente y asignÃ¡ndolo a la habitaciÃ³n...",
                                                instanciaUID: instanciaUIDPantallaDeCarga,
                                            })

                                            const transaccion = {
                                                zona: "administracion/reservas/detallesReserva/pernoctantes/crearClienteDesdeReservaYAnadirloAreserva",
                                                reservaUID: reservaUID,
                                                habitacionUID: habitacionUID
                                            }
                                            campos.forEach((campo) => {
                                                const nombreCampo = campo.getAttribute("campo")
                                                const datoCampo = campo.value
                                                transaccion[nombreCampo] = datoCampo
                                            })
                                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                                            const selectorPantallaDeCarga = document.querySelector(`[instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                                            if (!selectorPantallaDeCarga) {
                                                return
                                            }
                                            selectorPantallaDeCarga.remove()
                                            if (respuestaServidor?.error) {
                                                return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor.error)
                                            }
                                            if (respuestaServidor?.ok) {

                                                const selectorAnadirPernoctanteRedenrizada = document.querySelector(`[instanciaUID="${instanciaUID_contenedorNuevoPernoctanteUI}"]`)
                                                if (selectorAnadirPernoctanteRedenrizada) {
                                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                                }

                                                const datosNuevoCliente = respuestaServidor.nuevoCliente
                                                const nombre = datosNuevoCliente.nombre
                                                const primerApellido = datosNuevoCliente.primerApellido ? datosNuevoCliente.primerApellido : ""
                                                const segundoApellido = datosNuevoCliente.segundoApellido ? datosNuevoCliente.segundoApellido : ""
                                                const pasaporte = datosNuevoCliente.pasaporte
                                                const telefono = datosNuevoCliente.telefono
                                                const correoElectronico = datosNuevoCliente.correoElectronico

                                                const pernoctanteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteUI({
                                                    tipoPernoctante: "cliente",
                                                    clienteUID: respuestaServidor?.nuevoUIDCliente,
                                                    pernoctanteUID: respuestaServidor?.nuevoUIDPernoctante,
                                                    estadoAlojamiento: "alojado"
                                                })

                                                const pernoctanteNombreUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctanteNombreUI({
                                                    clienteUID: respuestaServidor?.nuevoUIDCliente,
                                                    nombreCompleto: `${nombre} ${primerApellido} ${segundoApellido}`
                                                })

                                                const pernoctantePasaporteUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.alojamiento.pernoctantes.pernoctantePasaporteUI({
                                                    clienteUID: respuestaServidor?.nuevoUIDCliente,
                                                    pasaporte: transaccion.pasaporte
                                                })
                                                pernoctanteUI.appendChild(pernoctanteNombreUI)
                                                pernoctanteUI.appendChild(pernoctantePasaporteUI)
                                                const selectorHabitacionDestino = document.querySelector(`[habitacionUID="${habitacionUID}"]`)
                                                selectorHabitacionDestino.appendChild(pernoctanteUI)
                                            }
                                        },

                                    },

                                    detallesDelTitularUI: (detallesDelTitular) => {
                                        const clienteUID = detallesDelTitular.clienteUID
                                        const nombreTitular = detallesDelTitular.nombreTitular
                                        const pasaporteTitular = detallesDelTitular.pasaporteTitular
                                        const tipoTitular = detallesDelTitular.tipoTitular

                                        const mailTitular = detallesDelTitular.mailTitular ? detallesDelTitular.mailTitular : "(Sin mail)"
                                        const telefonoTitular = detallesDelTitular.telefonoTitular ? detallesDelTitular.telefonoTitular : "(Sin telefono)"
                                        const detallesRapidosDelTitular = document.createElement("div")
                                        detallesRapidosDelTitular.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedorGlobal")
                                        //Nombre completo titular
                                        let contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        let nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "Nombre completo del titular"
                                        contenedorDato.appendChild(nombreDato)
                                        let valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = nombreTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //Pasaporte titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "Pasaporte"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = pasaporteTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //telefono titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "TelÃ©fono"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = telefonoTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //mail titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "e - Mail"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = mailTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        return detallesRapidosDelTitular
                                    },
                                    detallesDelTitularPoolUI: (detallesDelTitular) => {
                                        const nombreTitular = detallesDelTitular.nombreTitular
                                        const pasaporteTitular = detallesDelTitular.pasaporteTitular
                                        const tipoTitular = "Titular pool"
                                        const mailTitular = detallesDelTitular.mailTitular ? detallesDelTitular.mailTitular : "(Sin mail)"
                                        const telefonoTitular = detallesDelTitular.telefonoTitular ? detallesDelTitular.telefonoTitular : "(Sin telefono)"
                                        const detallesRapidosDelTitular = document.createElement("div")
                                        detallesRapidosDelTitular.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedorGlobal")
                                        //Nombre completo titular
                                        let contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        let nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "Nombre completo del titular"
                                        contenedorDato.appendChild(nombreDato)
                                        let valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = nombreTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //Pasaporte titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "Pasaporte"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = pasaporteTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //telefono titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "TelÃ©fono"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = telefonoTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        //mail titular
                                        contenedorDato = document.createElement("div")
                                        contenedorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_contenedor")
                                        nombreDato = document.createElement("div")
                                        nombreDato.classList.add("administracion_reservas_detallesReserva_infoTitular_nombreDato")
                                        nombreDato.innerText = "e - Mail"
                                        contenedorDato.appendChild(nombreDato)
                                        valorDato = document.createElement("div")
                                        valorDato.classList.add("administracion_reservas_detallesReserva_infoTitular_dato")
                                        valorDato.classList.add("negrita")
                                        valorDato.innerText = mailTitular
                                        contenedorDato.appendChild(valorDato)
                                        detallesRapidosDelTitular.appendChild(contenedorDato)
                                        return detallesRapidosDelTitular
                                    },
                                    botonCerrarFormularioNuevoCliente: () => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerHTML = "Cerrar gestiÃ³n del titular de la reserva"
                                        boton.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                        boton
                                    },
                                    botonCerrar: () => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerHTML = "Cerrar y volver a la reserva"
                                        boton.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                        return boton
                                    },
                                    botonDesasociar: (metadatos) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerHTML = "Desasociar cliente como titular"
                                        boton.setAttribute("boton", "desasociarTitular")
                                        boton.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.desasociarClienteComoTitular(metadatos)
                                        })
                                        return boton
                                    },
                                    botonCambiarTitular: (instanciaUID) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerHTML = "Cambiar titular"
                                        boton.setAttribute("boton", "cambiarTitular")
                                        boton.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.cambiarTitular(instanciaUID)
                                        })
                                        return boton
                                    },
                                    botonIrALaFichaDelClinete: (clienteUID) => {
                                        const boton = document.createElement("a")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerHTML = "Ir a la ficha del cliente"
                                        boton.setAttribute("href", "/administracion/clientes/" + clienteUID)
                                        boton.setAttribute("vista", "/administracion/clientes/" + clienteUID)
                                        boton.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                        return boton
                                    },
                                    titulo: (titulo) => {
                                        const tituloUI = document.createElement("p")
                                        tituloUI.classList.add("detallesReservaTituloCancelarReserva")
                                        tituloUI.innerText = titulo
                                        return tituloUI
                                    },
                                    infoUI: (info) => {
                                        const infoUI = document.createElement("p")
                                        infoUI.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                        infoUI.innerText = info
                                        return infoUI
                                    },
                                    botonCerrarCambiarTitular: (instanciaUID) => {
                                        const boton = document.createElement("div")
                                        boton.classList.add("administracion_reservas_detallesReservas_gestionTitular_botonCerrar")
                                        boton.innerHTML = "Cerrar formulario para cambiar de titular"
                                        boton.setAttribute("boton", "cerrarCambiarTitular")
                                        boton.addEventListener("click", () => {
                                            casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.cancelarCambiarTitular(instanciaUID)
                                        })
                                        return boton
                                    },
                                    cambiarTitular: (instanciaUID) => {
                                        const selectorBotonCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cambiarTitular]`)
                                        const selectorBotonDesasociar = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=desasociarTitular]`)
                                        selectorBotonCambiarTitular.style.display = "none"
                                        selectorBotonDesasociar.style.display = "none"
                                        const selectorNuevoClienteUI = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`)
                                        selectorNuevoClienteUI.removeAttribute("style")
                                        const selectorbotonCerrarCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cerrarCambiarTitular]`)
                                        selectorbotonCerrarCambiarTitular.removeAttribute("style")
                                    },
                                    respuestaUnificadaUI: function (metadatos) {
                                        const clienteUID = metadatos.clienteUID
                                        const nombreCompleto = metadatos.nombreCompleto
                                        const pasaporte = metadatos.pasaporte
                                        const mail = metadatos.mailTitular
                                        const telefono = metadatos.telefon
                                        const instanciaUID = metadatos.instanciaUID
                                        const reservaUID = metadatos.reservaUID
                                        const selectorDestinoRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"] [espacio=gestionTitular]`)
                                        if (selectorDestinoRenderizado) {
                                            selectorDestinoRenderizado.innerHTML = null
                                            const titulo = "Detalles del titular"
                                            const tituloUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.titulo(titulo)
                                            selectorDestinoRenderizado.appendChild(tituloUI)
                                            const info = "Vista rÃ¡pida de los detalles del titular de la reserva.Puedes cambiar el titular de la reserva si lo necesitas o desasociar el titular.TambiÃ©n puedes cambiar el titular, esto te permite rellenar los datos mientras ves los datos del actual titular por si fuera necesario."
                                            const infoUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.infoUI(info)
                                            selectorDestinoRenderizado.appendChild(infoUI)
                                            const detallesDelTitular = {
                                                clienteUID: clienteUID,
                                                nombreTitular: nombreCompleto,
                                                pasaporteTitular: pasaporte,
                                                tipoTitular: "titularCliente",
                                                mailTitular: mail,
                                                telefonoTitular: telefono,
                                            }
                                            const detallesDelTitularUI = this.detallesDelTitularUI(detallesDelTitular)
                                            selectorDestinoRenderizado.appendChild(detallesDelTitularUI)
                                            const botonIrALaFichaDelClinete = this.botonIrALaFichaDelClinete(detallesDelTitular.clienteUID)
                                            selectorDestinoRenderizado.appendChild(botonIrALaFichaDelClinete)
                                            const botonCambiarTitular = this.botonCambiarTitular(instanciaUID)
                                            selectorDestinoRenderizado.appendChild(botonCambiarTitular)
                                            const buscadorUI = this.buscadorRapido.UI({
                                                instanciaUID
                                            })
                                            selectorDestinoRenderizado.appendChild(buscadorUI)

                                            const nuevoClienteUI = this.nuevoCliente.UI({
                                                instanciaUID
                                            })
                                            nuevoClienteUI.style.display = "none"
                                            selectorDestinoRenderizado.appendChild(nuevoClienteUI)
                                            const metadatosBotonDesasociar = {
                                                instanciaUID: instanciaUID,
                                                reservaUID: reservaUID
                                            }
                                            const botonCerrarCambiarTitular = this.botonCerrarCambiarTitular(instanciaUID)
                                            botonCerrarCambiarTitular.style.display = "none"
                                            selectorDestinoRenderizado.appendChild(botonCerrarCambiarTitular)
                                            const botonDesasociar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonDesasociar(metadatosBotonDesasociar)
                                            selectorDestinoRenderizado.appendChild(botonDesasociar)
                                            const botonCerrar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCerrar()
                                            selectorDestinoRenderizado.appendChild(botonCerrar)
                                        }
                                    },
                                    cancelarCambiarTitular: (instanciaUID) => {
                                        const selectorBotonCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cambiarTitular]`)
                                        const selectorBotonDesasociar = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=desasociarTitular]`)
                                        selectorBotonCambiarTitular.removeAttribute("style")
                                        selectorBotonDesasociar.removeAttribute("style")
                                        const selectorNuevoClienteUI = document.querySelector(`[instanciaUID="${instanciaUID}"] [formulario=nuevoCliente]`)
                                        selectorNuevoClienteUI.style.display = "none"
                                        const selectorbotonCerrarCambiarTitular = document.querySelector(`[instanciaUID="${instanciaUID}"] [boton=cerrarCambiarTitular]`)
                                        selectorbotonCerrarCambiarTitular.style.display = "none"
                                    },
                                    titularPool: {
                                        UI: async function (metadatos) {
                                            const nombreTitular = metadatos.nombreTitular
                                            const pasaporteTitular = metadatos.pasaporteTitular
                                            const mailTitular = metadatos.mailTitular
                                            const telefonoTitular = metadatos.telefonoTitular
                                            const tipoTitular = metadatos.tipoTitular
                                            const instanciaUID = metadatos.instanciaUID
                                            const selectorDestinoRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"] [espacio=gestionTitular]`)
                                            if (selectorDestinoRenderizado) {
                                                const titulo = "Datos del titular no verificado (POOL)"
                                                const tituloUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.titulo(titulo)
                                                selectorDestinoRenderizado.appendChild(tituloUI)
                                                const info = "Vista de los datos del titular Pool.Estos datos provienen del cliente.Por lo tanto, deben de verificarse con la base de datos de clientes."
                                                const infoUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.infoUI(info)
                                                selectorDestinoRenderizado.appendChild(infoUI)
                                                const detallesDelTitular = {
                                                    //clienteUID: clienteUID,
                                                    nombreTitular: nombreTitular,
                                                    pasaporteTitular: pasaporteTitular,
                                                    tipoTitular: "titularCliente",
                                                    mailTitular: mailTitular,
                                                    telefonoTitular: telefonoTitular,
                                                }
                                                const detallesDelTitularUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.detallesDelTitularUI(detallesDelTitular)
                                                selectorDestinoRenderizado.appendChild(detallesDelTitularUI)
                                                const info2 = "Primero use en el campo de bÃºsqueda para ver si existe ya una ficha del cliente para poder asociarlo.Si no existiera la ficha del cliente puede crear una en el formulario de abajo.Si selecciona un cliente existente o crea una nueva ficha del cliente desde aquÃ­ se asociarÃ¡ automÃ¡ticamente como titular de esta reserva "
                                                const infoUI2 = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.infoUI(info2)
                                                selectorDestinoRenderizado.appendChild(infoUI2)

                                                const buscadorUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.buscadorRapido.UI({
                                                    instanciaUID
                                                })
                                                selectorDestinoRenderizado.appendChild(buscadorUI)

                                                const nuevoClienteUI = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.nuevoCliente.UI({
                                                    instanciaUID
                                                })


                                                selectorDestinoRenderizado.appendChild(nuevoClienteUI)
                                                const botonCerrar = casaVitini.administracion.reservas.detallesReserva.reservaUI.titular.componentes.botonCerrar()
                                                selectorDestinoRenderizado.appendChild(botonCerrar)
                                            }
                                            //Obtenemos datos
                                        }
                                    }
                                }
                            },
                        },
                    },
                    enlacesDePago: {
                        detallesEnlace: {
                            UI: async (detallesEnlace) => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                document.querySelector("[componente=iconoCargaEnlace]")?.remove()
                                const uidEnlace = detallesEnlace.reserva
                                const nombreEnlace = detallesEnlace.nombreEnlace
                                const codigo = detallesEnlace.codigo
                                const precio = detallesEnlace.precio
                                const descripcion = detallesEnlace.descripcion
                                const estadoPago = detallesEnlace.estadoPago
                                const caducidadUTC = detallesEnlace.caducidadUTC
                                const caducidadMadrid = detallesEnlace.caducidadMadrid
                                const caducidadNicaragua = detallesEnlace.caducidadNicaragua
                                const contenedorAdvertenciaInmersiva = document.createElement("div")
                                contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                const contenidoAdvertenciaInmersiva = document.createElement("div")
                                contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                const titulo = document.createElement("p")
                                titulo.classList.add("detallesReservaTituloCancelarReserva")
                                titulo.innerText = "Detalles del enlace de pago"
                                contenidoAdvertenciaInmersiva.appendChild(titulo)
                                const bloque = document.createElement("div")
                                bloque.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                                const info = document.createElement("div")
                                info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                info.innerText = `AquÃ­ tienes los detalles del enlace de pago generado y vigente`
                                bloque.appendChild(info)
                                const campoNombre = document.createElement("input")
                                campoNombre.classList.add("detallesReserva_campoNombreEnlace")
                                campoNombre.placeholder = "Escribe un nombre para el nuevo enlace o genere el enlace con un nombre generico"
                                campoNombre.setAttribute("campo", "nombreEnlace")
                                campoNombre.value = nombreEnlace
                                bloque.appendChild(campoNombre)
                                const contenedorCacudidaUTC = document.createElement("div")
                                contenedorCacudidaUTC.classList.add("detallesReserva_contenedorCaducidad")
                                const tituloCadicdadUTC = document.createElement("div")
                                tituloCadicdadUTC.classList.add("detallesReserva_caducidadTitulo")
                                tituloCadicdadUTC.classList.add("negrita")
                                tituloCadicdadUTC.innerText = "Caducidad en horario universal(UTC)"
                                contenedorCacudidaUTC.appendChild(tituloCadicdadUTC)
                                const caducidadUIUTC = document.createElement("div")
                                caducidadUIUTC.classList.add("detallesReserva_caduciadaUI")
                                caducidadUIUTC.innerText = caducidadUTC
                                contenedorCacudidaUTC.appendChild(caducidadUIUTC)
                                bloque.append(contenedorCacudidaUTC)
                                const contenedorCadudidaMadrid = document.createElement("div")
                                contenedorCadudidaMadrid.classList.add("detallesReserva_contenedorCaducidad")
                                const tituloCadicdadMadrid = document.createElement("div")
                                tituloCadicdadMadrid.classList.add("detallesReserva_caducidadTitulo")
                                tituloCadicdadMadrid.classList.add("negrita")
                                tituloCadicdadMadrid.innerText = "Caducidad en horario de Madrid"
                                contenedorCadudidaMadrid.appendChild(tituloCadicdadMadrid)
                                const caducidadUIMadrid = document.createElement("div")
                                caducidadUIMadrid.classList.add("detallesReserva_caduciadaUI")
                                caducidadUIMadrid.innerText = caducidadMadrid
                                contenedorCadudidaMadrid.appendChild(caducidadUIMadrid)
                                bloque.append(contenedorCadudidaMadrid)
                                const contenedorCadudidaNicaragua = document.createElement("div")
                                contenedorCadudidaNicaragua.classList.add("detallesReserva_contenedorCaducidad")
                                const tituloCadicdadNicaragua = document.createElement("div")
                                tituloCadicdadNicaragua.classList.add("detallesReserva_caducidadTitulo")
                                tituloCadicdadNicaragua.classList.add("negrita")
                                tituloCadicdadNicaragua.innerText = "Caducidad en horario de Nicaragua"
                                contenedorCadudidaNicaragua.appendChild(tituloCadicdadNicaragua)
                                const caducidadUINIcaragua = document.createElement("div")
                                caducidadUINIcaragua.classList.add("detallesReserva_caduciadaUI")
                                caducidadUINIcaragua.innerText = caducidadNicaragua
                                contenedorCadudidaNicaragua.appendChild(caducidadUINIcaragua)
                                bloque.append(contenedorCadudidaNicaragua)
                                const codigoUI = document.createElement("a")
                                codigoUI.classList.add("detallesReserva_enlacePago_codigoUI")
                                codigoUI.setAttribute("href", "/pagos/" + codigo)
                                codigoUI.setAttribute("vista", "/pago/" + codigo)
                                codigoUI.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                codigoUI.innerText = " Ir al enlace"
                                bloque.appendChild(codigoUI)
                                const campoDescripcion = document.createElement("textarea")
                                campoDescripcion.classList.add("detallesReserva_campoDescripcion")
                                campoDescripcion.placeholder = "No es obligatorio pero escriba un descripcion si quieres para definir aun mas a este enlace si lo necesitas"
                                campoDescripcion.setAttribute("campo", "descripcion")
                                campoDescripcion.value = descripcion
                                bloque.appendChild(campoDescripcion)
                                contenidoAdvertenciaInmersiva.appendChild(bloque)
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                                const botonConfirmar = document.createElement("div")
                                botonConfirmar.classList.add("detallesReservaCancelarBoton")
                                botonConfirmar.setAttribute("componente", "botonActualizarEnlace")
                                botonConfirmar.innerText = "Actualizar enlace de pago"
                                botonConfirmar.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.acutalizarEnlace)
                                bloqueBotones.appendChild(botonConfirmar)
                                const botonEliminar = document.createElement("div")
                                botonEliminar.classList.add("detallesReservaCancelarBoton")
                                botonEliminar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                botonEliminar.innerText = "Eliminar enlace de pago"
                                botonEliminar.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.eliminarEnlace.UI)
                                bloqueBotones.appendChild(botonEliminar)
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("detallesReservaCancelarBoton")
                                botonCancelar.innerText = "Cerrar detalles del enlace de pago"
                                botonCancelar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                bloqueBotones.appendChild(botonCancelar)
                                contenidoAdvertenciaInmersiva.appendChild(bloqueBotones)
                                const enlacePagoUIRenderizada = document.querySelector("[componenteUID=enlaceDePagoUI]")
                                enlacePagoUIRenderizada.innerHTML = null
                                contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                enlacePagoUIRenderizada.appendChild(contenedorAdvertenciaInmersiva)
                            }
                        },
                        arranque: async (e) => {
                            casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias()
                            document.querySelector(`[categoriaReserva=enlacesDePago]`).setAttribute("estadoCategoria", "actual")
                            const botonEnlacesDePago = document.querySelector("[categoriaReserva=enlacesDePago]")
                            botonEnlacesDePago.style.background = "blue"
                            botonEnlacesDePago.style.color = "white"
                            const contenedorDinamico = document.querySelector("[componente=contenedorDinamico]")
                            contenedorDinamico.innerHTML = null
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const contenedorEnlacesDePago = document.createElement("div")
                            const spinnerPorRenderizar = casaVitini.ui.componentes.spinnerSimple()
                            contenedorEnlacesDePago.setAttribute("class", "administracion_reservas_detallesReserva_enlacesDePago_contenedorEnlacesDePago")
                            contenedorEnlacesDePago.setAttribute("instanciaUID", instanciaUID)
                            contenedorEnlacesDePago.setAttribute("componente", "categoriaEnlacesDePago")
                            contenedorEnlacesDePago.appendChild(spinnerPorRenderizar)
                            contenedorDinamico.appendChild(contenedorEnlacesDePago)

                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const transaccion = {
                                zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                                reservaUID: String(reservaUID),
                                capas: [
                                    "enlacesDePago"
                                ]
                            }


                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaDestino = document.querySelector(`[componente=categoriaEnlacesDePago][instanciaUID="${instanciaUID}"]`)
                            if (!instanciaDestino) { return }
                            instanciaDestino.innerHTML = null
                            if (respuestaServidor?.error) {
                                const errorUI = document.createElement("p")
                                errorUI.classList.add("errorCategorialGlobal")
                                errorUI.innerText = respuestaServidor?.error
                                instanciaDestino.appendChild(errorUI)
                            }
                            if (respuestaServidor?.ok) {
                                const contenedorInformacionGlobal = document.createElement("div")
                                contenedorInformacionGlobal.classList.add("administracion_reservas_detallesReserva_contenedorEnlacesDePago")

                                const infoGlobal = document.createElement("div")
                                infoGlobal.classList.add("detallesReserva_reembolso_infoGlobal")
                                infoGlobal.innerText = `AquÃ­ tienes los enlaces de pago generados para realizar pagos para esta reserva a travÃ©s de la pasarela.`

                                contenedorEnlacesDePago.appendChild(contenedorInformacionGlobal)
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReserva_enlacesDePago_bloqueBotones")

                                const botonCrearPagoManual = document.createElement("div")
                                botonCrearPagoManual.classList.add("detallesReserva_transacciones_botonV1")
                                botonCrearPagoManual.innerText = "Crear un enlace de pago"
                                botonCrearPagoManual.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.crearEnlace.UI(instanciaUID)
                                })
                                bloqueBotones.appendChild(botonCrearPagoManual)
                                contenedorInformacionGlobal.appendChild(bloqueBotones)

                                const contenedorListaEnlacesDePagos = document.createElement("div")
                                contenedorListaEnlacesDePagos.classList.add("administracion_reservas_detallesReserva_contenedorListaEnlacesDePago")
                                contenedorListaEnlacesDePagos.setAttribute("componente", "contenedorListaEnlacesDePago")
                                contenedorEnlacesDePago.appendChild(contenedorListaEnlacesDePagos)


                                instanciaDestino.style.justifyContent = "flex-start";
                                const enlacesDePagoGenerados = respuestaServidor?.ok.enlacesDePago
                                if (enlacesDePagoGenerados.length === 0) {
                                    const infoSinEnlaces = document.createElement("div")
                                    infoSinEnlaces.classList.add("reservaDetalles_transacciones_enlacesDePago_infoSinEnlaces")
                                    infoSinEnlaces.setAttribute("componente", "contenedorInfoSinEnlaces")
                                    infoSinEnlaces.innerText = "No hay ningÃºn enlace de pago generado"
                                    contenedorDinamico.appendChild(infoSinEnlaces)
                                }
                                if (enlacesDePagoGenerados.length > 0) {
                                    const contenedorEnlacesDePago = instanciaDestino.querySelector(`[componente=contenedorListaEnlacesDePago]`)

                                    for (const detallesDelEnlace of enlacesDePagoGenerados) {
                                        /*
                                            {
                                                "enlaceUID": 386,
                                                "nombreEnlace": "1",
                                                "reservaUID": 2624,
                                                "descripcion": "",
                                                "enlace": "7radu8sb42p1tj9vmin4l8d3qjcn240oq4am0rti9puzmm4xgo20nf08cp4tdj710alyesadfq7a627tbo50tg8lewz5stmkcxf6",
                                                "totalReserva": "2720.00"
                                            },
                                        */
                                        const metadatos = {
                                            enlaceUID: detallesDelEnlace.enlaceUID,
                                            nombreEnlace: detallesDelEnlace.nombreEnlace,
                                            enlace: detallesDelEnlace.enlace,
                                            cantidad: detallesDelEnlace.cantidad,
                                            estadoPago: detallesDelEnlace.estadoPagoIDV,
                                            instanciaUID: instanciaUID
                                        }
                                        const enlaceUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.enlaceUI(metadatos)
                                        contenedorEnlacesDePago.appendChild(enlaceUI)
                                    }
                                }

                            }
                        },
                        eliminarEnlace: {
                            UI: async (datosElimiacion) => {
                                document.body.style.overflow = "hidden";
                                const enlaceUID = datosElimiacion.enlaceUID
                                const instanciaUID = datosElimiacion.instanciaUID
                                const advertenciaInmersivaIU = document.createElement("div")
                                advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                                advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                                const contenedorAdvertenciaInmersiva = document.createElement("div")
                                contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                const contenidoAdvertenciaInmersiva = document.createElement("div")
                                contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                const tituloCancelarReserva = document.createElement("p")
                                tituloCancelarReserva.classList.add("detallesReservaTituloCancelarReserva")
                                tituloCancelarReserva.innerText = "Eliminar enlace de pago"
                                contenidoAdvertenciaInmersiva.appendChild(tituloCancelarReserva)
                                const bloqueBloqueoApartamentos = document.createElement("div")
                                bloqueBloqueoApartamentos.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                                const tituloBloquoApartamentos = document.createElement("div")
                                tituloBloquoApartamentos.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                tituloBloquoApartamentos.innerText = "Â¿Quieres confirmar la eliminaciÃ³n de este enlace de pago? Sus implicaciones serÃ¡n inmediatas y el enlace de acceso temporal pasarÃ¡ a ser obsoleto."
                                bloqueBloqueoApartamentos.appendChild(tituloBloquoApartamentos)
                                contenidoAdvertenciaInmersiva.appendChild(bloqueBloqueoApartamentos)
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("detallesReservaCancelarBoton")
                                botonCancelar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                botonCancelar.innerText = "Confirmar y eliminar enlace"
                                botonCancelar.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.eliminarEnlace.confirmar({
                                        enlaceUID,
                                        instanciaUID
                                    })
                                })
                                bloqueBotones.appendChild(botonCancelar)
                                const botonVolverAlEnlace = document.createElement("div")
                                botonVolverAlEnlace.classList.add("detallesReservaCancelarBoton")
                                botonVolverAlEnlace.setAttribute("componente", "botonConfirmarCancelarReserva")
                                botonVolverAlEnlace.innerText = "Volver a los detalles del enlace"
                                botonVolverAlEnlace.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.desplegarUI)
                                //bloqueBotones.appendChild(botonVolverAlEnlace)
                                const botonCancelarProcesoCancelacion = document.createElement("div")
                                botonCancelarProcesoCancelacion.classList.add("detallesReservaCancelarBoton")
                                botonCancelarProcesoCancelacion.innerText = "Cancelar la eliminaciÃ³n del enlace"
                                botonCancelarProcesoCancelacion.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                bloqueBotones.appendChild(botonCancelarProcesoCancelacion)
                                contenidoAdvertenciaInmersiva.appendChild(bloqueBotones)
                                contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                                document.querySelector("main").appendChild(advertenciaInmersivaIU)
                            },
                            confirmar: async (datosElimiacion) => {
                                const instanciaUID_pantallaCarga = casaVitini.utilidades.codigoFechaInstancia()
                                const mensaje = "Elimiando enlace de pago..."
                                const datosPantallaSuperpuesta = {
                                    instanciaUID: instanciaUID_pantallaCarga,
                                    mensaje: mensaje
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                                const enlaceUID = datosElimiacion.enlaceUID
                                const instanciaUID = datosElimiacion.instanciaUID
                                const transaccion = {
                                    zona: "administracion/enlacesDePago/eliminarEnlace",
                                    enlaceUID: String(enlaceUID)
                                }

                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_pantallaCarga}"]`)
                                if (!instanciaRenderizada) { return }
                                instanciaRenderizada.remove()
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const contenedorEspacioEnlacesDePago = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                    document.querySelector(`[enlacePagoUID="${enlaceUID}"]`)?.remove()
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const contenedorEnlacesDePago = contenedorEspacioEnlacesDePago.querySelector("[componente=contenedorListaEnlacesDePago]")
                                    const selectorEnlaces = contenedorEspacioEnlacesDePago.querySelectorAll("[enlacePagoUID]")
                                    if (selectorEnlaces.length === 0) {
                                        if (contenedorEspacioEnlacesDePago) {
                                            const contenedorDinamico = document.querySelector("[componente=contenedorDinamico]")
                                            const infoSinEnlaces = document.createElement("div")
                                            infoSinEnlaces.classList.add("reservaDetalles_transacciones_enlacesDePago_infoSinEnlaces")
                                            infoSinEnlaces.setAttribute("componente", "contenedorInfoSinEnlaces")
                                            infoSinEnlaces.innerText = "No hay ningÃºn enlace de pago generado"
                                            contenedorDinamico.appendChild(infoSinEnlaces)
                                        }
                                    }
                                }
                            }
                        },
                        crearEnlace: {
                            UI: async (instanciaUID) => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const advertenciaInmersivaIU = document.createElement("div")
                                advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                                advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                                const contenedorAdvertenciaInmersiva = document.createElement("div")
                                contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                const contenidoAdvertenciaInmersiva = document.createElement("div")
                                contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                contenidoAdvertenciaInmersiva.setAttribute("espacio", "formularioCrearEnlaceDePago")
                                const titulo = document.createElement("p")
                                titulo.classList.add("detallesReservaTituloCancelarReserva")
                                titulo.innerText = "Generar enlace de pago"
                                contenidoAdvertenciaInmersiva.appendChild(titulo)
                                const bloque = document.createElement("div")
                                bloque.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                                let info = document.createElement("div")
                                info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                info.innerText = `
                        Genera un enlace de pago para poder enviarlo a un cliente y que realice el pago de la reserva. No es obligatorio escribir un nombre, pero sÃ­ recomendable, por si necesita acordarse de por quÃ© genera este enlace. Si no define ningÃºn nombre, este se llamarÃ¡ "Enlace de pago de la reserva ${reservaUID}". Este es el nombre automÃ¡tico que tendrÃ¡ este enlace si no define un nombre en especÃ­fico. Recuerde que todos los enlaces generados y su gestiÃ³n centralizada la puede encontrar en el panel de administraciÃ³n, en el botÃ³n de Enlaces de pago desde el menÃº administraciÃ³n o en su reserva correspondiente dentro del apartado enlaces de pago.`
                                bloque.appendChild(info)
                                let campo = document.createElement("input")
                                campo.classList.add("detallesReserva_campoNombreEnlace")
                                campo.setAttribute("campo", "nombreEnlace")
                                campo.placeholder = "Escribe un nombre para el nuevo enlace si quiere"
                                bloque.appendChild(campo)
                                info = document.createElement("div")
                                info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                info.innerText = `Determina la cantidad de pago del enlace, recuerda que los precios de cobro deben de escribirse con dos decimales separados por punto. Por ejemplo, para crear un enlace de pago de 35 dÃ³lares escribe 35.00`
                                bloque.appendChild(info)
                                campo = document.createElement("input")
                                campo.classList.add("detallesReserva_campoNombreEnlace")
                                campo.classList.add("negrita")
                                campo.setAttribute("campo", "cantidad")
                                campo.placeholder = "Cantidad(Obligatorio)"
                                bloque.appendChild(campo)
                                info = document.createElement("div")
                                info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                info.innerText = `Determina el tiempo de vigencia del enlace. Por defecto, el sistema aplica 72h si no especificas una vigencia concreta. Pasada la vigencia, el enlace ya no puede realizar el cobro y desaparece.`
                                bloque.appendChild(info)
                                campo = document.createElement("input")
                                campo.classList.add("detallesReserva_campoNombreEnlace")
                                campo.setAttribute("campo", "horasCaducidad")
                                campo.placeholder = "Caducidad en horas, por defecto, 72h."
                                bloque.appendChild(campo)
                                const campoDescripcion = document.createElement("textarea")
                                campoDescripcion.classList.add("detallesReserva_campoDescripcion")
                                campoDescripcion.setAttribute("campo", "descripcion")
                                campoDescripcion.placeholder = "No es obligatorio, pero escriba una descripciÃ³n si quieres para definir aÃºn mÃ¡s a este enlace si lo necesitas."
                                //bloque.appendChild(campoDescripcion)
                                contenidoAdvertenciaInmersiva.appendChild(bloque)
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                                const botonConfirmar = document.createElement("div")
                                botonConfirmar.classList.add("detallesReservaCancelarBoton")
                                botonConfirmar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                botonConfirmar.innerText = "Confirmar y crear enlace"
                                botonConfirmar.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.crearEnlace.confirmar(instanciaUID)
                                })
                                bloqueBotones.appendChild(botonConfirmar)
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("detallesReservaCancelarBoton")
                                botonCancelar.innerText = "Cancelar la creaciÃ³n del enlace"
                                botonCancelar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                bloqueBotones.appendChild(botonCancelar)
                                contenidoAdvertenciaInmersiva.appendChild(bloqueBotones)
                                const contenedorGlobal = document.createElement("div")
                                contenedorGlobal.classList.add("detallesReserva_enlaceDePago_contenedorGlobal")
                                contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                                document.querySelector("main").appendChild(advertenciaInmersivaIU)
                            },
                            confirmar: async (instanciaUID) => {
                                const instanciaUID_pantallaCarga = casaVitini.utilidades.codigoFechaInstancia()
                                const mensaje = "Creando enlace..."
                                const datosPantallaSuperpuesta = {
                                    instanciaUID: instanciaUID_pantallaCarga,
                                    mensaje: mensaje
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const nombreEnlace = document.querySelector("[espacio=formularioCrearEnlaceDePago] [campo=nombreEnlace]")
                                const cantidad = document.querySelector("[espacio=formularioCrearEnlaceDePago] [campo=cantidad]")
                                const horasCaducidad = document.querySelector("[espacio=formularioCrearEnlaceDePago] [campo=horasCaducidad]")
                                const transaccion = {
                                    zona: "administracion/enlacesDePago/crearNuevoEnlace",
                                    reservaUID: reservaUID,
                                    nombreEnlace: nombreEnlace.value,
                                    cantidad: cantidad.value,
                                    horasCaducidad: horasCaducidad.value,
                                }

                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_pantallaCarga}"]`)

                                if (!instanciaRenderizada) { return }
                                instanciaRenderizada.remove()
                                if (respuestaServidor?.error) {
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const seleccionarInstancia = document.querySelector(`[componente=categoriaEnlacesDePago][instanciaUID="${instanciaUID}"] [componente=contenedorListaEnlacesDePago]`)
                                    if (seleccionarInstancia) {
                                        const metadatos = {
                                            enlaceUID: respuestaServidor.enlaceUID,
                                            nombreEnlace: respuestaServidor.nombreEnlace,
                                            enlace: respuestaServidor.enlace,
                                            cantidad: respuestaServidor.cantidad,
                                            estadoPago: "noPagado",
                                            instanciaUID: instanciaUID
                                        }
                                        const enlaceUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.enlaceUI(metadatos)
                                        const primerElemento = seleccionarInstancia.firstChild;
                                        seleccionarInstancia.insertBefore(enlaceUI, primerElemento);
                                        document.querySelector("[componente=contenedorInfoSinEnlaces]")?.remove()
                                    }
                                }
                            }
                        },
                        acutalizarEnlace: async () => {
                            const botonActualizar = document.querySelector("[componente=botonActualizarEnlace]")
                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const nombreEnlace = document.querySelector("[campo=nombreEnlace]")
                            const descripcion = document.querySelector("[campo=descripcion]")
                            botonActualizar.innerText = "Actualizando, espera..."
                            botonActualizar.style.pointerEvents = "none"
                            const transaccion = {
                                zona: "administracion/enlacesDePago/modificarEnlace",
                                enlaceUID: Number(reservaUID),
                                nombreEnlace: nombreEnlace.value,
                                descripcion: descripcion.value
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            if (respuestaServidor?.error) {
                                const advertenciasInmersivasRenderizadas = document.querySelectorAll("[componente=advertenciaInmersiva]")
                                advertenciasInmersivasRenderizadas.forEach((advertencia) =>
                                    advertencia.remove()
                                )
                                casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                botonActualizar.innerText = "Actualizar enlace de pago"
                                botonActualizar.removeAttribute("style")
                            }
                        },
                        enlaceUI: (metadatos) => {
                            const enlaceUID = metadatos.enlaceUID
                            const nombreEnlace = metadatos.nombreEnlace
                            const enlace = metadatos.enlace
                            const cantidad = metadatos.cantidad
                            const estadoPago = metadatos.estadoPago
                            const instanciaUID = metadatos.instanciaUID
                            const bloqueDatosGenerales = document.createElement("div")
                            bloqueDatosGenerales.classList.add("detallesReserva_enlacesDePago_bloqueDatosGenerales")
                            bloqueDatosGenerales.setAttribute("enlacePagoUID", enlaceUID)
                            const contenedorDatosEnlace = document.createElement("div")
                            contenedorDatosEnlace.classList.add("administracion_reservas_detallesReservas_enlacesDePago_contenedorDatosEnlace")
                            //Enlace UID
                            let bloqueInfoDato = document.createElement("div")
                            bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                            let bloqueInfo = document.createElement("div")
                            bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                            bloqueInfo.classList.add("negrita")
                            bloqueInfo.innerText = "Enlace UID"
                            bloqueInfoDato.appendChild(bloqueInfo)
                            let bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                            bloqueDato.innerText = enlaceUID
                            bloqueInfoDato.appendChild(bloqueDato)
                            contenedorDatosEnlace.appendChild(bloqueInfoDato)
                            //Cantidad enlace
                            bloqueInfoDato = document.createElement("div")
                            bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                            bloqueInfo = document.createElement("div")
                            bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                            bloqueInfo.classList.add("negrita")
                            bloqueInfo.innerText = "Cantidad"
                            bloqueInfoDato.appendChild(bloqueInfo)
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                            bloqueDato.innerText = cantidad + "$"
                            bloqueInfoDato.appendChild(bloqueDato)
                            contenedorDatosEnlace.appendChild(bloqueInfoDato)
                            //Nombre del enlace
                            bloqueInfoDato = document.createElement("div")
                            bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                            bloqueInfo = document.createElement("div")
                            bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                            bloqueInfo.classList.add("negrita")
                            bloqueInfo.innerText = "Nombre del enlace"
                            bloqueInfoDato.appendChild(bloqueInfo)
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                            bloqueDato.innerText = nombreEnlace
                            bloqueInfoDato.appendChild(bloqueDato)
                            contenedorDatosEnlace.appendChild(bloqueInfoDato)
                            //Estado del pago
                            bloqueInfoDato = document.createElement("div")
                            bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                            bloqueInfo = document.createElement("div")
                            bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                            bloqueInfo.classList.add("negrita")
                            bloqueInfo.innerText = "Estado del pago"
                            bloqueInfoDato.appendChild(bloqueInfo)
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                            bloqueDato.innerText = estadoPago
                            bloqueInfoDato.appendChild(bloqueDato)
                            contenedorDatosEnlace.appendChild(bloqueInfoDato)
                            bloqueDatosGenerales.appendChild(contenedorDatosEnlace)
                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add("administracion_reservas_detallesReservas_enlacesDePago_contenedorBotones")
                            const botonIrAlEnlace = document.createElement("a")
                            botonIrAlEnlace.classList.add("administracion_reservas_detallesReservas_enlacesDePago_botonV1")
                            botonIrAlEnlace.innerText = "Ir al enlace"
                            botonIrAlEnlace.setAttribute("href", "/pagos/" + enlace)
                            botonIrAlEnlace.setAttribute("target", "_blank")
                            contenedorBotones.appendChild(botonIrAlEnlace)
                            const botonCopiarEnlace = document.createElement("div")
                            botonCopiarEnlace.classList.add("administracion_reservas_detallesReservas_enlacesDePago_botonV1")
                            botonCopiarEnlace.classList.add("administracion_reservas_detallesReservas_enlacesDePago_botonCopiarPulsacion")
                            botonCopiarEnlace.innerText = "Copiar URL al portapapeles"
                            botonCopiarEnlace.addEventListener("click", () => {
                                const enlaceURL = window.location.hostname + "/pagos/" + enlace
                                navigator.clipboard.writeText(enlaceURL)
                                    .then(() => {
                                    })
                                    .catch((err) => {
                                    });
                            })
                            contenedorBotones.appendChild(botonCopiarEnlace)
                            const botonEliminar = document.createElement("div")
                            botonEliminar.classList.add("administracion_reservas_detallesReservas_enlacesDePago_botonV1")
                            botonEliminar.innerText = "Eliminar enlaces"
                            //aqui
                            botonEliminar.addEventListener("click", () => {
                                const datosElimiacion = {
                                    enlaceUID: enlaceUID,
                                    instanciaUID: instanciaUID,
                                }
                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.eliminarEnlace.UI(datosElimiacion)
                            })
                            contenedorBotones.appendChild(botonEliminar)
                            bloqueDatosGenerales.appendChild(contenedorBotones)
                            return bloqueDatosGenerales
                        }
                    },
                    transacciones: {
                        UI: {
                            listaDePagos: async (data) => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const listaDePagos = data.detallesPagos.ok.detallesPagos
                                const totalReserva = listaDePagos.totalReserva
                                const totalPagado = listaDePagos.totalPagado
                                const faltantePorPagar = listaDePagos.faltantePorPagar
                                const instanciaUID_contenedorDinamicoTransacciones = data.instanciaUID_contenedorDinamicoTransacciones
                                const totalReembolsado = listaDePagos.totalReembolsado
                                const porcentajeReembolsado = listaDePagos.porcentajeReembolsado
                                const porcentajePagado = listaDePagos.porcentajePagado
                                const pagos = listaDePagos.pagos //array
                                const contenedorAdvertenciaInmersiva = document.createElement("div")
                                contenedorAdvertenciaInmersiva.classList.add("administracion_reservas_detallesReserva_contenedorListaDePagos")
                                const titulo = document.createElement("p")
                                titulo.classList.add("detallesReserva_reembolso_tituloGlobal")
                                titulo.innerText = "Transacciones"
                                contenedorAdvertenciaInmersiva.appendChild(titulo)
                                const infoGlobal = document.createElement("div")
                                infoGlobal.classList.add("detallesReserva_reembolso_infoGlobal")
                                infoGlobal.innerText = `Estos son los de pagos de esta reserva. Los pagos pueden realizarse por la pasarela o, si realiza un pago en efectivo, deberÃ¡ aÃ±adir un pago manual desde el botÃ³n correspondiente. Para ver los detalles de un pago y sus reembolsos si los hubiera pulsado en un pago. Para realizar un reembolso, entra en los detalles de un pago y desde ahÃ­ podrÃ¡s realizar el reembolso.`
                                contenedorAdvertenciaInmersiva.appendChild(infoGlobal)
                                const bloqueTransacciones = document.createElement("div")
                                bloqueTransacciones.classList.add("detallesReserva_transacciones_bloqueGlobal")
                                bloqueTransacciones.setAttribute("contenedor", "transaccionesUI")
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReserva_transacciones_bloqueBotones")
                                const botonEnlacesDePago = document.createElement("div")
                                botonEnlacesDePago.classList.add("detallesReserva_transacciones_botonV1")
                                botonEnlacesDePago.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.UI.enlacesDePago)
                                botonEnlacesDePago.innerText = "Crear un enlace de pago"
                                //bloqueBotones.appendChild(botonEnlacesDePago)
                                const botonCrearPagoManual = document.createElement("div")
                                botonCrearPagoManual.classList.add("detallesReserva_transacciones_botonV1")
                                botonCrearPagoManual.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.crearPagoManual.UI()
                                })
                                botonCrearPagoManual.innerText = "Crear pago"
                                bloqueBotones.appendChild(botonCrearPagoManual)
                                const botonCerrar = document.createElement("div")
                                botonCerrar.classList.add("detallesReserva_transacciones_botonV1")
                                botonCerrar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                botonCerrar.innerText = "Cerrar"
                                //bloqueBotones.appendChild(botonCerrar)
                                bloqueTransacciones.appendChild(bloqueBotones)
                                const bloqueDatosGenerales = document.createElement("div")
                                bloqueDatosGenerales.classList.add("detallesReserva_transacciones_bloqueDatosGenerales")
                                //Total reserva
                                let bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                let bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Total de la reserva"
                                bloqueInfoDato.appendChild(bloqueInfo)
                                let bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.setAttribute("componentePago", "totalReserva")
                                bloqueDato.innerText = totalReserva + "$"
                                bloqueInfoDato.appendChild(bloqueDato)
                                bloqueDatosGenerales.appendChild(bloqueInfoDato)
                                //Total pagado
                                bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.setAttribute("componentePago", "porcentajePagado")
                                bloqueInfo.innerText = `Total pagado (${porcentajePagado})`
                                bloqueInfoDato.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.setAttribute("componentePago", "totalPagado")
                                bloqueDato.innerText = totalPagado + "$"
                                bloqueInfoDato.appendChild(bloqueDato)
                                bloqueDatosGenerales.appendChild(bloqueInfoDato)
                                //Total reembolsado
                                bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.setAttribute("componentePago", "porcentajeReembolsado")
                                bloqueInfo.innerText = `Total reembolsado (${porcentajeReembolsado})`
                                bloqueInfoDato.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.setAttribute("componentePago", "totalReembolsado")
                                bloqueDato.innerText = totalReembolsado + "$"
                                bloqueInfoDato.appendChild(bloqueDato)
                                bloqueDatosGenerales.appendChild(bloqueInfoDato)
                                //Faltante por pagar
                                bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Faltante por pagar"
                                bloqueInfoDato.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.setAttribute("componentePago", "faltantePorPagar")
                                bloqueDato.innerText = faltantePorPagar + "$"
                                bloqueInfoDato.appendChild(bloqueDato)
                                bloqueDatosGenerales.appendChild(bloqueInfoDato)
                                bloqueTransacciones.appendChild(bloqueDatosGenerales)
                                if (pagos.length === 0) {
                                    const infoNoPagoUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.UI.infoNoPagos()
                                    bloqueTransacciones.appendChild(infoNoPagoUI)

                                }
                                if (pagos.length > 0) {
                                    const bloqueListaDePagos = document.createElement("div")
                                    bloqueListaDePagos.classList.add("reservaDetalles_transacciones_bloqueListaDePagos")
                                    bloqueListaDePagos.setAttribute("contenedor", "listaDePagos")
                                    for (const detallesDelPago of pagos) {
                                        const pagoUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.UI.pagoUI(detallesDelPago)
                                        bloqueListaDePagos.appendChild(pagoUI)
                                    }
                                    bloqueTransacciones.appendChild(bloqueListaDePagos)
                                }
                                const enlacePagoUIRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_contenedorDinamicoTransacciones}"]`)
                                enlacePagoUIRenderizada.innerHTML = null
                                contenedorAdvertenciaInmersiva.appendChild(bloqueTransacciones)
                                enlacePagoUIRenderizada.appendChild(contenedorAdvertenciaInmersiva)
                            },
                            realizarReembolso_quienMeLlama: async () => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const transaccion = {
                                    zona: "administracion/enlacesDePago/detallesDelEnlace",
                                    enlaceUID: Number(reservaUID)
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                if (respuestaServidor?.error) {
                                    const advertenciasInmersivasRenderizadas = document.querySelectorAll("[componente=advertenciaInmersiva]")
                                    advertenciasInmersivasRenderizadas.forEach((advertencia) =>
                                        advertencia.remove()
                                    )
                                    casaVitini.administracion.comportamiento_de_precios.portadaUI()
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    document.querySelector("[componente=iconoCargaEnlace]")?.remove()
                                    const detallesEnlace = respuestaServidor?.ok
                                    const uidEnlace = detallesEnlace.reserva
                                    const nombreEnlace = detallesEnlace.nombreEnlace
                                    const codigo = detallesEnlace.codigo
                                    const precio = detallesEnlace.precio
                                    const descripcion = detallesEnlace.descripcion
                                    const estadoPago = detallesEnlace.estadoPago
                                    const caducidadUTC = detallesEnlace.caducidadUTC
                                    const caducidadMadrid = detallesEnlace.caducidadMadrid
                                    const caducidadNicaragua = detallesEnlace.caducidadNicaragua
                                    const advertenciaInmersivaIU = document.createElement("div")
                                    advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                                    advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                                    const contenedorAdvertenciaInmersiva = document.createElement("div")
                                    contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                    const titulo = document.createElement("p")
                                    titulo.classList.add("detallesReservaTituloCancelarReserva")
                                    titulo.innerText = "Detalles del enlace de pago"
                                    contenedorAdvertenciaInmersiva.appendChild(titulo)
                                    const bloque = document.createElement("div")
                                    bloque.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                                    const info = document.createElement("div")
                                    info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                    info.innerText = `AquÃ­ tienes los detalles del enlace de pago generado y vigente`
                                    bloque.appendChild(info)
                                    const campoNombre = document.createElement("input")
                                    campoNombre.classList.add("detallesReserva_campoNombreEnlace")
                                    campoNombre.placeholder = "Escribe un nombre para el nuevo enlace o genere el enlace con un nombre generico"
                                    campoNombre.setAttribute("campo", "nombreEnlace")
                                    campoNombre.value = nombreEnlace
                                    bloque.appendChild(campoNombre)
                                    const contenedorCacudidaUTC = document.createElement("div")
                                    contenedorCacudidaUTC.classList.add("detallesReserva_contenedorCaducidad")
                                    const tituloCadicdadUTC = document.createElement("div")
                                    tituloCadicdadUTC.classList.add("detallesReserva_caducidadTitulo")
                                    tituloCadicdadUTC.classList.add("negrita")
                                    tituloCadicdadUTC.innerText = "Caducidad en horario universal(UTC)"
                                    contenedorCacudidaUTC.appendChild(tituloCadicdadUTC)
                                    const caducidadUIUTC = document.createElement("div")
                                    caducidadUIUTC.classList.add("detallesReserva_caduciadaUI")
                                    caducidadUIUTC.innerText = caducidadUTC
                                    contenedorCacudidaUTC.appendChild(caducidadUIUTC)
                                    bloque.append(contenedorCacudidaUTC)
                                    const contenedorCadudidaMadrid = document.createElement("div")
                                    contenedorCadudidaMadrid.classList.add("detallesReserva_contenedorCaducidad")
                                    const tituloCadicdadMadrid = document.createElement("div")
                                    tituloCadicdadMadrid.classList.add("detallesReserva_caducidadTitulo")
                                    tituloCadicdadMadrid.classList.add("negrita")
                                    tituloCadicdadMadrid.innerText = "Caducidad en horario de Madrid"
                                    contenedorCadudidaMadrid.appendChild(tituloCadicdadMadrid)
                                    const caducidadUIMadrid = document.createElement("div")
                                    caducidadUIMadrid.classList.add("detallesReserva_caduciadaUI")
                                    caducidadUIMadrid.innerText = caducidadMadrid
                                    contenedorCadudidaMadrid.appendChild(caducidadUIMadrid)
                                    bloque.append(contenedorCadudidaMadrid)
                                    const contenedorCadudidaNicaragua = document.createElement("div")
                                    contenedorCadudidaNicaragua.classList.add("detallesReserva_contenedorCaducidad")
                                    const tituloCadicdadNicaragua = document.createElement("div")
                                    tituloCadicdadNicaragua.classList.add("detallesReserva_caducidadTitulo")
                                    tituloCadicdadNicaragua.classList.add("negrita")
                                    tituloCadicdadNicaragua.innerText = "Caducidad en horario de Nicaragua"
                                    contenedorCadudidaNicaragua.appendChild(tituloCadicdadNicaragua)
                                    const caducidadUINIcaragua = document.createElement("div")
                                    caducidadUINIcaragua.classList.add("detallesReserva_caduciadaUI")
                                    caducidadUINIcaragua.innerText = caducidadNicaragua
                                    contenedorCadudidaNicaragua.appendChild(caducidadUINIcaragua)
                                    bloque.append(contenedorCadudidaNicaragua)
                                    const codigoUI = document.createElement("a")
                                    codigoUI.classList.add("detallesReserva_enlacePago_codigoUI")
                                    codigoUI.setAttribute("href", "/pagos/" + codigo)
                                    codigoUI.setAttribute("vista", "/pago/" + codigo)
                                    codigoUI.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                    codigoUI.innerText = " Ir al enlace"
                                    bloque.appendChild(codigoUI)
                                    const campoDescripcion = document.createElement("textarea")
                                    campoDescripcion.classList.add("detallesReserva_campoDescripcion")
                                    campoDescripcion.placeholder = "No es obligatorio, pero escriba una descripciÃ³n si quieres para definir aÃºn mÃ¡s a este enlace si lo necesitas."
                                    campoDescripcion.setAttribute("campo", "descripcion")
                                    campoDescripcion.value = descripcion
                                    bloque.appendChild(campoDescripcion)
                                    contenedorAdvertenciaInmersiva.appendChild(bloque)
                                    const bloqueBotones = document.createElement("div")
                                    bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                                    const botonConfirmar = document.createElement("div")
                                    botonConfirmar.classList.add("detallesReservaCancelarBoton")
                                    botonConfirmar.setAttribute("componente", "botonActualizarEnlace")
                                    botonConfirmar.innerText = "Actualizar enlace de pago"
                                    botonConfirmar.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.acutalizarEnlace)
                                    bloqueBotones.appendChild(botonConfirmar)
                                    const botonEliminar = document.createElement("div")
                                    botonEliminar.classList.add("detallesReservaCancelarBoton")
                                    botonEliminar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                    botonEliminar.innerText = "Eliminar enlace de pago"
                                    botonEliminar.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.eliminarEnlace.UI)
                                    bloqueBotones.appendChild(botonEliminar)
                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("detallesReservaCancelarBoton")
                                    botonCancelar.innerText = "Cerrar detalles del enlace de pago"
                                    botonCancelar.addEventListener("click", () => {
                                        let selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                                        selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                            advertenciaInmersiva.remove()
                                        })
                                    })
                                    bloqueBotones.appendChild(botonCancelar)
                                    contenedorAdvertenciaInmersiva.appendChild(bloqueBotones)
                                    const enlacePagoUIRenderizada = document.querySelector("[componenteUID=enlaceDePagoUI]")
                                    enlacePagoUIRenderizada.innerHTML = null
                                    enlacePagoUIRenderizada.appendChild(contenedorAdvertenciaInmersiva)
                                }
                            },
                            pagoUI: (metadatos) => {

                                const pagoUID = metadatos.pagoUID
                                const plataformaDePagoIDV = metadatos.plataformaDePagoIDV
                                const pagoUIDPasarela = metadatos.pagoUIDPasarela
                                const tarjetaDigitos = metadatos.tarjetaDigitos
                                const fechaPago = metadatos.fechaPago
                                const fechaPagoTZ_ISO = metadatos.fechaPagoTZ_ISO
                                const tarjeta = metadatos.tarjeta
                                const cantidad = metadatos.cantidad
                                const sumaDeLoReembolsado = metadatos.sumaDeLoReembolsado
                                const reembolsado = metadatos.reembolsado
                                const chequeUID = metadatos.chequeUID
                                const instanciaUID_contenedorDinamicoTransacciones = metadatos.instanciaUID_contenedorDinamicoTransacciones

                                const fechaPagoUTC_objeto = fechaPago.split("T")
                                const fechaUTC_array = fechaPagoUTC_objeto[0].split("-")
                                const horaUTC_array = fechaPagoUTC_objeto[1].split("-")[0]
                                const fechaPagoUTC_humana = `${fechaUTC_array[2]}/${fechaUTC_array[1]}/${fechaUTC_array[0]} ${horaUTC_array}`

                                const fechaPagoTZ_objeto = fechaPagoTZ_ISO.split("T")
                                const fechaTZ_array = fechaPagoTZ_objeto[0].split("-")
                                const horaTZ_array = fechaPagoTZ_objeto[1].split("-")[0]
                                const fechaPagoTZ_humana = `${fechaTZ_array[2]}/${fechaTZ_array[1]}/${fechaTZ_array[0]} ${horaTZ_array}`

                                const plataformaDePagoUI = {
                                    efectivo: "Efectivo",
                                    transferenciaBancaria: "Transferencia bancaria",
                                    tarjeta: "Tarteja TPV",
                                    pasarela: "Pasarela de pago",
                                    cheque: "Cheque"
                                }

                                const bloqueDetallesDelPago = document.createElement("div")
                                bloqueDetallesDelPago.classList.add("reservaDetalles_transacciones_bloqueDetallesDelPago")
                                bloqueDetallesDelPago.setAttribute("pagoUID", pagoUID)
                                bloqueDetallesDelPago.addEventListener("click", () => {
                                    const metadatos = {
                                        pagoUID: pagoUID,
                                        instanciaUID_contenedorDinamicoTransacciones: instanciaUID_contenedorDinamicoTransacciones
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.detallesDelPago.UI(metadatos)
                                })
                                //PagoUID
                                let bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                let bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Identificador del pago(pagoUID)"
                                bloqueInfoDato.appendChild(bloqueInfo)
                                let bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.innerText = pagoUID
                                bloqueInfoDato.appendChild(bloqueDato)
                                bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                //Plataforma de pago
                                bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Plataforma de pago"
                                bloqueInfoDato.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.innerText = plataformaDePagoUI[plataformaDePagoIDV]
                                bloqueInfoDato.appendChild(bloqueDato)
                                bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                //pagoUIDPasarela
                                bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.innerText = "Identificador del pago dentro de la pasarela"
                                bloqueInfo.classList.add("negrita")
                                bloqueInfoDato.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.innerText = pagoUIDPasarela
                                bloqueInfoDato.appendChild(bloqueDato)
                                if (plataformaDePagoIDV === "pasarela") {
                                    bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                }
                                //tarjetaDigiros
                                bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Tarjeta de crÃ©dito"
                                bloqueInfoDato.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.innerText = `**** **** **** ${tarjetaDigitos} (${tarjeta})`
                                bloqueInfoDato.appendChild(bloqueDato)
                                if (plataformaDePagoIDV === "pasarela") {
                                    bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                }
                                //Fecha de pago UTC
                                bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Fecha del pago en UTC"
                                bloqueInfoDato.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.innerText = fechaPagoUTC_humana
                                bloqueInfoDato.appendChild(bloqueDato)
                                bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                //Fecha de pago TZ
                                bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Fecha del pago en hora local"
                                bloqueInfoDato.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.innerText = fechaPagoTZ_humana
                                bloqueInfoDato.appendChild(bloqueDato)
                                bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                //Cantidad del pago 
                                bloqueInfoDato = document.createElement("div")
                                bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Cantidad cobrada en dolares"
                                bloqueInfoDato.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.innerText = cantidad + "$"
                                bloqueInfoDato.appendChild(bloqueDato)
                                bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                //Resumen de reembolsos
                                const bloqueSumaDeLoReembolsado = document.createElement("div")
                                bloqueSumaDeLoReembolsado.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Resumen de reembolsos"
                                bloqueSumaDeLoReembolsado.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.innerText = `${sumaDeLoReembolsado}$, reembolsado ${reembolsado}`
                                bloqueSumaDeLoReembolsado.appendChild(bloqueDato)
                                if (sumaDeLoReembolsado) {
                                    bloqueDetallesDelPago.appendChild(bloqueSumaDeLoReembolsado)
                                }
                                //Cheque UID
                                const bloqueChequeUID = document.createElement("div")
                                bloqueChequeUID.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                bloqueInfo = document.createElement("div")
                                bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                bloqueInfo.classList.add("negrita")
                                bloqueInfo.innerText = "Identificador del cheque"
                                bloqueChequeUID.appendChild(bloqueInfo)
                                bloqueDato = document.createElement("div")
                                bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                bloqueDato.innerText = chequeUID
                                bloqueChequeUID.appendChild(bloqueDato)
                                if (chequeUID) {
                                    bloqueDetallesDelPago.appendChild(bloqueChequeUID)
                                }
                                return bloqueDetallesDelPago
                            },
                            infoNoPagos: () => {
                                const infoNoPagos = document.createElement("div")
                                infoNoPagos.classList.add("reservaDetalles_transacciones_textoV1")
                                infoNoPagos.setAttribute("contenedor", "infoNoPagos")
                                infoNoPagos.innerText = "Esta reserva no tiene ningÃºn pago.Los pagos que se realicen por la pasarela de pagos se mostrarÃ¡n automÃ¡ticamente aquÃ­.Sin embargo, si ha cobrado esta reserva, por ejemplo, en efectivo o con un TPV, deberÃ­a de aÃ±adir un pago manual.No es obligatorio aÃ±adir un pago manual, pero si quiere tener un seguimiento centralizado de todos los pagos en esta reserva, tiene esa opciÃ³n."
                                return infoNoPagos
                            }
                        },
                        arranque: async () => {
                            casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias()
                            document.querySelector(`[categoriaReserva=transacciones]`).setAttribute("estadoCategoria", "actual")
                            const botonTransacciones = document.querySelector("[categoriaReserva=transacciones]")
                            botonTransacciones.style.background = "blue"
                            botonTransacciones.style.color = "white"
                            const contenedorDinamico = document.querySelector("[componente=contenedorDinamico]")
                            contenedorDinamico.innerHTML = null
                            const advertenciasInmersivasRenderizadas = document.querySelectorAll("[componente=advertenciaInmersiva]")
                            advertenciasInmersivasRenderizadas.forEach((advertencia) =>
                                advertencia.remove()
                            )
                            const instanciaUID_contenedorDinamicoTransacciones = casaVitini.utilidades.codigoFechaInstancia()
                            const contenedorListaDePagos = document.createElement("div")
                            contenedorListaDePagos.setAttribute("class", "administracion_reservas_detallesReservas_transacciones_contenedorListaDePagos")
                            contenedorListaDePagos.setAttribute("instanciaUID", instanciaUID_contenedorDinamicoTransacciones)
                            contenedorListaDePagos.setAttribute("contenedorID", "transacciones")

                            const spinnerSimple = casaVitini.ui.componentes.spinnerSimple()
                            contenedorListaDePagos.appendChild(spinnerSimple)

                            contenedorDinamico.appendChild(contenedorListaDePagos)
                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const transaccion = {
                                zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                                reservaUID: reservaUID,
                                capas: [
                                    "detallesPagos",
                                ]
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaDestino = document.querySelector(`[contenedorID=transacciones][instanciaUID="${instanciaUID_contenedorDinamicoTransacciones}"]`)
                            if (!instanciaDestino) { }
                            instanciaDestino.innerHTML = null
                            if (respuestaServidor?.error) {
                                const errorUI = document.createElement("p")
                                errorUI.classList.add("errorCategorialGlobal")
                                errorUI.innerText = respuestaServidor?.error
                                instanciaDestino.appendChild(errorUI)

                            }
                            if (respuestaServidor?.ok) {
                                instanciaDestino.style.justifyContent = "flex - start";
                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.UI.listaDePagos({
                                    detallesPagos: respuestaServidor,
                                    instanciaUID_contenedorDinamicoTransacciones
                                })

                            }
                        },
                        detallesDelPago: {
                            UI: async (metadatos) => {
                                const pagoUID = metadatos.pagoUID
                                const instanciaUID_contenedorDinamicoTransacciones = metadatos.instanciaUID_contenedorDinamicoTransacciones

                                document.body.style.overflow = "hidden";
                                const instanciaUIDDetalleDelPago = casaVitini.utilidades.codigoFechaInstancia()
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const mensajeSpinner = "Esperando al servidor..."
                                const spinnerPorRenderizar = casaVitini.ui.componentes.spinner(mensajeSpinner)
                                const advertenciaInmersivaIU = document.createElement("div")
                                advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                                advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                                advertenciaInmersivaIU.setAttribute("instanciaUID", instanciaUIDDetalleDelPago)
                                const contenedorAdvertenciaInmersiva = document.createElement("div")
                                contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                const contenidoAdvertenciaInmersiva = document.createElement("div")
                                contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                contenidoAdvertenciaInmersiva.setAttribute("espacio", "detallesDelPago")
                                contenidoAdvertenciaInmersiva.appendChild(spinnerPorRenderizar)
                                contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                                document.querySelector("main").appendChild(advertenciaInmersivaIU)
                                const ocultaPanales = () => {
                                    const selectorContenedores = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"]`)
                                    const contenedorNuevoReembolso = selectorContenedores.querySelector("[contenedor=nuevoReembolso]")
                                    const contenedorEliminarPago = selectorContenedores.querySelector("[contenedor=eliminarPago]")
                                    contenedorNuevoReembolso.innerHTML = null
                                    contenedorNuevoReembolso.removeAttribute("style")
                                    contenedorEliminarPago.innerHTML = null
                                    contenedorEliminarPago.removeAttribute("style")
                                }
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/transacciones/obtenerDetallesDelPago",
                                    pagoUID: String(pagoUID)
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const detallesDelPago = respuestaServidor.detallesDelPago
                                    const plataformaDePagoIDV = detallesDelPago.plataformaDePagoIDV
                                    const pagoUID = detallesDelPago.pagoUID
                                    const pagoUIDPasarela = detallesDelPago.pagoUIDPasarela
                                    const tarjetaDigitos = detallesDelPago.tarjetaDigitos
                                    const fechaPagoUTC_ISO = detallesDelPago.fechaPagoUTC_ISO
                                    const fechaPagoTZ_ISO = detallesDelPago.fechaPagoTZ_ISO

                                    const fechaPagoUTC_objeto = fechaPagoUTC_ISO.split("T")
                                    const fechaUTC_array = fechaPagoUTC_objeto[0].split("-")
                                    const horaUTC_array = fechaPagoUTC_objeto[1].split("-")[0]
                                    const fechaPagoUTC_humana = `${fechaUTC_array[2]}/${fechaUTC_array[1]}/${fechaUTC_array[0]} ${horaUTC_array}`

                                    const fechaPagoTZ_objeto = fechaPagoTZ_ISO.split("T")
                                    const fechaTZ_array = fechaPagoTZ_objeto[0].split("-")
                                    const horaTZ_array = fechaPagoTZ_objeto[1].split("-")[0]
                                    const fechaPagoTZ_humana = `${fechaTZ_array[2]}/${fechaTZ_array[1]}/${fechaTZ_array[0]} ${horaTZ_array}`


                                    const tarjeta = detallesDelPago.tarjeta
                                    const cantidad = detallesDelPago.cantidad
                                    const sumaDeLoReembolsado = detallesDelPago.sumaDeLoReembolsado
                                    const reembolsado = detallesDelPago.reembolsado
                                    const deglosePorReembolso = respuestaServidor.deglosePorReembolso
                                    const plataformaDePagoUI = {
                                        efectivo: "Efectivo",
                                        transferenciaBancaria: "Transferencia bancaria",
                                        tarjeta: "Tarteja TPV",
                                        pasarela: "Pasarela de pago",
                                        cheque: "Cheque"
                                    }


                                    const selectorInstanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"]`)?.querySelector("[espacio=detallesDelPago]")
                                    if (!selectorInstanciaRenderizada) {
                                        return
                                    }
                                    selectorInstanciaRenderizada.innerHTML = null
                                    const bloque = document.createElement("div")
                                    bloque.classList.add("administracion_reservas_reservaDetalles_transacciones_reembolsos_bloqueTitulo")
                                    const info = document.createElement("div")
                                    info.classList.add("administracion_reservas_reservaDetalles_transacciones_reembolsos_tituloDetallesPago")
                                    info.innerText = `Detalles del pago ${pagoUID} de la reserva ${reservaUID} junto con sus reembolsos. Desde aquÃ­ puedes ver los detalles de este pago y gestionar los reembolsos. Puedes crear reembolsos. Tanto los pagos hechos por la pasarela como los reembolsos enviados a la pasarela no se pueden eliminar. Solo se pueden eliminar los pagos manuales.`
                                    bloque.appendChild(info)
                                    selectorInstanciaRenderizada.appendChild(bloque)
                                    const bloqueDetallesDelPago = document.createElement("div")
                                    bloqueDetallesDelPago.classList.add("administracion_reservas_reservaDetalles_transacciones_reembolsos_bloqueDetallePago")
                                    bloqueDetallesDelPago.setAttribute("pagoUID", pagoUID)
                                    //PagoUID
                                    let bloqueInfoDato = document.createElement("div")
                                    bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                    let bloqueInfo = document.createElement("div")
                                    bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                    bloqueInfo.classList.add("negrita")
                                    bloqueInfo.innerText = "Identificador del pago(pagoUID)"
                                    bloqueInfoDato.appendChild(bloqueInfo)
                                    let bloqueDato = document.createElement("div")
                                    bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                    bloqueDato.innerText = pagoUID
                                    bloqueInfoDato.appendChild(bloqueDato)
                                    bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                    //Plataforma de pago
                                    bloqueInfoDato = document.createElement("div")
                                    bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                    bloqueInfo = document.createElement("div")
                                    bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                    bloqueInfo.classList.add("negrita")
                                    bloqueInfo.innerText = "Plataforma de pago"
                                    bloqueInfoDato.appendChild(bloqueInfo)
                                    bloqueDato = document.createElement("div")
                                    bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                    bloqueDato.innerText = plataformaDePagoUI[plataformaDePagoIDV]
                                    bloqueInfoDato.appendChild(bloqueDato)
                                    bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                    //pagoUIDPasarela
                                    bloqueInfoDato = document.createElement("div")
                                    bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                    bloqueInfo = document.createElement("div")
                                    bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                    bloqueInfo.innerText = "Identificador del pago dentro de la pasarela"
                                    bloqueInfo.classList.add("negrita")
                                    bloqueInfoDato.appendChild(bloqueInfo)
                                    bloqueDato = document.createElement("div")
                                    bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                    bloqueDato.innerText = pagoUIDPasarela
                                    bloqueInfoDato.appendChild(bloqueDato)
                                    if (plataformaDePagoIDV === "pasarela") {
                                        bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                    }
                                    //tarjetaDigiros
                                    bloqueInfoDato = document.createElement("div")
                                    bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                    bloqueInfo = document.createElement("div")
                                    bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                    bloqueInfo.classList.add("negrita")
                                    bloqueInfo.innerText = "Tarjeta de crÃ©dito"
                                    bloqueInfoDato.appendChild(bloqueInfo)
                                    bloqueDato = document.createElement("div")
                                    bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                    bloqueDato.innerText = `**** **** **** ${tarjetaDigitos} (${tarjeta})`
                                    bloqueInfoDato.appendChild(bloqueDato)
                                    if (plataformaDePagoIDV === "pasarela") {
                                        bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                    }
                                    //Fecha de pago UTC
                                    bloqueInfoDato = document.createElement("div")
                                    bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                    bloqueInfo = document.createElement("div")
                                    bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                    bloqueInfo.classList.add("negrita")
                                    bloqueInfo.innerText = "Fecha del pago UTC"
                                    bloqueInfoDato.appendChild(bloqueInfo)
                                    bloqueDato = document.createElement("div")
                                    bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                    bloqueDato.innerText = fechaPagoUTC_humana
                                    bloqueInfoDato.appendChild(bloqueDato)
                                    bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                    //Fecha de pago TZ
                                    bloqueInfoDato = document.createElement("div")
                                    bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                    bloqueInfo = document.createElement("div")
                                    bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                    bloqueInfo.classList.add("negrita")
                                    bloqueInfo.innerText = "Fecha del pago hora local"
                                    bloqueInfoDato.appendChild(bloqueInfo)
                                    bloqueDato = document.createElement("div")
                                    bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                    bloqueDato.innerText = fechaPagoTZ_humana
                                    bloqueInfoDato.appendChild(bloqueDato)
                                    bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                    //Cantidad del pago 
                                    bloqueInfoDato = document.createElement("div")
                                    bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                    bloqueInfo = document.createElement("div")
                                    bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                    bloqueInfo.classList.add("negrita")
                                    bloqueInfo.innerText = "Cantidad cobrada en dolares"
                                    bloqueInfoDato.appendChild(bloqueInfo)
                                    bloqueDato = document.createElement("div")
                                    bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                    bloqueDato.setAttribute("cantidadPago", cantidad)
                                    bloqueDato.innerText = cantidad + "$"
                                    bloqueInfoDato.appendChild(bloqueDato)
                                    bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                    //Resumen de reembolsos
                                    bloqueInfoDato = document.createElement("div")
                                    bloqueInfoDato.classList.add("reservaDetalles_transacciones_bloqueInfoDato")
                                    bloqueInfo = document.createElement("div")
                                    bloqueInfo.classList.add("reservaDetalles_transacciones_bloqueInfo")
                                    bloqueInfo.classList.add("negrita")
                                    bloqueInfo.innerText = "Resumen de reembolsos"
                                    bloqueInfoDato.appendChild(bloqueInfo)
                                    bloqueDato = document.createElement("div")
                                    bloqueDato.classList.add("reservaDetalles_transacciones_bloqueDato")
                                    bloqueDato.setAttribute("sumaDeLoReembolsado", sumaDeLoReembolsado)
                                    bloqueDato.innerText = `${sumaDeLoReembolsado}$, reembolsado ${reembolsado}`
                                    bloqueInfoDato.appendChild(bloqueDato)
                                    if (sumaDeLoReembolsado) {
                                        bloqueDetallesDelPago.appendChild(bloqueInfoDato)
                                    }
                                    selectorInstanciaRenderizada.appendChild(bloqueDetallesDelPago)
                                    const contenedorBotones = document.createElement("div")
                                    contenedorBotones.classList.add("administracion_reservas_detallesReserva_transacciones_reembolsos_contenedorBotones")
                                    const botonCrearReembolso = document.createElement("div")
                                    botonCrearReembolso.classList.add("administracion_reservas_detallesReserva_transacciones_reembolsos_botonV1")
                                    botonCrearReembolso.innerText = "Crear un reembolso"
                                    botonCrearReembolso.addEventListener("click", () => {
                                        ocultaPanales()
                                        const selectorContenedorReembolso = document.querySelector("[contenedor=nuevoReembolso]")
                                        selectorContenedorReembolso.innerText = null
                                        const metadatos = {
                                            pagoUID: pagoUID,
                                            instanciaUID_contenedorDinamicoTransacciones: instanciaUID_contenedorDinamicoTransacciones,
                                            instanciaUIDDetalleDelPago: instanciaUIDDetalleDelPago
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.reembolsos.reembolsoUI(metadatos)
                                    })
                                    contenedorBotones.appendChild(botonCrearReembolso)
                                    const botonCerrar = document.createElement("div")
                                    botonCerrar.classList.add("administracion_reservas_detallesReserva_transacciones_reembolsos_botonV1")
                                    botonCerrar.innerText = "Cerrar detalles del pago"
                                    botonCerrar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                    contenedorBotones.appendChild(botonCerrar)
                                    const botonEliminarPago = document.createElement("div")
                                    botonEliminarPago.classList.add("administracion_reservas_detallesReserva_transacciones_reembolsos_botonV1")
                                    botonEliminarPago.innerText = "Eliminar pago"
                                    if (plataformaDePagoIDV !== "pasarela") {
                                        contenedorBotones.appendChild(botonEliminarPago)
                                    }
                                    botonEliminarPago.addEventListener("click", () => {
                                        ocultaPanales()
                                        const selectorContenedorEliminarPago = document.querySelector("[contenedor=eliminarPago]")
                                        selectorContenedorEliminarPago.innerHTML = null
                                        const metadatos = {
                                            instanciaUIDDetalleDelPago: instanciaUIDDetalleDelPago
                                        }
                                        const eliminarPagoUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.eliminarPagoManual.UI(metadatos)
                                        selectorContenedorEliminarPago.appendChild(eliminarPagoUI)
                                        selectorContenedorEliminarPago.style.display = "flex"
                                    })
                                    selectorInstanciaRenderizada.appendChild(contenedorBotones)
                                    const contenedorEliminarPago = document.createElement("div")
                                    contenedorEliminarPago.classList.add("administracion_reservas_detallesReserva_transacciones_reembolsos_contenedorCrearReembolso")
                                    contenedorEliminarPago.setAttribute("contenedor", "eliminarPago")
                                    selectorInstanciaRenderizada.appendChild(contenedorEliminarPago)
                                    const contenedorCrearReembolso = document.createElement("div")
                                    contenedorCrearReembolso.classList.add("administracion_reservas_detallesReserva_transacciones_reembolsos_contenedorCrearReembolso")
                                    contenedorCrearReembolso.setAttribute("contenedor", "nuevoReembolso")
                                    selectorInstanciaRenderizada.appendChild(contenedorCrearReembolso)
                                    const contenedorReembolsos = document.createElement("div")
                                    contenedorReembolsos.classList.add("administracion_reservas_detallesReserva_transacciones_reembolsos_contenedorReembolso")
                                    if (deglosePorReembolso.length === 0) {
                                        const info = document.createElement("div")
                                        info.classList.add("adminsitracion_reservas_detalles_transacciones_reembolsos_infoNoReembolsos")
                                        info.innerText = "Este pago no tiene ningÃºn reembolso"
                                        info.appendChild(contenedorReembolsos)
                                    }
                                    const botonOpcionesReembolsoUI = (metadatos) => {
                                        const botonEliminarReembolso = document.createElement("div")
                                        botonEliminarReembolso.classList.add("boton_opciones_reembolso_v2")
                                        botonEliminarReembolso.innerText = "Opciones del reembolso"
                                        botonEliminarReembolso.addEventListener("click", () => {
                                            opcionesReembolsoUI(metadatos)
                                        })
                                        return botonEliminarReembolso
                                    }
                                    const restaurarTodasLasOpcionesDeTodosLosReembolsos = (pagoUID, instanciaUIDDetalleDelPago) => {
                                        const reembolsosOpcionesDesplegadas = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"]`)?.querySelectorAll("[contenedor=opcionesDelReembolso][estado=opcionesDesplegadas]")
                                        reembolsosOpcionesDesplegadas.forEach(contenedorOpcionesReembolso => {
                                            contenedorOpcionesReembolso.innerHTML = null
                                            const reembolsoUID = contenedorOpcionesReembolso.closest("[reembolsoUID]").getAttribute("reembolsoUID")
                                            const metadatosOpcionesReembolso = {
                                                instanciaUIDDetalleDelPago: instanciaUIDDetalleDelPago,
                                                reembolsoUID: reembolsoUID,
                                                pagoIUD: pagoUID
                                            }
                                            contenedorOpcionesReembolso.appendChild(botonOpcionesReembolsoUI(metadatosOpcionesReembolso))
                                        });
                                    }
                                    const opcionesReembolsoUI = (metadatos) => {
                                        const reembolsoUID = metadatos.reembolsoUID
                                        const instanciaUIDDetalleDelPago = metadatos.instanciaUIDDetalleDelPago
                                        const pagoUID = metadatos.pagoUID
                                        const instanciaUID_contenedorDinamicoTransacciones = metadatos.instanciaUID_contenedorDinamicoTransacciones
                                        restaurarTodasLasOpcionesDeTodosLosReembolsos(pagoUID, instanciaUIDDetalleDelPago)
                                        const selectorReembolso = document.querySelector(`[reembolsoUID="${reembolsoUID}"]`).querySelector("[contenedor=opcionesDelReembolso]")
                                        selectorReembolso.setAttribute("estado", "opcionesDesplegadas")
                                        selectorReembolso.innerHTML = null
                                        const contenedor = document.createElement("div")
                                        contenedor.classList.add("administracion_reservas_detallesReserva_transacciones_opcionesReembolso")
                                        const campoPalabra = document.createElement("input")
                                        campoPalabra.classList.add("detallesReserva_reembolso_campoConfirmacion")
                                        campoPalabra.setAttribute("campo", "palabra")
                                        campoPalabra.placeholder = "Escribe la palabra eliminar"
                                        selectorReembolso.appendChild(campoPalabra)
                                        const botonEliminarReembolso = document.createElement("div")
                                        botonEliminarReembolso.classList.add("boton_opciones_reembolso_v2")
                                        botonEliminarReembolso.innerText = "Confirmar la eliminaciÃ³n irreversible del reembolso"
                                        botonEliminarReembolso.addEventListener("click", () => {
                                            const metadatosEliminarReembolso = {
                                                instanciaUIDDetalleDelPago: instanciaUIDDetalleDelPago,
                                                reembolsoUID: reembolsoUID,
                                                instanciaUID_contenedorDinamicoTransacciones: instanciaUID_contenedorDinamicoTransacciones
                                            }
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.reembolsos.eliminarReembolso(metadatosEliminarReembolso)
                                        })
                                        selectorReembolso.appendChild(botonEliminarReembolso)
                                        const botonCerrarOpcionesDeReembolso = document.createElement("div")
                                        botonCerrarOpcionesDeReembolso.classList.add("boton_opciones_reembolso_v2")
                                        botonCerrarOpcionesDeReembolso.innerText = "Cerrar opciones del reembolso"
                                        botonCerrarOpcionesDeReembolso.addEventListener("click", () => {
                                            restaurarTodasLasOpcionesDeTodosLosReembolsos(pagoUID, instanciaUIDDetalleDelPago)
                                        })
                                        selectorReembolso.appendChild(botonCerrarOpcionesDeReembolso)
                                    }
                                    deglosePorReembolso.forEach((detallesDelReembolso) => {
                                        const reembolsoUID = detallesDelReembolso.reembolsoUID
                                        const plataformaDePagoIDV = detallesDelReembolso.plataformaDePagoIDV

                                        const cantidad = detallesDelReembolso.cantidad
                                        const reembolsoUIDPasarela = detallesDelReembolso.reembolsoUIDPasarela

                                        const fechaCreacionUTC_ISO = detallesDelReembolso.fechaCreacionUTC_ISO
                                        const fechaCreacionTZ_ISO = detallesDelReembolso.fechaCreacionTZ_ISO

                                        const fechaActualizacionUTC_ISO = detallesDelReembolso.fechaActualizacionUTC_ISO
                                        const fechaActualizacionTZ_ISO = detallesDelReembolso.fechaActualizacionTZ_ISO

                                        const fechaCreacionUTC_objeto = fechaCreacionUTC_ISO.split("T")
                                        const fechaCreacionUTC_array = fechaCreacionUTC_objeto[0].split("-")
                                        const horaCreacionUTC_array = fechaCreacionUTC_objeto[1].split("-")[0]
                                        const fechaCreacionUTC_humana = `${fechaCreacionUTC_array[2]}/${fechaCreacionUTC_array[1]}/${fechaCreacionUTC_array[0]} ${horaCreacionUTC_array}`

                                        const fechaCreacionTZ_objeto = fechaCreacionTZ_ISO.split("T")
                                        const fechaCreacionTZ_array = fechaCreacionTZ_objeto[0].split("-")
                                        const horaCreacionTZ_array = fechaCreacionTZ_objeto[1].split("-")[0]
                                        const fechaCreacionTZ_humana = `${fechaCreacionTZ_array[2]}/${fechaCreacionTZ_array[1]}/${fechaCreacionTZ_array[0]} ${horaCreacionTZ_array}`


                                        const fechaActualizacionUTC_objeto = fechaActualizacionUTC_ISO?.split("T") || []
                                        const fechaActualizacionUTC_array = fechaActualizacionUTC_objeto[0]?.split("-") || []
                                        const horaActualizacionUTC_array = fechaActualizacionUTC_objeto[1]?.split("-")[0] || []
                                        const fechaActualizacionUTC_humana = `${fechaActualizacionUTC_array[2]}/${fechaActualizacionUTC_array[1]}/${fechaActualizacionUTC_array[0]} ${horaActualizacionUTC_array}`

                                        const fechaActualizacionTZ_objeto = fechaActualizacionTZ_ISO?.split("T") || []
                                        const fechaActualizacionTZ_array = fechaActualizacionTZ_objeto[0]?.split("-") || []
                                        const horaActualizacionTZ_array = fechaActualizacionTZ_objeto[1]?.split("-")[0] || []
                                        const fechaActualizacionTZ_humana = `${fechaActualizacionTZ_array[2]}/${fechaActualizacionTZ_array[1]}/${fechaActualizacionTZ_array[0]} ${horaActualizacionTZ_array}`

                                        const plataformaDePagoUI = {
                                            efectivo: "Efectivo",
                                            transferenciaBancaria: "Transferencia bancaria",
                                            tarjeta: "Tarteja TPV",
                                            pasarela: "Pasarela de pago",
                                            cheque: "Cheque"
                                        }


                                        const contenedorRembolsoEnDetalle = document.createElement("div")
                                        contenedorRembolsoEnDetalle.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle")
                                        contenedorRembolsoEnDetalle.setAttribute("reembolsoUID", reembolsoUID)
                                        const tituloReembolso = document.createElement("div")
                                        tituloReembolso.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_tituloReembolso")
                                        tituloReembolso.classList.add("negrita")
                                        tituloReembolso.innerText = "Reembolso " + reembolsoUID
                                        contenedorRembolsoEnDetalle.appendChild(tituloReembolso)
                                        //plataformaDePago
                                        let bloque = document.createElement("div")
                                        bloque.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloque")
                                        let bloqueTitulo = document.createElement("div")
                                        bloqueTitulo.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueTitulo")
                                        bloqueTitulo.innerText = "Plataforma de reembolso"
                                        bloque.appendChild(bloqueTitulo)
                                        let bloqueDato = document.createElement("div")
                                        bloqueDato.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueDato");
                                        bloqueDato.classList.add("negrita")
                                        bloqueDato.innerText = plataformaDePagoUI[plataformaDePagoIDV]
                                        bloque.appendChild(bloqueDato)
                                        contenedorRembolsoEnDetalle.appendChild(bloque)
                                        //cantidadReembolso
                                        bloque = document.createElement("div")
                                        bloque.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloque")
                                        bloqueTitulo = document.createElement("div")
                                        bloqueTitulo.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueTitulo")
                                        bloqueTitulo.innerText = "Cantidad del reembolso"
                                        bloque.appendChild(bloqueTitulo)
                                        bloqueDato = document.createElement("div")
                                        bloqueDato.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueDato");
                                        bloqueDato.classList.add("negrita")
                                        bloqueDato.innerText = cantidad + "$"
                                        bloque.appendChild(bloqueDato)
                                        contenedorRembolsoEnDetalle.appendChild(bloque)
                                        //reembolsoUIDPasarela
                                        const bloqueReembolsoUIDPasarela = document.createElement("div")
                                        bloqueReembolsoUIDPasarela.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloque")
                                        bloqueTitulo = document.createElement("div")
                                        bloqueTitulo.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueTitulo")
                                        bloqueTitulo.innerText = "Reembolso UID en pasarela"
                                        bloqueReembolsoUIDPasarela.appendChild(bloqueTitulo)
                                        bloqueDato = document.createElement("div")
                                        bloqueDato.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueDato")
                                        bloqueDato.classList.add("negrita")
                                        bloqueDato.innerText = reembolsoUIDPasarela
                                        bloqueReembolsoUIDPasarela.appendChild(bloqueDato)
                                        if (plataformaDePagoIDV === "pasarela") {
                                            contenedorRembolsoEnDetalle.appendChild(bloqueReembolsoUIDPasarela)
                                        }
                                        //fechaCreacionUTC
                                        bloque = document.createElement("div")
                                        bloque.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloque")
                                        bloqueTitulo = document.createElement("div")
                                        bloqueTitulo.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueTitulo")
                                        bloqueTitulo.innerText = "Fecha de creaciÃ³n UTC"
                                        bloque.appendChild(bloqueTitulo)
                                        bloqueDato = document.createElement("div")
                                        bloqueDato.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueDato")
                                        bloqueDato.classList.add("negrita")
                                        bloqueDato.innerText = fechaCreacionUTC_humana
                                        bloque.appendChild(bloqueDato)
                                        contenedorRembolsoEnDetalle.appendChild(bloque)
                                        //fechaCreacion hora local
                                        bloque = document.createElement("div")
                                        bloque.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloque")
                                        bloqueTitulo = document.createElement("div")
                                        bloqueTitulo.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueTitulo")
                                        bloqueTitulo.innerText = "Fecha de creaciÃ³n hora local"
                                        bloque.appendChild(bloqueTitulo)
                                        bloqueDato = document.createElement("div")
                                        bloqueDato.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueDato")
                                        bloqueDato.classList.add("negrita")
                                        bloqueDato.innerText = fechaCreacionTZ_humana
                                        bloque.appendChild(bloqueDato)
                                        contenedorRembolsoEnDetalle.appendChild(bloque)
                                        //fechaActualizacionUTC
                                        bloque = document.createElement("div")
                                        bloque.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloque")
                                        bloqueTitulo = document.createElement("div")
                                        bloqueTitulo.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueTitulo")
                                        bloqueTitulo.innerText = "Fecha de actualizaciÃ³n UTC"
                                        bloque.appendChild(bloqueTitulo)
                                        bloqueDato = document.createElement("div")
                                        bloqueDato.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueDato")
                                        bloqueDato.classList.add("negrita")
                                        bloqueDato.innerText = fechaActualizacionUTC_humana
                                        bloque.appendChild(bloqueDato)
                                        if (plataformaDePagoIDV === "pasarela") {
                                            contenedorRembolsoEnDetalle.appendChild(bloque)
                                        }
                                        //fechaActualizacion hora local
                                        bloque = document.createElement("div")
                                        bloque.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloque")
                                        bloqueTitulo = document.createElement("div")
                                        bloqueTitulo.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueTitulo")
                                        bloqueTitulo.innerText = "Fecha de actualizaciÃ³n UTC"
                                        bloque.appendChild(bloqueTitulo)
                                        bloqueDato = document.createElement("div")
                                        bloqueDato.classList.add("administracion_reservas_detallesReservas_transacciones_reembolsos_contenedorReembolsoEnDetalle_bloqueDato")
                                        bloqueDato.classList.add("negrita")
                                        bloqueDato.innerText = fechaActualizacionTZ_humana
                                        bloque.appendChild(bloqueDato)
                                        if (plataformaDePagoIDV === "pasarela") {
                                            contenedorRembolsoEnDetalle.appendChild(bloque)
                                        }

                                        const contenedorBotones = document.createElement("div")
                                        contenedorBotones.classList.add("administracion_reservas_detallesReserva_transacciones_reembolsos_detallesReembolso_contenedorBotones")
                                        contenedorBotones.setAttribute("contenedor", "opcionesDelReembolso")
                                        const metadatosOpcionesReembolso = {
                                            instanciaUID_contenedorDinamicoTransacciones: instanciaUID_contenedorDinamicoTransacciones,
                                            instanciaUIDDetalleDelPago: instanciaUIDDetalleDelPago,
                                            reembolsoUID: reembolsoUID,
                                            pagoIUD: pagoUID
                                        }
                                        contenedorBotones.appendChild(botonOpcionesReembolsoUI(metadatosOpcionesReembolso))
                                        if (plataformaDePagoIDV !== "pasarela") {
                                            contenedorRembolsoEnDetalle.appendChild(contenedorBotones)
                                        }
                                        contenedorReembolsos.appendChild(contenedorRembolsoEnDetalle)
                                    })
                                    selectorInstanciaRenderizada.appendChild(contenedorReembolsos)
                                }
                            },
                            confirmar: async () => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const nombreEnlace = document.querySelector("[espacio=formularioCrearEnlaceDePago] [campo=nombreEnlace]")
                                const cantidad = document.querySelector("[espacio=formularioCrearEnlaceDePago] [campo=cantidad]")
                                const horasCaducidad = document.querySelector("[espacio=formularioCrearEnlaceDePago] [campo=horasCaducidad]")
                                const transaccion = {
                                    zona: "administracion/enlacesDePago/crearNuevoEnlace",
                                    reservaUID: reservaUID,
                                    nombreEnlace: nombreEnlace.value,
                                    cantidad: cantidad.value,
                                    horasCaducidad: horasCaducidad.value,
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                if (respuestaServidor?.error) {
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.UI.enlacesDePago()
                                }
                            }
                        },
                        reembolsos: {
                            reembolsoUI: async (metadatos) => {
                                const pagoUID = metadatos.pagoUID
                                //Esto que cojones es:
                                const instanciaUID_contenedorDinamicoTransacciones = metadatos.instanciaUID_contenedorDinamicoTransacciones
                                const instanciaUIDDetalleDelPago = metadatos.instanciaUIDDetalleDelPago
                                const selectorContenedorCrearReembolso = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [contenedor=nuevoReembolso]`)
                                selectorContenedorCrearReembolso.style.display = "flex"
                                const mostrarContenedorPorTipo = (tipoReembolso) => {
                                    const selectorTipoContenedores = selectorContenedorCrearReembolso.querySelectorAll("[contenedorTipoReembolso]")
                                    selectorTipoContenedores.forEach((contenedor) => {
                                        contenedor.style.display = "none"
                                    })
                                    selectorContenedorCrearReembolso.querySelector(`[contenedorTipoReembolso="${tipoReembolso}"]`).removeAttribute("style")
                                }
                                const reseteaBotonesTipoReembolso = () => {
                                    const selectorBotonesTipoReembolso = selectorContenedorCrearReembolso.querySelectorAll("[botonTipoReembolso]")
                                    selectorBotonesTipoReembolso.forEach((botonTipoReembolso) => {
                                        botonTipoReembolso.removeAttribute("style")
                                        botonTipoReembolso.removeAttribute("tipoReembolsoSeleccionado")
                                    })
                                }
                                const maximoReembolsable = async () => {
                                    const totalPagado = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [cantidadPago]`).getAttribute("cantidadPago")
                                    const totalReembolsado = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [sumaDeLoReembolsado]`)?.getAttribute("sumaDeLoReembolsado")
                                    const selectorUI = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [componente=totalReembolsable]`)
                                    selectorUI.innerText = "Esperando resultado del calculo..."
                                    if (!totalReembolsado) {
                                        selectorUI.innerText = `Total reembolsable ${totalPagado}$`
                                        selectorUI.setAttribute("totalReembolsable", totalPagado)

                                    }
                                    try {
                                        const transaccion = {
                                            zona: "administracion/componentes/calculadora",
                                            numero1: totalPagado,
                                            numero2: totalReembolsado || "0.00",
                                            operador: "-"
                                        }

                                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                        if (respuestaServidor?.error) {
                                            casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                        }
                                        if (respuestaServidor?.ok) {
                                            const resultado = Number(respuestaServidor?.ok).toFixed(2)
                                            selectorUI.innerText = `Total reembolsable ${resultado}$`
                                            selectorUI.setAttribute("totalReembolsable", resultado)
                                        }
                                        //casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.arranque()
                                    } catch (errorCapturado) {
                                        const error = errorCapturado.message
                                        casaVitini.ui.componentes.advertenciaInmersiva(error)
                                    }
                                }
                                const reglaDeTresPorcentaje = async (porcentaje) => {
                                    let totalReembolsable
                                    const selectorTotalReembolsableConReeembolsos = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [totalReembolsable]`)
                                    if (selectorTotalReembolsableConReeembolsos) {
                                        totalReembolsable = selectorTotalReembolsableConReeembolsos.getAttribute("totalReembolsable")
                                    } else {
                                        const selectorTotalReembolsableSinReembolsos = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [cantidadPago]`).getAttribute("cantidadPago")
                                        totalReembolsable = selectorTotalReembolsableSinReembolsos
                                    }
                                    const selectorUI = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [informacionPorcentaje=informacionPorcentaje]`)
                                    selectorUI.innerHTML = "Calculando..."
                                    try {
                                        const transaccion = {
                                            zona: "administracion/componentes/calculadora",
                                            numero1: totalReembolsable,
                                            numero2: porcentaje,
                                            operador: "%"
                                        }
                                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                        if (respuestaServidor?.error) {
                                            casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                        }
                                        if (respuestaServidor?.ok) {
                                            const resultado = Number(respuestaServidor?.ok).toFixed(2)
                                            selectorUI.innerText = `El reembolso serÃ­a de ${resultado}$ (El ${porcentaje}% de ${totalReembolsable}$ es ${resultado}$`
                                            selectorUI.setAttribute("totalReembolso", resultado)
                                        }
                                    } catch (errorCapturado) {
                                        const error = errorCapturado.message
                                        casaVitini.ui.componentes.advertenciaInmersiva(error)
                                    }
                                    /*  const calculo = (Number(porcentaje)/100) * Number(maximoReembolsable());
                                      const resultado = parseFloat(calculo.toFixed(2));
                                       resultado*/
                                };
                                const contenedorEmitirReembolso = document.createElement("div")
                                contenedorEmitirReembolso.classList.add("detallesReserva_rembolso_contenedorEmitirReembolso")
                                const titulo = document.createElement("p")
                                titulo.classList.add("detallesReservaTituloCancelarReserva")
                                titulo.innerText = "Realizar un reembolso"
                                contenedorEmitirReembolso.appendChild(titulo)
                                const bloqueReembolso = document.createElement("div")
                                bloqueReembolso.classList.add("detallesReserva_reemboldo_bloqueEmitirReembolso")
                                let bloqueInterno = document.createElement("div")
                                bloqueInterno.classList.add("detallesReserva_reembolso_bloqueInterno_campoConfiramcion")
                                const info = document.createElement("div")
                                info.classList.add("detallesReserva_reembolso_emitirReembolso_texto")
                                info.innerText = `Para realizar el reembolso, por favor, escribe reembolso en minÃºsculas en el campo de texto y, pulse realizar reembolso. Se exige escribir reembolso como medida para evitar un falso clic en el botÃ³n de confirmaciÃ³n al querer hacer clic en el botÃ³n de cerrar opciones de emisiÃ³n de reembolso.`
                                bloqueInterno.appendChild(info)
                                bloqueReembolso.appendChild(bloqueInterno)
                                const infoTotalReembolsable = document.createElement("div")
                                infoTotalReembolsable.classList.add("detallesReserva_reembolso_emitirReembolso_texto")
                                infoTotalReembolsable.classList.add("negrita")
                                infoTotalReembolsable.setAttribute("componente", "totalReembolsable")
                                //infoTotalReembolsable.innerText = `Total reembolsable ${await maximoReembolsable()}`
                                bloqueInterno.appendChild(infoTotalReembolsable)
                                bloqueReembolso.appendChild(bloqueInterno)
                                const contenedorTipoReembolsos = document.createElement("div")
                                contenedorTipoReembolsos.classList.add("detallesReserva_reembolso_emitirReembolso_contenedorTipoReembolsos")
                                const reembolsoPorCantidad = document.createElement("div")
                                reembolsoPorCantidad.classList.add("detallesReserva_reembolso_emitirReembolso_botonTipoReembolso")
                                reembolsoPorCantidad.innerText = "Por cantidad"
                                reembolsoPorCantidad.setAttribute("botonTipoReembolso", "porCantidad")
                                reembolsoPorCantidad.setAttribute("tipoReembolso", "porCantidad")
                                reembolsoPorCantidad.addEventListener("click", (e) => {
                                    reseteaBotonesTipoReembolso()
                                    e.target.setAttribute("tipoReembolsoSeleccionado", "porCantidad")
                                    e.target.style.background = "blue"
                                    e.target.style.color = "white"
                                    const tipoReembolso = e.target.getAttribute("tipoReembolso")
                                    mostrarContenedorPorTipo(tipoReembolso)
                                })
                                contenedorTipoReembolsos.appendChild(reembolsoPorCantidad)
                                const reembolsoPorPorcentaje = document.createElement("div")
                                reembolsoPorPorcentaje.classList.add("detallesReserva_reembolso_emitirReembolso_botonTipoReembolso")
                                reembolsoPorPorcentaje.innerText = "Por porcentaje"
                                reembolsoPorPorcentaje.setAttribute("botonTipoReembolso", "porPorcentaje")
                                reembolsoPorPorcentaje.setAttribute("tipoReembolso", "porPorcentaje")
                                reembolsoPorPorcentaje.addEventListener("click", (e) => {
                                    reseteaBotonesTipoReembolso()
                                    e.target.setAttribute("tipoReembolsoSeleccionado", "porPorcentaje")
                                    e.target.style.background = "blue"
                                    e.target.style.color = "white"
                                    const tipoReembolso = e.target.getAttribute("tipoReembolso")
                                    mostrarContenedorPorTipo(tipoReembolso)
                                })
                                contenedorTipoReembolsos.appendChild(reembolsoPorPorcentaje)
                                bloqueReembolso.appendChild(contenedorTipoReembolsos)
                                const contenedorDinamicoTipo = document.createElement("div")
                                contenedorDinamicoTipo.classList.add("detallesReserva_rembolso_contenedorDiamicoTipo")
                                const contenedorPorCantidad = document.createElement("div")
                                contenedorPorCantidad.classList.add("detallesReserva_rembolso_contenedorPorCantidad")
                                contenedorPorCantidad.style.display = "none"
                                contenedorPorCantidad.setAttribute("contenedorTipoReembolso", "porCantidad")
                                const infoPorCantidad = document.createElement("div")
                                infoPorCantidad.classList.add("detallesReserva_reembolso_emitirReembolso_texto")
                                infoPorCantidad.innerText = `Determina la cantidad total del reembolso. Si quieres emitir, por ejemplo, un reembolso de 100, entonces debes de escribir tambiÃ©n los dos decimales separados por punto, por ejemplo, 100.00. Luego establece la moneda.`
                                contenedorPorCantidad.appendChild(infoPorCantidad)
                                const campoCantidadReembolso = document.createElement("input")
                                campoCantidadReembolso.classList.add("detallesReserva_reembolso_campo")
                                campoCantidadReembolso.setAttribute("campo", "porCantidad")
                                campoCantidadReembolso.placeholder = "0.00"
                                contenedorPorCantidad.appendChild(campoCantidadReembolso)
                                const campoMonedaReembolso = document.createElement("input")
                                campoMonedaReembolso.classList.add("detallesReserva_reembolso_campo")
                                campoMonedaReembolso.setAttribute("campo", "moneda")
                                campoMonedaReembolso.placeholder = "EUR"
                                //contenedorPorCantidad.appendChild(campoMonedaReembolso)
                                contenedorDinamicoTipo.appendChild(contenedorPorCantidad)
                                const contenedorPorPorcentaje = document.createElement("div")
                                contenedorPorPorcentaje.classList.add("detallesReserva_rembolso_contenedorPorPorcentaje")
                                contenedorPorPorcentaje.style.display = "none"
                                contenedorPorPorcentaje.setAttribute("contenedorTipoReembolso", "porPorcentaje")
                                const infoPorPorcentaje = document.createElement("div")
                                infoPorPorcentaje.classList.add("detallesReserva_reembolso_emitirReembolso_texto")
                                infoPorPorcentaje.innerText = `Determina el porcentaje del reembolso.`
                                contenedorPorPorcentaje.appendChild(infoPorPorcentaje)
                                const resultadoPorcentaje = document.createElement("div")
                                resultadoPorcentaje.classList.add("detallesReserva_reembolso_emitirReembolso_texto")
                                resultadoPorcentaje.classList.add("negrita")
                                resultadoPorcentaje.setAttribute("informacionPorcentaje", "informacionPorcentaje")
                                resultadoPorcentaje.innerText = `Escribe un porcentaje para ver su cÃ¡lculo`
                                contenedorPorPorcentaje.appendChild(resultadoPorcentaje)
                                const campoPorcentajeReembolso = document.createElement("input")
                                campoPorcentajeReembolso.classList.add("detallesReserva_reembolso_campo")
                                campoPorcentajeReembolso.placeholder = "0%"
                                campoPorcentajeReembolso.addEventListener("input", (e) => {
                                    const entrada = e.target.value
                                    const selectorInformacionResultadoPorcentaje = document.querySelector("[informacionPorcentaje=informacionPorcentaje]")
                                    const controlFormato = /^\d+%$/.test(entrada);
                                    if (entrada.length === 0) {
                                        selectorInformacionResultadoPorcentaje.innerText = "Escribe un porcentaje para ver su cÃ¡lculo"
                                        e.target.removeAttribute("totalReembolso")
                                    } else {
                                        if (!controlFormato) {
                                            selectorInformacionResultadoPorcentaje.innerText = "No te olvides del signo de porcentaje %, solo nÃºmeros enteros sin decimales."
                                            e.target.removeAttribute("totalReembolso")
                                        } else {
                                            const numeroLimpio = entrada.replace("%", "")
                                            reglaDeTresPorcentaje(numeroLimpio)
                                        }
                                    }
                                })
                                contenedorPorPorcentaje.appendChild(campoPorcentajeReembolso)
                                contenedorDinamicoTipo.appendChild(contenedorPorPorcentaje)
                                const campoMoneda = document.createElement("input")
                                campoMoneda.classList.add("detallesReserva_reembolso_campo")
                                campoMoneda.setAttribute("campo", "moneda")
                                campoMoneda.placeholder = "Moneda, por ejemplo EUR o USD"
                                //contenedorPorPorcentaje.appendChild(campoMoneda)
                                contenedorDinamicoTipo.appendChild(contenedorPorPorcentaje)
                                const selectorTipoReembolso = document.createElement("select")
                                selectorTipoReembolso.classList.add("usuariosCrearCuenta_campoUsuario")
                                selectorTipoReembolso.setAttribute("campo", "plataformaDePagoEntrada")
                                const opcionPreterminada = document.createElement("option");
                                opcionPreterminada.value = "";
                                opcionPreterminada.selected = "true"
                                opcionPreterminada.disabled = "true"
                                opcionPreterminada.text = "Selecciona como realizar este reeembolso";
                                selectorTipoReembolso.add(opcionPreterminada);
                                let opcion = document.createElement("option");
                                opcion.value = "efectivo";
                                opcion.text = "Efectivo";
                                selectorTipoReembolso.add(opcion);
                                opcion = document.createElement("option");
                                opcion.value = "tarjeta";
                                opcion.text = "Tarjeta TPV";
                                selectorTipoReembolso.add(opcion);
                                opcion = document.createElement("option");
                                opcion.value = "cheque";
                                opcion.text = "Cheque";
                                selectorTipoReembolso.add(opcion);
                                opcion = document.createElement("option");
                                opcion.value = "pasarela";
                                opcion.text = "Pasarela";
                                selectorTipoReembolso.add(opcion);
                                //cheque pasarela, tarjeta TPV
                                contenedorDinamicoTipo.appendChild(selectorTipoReembolso)
                                bloqueReembolso.appendChild(contenedorDinamicoTipo)
                                bloqueInterno = document.createElement("div")
                                bloqueInterno.classList.add("detallesReserva_reembolso_bloqueInterno_campoConfiramcion")
                                const infoCampoConfirmacion = document.createElement("div")
                                infoCampoConfirmacion.classList.add("detallesReserva_reembolso_emitirReembolso_texto")
                                infoCampoConfirmacion.innerText = `Para realizar el reembolso, por favor, escribe reembolso en minÃºsculas en el campo de texto y, pulse realizar reembolso. Se exige escribir reembolso como medida para evitar un falso clic en el botÃ³n de confirmaciÃ³n al querer hacer click en el botÃ³n de cerrar opciones de emisiÃ³n de reembolso.`
                                bloqueInterno.appendChild(infoCampoConfirmacion)
                                const campoConfirmacion = document.createElement("input")
                                campoConfirmacion.classList.add("detallesReserva_reembolso_campoConfirmacion")
                                campoConfirmacion.setAttribute("campo", "palabra")
                                campoConfirmacion.placeholder = "Escribe la palabra reembolso"
                                bloqueInterno.appendChild(campoConfirmacion)
                                bloqueReembolso.appendChild(bloqueInterno)
                                contenedorEmitirReembolso.appendChild(bloqueReembolso)
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReserva_reembolso_emitirReembolso_contenedorBotones")
                                const botonConfirmar = document.createElement("div")
                                botonConfirmar.classList.add("detallesReservaCancelarBoton")
                                botonConfirmar.setAttribute("componente", "botonActualizarEnlace")
                                botonConfirmar.innerText = "Realizar reembolso"
                                botonConfirmar.addEventListener("click", () => {
                                    const metadatos = {
                                        pagoUID: pagoUID,
                                        instanciaUID_contenedorDinamicoTransacciones: instanciaUID_contenedorDinamicoTransacciones,
                                        instanciaUIDDetalleDelPago: instanciaUIDDetalleDelPago
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.reembolsos.confirmarReembolso(metadatos)
                                })
                                bloqueBotones.appendChild(botonConfirmar)
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("detallesReservaCancelarBoton")
                                botonCancelar.innerText = "Cerrar opciones de emitir reembolso"
                                botonCancelar.addEventListener("click", () => {
                                    selectorContenedorCrearReembolso.innerHTML = null
                                    selectorContenedorCrearReembolso.removeAttribute("style")
                                })
                                bloqueBotones.appendChild(botonCancelar)
                                contenedorEmitirReembolso.appendChild(bloqueBotones)
                                selectorContenedorCrearReembolso.appendChild(contenedorEmitirReembolso)
                                maximoReembolsable();
                            },
                            eliminarReembolso: async (metadatos) => {
                                const instanciaUIDDetalleDelPago = metadatos.instanciaUIDDetalleDelPago
                                const reembolsoUID = metadatos.reembolsoUID
                                const instanciaUID = metadatos.instanciaUID
                                const metadatosPantallaCarga = {
                                    mensaje: "Eliminando reembolso...",
                                    instanciaUID: instanciaUIDDetalleDelPago,
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                const pagoUID = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"]`).querySelector("[pagoUID]").getAttribute("pagoUID")
                                const palabra = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"]`).querySelector(`[reembolsoUID="${reembolsoUID}"] [campo=palabra]`).value
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/transacciones/eliminarReembolsoManual",
                                    reembolsoUID: String(reembolsoUID),
                                    palabra: palabra
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUIDDetalleDelPago}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                selectorPantallaDeCarga.forEach((pantalla) => {
                                    pantalla.remove()
                                })
                                if (respuestaServidor?.error) {
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const selectorDetallesDelPagoRenderizado = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"]`)
                                    if (selectorDetallesDelPagoRenderizado) {
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.arranque()
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        const metadatos = {
                                            pagoUID: pagoUID,
                                            instanciaUID: instanciaUID
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.detallesDelPago.UI(metadatos)
                                    }
                                }
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            },
                            confirmarReembolso: async (metadatos) => {
                                const pagoUID = String(metadatos.pagoUID)
                                const instanciaUID_contenedorDinamicoTransacciones = metadatos.instanciaUID_contenedorDinamicoTransacciones
                                const instanciaUIDDetalleDelPago = metadatos.instanciaUIDDetalleDelPago
                                const instanciaUID_pantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const tipoReembolso = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [tipoReembolsoSeleccionado]`)?.getAttribute("tipoReembolsoSeleccionado")
                                if (!tipoReembolso) {
                                    const error = "Selecciona un tipo de reembolso, ya sea por cantidad o por porcentaje"
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(error)
                                }
                                const metadatosPantallaCarga = {
                                    mensaje: "Esperando al servidor...",
                                    instanciaUID: instanciaUID_pantallaDeCarga,
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/transacciones/realizarReembolso",
                                    reservaUID: reservaUID,
                                    pagoUID: pagoUID
                                }
                                if (tipoReembolso === "porPorcentaje") {
                                    const cantidad = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [contenedortiporeembolso=porPorcentaje] [totalReembolso]`)?.getAttribute("totalReembolso")
                                    //const moneda = document.querySelector(`[instanciaUID="${instanciaUID}"] [contenedortiporeembolso=porPorcentaje] [campo=moneda]`)?.value
                                    transaccion.cantidad = cantidad
                                    //transaccion.moneda = moneda
                                }
                                if (tipoReembolso === "porCantidad") {
                                    const cantidad = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [contenedortiporeembolso=porCantidad] [campo=porCantidad]`)?.value
                                    //const moneda = document.querySelector(`[instanciaUID="${instanciaUID}"] [contenedortiporeembolso=porCantidad] [campo=moneda]`)?.value
                                    transaccion.cantidad = cantidad
                                    //transaccion.moneda = moneda
                                }
                                transaccion.tipoReembolso = tipoReembolso
                                const plataformaDePagoEntrada = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [contenedor=nuevoReembolso] [campo=plataformaDePagoEntrada]`).value
                                transaccion.plataformaDePagoEntrada = plataformaDePagoEntrada
                                const palabra = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"] [campo=palabra]`)?.value
                                transaccion.palabra = palabra

                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUID_pantallaDeCarga}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                selectorPantallaDeCarga.forEach((pantalla) => {
                                    pantalla.remove()
                                })
                                if (respuestaServidor?.error) {
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.arranque()
                                    const mensaje = respuestaServidor?.ok
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const metadatos = {
                                        pagoUID: pagoUID,
                                        instanciaUID_contenedorDinamicoTransacciones: instanciaUID_contenedorDinamicoTransacciones
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.detallesDelPago.UI(metadatos)
                                    //casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(mensaje)
                                }
                            }
                        },
                        crearPagoManual: {
                            UI: () => {
                                const mostrarContenedorTipoPago = (opcion) => {
                                    const selectorInfo = document.querySelector("[componente=advertenciaInmersiva] [componente=infoDesplegable]")
                                    selectorInfo?.remove()
                                    const selectorTodosLosContenedorTipoPago = document.querySelectorAll(`[componente=advertenciaInmersiva] [contenedorTipoPago]`)
                                    selectorTodosLosContenedorTipoPago.forEach((contenedorTipoPago) => {
                                        contenedorTipoPago.removeAttribute("style")
                                        contenedorTipoPago.removeAttribute("estado")
                                    })
                                    const tipoPago = opcion.target.value
                                    const selectorContenedorTipoPago = document.querySelector(`[componente=advertenciaInmersiva] [contenedorTipoPago=${tipoPago}]`)
                                    if (selectorContenedorTipoPago) {
                                        selectorContenedorTipoPago.style.display = "flex"
                                        selectorContenedorTipoPago.setAttribute("estado", "activa")
                                    }
                                }
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const advertenciaInmersivaIU = document.createElement("div")
                                advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                                advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                                const contenedorAdvertenciaInmersiva = document.createElement("div")
                                contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                const contenidoAdvertenciaInmersiva = document.createElement("div")
                                contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                contenidoAdvertenciaInmersiva.setAttribute("espacio", "formularioCrearPagoManual")
                                const titulo = document.createElement("p")
                                titulo.classList.add("detallesReservaTituloCancelarReserva")
                                titulo.innerText = "Crear un pago manual"
                                contenidoAdvertenciaInmersiva.appendChild(titulo)
                                const bloque = document.createElement("div")
                                bloque.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                                let info = document.createElement("div")
                                info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                info.innerText = `Crea un pago manual cuando necesites crear un pago por fuera de la pasarela. Escoge el tipo de pago, si es efectivo o si es por TPV por ejemplo. Luego rellena los datos y el pago se aÃ±adirÃ¡ a la lista de pagos de la reserva. Los pagos manuales requieren una acciÃ³n manual.`
                                bloque.appendChild(info)
                                const selectorTipoDePago = document.createElement("select")
                                selectorTipoDePago.classList.add("usuariosCrearCuenta_campoUsuario")
                                selectorTipoDePago.setAttribute("campo", "selectorRol")
                                selectorTipoDePago.addEventListener("change", mostrarContenedorTipoPago)
                                const opcionPreterminada = document.createElement("option");
                                opcionPreterminada.value = "";
                                opcionPreterminada.selected = "true"
                                opcionPreterminada.disabled = "true"
                                opcionPreterminada.text = "Selecciona la plataforma pago";
                                selectorTipoDePago.add(opcionPreterminada);
                                let opcion = document.createElement("option");
                                opcion.value = "efectivo";
                                opcion.text = "Efectivo";
                                selectorTipoDePago.add(opcion);
                                opcion = document.createElement("option");
                                opcion.value = "transferenciaBancaria";
                                opcion.text = "Transferencia bancaria";
                                selectorTipoDePago.add(opcion);
                                opcion = document.createElement("option");
                                opcion.value = "tarjeta";
                                opcion.text = "Tarjeta TPV";
                                selectorTipoDePago.add(opcion);
                                opcion = document.createElement("option");
                                opcion.value = "cheque";
                                opcion.text = "Cheque";
                                selectorTipoDePago.add(opcion);
                                opcion = document.createElement("option");
                                opcion.value = "pasarela";
                                opcion.text = "Pasarela(Asociar pago)";
                                selectorTipoDePago.add(opcion);
                                //cheque pasarela, tarjeta TPV
                                bloque.appendChild(selectorTipoDePago)
                                const contenedorTipoPago = document.createElement("div")
                                contenedorTipoPago.classList.add("administracion_reservas_detalleReserva_pagoManual_contenedorTipoPago")
                                const infoDesplegable = document.createElement("p")
                                infoDesplegable.classList.add("info")
                                infoDesplegable.setAttribute("componente", "infoDesplegable")
                                infoDesplegable.innerText = "Selecciona el tipo de plataforma de pago en el desplegable"
                                contenedorTipoPago.appendChild(infoDesplegable)
                                const contenedorEfectivo = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.crearPagoManual.contenedoresTipoPago.efectivo()
                                contenedorTipoPago.appendChild(contenedorEfectivo)
                                const contenedorCheque = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.crearPagoManual.contenedoresTipoPago.cheque()
                                contenedorTipoPago.appendChild(contenedorCheque)
                                const contenedorTransferenciaBancaria = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.crearPagoManual.contenedoresTipoPago.transferenciaBancaria()
                                contenedorTipoPago.appendChild(contenedorTransferenciaBancaria)
                                const contenedorTarjeta = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.crearPagoManual.contenedoresTipoPago.tarjeta()
                                contenedorTipoPago.appendChild(contenedorTarjeta)
                                const contenedorPasarela = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.crearPagoManual.contenedoresTipoPago.pasarela()
                                contenedorTipoPago.appendChild(contenedorPasarela)
                                bloque.appendChild(contenedorTipoPago)
                                contenidoAdvertenciaInmersiva.appendChild(bloque)
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                                const botonConfirmar = document.createElement("div")
                                botonConfirmar.classList.add("detallesReservaCancelarBoton")
                                botonConfirmar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                botonConfirmar.innerText = "Confirmar y guardar pago manual"
                                botonConfirmar.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.crearPagoManual.confirmar()
                                })
                                bloqueBotones.appendChild(botonConfirmar)
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("detallesReservaCancelarBoton")
                                botonCancelar.innerText = "Cancelar y volver"
                                botonCancelar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                bloqueBotones.appendChild(botonCancelar)
                                contenidoAdvertenciaInmersiva.appendChild(bloqueBotones)
                                const contenedorGlobal = document.createElement("div")
                                contenedorGlobal.classList.add("detallesReserva_enlaceDePago_contenedorGlobal")
                                contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                                document.querySelector("main").appendChild(advertenciaInmersivaIU)
                            },
                            confirmar: async () => {
                                const instanciaUID_contenedorDinamicoTransacciones = document.querySelector("[contenedorID=transacciones]").getAttribute("instanciaUID")
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const contenedorActivo = document.querySelector("[estado=activa][contenedorTipoPago]")
                                const plataformaDePago = document.querySelector("[campo=selectorRol]").value
                                const instanciaUID_pantallaEspera = casaVitini.utilidades.codigoFechaInstancia()
                                const metadatosPantallaCarga = {
                                    mensaje: "Esperando al servidor...",
                                    instanciaUID: instanciaUID_pantallaEspera,
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/transacciones/crearPagoManual",
                                    plataformaDePago: plataformaDePago,
                                    reservaUID: reservaUID
                                }
                                if (contenedorActivo) {
                                    contenedorActivo.querySelectorAll("[campo]").forEach((campo) => {
                                        const nombreCampo = campo.getAttribute("campo")
                                        const valorCampo = campo.value
                                        transaccion[nombreCampo] = valorCampo
                                    })
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUID_pantallaEspera}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                selectorPantallaDeCarga.forEach((pantalla) => {
                                    pantalla.remove()
                                })
                                if (respuestaServidor?.error) {
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const seleccionarInstancia = document.querySelector(`[instanciaUID="${instanciaUID_contenedorDinamicoTransacciones}"]`)
                                    if (seleccionarInstancia) {
                                        const datosPagosGlobal = {
                                            reservaUID: reservaUID,
                                            instanciaUID_contenedorDinamicoTransacciones: instanciaUID_contenedorDinamicoTransacciones
                                        }
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.actualizarDatosGlobalesPago(datosPagosGlobal)
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        const selectorInfoNoPago = seleccionarInstancia.querySelector(`[contenedor=infoNoPagos]`)
                                        if (selectorInfoNoPago) {
                                            selectorInfoNoPago.remove()
                                        }
                                        const selectorContenedorListaDePagos = seleccionarInstancia.querySelector(`[contenedor=listaDePagos]`)
                                        const selectorTransaccionesUI = seleccionarInstancia.querySelector("[contenedor=transaccionesUI]")
                                        if (!selectorContenedorListaDePagos) {
                                            const bloqueListaDePagos = document.createElement("div")
                                            bloqueListaDePagos.classList.add("reservaDetalles_transacciones_bloqueListaDePagos")
                                            bloqueListaDePagos.setAttribute("contenedor", "listaDePagos")
                                            selectorTransaccionesUI.appendChild(bloqueListaDePagos)
                                        }
                                        const detallesDelPago = respuestaServidor.detallesDelPago
                                        const enlaceUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.UI.pagoUI(detallesDelPago)
                                        const listaDePagosRenderizada = seleccionarInstancia.querySelector(`[contenedor=listaDePagos]`)
                                        if (listaDePagosRenderizada.childElementCount === 0) {
                                            listaDePagosRenderizada.appendChild(enlaceUI);
                                        } else if (listaDePagosRenderizada.childElementCount > 0) {
                                            const primerElemento = listaDePagosRenderizada.firstChild;
                                            listaDePagosRenderizada.insertBefore(enlaceUI, primerElemento);
                                        }
                                    }
                                }
                            },
                            contenedoresTipoPago: {
                                efectivo: () => {
                                    const contenedor = document.createElement("div")
                                    contenedor.classList.add("administracion_reservas_detallesReserva_transacciones_pagoManual_contenedorTipoPago")
                                    contenedor.setAttribute("contenedorTipoPago", "efectivo")
                                    info = document.createElement("div")
                                    info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                    info.innerText = `Determina la cantidad del pago, recuerda que debe tener dos decimales siempre, por ejemplo, 10.00.`
                                    contenedor.appendChild(info)
                                    let campo = document.createElement("input")
                                    campo.classList.add("detallesReserva_campoNombreEnlace")
                                    campo.setAttribute("campo", "cantidad")
                                    campo.placeholder = "Cantidad del pago, ejemplo 12.95"
                                    contenedor.appendChild(campo)
                                    return contenedor
                                },
                                transferenciaBancaria: () => {
                                    const contenedor = document.createElement("div")
                                    contenedor.classList.add("administracion_reservas_detallesReserva_transacciones_pagoManual_contenedorTipoPago")
                                    contenedor.setAttribute("contenedorTipoPago", "transferenciaBancaria")
                                    info = document.createElement("div")
                                    info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                    info.innerText = `Determina la cantidad de la transferencia bancaria. Recuerda que la cantidad debe tener dos decimales siempre, por ejemplo, 10.00.`
                                    contenedor.appendChild(info)
                                    let campo = document.createElement("input")
                                    campo.classList.add("detallesReserva_campoNombreEnlace")
                                    campo.setAttribute("campo", "transferenciaUID")
                                    campo.placeholder = "CÃ³digo identificador de la transferencia bancaria."
                                    contenedor.appendChild(campo)
                                    campo = document.createElement("input")
                                    campo.classList.add("detallesReserva_campoNombreEnlace")
                                    campo.setAttribute("campo", "cantidad")
                                    campo.placeholder = "Cantidad especificada en la transferencia bancaria, ejemplo: 12.95."
                                    contenedor.appendChild(campo)
                                    return contenedor
                                },
                                cheque: () => {
                                    const contenedor = document.createElement("div")
                                    contenedor.classList.add("administracion_reservas_detallesReserva_transacciones_pagoManual_contenedorTipoPago")
                                    contenedor.setAttribute("contenedorTipoPago", "cheque")
                                    info = document.createElement("div")
                                    info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                    info.innerText = `Determina la cantidad del pago en modalidad cheque bancario. Recuerda que la cantidad especificada debe tener dos decimales siempre, por ejemplo, 10.00.`
                                    contenedor.appendChild(info)
                                    let campo = document.createElement("input")
                                    campo.classList.add("detallesReserva_campoNombreEnlace")
                                    campo.setAttribute("campo", "chequeUID")
                                    campo.placeholder = "CÃ³digo identificador del cheque."
                                    contenedor.appendChild(campo)
                                    campo = document.createElement("input")
                                    campo.classList.add("detallesReserva_campoNombreEnlace")
                                    campo.setAttribute("campo", "cantidad")
                                    campo.placeholder = "Cantidad especificada en el cheque, ejemplo: 12.95."
                                    contenedor.appendChild(campo)
                                    return contenedor
                                },
                                tarjeta: () => {
                                    const contenedor = document.createElement("div")
                                    contenedor.classList.add("administracion_reservas_detallesReserva_transacciones_pagoManual_contenedorTipoPago")
                                    contenedor.setAttribute("contenedorTipoPago", "tarjeta")
                                    info = document.createElement("div")
                                    info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                    info.innerText = `Determina la cantidad del pago en tarjeta, inserte los datos del pago realizado con el TPV.`
                                    contenedor.appendChild(info)
                                    let campo = document.createElement("input")
                                    campo.classList.add("detallesReserva_campoNombreEnlace")
                                    campo.setAttribute("campo", "tarjetaUltimos")
                                    campo.placeholder = "Cuatro Ãºltimos dÃ­gitos de la tarjeta."
                                    contenedor.appendChild(campo)
                                    campo = document.createElement("input")
                                    campo.classList.add("detallesReserva_campoNombreEnlace")
                                    campo.setAttribute("campo", "cantidad")
                                    campo.placeholder = "Cantidad especificada en el pago por TPV, ejemplo: 12.95."
                                    contenedor.appendChild(campo)
                                    return contenedor
                                },
                                pasarela: () => {
                                    const contenedor = document.createElement("div")
                                    contenedor.classList.add("administracion_reservas_detallesReserva_transacciones_pagoManual_contenedorTipoPago")
                                    contenedor.setAttribute("contenedorTipoPago", "pasarela")
                                    info = document.createElement("div")
                                    info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                    info.innerText = `Si algÃºn pago no se ha sincronizado o si quieres sincronizar un pago, inserta el cÃ³digo identificador del pago de la pasarela.`
                                    contenedor.appendChild(info)
                                    let campo = document.createElement("input")
                                    campo.classList.add("detallesReserva_campoNombreEnlace")
                                    campo.setAttribute("campo", "pagoUIDPasarela")
                                    campo.placeholder = "CÃ³digo identificador de pago, por ejemplo: h8qikEKdMiyPEtm5pKgjwv1fMSeZY"
                                    contenedor.appendChild(campo)
                                    return contenedor
                                }
                            }
                        },
                        eliminarPagoManual: {
                            UI: (metadatos) => {

                                const instanciaUIDDetalleDelPago = metadatos.instanciaUIDDetalleDelPago
                                const contenedor = document.createElement("div")
                                contenedor.classList.add("administracion_reservas_detallesReserva_transacciones_eliminarPagoManual")
                                const infoGlobal = document.createElement("div")
                                infoGlobal.classList.add("detallesReserva_reembolso_infoGlobal")
                                infoGlobal.innerText = `Para eliminar este pago, escriba la palabra eliminar en el campo de texto y pulse el botÃ³n eliminar. Recuerda que esto es una operaciÃ³n irreversible porque estÃ¡s eliminado el pago de la base de datos. Los reembolsos de este pago tambiÃ©n se eliminarÃ¡n.`
                                contenedor.appendChild(infoGlobal)
                                const campoEliminar = document.createElement("input")
                                campoEliminar.classList.add("detallesReserva_reembolso_campo")
                                campoEliminar.setAttribute("campo", "palabra")
                                campoEliminar.placeholder = "Escriba la palabra eliminar"
                                contenedor.appendChild(campoEliminar)
                                const botonConfirmar = document.createElement("div")
                                botonConfirmar.classList.add("detallesReservaCancelarBoton")
                                botonConfirmar.setAttribute("componente", "botonActualizarEnlace")
                                botonConfirmar.innerText = "Eliminar irreversiblemente el pago"
                                botonConfirmar.addEventListener("click", () => {
                                    const metadatos = {
                                        instanciaUIDDetalleDelPago: instanciaUIDDetalleDelPago
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.eliminarPagoManual.confirmar(metadatos)
                                })
                                contenedor.appendChild(botonConfirmar)
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("detallesReservaCancelarBoton")
                                botonCancelar.setAttribute("componente", "botonActualizarEnlace")
                                botonCancelar.innerText = "Cerrar opciones de eliminaciÃ³n del pago"
                                botonCancelar.addEventListener("click", (e) => {
                                    const selectorContenedorEliminar = e.target.closest("[contenedor=eliminarPago]")
                                    selectorContenedorEliminar.innerHTML = null
                                    selectorContenedorEliminar.removeAttribute("style")
                                })
                                contenedor.appendChild(botonCancelar)
                                return contenedor
                            },
                            confirmar: async (metadatos) => {
                                const instanciaUIDDetalleDelPago = metadatos.instanciaUIDDetalleDelPago
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const instanciaUID_pantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                const metadatosPantallaCarga = {
                                    mensaje: "Esperando al servidor...",
                                    instanciaUID: instanciaUID_pantallaDeCarga,
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                const pagoUID = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"]`).querySelector("[pagoUID]").getAttribute("pagoUID")
                                const palabra = document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"]`).querySelector("[contenedor=eliminarPago] [campo=palabra]").value
                                const instanciaUID_contenedorDinamicoTransacciones = document.querySelector(`[reservaUID="${reservaUID}"] [contenedorID=transacciones]`).getAttribute("instanciaUID")
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/transacciones/eliminarPagoManual",
                                    pagoUID: String(pagoUID),
                                    palabra: palabra,
                                    reservaUID: String(reservaUID)
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const selectorPantallaDeCarga = document.querySelectorAll(`[instanciaUID="${instanciaUID_pantallaDeCarga}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`)
                                selectorPantallaDeCarga.forEach((pantalla) => {
                                    pantalla.remove()
                                })
                                if (respuestaServidor?.error) {
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const datosActualizar = {
                                        reservaUID: reservaUID,
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.actualizarDatosGlobalesPago(datosActualizar)
                                    document.body.removeAttribute("style")
                                    document.querySelector(`[instanciaUID="${instanciaUIDDetalleDelPago}"]`)?.remove()


                                    const contenedorTransacciones = document.querySelector(`[contenedorID=transacciones][instanciaUID="${instanciaUID_contenedorDinamicoTransacciones}"]`)
                                    const listaDePagos = contenedorTransacciones.querySelector(`[contenedor=listaDePagos]`)
                                    listaDePagos.querySelector(`[pagoUID="${pagoUID}"]`)?.remove()
                                    const pagosRestantes = listaDePagos.querySelectorAll(`[pagoUID]`)
                                    if (pagosRestantes.length === 0) {
                                        listaDePagos?.remove()
                                        const infoNoPagoUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.transacciones.UI.infoNoPagos()
                                        contenedorTransacciones.querySelector("[contenedor=transaccionesUI]").appendChild(infoNoPagoUI)
                                    }
                                }
                            }
                        },
                        actualizarDatosGlobalesPago: async (metadatos) => {
                            const reservaUID = metadatos.reservaUID
                            const instanciaUID_contenedorDinamicoTransacciones = document.querySelector("[contenedorID=transacciones]").getAttribute("instanciaUID")
                            const selectorTotalReservaEnPanelGlobal = document.querySelector(`[dataReserva=totalReservaConImpuestos]`)
                            const selectorTotalReserva = document.querySelector(`[componentePago=totalReserva]`)
                            const selectorTotalPagado = document.querySelector(`[componentePago=totalPagado]`)
                            const selectorFaltantePorPagar = document.querySelector(`[componentePago=faltantePorPagar]`)
                            const selectorEstadoPago = document.querySelector(`[dataReserva=estadoPago]`)
                            const selectorPorecentajeReembolsado = document.querySelector(`[componentePago=porcentajeReembolsado]`)
                            const selectorPorecentajePagado = document.querySelector(`[componentePago=porcentajePagado]`)
                            const selectorTotalReembolsado = document.querySelector(`[componentePago=totalReembolsado]`)
                            const reservaAcutalRenderizada = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            if (reservaAcutalRenderizada === reservaUID) {
                                selectorTotalReservaEnPanelGlobal.innerHTML = "Recalculando..."
                            }
                            selectorTotalReserva.innerHTML = "Recalculando..."
                            selectorTotalPagado.innerHTML = "Recalculando..."
                            selectorFaltantePorPagar.innerHTML = "Recalculando..."
                            selectorEstadoPago.innerHTML = "Recalculando..."
                            selectorPorecentajeReembolsado.innerHTML = "Total reembolsado"
                            selectorPorecentajePagado.innerHTML = "Total pagado"
                            selectorTotalReembolsado.innerHTML = "Recalculando..."
                            const obtenerPagoaActualizados = {
                                zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                                reservaUID: reservaUID,
                                capas: [
                                    "detallesPagos",
                                ]
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(obtenerPagoaActualizados)
                            const seleccionarInstancia = document.querySelector(`[instanciaUID="${instanciaUID_contenedorDinamicoTransacciones}"]`)
                            if (respuestaServidor?.error) {
                                if (seleccionarInstancia) {
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                            }
                            if (respuestaServidor?.ok) {
                                const data = respuestaServidor.ok
                                const estadoPago = respuestaServidor.ok.global.estadoPagoIDV
                                const detallesPagos = data.detallesPagos
                                const totalReserva = detallesPagos.totalReserva
                                const totalPagado = detallesPagos.totalPagado
                                const faltantePorPagar = detallesPagos.faltantePorPagar
                                const totalReembolsado = detallesPagos.totalReembolsado
                                const porcentajeReembolsado = detallesPagos.porcentajeReembolsado
                                const porcentajePagado = detallesPagos.porcentajePagado
                                if (reservaAcutalRenderizada === reservaUID) {
                                    selectorTotalReservaEnPanelGlobal.innerHTML = totalReserva + "$"
                                }
                                if (!seleccionarInstancia) {


                                }
                                selectorTotalReserva.innerHTML = totalReserva + "$"
                                selectorTotalPagado.innerHTML = totalPagado + "$"
                                selectorFaltantePorPagar.innerHTML = faltantePorPagar + "$"
                                selectorPorecentajeReembolsado.innerHTML = `Total reembolsado (${porcentajeReembolsado})`
                                selectorPorecentajePagado.innerHTML = `Total pagado (${porcentajePagado})`
                                selectorTotalReembolsado.innerHTML = totalReembolsado + "$"
                                let estadoPagoUI
                                if (estadoPago === "pagado") {
                                    estadoPagoUI = "Pagado"
                                }
                                if (estadoPago === "noPagado") {
                                    estadoPagoUI = "No pagado"
                                }
                                if (estadoPago === "pagadoParcialmente") {
                                    estadoPagoUI = "Pagado parcialmente"
                                }
                                if (estadoPago === "pagadoSuperadamente") {
                                    estadoPagoUI = "Pagado superadamente"
                                }
                                selectorEstadoPago.innerHTML = estadoPagoUI
                            }
                        },
                        crearEnlace_obsoleto: {
                            UI: async (instanciaUID) => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const advertenciaInmersivaIU = document.createElement("div")
                                advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                                advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                                const contenedorAdvertenciaInmersiva = document.createElement("div")
                                contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                                const contenidoAdvertenciaInmersiva = document.createElement("div")
                                contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                                contenidoAdvertenciaInmersiva.setAttribute("espacio", "formularioCrearEnlaceDePago")
                                const titulo = document.createElement("p")
                                titulo.classList.add("detallesReservaTituloCancelarReserva")
                                titulo.innerText = "Generar enlace de pago"
                                contenidoAdvertenciaInmersiva.appendChild(titulo)
                                const bloque = document.createElement("div")
                                bloque.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                                let info = document.createElement("div")
                                info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                info.innerText = `Genera un enlace de pago para poder enviarlo a un cliente y que realice el pago de la reserva. No es obligatorio escribir un nombre, pero sÃ­ recomendable, por si necesita acordarse de por quÃ© se genera este enlace. Si no define ningÃºn nombre, este se llamarÃ¡ "Enlace de pago de la reserva ${reservaUID}". Este es el nombre automÃ¡tico que tendrÃ¡ este enlace si no define un nombre en especÃ­fico. Recuerde que todos los enlaces generados y su gestiÃ³n centralizada la puede encontrar en el panel de administraciÃ³n, en el botÃ³n de Enlaces de Pago desde el menÃº administraciÃ³n o en su reserva correspondiente dentro del apartado Enlaces de Pago.  
                        `
                                bloque.appendChild(info)
                                let campo = document.createElement("input")
                                campo.classList.add("detallesReserva_campoNombreEnlace")
                                campo.setAttribute("campo", "nombreEnlace")
                                campo.placeholder = "Escribe un nombre para el nuevo enlace, si quiere."
                                bloque.appendChild(campo)
                                info = document.createElement("div")
                                info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                info.innerText = `Determina la cantidad de pago del enlace, recuerda que los precios de cobro deben de escribirse con dos decimales separados por punto. Por ejemplo, para crear un enlace de pago de 35 dÃ³lares escribe 35.00.`
                                bloque.appendChild(info)
                                campo = document.createElement("input")
                                campo.classList.add("detallesReserva_campoNombreEnlace")
                                campo.classList.add("negrita")
                                campo.setAttribute("campo", "cantidad")
                                campo.placeholder = "Cantidad(Obligatorio)"
                                bloque.appendChild(campo)
                                info = document.createElement("div")
                                info.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                info.innerText = `Determina el tiempo de vigencia del enlace. Por defecto, el sistema aplica 72h si no especificas una vigencia concreta. Pasada la vigencia, el enlace ya no puede realizar el cobro y desaparece.`
                                bloque.appendChild(info)
                                campo = document.createElement("input")
                                campo.classList.add("detallesReserva_campoNombreEnlace")
                                campo.setAttribute("campo", "horasCaducidad")
                                campo.placeholder = "Caducidad en horas, por defecto, 72h."
                                bloque.appendChild(campo)
                                const campoDescripcion = document.createElement("textarea")
                                campoDescripcion.classList.add("detallesReserva_campoDescripcion")
                                campoDescripcion.setAttribute("campo", "descripcion")
                                campoDescripcion.placeholder = "No es obligatorio, pero escriba una descripciÃ³n si quieres para definir aÃºn mÃ¡s a este enlace si lo necesitas."
                                //bloque.appendChild(campoDescripcion)
                                contenidoAdvertenciaInmersiva.appendChild(bloque)
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                                const botonConfirmar = document.createElement("div")
                                botonConfirmar.classList.add("detallesReservaCancelarBoton")
                                botonConfirmar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                botonConfirmar.innerText = "Confirmar y crear enlace"
                                botonConfirmar.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.crearEnlace.confirmar(instanciaUID)
                                })
                                bloqueBotones.appendChild(botonConfirmar)
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("detallesReservaCancelarBoton")
                                botonCancelar.innerText = "Cancelar la creaciÃ³n del enlace"
                                botonCancelar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                                bloqueBotones.appendChild(botonCancelar)
                                contenidoAdvertenciaInmersiva.appendChild(bloqueBotones)
                                const contenedorGlobal = document.createElement("div")
                                contenedorGlobal.classList.add("detallesReserva_enlaceDePago_contenedorGlobal")
                                contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                                advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                                document.body.appendChild(advertenciaInmersivaIU)
                            },
                            confirmar: async (instanciaUID) => {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const nombreEnlace = document.querySelector("[espacio=formularioCrearEnlaceDePago] [campo=nombreEnlace]")
                                const cantidad = document.querySelector("[espacio=formularioCrearEnlaceDePago] [campo=cantidad]")
                                const horasCaducidad = document.querySelector("[espacio=formularioCrearEnlaceDePago] [campo=horasCaducidad]")
                                const transaccion = {
                                    zona: "administracion/enlacesDePago/crearNuevoEnlace",
                                    reservaUID: reservaUID,
                                    nombreEnlace: nombreEnlace.value,
                                    cantidad: cantidad.value,
                                    horasCaducidad: horasCaducidad.value,
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                if (respuestaServidor?.error) {
                                    casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const seleccionarInstancia = document.querySelector(`[componente=categoriaEnlacesDePago][instanciaUID="${instanciaUID}"] [componente=contenedorListaEnlacesDePago]`)
                                    if (seleccionarInstancia) {
                                        const metadatos = {
                                            enlaceUID: respuestaServidor.enlaceUID,
                                            nombreEnlace: respuestaServidor.nombreEnlace,
                                            enlace: respuestaServidor.enlace,
                                            cantidad: respuestaServidor.cantidad,
                                            estadoPago: "noPagado"
                                        }
                                        const enlaceUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.enlacesDePago.enlaceUI(metadatos)
                                        const primerElemento = seleccionarInstancia.firstChild;
                                        seleccionarInstancia.insertBefore(enlaceUI, primerElemento);
                                    }
                                }
                            }
                        },
                    },
                    servicios: {
                        arranque: async (e) => {
                            casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias()
                            document.querySelector(`[categoriaReserva=servicios]`).setAttribute("estadoCategoria", "actual")
                            const botonEnlacesDePago = document.querySelector("[categoriaReserva=servicios]")
                            botonEnlacesDePago.style.background = "blue"
                            botonEnlacesDePago.style.color = "white"
                            const contenedorDinamico = document.querySelector("[componente=contenedorDinamico]")
                            contenedorDinamico.innerHTML = null
                            const instanciaUID_contenedorServicios = casaVitini.utilidades.codigoFechaInstancia()
                            const contenedor = document.createElement("div")
                            const spinnerPorRenderizar = casaVitini.ui.componentes.spinnerSimple()
                            contenedor.setAttribute("class", "administracion_reservas_detallesReserva_servicios_contenedor")
                            contenedor.setAttribute("instanciaUID", instanciaUID_contenedorServicios)
                            contenedor.setAttribute("componente", "categoriaServicios")
                            contenedor.appendChild(spinnerPorRenderizar)
                            contenedorDinamico.appendChild(contenedor)

                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const transaccion = {
                                zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                                reservaUID: String(reservaUID),
                                capas: [
                                    "servicios"
                                ]
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaDestino = document.querySelector(`[componente=categoriaServicios][instanciaUID="${instanciaUID_contenedorServicios}"]`)
                            if (!instanciaDestino) { return }
                            instanciaDestino.innerHTML = null
                            if (respuestaServidor?.error) {
                                const errorUI = document.createElement("p")
                                errorUI.classList.add("errorCategorialGlobal")
                                errorUI.innerText = respuestaServidor?.error
                                instanciaDestino.appendChild(errorUI)
                            }
                            if (respuestaServidor?.ok) {
                                const contenedorInformacionGlobal = document.createElement("div")
                                contenedorInformacionGlobal.classList.add("administracion_reservas_detallesReserva_contenedorEnlacesDePago")

                                contenedor.appendChild(contenedorInformacionGlobal)
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReserva_enlacesDePago_bloqueBotones")

                                const botonCrearPagoManual = document.createElement("div")
                                botonCrearPagoManual.classList.add("detallesReserva_transacciones_botonV1")
                                botonCrearPagoManual.innerText = "Insertar un servicio"
                                botonCrearPagoManual.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.servicios.componentesUI.insertarServicio.ui({
                                        instanciaUID_contenedorServicios: instanciaUID_contenedorServicios
                                    })
                                })
                                bloqueBotones.appendChild(botonCrearPagoManual)
                                contenedorInformacionGlobal.appendChild(bloqueBotones)

                                const contenedorListaServicios = document.createElement("div")
                                contenedorListaServicios.classList.add("administracion_reservas_detallesReserva_contenedorListaEnlacesDePago")
                                contenedorListaServicios.setAttribute("componente", "contenedorListaServiciosEnReserva")
                                contenedor.appendChild(contenedorListaServicios)

                                instanciaDestino.style.justifyContent = "flex-start";
                                const serviciosEnReserva = respuestaServidor.ok.servicios
                                if (serviciosEnReserva.length === 0) {
                                    const infoSinEnlaces = casaVitini
                                        .administracion
                                        .reservas
                                        .detallesReserva
                                        .categoriasGlobales
                                        .servicios
                                        .componentesUI
                                        .infoSinServiciosUI()
                                    contenedorDinamico.appendChild(infoSinEnlaces)
                                }
                                if (serviciosEnReserva.length > 0) {
                                    const contenedorListaServicios = instanciaDestino.querySelector(`[componente=contenedorListaServiciosEnReserva]`)
                                    for (const servicioEnReserva of serviciosEnReserva) {
                                        const servicioUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.servicios.componentesUI.servicioUI({
                                            servicioUID_enReserva: servicioEnReserva.servicioUID,
                                            instanciaUID_contenedorServicios,
                                            nombreInterno: servicioEnReserva.nombre,
                                            contenedor: servicioEnReserva.contenedor
                                        })
                                        contenedorListaServicios.appendChild(servicioUI)
                                    }
                                }

                            }
                        },
                        componentesUI: {
                            insertarServicio: {
                                ui: async function (data) {
                                    const main = document.querySelector("main")
                                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    const reservaUID = main.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const instanciaUID_insertarServiciosUI = ui.getAttribute("instanciaUID")
                                    const instanciaUID_contenedorServicios = data.instanciaUID_contenedorServicios
                                    main.appendChild(ui)
                                    const constructor = ui.querySelector("[componente=contenedor]")
                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Obteniendo servicios...",
                                        textoBoton: "Cancelar"
                                    })
                                    constructor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/servicios/obtenerServicios"
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const uiRenderizada = document.querySelectorAll(`[instanciaUID="${instanciaUID_insertarServiciosUI}"]`)
                                    if (!uiRenderizada) { return }
                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        spinner.remove()
                                        constructor.appendChild(this.botonCancelar())

                                        const servicios = respuestaServidor.servicios

                                        const contenedor = document.createElement("div")
                                        contenedor.classList.add(
                                            "maxWidth1280px",
                                            "width100",
                                            "flexVertical",
                                            "gap10",
                                        )
                                        constructor.appendChild(contenedor)
                                        const estadoUI_ = (estadoIDV) => {

                                            if (estadoIDV === "activado") {
                                                return "Activada"
                                            } else if (estadoIDV === "desactivado") {
                                                return "Desactivada"
                                            }

                                        }

                                        servicios.forEach((detalles) => {
                                            const nombre = detalles.nombre
                                            const servicioUID = detalles.servicioUID
                                            const estadoIDV = detalles.estadoIDV
                                            const zonaIDV = detalles.zonaIDV
                                            const contenedorData = detalles.contenedor


                                            const contenedorServicio = document.createElement("div")
                                            contenedorServicio.setAttribute("servicioUID", servicioUID)
                                            contenedorServicio.classList.add(
                                                "borderRadius12",
                                                "width100",
                                                "flexVertical",
                                                "backgroundGrey1",
                                                "padding6",
                                                "gap6"
                                            )

                                            const contenedorGlobal = document.createElement("div")
                                            contenedorGlobal.classList.add(
                                                "flexVertical",
                                                "padding6",
                                                "gap6"
                                            )

                                            const nombreOfertaUI = document.createElement("div")
                                            nombreOfertaUI.classList.add("negrita")
                                            nombreOfertaUI.innerText = nombre
                                            contenedorGlobal.appendChild(nombreOfertaUI)

                                            const estadoTitulo = document.createElement("div")
                                            estadoTitulo.innerText = "Estado del servicio"
                                            contenedorGlobal.appendChild(estadoTitulo)


                                            const estadoUI = document.createElement("div")
                                            estadoUI.classList.add("negrita")
                                            estadoUI.innerText = estadoUI_(estadoIDV)
                                            contenedorGlobal.appendChild(estadoUI)
                                            contenedorServicio.appendChild(contenedorGlobal)

                                            const contendorBotones = document.createElement("div")
                                            contendorBotones.classList.add(
                                                "flexHorizontal",
                                                "gap6",
                                            )

                                            const botonInsertar = document.createElement("div")
                                            botonInsertar.classList.add(
                                                "borderRadius8",
                                                "backgroundGrey1",
                                                "comportamientoBoton",
                                                "padding8"
                                            )
                                            botonInsertar.innerText = "Insertar servicios en la reserva"
                                            botonInsertar.addEventListener("click", () => {
                                                this.confirmarInsertar({
                                                    reservaUID,
                                                    servicioUID,
                                                    instanciaUID_insertarServiciosUI,
                                                    instanciaUID_contenedorServicios
                                                })

                                            })
                                            contendorBotones.appendChild(botonInsertar)

                                            const botonVerOferta = document.createElement("a")
                                            botonVerOferta.classList.add(
                                                "borderRadius8",
                                                "backgroundGrey1",
                                                "comportamientoBoton",
                                                "padding8",
                                                "limpiezaBotonA"
                                            )
                                            botonVerOferta.innerText = "Ir al servicio"
                                            botonVerOferta.setAttribute("href", "/administracion/servicios/servicio:" + servicioUID)
                                            botonVerOferta.setAttribute("vista", "/administracion/servicios/servicio:" + servicioUID)
                                            botonVerOferta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                            contendorBotones.appendChild(botonVerOferta)

                                            contenedorServicio.appendChild(contendorBotones)
                                            contenedor.appendChild(contenedorServicio)
                                        })
                                        constructor.appendChild(this.botonCancelar())

                                    }

                                },
                                botonCancelar: () => {
                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("boton")
                                    botonCancelar.setAttribute("boton", "cancelar")
                                    botonCancelar.innerText = "Cerrar y volver a la reserva"
                                    botonCancelar.addEventListener("click", () => {
                                        return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    })
                                    return botonCancelar
                                },
                                confirmarInsertar: async function (data) {
                                    const reservaUID = data.reservaUID
                                    const servicioUID = String(data.servicioUID)
                                    const instanciaUID_insertarServiciosUI = data.instanciaUID_insertarServiciosUI
                                    const instanciaUID_contenedorServicios = data.instanciaUID_contenedorServicios

                                    const ui = document.querySelector(`[instanciaUID="${instanciaUID_insertarServiciosUI}"]`)
                                    const contenedor = ui.querySelector("[componente=contenedor]")
                                    contenedor.innerHTML = null

                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Insertando servicio en la reserva..."
                                    })
                                    contenedor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/servicios/insertarServicioEnReserva",
                                        reservaUID,
                                        servicioUID
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const uiRenderizada = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                    if (!uiRenderizada) { return }
                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        const servicioData = respuestaServidor.servicio
                                        const servicioUID_enReserva = servicioData.servicioUID
                                        const nombreInterno = servicioData.nombre
                                        const contenedor = servicioData.contenedor

                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.actualizarReservaRenderizada()

                                        const selectorContenedorServicios = uiRenderizada.querySelector(`[instanciaUID="${instanciaUID_contenedorServicios}"]`)
                                        if (!selectorContenedorServicios) {
                                            return
                                        }
                                        const servicioUI = casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.servicios.componentesUI.servicioUI({
                                            servicioUID_enReserva: servicioUID_enReserva,
                                            instanciaUID_contenedorServicios: instanciaUID_contenedorServicios,
                                            nombreInterno: nombreInterno,
                                            contenedor: contenedor
                                        })
                                        const selectorInfo = uiRenderizada.querySelector("[componente=contenedorInfoSinServicios]")
                                        selectorInfo?.remove()

                                        const selectorListaServicios = uiRenderizada.querySelector("[componente=contenedorListaServiciosEnReserva]")
                                        selectorListaServicios.appendChild(servicioUI)

                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    }

                                },
                            },
                            servicioUI: (data) => {
                                const servicioUID_enReserva = data.servicioUID_enReserva
                                const instanciaUID_contenedorServicios = data.instanciaUID_contenedorServicios
                                const nombreInterno = data.nombreInterno
                                const contenedor = data.contenedor

                                const precio = contenedor.precio
                                const definicion = contenedor.definicion
                                const fechaFinal = contenedor.fechaFinal
                                const duracionIDV = contenedor.duracionIDV
                                const fechaInicio = contenedor.fechaInicio
                                const tituloPublico = contenedor.tituloPublico
                                const disponibilidadIDV = contenedor.disponibilidadIDV

                                const diccionario = {
                                    disponibilidad: {
                                        constante: "Disponible",
                                        variable: "Disponibilidad variable"
                                    }
                                }

                                const servicioUI = document.createElement("div")
                                servicioUI.setAttribute("servicioUID_enReserva", servicioUID_enReserva)
                                servicioUI.classList.add(
                                    "flexVertical",
                                    "padding14",
                                    "backgroundGrey1",
                                    "borderRadius14"
                                )
                                const contenedorInterno = document.createElement("div")
                                contenedorInterno.classList.add(
                                    "flexVertical",
                                    "gap6"
                                )
                                servicioUI.appendChild(contenedorInterno)

                                const nombreInternoUI = document.createElement("p")
                                nombreInternoUI.innerText = `${nombreInterno}`
                                contenedorInterno.appendChild(nombreInternoUI)

                                const contenedorGlobal = document.createElement("div")
                                contenedorGlobal.classList.add(
                                    "contenedorGlobal"
                                )
                                servicioUI.appendChild(contenedorGlobal)

                                const esferaSeleccionable = document.createElement("div")
                                esferaSeleccionable.classList.add(
                                    "esferaSeleccionable"
                                )
                                contenedorGlobal.appendChild(esferaSeleccionable)

                                const indicadorDeSeleccion = document.createElement("div")
                                indicadorDeSeleccion.setAttribute("componente", "indicadorSelecion")
                                indicadorDeSeleccion.classList.add(
                                    "indicadorDeSeleccion"
                                )
                                esferaSeleccionable.appendChild(indicadorDeSeleccion)

                                const titulo = document.createElement("p")
                                titulo.classList.add(
                                    "padding6",
                                    "negrita"
                                )
                                titulo.innerText = tituloPublico
                                contenedorGlobal.appendChild(titulo)


                                const disponibilidadUI = document.createElement("p")
                                disponibilidadUI.classList.add(
                                    "padding6"
                                )
                                disponibilidadUI.innerText = diccionario.disponibilidad[disponibilidadIDV]
                                servicioUI.appendChild(disponibilidadUI)


                                if (disponibilidadIDV === "variable") {

                                    const info = document.createElement("p")
                                    info.classList.add(
                                        "padding6"
                                    )
                                    info.innerText = `Este servicio tiene una disponibilidad limitada. Es por eso que si selecciona este servicio, nos pondremos en contacto con el titular de la reserva en las prÃ³ximas horas para confirmarle la disponibilidad del servicio para su reserva.`
                                    servicioUI.appendChild(info)
                                }

                                const precioUI = document.createElement("p")
                                precioUI.classList.add(
                                    "padding6",
                                    "negrita"
                                )
                                precioUI.innerText = precio + "$"
                                servicioUI.appendChild(precioUI)

                                if (duracionIDV === "rango") {
                                    const contenedorDuracion = document.createElement("div")
                                    contenedorDuracion.classList.add(
                                        "flexVertical",
                                        "padding6"

                                    )
                                    servicioUI.appendChild(contenedorDuracion)

                                    const info = document.createElement("p")
                                    info.classList.add("negrita")
                                    info.innerText = `Servicio disponible solo desde ${fechaInicio} hata ${fechaFinal}. Ambas fechas incluidas.`
                                    contenedorDuracion.appendChild(info)

                                }
                                const definicionUI = document.createElement("p")
                                definicionUI.classList.add(
                                    "padding6"
                                )
                                definicionUI.innerText = definicion
                                servicioUI.appendChild(definicionUI)

                                const contenedorBotones = document.createElement("div")
                                contenedorBotones.classList.add("administracion_reservas_detallesReservas_enlacesDePago_contenedorBotones")
                                const botonIr = document.createElement("a")
                                botonIr.classList.add("administracion_reservas_detallesReservas_enlacesDePago_botonV1")
                                botonIr.innerText = "Ir al servicio"
                                // botonIr.setAttribute("href", "/servicios/servicio:" + servicioUID)
                                botonIr.setAttribute("target", "_blank")
                                //contenedorBotones.appendChild(botonIr)

                                const botonEliminar = document.createElement("div")
                                botonEliminar.classList.add("administracion_reservas_detallesReservas_enlacesDePago_botonV1")
                                botonEliminar.innerText = "Eliminar servicio de la reserva"
                                botonEliminar.addEventListener("click", () => {
                                    casaVitini
                                        .administracion
                                        .reservas
                                        .detallesReserva
                                        .categoriasGlobales
                                        .servicios
                                        .componentesUI.
                                        eliminarServicio
                                        .ui({
                                            instanciaUID_contenedorServicios,
                                            servicioUID_enReserva,
                                            nombreInterno
                                        })
                                })
                                contenedorBotones.appendChild(botonEliminar)
                                servicioUI.appendChild(contenedorBotones)



                                return servicioUI
                            },
                            eliminarServicio: {
                                ui: async function (data) {
                                    const nombreInterno = data.nombreInterno
                                    const instanciaUID_contenedorServicios = data.instanciaUID_contenedorServicios
                                    const servicioUID_enReserva = data.servicioUID_enReserva

                                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                    const instanciaUID_eliminarServicio = ui.getAttribute("instanciaUID")
                                    const constructor = ui.querySelector("[componente=constructor]")

                                    const titulo = constructor.querySelector("[componente=titulo]")
                                    titulo.innerText = `Confirmar eliminar el servicio ${nombreInterno} de la reserva`
                                    const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                    mensaje.innerText = "Var a eliminar el servicio de la reserva, Â¿Estas de acuerdo?"

                                    const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                    botonAceptar.innerText = "Comfirmar la eliminacion"
                                    botonAceptar.addEventListener("click", () => {
                                        this.confirmarEliminar({
                                            servicioUID_enReserva,
                                            instanciaUID_eliminarServicio,
                                            instanciaUID_contenedorServicios
                                        })
                                    })
                                    const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                    botonCancelar.innerText = "Cancelar y volver"
                                    document.querySelector("main").appendChild(ui)

                                },
                                confirmarEliminar: async function (data) {
                                    const servicioUID_enReserva = String(data.servicioUID_enReserva)
                                    const instanciaUID_eliminarServicio = data.instanciaUID_eliminarServicio
                                    const instanciaUID_contenedorServicios = data.instanciaUID_contenedorServicios

                                    const ui = document.querySelector(`[instanciaUID="${instanciaUID_eliminarServicio}"]`)
                                    const contenedor = ui.querySelector("[componente=constructor]")
                                    contenedor.innerHTML = null

                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Eliminado servicio en la reserva..."
                                    })
                                    contenedor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/servicios/eliminarServicioEnReserva",
                                        servicioUID_enReserva
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.administracion.reservas.detallesReserva.reservaUI.actualizarReservaRenderizada()
                                        const selectorContenedorServicios = document.querySelector(`[instanciaUID="${instanciaUID_contenedorServicios}"]`)
                                        if (!selectorContenedorServicios) {
                                            return
                                        }
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        selectorContenedorServicios.querySelector(`[servicioUID_enReserva="${servicioUID_enReserva}"]`)?.remove()

                                        const selectorContenedoresDeServiciosRenderizados = selectorContenedorServicios.querySelectorAll("[servicioUID_enReserva]")
                                        if (selectorContenedoresDeServiciosRenderizados.length === 0) {
                                            const infoSinEnlaces = casaVitini
                                                .administracion
                                                .reservas
                                                .detallesReserva
                                                .categoriasGlobales
                                                .servicios
                                                .componentesUI
                                                .infoSinServiciosUI()

                                            const selectorContenedorDinamico = document.querySelector("[componente=contenedorDinamico]")
                                            selectorContenedorDinamico.appendChild(infoSinEnlaces)
                                        }






                                    }

                                },

                            },
                            infoSinServiciosUI: () => {
                                const infoSinEnlaces = document.createElement("div")
                                infoSinEnlaces.classList.add("reservaDetalles_transacciones_enlacesDePago_infoSinEnlaces")
                                infoSinEnlaces.setAttribute("componente", "contenedorInfoSinServicios")
                                infoSinEnlaces.innerText = "No hay ningÃºn servicio en la reserva."
                                return infoSinEnlaces
                            }
                        },

                    },
                    desgloseTotal: {
                        arranque: async function () {
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias()
                            document.querySelector(`[categoriaReserva=desgloseTotal]`).setAttribute("estadoCategoria", "actual")
                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const botonCategoria = document.querySelector("[categoriaReserva=desgloseTotal]")
                            botonCategoria.style.background = "blue"
                            botonCategoria.style.color = "white"
                            botonCategoria.setAttribute("categoria", "desgloseTotal")
                            const contenedorDinamico = document.querySelector("[componente=contenedorDinamico]")
                            contenedorDinamico.innerHTML = null
                            const spinnerPorRenderizar = casaVitini.ui.componentes.spinnerSimple()
                            const contenedorDesgloseDelTotal = document.createElement("div")
                            contenedorDesgloseDelTotal.classList.add("administracion_reserver_detallesReserva_contenedorDesgloseTotal")
                            contenedorDesgloseDelTotal.setAttribute("instanciaUID", instanciaUID)
                            contenedorDesgloseDelTotal.setAttribute("componente", "contenedorDesgloseTotal")
                            contenedorDesgloseDelTotal.appendChild(spinnerPorRenderizar)
                            contenedorDinamico.appendChild(contenedorDesgloseDelTotal)
                            const transaccion = {
                                zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                                reservaUID: reservaUID,
                                capas: [
                                    "desgloseFinanciero",
                                ]
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                            const instanciaDestino = document.querySelector(`[componente=contenedorDesgloseTotal][instanciaUID="${instanciaUID}"]`)
                            if (!instanciaDestino) { }
                            instanciaDestino.innerHTML = null

                            if (respuestaServidor?.error) {
                                const errorUI = document.createElement("p")
                                errorUI.classList.add("errorCategorialGlobal")
                                errorUI.innerText = respuestaServidor?.error
                                instanciaDestino.appendChild(errorUI)
                            }

                            if (respuestaServidor?.ok) {

                                const panelBotones = document.createElement("nav")
                                panelBotones.classList.add(
                                    "borderRadius10",
                                    "flexHorizontal",
                                    "gap6",
                                    "paddinHorizontal6",
                                    "paddinTop6",
                                    "elementosExpandidos",

                                )
                                //instanciaDestino.appendChild(panelBotones)

                                const botonInsertarDescuento = document.createElement("div")
                                botonInsertarDescuento.classList.add(
                                    "comportamientoBoton",
                                    "botonV1",
                                    "width100"
                                )
                                botonInsertarDescuento.innerText = "Insertar descuento"
                                botonInsertarDescuento.addEventListener("click", () => {
                                    this.componentesUI.insertarDescuentos.ui({
                                        instanciaUID_contenedorFinanciero: instanciaUID
                                    })
                                })
                                panelBotones.appendChild(botonInsertarDescuento)

                                const botonDescuentosCompatibles = document.createElement("div")
                                botonDescuentosCompatibles.classList.add(
                                    "comportamientoBoton",
                                    "botonV1",
                                    "width100"
                                )
                                botonDescuentosCompatibles.innerText = "Descuentos compatibles"
                                panelBotones.appendChild(botonDescuentosCompatibles)

                                const botonSobreControlDePrecios = document.createElement("div")
                                botonSobreControlDePrecios.classList.add(
                                    "comportamientoBoton",
                                    "botonV1",
                                    "width100"
                                )
                                botonSobreControlDePrecios.innerText = "Sobre control de precios"
                                botonSobreControlDePrecios.addEventListener("click", () => {
                                    this.componentesUI.sobreControlPrecios.arranque()
                                })
                                panelBotones.appendChild(botonSobreControlDePrecios)

                                const botonReconstruirTotal = document.createElement("div")
                                botonReconstruirTotal.classList.add(
                                    "comportamientoBoton",
                                    "botonV1",
                                    "width100"
                                )
                                botonReconstruirTotal.innerText = "Reconstruir total"
                                panelBotones.appendChild(botonReconstruirTotal)

                                const contenedorFinanciero = respuestaServidor.ok.contenedorFinanciero
                                casaVitini.ui.componentes.contenedorFinanciero.constructor({
                                    destino: `[instanciaUID="${instanciaUID}"][componente=contenedorDesgloseTotal]`,
                                    contenedorFinanciero,
                                    modoUI: "administracion"

                                })



                            }
                        },

                        componentesUI: {
                            insertarDescuentos: {
                                ui: async function (data) {
                                    const main = document.querySelector("main")
                                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    const reservaUID = main.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const instanciaUID_insertarDescuentosUI = ui.getAttribute("instanciaUID")
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                    main.appendChild(ui)
                                    const constructor = ui.querySelector("[componente=contenedor]")
                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Obteniendo ofertas...",
                                        textoBoton: "Cancelar"
                                    })
                                    constructor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/ofertas/listasOfertasAdministracion"
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const uiRenderizada = document.querySelectorAll(`[instanciaUID="${instanciaUID_insertarDescuentosUI}"]`)
                                    if (!uiRenderizada) { return }
                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        spinner.remove()
                                        constructor.appendChild(this.botonCancelar())

                                        const ofertas = respuestaServidor.ok

                                        const contenedorOfertas = document.createElement("div")
                                        contenedorOfertas.classList.add(
                                            "maxWidth1280px",
                                            "width100",
                                            "flexVertical",
                                            "gap10",
                                        )
                                        constructor.appendChild(contenedorOfertas)
                                        const estadoUI_ = (estadoIDV) => {

                                            if (estadoIDV === "activado") {
                                                return "Activada"
                                            } else if (estadoIDV === "desactivado") {
                                                return "Desactivada"
                                            }

                                        }

                                        ofertas.forEach((detalles) => {
                                            const nombreOferta = detalles.nombreOferta
                                            const ofertaUID = detalles.ofertaUID
                                            const fechaInicio = detalles.fechaInicio
                                            const fechaFinal = detalles.fechaFinal
                                            const estadoIDV = detalles.estadoIDV
                                            const zonaIDV = detalles.zonaIDV


                                            const contenedorOferta = document.createElement("div")
                                            contenedorOferta.setAttribute("ofertaUID", ofertaUID)
                                            contenedorOferta.classList.add(
                                                "borderRadius12",
                                                "width100",
                                                "flexVertical",
                                                "backgroundGrey1",
                                                "padding6",
                                                "gap6"
                                            )

                                            const contenedorGlobal = document.createElement("div")
                                            contenedorGlobal.classList.add(
                                                "flexVertical",
                                                "padding6",
                                                "gap6"
                                            )

                                            const nombreOfertaUI = document.createElement("div")
                                            nombreOfertaUI.classList.add("negrita")
                                            nombreOfertaUI.innerText = nombreOferta
                                            contenedorGlobal.appendChild(nombreOfertaUI)

                                            const estadoTitulo = document.createElement("div")
                                            estadoTitulo.innerText = "Estado de la oferta"
                                            contenedorGlobal.appendChild(estadoTitulo)


                                            const estadoUI = document.createElement("div")
                                            estadoUI.classList.add("negrita")
                                            estadoUI.innerText = estadoUI_(estadoIDV)
                                            contenedorGlobal.appendChild(estadoUI)
                                            contenedorOferta.appendChild(contenedorGlobal)

                                            const contendorBotones = document.createElement("div")
                                            contendorBotones.classList.add(
                                                "flexHorizontal",
                                                "gap6",
                                            )

                                            const botonInsertar = document.createElement("div")
                                            botonInsertar.classList.add(
                                                "borderRadius8",
                                                "backgroundGrey1",
                                                "comportamientoBoton",
                                                "padding8"
                                            )
                                            botonInsertar.innerText = "Insertar descuento en la reserva"
                                            botonInsertar.addEventListener("click", () => {
                                                this.confirmarInsertar({
                                                    reservaUID,
                                                    ofertaUID,
                                                    instanciaUID_insertarDescuentosUI,
                                                    instanciaUID_contenedorFinanciero
                                                })

                                            })
                                            contendorBotones.appendChild(botonInsertar)

                                            const botonVerOferta = document.createElement("a")
                                            botonVerOferta.classList.add(
                                                "borderRadius8",
                                                "backgroundGrey1",
                                                "comportamientoBoton",
                                                "padding8",
                                                "limpiezaBotonA"
                                            )
                                            botonVerOferta.innerText = "Ir a la oferta"
                                            botonVerOferta.setAttribute("href", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                            botonVerOferta.setAttribute("vista", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                            botonVerOferta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                            contendorBotones.appendChild(botonVerOferta)


                                            contenedorOferta.appendChild(contendorBotones)

                                            contenedorOfertas.appendChild(contenedorOferta)
                                        })
                                        constructor.appendChild(this.botonCancelar())

                                    }

                                },
                                botonCancelar: () => {
                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("boton")
                                    botonCancelar.setAttribute("boton", "cancelar")
                                    botonCancelar.innerText = "Cerrar y volver a la reserva"
                                    botonCancelar.addEventListener("click", () => {
                                        return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    })
                                    return botonCancelar
                                },
                                confirmarInsertar: async function (data) {
                                    const reservaUID = data.reservaUID
                                    const ofertaUID = String(data.ofertaUID)
                                    const instanciaUID_insertarDescuentosUI = data.instanciaUID_insertarDescuentosUI
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero



                                    const ui = document.querySelector(`[instanciaUID="${instanciaUID_insertarDescuentosUI}"]`)
                                    const contenedor = ui.querySelector("[componente=contenedor]")
                                    contenedor.innerHTML = null

                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Insertando oferta en la reserva..."
                                    })
                                    contenedor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/descuentos/insertarDescuentoPorAdministrador",
                                        reservaUID,
                                        ofertaUID
                                    }


                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const uiRenderizada = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                    if (!uiRenderizada) { return }

                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {

                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                            instanciaUID_contenedorFinanciero,
                                            reservaUID
                                        })
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    }

                                },

                            },
                            insertarOfertasCompatibles: {
                                ui: async function (data) {
                                    const main = document.querySelector("main")
                                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    const reservaUID = main.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const instanciaUID_insertarDescuentosUI = ui.getAttribute("instanciaUID")
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                    main.appendChild(ui)
                                    const constructor = ui.querySelector("[componente=contenedor]")
                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Obteniendo ofertas compatibles con la oferta...",
                                        textoBoton: "Cancelar"
                                    })
                                    constructor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/descuentos/obtenerDescuentosCompatiblesConLaReserva",
                                        reservaUID
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const uiRenderizada = document.querySelectorAll(`[instanciaUID="${instanciaUID_insertarDescuentosUI}"]`)
                                    if (!uiRenderizada) { return }
                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {


                                        const ofertas = respuestaServidor.ofertasCompatibles
                                        const contenedorOfertas = document.createElement("div")
                                        contenedorOfertas.classList.add(
                                            "maxWidth1280px",
                                            "width100",
                                            "flexVertical",
                                            "gap10",
                                        )
                                        constructor.appendChild(contenedorOfertas)

                                        spinner.remove()
                                        if (ofertas.length > 0) {
                                            constructor.appendChild(this.botonCancelar())

                                        } else {
                                            const info = document.createElement("p")
                                            info.classList.add(
                                                "textoCentrado"
                                            )
                                            info.innerText = "No hay ofertas compatibles con esta reserva. Si quieres insertar ofertas no compatibles de manera arbitraria, a esta reserva usa el botÃ³n de insertar descuentos."
                                            constructor.appendChild(info)

                                        }

                                        const estadoUI_ = (estadoIDV) => {

                                            if (estadoIDV === "activado") {
                                                return "Activada"
                                            } else if (estadoIDV === "desactivado") {
                                                return "Desactivada"
                                            }
                                        }

                                        ofertas.forEach((contenedorOferta) => {
                                            const detalles = contenedorOferta.oferta
                                            const nombreOferta = detalles.nombreOferta
                                            const ofertaUID = detalles.ofertaUID
                                            const fechaInicio = detalles.fechaInicio
                                            const fechaFinal = detalles.fechaFinal
                                            const estadoIDV = detalles.estadoIDV
                                            const zonaIDV = detalles.zonaIDV

                                            const contenedorOfertaUI = document.createElement("div")
                                            contenedorOfertaUI.setAttribute("ofertaUID", ofertaUID)
                                            contenedorOfertaUI.classList.add(
                                                "borderRadius12",
                                                "width100",
                                                "flexVertical",
                                                "backgroundGrey1",
                                                "padding6",
                                                "gap6"
                                            )

                                            const contenedorGlobal = document.createElement("div")
                                            contenedorGlobal.classList.add(
                                                "flexVertical",
                                                "padding6",
                                                "gap6"
                                            )

                                            const nombreOfertaUI = document.createElement("div")
                                            nombreOfertaUI.classList.add("negrita")
                                            nombreOfertaUI.innerText = nombreOferta
                                            contenedorGlobal.appendChild(nombreOfertaUI)

                                            const estadoTitulo = document.createElement("div")
                                            estadoTitulo.innerText = "Estado de la oferta"
                                            contenedorGlobal.appendChild(estadoTitulo)

                                            const estadoUI = document.createElement("div")
                                            estadoUI.classList.add("negrita")
                                            estadoUI.innerText = estadoUI_(estadoIDV)
                                            contenedorGlobal.appendChild(estadoUI)
                                            contenedorOfertaUI.appendChild(contenedorGlobal)

                                            const contendorBotones = document.createElement("div")
                                            contendorBotones.classList.add(
                                                "flexHorizontal",
                                                "gap6",
                                            )

                                            const botonInsertar = document.createElement("div")
                                            botonInsertar.classList.add(
                                                "borderRadius8",
                                                "backgroundGrey1",
                                                "comportamientoBoton",
                                                "padding8"
                                            )

                                            botonInsertar.innerText = "Insertar descuento en la reserva"
                                            botonInsertar.addEventListener("click", () => {
                                                this.confirmarInsertarCompatible({
                                                    reservaUID,
                                                    ofertaUID,
                                                    instanciaUID_insertarDescuentosUI,
                                                    instanciaUID_contenedorFinanciero
                                                })
                                            })
                                            contendorBotones.appendChild(botonInsertar)

                                            const botonVerOferta = document.createElement("a")
                                            botonVerOferta.classList.add(
                                                "borderRadius8",
                                                "backgroundGrey1",
                                                "comportamientoBoton",
                                                "padding8",
                                                "limpiezaBotonA"
                                            )
                                            botonVerOferta.innerText = "Ir a la oferta"
                                            botonVerOferta.setAttribute("href", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                            botonVerOferta.setAttribute("vista", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                            botonVerOferta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                            contendorBotones.appendChild(botonVerOferta)

                                            contenedorOfertaUI.appendChild(contendorBotones)

                                            contenedorOfertas.appendChild(contenedorOfertaUI)
                                        })
                                        constructor.appendChild(this.botonCancelar())

                                    }

                                },
                                botonCancelar: () => {
                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("boton")
                                    botonCancelar.setAttribute("boton", "cancelar")
                                    botonCancelar.innerText = "Cerrar y volver a la reserva"
                                    botonCancelar.addEventListener("click", () => {
                                        return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    })
                                    return botonCancelar
                                },
                                confirmarInsertarCompatible: async function (data) {
                                    const reservaUID = data.reservaUID
                                    const ofertaUID = String(data.ofertaUID)
                                    const instanciaUID_insertarDescuentosUI = data.instanciaUID_insertarDescuentosUI
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero



                                    const ui = document.querySelector(`[instanciaUID="${instanciaUID_insertarDescuentosUI}"]`)
                                    const contenedor = ui.querySelector("[componente=contenedor]")
                                    contenedor.innerHTML = null

                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Insertando oferta en la reserva..."
                                    })
                                    contenedor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/descuentos/insertarDescuentoPorCompatible",
                                        reservaUID,
                                        ofertaUID
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const uiRenderizada = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                    if (!uiRenderizada) { return }

                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                            instanciaUID_contenedorFinanciero,
                                            reservaUID
                                        })
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    }

                                },

                            },
                            sobreControlPrecios: {
                                componentesUI: {
                                    botonAlterarPrecio: () => {
                                        const botonDeslegarOpciones = document.createElement("div")
                                        botonDeslegarOpciones.classList.add(
                                            "padding6",
                                            "botonV1",
                                            "comportamientoBoton"
                                        )
                                        botonDeslegarOpciones.innerText = "Alterar precio"
                                        return botonDeslegarOpciones
                                    },
                                    nocheUI: async function (data) {
                                        const fechaNoche = data.fechaNoche
                                        const apartamentoIDV = data.apartamentoIDV
                                        const main = document.querySelector("main")
                                        const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                        const reservaUID = main.querySelector("[reservaUID]").getAttribute("reservaUID")
                                        const instanciaUID_sobreControlUI = ui.getAttribute("instanciaUID")
                                        const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                        main.appendChild(ui)
                                        const contenedor = ui.querySelector("[componente=contenedor]")
                                        const spinner = casaVitini.ui.componentes.spinner({
                                            mensaje: "Obteniendo detalles de la noche...",
                                            textoBoton: "Cancelar"
                                        })
                                        contenedor.appendChild(spinner)

                                        const transaccion = {
                                            zona: "administracion/reservas/detallesReserva/sobreControlPrecios/obtenerDetallesSobreControlNoche",
                                            reservaUID,
                                            apartamentoIDV: apartamentoIDV,
                                            fechaNoche: fechaNoche
                                        }

                                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                        const uiRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)

                                        if (!uiRenderizada) { return }
                                        if (respuestaServidor?.error) {
                                            uiRenderizada?.remove()
                                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                            return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                        }
                                        if (respuestaServidor.ok) {
                                            contenedor.innerHTML = null

                                            const data = respuestaServidor.ok
                                            const instantanea = data.instantaneaNetoApartamento
                                            const apartamentoUI = instantanea.apartamentoUI
                                            const precioNetoApartamento = instantanea.precioNetoApartamento

                                            const sobreControl = data?.sobreControl
                                            const detallesSobreControl = sobreControl.detallesSobreControl || {}
                                            const operacion = detallesSobreControl?.operacion
                                            const valorSobreControl = detallesSobreControl?.valor || "0.00"

                                            const titulo = document.createElement("div")
                                            titulo.classList.add(
                                                "textSize16",
                                                "textoCentrado"
                                            )
                                            titulo.innerText = `Detalles del ${apartamentoUI} en la noche de ${fechaNoche}`
                                            contenedor.appendChild(titulo)

                                            const contenedorValorOrigen = document.createElement("div")
                                            contenedorValorOrigen.classList.add(
                                                "flexVertical",
                                                "backgroundGrey1",
                                                "padding12",
                                                "borderRadius8"
                                            )
                                            contenedor.appendChild(contenedorValorOrigen)

                                            const tituloValorOrigen = document.createElement("div")
                                            tituloValorOrigen.innerText = "Valor origen"
                                            contenedorValorOrigen.appendChild(tituloValorOrigen)

                                            const datoValorOrigen = document.createElement("div")
                                            datoValorOrigen.classList.add(
                                                "negrita"
                                            )
                                            datoValorOrigen.innerText = precioNetoApartamento
                                            contenedorValorOrigen.appendChild(datoValorOrigen)

                                            const selectorTipoSobreControl = document.createElement("select")
                                            selectorTipoSobreControl.classList.add(
                                                "selectorLista"
                                            )
                                            selectorTipoSobreControl.setAttribute("campo", "tipoOperacion")

                                            const tituloSelector = document.createElement("option");
                                            if (!operacion) {
                                                tituloSelector.selected = true;
                                            }
                                            tituloSelector.disabled = true;
                                            tituloSelector.text = "Seleccionar el tipo de sobre control";
                                            selectorTipoSobreControl.appendChild(tituloSelector);

                                            const opciones = [
                                                { value: "aumentarPorPorcentaje", text: "Aumentar por porcentaje" },
                                                { value: "reducirPorPorcentaje", text: "Reducir por porcentaje" },
                                                { value: "aumentarPorCantidadFija", text: "Aumentar por cantidad fija" },
                                                { value: "reducirPorCantidadFila", text: "Reducir por cantidad fila" },
                                                { value: "establecerCantidad", text: "Establecer cantidad" }
                                            ]
                                            for (const opcionData of opciones) {
                                                const value = opcionData.value
                                                const text = opcionData.text
                                                const opcion = document.createElement("option");
                                                opcion.value = opcionData.value;
                                                opcion.text = opcionData.text;
                                                if (operacion === value) {
                                                    opcion.selected = true;
                                                }
                                                selectorTipoSobreControl.appendChild(opcion);
                                            }
                                            contenedor.appendChild(selectorTipoSobreControl)
                                            const campoValor = document.createElement("input")
                                            campoValor.classList.add(
                                                "campoTexto"
                                            )
                                            campoValor.setAttribute("campo", "valor")
                                            campoValor.placeholder = "Escribe la cantidad con dos decimales separados por punto, por ejemplo 0.00"
                                            campoValor.value = valorSobreControl

                                            contenedor.appendChild(campoValor)


                                            if (Object.keys(detallesSobreControl).length > 0) {
                                                const boton = document.createElement("div")
                                                boton.classList.add("boton")
                                                boton.innerText = "Actualizar sobre control de precio"
                                                boton.addEventListener("click", () => {
                                                    this.confirmar({
                                                        instanciaUID_sobreControlUI,
                                                        instanciaUID_contenedorFinanciero,
                                                        reservaUID,
                                                        apartamentoIDV,
                                                        tipoOperacion: selectorTipoSobreControl.value,
                                                        fechaNoche,
                                                        valorSobreControl: campoValor.value
                                                    })
                                                })
                                                contenedor.appendChild(boton)
                                                const botonEliminar = document.createElement("div")
                                                botonEliminar.classList.add("boton")
                                                botonEliminar.innerText = "Eliminar sobre control de precio"
                                                botonEliminar.addEventListener("click", () => {
                                                    this.eliminarSobreControl({
                                                        instanciaUID_sobreControlUI,
                                                        instanciaUID_contenedorFinanciero,
                                                        reservaUID,
                                                        apartamentoIDV,
                                                        fechaNoche
                                                    })
                                                })
                                                contenedor.appendChild(botonEliminar)
                                            } else {
                                                const boton = document.createElement("div")
                                                boton.classList.add("boton")
                                                boton.innerText = "Crear sobre control de precio"
                                                boton.addEventListener("click", () => {
                                                    this.confirmar({
                                                        instanciaUID_sobreControlUI,
                                                        instanciaUID_contenedorFinanciero,
                                                        reservaUID,
                                                        apartamentoIDV,
                                                        tipoOperacion: selectorTipoSobreControl.value,
                                                        fechaNoche,
                                                        valorSobreControl: campoValor.value
                                                    })
                                                })
                                                contenedor.appendChild(boton)
                                            }

                                            const botonCancelar = document.createElement("div")
                                            botonCancelar.classList.add("boton")
                                            botonCancelar.innerText = "Cancelar y volver al desglose por noche."
                                            botonCancelar.addEventListener("click", () => {
                                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                            })
                                            contenedor.appendChild(botonCancelar)
                                        }
                                    },
                                    confirmar: async (data) => {
                                        const instanciaUID_sobreControlUI = data.instanciaUID_sobreControlUI
                                        const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                        const reservaUID = data.reservaUID
                                        const apartamentoIDV = data.apartamentoIDV
                                        const tipoOperacion = data.tipoOperacion
                                        const fechaNoche = data.fechaNoche
                                        const valorSobreControl = data.valorSobreControl
                                        const transaccion = {
                                            zona: "administracion/reservas/detallesReserva/sobreControlPrecios/actualizarSobreControlNoche",
                                            reservaUID,
                                            apartamentoIDV,
                                            fechaNoche,
                                            tipoOperacion,
                                            valorSobreControl
                                        }
                                        const uiRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)
                                        const contenedor = uiRenderizada.querySelector("[componente=contenedor]")
                                        //contenedor.innerHTML = null

                                        const instanciaPantallaCarga = casaVitini.utilidades.codigoFechaInstancia()
                                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta({
                                            mensaje: "Aplicando sobrecontrol de precio",
                                            textoBoton: "ocultar",
                                            instanciaUID: instanciaPantallaCarga
                                        })

                                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                        const instanciaPantallaCargaUI = document.querySelector(`[instanciaUID="${instanciaPantallaCarga}"]`)
                                        instanciaPantallaCargaUI?.remove()

                                        const uiContenedorFinanciero = document.querySelector(`[instanciaUID="${instanciaUID_contenedorFinanciero}"]`)
                                        //if (!uiContenedorFinanciero) { return }

                                        if (respuestaServidor?.error) {
                                            return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                        }
                                        if (respuestaServidor.ok) {
                                            const sobreControlUI = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)
                                            if (sobreControlUI) {
                                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                            }

                                            const selectorDesgloseEnPantalla = document.querySelector(`[reservaUID="${reservaUID}"] [componente=contenedorDesgloseTotal]`)
                                            if (!selectorDesgloseEnPantalla) {
                                                return
                                            }
                                            return casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                                instanciaUID_contenedorFinanciero,
                                                reservaUID
                                            })
                                        }
                                    },
                                    eliminarSobreControl: async (data) => {
                                        const instanciaUID_sobreControlUI = data.instanciaUID_sobreControlUI
                                        const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                        const reservaUID = data.reservaUID
                                        const apartamentoIDV = data.apartamentoIDV
                                        const fechaNoche = data.fechaNoche
                                        const transaccion = {
                                            zona: "administracion/reservas/detallesReserva/sobreControlPrecios/eliminarSobreControlNoche",
                                            reservaUID,
                                            apartamentoIDV,
                                            fechaNoche
                                        }
                                        const uiRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)
                                        const contenedor = uiRenderizada.querySelector("[componente=contenedor]")

                                        const instanciaPantallaCarga = casaVitini.utilidades.codigoFechaInstancia()
                                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta({
                                            mensaje: "Eliminado sobrecontrol de precio",
                                            textoBoton: "ocultar",
                                            instanciaUID: instanciaPantallaCarga
                                        })

                                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                        const instanciaPantallaCargaUI = document.querySelector(`[instanciaUID="${instanciaPantallaCarga}"]`)
                                        instanciaPantallaCargaUI?.remove()

                                        if (respuestaServidor?.error) {
                                            return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                        }
                                        if (respuestaServidor.ok) {
                                            const sobreControlUI = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)
                                            if (sobreControlUI) {
                                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                            }

                                            const selectorDesgloseEnPantalla = document.querySelector(`[reservaUID="${reservaUID}"] [componente=contenedorDesgloseTotal]`)
                                            if (!selectorDesgloseEnPantalla) {
                                                return
                                            }
                                            return casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                                instanciaUID_contenedorFinanciero,
                                                reservaUID
                                            })
                                        }
                                    }
                                },
                            },
                            eliminarOfertaEnReserva: {
                                ui: async function (data) {

                                    const nombreOferta = data.nombreOferta
                                    const ofertaUID = data.ofertaUID
                                    const posicion = data.posicion
                                    const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const origen = data.origen

                                    const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                    const instanciaUID = pantallaInmersiva.getAttribute("instanciaUID")
                                    const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                                    const titulo = constructor.querySelector("[componente=titulo]")
                                    titulo.classList.add(
                                        "negrita"
                                    )
                                    titulo.innerText = nombreOferta
                                    const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                    mensaje.innerText = `Confirmas o no la eliminaciÃ³n de la oferta de la reserva, Â¿EstÃ¡s de acuerdo?`

                                    const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                    botonAceptar.innerText = "Confirmar la eliminaciÃ³n de la oferta de esta reserva"
                                    botonAceptar.addEventListener("click", () => {
                                        this.confirmar({
                                            reservaUID,
                                            ofertaUID,
                                            posicion,
                                            origen,
                                            instanciaUID
                                        })
                                    })
                                    const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                    botonCancelar.innerText = "Cancelar y volver a la reserva"
                                    document.querySelector("main").appendChild(pantallaInmersiva)

                                },
                                confirmar: async (data) => {

                                    const ofertaUID = data.ofertaUID
                                    const posicion = data.posicion
                                    const reservaUID = data.reservaUID
                                    const origen = data.origen

                                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                                    const mensaje = "Elimiando oferta de la reserva..."
                                    const datosPantallaSuperpuesta = {
                                        instanciaUID: instanciaUID,
                                        mensaje: mensaje
                                    }
                                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/descuentos/eliminarDescuentoEnReserva",
                                        reservaUID: String(reservaUID),
                                        ofertaUID: String(ofertaUID),
                                        origen,
                                        posicion: String(posicion)
                                    }


                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                    instanciaRenderizada.remove()

                                    if (respuestaServidor?.error) {
                                        return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                            reservaUID
                                        })
                                    }
                                }

                            },
                            actualizarEstadoAutorizacion: async (data) => {

                                const ofertaUID = data.ofertaUID
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const e = data.e
                                const area = e.target.closest("[ofertaUID][posicion]")
                                const autorizacionUI = area.querySelector("[dato=autorizacion]")
                                const estadoActualData = area.querySelector("[estadoActual]")
                                const estadoActual = estadoActualData.getAttribute("estadoActual")




                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/descuentos/actualizarAutorizacionDescuentoCompatible",
                                    reservaUID: String(reservaUID),
                                    ofertaUID: String(ofertaUID),
                                }

                                if (estadoActual === "aceptada") {
                                    autorizacionUI.innerText = "Rechazando..."
                                    transaccion.nuevaAutorizacion = "rechazada"
                                } else if (estadoActual === "rechazada") {
                                    autorizacionUI.innerText = "Aceptando..."
                                    transaccion.nuevaAutorizacion = "aceptada"
                                }



                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                                if (respuestaServidor?.error) {
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const estadoAutorizado = respuestaServidor.autorizacion
                                    estadoActualData.setAttribute("estadoActual", estadoAutorizado)

                                    if (estadoAutorizado === "aceptada") {
                                        autorizacionUI.innerText = "Aceptada"
                                        estadoActualData.innerText = "Rechazar oferta"
                                    } else if (estadoAutorizado === "rechazada") {
                                        autorizacionUI.innerText = "Rechazada"
                                        estadoActualData.innerText = "Aceptar oferta"
                                    }
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                        reservaUID
                                    })
                                }
                            },
                            insertarImpuesto: {
                                ui: async function (data) {
                                    const main = document.querySelector("main")
                                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    const reservaUID = main.querySelector("[reservaUID]").getAttribute("reservaUID")
                                    const instanciaUID_insertarImpuestoUI = ui.getAttribute("instanciaUID")
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                    main.appendChild(ui)
                                    const constructor = ui.querySelector("[componente=contenedor]")
                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Obteniendo impuestos...",
                                        textoBoton: "Cancelar"
                                    })
                                    constructor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/impuestos/listarTodosLosImpuestos"
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const uiRenderizada = document.querySelectorAll(`[instanciaUID="${instanciaUID_insertarImpuestoUI}"]`)
                                    if (!uiRenderizada) { return }
                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        spinner.remove()
                                        constructor.appendChild(this.botonCancelar())

                                        const impuestos = respuestaServidor.impuestos

                                        const contenedorOfertas = document.createElement("div")
                                        contenedorOfertas.classList.add(
                                            "maxWidth1280px",
                                            "width100",
                                            "flexVertical",
                                            "gap6",
                                        )
                                        constructor.appendChild(contenedorOfertas)
                                        const estadoUI_ = (estadoIDV) => {

                                            if (estadoIDV === "activado") {
                                                return "Activada"
                                            } else if (estadoIDV === "desactivado") {
                                                return "Desactivada"
                                            }

                                        }

                                        impuestos.forEach((impuesto) => {
                                            const impuestoUID = impuesto.impuestoUID
                                            const nombre = impuesto.nombre
                                            const tipoImpositivo = impuesto.tipoImpositivo
                                            const tipoValorIDV = impuesto.tipoValorIDV
                                            const entidadIDV = impuesto.entidadIDV
                                            const estadoIDV = impuesto.estadoIDV


                                            const contenedorOferta = document.createElement("div")
                                            contenedorOferta.setAttribute("impuestoUID", impuestoUID)
                                            contenedorOferta.classList.add(
                                                "borderRadius12",
                                                "width100",
                                                "flexVertical",
                                                "backgroundGrey1",
                                                "padding6",
                                                "gap10",
                                            )

                                            const contenedorGlobal = document.createElement("div")
                                            contenedorGlobal.classList.add(
                                                "flexVertical",
                                                "padding6",
                                                "gap6"
                                            )

                                            const nombreOfertaUI = document.createElement("div")
                                            nombreOfertaUI.classList.add("negrita")
                                            nombreOfertaUI.innerText = nombre
                                            contenedorGlobal.appendChild(nombreOfertaUI)

                                            const estadoTitulo = document.createElement("div")
                                            estadoTitulo.innerText = "Estado del impuesto"
                                            contenedorGlobal.appendChild(estadoTitulo)


                                            const estadoUI = document.createElement("div")
                                            estadoUI.classList.add("negrita")
                                            estadoUI.innerText = estadoUI_(estadoIDV)
                                            contenedorGlobal.appendChild(estadoUI)
                                            contenedorOferta.appendChild(contenedorGlobal)

                                            const contendorBotones = document.createElement("div")
                                            contendorBotones.classList.add(
                                                "flexHorizontal",
                                                "gap6",
                                            )

                                            const botonInsertar = document.createElement("div")
                                            botonInsertar.classList.add(
                                                "borderRadius8",
                                                "backgroundGrey1",
                                                "comportamientoBoton",
                                                "padding8"
                                            )
                                            botonInsertar.innerText = "Insertar impuesto en la reserva"
                                            botonInsertar.addEventListener("click", () => {
                                                this.confirmarInsertar({
                                                    reservaUID,
                                                    impuestoUID,
                                                    instanciaUID_insertarImpuestoUI,
                                                    instanciaUID_contenedorFinanciero
                                                })

                                            })
                                            contendorBotones.appendChild(botonInsertar)

                                            const botonVerOferta = document.createElement("a")
                                            botonVerOferta.classList.add(
                                                "borderRadius8",
                                                "backgroundGrey1",
                                                "comportamientoBoton",
                                                "padding8",
                                                "limpiezaBotonA"
                                            )
                                            botonVerOferta.innerText = "Ir al impuesto"
                                            botonVerOferta.setAttribute("href", "/administracion/impuestos/" + impuestoUID)
                                            botonVerOferta.setAttribute("vista", "/administracion/impuestos/" + impuestoUID)
                                            botonVerOferta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                            contendorBotones.appendChild(botonVerOferta)


                                            contenedorOferta.appendChild(contendorBotones)

                                            contenedorOfertas.appendChild(contenedorOferta)
                                        })
                                        constructor.appendChild(this.botonCancelar())

                                    }

                                },
                                botonCancelar: () => {
                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("boton")
                                    botonCancelar.setAttribute("boton", "cancelar")
                                    botonCancelar.innerText = "Cerrar y volver a la reserva"
                                    botonCancelar.addEventListener("click", () => {
                                        return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    })
                                    return botonCancelar
                                },
                                confirmarInsertar: async function (data) {
                                    const reservaUID = data.reservaUID
                                    const impuestoUID = String(data.impuestoUID)
                                    const instanciaUID_insertarImpuestoUI = data.instanciaUID_insertarImpuestoUI
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero



                                    const ui = document.querySelector(`[instanciaUID="${instanciaUID_insertarImpuestoUI}"]`)
                                    const contenedor = ui.querySelector("[componente=contenedor]")
                                    contenedor.innerHTML = null

                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Insertando oferta en la reserva..."
                                    })
                                    contenedor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/impuestos/insertarImpuestoEnReserva",
                                        reservaUID,
                                        impuestoUID
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const uiRenderizada = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                    if (!uiRenderizada) { return }

                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                            instanciaUID_contenedorFinanciero,
                                            reservaUID
                                        })
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    }

                                },

                            },
                            eliminarImpuesto: {
                                ui: async function (data) {
                                    const nombreImpuesto = data.nombreImpuesto
                                    const impuestoUID = data.impuestoUID
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                    const reservaUID = document.querySelector("main").querySelector("[reservaUID]").getAttribute("reservaUID")

                                    const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                    const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                                    const instanciaUID_eliminarImpuestoUI = pantallaInmersiva.getAttribute("instanciaUID")


                                    const titulo = constructor.querySelector("[componente=titulo]")
                                    titulo.innerText = `Confirmar eliminar impuesto ${nombreImpuesto} de la reserva`
                                    const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                    mensaje.innerText = "Var a eliminar el impuesto de la reserva, Â¿Estas de acuerdo ? "

                                    const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                    botonAceptar.innerText = "Comfirmar la eliminacion"
                                    botonAceptar.addEventListener("click", () => {
                                        this.confirmarEliminar({
                                            impuestoUID,
                                            reservaUID,
                                            instanciaUID_contenedorFinanciero,
                                            instanciaUID_eliminarImpuestoUI
                                        })
                                    })
                                    const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                    botonCancelar.innerText = "Cancelar y volver"

                                    document.querySelector("main").appendChild(pantallaInmersiva)

                                },
                                confirmarEliminar: async function (data) {
                                    const reservaUID = data.reservaUID
                                    const impuestoUID = String(data.impuestoUID)
                                    const instanciaUID_eliminarImpuestoUI = data.instanciaUID_eliminarImpuestoUI
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero



                                    const ui = document.querySelector(`[instanciaUID="${instanciaUID_eliminarImpuestoUI}"]`)
                                    const contenedor = ui.querySelector("[componente=constructor]")
                                    contenedor.innerHTML = null

                                    const spinner = casaVitini.ui.componentes.spinner({
                                        mensaje: "Eliminado impuesto en la reserva..."
                                    })
                                    contenedor.appendChild(spinner)

                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/impuestos/eliminarImpuestoEnReserva",
                                        reservaUID,
                                        impuestoUID
                                    }

                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    const uiRenderizada = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                    if (!uiRenderizada) { return }

                                    if (respuestaServidor?.error) {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                            instanciaUID_contenedorFinanciero,
                                            reservaUID
                                        })
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    }

                                },

                            },
                            crearImpuestoAdHoc: {
                                ui: async function (data) {
                                    const nombreImpuesto = data.nombreImpuesto
                                    const impuestoUID = data.impuestoUID
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                    const reservaUID = document.querySelector("main").querySelector("[reservaUID]").getAttribute("reservaUID")

                                    const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                    const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                                    const instanciaUID_eliminarImpuestoUI = pantallaInmersiva.getAttribute("instanciaUID")
                                    const contenedor = pantallaInmersiva.querySelector("[componente=contenedor]")

                                    const titulo = constructor.querySelector("[componente=titulo]")
                                    titulo.innerText = `Crear impuesto dedicado solo para esta reserva`
                                    const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                    mensaje.innerText = "Rellena el formulario para crear un impuesto solo para esta reserva.Este impuesto creado solo existirÃ¡ en esta reserva.Si necesitas crear un impuesto que quieras usar para insertar en reservas, pero que no se aplique, crea un impuesto en la secciÃ³n de impuesto y mantenlo desactivado."

                                    const contenedorFormulario = document.createElement("div")
                                    contenedorFormulario.classList.add(
                                        "flexVertical",
                                        "gap6"
                                    )
                                    contenedor.appendChild(contenedorFormulario)


                                    const campoCraerNuevoImpuesto = document.createElement("input")
                                    campoCraerNuevoImpuesto.classList.add(
                                        "padding10",
                                        "borderRadius10"

                                    )
                                    campoCraerNuevoImpuesto.setAttribute("comNuevoImpuesto", "nombreImpuesto")
                                    campoCraerNuevoImpuesto.placeholder = "Escribo el nombre del nuevo impuesto"
                                    contenedorFormulario.appendChild(campoCraerNuevoImpuesto)

                                    const campoTipoImpositivo = document.createElement("input")
                                    campoTipoImpositivo.classList.add(
                                        "padding10",
                                        "borderRadius10"
                                    )
                                    campoTipoImpositivo.setAttribute("comNuevoImpuesto", "tipoImpositivo")
                                    campoTipoImpositivo.placeholder = "0.00"
                                    contenedorFormulario.appendChild(campoTipoImpositivo)

                                    const contenedorOpciones = document.createElement("select")
                                    contenedorOpciones.classList.add(
                                        "padding10",
                                        "borderRadius10"
                                    )
                                    contenedorOpciones.setAttribute("comNuevoImpuesto", "tipoValor")
                                    const tipoValorLista = [
                                        {
                                            tipoValorIDV: "",
                                            tipoValorUI: "Selecciona el tipo de impuesto"
                                        },
                                        {
                                            tipoValorIDV: "porcentaje",
                                            tipoValorUI: "Porcentaje"
                                        },
                                        {
                                            tipoValorIDV: "tasa",
                                            tipoValorUI: "Tasa"
                                        },

                                    ]
                                    tipoValorLista.forEach((contenedorTipoValor) => {
                                        const tipoValorIDV = contenedorTipoValor.tipoValorIDV
                                        const tipoValorUI = contenedorTipoValor.tipoValorUI
                                        const opcion = document.createElement("option");
                                        if (!tipoValorIDV) {
                                            opcion.selected = true;
                                            opcion.disabled = true;

                                        }
                                        opcion.value = tipoValorIDV;
                                        opcion.text = tipoValorUI;
                                        opcion.setAttribute("opcion", tipoValorIDV)
                                        contenedorOpciones.add(opcion);
                                    })
                                    contenedorFormulario.appendChild(contenedorOpciones)


                                    const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                    botonAceptar.innerText = "Crear impuesto dedicado para esta reserva"
                                    botonAceptar.addEventListener("click", () => {
                                        this.confirmarCrearImpuestoAdHoc({
                                            reservaUID,
                                            instanciaUID_contenedorFinanciero,
                                            instanciaUID_eliminarImpuestoUI,
                                            nombreImpuesto: campoCraerNuevoImpuesto.value,
                                            tipoImpositivo: campoTipoImpositivo.value,
                                            tipoValorIDV: contenedorOpciones.value

                                        })
                                    })
                                    const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                    botonCancelar.innerText = "Cancelar y volver"

                                    document.querySelector("main").appendChild(pantallaInmersiva)

                                },
                                confirmarCrearImpuestoAdHoc: async function (data) {
                                    const reservaUID = data.reservaUID
                                    const nombreImpuesto = data.nombreImpuesto
                                    const tipoImpositivo = data.tipoImpositivo
                                    const tipoValorIDV = data.tipoValorIDV

                                    const instanciaUID_eliminarImpuestoUI = data.instanciaUID_eliminarImpuestoUI
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero

                                    const instanciaUID_pantallaDeCargaSuperPuesta = casaVitini.utilidades.codigoFechaInstancia()

                                    const datosPantallaSuperpuesta = {
                                        instanciaUID: instanciaUID_pantallaDeCargaSuperPuesta,
                                        mensaje: "Creando impuesto dedicado e insertando en la reserva..."
                                    }
                                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                                    const transaccion = {
                                        zona: "administracion/reservas/detallesReserva/impuestos/insertarImpuestoDedicadoEnReserva",
                                        reservaUID,
                                        nombreImpuesto,
                                        tipoImpositivo,
                                        tipoValorIDV,
                                    }



                                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                    document.querySelector(`[instanciaUID="${instanciaUID_pantallaDeCargaSuperPuesta}"]`)?.remove()

                                    const uiRenderizada = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                    if (!uiRenderizada) { return }

                                    if (respuestaServidor?.error) {
                                        return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                    }
                                    if (respuestaServidor?.ok) {
                                        casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                            instanciaUID_contenedorFinanciero,
                                            reservaUID
                                        })
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    }
                                },

                            },

                            reconstruirDesgloseFinanciero: {
                                ui: async function (data) {
                                    const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                    const reservaUID = document.querySelector("main").querySelector("[reservaUID]").getAttribute("reservaUID")

                                    const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                    const contenedor = pantallaInmersiva.querySelector("[componente=contenedor]")
                                    const instanciaUID_reconstrucion = pantallaInmersiva.getAttribute("instanciaUID")
                                    document.querySelector("main").appendChild(pantallaInmersiva)



                                    const tituloUI = document.createElement("p")
                                    tituloUI.classList.add("titulo")
                                    tituloUI.setAttribute("componente", "titulo")
                                    tituloUI.innerText = `Elige el origen de la reconstrucion del desglose financiero de la reserva ${reservaUID}`
                                    contenedor.appendChild(tituloUI)



                                    const mensajeUI = document.createElement("div")
                                    mensajeUI.classList.add("mensajeUI")
                                    mensajeUI.setAttribute("componente", "mensajeUI")
                                    mensajeUI.innerText = "Esta operaciÃ³n reconstruye el desglose financiero.Reconstruir desde la instantÃ¡nea, regenera el desglose financiero desde las instantÃ¡neas del contenedor financiero de la reserva.Esta operaciÃ³n es Ãºtil si no se ha reconstituido por alguna razÃ³n el desglose financiero correctamente tras alguna operaciÃ³n."
                                    contenedor.appendChild(mensajeUI)


                                    const botonDesdeInstantaneas = document.createElement("div")
                                    botonDesdeInstantaneas.classList.add("boton")
                                    botonDesdeInstantaneas.setAttribute("boton", "aceptar")
                                    botonDesdeInstantaneas.innerText = "Reconstruir desde instantaneas"
                                    botonDesdeInstantaneas.addEventListener("click", () => {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        this.desdeInstantaneas.ui({
                                            reservaUID,
                                            instanciaUID_contenedorFinanciero,
                                            instanciaUID_reconstrucion
                                        })
                                    })
                                    contenedor.appendChild(botonDesdeInstantaneas)


                                    const mensajeUI_ = document.createElement("div")
                                    mensajeUI_.classList.add("mensajeUI")
                                    mensajeUI_.setAttribute("componente", "mensajeUI")
                                    mensajeUI_.innerText = "Reconstruir el desglose financiero desde el hub, reconstruirÃ¡ el desglose financiero actualizando las instantÃ¡neas de la reserva desde el hub de precios base, comportamiento de precios y ofertas actualmente configurados.Esta operaciÃ³n es irreversible y puede ser Ãºtil cuando necesito actualizar ciertos datos del contenedor financiero de la reserva desde los hubs de origen."
                                    contenedor.appendChild(mensajeUI_)

                                    const botonDesdeHub = document.createElement("div")
                                    botonDesdeHub.classList.add("boton")
                                    botonDesdeHub.setAttribute("boton", "aceptar")
                                    botonDesdeHub.innerText = "Reconstruir desde el hub"
                                    botonDesdeHub.addEventListener("click", () => {
                                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        this.desdeHub.ui({
                                            reservaUID,
                                            instanciaUID_contenedorFinanciero,
                                            instanciaUID_reconstrucion
                                        })

                                    })

                                    contenedor.appendChild(botonDesdeHub)

                                    const botonCancelar = document.createElement("div")
                                    botonCancelar.classList.add("boton")
                                    botonCancelar.setAttribute("boton", "cancelar")
                                    botonCancelar.innerText = "Cancelar y volver"
                                    botonCancelar.addEventListener("click", () => {
                                        return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    })
                                    contenedor.appendChild(botonCancelar)

                                },
                                desdeInstantaneas: {
                                    ui: async function (data) {
                                        const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                        const reservaUID = document.querySelector("main").querySelector("[reservaUID]").getAttribute("reservaUID")

                                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                                        const instanciaUID_reconstrucion = pantallaInmersiva.getAttribute("instanciaUID")


                                        const titulo = constructor.querySelector("[componente=titulo]")
                                        titulo.innerText = `Confirmar reconstruir el desglose de la reserva ${reservaUID} de las instantaneas`
                                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                        mensaje.innerText = "Esta operacion reconstruye el desglose financiero.Si ha ocurrido un algun tipo de error en algun calculo drante la construcion del deshlose financiero, esta opcion podrai recuperar la intergrdiad del desglose financiero."

                                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                        botonAceptar.innerText = "Comfirmar la reconstrucciÃ³n"
                                        botonAceptar.addEventListener("click", () => {
                                            this.confirmarReconstrucion({
                                                reservaUID,
                                                instanciaUID_contenedorFinanciero,
                                                instanciaUID_reconstrucion
                                            })
                                        })
                                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                        botonCancelar.innerText = "Cancelar y volver"

                                        document.querySelector("main").appendChild(pantallaInmersiva)

                                    },
                                    confirmarReconstrucion: async function (data) {
                                        const reservaUID = data.reservaUID
                                        const instanciaUID_reconstrucion = data.instanciaUID_reconstrucion
                                        const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero

                                        const ui = document.querySelector(`[instanciaUID="${instanciaUID_reconstrucion}"]`)
                                        const contenedor = ui.querySelector("[componente=constructor]")
                                        contenedor.innerHTML = null

                                        const spinner = casaVitini.ui.componentes.spinner({
                                            mensaje: "Reconstruyendo el desglose financiero desde las instantaneas de la reserva..."
                                        })
                                        contenedor.appendChild(spinner)

                                        const transaccion = {
                                            zona: "administracion/reservas/detallesReserva/contenedorFinanciero/reconstruirDesgloseDesdeInstantaneas",
                                            reservaUID
                                        }

                                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                        const uiRenderizada = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                        if (!uiRenderizada) { return }

                                        if (respuestaServidor?.error) {
                                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                            return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                        }
                                        if (respuestaServidor?.ok) {
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                                instanciaUID_contenedorFinanciero,
                                                reservaUID
                                            })
                                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        }

                                    },
                                },
                                desdeHub: {
                                    ui: async function (data) {
                                        const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                        const reservaUID = document.querySelector("main").querySelector("[reservaUID]").getAttribute("reservaUID")

                                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                                        const instanciaUID_reconstrucion = pantallaInmersiva.getAttribute("instanciaUID")
                                        const contenedor = pantallaInmersiva.querySelector("[componente=contenedor]")
                                        contenedor.classList.add(
                                            "flexVertical"
                                        )



                                        const titulo = constructor.querySelector("[componente=titulo]")
                                        titulo.innerText = `Confirmar reconstruir el desglose de la reserva ${reservaUID} desde el hub (Oeracion irreversible)`
                                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                        mensaje.innerText = "Esta operaciÃ³n reconstruye el desglose financiero.SÃ­ ha ocurrido un algÃºn tipo de error en algÃºn cÃ¡lculo durante la construcciÃ³n del desglose financiero, esta opciÃ³n podrÃ­a recuperar la integridad del desglose financiero."

                                        const campo = document.createElement("input")
                                        campo.placeholder = "Escribe la palabra reconstruir"
                                        campo.classList.add(
                                            "borderRadius10",
                                            "padding10"
                                        )
                                        contenedor.appendChild(campo)
                                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                        botonAceptar.innerText = "Confirmar la reconstrucciÃ³n irreversible de todo el contenedor financiero de la reserva."
                                        botonAceptar.addEventListener("click", () => {
                                            this.confirmarReconstrucion({
                                                reservaUID,
                                                instanciaUID_contenedorFinanciero,
                                                instanciaUID_reconstrucion,
                                                palabra: campo.value
                                            })
                                        })
                                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                        botonCancelar.innerText = "Cancelar y volver"

                                        document.querySelector("main").appendChild(pantallaInmersiva)

                                    },
                                    confirmarReconstrucion: async function (data) {
                                        const reservaUID = data.reservaUID
                                        const palabra = data.palabra
                                        const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero

                                        const instanciaUID_pantallaDeCargaSuperPuesta = casaVitini.utilidades.codigoFechaInstancia()

                                        const datosPantallaSuperpuesta = {
                                            instanciaUID: instanciaUID_pantallaDeCargaSuperPuesta,
                                            mensaje: "Reconstruyendo todo el contenedor financiero de la reserva desde los hubs..."
                                        }
                                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)

                                        const transaccion = {
                                            zona: "administracion/reservas/detallesReserva/contenedorFinanciero/reconstruirDesgloseDesdeHubs",
                                            reservaUID,
                                            palabra
                                        }

                                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                        const pantallaDeCarga_renderizda = document.querySelector(`[instanciaUID="${instanciaUID_pantallaDeCargaSuperPuesta}"]`)
                                        pantallaDeCarga_renderizda?.remove()

                                        const uiRenderizada = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                        if (!uiRenderizada) { return }

                                        if (respuestaServidor?.error) {
                                            if (pantallaDeCarga_renderizda) {
                                                return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                            }
                                        }
                                        if (respuestaServidor?.ok) {
                                            casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.desgloseTotal.controladores.desplegarContenedorFinanciero({
                                                instanciaUID_contenedorFinanciero,
                                                reservaUID
                                            })
                                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        }

                                    },
                                }

                            },
                        },
                        controladores: {
                            desplegarContenedorFinanciero: async (data) => {
                                const reservaUID = data.reservaUID
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/global/obtenerReserva",
                                    reservaUID: reservaUID,
                                    capas: [
                                        "desgloseFinanciero",
                                    ]
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                                const instanciaRenderizada = document.querySelector(`[reservaUID="${reservaUID}"] [componente=contenedorDesgloseTotal]`)
                                if (!instanciaRenderizada) {
                                    return
                                }
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const totalGlobal = document.querySelector("[dataReserva=totalReservaConImpuestos]")

                                    const contenedorFinanciero = respuestaServidor.ok.contenedorFinanciero
                                    const totalFinal = contenedorFinanciero.desgloseFinanciero.global.totales.totalFinal
                                    totalGlobal.innerText = totalFinal

                                    casaVitini.ui.componentes.contenedorFinanciero.constructor({
                                        destino: `[reservaUID="${reservaUID}"] [componente=contenedorDesgloseTotal]`,
                                        contenedorFinanciero,
                                        modoUI: "administracion"
                                    })
                                }
                            }
                        }


                    },
                    cancelarReserva: {
                        arranque: () => {
                            document.body.style.overflow = "hidden";
                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const advertenciaInmersivaIU = document.createElement("div")
                            advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                            advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                            advertenciaInmersivaIU.setAttribute("contenedor", "opcionesCancelacion")
                            const contenedorAdvertenciaInmersiva = document.createElement("div")
                            contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                            const contenidoAdvertenciaInmersiva = document.createElement("div")
                            contenidoAdvertenciaInmersiva.classList.add("contenidoAdvertenciaInmersiva")
                            contenidoAdvertenciaInmersiva.setAttribute("contenedor", "contenidoAdvertenciaInmersiva")
                            const contenedorCancelacion = document.createElement("div")
                            contenedorCancelacion.classList.add("administracion_reservas_detallesReservas_cancelarReserva_contenedorCancelacion")
                            const tituloCancelarReserva = document.createElement("p")
                            tituloCancelarReserva.classList.add("detallesReservaTituloCancelarReserva")
                            tituloCancelarReserva.innerText = "Cancelar reserva"
                            contenedorCancelacion.appendChild(tituloCancelarReserva)
                            const botonCancelarProcesoCancelacion = document.createElement("div")
                            botonCancelarProcesoCancelacion.classList.add("detallesReservaCancelarBoton")
                            botonCancelarProcesoCancelacion.innerText = "Cerrar y volver atras"
                            botonCancelarProcesoCancelacion.addEventListener("click", () => {
                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.salirDelProceso(reservaUID)
                            })
                            contenedorCancelacion.appendChild(botonCancelarProcesoCancelacion)
                            const bloqueBloqueoApartamentos = document.createElement("div")
                            bloqueBloqueoApartamentos.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                            const tituloBloquoApartamentos = document.createElement("div")
                            tituloBloquoApartamentos.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                            tituloBloquoApartamentos.innerText = "Selecciona quÃ© tipo de bloqueo quieres aplicar a los apartamentos de esta reserva tras la cancelaciÃ³n."
                            bloqueBloqueoApartamentos.appendChild(tituloBloquoApartamentos)
                            let opcionBloqueoApartamento = document.createElement("p")
                            opcionBloqueoApartamento.classList.add("detallesReservaCancelarOcionBloqueoApartamentos")
                            opcionBloqueoApartamento.setAttribute("componente", "cancelarReservaOpcionBloqueo")
                            opcionBloqueoApartamento.setAttribute("cancelarReservatipoBloqueo", "rangoTemporal")
                            opcionBloqueoApartamento.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.seleccionarOpcionBloqueoApartametos)
                            opcionBloqueoApartamento.innerText = "Bloquear los apartamentos de esta reserva tras la cancelaciÃ³n durante el mismo rango que tiene esta reserva."
                            bloqueBloqueoApartamentos.appendChild(opcionBloqueoApartamento)
                            opcionBloqueoApartamento = document.createElement("p")
                            opcionBloqueoApartamento.classList.add("detallesReservaCancelarOcionBloqueoApartamentos")
                            opcionBloqueoApartamento.setAttribute("componente", "cancelarReservaOpcionBloqueo")
                            opcionBloqueoApartamento.setAttribute("cancelarReservatipoBloqueo", "permanente")
                            opcionBloqueoApartamento.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.seleccionarOpcionBloqueoApartametos)
                            opcionBloqueoApartamento.innerText = "Bloquear los apartamentos de esta reserva tras la cancelaciÃ³n con un bloqueo permanente.DeberÃ¡ liberarlos manualmente."
                            bloqueBloqueoApartamentos.appendChild(opcionBloqueoApartamento)
                            opcionBloqueoApartamento = document.createElement("p")
                            opcionBloqueoApartamento.classList.add("detallesReservaCancelarOcionBloqueoApartamentos")
                            opcionBloqueoApartamento.setAttribute("componente", "cancelarReservaOpcionBloqueo")
                            opcionBloqueoApartamento.setAttribute("cancelarReservatipoBloqueo", "sinBloqueo")
                            opcionBloqueoApartamento.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.seleccionarOpcionBloqueoApartametos)
                            opcionBloqueoApartamento.innerText = "Liberar los apartamentos de esta reserva tras la cancelaciÃ³n para que pasen a estar disponibles para su reserva."
                            bloqueBloqueoApartamentos.appendChild(opcionBloqueoApartamento)
                            contenedorCancelacion.appendChild(bloqueBloqueoApartamentos)
                            const bloqueBotones = document.createElement("div")
                            bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                            const entradaPalabraCancelar = document.createElement("input")
                            entradaPalabraCancelar.classList.add("detallesReservaCancelarEntradaTextoCancelar")
                            entradaPalabraCancelar.placeholder = "Escriba la palabra cancelar"
                            // advertenciaInmersivaIU.appendChild(entradaPalabraCancelar)
                            const infoBotonCancelar = document.createElement("div")
                            infoBotonCancelar.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                            infoBotonCancelar.innerText = "Para que se habilite el botÃ³n, tienes que seleccionar una de las tres opciones de arriba.Confirmar y cancelar la reserva."
                            bloqueBloqueoApartamentos.appendChild(infoBotonCancelar)
                            const botonCancelar = document.createElement("div")
                            botonCancelar.classList.add("detallesReservaCancelarBoton")
                            botonCancelar.setAttribute("componente", "botonConfirmarCancelarReserva")
                            botonCancelar.style.pointerEvents = "none"
                            botonCancelar.style.color = "#313131"
                            botonCancelar.innerText = "Confirmar y cancelar reserva"
                            botonCancelar.addEventListener("click", () => {
                                const tipoBloqueoIDV = document.querySelector("[componente=cancelarReservaOpcionBloqueo][estado=activo]").getAttribute("cancelarReservatipoBloqueo")
                                casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.confirmaCancelacion({
                                    tipoBloqueoIDV
                                })
                            })
                            bloqueBloqueoApartamentos.appendChild(botonCancelar)
                            const infoEliminarReserva = document.createElement("div")
                            infoEliminarReserva.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                            //infoEliminarReserva.style.marginTop = "50px"
                            infoEliminarReserva.innerText = "TambiÃ©n puedes eliminar irreversiblemente una reserva.La eliminaciÃ³n irreversible de una reserva borra la informaciÃ³n de la reserva, asÃ­ como los pagos asociados a la reserva y toda la informaciÃ³n relacionada con la reserva, menos los datos de los clientes y titulares que permanecen disponibles para otras reservas.A diferencia de la cancelaciÃ³n, los datos de la reserva dejarÃ¡n de estar disponibles."
                            bloqueBotones.appendChild(infoEliminarReserva)
                            const botonEliminarReserva = document.createElement("div")
                            botonEliminarReserva.classList.add("administracion_reservas_detallesReserva_cancelarReserva_botonV1")
                            botonEliminarReserva.setAttribute("componente", "botonConfirmarCancelarReserva")
                            botonEliminarReserva.innerText = "Eliminar irreversiblemente la reserva"
                            botonEliminarReserva.addEventListener("click", casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.eliminarReservaIrreversiblemente.UI)
                            bloqueBotones.appendChild(botonEliminarReserva)
                            contenedorCancelacion.appendChild(bloqueBotones)
                            contenidoAdvertenciaInmersiva.appendChild(contenedorCancelacion)
                            contenedorAdvertenciaInmersiva.appendChild(contenidoAdvertenciaInmersiva)
                            advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                            document.querySelector("main").appendChild(advertenciaInmersivaIU)
                        },
                        seleccionarOpcionBloqueoApartametos: (opcion) => {
                            let selectorOpciones = document.querySelectorAll("[componente=cancelarReservaOpcionBloqueo]")
                            let opcionBloqueo = opcion.target
                            let botonCancelar = document.querySelector("[componente=botonConfirmarCancelarReserva]")
                            if (opcionBloqueo.getAttribute("estado") === "activo") {
                                opcionBloqueo.removeAttribute("estado")
                                botonCancelar.style.pointerEvents = "none"
                                botonCancelar.style.color = "#313131"
                                opcionBloqueo.removeAttribute("style")

                            }
                            selectorOpciones.forEach((opcionBloqueo) => {
                                opcionBloqueo.removeAttribute("style")
                                opcionBloqueo.removeAttribute("estado")
                            })
                            opcionBloqueo.style.background = "blue"
                            opcionBloqueo.style.color = "white"
                            opcionBloqueo.setAttribute("estado", "activo")
                            botonCancelar.removeAttribute("style")
                        },
                        confirmaCancelacion: async function (data) {
                            const instanciaUID_pantallaEspera = casaVitini.utilidades.codigoFechaInstancia()
                            const metadatosPantallaCarga = {
                                mensaje: "Cancelando reserva...",
                                instanciaUID: instanciaUID_pantallaEspera,
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)

                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const tipoBloqueoIDV = data.tipoBloqueoIDV
                            const transaccion = {
                                zona: "administracion/reservas/detallesReserva/global/cancelarReserva",
                                reservaUID: String(reservaUID),
                                tipoBloqueoIDV: tipoBloqueoIDV
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const selectorPantallaDeCarga = document.querySelector(`[instanciaUID="${instanciaUID_pantallaEspera}"]`)
                            selectorPantallaDeCarga?.remove()

                            const reservaUI = document.querySelector(`[reservaUID="${reservaUID}"]`)
                            if (!reservaUI) { return }

                            if (respuestaServidor?.error) {
                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                            } else if (respuestaServidor?.ok) {
                                const m = "Reserva cancelada"
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                casaVitini.ui.componentes.advertenciaInmersiva(m)
                                document.querySelector(`[reservaUID="${reservaUID}"] [dataReserva=estado]`).innerText = "Cancelada"
                                document.querySelector(`[reservaUID="${reservaUID}"] [contenedor=pendiente]`).style.display = "none"
                                document.querySelector(`[reservaUID="${reservaUID}"] [estadoReservaIDV]`).setAttribute("estadoReservaIDV", "cancelada")

                                this.salirDelProceso(reservaUID)
                            }
                        },
                        eliminarReservaIrreversiblemente: {
                            UI: function () {
                                const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                                const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                                const selectorContenedorOpcionesCancelacion = document.querySelector("[contenedor=opcionesCancelacion]")
                                selectorContenedorOpcionesCancelacion.style.transition = "background 500ms"
                                selectorContenedorOpcionesCancelacion.style.background = "rgba(255, 0, 0, 0.3)"
                                selectorContenedorOpcionesCancelacion.setAttribute("instanciaUID", instanciaUID)
                                const selectorContenido = selectorContenedorOpcionesCancelacion.querySelector("[contenedor=contenidoAdvertenciaInmersiva]")
                                selectorContenido.innerHTML = null
                                const contenedorCancelacion = document.createElement("div")
                                contenedorCancelacion.classList.add("administracion_reservas_detallesReservas_cancelarReserva_contenedorCancelacion")
                                const tituloCancelarReserva = document.createElement("p")
                                tituloCancelarReserva.classList.add("detallesReservaTituloCancelarReserva")
                                tituloCancelarReserva.innerText = "Eliminar irreversiblemente una reserva"
                                tituloCancelarReserva.style.color = "red"
                                contenedorCancelacion.appendChild(tituloCancelarReserva)
                                const botonCancelarProcesoCancelacion = document.createElement("div")
                                botonCancelarProcesoCancelacion.classList.add("detallesReservaCancelarBoton")
                                botonCancelarProcesoCancelacion.innerText = "Cerrar y volver atras"
                                botonCancelarProcesoCancelacion.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.salirDelProceso(reservaUID)
                                })
                                contenedorCancelacion.appendChild(botonCancelarProcesoCancelacion)
                                const bloqueBloqueoApartamentos = document.createElement("div")
                                bloqueBloqueoApartamentos.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                                const tituloBloquoApartamentos = document.createElement("div")
                                tituloBloquoApartamentos.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                tituloBloquoApartamentos.innerText = "Eliminar irreversiblemente una reserva, elimina de la base de datos la informaciÃ³n de la reserva, los alojamientos asociados, los pernoctantes y el titular de la reserva(pero no sus datos como cliente), los pagos y los reembolsos.Esta eliminaciÃ³n es irreversible.Los datos desaparecerÃ¡n de la base de datos y si no existen en una copia de seguridad, no serÃ¡n recuperables.Si solo desea cancelar una reserva para liberar los apartamentos y hacer que deje de tener vigencia, cancÃ©lela y podrÃ¡ seguir teniendo acceso a los datos de esta sin que tenga vigencia pernoctativa y ocupacional."
                                bloqueBloqueoApartamentos.appendChild(tituloBloquoApartamentos)
                                const infoSeguridad = document.createElement("div")
                                infoSeguridad.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                                infoSeguridad.innerText = "Para eliminar una reserva irreversiblemente junto con toda su informaciÃ³n relacionada, debe escribir su contraseÃ±a de usuario y su cuenta debe tener autorizaciÃ³n administrativa."
                                bloqueBloqueoApartamentos.appendChild(infoSeguridad)
                                const campo = document.createElement("input")
                                campo.classList.add("administracion_reserva_detallesReserva_cancelarReserva_eliminarReserva_campo")
                                campo.setAttribute("campo", "clave")
                                campo.type = "password"
                                campo.placeholder = "Escriba la contraseÃ±a de su VitiniID"
                                bloqueBloqueoApartamentos.appendChild(campo)
                                contenedorCancelacion.appendChild(bloqueBloqueoApartamentos)
                                const bloqueBotones = document.createElement("div")
                                bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("administracion_reserva_detallesReserva_cancelarReserva_eliminarReserva_botonV1")
                                botonCancelar.setAttribute("componente", "botonConfirmarCancelarReserva")
                                botonCancelar.innerText = "Eliminar reseva irreversiblemente"
                                botonCancelar.addEventListener("click", () => {
                                    casaVitini.administracion.reservas.detallesReserva.categoriasGlobales.cancelarReserva.eliminarReservaIrreversiblemente.confirmar({
                                        instanciaUID,
                                        reservaUID
                                    })
                                })
                                bloqueBloqueoApartamentos.appendChild(botonCancelar)
                                contenedorCancelacion.appendChild(bloqueBotones)
                                selectorContenido.appendChild(contenedorCancelacion)
                                //selectorContenido.appendChild(selectorContenedorOpcionesCancelacion)
                            },
                            confirmar: async (data) => {

                                const reservaUID = data.reservaUID
                                const instanciaUID = data.instanciaUID

                                const clave = document.querySelector(`[instanciaUID="${instanciaUID}"] [campo=clave]`)
                                const instanciaUID_pantallDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                                const metadatosPantallaCarga = {
                                    mensaje: "Eliminado reserva...",
                                    instanciaUID: instanciaUID_pantallDeCarga,
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/global/eliminarIrreversiblementeReserva",
                                    reservaUID: String(reservaUID),
                                    clave: clave?.value
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const selectorPantallaDeCarga = document.querySelector(`[instanciaUID="${instanciaUID_pantallDeCarga}"]`)
                                selectorPantallaDeCarga?.remove()

                                const reservaUI = document.querySelector(`[reservaUID="${reservaUID}"]`)
                                if (!reservaUI) { return }

                                if (respuestaServidor?.error) {

                                    document.querySelector(`[instanciaUID="${instanciaUID}"] [campo=clave]`).value = ""
                                    return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                                    granuladoURL.rawArray.pop()
                                    const rawArray = granuladoURL.rawArray

                                    const main = document.querySelector("main")
                                    main.innerHTML = null

                                    const directoriosFusion = "/administracion/reservas"
                                    const componentesExistenteUID = "reservaUID_" + reservaUID
                                    const titulo = "Casa Vitini"
                                    const estado = {
                                        zona: directoriosFusion,
                                        EstadoInternoZona: "estado",
                                        tipoCambio: "parcial",
                                        componenteExistente: componentesExistenteUID,
                                        funcionPersonalizada: "casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias"
                                    }
                                    window.history.pushState(estado, titulo, directoriosFusion);

                                    const info = document.createElement("div")
                                    info.classList.add(
                                        "margin10",
                                        "textoCentrado",
                                        "negritas"
                                    )
                                    info.innerText = `Se ha eliminado la reserva ${reservaUID}`
                                    main.appendChild(info)


                                }
                            }
                        },
                        salirDelProceso: (reservaUID) => {
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas();
                            const granuladoURL = casaVitini.utilidades.granuladorURL()
                            granuladoURL.rawArray.pop()
                            const rawArray = granuladoURL.rawArray

                            const directoriosFusion = "/" + rawArray.join("/")
                            const componentesExistenteUID = "reservaUID_" + reservaUID
                            const titulo = "Casa Vitini"
                            const estado = {
                                zona: directoriosFusion,
                                EstadoInternoZona: "estado",
                                tipoCambio: "parcial",
                                componenteExistente: componentesExistenteUID,
                                funcionPersonalizada: "casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias"
                            }
                            window.history.pushState(estado, titulo, directoriosFusion);
                        },
                    },
                    miscelanea: {
                        arranque: async () => {
                            casaVitini.administracion.reservas.detallesReserva.reservaUI.categorias.limpiarMenusCategorias()
                            document.querySelector(`[categoriaReserva=miscelanea]`).setAttribute("estadoCategoria", "actual")
                            const reservaUID = document.querySelector("[reservaUID]").getAttribute("reservaUID")
                            const obtenerPDF = async () => {


                                const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                                const instanciaUID = pantallaInmersiva.closest("[instanciaUID]").getAttribute("instanciaUID")


                                const titulo = constructor.querySelector("[componente=titulo]")
                                titulo.innerText = "Reserva en pdf"
                                const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                mensaje.innerText = "Generando el pdf..."

                                const contenedorEspacio = constructor.querySelector("[componente=contenedor]")
                                const spinnerPorRenderizar = casaVitini.ui.componentes.spinnerSimple()
                                contenedorEspacio.appendChild(spinnerPorRenderizar)

                                const botonDescargar = constructor.querySelector("[boton=aceptar]")
                                botonDescargar.style.display = "none"

                                const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                botonCancelar.innerText = "Cancelar generacion del pdf..."

                                document.querySelector("main").appendChild(pantallaInmersiva)
                                const advertenciaInmersivaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)

                                const transaccion = {
                                    zona: "administracion/reservas/detallesReserva/miscelanea/pdfReserva",
                                    reservaUID: reservaUID
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const pantallaInmersivaRenderizda = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                if (!pantallaInmersivaRenderizda) {
                                    return
                                }
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor.error)
                                }
                                if (respuestaServidor.ok) {
                                    const pdfBase64 = respuestaServidor.pdf
                                    const selectorZonaGestion = advertenciaInmersivaRenderizada.querySelector("[componente=contenedor]");
                                    selectorZonaGestion.innerHTML = null;
                                    mensaje.innerText = "Se ha generado el archivo PDF con el resumen de esta reserva.Para descargar el PDF, pulsa en el botÃ³n inferior.";

                                    const botonDescargarPDF = document.createElement("a")
                                    botonDescargarPDF.classList.add(
                                        "boton",
                                        "areaSinDecoracionPredeterminada",
                                        "ratonDefault"
                                    )
                                    botonDescargarPDF.innerText = "Descargar un resumen de la reserva en PDF"
                                    botonDescargarPDF.download = "Reserva.pdf"
                                    botonDescargarPDF.title = "Descargar PDF"
                                    botonDescargarPDF.href = `data:application/pdf;base64,${pdfBase64}`


                                    botonDescargar.parentNode.replaceChild(botonDescargarPDF, botonDescargar);
                                    botonCancelar.innerText = "Cancelar y volver"
                                }

                            }
                            const botonEnlacesDePago = document.querySelector("[categoriaReserva=miscelanea]")
                            botonEnlacesDePago.style.background = "blue"
                            botonEnlacesDePago.querySelector("[componente=iconoLineaMiscelanea]").style.background = "white"
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const contenedorDinamico = document.querySelector("[componente=contenedorDinamico]")
                            contenedorDinamico.innerHTML = null
                            const contenedorDesgloseDelTotal = document.createElement("div")
                            contenedorDesgloseDelTotal.classList.add("administracion_reserver_detallesReserva_contenedorDesgloseTotal")
                            contenedorDesgloseDelTotal.setAttribute("instanciaUID", instanciaUID)
                            contenedorDesgloseDelTotal.setAttribute("componente", "contenedorDesgloseTotal")
                            contenedorDinamico.appendChild(contenedorDesgloseDelTotal)
                            const contenedorAdvertenciaInmersiva = document.createElement("div")
                            contenedorAdvertenciaInmersiva.classList.add("administracion_reservas_detallesReserva_contenedorMisleanea")
                            const titulo = document.createElement("p")
                            titulo.classList.add("detallesReserva_reembolso_tituloGlobal")
                            titulo.innerText = "MiscelÃ¡nea"
                            contenedorAdvertenciaInmersiva.appendChild(titulo)
                            const infoGlobal = document.createElement("div")
                            infoGlobal.classList.add("detallesReserva_reembolso_infoGlobal")
                            infoGlobal.innerText = `En la miscelÃ¡nea de la reserva encontrarÃ¡ operaciones y demÃ¡s propÃ³sitos u opciones que, por su idiosincrasia especÃ­fica, no requieren de un contexto dedicado.`
                            contenedorAdvertenciaInmersiva.appendChild(infoGlobal)
                            let boton = document.createElement("div")
                            boton.classList.add("administracion_reservas_detallesReserfa_miscelanea_botonOpcion")
                            boton.addEventListener("click", obtenerPDF)
                            boton.innerText = "Generar un PDF del resumen de la reserva"
                            contenedorAdvertenciaInmersiva.appendChild(boton)
                            boton = document.createElement("div")
                            boton.classList.add("administracion_reservas_detallesReserfa_miscelanea_botonOpcion")
                            boton.innerText = "Generar un PDF del resumen de la reserva y enviar por mail(implementandose)"
                            //contenedorAdvertenciaInmersiva.appendChild(boton)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            instanciaRenderizada.innerHTML = null
                            instanciaRenderizada.appendChild(contenedorAdvertenciaInmersiva)
                        }
                    },
                },
            },
            pendientes_de_revision: {
                arranque: async () => {
                    const sectionRenderizada = document.querySelector("main[instanciaUID]")
                    const instanciaUID = sectionRenderizada.getAttribute("instanciaUID")
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/reservas/pendientesDeRevision")
                    const espacioReservasPendientes = document.querySelector(`main[instanciaUID="${instanciaUID}"]`).querySelector("[componente=espacioReservasPendientesDeRevision]")
                    const info = document.createElement("div")
                    info.classList.add("info")
                    info.innerText = "No hay reservas pendientes de revisiÃ³n"
                    const transaccion = {
                        zona: "administracion/reservas/pendientes_de_revision/obtener_reservas"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        if (espacioReservasPendientes) {
                            const reservasPendientes = respuestaServidor.reservas
                            if (reservasPendientes.length === 0) {
                                casaVitini.administracion.reservas.pendientes_de_revision.componentes.infoSinReservas(instanciaUID)
                            } else {
                                for (const rP of reservasPendientes) {
                                    const global = rP.global
                                    const contenedorFinanciero = rP.contenedorFinanciero
                                    const contenedorTitular = rP.titular

                                    const reservaUID = global.reservaUID
                                    const fechaEntrada = global.fechaEntrada
                                    const fechaSalida = global.fechaSalida
                                    const fechaCreacion_ISO = global.fechaCreacion
                                    const totalConImpuestos = contenedorFinanciero.desgloseFinanciero.global.totales.totalFinal

                                    const nombreTitular = contenedorTitular.nombreTitular
                                    const pasaporteTitular = contenedorTitular.pasaporteTitular
                                    const tipoTitularIDV = contenedorTitular.tipoTitularIDV

                                    const contenedorReserva = document.createElement("div")
                                    contenedorReserva.classList.add("contenedorReserva")
                                    contenedorReserva.setAttribute("reservaUID", reservaUID)
                                    const contenedorInformacion = document.createElement("div")
                                    contenedorInformacion.classList.add("contenedorInformacion")
                                    const contenedorDatos = document.createElement("div")
                                    contenedorDatos.classList.add("contenedorDatos")
                                    const tituloReserva = document.createElement("p")
                                    tituloReserva.classList.add("dato")
                                    tituloReserva.innerText = "Reserva:"
                                    contenedorDatos.appendChild(tituloReserva)
                                    const numeroReserva = document.createElement("p")
                                    numeroReserva.classList.add("dato")
                                    numeroReserva.classList.add("negrita")
                                    numeroReserva.innerText = reservaUID
                                    contenedorDatos.appendChild(numeroReserva)
                                    const tituloFechaReserva = document.createElement("p")
                                    tituloFechaReserva.classList.add("dato")
                                    tituloFechaReserva.innerText = "Fecha de realizaciÃ³n UTC:"
                                    contenedorDatos.appendChild(tituloFechaReserva)
                                    const fechaReserva = document.createElement("p")
                                    fechaReserva.classList.add("dato")
                                    fechaReserva.classList.add("negrita")
                                    fechaReserva.innerText = fechaCreacion_ISO
                                    contenedorDatos.appendChild(fechaReserva)
                                    const tituloTotalReserva = document.createElement("p")
                                    tituloTotalReserva.classList.add("dato")
                                    tituloTotalReserva.innerText = "Total:"
                                    contenedorDatos.appendChild(tituloTotalReserva)
                                    const totalReserva = document.createElement("p")
                                    totalReserva.classList.add("negrita")
                                    totalReserva.classList.add("dato")
                                    totalReserva.innerText = totalConImpuestos
                                    contenedorDatos.appendChild(totalReserva)
                                    contenedorInformacion.appendChild(contenedorDatos)
                                    const contenedorFechas = document.createElement("div")
                                    contenedorFechas.classList.add("contenedorFechas")
                                    const contenedorFechaEntrada = document.createElement("div")
                                    contenedorFechaEntrada.classList.add("contenedorFechaEntrada")
                                    const tituloFechaEntrada = document.createElement("div")
                                    tituloFechaEntrada.classList.add("tituloFecha")
                                    tituloFechaEntrada.innerText = "Fecha de entrada"
                                    contenedorFechaEntrada.appendChild(tituloFechaEntrada)
                                    const fechaEntrada_div = document.createElement("div")
                                    fechaEntrada_div.classList.add("fechaEntrada")
                                    fechaEntrada_div.innerText = fechaEntrada
                                    contenedorFechaEntrada.appendChild(fechaEntrada_div)
                                    contenedorFechas.appendChild(contenedorFechaEntrada)
                                    const contenedorFechaSalida = document.createElement("div")
                                    contenedorFechaSalida.classList.add("contenedorFechaSalida")
                                    const tituloFechaSalida = document.createElement("div")
                                    tituloFechaSalida.classList.add("tituloFecha")
                                    tituloFechaSalida.innerText = "Fecha de salida"
                                    contenedorFechaSalida.appendChild(tituloFechaSalida)
                                    const fechaSalida_div = document.createElement("div")
                                    fechaSalida_div.classList.add("fechaSalida")
                                    fechaSalida_div.innerText = fechaSalida
                                    contenedorFechaSalida.appendChild(fechaSalida_div)
                                    contenedorFechas.appendChild(contenedorFechaSalida)
                                    contenedorInformacion.appendChild(contenedorFechas)


                                    const contenedorTitularUI = document.createElement("div")
                                    contenedorTitularUI.classList.add(
                                        "flexVertical",
                                        "padding12"
                                    )
                                    contenedorInformacion.appendChild(contenedorTitularUI)

                                    if (Object.keys(contenedorTitular).length === 0) {
                                        const info = document.createElement("div")
                                        info.innerText = "Reserva sin titular asignado"
                                        contenedorTitularUI.appendChild(info)
                                    } else {
                                        const nombreTitularUI = document.createElement("div")
                                        nombreTitularUI.classList.add(
                                            "negrita"
                                        )
                                        nombreTitularUI.innerText = nombreTitular
                                        contenedorTitularUI.appendChild(nombreTitularUI)

                                        const pasaporteTitularUI = document.createElement("div")
                                        pasaporteTitularUI.innerText = pasaporteTitular
                                        contenedorTitularUI.appendChild(pasaporteTitularUI)

                                        if (tipoTitularIDV === "titularPool") {
                                            const tipoTitularUI = document.createElement("div")
                                            tipoTitularUI.innerText = ">>> Pendiente de verificaciÃ³n documental"
                                            contenedorTitularUI.appendChild(tipoTitularUI)

                                        }
                                    }



                                    contenedorReserva.appendChild(contenedorInformacion)
                                    const contenedorBotones = document.createElement("div")
                                    contenedorBotones.classList.add("contenedorBotones")
                                    const botonInsertarPago = document.createElement("a")
                                    botonInsertarPago.classList.add("boton")
                                    botonInsertarPago.innerText = "Ir a la reserva"
                                    botonInsertarPago.setAttribute("href", `/administracion/reservas/reserva:${reservaUID}`)
                                    botonInsertarPago.setAttribute("vista", `/administracion/reservas/reserva:${reservaUID}`)
                                    botonInsertarPago.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                    contenedorBotones.appendChild(botonInsertarPago)
                                    contenedorReserva.appendChild(contenedorBotones)
                                    espacioReservasPendientes.appendChild(contenedorReserva)
                                }
                            }
                        }
                    }
                },
                componentes: {
                    infoSinReservas: (instanciaUID) => {
                        const espacioReservasPendientes = document.querySelector(`main[instanciaUID="${instanciaUID}"]`).querySelector("[componente=espacioReservasPendientesDeRevision]")
                        if (espacioReservasPendientes) {
                            const info = document.createElement("div")
                            info.classList.add("info")
                            info.innerText = "No hay reservas pendientes de revisiÃ³n, actualiza la pÃ¡gina para comprobar de nuevo."
                            espacioReservasPendientes.appendChild(info)
                        }
                    }
                }
            }
        },
        administracion: {
            arranque: () => {

                const html = document.querySelector("html")
                html.style.height = "100%"
                const main = document.querySelector("main")
                main.setAttribute("zonaCSS", "administracion")

                const menu = main.querySelector("[contenedor=menu]")
                menu.style.flex = "1"
                const botones = document.querySelectorAll("[componente=botonAdministracion]")
                botones.forEach((boton) => {
                    boton.addEventListener("click", (boton) => {
                        boton.preventDefault()
                        const vista = boton.target.getAttribute("vista")
                        const navegacion = {
                            vista: vista,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    })
                })
            },
        },
        situacion: {
            arranque: async () => {
                const main = document.querySelector("main")
                main.setAttribute("zonaCSS", "administracion/situacion")
                const seccionRenderizadaOrigen = document.querySelector("main")
                const instanciaUID = seccionRenderizadaOrigen.getAttribute("instanciaUID")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const directorioUltimo = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                const marcoElastico = document.querySelector("[componente=marcoElastico]")
                const horaLocalPeticion = {
                    zona: "componentes/fechaLocal"
                }
                const respuestaServidor = await casaVitini.shell.servidor(horaLocalPeticion)
                if (respuestaServidor?.error) {
                    casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor.fechaISO) {
                    const zonaHoraria = respuestaServidor.zonaHoraria
                    const dia = respuestaServidor.dia
                    const mes = respuestaServidor.mes
                    const ano = respuestaServidor.ano
                    const hora = respuestaServidor.hora
                    const minuto = String(respuestaServidor.minuto).padStart(2, "0")
                    const fechaISO = respuestaServidor.fechaISO
                    const fechaUI = `Hoy son las ${hora}:${minuto}, ${dia} del ${mes} del ${ano}`
                    const contenedorFecha = document.createElement("div")
                    contenedorFecha.classList.add("adminitracion_situacion_portada_contenedorFecha")
                    contenedorFecha.innerText = fechaUI
                    marcoElastico.appendChild(contenedorFecha)
                }
                if (directorioUltimo === "situacion") {
                    const mensajeSpinner = "Obteniendo situaciÃ³n..."
                    const spinner = casaVitini.ui.componentes.spinnerSimple(mensajeSpinner)
                    const contenedorCarga = document.createElement("div")
                    contenedorCarga.classList.add("administracion_calendario_componente_calendario_contenedoCarga")
                    contenedorCarga.setAttribute("contenedor", "obteniendoSituacion")
                    //contenedorCarga.setAttribute("elemento", "flotante")
                    contenedorCarga.appendChild(spinner)
                    marcoElastico.appendChild(contenedorCarga)
                    const transaccion = {
                        zona: "administracion/situacion/obtenerSituacion"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.querySelector("[contenedor=obteniendoSituacion]").remove()
                    if (respuestaServidor?.error) {
                        casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                        const titulo = document.querySelector(".titulo")
                        titulo.innerText = respuestaServidor.error

                    }
                    if (respuestaServidor?.ok) {
                        const situacion = respuestaServidor?.ok
                        const fechaTZ = respuestaServidor.fechaTZ
                        const horaTZ = respuestaServidor.horaTZ
                        const horaEntrada = respuestaServidor.horaEntrada
                        const horaSalida = respuestaServidor.horaSalida
                        const espacioSituacion = document.createElement("div")
                        espacioSituacion.classList.add("espacioSituacion")
                        espacioSituacion.setAttribute("componente", "espacioSituacion")
                        for (const [apartamentoIDV, detallesApartamento] of Object.entries(situacion)) {
                            const reservas = detallesApartamento.reservas
                            let estadoApartamento = detallesApartamento.estadoApartamento
                            let estadoPernoctacion = detallesApartamento.estadoPernoctacion
                            const zonaIDV = detallesApartamento.zonaIDV

                            const calendariosSincronizados = detallesApartamento?.calendariosSincronizados || {}
                            if (estadoApartamento === "disponible") {
                                estadoApartamento = "Disponible"
                            }
                            if (estadoApartamento === "nodisponible") {
                                estadoApartamento = "No disponible"
                            }
                            if (estadoPernoctacion === "ocupado") {
                                estadoPernoctacion = "Ocupado"
                            }
                            if (estadoPernoctacion === "libre") {
                                estadoPernoctacion = "Libre"
                            }

                            const zonaUI = {
                                privada: "Zona privada",
                                global: "Zona global",
                                publica: "Zona pÃºblica"
                            }
                            const apartamentoUI = document.createElement("div")
                            apartamentoUI.classList.add("situacionApartamentoUI")
                            const apartamentoTitulo = document.createElement("a")
                            apartamentoTitulo.classList.add("situacionApartamentoTitutlo")
                            apartamentoTitulo.innerText = detallesApartamento.apartamentoUI
                            apartamentoTitulo.setAttribute("vista", `/administracion/situacion/${apartamentoIDV}`)
                            apartamentoTitulo.setAttribute("href", `/administracion/situacion/${apartamentoIDV}`)
                            apartamentoTitulo.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                            apartamentoUI.appendChild(apartamentoTitulo)
                            const apartamentoEstado = document.createElement("p")
                            apartamentoEstado.classList.add("situacionApartamentoEstado")
                            apartamentoEstado.innerText = estadoApartamento
                            apartamentoUI.appendChild(apartamentoEstado)
                            const apartamentoZona = document.createElement("p")
                            apartamentoZona.classList.add("situacionApartamentoEstado")
                            apartamentoZona.innerText = zonaUI[zonaIDV]
                            apartamentoUI.appendChild(apartamentoZona)
                            const apartamentoEstadoPernoctacion = document.createElement("p")
                            apartamentoEstadoPernoctacion.classList.add("situacionApartamentoEstadoPernoctacion")
                            apartamentoEstadoPernoctacion.innerText = estadoPernoctacion
                            apartamentoUI.appendChild(apartamentoEstadoPernoctacion)
                            for (const detallesReservas of reservas) {
                                const reservaUID = detallesReservas.reserva
                                const diaLimite = detallesReservas.diaLimite
                                const fechaEntrada = detallesReservas.fechaEntrada
                                const fechaSalida = detallesReservas.fechaSalida
                                const porcentajeTranscurrido = detallesReservas.porcentajeTranscurrido
                                const tiempoRestante = detallesReservas.tiempoRestante
                                const numeroDiasReserva = detallesReservas.numeroDiasReserva
                                const contenedorReserva = document.createElement("div")
                                contenedorReserva.classList.add("administracion_situacion_portada_contenedorReserva")
                                let bloqueEntidad = document.createElement("a")
                                bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                bloqueEntidad.setAttribute("vista", `/administracion/reservas/reserva:${reservaUID}`)
                                bloqueEntidad.setAttribute("href", `/administracion/reservas/reserva:${reservaUID}`)
                                bloqueEntidad.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)

                                bloqueEntidad.classList.add("administracion_situacion_portada_contenedorSelecccionable")
                                let tituloEntidad = document.createElement("div")
                                tituloEntidad.classList.add("administracion_situacion_portada_tituloEntidad")
                                tituloEntidad.innerText = "Reserva"
                                bloqueEntidad.appendChild(tituloEntidad)
                                let apartamentoReserva = document.createElement("a")
                                apartamentoReserva.classList.add("adminsitracion_situacion_portada_datoEntidad")
                                apartamentoReserva.innerText = reservaUID
                                bloqueEntidad.appendChild(apartamentoReserva)
                                contenedorReserva.appendChild(bloqueEntidad)
                                if (diaLimite === "diaDeSalida") {
                                    let bloqueEntidad = document.createElement("div")
                                    bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                    const aviso = document.createElement("div")
                                    aviso.classList.add("administracion_situacion_portada_tituloEntidad")
                                    aviso.classList.add("negrita")
                                    aviso.innerText = "<<< Dia de salida"
                                    bloqueEntidad.appendChild(aviso)
                                    const tituloEntidad = document.createElement("div")
                                    tituloEntidad.classList.add("administracion_situacion_portada_tituloEntidad")
                                    tituloEntidad.innerText = "Hoy es el dÃ­a final de la reserva y los pernoctantes deben de abandonar el alojamiento antes de las " + horaSalida
                                    bloqueEntidad.appendChild(tituloEntidad)
                                    const datoEntidad = document.createElement("div")
                                    datoEntidad.classList.add("adminsitracion_situacion_portada_datoEntidad")
                                    datoEntidad.innerText = tiempoRestante
                                    //bloqueEntidad.appendChild(datoEntidad)
                                    contenedorReserva.appendChild(bloqueEntidad)
                                }
                                if (diaLimite === "diaDeEntrada") {
                                    let bloqueEntidad = document.createElement("div")
                                    bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                    const aviso = document.createElement("div")
                                    aviso.classList.add("administracion_situacion_portada_tituloEntidad")
                                    aviso.classList.add("negrita")
                                    aviso.innerText = ">>> Dia de entrada"
                                    bloqueEntidad.appendChild(aviso)
                                    const tituloEntidad = document.createElement("div")
                                    tituloEntidad.classList.add("administracion_situacion_portada_tituloEntidad")
                                    tituloEntidad.innerText = "Hoy es el dÃ­a de entrada de la reserva y el alojamiento debe de estar preparado antes de las " + horaEntrada + " para la llegada de los nuevos pernoctantes"
                                    bloqueEntidad.appendChild(tituloEntidad)
                                    const datoEntidad = document.createElement("div")
                                    datoEntidad.classList.add("adminsitracion_situacion_portada_datoEntidad")
                                    datoEntidad.innerText = tiempoRestante
                                    //bloqueEntidad.appendChild(datoEntidad)
                                    contenedorReserva.appendChild(bloqueEntidad)
                                }
                                const contenedorFechas = document.createElement("div")
                                contenedorFechas.classList.add("administracion_situacion_portada_contenedorFechas")
                                bloqueEntidad = document.createElement("div")
                                bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                tituloEntidad = document.createElement("div")
                                tituloEntidad.classList.add("administracion_situacion_portada_tituloEntidad")
                                tituloEntidad.innerText = "Fecha de entrada"
                                bloqueEntidad.appendChild(tituloEntidad)
                                let apartamentoFechaEntrada = document.createElement("div")
                                apartamentoFechaEntrada.classList.add("adminsitracion_situacion_portada_datoEntidad")
                                apartamentoFechaEntrada.innerText = fechaEntrada
                                bloqueEntidad.appendChild(apartamentoFechaEntrada)
                                contenedorFechas.appendChild(bloqueEntidad)
                                bloqueEntidad = document.createElement("div")
                                bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                bloqueEntidad.classList.add("administracion_situacion_portada_fechaDeSalida")
                                tituloEntidad = document.createElement("div")
                                tituloEntidad.classList.add("administracion_situacion_portada_tituloEntidad")
                                tituloEntidad.innerText = "Fecha de salida"
                                bloqueEntidad.appendChild(tituloEntidad)
                                let apartamentoFechaSalida = document.createElement("div")
                                apartamentoFechaSalida.classList.add("adminsitracion_situacion_portada_datoEntidad")
                                apartamentoFechaSalida.innerText = fechaSalida
                                bloqueEntidad.appendChild(apartamentoFechaSalida)
                                contenedorFechas.appendChild(bloqueEntidad)
                                contenedorReserva.appendChild(contenedorFechas)
                                bloqueEntidad = document.createElement("div")
                                bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                let apartamentoEstadoReserva = document.createElement("div")
                                apartamentoEstadoReserva.classList.add("situacionApartamentoEstadoReserva")



                                const nombreClaseDinamica = `barraProgresso-anchoDinamico-${reservaUID}`;
                                if (!document.querySelector(`.${nombreClaseDinamica}`)) {
                                    // Si no existe, crea un nuevo estilo
                                    const style = document.createElement('style');
                                    style.innerHTML = `
                                        .${nombreClaseDinamica} {
                                            width: ${porcentajeTranscurrido}
                                    `;
                                    document.querySelector("main").appendChild(style);
                                }

                                let barraProgresso = document.createElement("div")
                                barraProgresso.classList.add(
                                    "situacionBarraProgressoReserva",
                                    nombreClaseDinamica
                                )
                                //barraProgresso.style.width = porcentajeTranscurrido
                                apartamentoEstadoReserva.appendChild(barraProgresso)
                                bloqueEntidad.appendChild(apartamentoEstadoReserva)
                                contenedorReserva.appendChild(bloqueEntidad)
                                bloqueEntidad = document.createElement("div")
                                bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                tituloEntidad = document.createElement("div")
                                tituloEntidad.classList.add("administracion_situacion_portada_tituloEntidad")
                                tituloEntidad.innerText = "DuraciÃ³n de la reserva"
                                bloqueEntidad.appendChild(tituloEntidad)
                                let datoEntidad = document.createElement("div")
                                datoEntidad.classList.add("adminsitracion_situacion_portada_datoEntidad")
                                datoEntidad.innerText = numeroDiasReserva
                                bloqueEntidad.appendChild(datoEntidad)
                                contenedorReserva.appendChild(bloqueEntidad)
                                bloqueEntidad = document.createElement("div")
                                bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                tituloEntidad = document.createElement("div")
                                tituloEntidad.classList.add("administracion_situacion_portada_tituloEntidad")
                                tituloEntidad.innerText = "Tiempo restante de la reserva"
                                bloqueEntidad.appendChild(tituloEntidad)
                                datoEntidad = document.createElement("div")
                                datoEntidad.classList.add("adminsitracion_situacion_portada_datoEntidad")
                                datoEntidad.innerText = tiempoRestante
                                bloqueEntidad.appendChild(datoEntidad)
                                contenedorReserva.appendChild(bloqueEntidad)
                                apartamentoUI.appendChild(contenedorReserva)
                            }
                            if (calendariosSincronizados.airbnb) {
                                const eventosAirbnb = calendariosSincronizados.airbnb.eventos
                                for (const detallesDelEvento of eventosAirbnb) {
                                    const fechaInicio_ISO = detallesDelEvento.fechaInicio
                                    const fechaFinal_ISO = detallesDelEvento.fechaFinal
                                    const uid = detallesDelEvento.uid
                                    const descripcion = detallesDelEvento?.descripcion || null
                                    const nombreEvento = detallesDelEvento.nombreEvento
                                    const fechaInicioArray = fechaInicio_ISO.split("-")
                                    const fechaInicio_Humano = `${fechaInicioArray[2]}/${fechaInicioArray[1]}/${fechaInicioArray[0]}`
                                    const fechaFinalArray = fechaFinal_ISO.split("-")
                                    const fechaFinal_Humano = `${fechaFinalArray[2]}/${fechaFinalArray[1]}/${fechaFinalArray[0]}`
                                    let urlEvento
                                    if (descripcion) {
                                        const regex = /Reservation URL: (https:\/\/www\.airbnb\.com\/hosting\/reservations\/details\/[A-Za-z0-9]+)/;
                                        const match = descripcion.match(regex);
                                        urlEvento = match?.[1] ?? "No se encontrÃ³ la URL en el texto proporcionado.";
                                    }
                                    const contenedorEvento = document.createElement("div")
                                    contenedorEvento.classList.add("contenedorEvento")
                                    const contenedorTitulo = document.createElement("div")
                                    contenedorTitulo.classList.add("contenedorTitulo")
                                    const tituloPlataformaOrigen = document.createElement("p")
                                    tituloPlataformaOrigen.classList.add("tituloPlataformaOrigen")
                                    tituloPlataformaOrigen.innerText = "Evento de Airbnb"
                                    contenedorTitulo.appendChild(tituloPlataformaOrigen)
                                    const descripcionEvento = document.createElement("p")
                                    descripcionEvento.classList.add("descripcionEvento")
                                    descripcionEvento.innerText = "Este evento proviene de un calendario sincronizado con Airbnb.Para ver los detalles de este evento, pulsa en el botÃ³n inferior que le permitirÃ¡ ir directamente a los detalles del evento en la web de Airbnb."
                                    contenedorTitulo.appendChild(descripcionEvento)
                                    contenedorEvento.appendChild(contenedorTitulo)
                                    const contenedorFechas = document.createElement("div")
                                    contenedorFechas.classList.add("contenedorFechas")
                                    const contenedorFechaInicio = document.createElement("div")
                                    contenedorFechaInicio.classList.add("contenedorFecha_")
                                    const tituloFechaInicio = document.createElement("p")
                                    tituloFechaInicio.classList.add("tituloFecha")
                                    tituloFechaInicio.innerText = "Fecha de inicio"
                                    const fechaInicioUI = document.createElement("p")
                                    fechaInicioUI.classList.add("fechaDatoUI")
                                    fechaInicioUI.innerText = fechaInicio_Humano
                                    contenedorFechaInicio.appendChild(tituloFechaInicio)
                                    contenedorFechaInicio.appendChild(fechaInicioUI)
                                    contenedorFechas.appendChild(contenedorFechaInicio)
                                    const contenedorFechaFin = document.createElement("div")
                                    contenedorFechaFin.classList.add("contenedorFecha_")
                                    const tituloFechaFin = document.createElement("p")
                                    tituloFechaFin.classList.add("tituloFecha")
                                    tituloFechaFin.innerText = "Fecha fin"
                                    const fechaFinUI = document.createElement("p")
                                    fechaFinUI.classList.add("fechaDatoUI")
                                    fechaFinUI.innerText = fechaFinal_Humano
                                    contenedorFechaFin.appendChild(tituloFechaFin)
                                    contenedorFechaFin.appendChild(fechaFinUI)
                                    contenedorFechas.appendChild(contenedorFechaFin)
                                    contenedorEvento.appendChild(contenedorFechas)
                                    if (descripcion) {
                                        const botonIrAlEvento = document.createElement("a")
                                        botonIrAlEvento.classList.add("botonIrAlEvento")
                                        botonIrAlEvento.href = urlEvento
                                        botonIrAlEvento.innerText = "Abrir evento. (Se ira a la web de Airbnb)"
                                        contenedorEvento.appendChild(botonIrAlEvento)
                                    } else {
                                        const botonIrAlEvento = document.createElement("div")
                                        botonIrAlEvento.classList.add("sinInfo")
                                        botonIrAlEvento.innerText = "Airbnb no proporciona ninguna informaciÃ³n sobre este evento.Probablemente, este evento sea de un calendario que Airbnb ha sincronizado con otra plataforma.Para ver mÃ¡s informaciÃ³n de este evento, por favor dirÃ­jase a la web de Airbnb porque Airbnb no proporciona ninguna forma de enlazar este evento."
                                        contenedorEvento.appendChild(botonIrAlEvento)
                                    }
                                    apartamentoUI.appendChild(contenedorEvento)
                                }
                            }
                            espacioSituacion.appendChild(apartamentoUI)
                        }
                        marcoElastico.appendChild(espacioSituacion)
                    }
                } else {
                    const mensajeSpinner = "Obteniendo situaciÃ³n..."
                    const spinner = casaVitini.ui.componentes.spinnerSimple(mensajeSpinner)
                    const contenedorCarga = document.createElement("div")
                    contenedorCarga.classList.add("administracion_calendario_componente_calendario_contenedoCarga")
                    contenedorCarga.setAttribute("contenedor", "obteniendoSituacion")
                    //contenedorCarga.setAttribute("elemento", "flotante")
                    contenedorCarga.appendChild(spinner)
                    marcoElastico.appendChild(contenedorCarga)
                    const transaccion = {
                        zona: "administracion/situacion/detallesSituacionApartamento",
                        apartamentoIDV: directorioUltimo
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.querySelector("[contenedor=obteniendoSituacion]").remove()
                    if (respuestaServidor?.error) {
                        const info = {
                            titulo: "No existe el identificador del apartamento",
                            descripcion: "EstÃ¡s buscando la situaciÃ³n de un apartamento que no existe o existe y no tiene una configuraciÃ³n disponible."
                        }
                        casaVitini.ui.componentes.mensajeSimple(info)
                    }
                    if (respuestaServidor?.ok) {
                        const detallesApartamento = respuestaServidor?.ok
                        const apartamentoUI = detallesApartamento.apartamentoUI
                        const apartamentoIDV = detallesApartamento.apartamentoIDV
                        const zonaHoraria = detallesApartamento.zonaHoraria
                        const horaEntradaTZ = detallesApartamento.horaEntradaTZ
                        const zonaIDV = detallesApartamento.zonaIDV
                        const horaSalidaTZ = detallesApartamento.horaSalidaTZ
                        let estadoPernoctacion = detallesApartamento.estadoPernoctacion
                        const reservas = detallesApartamento.reservas
                        const calendariosSincronizados = detallesApartamento.calendariosSincronizados
                        const espacioEventosAirbnb = document.createElement("div")
                        espacioEventosAirbnb.classList.add("espacioEventosAirbnb")
                        espacioEventosAirbnb.setAttribute("componente", "espacioEventosAirbnb")
                        if (estadoPernoctacion === "ocupado") {
                            estadoPernoctacion = "Ocupado"
                        }
                        if (estadoPernoctacion === "libre") {
                            estadoPernoctacion = "Libre"
                        }

                        const zonaUI = {
                            privada: "Zona privada",
                            global: "Zona global",
                            publica: "Zona pÃºblica"
                        }
                        let espacioSituacionDetallesApartamento = document.createElement("div")
                        espacioSituacionDetallesApartamento.classList.add("espacioSituacionDetallesApartamento")
                        espacioSituacionDetallesApartamento.setAttribute("componente", "espacioSituacionDetallesApartamento")
                        let detallesGenerales = document.createElement("div")
                        detallesGenerales.classList.add("situacionDetallesGenerales")
                        let detallesReserva = document.createElement("div")
                        detallesReserva.classList.add("situacionDetallesReserva")
                        let bloqueApartamentoUI = document.createElement("div")
                        bloqueApartamentoUI.classList.add("situacionDetallesbloqueApartamentoUI")
                        let tituloApartamentoUI = document.createElement("div")
                        tituloApartamentoUI.classList.add("situacionDetallesApartmentoTitulo")
                        tituloApartamentoUI.innerText = apartamentoUI
                        bloqueApartamentoUI.appendChild(tituloApartamentoUI)
                        let bloqueEstado = document.createElement("div")
                        bloqueEstado.classList.add("situacionDetalleBloqueSimpleInterno")
                        let titutloEstadoApartamentoUI = document.createElement("div")
                        titutloEstadoApartamentoUI.classList.add("situacionDetalleTituloBloqueSimple")
                        titutloEstadoApartamentoUI.innerText = "Estado"
                        bloqueEstado.appendChild(titutloEstadoApartamentoUI)
                        let estadoApartamentoUI = document.createElement("div")
                        estadoApartamentoUI.classList.add("situacionDetallesEstadoApartamento")
                        estadoApartamentoUI.innerText = "estadoApartamento"
                        bloqueEstado.appendChild(estadoApartamentoUI)
                        //bloqueApartamentoUI.appendChild(bloqueEstado)
                        let estadoPernoctacionUI = document.createElement("div")
                        estadoPernoctacionUI.classList.add("situacionDetallesEstadoPernoctacion")
                        estadoPernoctacionUI.innerText = estadoPernoctacion
                        bloqueApartamentoUI.appendChild(estadoPernoctacionUI)
                        let zona = document.createElement("div")
                        zona.classList.add("situacionDetallesEstadoPernoctacion")
                        zona.innerText = zonaUI[zonaIDV]
                        bloqueApartamentoUI.appendChild(zona)
                        detallesGenerales.appendChild(bloqueApartamentoUI)
                        marcoElastico.appendChild(detallesGenerales)
                        for (const [reservaUID, detallesReservas] of Object.entries(reservas)) {
                            const reservaUID = detallesReservas.reservaUID
                            const fechaEntrada = detallesReservas.fechaEntrada
                            const fechaSalida = detallesReservas.fechaSalida
                            const diaLimite = detallesReservas.diaLimite
                            const tiempoRestante = detallesReservas.tiempoRestante
                            const cantidadDias = detallesReservas.cantidadDias
                            const pernoctantes = detallesReservas.pernoctantes
                            const porcentajeTranscurrido = detallesReservas.porcentajeTranscurrido
                            const habitaciones = detallesReservas.habitaciones
                            const bloqueReservaUI = document.createElement("div")
                            bloqueReservaUI.classList.add("administracion_situracion_detallesApartamento_bloqueReserva")
                            const reservaUI = document.createElement("a")
                            reservaUI.classList.add(
                                "administracion_situracion_detallesApartamento_reservaUI",
                                "textoElipsis"
                            )
                            reservaUI.setAttribute("vista", `/administracion/reservas/reserva:${reservaUID}`)
                            reservaUI.setAttribute("href", `/administracion/reservas/reserva:${reservaUID}`)
                            reservaUI.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)

                            reservaUI.innerText = "Reserva " + reservaUID
                            bloqueReservaUI.appendChild(reservaUI)
                            if (diaLimite === "diaDeSalida") {
                                const bloqueEntidad = document.createElement("div")
                                bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                const aviso = document.createElement("div")
                                aviso.classList.add("administracion_situacion_portada_tituloEntidad")
                                aviso.classList.add("negrita")
                                aviso.innerText = "<<< Dia de salida"
                                bloqueEntidad.appendChild(aviso)
                                const tituloEntidad = document.createElement("div")
                                tituloEntidad.classList.add("administracion_situacion_portada_tituloEntidad")
                                tituloEntidad.innerText = "Hoy es el dÃ­a final de la reserva y los pernoctantes deben de abandonar el alojamiento antes de las  " + horaSalidaTZ
                                bloqueEntidad.appendChild(tituloEntidad)
                                const datoEntidad = document.createElement("div")
                                datoEntidad.classList.add("adminsitracion_situacion_portada_datoEntidad")
                                datoEntidad.innerText = tiempoRestante
                                //bloqueEntidad.appendChild(datoEntidad)
                                bloqueReservaUI.appendChild(bloqueEntidad)
                            }
                            if (diaLimite === "diaDeEntrada") {
                                const bloqueEntidad = document.createElement("div")
                                bloqueEntidad.classList.add("administracion_situacion_portada_bloqueEntidad")
                                const aviso = document.createElement("div")
                                aviso.classList.add("administracion_situacion_portada_tituloEntidad")
                                aviso.classList.add("negrita")
                                aviso.innerText = ">>> Dia de entrada"
                                bloqueEntidad.appendChild(aviso)
                                const tituloEntidad = document.createElement("div")
                                tituloEntidad.classList.add("administracion_situacion_portada_tituloEntidad")
                                tituloEntidad.innerText = "Hoy es el dÃ­a de entrada de la reserva y el alojamiento debe de estar preparado antes de las " + horaEntradaTZ + " para la llegada de los nuevos pernoctantes"
                                bloqueEntidad.appendChild(tituloEntidad)
                                const datoEntidad = document.createElement("div")
                                datoEntidad.classList.add("adminsitracion_situacion_portada_datoEntidad")
                                datoEntidad.innerText = tiempoRestante
                                //bloqueEntidad.appendChild(datoEntidad)
                                bloqueReservaUI.appendChild(bloqueEntidad)
                            }
                            const apartamentoEstadoReserva = document.createElement("div")
                            apartamentoEstadoReserva.classList.add("situacionApartamentoEstadoReserva")




                            const nombreClaseDinamica = `barraProgresso-anchoDinamico-${reservaUID}`;
                            if (!document.querySelector(`.${nombreClaseDinamica}`)) {
                                // Si no existe, crea un nuevo estilo
                                const style = document.createElement('style');
                                style.innerHTML = `
                                    .${nombreClaseDinamica} {
                                        width: ${porcentajeTranscurrido}
                                `;
                                document.querySelector("main").appendChild(style);
                            }

                            const barraProgresso = document.createElement("div")
                            barraProgresso.classList.add("situacionBarraProgressoReserva")
                            barraProgresso.classList.add(
                                "situacionBarraProgressoReserva",
                                nombreClaseDinamica
                            )
                            apartamentoEstadoReserva.appendChild(barraProgresso)
                            bloqueReservaUI.appendChild(apartamentoEstadoReserva)
                            const contenedorFechas = document.createElement("div")
                            contenedorFechas.classList.add("administracion_situacion_detallesApartamento_contenedorFechas")
                            const bloqueFechaEntrada = document.createElement("div")
                            bloqueFechaEntrada.classList.add("situacionDetalleBloqueSimpleExterno")
                            const fechaEntradaTitulo = document.createElement("div")
                            fechaEntradaTitulo.classList.add("situacionDetalleTituloBloqueSimple")
                            fechaEntradaTitulo.innerText = "Fecha de entrada"
                            bloqueFechaEntrada.appendChild(fechaEntradaTitulo)
                            const fechaEntradaUI = document.createElement("div")
                            fechaEntradaUI.classList.add("situacionDetallesfechaUI")
                            fechaEntradaUI.innerText = fechaEntrada
                            bloqueFechaEntrada.appendChild(fechaEntradaUI)
                            contenedorFechas.appendChild(bloqueFechaEntrada)
                            bloqueReservaUI.appendChild(contenedorFechas)
                            const bloqueFechaSalida = document.createElement("div")
                            bloqueFechaSalida.classList.add("situacionDetalleBloqueSimpleExterno")
                            const fechaSalidaTitulo = document.createElement("div")
                            fechaSalidaTitulo.classList.add("situacionDetalleTituloBloqueSimple")
                            fechaSalidaTitulo.innerText = "Fecha de salida"
                            bloqueFechaSalida.appendChild(fechaSalidaTitulo)
                            const fechaSalidaUI = document.createElement("di")
                            fechaSalidaUI.classList.add("situacionDetallesfechaUI")
                            fechaSalidaUI.innerText = fechaSalida
                            bloqueFechaSalida.appendChild(fechaSalidaUI)
                            contenedorFechas.appendChild(bloqueFechaSalida)
                            bloqueReservaUI.appendChild(contenedorFechas)
                            if (habitaciones.length > 0) {
                                const espacioHabitaciones = document.createElement("div")
                                espacioHabitaciones.classList.add("sitaucionDetallesEspacioHabitaciones")
                                for (const detallesHabitacion of habitaciones) {
                                    const habitacionUI = detallesHabitacion.habitacionUI
                                    const habitacionUID = detallesHabitacion.componenteUID
                                    //const pernoctantes = detallesHabitacion.pernoctantes
                                    const habitacionBloque = document.createElement("div")
                                    habitacionBloque.setAttribute("habitacionUID", habitacionUID)
                                    habitacionBloque.classList.add("administracion_situacion_detallesApartamento_contenedorHabitacion")
                                    const tituloHabitacion = document.createElement("p")
                                    tituloHabitacion.classList.add("situacionDetallestituloHabitacion")
                                    tituloHabitacion.innerText = habitacionUI
                                    habitacionBloque.appendChild(tituloHabitacion)

                                    espacioHabitaciones.appendChild(habitacionBloque)
                                }
                                bloqueReservaUI.appendChild(espacioHabitaciones)
                            }
                            marcoElastico.appendChild(bloqueReservaUI)
                            if (pernoctantes.length > 0) {
                                for (const pernoctante of pernoctantes) {

                                    const nombreCompleto = pernoctante.nombreCompleto
                                    const tipoPernoctante = pernoctante.tipoPernoctante
                                    const clienteUID = pernoctante.clienteUID
                                    const habitacionUID = pernoctante.habitacionUID
                                    const fechaCheckIn = pernoctante.fechaCheckIn
                                    const fechaCheckOut = pernoctante.fechaCheckOut

                                    const habitacionDestino = document.querySelector(`[habitacionUID="${habitacionUID}"]`)
                                    if (!habitacionDestino) {
                                        continue
                                    }

                                    let tipoClienteUI
                                    if (tipoPernoctante === "cliente") {
                                        tipoClienteUI = "Cliente de Casa Vitini"
                                    }
                                    if (tipoPernoctante === "clientePool") {
                                        tipoClienteUI = "Cliente por validar"
                                    }
                                    const marcoPernoctante = document.createElement("a")
                                    marcoPernoctante.classList.add("administracion_situacion_detallesApartamento_contenedorCliente")
                                    if (tipoPernoctante === "cliente") {
                                        marcoPernoctante.setAttribute("vista", `/administracion/clientes/${clienteUID}`)
                                        marcoPernoctante.setAttribute("href", `/administracion/clientes/${clienteUID}`)
                                        marcoPernoctante.addEventListener("click", casaVitini.administracion.situacion.resolutorEnlacesCliente)
                                    }
                                    marcoPernoctante.setAttribute("clienteUID", clienteUID)
                                    if (!fechaCheckIn) {
                                        const tipoPernoctanteUI = document.createElement("div")
                                        tipoPernoctanteUI.classList.add("administracion_reservas_detallesReserva_tituloCheckIn")
                                        //tipoPernoctanteUI.classList.add("parpadea")
                                        tipoPernoctanteUI.setAttribute("componente", "checkInInfo")
                                        tipoPernoctanteUI.innerText = "Pendiente de checkin"
                                        marcoPernoctante.appendChild(tipoPernoctanteUI)
                                    } else {
                                        const tipoPernoctanteUI = document.createElement("div")
                                        tipoPernoctanteUI.classList.add("administracion_reservas_detallesReserva_tituloCheckIn")
                                        //tipoPernoctanteUI.classList.add("parpadea")
                                        tipoPernoctanteUI.setAttribute("componente", "checkInInfo")
                                        tipoPernoctanteUI.innerText = "> " + fechaCheckIn
                                        marcoPernoctante.appendChild(tipoPernoctanteUI)
                                    }
                                    if (fechaCheckOut) {
                                        const tipoPernoctanteUI = document.createElement("div")
                                        tipoPernoctanteUI.classList.add("administracion_reservas_detallesReserva_tituloCheckIn")
                                        tipoPernoctanteUI.classList.add("letraRoja")
                                        tipoPernoctanteUI.setAttribute("componente", "checkOutInfo")
                                        tipoPernoctanteUI.innerText = "< " + fechaCheckOut
                                        marcoPernoctante.appendChild(tipoPernoctanteUI)
                                    }
                                    if (tipoPernoctante === "clientePool") {
                                        const tipoPernoctanteUI = document.createElement("div")
                                        tipoPernoctanteUI.classList.add("administracion_reservas_detallesReserva_tituloPendienteComprobacion")
                                        tipoPernoctanteUI.classList.add("parpadea")
                                        tipoPernoctanteUI.setAttribute("componente", "pendienteComprobacion")
                                        tipoPernoctanteUI.innerText = "Pendiente de comprobaciÃ³n documental"
                                        marcoPernoctante.appendChild(tipoPernoctanteUI)
                                    }
                                    const nombreCompletoPernoctante = document.createElement("div")
                                    nombreCompletoPernoctante.classList.add("administracion_situacion_detallesApartamento_nombrePernoctante")
                                    nombreCompletoPernoctante.innerText = nombreCompleto
                                    marcoPernoctante.appendChild(nombreCompletoPernoctante)
                                    const tipoClientePernoctante = document.createElement("div")
                                    tipoClientePernoctante.classList.add("administracion_situacion_detallesApartamento_tipoCliente")
                                    tipoClientePernoctante.innerText = tipoClienteUI
                                    marcoPernoctante.appendChild(tipoClientePernoctante)
                                    habitacionDestino.appendChild(marcoPernoctante)
                                }
                            }
                        }
                        const eventosAirbnb = calendariosSincronizados.airbnb.eventos
                        for (const detallesDelEvento of eventosAirbnb) {
                            const fechaInicio_ISO = detallesDelEvento.fechaInicio
                            const fechaFinal_ISO = detallesDelEvento.fechaFinal
                            const uid = detallesDelEvento.uid
                            const descripcion = detallesDelEvento?.descripcion || null
                            const nombreEvento = detallesDelEvento.nombreEvento
                            const fechaInicioArray = fechaInicio_ISO.split("-")
                            const fechaInicio_Humano = `${fechaInicioArray[2]}/${fechaInicioArray[1]}/${fechaInicioArray[0]}`
                            const fechaFinalArray = fechaFinal_ISO.split("-")
                            const fechaFinal_Humano = `${fechaFinalArray[2]}/${fechaFinalArray[1]}/${fechaFinalArray[0]}`
                            let urlEvento
                            if (descripcion) {
                                const regex = /Reservation URL: (https:\/\/www\.airbnb\.com\/hosting\/reservations\/details\/[A-Za-z0-9]+)/;
                                const match = descripcion.match(regex);
                                urlEvento = match?.[1] ?? "No se encontrÃ³ la URL en el texto proporcionado.";
                            }
                            const contenedorEvento = document.createElement("div")
                            contenedorEvento.classList.add("contenedorEvento")
                            const contenedorTitulo = document.createElement("div")
                            contenedorTitulo.classList.add("contenedorTitulo")
                            const tituloPlataformaOrigen = document.createElement("p")
                            tituloPlataformaOrigen.classList.add("tituloPlataformaOrigen")
                            tituloPlataformaOrigen.innerText = "Evento de Airbnb"
                            contenedorTitulo.appendChild(tituloPlataformaOrigen)
                            const descripcionEvento = document.createElement("p")
                            descripcionEvento.classList.add("descripcionEvento")
                            descripcionEvento.innerText = "Este evento proviene de un calendario sincronizado con Airbnb.Para ver los detalles de este evento pulsa en el botÃ³n inferior que le permitirÃ¡ ir directamente a los detalles del evento en la web de Airbnb."
                            contenedorTitulo.appendChild(descripcionEvento)
                            contenedorEvento.appendChild(contenedorTitulo)
                            const contenedorFechas = document.createElement("div")
                            contenedorFechas.classList.add("contenedorFechas")
                            const contenedorFechaInicio = document.createElement("div")
                            contenedorFechaInicio.classList.add("contenedorFecha_")
                            const tituloFechaInicio = document.createElement("p")
                            tituloFechaInicio.classList.add("tituloFecha")
                            tituloFechaInicio.innerText = "Fecha de inicio"
                            const fechaInicioUI = document.createElement("p")
                            fechaInicioUI.classList.add("fechaDatoUI")
                            fechaInicioUI.innerText = fechaInicio_Humano
                            contenedorFechaInicio.appendChild(tituloFechaInicio)
                            contenedorFechaInicio.appendChild(fechaInicioUI)
                            contenedorFechas.appendChild(contenedorFechaInicio)
                            const contenedorFechaFin = document.createElement("div")
                            contenedorFechaFin.classList.add("contenedorFecha_")
                            const tituloFechaFin = document.createElement("p")
                            tituloFechaFin.classList.add("tituloFecha")
                            tituloFechaFin.innerText = "Fecha fin"
                            const fechaFinUI = document.createElement("p")
                            fechaFinUI.classList.add("fechaDatoUI")
                            fechaFinUI.innerText = fechaFinal_Humano
                            contenedorFechaFin.appendChild(tituloFechaFin)
                            contenedorFechaFin.appendChild(fechaFinUI)
                            contenedorFechas.appendChild(contenedorFechaFin)
                            contenedorEvento.appendChild(contenedorFechas)
                            if (descripcion) {
                                const botonIrAlEvento = document.createElement("a")
                                botonIrAlEvento.classList.add("botonIrAlEvento")
                                botonIrAlEvento.href = urlEvento
                                botonIrAlEvento.innerText = "Abrir evento. (Se irÃ¡ a la web de Airbnb)"
                                contenedorEvento.appendChild(botonIrAlEvento)
                            } else {
                                const botonIrAlEvento = document.createElement("div")
                                botonIrAlEvento.classList.add("sinInfo")
                                botonIrAlEvento.innerText = "Airbnb no proporciona ninguna informaciÃ³n sobre este evento.Probablemente, este evento sea de un calendario que Airbnb ha sincronizado con otra plataforma.Para ver mÃ¡s informaciÃ³n de este evento por favor dirÃ­jase a la web de Airbnb porque Airbnb no proporciona ninguna forma de enlazar este evento."
                                contenedorEvento.appendChild(botonIrAlEvento)
                            }
                            espacioEventosAirbnb.appendChild(contenedorEvento)
                        }
                        marcoElastico.appendChild(espacioEventosAirbnb)
                        /*
                                            for (const [habitacionIDV, detallesHabitacion] of Object.entries(habitaciones)) {
                         
                                                let habitacionUI = detallesHabitacion.habitacionUI
                                                let pernoctantes = detallesHabitacion.pernoctantes
                         
                                                let habitacionBloque = document.createElement("div")
                                                habitacionBloque.classList.add("situacionDetallesHabitacionBloque")
                         
                         
                                                let tituloHabitacion = document.createElement("p")
                                                tituloHabitacion.classList.add("situacionDetallestituloHabitacion")
                                                tituloHabitacion.innerText = habitacionUI
                                                habitacionBloque.appendChild(tituloHabitacion)
                         
                                                if (pernoctantes) {
                                                    for (const pernoctante of pernoctantes) {
                                                        let nombreCompleto = pernoctante.nombreCompleto
                                                        let tipoCliente = pernoctante.tipoPernoctante
                                                        let uidCliente = pernoctante.uidCliente
                         
                                                        let marcoPernoctante = document.createElement("div")
                                                        marcoPernoctante.classList.add("situacionDetallesMarcoPernoctante")
                                                        marcoPernoctante.setAttribute("clienteUID", uidCliente)
                                                        habitacionBloque.appendChild(marcoPernoctante)
                         
                         
                                                        let nombreCompletoPernoctante = document.createElement("p")
                                                        nombreCompletoPernoctante.classList.add("situacionDetallesNombreCompletoPernoctante")
                                                        nombreCompletoPernoctante.innerText = nombreCompleto
                                                        habitacionBloque.appendChild(nombreCompletoPernoctante)
                         
                         
                                                        let tipoClientePernoctante = document.createElement("p")
                                                        tipoClientePernoctante.classList.add("situacionDetallesTipoClientePernoctante")
                                                        tipoClientePernoctante.innerText = tipoCliente
                                                        habitacionBloque.appendChild(tipoClientePernoctante)
                         
                                                    }
                                                }
                         
                         
                         
                         
                         
                                                espacioHabitaciones.appendChild(habitacionBloque)
                         
                         
                         
                         
                         
                         
                         
                                            }
                                            detallesReserva.appendChild(espacioHabitaciones)*/
                        // marcoElastico.appendChild(detallesReserva)
                        const calenadariosSincronizados = detallesApartamento.calendariosSincronizados
                        const eventosAirbnb_ = calenadariosSincronizados.airbnb.eventos
                        for (const detallesDelEvento of eventosAirbnb_) {
                            /*
                                {
                            "fechaFinal": "2024-05-05",
                            "fechaInicio": "2024-03-31",
                            "uid": "1418fb94e984-26727370fa33ec474081b9bde4f2d585@airbnb.com",
                            "descripcion": "Reservation URL: https://www.airbnb.com/hosting/reservations/details/HMRS2MPY3K\nPhone Number (Last 4 Digits): 4118",
                            "nombreEvento": "Reserved"
                                }
                            */
                            const fechaInicio_ISO = detallesDelEvento.fechaInicio
                            const fechaFinal_ISO = detallesDelEvento.fechaFinal
                            const uid = detallesDelEvento.uid
                            const descripcion = detallesDelEvento?.descripcion || null
                            const nombreEvento = detallesDelEvento.nombreEvento
                            const fechaInicioArray = fechaInicio_ISO.split("-")
                            const fechaInicio_Humano = `${fechaInicioArray[2]}/${fechaInicioArray[1]}/${fechaInicioArray[0]}`
                            const fechaFinalArray = fechaFinal_ISO.split("-")
                            const fechaFinal_Humano = `${fechaFinalArray[2]}/${fechaFinalArray[1]}/${fechaFinalArray[0]}`
                            if (descripcion) {
                                const regex = /Reservation URL: (https:\/\/www\.airbnb\.com\/hosting\/reservations\/details\/[A-Za-z0-9]+)/;
                                const match = descripcion.match(regex);
                                const urlEvento = match?.[1] ?? "No se encontrÃ³ la URL en el texto proporcionado.";
                            }
                        }
                    }
                }
            },
            resolutorEnlacesCliente: (cliente) => {
                cliente.preventDefault()
                cliente.stopPropagation()
                const clienteUID = cliente.target.closest("[clienteUID]").getAttribute("clienteUID")
                const vista = "/administracion/clientes/" + clienteUID
                const navegacion = {
                    "vista": vista,
                    "tipoOrigen": "menuNavegador"
                }
                casaVitini.shell.navegacion.controladorVista(navegacion)
            }
        },
        servicios: {
            arranque: function () {
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                const main = document.querySelector("main")
                if (granuladoURL.parametros.servicio) {
                    this.detallesServicio.arranque(granuladoURL.parametros.servicio)
                } else if (comandoInicial === "servicios") {
                    this.portada.arranque()
                } else {
                    casaVitini.ui.componentes.urlDesconocida()
                }
            },
            portada: {
                arranque: function () {
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    this.contenedorBotones()
                    casaVitini.administracion.servicios.portada.mostrarServiciosResueltos(granuladoURL.parametros)

                },
                contenedorBotones: () => {
                    const espacio = document.querySelector("[componente=servicios]")
                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.classList.add("contenedorBotonesGlobales")
                    contenedorBotones.setAttribute("componente", "contenedorBotonesServicios")
                    const boton = document.createElement("a")
                    boton.classList.add("botonNuevo")
                    boton.innerText = "Crear servicio"
                    boton.setAttribute("href", "/administracion/servicios/nuevo")
                    boton.setAttribute("vista", "/administracion/servicios/nuevo")
                    boton.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    contenedorBotones.appendChild(boton)
                    espacio.appendChild(contenedorBotones)
                },
                mostrarServiciosResueltos: async function (listarServicios) {
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    const transaccion = {
                        zona: "administracion/servicios/listaServiciosPaginados",
                        origen: "url",
                        tipoConstruccionGrid: "total",
                        ...listarServicios
                    }

                    transaccion.pagina = transaccion.pagina ? Number(transaccion.pagina) : 1
                    if ((transaccion.nombre_columna)?.toLowerCase() === "servicio_uid") {
                        transaccion.nombreColumna = "servicioUID"
                        delete transaccion.nombre_columna
                    } else if ((transaccion.nombre_columna)?.toLowerCase() === "estado_idv") {
                        transaccion.nombreColumna = "estadoIDV"
                        delete transaccion.nombre_columna
                    } else if ((transaccion.nombre_columna)?.toLowerCase() === "zona_idv") {
                        transaccion.nombreColumna = "zonaIDV"
                        delete transaccion.nombre_columna
                    } else if (transaccion.nombre_columna) {
                        transaccion.nombreColumna = transaccion.nombre_columna.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                        delete transaccion.nombre_columna
                    }
                    if (transaccion.sentido_columna) {
                        transaccion.sentidoColumna = transaccion.sentido_columna
                        delete transaccion.sentido_columna
                    }
                    const origen = transaccion.origen
                    delete transaccion.origen
                    const tipoConstruccionGrid = transaccion.tipoConstruccionGrid
                    delete transaccion.tipoConstruccionGrid
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada) { return }
                    if (respuestaServidor?.error) {
                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }

                    if (respuestaServidor?.totalServicios === 0) {
                        const espacioClientes = document.querySelector("[componente=espacio]")
                        document.querySelector("[gridUID=gridServicios]")?.remove()
                        document.querySelector("[componente=estadoBusqueda]")?.remove()
                        const estadoBusquedaUI = document.createElement("div")
                        estadoBusquedaUI.classList.add("buscadorClientesEstadoBusqueda")
                        estadoBusquedaUI.setAttribute("componente", "estadoBusqueda")
                        estadoBusquedaUI.innerText = "No hay servicios configurados"
                        espacioClientes.appendChild(estadoBusquedaUI)
                        return

                    }
                    const servicios = respuestaServidor.servicios

                    const dicccionario = {
                        estados: {
                            activado: "Activado",
                            desactivado: "Desactivado"
                        }
                    }

                    for (const detallesDelServicio of servicios) {
                        const estadoIDV = detallesDelServicio.estadoIDV
                        detallesDelServicio.estadoIDV = dicccionario.estados[estadoIDV]
                    }
                    const sentidoColumna = respuestaServidor.sentidoColumna
                    const nombreColumna = respuestaServidor.nombreColumna
                    const pagina = respuestaServidor.pagina
                    const paginasTotales = respuestaServidor.paginasTotales
                    const columnasGrid = [
                        {
                            columnaUI: "UID",
                            columnaIDV: "servicioUID",
                            columnaClase: "idColumna"
                        },
                        {
                            columnaUI: "Nombre",
                            columnaIDV: "nombre",
                            columnaClase: "entradaColumna"
                        },
                        {
                            columnaUI: "Estado",
                            columnaIDV: "estadoIDV",
                            columnaClase: "salidaColuma"
                        },
                        {
                            columnaUI: "Zona",
                            columnaIDV: "zonaIDV",
                            columnaClase: "estadoColumna"
                        },
                    ]
                    const parametrosFinales = {}
                    if (pagina > 1 && paginasTotales > 1) {
                        parametrosFinales.pagina = pagina
                    }
                    if (nombreColumna) {
                        parametrosFinales.pagina = pagina
                        parametrosFinales.nombre_columna = nombreColumna.replace(/([a-z])([A-Z])/g, "$1_$2").toLowerCase();
                        parametrosFinales.sentido_columna = sentidoColumna
                    }
                    const estructuraParametrosFinales = []
                    for (const [parametroFinal, valorFinal] of Object.entries(parametrosFinales)) {
                        const estructura = `${parametroFinal}:${valorFinal}`
                        estructuraParametrosFinales.push(estructura)
                    }
                    let parametrosURLFInal = ""
                    if (estructuraParametrosFinales.length > 0) {
                        parametrosURLFInal = "/" + estructuraParametrosFinales.join("/")
                    }

                    this.selectorFiltro.ui({
                        columnas: columnasGrid,
                        columnaSeleccioanda: nombreColumna,
                        sentidoSeleccionado: sentidoColumna,
                        destino: "[contenedor=resultados]"
                    })

                    this.constructorTarjetas({
                        tarjetas: servicios,
                        destino: "[contenedor=resultados]"

                    })



                    const constructorURLFinal = granuladoURL.directoriosFusion + parametrosURLFInal
                    const metadatosGrid = {
                        filas: servicios,
                        sentidoColumna: sentidoColumna,
                        nombreColumna: nombreColumna,
                        tipoConstruccionGrid: tipoConstruccionGrid,
                        pagina: pagina,
                        destino: "[contenedor=resultados]",
                        columnasGrid: columnasGrid,
                        gridUID: "gridServicios",
                        numeroColumnas: 4,
                        metodoColumna: "casaVitini.administracion.servicios.portada.ordenarPorColumna",
                        metodoFila: "casaVitini.administracion.servicios.portada.resolverFila",
                        mascaraHref: {
                            urlStatica: "/administracion/servicios/servicio:",
                            parametro: "servicioUID"
                        },
                        //mascaraURL: constructorURLFinal
                    }
                    casaVitini.ui.componentes.grid(metadatosGrid)
                    const metadatosPaginador = {
                        paginaActual: pagina,
                        paginasTotales: paginasTotales,
                        destino: "[componente=espacio]",
                        metodoBoton: "casaVitini.administracion.servicios.portada.cambiarPagina",
                        prefijoHref: "/administracion/servicios/",
                        gridUID: "gridServicios",
                        granuladoURL: {
                            parametros: parametrosFinales,
                            directoriosFusion: granuladoURL.directoriosFusion
                        }
                    }
                    casaVitini.ui.componentes.paginador(metadatosPaginador)
                    transaccion.tipoConstruccionGrid = "soloLista"
                    const titulo = "Administrar reservas"
                    const estado = {
                        zona: constructorURLFinal,
                        EstadoInternoZona: "estado",
                        tipoCambio: "parcial",
                        componenteExistente: "contenedorBotonesServicios",
                        funcionPersonalizada: "casaVitini.administracion.servicios.portada.mostrarServiciosResueltos",
                        datosPaginacion: transaccion
                    }



                    if (origen === "url" || origen === "botonMostrarClientes") {
                        window.history.replaceState(estado, titulo, constructorURLFinal);
                    }
                    if (origen === "botonNumeroPagina" || origen === "tituloColumna") {


                        window.history.pushState(estado, titulo, constructorURLFinal);
                    }
                },
                resolverFila: (transaccion) => {
                    transaccion.preventDefault()
                    transaccion.stopPropagation()
                    const servicioUID = transaccion.target.parentNode.getAttribute("href")
                    const navegacion = {
                        vista: servicioUID,
                        tipoOrigen: "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(navegacion)
                },
                cambiarPagina: async (cambiarPagina) => {
                    const gridUID = cambiarPagina.gridUID
                    const gridEnlazado = document.querySelector(`[gridUID=${gridUID}]`)
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const tipoBoton = cambiarPagina.componenteID
                    const nombreColumna = gridEnlazado.getAttribute("nombreColumnaSeleccionada")
                    const sentidoColumna = gridEnlazado.getAttribute("sentidoColumna")
                    const terminoBusqueda = gridEnlazado.getAttribute("terminoBusqueda")
                    const paginaActual = Number(gridEnlazado.getAttribute("numeroPagina"))
                    const transacccion = {
                        zona: "administracion/servicios/listaServiciosPaginados",
                        nombreColumna: nombreColumna,
                        sentidoColumna: sentidoColumna,
                        buscar: terminoBusqueda,
                        tipoBusqueda: "rapido",
                        instanciaUID: instanciaUID
                    }
                    if (tipoBoton === "numeroPagina") {
                        const numeroPagina = cambiarPagina.numeroPagina
                        transacccion.pagina = Number(numeroPagina)
                        transacccion.origen = "botonNumeroPagina"
                    }
                    if (tipoBoton === "botonAdelantePaginacion") {
                        const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                        let mueveNavegadorHaciaAdelante = "Desactivado";
                        if (Number(posicionRelativa) === 10) {
                            mueveNavegadorHaciaAdelante = "Activado"
                        }
                        transacccion.pagina = paginaActual + 1
                        transacccion.origen = "botonNumeroPagina"
                        transacccion.moverHaciaAdelanteNavegacion = mueveNavegadorHaciaAdelante
                        transacccion.sentidoNavegacion = "Adelante"
                    }
                    if (tipoBoton === "botonAtrasPaginacion") {
                        const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                        let mueveNavegadorHaciaAtras = "Desactivado";
                        if (Number(posicionRelativa) === 1) {
                            mueveNavegadorHaciaAtras = "Activado"
                        }
                        transacccion.pagina = paginaActual - 1
                        transacccion.origen = "botonNumeroPagina"
                        transacccion.mueveNavegadorHaciaAtras = mueveNavegadorHaciaAtras
                        transacccion.sentidoNavegacion = "Atras"
                    }
                    transacccion.tipoConstruccionGrid = "soloLista"
                    casaVitini.administracion.servicios.portada.mostrarServiciosResueltos(transacccion)
                },
                ordenarPorColumna: async (columna) => {

                    const nombreColumna = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("nombreColumna")
                    const selectorColumnasentido = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("sentidoColumna")
                    const numeroPagina = columna.target.closest("[gridUID]").getAttribute("numeroPagina")
                    const transaccion = {
                        zona: "administracion/servicios/listaServiciosPaginados",
                        pagina: Number(numeroPagina),
                        tipoConstruccionGrid: "soloLista",
                        origen: "tituloColumna"
                    }

                    if (selectorColumnasentido === "ascendente") {
                        transaccion.sentidoColumna = "descendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    if (!selectorColumnasentido) {
                        transaccion.sentidoColumna = "ascendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    casaVitini.administracion.servicios.portada.mostrarServiciosResueltos(transaccion)
                },
                constructorTarjetas: (data) => {
                    const servicios = data.tarjetas
                    const destino = data.destino

                    const contenedorTarjetas = document.querySelector("[contenedor=tarjetas]")
                    contenedorTarjetas?.remove()

                    const contenedor = document.createElement("div")
                    contenedor.setAttribute("contenedor", "tarjetas")
                    contenedor.classList.add(
                        "flexVertical",
                        "gap6"
                    )

                    servicios.forEach(i => {
                        const servicioUID = i.servicioUID
                        const nombre = i.nombre
                        const estadoIDV = i.estadoIDV
                        const zonaIDV = i.zonaIDV

                        const tarjeta = document.createElement("a")
                        tarjeta.setAttribute("componente", "tarjeta")
                        tarjeta.classList.add(
                            "flexVertical",
                            "gap6",
                            "tarjeta",
                            "borderRadius10",
                            "backgroundGrey1",
                            "padding10",
                            "areaSinDecoracionPredeterminada",
                            "ratonDefault",
                            "comportamientoBoton"
                        )
                        tarjeta.href = `/administracion/servicios/servicio:${servicioUID}`
                        tarjeta.setAttribute("vista", `/administracion/servicios/servicio:${servicioUID}`)
                        tarjeta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        contenedor.appendChild(tarjeta)

                        const datosPar = {
                            "ServicioUID": servicioUID,
                            "Nombre": nombre,
                            "Zona": zonaIDV,
                            "Estado": estadoIDV
                        }

                        Object.entries(datosPar).forEach(([datoUI, data]) => {

                            const contenedor = document.createElement("div")
                            contenedor.classList.add(
                                "flexVertical"
                            )
                            if (data) {
                                tarjeta.appendChild(contenedor)
                            }
                            const titulo = document.createElement("div")
                            titulo.innerHTML = datoUI
                            contenedor.appendChild(titulo)

                            const dataUI = document.createElement("div")
                            dataUI.classList.add(
                                "negrita",
                                "textoElipsis"
                            )
                            dataUI.innerText = data
                            contenedor.appendChild(dataUI)
                        })
                    })
                    document.querySelector(destino).appendChild(contenedor)
                },
                selectorFiltro: {
                    ui: function (data) {
                        const destino = data.destino
                        const columnas = data.columnas

                        const columnaSeleccioanda = data?.columnaSeleccioanda || null
                        const sentidoSeleccionado = data?.sentidoSeleccionado || null
                        const selectorFiltroOrden = document.querySelector("[contenedor=filtrosOrden]")
                        if (selectorFiltroOrden) {
                            const selectorOrdenPorColumna = selectorFiltroOrden.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = selectorFiltroOrden.querySelector("[selector=sentido]")

                            if (columnaSeleccioanda) {
                                selectorOrdenPorColumna.value = columnaSeleccioanda

                            } else {
                                selectorOrdenPorColumna.selectedIndex = 0
                            }
                            if (sentidoSeleccionado) {
                                selectorSentido.value = sentidoSeleccionado
                            } else {
                                selectorSentido.selectedIndex = 0
                            }
                            return
                        }

                        const contenedorFiltrosOrden = document.createElement("div")
                        contenedorFiltrosOrden.classList.add(
                            "gap6",
                            "flexDerecha"
                        )
                        contenedorFiltrosOrden.setAttribute("contenedor", "filtrosOrden")

                        const botonReseteo = document.createElement("div")
                        botonReseteo.classList.add(
                            "selector",
                            "textoCentrado",
                            "comportamientoBoton",
                            "noSelecionable",
                            "ratonDefault"
                        )
                        botonReseteo.innerText = "Resetear filtros"
                        botonReseteo.addEventListener("click", (e) => {
                            const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                            const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = contenedor.querySelector("[selector=sentido]")
                            selectorColumna.selectedIndex = 0
                            selectorSentido.selectedIndex = 0
                            this.pasarela(e)
                        })
                        contenedorFiltrosOrden.appendChild(botonReseteo)

                        const selectorColumna = document.createElement("select")
                        selectorColumna.setAttribute("selector", "ordenPorColumna")
                        selectorColumna.addEventListener("change", this.pasarela)
                        selectorColumna.classList.add(
                            "selector",
                            "textoCentrado"
                        )
                        contenedorFiltrosOrden.appendChild(selectorColumna)
                        const opcionPreterminada = document.createElement("option");
                        opcionPreterminada.disabled = "true"
                        opcionPreterminada.value = ""
                        opcionPreterminada.text = "Ordenar por columna";
                        if (!columnaSeleccioanda) {
                            opcionPreterminada.selected = "true"
                        }

                        selectorColumna.add(opcionPreterminada)

                        columnas.forEach((columna) => {
                            const columnaUI = columna.columnaUI
                            const columnaIDV = columna.columnaIDV
                            const opcion = document.createElement("option");
                            opcion.value = columnaIDV;
                            opcion.text = columnaUI;
                            if (columnaSeleccioanda === columnaIDV) {
                                opcion.selected = "true"
                            }
                            selectorColumna.add(opcion);
                        })

                        const selectorSentido = document.createElement("select")
                        selectorSentido.setAttribute("selector", "sentido")
                        selectorSentido.addEventListener("change", this.pasarela)

                        selectorSentido.classList.add(
                            "selector",
                            "textoCentrado"
                        )
                        contenedorFiltrosOrden.appendChild(selectorSentido)
                        const opcionSentido = document.createElement("option");
                        opcionSentido.disabled = "true"
                        opcionSentido.text = "Sentido";
                        opcionSentido.value = ""
                        if (!sentidoSeleccionado) {
                            opcionSentido.selected = "true"
                        }
                        selectorSentido.add(opcionSentido)

                        const sentidos = [
                            {
                                sentidoUI: "Ascendente",
                                sentidoIDV: "ascendente"
                            },
                            {
                                sentidoUI: "Descendente",
                                sentidoIDV: "descendente"
                            }
                        ]

                        sentidos.forEach((sentido) => {
                            const sentidoUI = sentido.sentidoUI
                            const sentidoIDV = sentido.sentidoIDV
                            const opcion = document.createElement("option");
                            opcion.value = sentidoIDV;
                            opcion.text = sentidoUI;
                            if (sentidoSeleccionado === sentidoIDV) {
                                opcion.selected = "true"
                            }
                            selectorSentido.add(opcion);
                        })
                        document.querySelector(destino).appendChild(contenedorFiltrosOrden)
                    },
                    pasarela: (e) => {
                        const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                        const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                        const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]").value
                        const selectorSentido = contenedor.querySelector("[selector=sentido]").value
                        const ui = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        const numeroPagina = ui.querySelector("[gridUID]").getAttribute("numeroPagina")
                        const transaccion = {
                            zona: "administracion/servicios/listaServiciosPaginados",
                            pagina: Number(numeroPagina),
                            tipoConstruccionGrid: "soloLista",
                            origen: "tituloColumna",
                            granuladoURL: casaVitini.utilidades.granuladorURL()
                        }
                        transaccion.sentidoColumna = selectorSentido
                        transaccion.nombreColumna = selectorColumna

                        casaVitini.administracion.servicios.portada.mostrarServiciosResueltos(transaccion)
                    }
                },
            },
            detallesServicio: {
                arranque: async function (servicioUID) {
                    const instanciaUID = document.querySelector("main").getAttribute("instanciaUID")
                    const transaccion = {
                        zona: "administracion/servicios/detallesServicio",
                        servicioUID: String(servicioUID)
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada) { return }
                    if (respuestaServidor?.error) {
                        const info = {
                            titulo: "No existe ningÃºna servicio con ese identificador",
                            descripcion: "Revisa el identificador porque este servicio que buscas no existe. QuizÃ¡s este identificador existiÃ³ y borraste esta servicio.."
                        }
                        casaVitini.ui.componentes.mensajeSimple(info)
                    } else if (respuestaServidor?.ok) {
                        const servicio = respuestaServidor.ok
                        const servicioUID = servicio.servicioUID
                        const espacioServicios = document.querySelector("[componente=espacio]")
                        espacioServicios.setAttribute("instantanea", JSON.stringify(servicio))
                        espacioServicios.setAttribute("servicioUID", servicioUID)

                        espacioServicios.innerHTML = null
                        const main = document.querySelector("main")
                        main.setAttribute("zonaCSS", "/administracion/servicios/servicioUI")
                        const ofertaUI = casaVitini.administracion.servicios.componentesUI.detalleUI({
                            modoUI: "editar"
                        })
                        espacioServicios.appendChild(ofertaUI)
                        this.aplicaData({
                            servicio: servicio,
                            instanciaUID_destino: instanciaUID
                        })
                        const botonesModificacion = casaVitini.administracion.servicios.componentesUI.botonesDuranteModificacion()
                        ofertaUI.appendChild(botonesModificacion)
                    }






                },
                aplicaData: function (data) {

                    const servicio = data.servicio
                    const instanciaUID_destino = data.instanciaUID_destino
                    const servicioUID = servicio.servicioUID
                    const nombre = servicio.nombre
                    const zonaIDV = servicio.zonaIDV
                    const contenedor = servicio.contenedor
                    const estadoIDV = servicio.estadoIDV

                    const servicioUI = document.querySelector(`[instanciaUID="${instanciaUID_destino}"]`)
                    if (!servicioUI) { return }

                    servicioUI.querySelector("[componente=servicioUI]").setAttribute("servicioUID", servicioUID)

                    if (estadoIDV === "desactivado") {
                        servicioUI.querySelector("[componente=estadoServicio]").setAttribute("estadoServicio", estadoIDV)
                        servicioUI.querySelector("[componente=estadoServicio]").style.background = "#ff000091"
                        servicioUI.querySelector("[componente=estadoServicio]").innerHTML = "Oferta desactivada"
                    }
                    if (estadoIDV === "activado") {
                        servicioUI.querySelector("[componente=estadoServicio]").setAttribute("estadoServicio", estadoIDV)
                        servicioUI.querySelector("[componente=estadoServicio]").style.background = "#00ff006e"
                        servicioUI.querySelector("[componente=estadoServicio]").innerHTML = "Oferta activada"
                    }

                    const duracionIDV = contenedor.duracionIDV
                    const disponibilidadIDV = contenedor.disponibilidadIDV
                    // const cantidadIDV = contenedor.cantidadIDV
                    const tituloPublico = contenedor.tituloPublico
                    const definicion = contenedor.definicion
                    const precio = contenedor.precio
                    // const cantidadCampo = contenedor?.cantidadCampo
                    const fechaInicio = contenedor?.fechaInicio
                    const fechaFinal = contenedor?.fechaFinal

                    const selectorContenedorFechas = servicioUI.querySelector("[contenedor=fechas]")
                    // const selectorContenedorCantidad = servicioUI.querySelector("[contenedor=cantidad]")

                    if (duracionIDV === "rango") {
                        servicioUI.querySelector("[calendario=entrada]").setAttribute("memoriaVolatil", fechaInicio)
                        servicioUI.querySelector("[calendario=salida]").setAttribute("memoriaVolatil", fechaFinal)

                        const fechaInicio_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaInicio)
                        const fechaFinal_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaFinal)
                        const fechaInicioUI = servicioUI.querySelector("[calendario=entrada]").querySelector("[fechaUI]")
                        fechaInicioUI.innerText = fechaInicio_humana

                        const fechaFinalUI = servicioUI.querySelector("[calendario=salida]").querySelector("[fechaUI]")
                        fechaFinalUI.innerText = fechaFinal_humana
                        selectorContenedorFechas.style.display = "flex"
                    } else if (duracionIDV === "permanente") {
                        selectorContenedorFechas.style.display = "none"
                    }

                    // if (cantidadIDV === "limitada") {
                    //     const cantidadCampo_UI = servicioUI.querySelector("[campo=cantidad]")
                    //     cantidadCampo_UI.value = cantidadCampo
                    //     selectorContenedorCantidad.style.display = "flex"
                    // } else if (cantidadIDV === "infinita") {
                    //     selectorContenedorCantidad.style.display = "none"
                    // }
                    const nombreServicioCampo = servicioUI.querySelector("[campo=nombreServicio]")
                    nombreServicioCampo.value = nombre

                    const zonaIDVSelector = servicioUI.querySelector("[campo=zonaIDV]")
                    zonaIDVSelector.value = zonaIDV

                    const duracionIDVSelector = servicioUI.querySelector("[campo=duracionIDV]")
                    duracionIDVSelector.value = duracionIDV

                    const disponibilidadIDVSelector = servicioUI.querySelector("[campo=disponibilidadIDV]")
                    disponibilidadIDVSelector.value = disponibilidadIDV

                    // const cantidadIDVSelector = servicioUI.querySelector("[campo=cantidadIDV]")
                    // cantidadIDVSelector.value = cantidadIDV

                    const tituloPublicoCampo = servicioUI.querySelector("[campo=tituloPublico]")
                    tituloPublicoCampo.value = tituloPublico

                    const definicionCampo = servicioUI.querySelector("[campo=definicion]")
                    definicionCampo.value = definicion

                    const precioCampo = servicioUI.querySelector("[campo=precio]")
                    precioCampo.value = precio
                },
                estadoUIControlador: async (estado) => {
                    const servicioUID = document.querySelector("[servicioUID]")?.getAttribute("servicioUID")
                    if (!servicioUID) {
                        const error = "No se puede cambiar el estado del servicio porque no tiene un identificador Ãºnico de servicio (servicioUID).Esto puede deberse a que aÃºn no has creado la servicio o que la has borrado.Si estÃ¡s creando una servicio, por favor asegÃºrate de crearlo pulsando el botÃ³n 'Crear servicio' antes de activarla."
                        casaVitini.ui.componentes.advertenciaInmersiva(error)
                    }
                    const selectorEstado = document.querySelector("[componente=estadoServicio]")

                    const estadoActualMemoriaVolatil = selectorEstado.innerText
                    selectorEstado.innerText = "Esperando al servidor...."
                    const estadoActual = estado.target.getAttribute("estadoServicio")
                    let estadoOfertaPropuesto
                    if (estadoActual === "desactivado") {
                        estadoOfertaPropuesto = "activado"
                    }
                    if (estadoActual === "activado") {
                        estadoOfertaPropuesto = "desactivado"
                    }
                    const transaccion = {
                        zona: "administracion/servicios/actualizarEstadoServicio",
                        servicioUID: String(servicioUID),
                        estadoIDV: estadoOfertaPropuesto
                    }

                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        document.querySelector("[estadoServicio]").innerText = estadoActualMemoriaVolatil
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const estadoIDV = respuestaServidor?.estadoIDV
                        selectorEstado.setAttribute("estadoServicio", estadoIDV)
                        let estadoUI
                        if (estadoIDV === "activado") {
                            selectorEstado.style.background = "#00ff006e"
                            estadoUI = "Servicio activado"
                        }
                        if (estadoIDV === "desactivado") {
                            selectorEstado.style.background = "#ff000091"
                            estadoUI = "Servicio desactivado"
                        }
                        selectorEstado.innerText = estadoUI
                    }
                },
                guardarCambios: async function () {
                    const instanciaUID_pantallaEspera = casaVitini.utilidades.codigoFechaInstancia()
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const servicioUID = main.querySelector("[componente=servicioUI]").getAttribute("servicioUID")

                    const mensaje = "Actualizando servicio..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID_pantallaEspera,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const servicio = casaVitini.administracion.servicios.utilidades.constructorObjeto()

                    const transaccion = {
                        zona: "administracion/servicios/actualizarServicio",
                        servicioUID: String(servicioUID),
                        ...servicio
                    }


                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    document.querySelector(`[instanciaUID="${instanciaUID_pantallaEspera}"]`)?.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const servicioActualizado = respuestaServidor.servicioActualizado

                        const servicioUI = document.querySelector("[componente=servicioUI]")
                        servicioUI.setAttribute("instantanea", JSON.stringify(servicioActualizado))

                        casaVitini.administracion.servicios.detallesServicio.aplicaData({
                            servicio: servicioActualizado,
                            instanciaUID_destino: instanciaUID
                        })
                    }
                },
                eliminarServicio: {
                    ui: () => {

                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                        const titulo = constructor.querySelector("[componente=titulo]")
                        titulo.innerText = "Confirmar eliminar el servicio"
                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                        mensaje.innerText = "Var a eliminar el servicio y su aplicacion sera inmediata, Â¿Estas de acuerdo ? "

                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                        botonAceptar.innerText = "Comfirmar la eliminaciÃ³n"
                        botonAceptar.addEventListener("click", casaVitini.administracion.servicios.detallesServicio.eliminarServicio.confirmar)
                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                        botonCancelar.innerText = "Cancelar la eliminaciÃ³n"

                        document.querySelector("main").appendChild(pantallaInmersiva)

                    },
                    confirmar: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Eliminado el servicio..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const servicioUID = document.querySelector("[servicioUID]").getAttribute("servicioUID")
                        const transaccion = {
                            zona: "administracion/servicios/eliminarServicio",
                            servicioUID: String(servicioUID)
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const vista = `/administracion/servicios`
                            const navegacion = {
                                vista: vista,
                                //tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                }

            },
            componentesUI: {
                detalleUI: (data) => {
                    const modoUI = data.modoUI
                    const instanciaUID_contenedorFechas = casaVitini.utilidades.codigoFechaInstancia()

                    const ui = document.createElement("div");
                    ui.setAttribute("componente", "servicioUI");
                    ui.classList.add(
                        "servicioUI"
                    )

                    const contenedorNombreEstado = document.createElement("div");

                    if (modoUI === "editar") {
                        contenedorNombreEstado.classList.add("crearOfertaContenedorHorizontalV2");

                        const botonEstadoOferta = document.createElement("div")
                        botonEstadoOferta.classList.add("creatOfertaBotonEstado")
                        botonEstadoOferta.setAttribute("componente", "estadoServicio")
                        botonEstadoOferta.addEventListener("click", casaVitini.administracion.servicios.detallesServicio.estadoUIControlador)
                        botonEstadoOferta.innerText = "Servicio desactivado"
                        contenedorNombreEstado.appendChild(botonEstadoOferta)

                    }
                    if (modoUI === "crear") {
                        contenedorNombreEstado.classList.add("crearOfertaContenedorHorizontalModoCrear");
                    }
                    //Crear el input
                    const input = document.createElement("input");
                    input.setAttribute("type", "text");
                    input.classList.add(
                        "padding12",
                        "borderRadius10"
                    );
                    input.setAttribute("campo", "nombreServicio");
                    input.setAttribute("placeholder", "Escriba el nombre de nuevo servicio");
                    contenedorNombreEstado.appendChild(input)
                    ui.appendChild(contenedorNombreEstado)
                    // Selector duracion - permanente o rango
                    // Disponibildia -constante o limiteada
                    // catnida - indefinida - limitada
                    const contenedorSelectoresGlobales = document.createElement("div")
                    contenedorSelectoresGlobales.classList.add("contenedorSelectoresGlobales")

                    const selectorZona = () => {
                        const selector = document.createElement("select")
                        selector.classList.add(
                            "selector",
                            "textCentrado"
                        )
                        selector.setAttribute("campo", "zonaIDV")
                        const opcionPredeterminada = document.createElement("option")
                        opcionPredeterminada.selected = true
                        opcionPredeterminada.disabled = true;
                        opcionPredeterminada.value = ""
                        opcionPredeterminada.text = "Zona del servicio"
                        selector.appendChild(opcionPredeterminada)
                        const opciones = [
                            { value: "publica", text: "Zona pÃºblica" },
                            { value: "global", text: "Zona global" },
                            { value: "privada", text: "Zona privada" }
                        ]
                        for (const opcionData of opciones) {
                            const opcion = document.createElement("option");
                            opcion.value = opcionData.value;
                            opcion.text = opcionData.text;
                            selector.appendChild(opcion);
                        }
                        return selector
                    }
                    contenedorSelectoresGlobales.appendChild(selectorZona())

                    const selectorDuracion = () => {
                        const selector = document.createElement("select")
                        selector.classList.add(
                            "selector",
                            "textCentrado"
                        )
                        selector.setAttribute("campo", "duracionIDV")
                        selector.addEventListener("change", (e) => {

                            const sel = e.target.value
                            const selectorFechas = document.querySelector("[contenedor=fechas]")
                            if (sel === "permanente") {
                                selectorFechas.style.display = "none"
                            } else if (sel === "rango") {
                                selectorFechas.style.display = "flex"
                            }



                        })
                        const opcionPredeterminada = document.createElement("option")
                        opcionPredeterminada.selected = true
                        opcionPredeterminada.disabled = true;
                        opcionPredeterminada.value = ""
                        opcionPredeterminada.text = "DuraciÃ³n"
                        selector.appendChild(opcionPredeterminada)
                        const opciones = [
                            { value: "permanente", text: "Permanente" },
                            { value: "rango", text: "Solo durante un rango" }
                        ]
                        for (const opcionData of opciones) {
                            const opcion = document.createElement("option");
                            opcion.value = opcionData.value;
                            opcion.text = opcionData.text;
                            selector.appendChild(opcion);
                        }
                        return selector
                    }
                    contenedorSelectoresGlobales.appendChild(selectorDuracion())


                    const selectorDisponibilidad = () => {
                        const selector = document.createElement("select")
                        selector.classList.add(
                            "selector",
                            "textCentrado"
                        )
                        selector.setAttribute("campo", "disponibilidadIDV")
                        const opcionPredeterminada = document.createElement("option")
                        opcionPredeterminada.selected = true
                        opcionPredeterminada.disabled = true;
                        opcionPredeterminada.value = ""
                        opcionPredeterminada.text = "Disponibilidad"
                        selector.appendChild(opcionPredeterminada)
                        const opciones = [
                            { value: "constante", text: "Constante" },
                            { value: "variable", text: "Variable" }
                        ]
                        for (const opcionData of opciones) {
                            const opcion = document.createElement("option");
                            opcion.value = opcionData.value;
                            opcion.text = opcionData.text;
                            selector.appendChild(opcion);
                        }
                        return selector
                    }
                    contenedorSelectoresGlobales.appendChild(selectorDisponibilidad())

                    ui.appendChild(contenedorSelectoresGlobales);



                    const divContenedor = document.createElement("div");
                    divContenedor.classList.add("administracion_ofertas_crearOfertas_contenedorFecha");
                    divContenedor.setAttribute("contenedor", "fechas")
                    divContenedor.setAttribute("instanciaUID_contenedorFechas", instanciaUID_contenedorFechas)
                    //Crear el primer div contenedor horizontal
                    const divContenedorHorizontal = document.createElement("div");
                    divContenedorHorizontal.classList.add("crearOfertaContenedorHorizontal");
                    //Crear el div contenedor de fecha de inicio
                    const divContenedorFechaInicio = document.createElement("div");
                    divContenedorFechaInicio.classList.add("contenedorFecha");
                    divContenedorFechaInicio.setAttribute("calendario", "entrada");
                    divContenedorFechaInicio.setAttribute("componente", "inicioOferta");
                    divContenedorFechaInicio.setAttribute("paralizadorEvento", "ocultadorCalendarios");
                    divContenedorFechaInicio.addEventListener("click", async () => {
                        await casaVitini.ui.componentes.calendario.configurarCalendario({
                            perfilMes: "calendario_entrada_perfilSimple",
                            contenedorOrigenIDV: "[calendario=entrada]",
                            instanciaUID_contenedorFechas,
                            rangoIDV: "inicioRango",
                            metodoSelectorDia: null
                        })
                    })


                    const pFechaInicio = document.createElement("p");
                    pFechaInicio.classList.add("tituloFecha");
                    pFechaInicio.textContent = "Fecha de inicio";

                    const pFechaInicioSeleccionada = document.createElement("p");
                    pFechaInicioSeleccionada.classList.add("fechaInicio");
                    pFechaInicioSeleccionada.setAttribute("fechaUI", "fechaInicio");
                    pFechaInicioSeleccionada.textContent = "(Seleccionar)";

                    divContenedorFechaInicio.appendChild(pFechaInicio);
                    divContenedorFechaInicio.appendChild(pFechaInicioSeleccionada);

                    const divContenedorFechaFin = document.createElement("div");
                    divContenedorFechaFin.classList.add("contenedorFecha");
                    divContenedorFechaFin.setAttribute("calendario", "salida");
                    divContenedorFechaFin.setAttribute("paralizadorEvento", "ocultadorCalendarios");
                    divContenedorFechaFin.setAttribute("componente", "finOferta");

                    divContenedorFechaFin.addEventListener("click", async () => {
                        await casaVitini.ui.componentes.calendario.configurarCalendario({
                            perfilMes: "calendario_salida_perfilSimple",
                            contenedorOrigenIDV: "[calendario=salida]",
                            instanciaUID_contenedorFechas,
                            rangoIDV: "finalRango",
                            metodoSelectorDia: null
                        })
                    })


                    //Crear el pÃ¡rrafo de la fecha de fin
                    const pFechaFin = document.createElement("p");
                    pFechaFin.classList.add("tituloFecha");
                    pFechaFin.textContent = "Fecha fin";
                    //Crear el pÃ¡rrafo de la fecha de fin seleccionada
                    const pFechaFinSeleccionada = document.createElement("p");
                    pFechaFinSeleccionada.classList.add("fechaFin");
                    pFechaFinSeleccionada.setAttribute("fechaUI", "fechaFin");
                    pFechaFinSeleccionada.textContent = "(Seleccionar)";
                    //Agregar los elementos al div contenedor de fecha de fin
                    divContenedorFechaFin.appendChild(pFechaFin);
                    divContenedorFechaFin.appendChild(pFechaFinSeleccionada);
                    //Agregar los elementos al primer div contenedor horizontal
                    divContenedorHorizontal.appendChild(divContenedorFechaInicio);
                    divContenedorHorizontal.appendChild(divContenedorFechaFin);
                    //Agregar el primer div contenedor horizontal al div contenedor
                    divContenedor.appendChild(divContenedorHorizontal);
                    //Agregar el div contenedor al div principal
                    ui.appendChild(divContenedor);


                    // const contenedorCantidad = () => {
                    //     const contenedor = document.createElement("div")
                    //     contenedor.setAttribute("contenedor", "cantidad")
                    //     contenedor.classList.add(
                    //         "flexVertical",
                    //         "gap6",
                    //         "padding6",
                    //         "backgroundGrey1",
                    //         "borderRadius14"

                    //     )
                    //     const titulo = document.createElement("p")
                    //     titulo.classList.add(
                    //         "padding6"
                    //     )
                    //     titulo.innerText = "Determina la cantidad disponible de este servicio. Este servicio estarÃ¡ limitado al nÃºmero de servicios disponibles. Una vez este servicio haya llegado a al lÃ­mite, dejarÃ¡ de publicarse y estar disponible para seleccionarse"
                    //     contenedor.appendChild(titulo)

                    //     const campo = document.createElement("input")
                    //     campo.setAttribute("campo", "cantidad")
                    //     campo.classList.add(
                    //         "padding10",
                    //         "borderRadius10"
                    //     )
                    //     campo.placeholder = "Escribe el numero de servicios disponibles, por ejemplo 5"
                    //     contenedor.appendChild(campo)

                    //     return contenedor
                    // }

                    // ui.appendChild(contenedorCantidad())

                    const contenedorDefinicion = () => {
                        const contenedor = document.createElement("div")
                        contenedor.setAttribute("contenedor", "definicion")
                        contenedor.classList.add(
                            "flexVertical",
                            "gap6",
                            "padding6",
                            "backgroundGrey1",
                            "borderRadius14"

                        )
                        const titulo = document.createElement("p")
                        titulo.classList.add(
                            "padding6"
                        )
                        titulo.innerText = "Define nombre pÃºblico para el servicio y una definiciÃ³n."
                        contenedor.appendChild(titulo)

                        const campo = document.createElement("input")
                        campo.setAttribute("campo", "tituloPublico")
                        campo.classList.add(
                            "padding10",
                            "borderRadius10"
                        )
                        campo.placeholder = "Titulo del servicio"
                        contenedor.appendChild(campo)


                        const definicion = document.createElement("textarea")
                        definicion.setAttribute("campo", "definicion")
                        definicion.classList.add(
                            "padding10",
                            "borderRadius10",
                            "resizeOnlyVertical",
                            "area300px"
                        )
                        definicion.placeholder = "Definicion del servicio"
                        contenedor.appendChild(definicion)

                        return contenedor
                    }

                    ui.appendChild(contenedorDefinicion())

                    const contenedorPrecio = () => {
                        const contenedor = document.createElement("div")
                        contenedor.setAttribute("contenedor", "cantidad")
                        contenedor.classList.add(
                            "flexVertical",
                            "gap6",
                            "padding6",
                            "backgroundGrey1",
                            "borderRadius14"

                        )
                        const titulo = document.createElement("p")
                        titulo.classList.add(
                            "padding6"
                        )
                        titulo.innerText = "Precio del servicio, determina el valor de este servicio. El precio del servicio tiene que estar en formato nÃºmero con dos decimales separados por punto."
                        contenedor.appendChild(titulo)

                        const campo = document.createElement("input")
                        campo.setAttribute("campo", "precio")
                        campo.classList.add(
                            "padding10",
                            "borderRadius10"
                        )
                        campo.placeholder = "00.00"
                        contenedor.appendChild(campo)


                        return contenedor
                    }

                    ui.appendChild(contenedorPrecio())

                    return ui

                },
                botonesCrearServicio: () => {
                    const boton = document.createElement("p");
                    boton.classList.add("botonV1");
                    boton.textContent = "Crear servicio";
                    boton.setAttribute("boton", "crearServucui");
                    boton.addEventListener("click", casaVitini.administracion.servicios.nuevo.crearServicio)
                    return boton
                },
                botonesModificar: () => {
                    const boton = document.createElement("div")
                    boton.classList.add("botonV1");
                    boton.setAttribute("componente", "botonEditar");
                    boton.setAttribute("contenedor", "botones");

                    boton.addEventListener("click", () => {
                        casaVitini.administracion.servicios.componentesUI.modosUI("modoEditar")
                    })
                    boton.textContent = "Modificar servicio";
                    return boton
                },
                botonesDuranteModificacion: function () {
                    const contenedor = document.createElement("div");
                    contenedor.classList.add("contenedorBotones");
                    contenedor.setAttribute("contenedor", "botones");

                    const botonGuardar = document.createElement("div")
                    botonGuardar.classList.add("botonV1");
                    botonGuardar.setAttribute("componente", "botonGuardarCambios");
                    botonGuardar.setAttribute("tipoOferta", "conXApartamentosEnConcreto");
                    botonGuardar.addEventListener("click", casaVitini.administracion.servicios.detallesServicio.guardarCambios)
                    botonGuardar.textContent = "Actualizar servicio";

                    const botonCancelar = document.createElement("p");
                    botonCancelar.classList.add("botonV1");
                    botonCancelar.setAttribute("componente", "botonCancelarCambios");
                    botonCancelar.setAttribute("tipoOferta", "conXApartamentosEnConcreto");
                    botonCancelar.addEventListener("click", async () => {
                        const selectorInstantena = document.querySelector("[instantanea]").getAttribute("instantanea")
                        const instantanea = JSON.parse(selectorInstantena)
                        const instanciaUID_destino = document.querySelector(`main[instanciaUID]`).getAttribute("instanciaUID")
                        casaVitini.administracion.servicios.detallesServicio.aplicaData({
                            servicio: instantanea,
                            instanciaUID_destino: instanciaUID_destino,
                        })
                    })
                    botonCancelar.textContent = "Revertir cambios";

                    const botonEliminar = document.createElement("p");
                    botonEliminar.classList.add("botonV1");
                    botonEliminar.setAttribute("componente", "botonEliminarOferta");
                    botonEliminar.addEventListener("click", casaVitini.administracion.servicios.detallesServicio.eliminarServicio.ui)
                    botonEliminar.textContent = "Eliminar servicio";
                    contenedor.appendChild(botonGuardar);
                    contenedor.appendChild(botonCancelar);
                    contenedor.appendChild(botonEliminar);
                    return contenedor
                },
                modosUI: async (modo) => {
                    const contenedorBotones = document.querySelector("[componente=servicioUI]")
                    contenedorBotones.querySelector("[contenedro=botones]")?.remove()
                    if (modo === "modoEditar") {
                        const botones = casaVitini.administracion.servicios.componentesUI.botonesDuranteModificacion()
                        contenedorBotones.appendChild(botones)
                        document.querySelector("[componente=soloLecturaInfo]")?.classList.remove("elementoOcultoInicialmente")
                    }
                    if (modo === "modoCancelar") {
                        const botones = casaVitini.administracion.servicios.componentesUI.botonesModificar()
                        contenedorBotones.appendChild(botones)
                        document.querySelector("[componente=soloLecturaInfo]")?.classList.remove("elementoOcultoInicialmente")
                    }
                },

            },
            nuevo: {
                arranque: () => {

                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "/administracion/servicios/servicioUI")
                    //main.style.alignItems = "stretch"

                    const ui = casaVitini.administracion.servicios.componentesUI.detalleUI({
                        modoUI: "crear"
                    })
                    main.appendChild(ui)

                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.classList.add(
                        "flexVertical",
                    )
                    ui.appendChild(contenedorBotones)

                    const botonCrearServicio = casaVitini.administracion.servicios.componentesUI.botonesCrearServicio()
                    contenedorBotones.appendChild(botonCrearServicio)
                },
                crearServicio: async () => {

                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const metadatosPantallaCarga = {
                        mensaje: "Creando servicio...",
                        instanciaUID: instanciaUID,
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                    const transaccion = casaVitini.administracion.servicios.utilidades.constructorObjeto()
                    transaccion.zona = "administracion/servicios/crearServicio"

                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const pantallaDeCargaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!pantallaDeCargaRenderizada) {
                        return
                    }
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const nuevoServicio = respuestaServidor?.nuevoServicioUID
                        const vista = `/administracion/servicios/servicio:${nuevoServicio}`
                        const navegacion = {
                            vista: vista,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    }
                },
            },
            utilidades: {
                constructorObjeto: () => {

                    const nombreServicio = document.querySelector("[campo=nombreServicio]").value
                    const fechaInicio_ISO = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    const fechaFinal_ISO = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")

                    const zonaIDV = document.querySelector("[campo=zonaIDV]").value
                    const duracionIDV = document.querySelector("[campo=duracionIDV]").value
                    const disponibilidadIDV = document.querySelector("[campo=disponibilidadIDV]").value
                    // const cantidadIDV = document.querySelector("[campo=cantidadIDV]").value
                    // const cantidadCampo = document.querySelector("[campo=cantidad]").value

                    const tituloPublico = document.querySelector("[campo=tituloPublico]").value
                    const definicion = document.querySelector("[campo=definicion]").value
                    const precio = document.querySelector("[campo=precio]").value

                    const oferta = {
                        nombreServicio,
                        zonaIDV,
                        contenedor: {
                            duracionIDV: duracionIDV,
                            disponibilidadIDV: disponibilidadIDV,
                            //  cantidadIDV: cantidadIDV,
                            tituloPublico: tituloPublico,
                            definicion: definicion,
                            precio: precio,
                            //  cantidadCampo: cantidadCampo,

                        }
                    }

                    if (duracionIDV === "rango") {
                        oferta.contenedor.fechaInicio = fechaInicio_ISO
                        oferta.contenedor.fechaFinal = fechaFinal_ISO
                    }


                    return oferta
                },
            }
        },
        configuracion: {
            arranque: async () => {
                const marcoElastico = document.querySelector("[componente=marcoElastico]")
                marcoElastico.style.gap = "4px"
                const botones = document.querySelectorAll("[componente=botonConfiguracion]")
                botones.forEach((boton) => {
                    boton.addEventListener("click", (boton) => {
                        boton.preventDefault()
                        const vista = boton.target.closest("[vista]").getAttribute("vista")
                        const navegacion = {
                            vista: vista,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    })
                })
            },
            zonaHoraria: {
                arranque: async () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/configuracion")
                    const marcoElastico = document.querySelector("[componente=marcoElastico]")
                    marcoElastico.style.gap = "4px"
                    const transaccion = {
                        zona: "administracion/configuracion/zonaHoraria/obtenerConfiguracion"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const configuracionGlobal = respuestaServidor?.ok
                        const zonaHoraria = configuracionGlobal.zonaHoraria
                        const listaZonasHorarias = configuracionGlobal.listaZonasHorarias
                        const horaEntradaTZ = configuracionGlobal.horaEntradaTZ
                        const horaSalidaTZ = configuracionGlobal.horaSalidaTZ
                        const contenedorConfiguracionGlobal = document.createElement("div")
                        contenedorConfiguracionGlobal.classList.add("administracion_configuracion_contenedorConfiguracion")
                        const informacion = document.createElement("div")
                        informacion.classList.add("administracion_configuracion_informacion")
                        informacion.innerText = "Determine la configuraciÃ³n global del sistema.Esta configuraciÃ³n se aplica a todo el sistema y a todos los usuarios. "
                        contenedorConfiguracionGlobal.appendChild(informacion)
                        //Zona horaria Global
                        let bloqueConfiguracion = document.createElement("div")
                        bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                        let tituloConfiguracion = document.createElement("div")
                        tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                        tituloConfiguracion.innerText = "Zona horaria de Casa Vitini"
                        bloqueConfiguracion.appendChild(tituloConfiguracion)
                        let descripcionConfiguracion = document.createElement("div")
                        descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                        descripcionConfiguracion.innerText = "La zona horaria local se aplica sobre el reloj UTC para que pueda ver la hora y las fechas en la zona horaria.Por ejemplo, en el apartado de SituaciÃ³n, en la renderizaciÃ³n de los calendarios y etc.La zona horaria debe de configurarse con la misma zona horaria de las instalaciones fÃ­sicas de pernoctaciÃ³n de Casa Vitini.Entonces, el sistema de Casa Vitini puede implantarse en cualquier ordenador sin importar su reloj en zona horaria local.Es fundamental que la zona horaria del sistema sea la misma que la zona horaria de las instalaciones fÃ­sicas de pernoctaciÃ³n de Casa Vitini.El motivo de esto es que los pernoctante puedan obtener calendarios locales a la zona horaria de Casa Vitini y realizar las reservas en zona horaria local de Casa Vitini."
                        bloqueConfiguracion.appendChild(descripcionConfiguracion)
                        const listaZonaHoraria = document.createElement("select")
                        listaZonaHoraria.classList.add("administracion_configuracion_valorConfiguracionInput")
                        listaZonaHoraria.setAttribute("campo", "zonaHoraria")
                        listaZonaHoraria.setAttribute("valorInicial", zonaHoraria)
                        listaZonaHoraria.addEventListener("input", casaVitini.administracion.configuracion.controlCampo)
                        for (const zonaHorariaIterada of listaZonasHorarias) {
                            const zonaHorariaUI = zonaHorariaIterada.replaceAll("/", "/").replaceAll("_", " ")
                            const zonaHorariaOpcion = document.createElement("option");
                            zonaHorariaOpcion.text = zonaHorariaUI;
                            zonaHorariaOpcion.value = zonaHorariaIterada;
                            if (zonaHoraria === zonaHorariaIterada) {
                                zonaHorariaOpcion.selected = true;
                            }
                            listaZonaHoraria.add(zonaHorariaOpcion);
                        }
                        bloqueConfiguracion.appendChild(listaZonaHoraria)
                        contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                        marcoElastico.appendChild(contenedorConfiguracionGlobal)
                        const contenedorBotones = document.createElement("div")
                        contenedorBotones.setAttribute("contenedor", "botones")
                        contenedorBotones.classList.add("administracion_configuracion_contenedorBotones")
                        const botonGuardarCambios = document.createElement("div")
                        botonGuardarCambios.classList.add("administracion_configuracion_boton")
                        botonGuardarCambios.innerText = "Guardar cambios"
                        botonGuardarCambios.addEventListener("click", casaVitini.administracion.configuracion.zonaHoraria.guardarCambios)
                        contenedorBotones.appendChild(botonGuardarCambios)
                        const botonCancelarCambios = document.createElement("div")
                        botonCancelarCambios.classList.add("administracion_configuracion_boton")
                        botonCancelarCambios.addEventListener("click", casaVitini.administracion.configuracion.zonaHoraria.cancelarCambios)
                        botonCancelarCambios.innerText = "Cancelar cambios"
                        contenedorBotones.appendChild(botonCancelarCambios)
                        marcoElastico.appendChild(contenedorBotones)
                    }
                },
                cancelarCambios: () => {
                    const campos = document.querySelectorAll("[campo]")
                    campos.forEach((campo) => {
                        campo.value = campo.getAttribute("valorInicial")
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    contenedorBotones.removeAttribute("style")
                },
                controlCampo: () => {
                    const campos = document.querySelectorAll("[campo]")
                    let estadoFinal = null
                    campos.forEach((campo) => {
                        if (campo.value !== campo.getAttribute("valorInicial")) {
                            estadoFinal = "visible"
                        }
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    if (estadoFinal === "visible") {
                        contenedorBotones.style.display = "flex"
                    } else {
                        contenedorBotones.removeAttribute("style")
                    }
                },
                guardarCambios: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Actualizando zona horaria del reloj..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const campos = document.querySelectorAll("[campo]")
                    const transacccion = {
                        zona: "administracion/configuracion/zonaHoraria/guardarConfiguracion"
                    }
                    campos.forEach((campo) => {
                        const nombreCampo = campo.getAttribute("campo")
                        const valorCampo = campo.value
                        transacccion[nombreCampo] = valorCampo
                    })
                    const respuestaServidor = await casaVitini.shell.servidor(transacccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.administracion.configuracion.cancelarCambios()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const contenedorBotones = document.querySelector("[contenedor=botones]")
                        contenedorBotones.removeAttribute("style")
                        campos.forEach((campo) => {
                            campo.setAttribute("valorInicial", campo.value)
                        })
                    }
                }
            },
            horaDeEntradaSalida: {
                arranque: async () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/configuracion")
                    const marcoElastico = document.querySelector("[componente=marcoElastico]")
                    marcoElastico.style.gap = "4px"
                    const transaccion = {
                        zona: "administracion/configuracion/horaDeEntradaSalida/obtenerConfiguracion"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const configuracionGlobal = respuestaServidor?.ok
                        const horaEntradaTZ = configuracionGlobal.horaEntradaTZ
                        const horaSalidaTZ = configuracionGlobal.horaSalidaTZ
                        const contenedorConfiguracionGlobal = document.createElement("div")
                        contenedorConfiguracionGlobal.classList.add("administracion_configuracion_contenedorConfiguracion")
                        const informacion = document.createElement("div")
                        informacion.classList.add("administracion_configuracion_informacion")
                        informacion.innerText = "Determine la configuraciÃ³n global del sistema.Esta configuraciÃ³n se aplica a todo el sistema y a todos los usuarios. "
                        contenedorConfiguracionGlobal.appendChild(informacion)
                        //Zona horaria Global
                        let bloqueConfiguracion = document.createElement("div")
                        bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                        let tituloConfiguracion = document.createElement("div")
                        tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                        tituloConfiguracion.innerText = "Zona horaria de Casa Vitini"
                        bloqueConfiguracion.appendChild(tituloConfiguracion)
                        let descripcionConfiguracion = document.createElement("div")
                        descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                        descripcionConfiguracion.innerText = "La zona horaria local se aplica sobre el reloj UTC para que pueda ver la hora y las fechas en la zona horaria.Por ejemplo, en el apartado de SituaciÃ³n, en la renderizaciÃ³n de los calendarios y etc.La zona horaria debe de configurarse con la misma zona horaria de las instalaciones fÃ­sicas de pernoctacion de Casa Vitini.Entonces, el sistema de Casa Vitini puede implantarse en cualquier ordenador sin importar su reloj en zona horaria local.Es fundamental que la zona horaria del sistema sea la misma que la zona horaria de las instalaciones fÃ­sicas de pernoctaciÃ³n de Casa Vitini.El motivo de esto es que los pernoctante puedan obtener calendarios locales a la zona horaria de Casa Vitini y realizar las reservas en zona horaria local de Casa Vitini."
                        bloqueConfiguracion.appendChild(descripcionConfiguracion)
                        contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                        //Hora de entrada TZ
                        bloqueConfiguracion = document.createElement("div")
                        bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                        tituloConfiguracion = document.createElement("div")
                        tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                        tituloConfiguracion.innerText = "Hora de entrada"
                        bloqueConfiguracion.appendChild(tituloConfiguracion)
                        descripcionConfiguracion = document.createElement("div")
                        descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                        descripcionConfiguracion.innerText = "Hora de entrada en zona horaria.Esta es la hora de entrada en la zona horaria seleccionada.Sirve para determinar la hora de entrada de las reservas en el dÃ­a de entrada"
                        bloqueConfiguracion.appendChild(descripcionConfiguracion)
                        let valorConfiguracion = document.createElement("input")
                        valorConfiguracion.setAttribute("campo", "horaEntradaTZ")
                        valorConfiguracion.setAttribute("valorInicial", horaEntradaTZ)
                        valorConfiguracion.addEventListener("input", casaVitini.administracion.configuracion.horaDeEntradaSalida.controlCampo)
                        valorConfiguracion.classList.add("administracion_configuracion_valorConfiguracionInput")
                        valorConfiguracion.value = horaEntradaTZ
                        valorConfiguracion.placeholder = "Selecciona una hora de entrada, por ejemplo 17:00"
                        bloqueConfiguracion.appendChild(valorConfiguracion)
                        contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                        //Hora de salida TZ
                        bloqueConfiguracion = document.createElement("div")
                        bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                        tituloConfiguracion = document.createElement("div")
                        tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                        tituloConfiguracion.innerText = "Hora de salida"
                        bloqueConfiguracion.appendChild(tituloConfiguracion)
                        descripcionConfiguracion = document.createElement("div")
                        descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                        descripcionConfiguracion.innerText = "Hora de salida en zona horaria.Esta es la hora de salida en la zona horaria seleccionada.Sirve para determinar la hora de salida de las reservas en el dÃ­a de salida "
                        bloqueConfiguracion.appendChild(descripcionConfiguracion)
                        valorConfiguracion = document.createElement("input")
                        valorConfiguracion.setAttribute("campo", "horaSalidaTZ")
                        valorConfiguracion.addEventListener("input", casaVitini.administracion.configuracion.horaDeEntradaSalida.controlCampo)
                        valorConfiguracion.setAttribute("valorInicial", horaSalidaTZ)
                        valorConfiguracion.classList.add("administracion_configuracion_valorConfiguracionInput")
                        valorConfiguracion.value = horaSalidaTZ
                        valorConfiguracion.placeholder = "Selecciona una hora de salida, por ejemplo 19:00 "
                        bloqueConfiguracion.appendChild(valorConfiguracion)
                        contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                        marcoElastico.appendChild(contenedorConfiguracionGlobal)
                        const contenedorBotones = document.createElement("div")
                        contenedorBotones.setAttribute("contenedor", "botones")
                        contenedorBotones.classList.add("administracion_configuracion_contenedorBotones")
                        const botonGuardarCambios = document.createElement("div")
                        botonGuardarCambios.classList.add("administracion_configuracion_boton")
                        botonGuardarCambios.innerText = "Guardar cambios"
                        botonGuardarCambios.addEventListener("click", casaVitini.administracion.configuracion.horaDeEntradaSalida.guardarCambios)
                        contenedorBotones.appendChild(botonGuardarCambios)
                        const botonCancelarCambios = document.createElement("div")
                        botonCancelarCambios.classList.add("administracion_configuracion_boton")
                        botonCancelarCambios.addEventListener("click", casaVitini.administracion.configuracion.horaDeEntradaSalida.cancelarCambios)
                        botonCancelarCambios.innerText = "Cancelar cambios"
                        contenedorBotones.appendChild(botonCancelarCambios)
                        marcoElastico.appendChild(contenedorBotones)
                    }
                },
                cancelarCambios: () => {
                    const campos = document.querySelectorAll("[campo]")
                    campos.forEach((campo) => {
                        campo.value = campo.getAttribute("valorInicial")
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    contenedorBotones.removeAttribute("style")
                },
                controlCampo: () => {
                    const campos = document.querySelectorAll("[campo]")
                    let estadoFinal = null
                    campos.forEach((campo) => {
                        if (campo.value !== campo.getAttribute("valorInicial")) {
                            estadoFinal = "visible"
                        }
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    if (estadoFinal === "visible") {
                        contenedorBotones.style.display = "flex"
                    } else {
                        contenedorBotones.removeAttribute("style")
                    }
                },
                guardarCambios: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Actualizando hora de entrada y salida..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const campos = document.querySelectorAll("[campo]")
                    const transacccion = {
                        zona: "administracion/configuracion/horaDeEntradaSalida/guardarConfiguracion"
                    }
                    campos.forEach((campo) => {
                        const nombreCampo = campo.getAttribute("campo")
                        const valorCampo = campo.value
                        transacccion[nombreCampo] = valorCampo
                    })

                    const respuestaServidor = await casaVitini.shell.servidor(transacccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.administracion.configuracion.cancelarCambios()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const contenedorBotones = document.querySelector("[contenedor=botones]")
                        contenedorBotones.removeAttribute("style")
                        campos.forEach((campo) => {
                            campo.setAttribute("valorInicial", campo.value)
                        })
                    }
                }
            },
            arranqueAntiguo: async () => {
                const main = document.querySelector("main")
                main.setAttribute("zonaCSS", "administracion/configuracion")
                const marcoElastico = document.querySelector("[componente=marcoElastico]")
                marcoElastico.style.gap = "4px"
                const transaccion = {
                    zona: "administracion/configuracion/obtenerConfiguracion"
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                if (respuestaServidor?.error) {
                    casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    const configuracionGlobal = respuestaServidor?.ok
                    const zonaHoraria = configuracionGlobal.zonaHoraria
                    const listaZonasHorarias = respuestaServidor.listaZonasHorarias
                    const horaEntradaTZ = configuracionGlobal.horaEntradaTZ
                    const horaSalidaTZ = configuracionGlobal.horaSalidaTZ
                    const contenedorConfiguracionGlobal = document.createElement("div")
                    contenedorConfiguracionGlobal.classList.add("administracion_configuracion_contenedorConfiguracion")
                    const informacion = document.createElement("div")
                    informacion.classList.add("administracion_configuracion_informacion")
                    informacion.innerText = "Determine la configuraciÃ³n global del sistema.Esta configuraciÃ³n se aplica a todo el sistema y a todos los usuarios. "
                    contenedorConfiguracionGlobal.appendChild(informacion)
                    //Zona horaria Global
                    let bloqueConfiguracion = document.createElement("div")
                    bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                    let tituloConfiguracion = document.createElement("div")
                    tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                    tituloConfiguracion.innerText = "Zona horaria de Casa Vitini"
                    bloqueConfiguracion.appendChild(tituloConfiguracion)
                    let descripcionConfiguracion = document.createElement("div")
                    descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                    descripcionConfiguracion.innerText = "La zona horaria local se aplica sobre el reloj UTC para que pueda ver la hora y las fechas en la zona horaria.Por ejemplo, en el apartado de SituaciÃ³n, en la renderizaciÃ³n de los calendarios y etc.La zona horaria debe de configurarse con la misma zona horaria de las instalaciones fÃ­sicas de pernoctacion de Casa Vitini.Entonces, el sistema de Casa Vitini puede implantarse en cualquier ordenador sin importar su reloj en zona horaria local.Es fundamental que la zona horaria del sistema sea la misma que la zona horaria de las instalaciones fÃ­sicas de pernoctaciÃ³n de Casa Vitini.El motivo de esto es que los pernoctante puedan obtener calendarios locales a la zona horaria de Casa Vitini y realizar las reservas en zona horaria local de Casa Vitini."
                    bloqueConfiguracion.appendChild(descripcionConfiguracion)
                    const listaZonaHoraria = document.createElement("select")
                    listaZonaHoraria.classList.add("administracion_configuracion_valorConfiguracionInput")
                    listaZonaHoraria.setAttribute("campo", "zonaHoraria")
                    listaZonaHoraria.setAttribute("valorInicial", zonaHoraria)
                    listaZonaHoraria.addEventListener("input", casaVitini.administracion.configuracion.controlCampo)
                    for (const zonaHorariaIterada of listaZonasHorarias) {
                        const zonaHorariaUI = zonaHorariaIterada.replaceAll("/", "/").replaceAll("_", " ")
                        const zonaHorariaOpcion = document.createElement("option");
                        zonaHorariaOpcion.text = zonaHorariaUI;
                        zonaHorariaOpcion.value = zonaHorariaIterada;
                        if (zonaHoraria === zonaHorariaIterada) {
                            zonaHorariaOpcion.selected = true;
                        }
                        listaZonaHoraria.add(zonaHorariaOpcion);
                    }
                    bloqueConfiguracion.appendChild(listaZonaHoraria)
                    contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                    //Hora de entrada TZ
                    bloqueConfiguracion = document.createElement("div")
                    bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                    tituloConfiguracion = document.createElement("div")
                    tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                    tituloConfiguracion.innerText = "Hora de entrada"
                    bloqueConfiguracion.appendChild(tituloConfiguracion)
                    descripcionConfiguracion = document.createElement("div")
                    descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                    descripcionConfiguracion.innerText = "Hora de entrada en zona horaria.Esta es la hora de entrada en la zona horaria seleccionada.Sirve para determinar la hora de entrada de las reservas en el dÃ­a de entrada"
                    bloqueConfiguracion.appendChild(descripcionConfiguracion)
                    let valorConfiguracion = document.createElement("input")
                    valorConfiguracion.setAttribute("campo", "horaEntradaTZ")
                    valorConfiguracion.setAttribute("valorInicial", horaEntradaTZ)
                    valorConfiguracion.addEventListener("input", casaVitini.administracion.configuracion.controlCampo)
                    valorConfiguracion.classList.add("administracion_configuracion_valorConfiguracionInput")
                    valorConfiguracion.value = horaEntradaTZ
                    valorConfiguracion.placeholder = "Selecciona una hora de entrada, por ejemplo 17:00"
                    bloqueConfiguracion.appendChild(valorConfiguracion)
                    contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                    //Hora de salida TZ
                    bloqueConfiguracion = document.createElement("div")
                    bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                    tituloConfiguracion = document.createElement("div")
                    tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                    tituloConfiguracion.innerText = "Hora de salida"
                    bloqueConfiguracion.appendChild(tituloConfiguracion)
                    descripcionConfiguracion = document.createElement("div")
                    descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                    descripcionConfiguracion.innerText = "Hora de salida en zona horaria.Esta es la hora de salida en la zona horaria seleccionada.Sirve para determinar la hora de salida de las reservas en el dÃ­a de salida "
                    bloqueConfiguracion.appendChild(descripcionConfiguracion)
                    valorConfiguracion = document.createElement("input")
                    valorConfiguracion.setAttribute("campo", "horaSalidaTZ")
                    valorConfiguracion.addEventListener("input", casaVitini.administracion.configuracion.controlCampo)
                    valorConfiguracion.setAttribute("valorInicial", horaSalidaTZ)
                    valorConfiguracion.classList.add("administracion_configuracion_valorConfiguracionInput")
                    valorConfiguracion.value = horaSalidaTZ
                    valorConfiguracion.placeholder = "Selecciona una hora de salida, por ejemplo 19:00 "
                    bloqueConfiguracion.appendChild(valorConfiguracion)
                    contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                    marcoElastico.appendChild(contenedorConfiguracionGlobal)
                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.setAttribute("contenedor", "botones")
                    contenedorBotones.classList.add("administracion_configuracion_contenedorBotones")
                    const botonGuardarCambios = document.createElement("div")
                    botonGuardarCambios.classList.add("administracion_configuracion_boton")
                    botonGuardarCambios.innerText = "Guardar cambios"
                    botonGuardarCambios.addEventListener("click", casaVitini.administracion.configuracion.guardarCambios)
                    contenedorBotones.appendChild(botonGuardarCambios)
                    const botonCancelarCambios = document.createElement("div")
                    botonCancelarCambios.classList.add("administracion_configuracion_boton")
                    botonCancelarCambios.addEventListener("click", casaVitini.administracion.configuracion.cancelarCambios)
                    botonCancelarCambios.innerText = "Cancelar cambios"
                    contenedorBotones.appendChild(botonCancelarCambios)
                    marcoElastico.appendChild(contenedorBotones)
                }
            },
            cancelarCambios: () => {
                const campos = document.querySelectorAll("[campo]")
                campos.forEach((campo) => {
                    campo.value = campo.getAttribute("valorInicial")
                })
                const contenedorBotones = document.querySelector("[contenedor=botones]")
                contenedorBotones.removeAttribute("style")
            },
            controlCampo: () => {
                const campos = document.querySelectorAll("[campo]")
                let estadoFinal = null
                campos.forEach((campo) => {
                    if (campo.value !== campo.getAttribute("valorInicial")) {
                        estadoFinal = "visible"
                    }
                })
                const contenedorBotones = document.querySelector("[contenedor=botones]")
                if (estadoFinal === "visible") {
                    contenedorBotones.style.display = "flex"
                } else {
                    contenedorBotones.removeAttribute("style")
                }
            },
            guardarCambios: async () => {
                const campos = document.querySelectorAll("[campo]")
                const transacccion = {
                    zona: "administracion/configuracion/guardarConfiguracion"
                }
                campos.forEach((campo) => {
                    const nombreCampo = campo.getAttribute("campo")
                    const valorCampo = campo.value
                    transacccion[nombreCampo] = valorCampo
                })
                const respuestaServidor = await casaVitini.shell.servidor(transacccion)
                if (respuestaServidor?.error) {
                    casaVitini.administracion.configuracion.cancelarCambios()
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    contenedorBotones.removeAttribute("style")
                    campos.forEach((campo) => {
                        campo.setAttribute("valorInicial", campo.value)
                    })
                }
            },
            calendariosSincronizados: {
                arranque: async () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/configuracion")
                    const marcoElastico = document.querySelector("[componente=marcoElastico]")
                    marcoElastico.style.gap = "4px"
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                    if (comandoInicial === "calendarios_sincronizados" && !granuladoURL.parametros.calendario) {
                        //await new Promise(resolve => setTimeout(resolve, 2000));
                        const divContenedorAirBnb = document.createElement("div");
                        divContenedorAirBnb.classList.add("contenedorAirBnb");
                        const divBarraHerramientas = document.createElement("div");
                        divBarraHerramientas.classList.add("barraHerramientas");
                        const pTituloContenedor = document.createElement("p");
                        pTituloContenedor.classList.add("tituloContenedor");
                        pTituloContenedor.textContent = "Calendarios sincronizados con Airbnb";
                        const aBotonMas = document.createElement("a");
                        aBotonMas.classList.add("botonMas");
                        aBotonMas.setAttribute("vista", "/administracion/configuracion/calendarios_sincronizados/crear_calendario");
                        aBotonMas.setAttribute("href", "/administracion/configuracion/calendarios_sincronizados/crear_calendario");
                        aBotonMas.setAttribute("componente", "botonGlobal");
                        aBotonMas.addEventListener("click", (boton) => {
                            boton.preventDefault()
                            const vista = boton.target.closest("[vista]").getAttribute("vista")
                            const navegacion = {
                                vista: vista,
                                tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        })
                        aBotonMas.textContent = "AÃ±adir calendario";
                        const divContenedorCalendarios = document.createElement("div");
                        divContenedorCalendarios.classList.add("contenedorCalendarios");
                        divContenedorCalendarios.setAttribute("componente", "contendorCalendariosAirbnb");
                        const pTituloInfo = document.createElement("p");
                        pTituloInfo.classList.add("tituloInfo");
                        pTituloInfo.textContent = "Esperando informaciÃ³n...";
                        //Construir la estructura del DOM
                        divBarraHerramientas.appendChild(pTituloContenedor);
                        divBarraHerramientas.appendChild(aBotonMas);
                        divContenedorAirBnb.appendChild(divBarraHerramientas);
                        divContenedorAirBnb.appendChild(divContenedorCalendarios);
                        divContenedorCalendarios.appendChild(pTituloInfo);
                        const selectorEspacioCalendarios = document.querySelector("[componente=calendariosSincronizados]")
                        selectorEspacioCalendarios.appendChild(divContenedorAirBnb);
                        const transaccion = {
                            zona: "/administracion/configuracion/calendariosSincronizados/obtenerCalendarios",
                            plataformaCalendarios: "airbnb"
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const calendariosEncontrados = respuestaServidor.ok
                            const selectorContenedor = document.querySelector("[componente=contendorCalendariosAirbnb]")
                            selectorContenedor.innerHTML = null
                            if (calendariosEncontrados.length === 0) {
                                const infoNoCalendarios = document.createElement("p")
                                infoNoCalendarios.classList.add("tituloInfo")
                                infoNoCalendarios.innerText = "No hay ningun calendario sincronizado"
                                selectorContenedor.appendChild(infoNoCalendarios)
                            } else {
                                for (const detallesDelCalendario of calendariosEncontrados) {
                                    const calendarioUID = detallesDelCalendario.calendarioUID
                                    const url = detallesDelCalendario.url
                                    const nombre = detallesDelCalendario.nombre
                                    const apartamentoIDV = detallesDelCalendario.apartamentoIDV
                                    const apartamentoUI = detallesDelCalendario.apartamentoUI
                                    const publicoUID = detallesDelCalendario.publicoUID
                                    const plataformaOrigen = detallesDelCalendario.plataformaOrigen
                                    const dataIcal = detallesDelCalendario.dataIcal
                                    const dominioActual = window.location.hostname
                                    const contenedorCalendarioIndiviudal = document.createElement("div")
                                    contenedorCalendarioIndiviudal.classList.add("contenedorCalendarioIndividual")
                                    contenedorCalendarioIndiviudal.setAttribute("calendarioUID", calendarioUID)
                                    const datosCalendario = document.createElement("div")
                                    datosCalendario.classList.add("contenedorDatosCalendario")
                                    const nombreCalendario = document.createElement("div")
                                    nombreCalendario.classList.add("nombreCalendario")
                                    nombreCalendario.innerText = nombre
                                    datosCalendario.appendChild(nombreCalendario)
                                    titulo = document.createElement("p")
                                    titulo.classList.add("tituloDatoCalendario")
                                    titulo.innerText = "Apartamento sincronizado"
                                    datosCalendario.appendChild(titulo)
                                    const apartamentoEnlazado = document.createElement("div")
                                    apartamentoEnlazado.classList.add("apartamentoEnlazado")
                                    apartamentoEnlazado.innerText = apartamentoUI + ` (${apartamentoIDV})`
                                    datosCalendario.appendChild(apartamentoEnlazado)
                                    titulo = document.createElement("p")
                                    titulo.classList.add("tituloDatoCalendario")
                                    titulo.innerText = "URL del calendario"
                                    datosCalendario.appendChild(titulo)
                                    const urlCalendarioImportado = document.createElement("div")
                                    urlCalendarioImportado.classList.add("urlCalendario")
                                    urlCalendarioImportado.innerText = url
                                    datosCalendario.appendChild(urlCalendarioImportado)
                                    titulo = document.createElement("p")
                                    titulo.classList.add("tituloDatoCalendario")
                                    titulo.innerText = "URL del calendario para exportar formato ICS"
                                    datosCalendario.appendChild(titulo)
                                    const urlCalendarioExportarICS = document.createElement("div")
                                    urlCalendarioExportarICS.classList.add("urlCalendario")
                                    urlCalendarioExportarICS.innerText = "https://" + dominioActual + "/calendarios_compartidos/formato:ics_v2/" + publicoUID
                                    datosCalendario.appendChild(urlCalendarioExportarICS)
                                    contenedorCalendarioIndiviudal.appendChild(datosCalendario)

                                    titulo = document.createElement("p")
                                    titulo.classList.add("tituloDatoCalendario")
                                    titulo.innerText = "URL del calendario para exportar formato ICS Airbnb"
                                    datosCalendario.appendChild(titulo)
                                    const urlCalendarioExportarICSAirbnbn = document.createElement("div")
                                    urlCalendarioExportarICSAirbnbn.classList.add("urlCalendario")
                                    urlCalendarioExportarICSAirbnbn.innerText = "https://" + dominioActual + "/calendarios_compartidos/formato:ics_v2_airbnb/" + publicoUID
                                    datosCalendario.appendChild(urlCalendarioExportarICSAirbnbn)
                                    contenedorCalendarioIndiviudal.appendChild(datosCalendario)


                                    const contenedorBotonesCalendario = document.createElement("div")
                                    contenedorBotonesCalendario.classList.add("contenedorBotonesCalendario")
                                    const botonEliminar = document.createElement("div")
                                    botonEliminar.classList.add("botonCalendario")
                                    botonEliminar.innerText = "Eliminar calendario"
                                    botonEliminar.addEventListener("click", () => {
                                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                                        const contenedorElimianr = document.createElement("div")
                                        contenedorElimianr.classList.add("contenedorEliminar")
                                        const titulo = document.createElement("div")
                                        titulo.classList.add("tituloInmersivo")
                                        titulo.innerText = `Eliminar el calendario sincronizado de Airbnb`
                                        contenedorElimianr.appendChild(titulo)
                                        const mensaje = document.createElement("div")
                                        mensaje.classList.add("mensaje")
                                        mensaje.innerText = `Â¿Estas de acuerdo en eliminar el calendario con nombre ${nombre} enlazado al ${apartamentoUI}?`
                                        contenedorElimianr.appendChild(mensaje)
                                        const botonEliminar = document.createElement("div")
                                        botonEliminar.classList.add("boton")
                                        botonEliminar.innerText = "Eliminar calendario definitivamente"
                                        botonEliminar.addEventListener("click", async () => {
                                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                            const metadatosPantallaCarga = {
                                                mensaje: "Actualizando calendario...",
                                                instanciaUID: instanciaUID,
                                            }
                                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                            const transaccion = {
                                                zona: "administracion/configuracion/calendariosSincronizados/airbnb/eliminarCalendario",
                                                calendarioUID: calendarioUID
                                            }
                                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                            document.querySelectorAll(`[instanciaUID="${instanciaUID}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`).forEach((pantalla) => {
                                                document.body.style.removeProperty("overflow")
                                                pantalla.remove()
                                            })
                                            const selectorCalendariosSincronizados = document.querySelector(`[componente=calendariosSincronizados]`)
                                            if (respuestaServidor?.error) {
                                                if (selectorCalendariosSincronizados) {
                                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor.error)
                                                }
                                            }
                                            if (respuestaServidor?.ok) {
                                                if (selectorCalendariosSincronizados) {
                                                    selectorCalendariosSincronizados.querySelector(`[calendarioUID="${calendarioUID}"]`).remove()
                                                }
                                            }
                                        })
                                        contenedorElimianr.appendChild(botonEliminar)
                                        const botonCancelar = document.createElement("div")
                                        botonCancelar.classList.add("boton")
                                        botonCancelar.innerText = "Cancelar y volver a la lista de calendarios"
                                        botonCancelar.addEventListener("click", () => {
                                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                        })
                                        contenedorElimianr.appendChild(botonCancelar)
                                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                        pantallaInmersiva.querySelector("[contenedor=contenidoAdvertenciaInmersiva]").appendChild(contenedorElimianr)
                                        document.body.appendChild(pantallaInmersiva)
                                    })
                                    contenedorBotonesCalendario.appendChild(botonEliminar)
                                    const botonModificar = document.createElement("a")
                                    botonModificar.classList.add("botonCalendario")
                                    botonModificar.innerText = "Modificar calendario"
                                    botonModificar.href = `/administracion/configuracion/calendarios_sincronizados/calendario:${calendarioUID}`
                                    botonModificar.addEventListener("click", (boton) => {
                                        boton.preventDefault()
                                        const vista = `/administracion/configuracion/calendarios_sincronizados/calendario:${calendarioUID}`
                                        const navegacion = {
                                            vista: vista,
                                            tipoOrigen: "menuNavegador"
                                        }
                                        casaVitini.shell.navegacion.controladorVista(navegacion)
                                    })
                                    contenedorBotonesCalendario.appendChild(botonModificar)
                                    contenedorCalendarioIndiviudal.appendChild(contenedorBotonesCalendario)
                                    selectorContenedor.appendChild(contenedorCalendarioIndiviudal)
                                }
                            }
                        }
                    } else if (granuladoURL.parametros.calendario) {
                        const calenadrioUID = granuladoURL.parametros.calendario
                        //descargamos aqui el archivo, verificamos la plataforma y en base a ello damos la plantilla correspondiente
                        const transaccion = {
                            zona: "/administracion/configuracion/calendariosSincronizados/detallesDelCalendario",
                            calendarioUID: calenadrioUID
                        }

                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                        if (respuestaServidor?.error) {
                            const selectorEspacioCalendarios = document.querySelector("[componente=calendariosSincronizados]")
                            const marcoError = document.createElement("div")
                            marcoError.classList.add("marcoError")
                            const errorInfo = document.createElement("div")
                            errorInfo.classList.add("errorInfoCalendarios")
                            errorInfo.innerText = "No existe ningÃºn calendario con este identificador, por favor revisa el identificador."
                            marcoError.appendChild(errorInfo)
                            selectorEspacioCalendarios.appendChild(marcoError)
                        }
                        if (respuestaServidor?.ok) {
                            const detallesDelCalendario = respuestaServidor.ok
                            const plataformaOrigen = detallesDelCalendario.plataformaOrigenIDV
                            if (plataformaOrigen === "airbnb") {
                                casaVitini.administracion.configuracion.calendariosSincronizados.airbnb.editarCalendarioUI(detallesDelCalendario)
                            }
                        }
                    }
                },
                airbnb: {
                    crearCalendario: {
                        arranque: async () => {
                            const main = document.querySelector("main")
                            main.setAttribute("zonaCSS", "administracion/configuracion")
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const selectorEspacioFormulario = document.querySelector("[componente=espacioFormulario_Airbnb]")
                            selectorEspacioFormulario.innerHTML = null
                            const formularioUI = await casaVitini.administracion.configuracion.calendariosSincronizados.airbnb.formularioCalendario({
                                modo: "crear"
                            })
                            formularioUI.setAttribute("instanciaUID", instanciaUID)
                            selectorEspacioFormulario.appendChild(formularioUI)
                            const botonCrearCalendario = document.createElement("div")
                            botonCrearCalendario.classList.add("botonCrearCalendario")
                            botonCrearCalendario.innerText = "Crear perfil del calenadrio sincronizado"
                            botonCrearCalendario.addEventListener("click", async () => {
                                const transaccion = {
                                    zona: "administracion/configuracion/calendariosSincronizados/airbnb/crearCalendario"
                                }
                                document.querySelectorAll("[campo]").forEach((campo) => {
                                    const nombreCampo = campo.getAttribute("campo")
                                    const valorCampo = campo.value
                                    transaccion[nombreCampo] = valorCampo
                                })
                                const metadatosPantallaCarga = {
                                    mensaje: "Creando calendario...",
                                    instanciaUID: instanciaUID,
                                }
                                document.body.style.overflow = "hidden";
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                document.querySelectorAll(`[instanciaUID="${instanciaUID}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`).forEach((pantalla) => {
                                    document.body.style.removeProperty("overflow")
                                    pantalla.remove()
                                })
                                const selectorInstanciaFormularioUI = document.querySelector(`[componente=formularioUI][instanciaUID="${instanciaUID}"]`)
                                if (respuestaServidor?.error) {
                                    if (selectorInstanciaFormularioUI) {
                                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor.error)
                                    }
                                }
                                if (respuestaServidor?.ok) {
                                    if (selectorInstanciaFormularioUI) {
                                        const nuevoUID = respuestaServidor.nuevoUID
                                        const vista = `/administracion/configuracion/calendarios_sincronizados/calendario:${nuevoUID}`
                                        const navegacion = {
                                            vista: vista,
                                            //tipoOrigen: "menuNavegador"
                                        }
                                        casaVitini.shell.navegacion.controladorVista(navegacion)
                                    }
                                }
                            })
                            selectorEspacioFormulario.appendChild(botonCrearCalendario)
                        }
                    },
                    formularioCalendario: async (data) => {

                        const modo = data.modo

                        const formularioUI = document.createElement("div")
                        formularioUI.classList.add("formularioUI")
                        formularioUI.setAttribute("componente", "formularioUI")
                        let definicion = document.createElement("p")
                        definicion.classList.add("plataforma")
                        definicion.innerText = "Plataforma Airbnb"
                        //formularioUI.appendChild(definicion)
                        definicion = document.createElement("p")
                        definicion.classList.add("definicion")
                        definicion.innerText = "Define un nombre para el calendario.Utiliza este nombre en el futuro para poder recordar algo descriptivo de este calendario.Pon el nombre que creas mÃ¡s recordativo."
                        formularioUI.appendChild(definicion)
                        const nombreCalendario = document.createElement("input")
                        nombreCalendario.classList.add("nombreCalendario")
                        nombreCalendario.setAttribute("campo", "nombre")
                        nombreCalendario.placeholder = "Escribe un nombre para este calendario"
                        formularioUI.appendChild(nombreCalendario)
                        definicion = document.createElement("p")
                        definicion.classList.add("definicion")
                        definicion.innerText = "Selecciona el apartamento con el que vas a enlazar este calendario.Los calendarios de Airbnb se enlazan por apartamento.Cada calendario de airbnb es un apartamento"
                        formularioUI.appendChild(definicion)
                        const tipoApartamentoUI = document.createElement("select")
                        tipoApartamentoUI.classList.add("listaApartamentos")
                        tipoApartamentoUI.setAttribute("campo", "apartamentoIDV")
                        tipoApartamentoUI.addEventListener("change", casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.controladorSelectorRangoTemporalUI)
                        const tipoApartamentoInicio = document.createElement("option");
                        tipoApartamentoInicio.value = "";
                        tipoApartamentoInicio.selected = true;
                        tipoApartamentoInicio.disabled = true;
                        tipoApartamentoInicio.text = "Seleccionar el apartamento a enlazar";
                        tipoApartamentoUI.add(tipoApartamentoInicio);
                        const apartamentosArray = await casaVitini.administracion.componentes.obtenerApartamentos()
                        if (apartamentosArray.length === 0) {
                            const opcion = document.createElement("option");
                            opcion.value = "";
                            opcion.disabled = true;
                            opcion.text = "No hay ningun apartamento disponible";
                            tipoApartamentoUI.add(opcion);
                        }
                        if (apartamentosArray.length > 0) {
                            apartamentosArray.forEach((detallesApartamento) => {
                                const apartamentoIDV = detallesApartamento.apartamentoIDV
                                const aparatmentoUI = detallesApartamento.apartamentoUI
                                const opcion = document.createElement("option");
                                opcion.value = apartamentoIDV;
                                opcion.text = aparatmentoUI;
                                tipoApartamentoUI.add(opcion);
                            })
                        }
                        formularioUI.appendChild(tipoApartamentoUI)

                        if (modo === "editar") {

                            const contenedorURL = document.createElement("div")
                            contenedorURL.classList.add(
                                "padding10",
                                "flexVertical",
                                "gap6"
                            )
                            formularioUI.appendChild(contenedorURL)

                            definicion = document.createElement("p")
                            definicion.innerText = "Url del calendario de Casa Vitini para exportar. Copia esta url en el otro sistema para sincronziar el calenedario de Casa Vitini con la plataforma de terceros compatible con ICS"
                            contenedorURL.appendChild(definicion)

                            const icsv2ui = document.createElement("p")
                            icsv2ui.innerText = "Formato: ICS V2"
                            icsv2ui.classList.add(
                                "negrita"
                            )
                            contenedorURL.appendChild(icsv2ui)

                            const urlCalendarioExport = document.createElement("p")
                            urlCalendarioExport.classList.add(
                                "breakWordkAll"
                            )
                            urlCalendarioExport.setAttribute("data", "urlExportacion")
                            contenedorURL.appendChild(urlCalendarioExport)

                            const icsv2uiAirbnb = document.createElement("p")
                            icsv2uiAirbnb.innerText = "Formato: ICS V2 Airbnb"
                            icsv2uiAirbnb.classList.add(
                                "negrita"
                            )
                            contenedorURL.appendChild(icsv2uiAirbnb)

                            const urlCalendarioExport_airbnb = document.createElement("p")
                            urlCalendarioExport_airbnb.classList.add(
                                "breakWordkAll"
                            )
                            urlCalendarioExport_airbnb.setAttribute("data", "urlExportacionAirbnbn")
                            contenedorURL.appendChild(urlCalendarioExport_airbnb)


                            definicion = document.createElement("p")
                            definicion.classList.add("definicion")
                            definicion.innerText = "Copia aquÃ­ la url del calendario de Airbnb, la url debe de ser la que comparte Airbnb para sincronizar calendarios en formato iCal, la url debe de estar en https"
                            formularioUI.appendChild(definicion)
                            const urlCalendario = document.createElement("input")
                            urlCalendario.classList.add("nombreCalendario")
                            urlCalendario.setAttribute("campo", "url")
                            urlCalendario.placeholder = "Escribe la url del calendario"
                            formularioUI.appendChild(urlCalendario)
                        }

                        return formularioUI
                    },
                    editarCalendarioUI: async (detallesDelCalendario) => {

                        const calendarioUID = detallesDelCalendario.calendarioUID
                        const nombre = detallesDelCalendario.nombre
                        const url = detallesDelCalendario.url
                        const apartamentoIDV = detallesDelCalendario.apartamentoIDV
                        const plataformaOrigen = detallesDelCalendario.plataformaOrigenIDV
                        const apartamentoUI = detallesDelCalendario.apartamentoUI
                        const publicoUID = detallesDelCalendario.publicoUID
                        const dominioActual = window.location.hostname

                        const urlExportacion = "https://" + dominioActual + "/calendarios_compartidos/formato:ics_v2/" + publicoUID
                        const urlExportacionAirbnb = "https://" + dominioActual + "/calendarios_compartidos/formato:ics_v2_airbnb/" + publicoUID


                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const plataformaOrigenUI = plataformaOrigen.charAt(0).toUpperCase() + plataformaOrigen.slice(1);
                        const selectorTitulo = document.querySelector("[componente=titutoGlobal]")
                        selectorTitulo.innerText = `Detalles del calendario de ${plataformaOrigenUI}`
                        const selectorEspacioCalendarios = document.querySelector("[componente=calendariosSincronizados]")
                        const formularioUI = await casaVitini.administracion.configuracion.calendariosSincronizados.airbnb.formularioCalendario({
                            modo: "editar"
                        });
                        formularioUI.setAttribute("instanciaUID", instanciaUID)
                        formularioUI.setAttribute("calendarioUID", calendarioUID)
                        const nombreInput = formularioUI.querySelector("[campo=nombre]");
                        nombreInput.value = nombre;
                        nombreInput.setAttribute("valorInicial", nombre);
                        const apartamentoIDVSelect = formularioUI.querySelector("[campo=apartamentoIDV]");
                        apartamentoIDVSelect.value = apartamentoIDV;
                        apartamentoIDVSelect.setAttribute("valorInicial", apartamentoIDV);
                        const urlExportacionUI = formularioUI.querySelector("[data=urlExportacion]");
                        urlExportacionUI.innerText = urlExportacion;
                        const urlExportacionAirbnbUI = formularioUI.querySelector("[data=urlExportacionAirbnbn]");
                        urlExportacionAirbnbUI.innerText = urlExportacionAirbnb;
                        const urlInput = formularioUI.querySelector("[campo=url]");
                        urlInput.value = url;
                        urlInput.setAttribute("valorInicial", url);
                        selectorEspacioCalendarios.appendChild(formularioUI);
                        const marcoBotones = document.createElement("div")
                        marcoBotones.classList.add("marcoBotones")
                        const botonCrearCalendario = document.createElement("div")
                        botonCrearCalendario.classList.add("botonCrearCalendario")
                        botonCrearCalendario.innerText = "Guardar cambios"
                        botonCrearCalendario.addEventListener("click", async () => {
                            const transaccion = {
                                zona: "administracion/configuracion/calendariosSincronizados/airbnb/actualizarCalendario",
                                calendarioUID: calendarioUID
                            }
                            document.querySelectorAll("[campo]").forEach((campo) => {
                                const nombreCampo = campo.getAttribute("campo")
                                const valorCampo = campo.value
                                transaccion[nombreCampo] = valorCampo

                            })
                            const metadatosPantallaCarga = {
                                mensaje: "Actualizando calendario...",
                                instanciaUID: instanciaUID,
                            }
                            document.body.style.overflow = "hidden";
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            document.querySelectorAll(`[instanciaUID="${instanciaUID}"][pantallaSuperpuesta=pantallaCargaSuperpuesta]`).forEach((pantalla) => {
                                document.body.style.removeProperty("overflow")
                                pantalla.remove()
                            })
                            const selectorInstanciaFormularioUI = document.querySelector(`[componente=formularioUI][instanciaUID="${instanciaUID}"]`)
                            if (respuestaServidor?.error) {
                                if (selectorInstanciaFormularioUI) {
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor.error)
                                }
                            }
                            if (respuestaServidor?.ok) {
                                if (selectorInstanciaFormularioUI) {
                                    document.querySelectorAll("[campo]").forEach((campo) => {
                                        const valorCampo = campo.value
                                        const valorInicial = campo.getAttribute("valorInicial")
                                        if (valorCampo !== valorInicial) {
                                            campo.setAttribute("valorInicial", valorCampo)
                                        }
                                    })
                                }
                            }
                        })
                        marcoBotones.appendChild(botonCrearCalendario)
                        const botonCancelar = document.createElement("div")
                        botonCancelar.classList.add("botonCrearCalendario")
                        botonCancelar.innerText = "Restablecer cambios"
                        botonCancelar.addEventListener("click", async () => {
                            document.querySelectorAll("[campo]").forEach((campo) => {
                                const valorInicial = campo.getAttribute("valorInicial")
                                campo.value = valorInicial
                            })
                        })
                        marcoBotones.appendChild(botonCancelar)
                        selectorEspacioCalendarios.appendChild(marcoBotones)
                    }
                },
            },
            limitesReservaPublica: {
                arranque: async () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/configuracion")
                    const marcoElastico = document.querySelector("[componente=marcoElastico]")
                    marcoElastico.style.gap = "4px"
                    const transaccion = {
                        zona: "administracion/configuracion/limitesReservaPublica/obtenerConfiguracion"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const configuracionGlobal = respuestaServidor?.ok
                        const diasMaximosReserva = configuracionGlobal.diasMaximosReserva
                        const diasAntelacionReserva = configuracionGlobal.diasAntelacionReserva
                        const limiteFuturoReserva = configuracionGlobal.limiteFuturoReserva
                        const horaLimiteDelMismoDia = configuracionGlobal?.horaLimiteDelMismoDia || ""

                        const contenedorConfiguracionGlobal = document.createElement("div")
                        contenedorConfiguracionGlobal.classList.add("administracion_configuracion_contenedorConfiguracion")
                        const informacion = document.createElement("div")
                        informacion.classList.add("administracion_configuracion_informacion")
                        informacion.innerText = "Determina los lÃ­mites de las reservas que pre confirman los clientes desde Casa Vitini. A diferencia de las reservas que se confirman en el panel de administraciÃ³n. Las reservas que preconfirman los clientes tienen unos lÃ­mites. Como unos dÃ­as de antelaciÃ³n, nÃºmero de dÃ­as mÃ¡ximos de duraciÃ³n o un lÃ­mite futuro para aceptar reservas hasta un punto en el futuro."
                        contenedorConfiguracionGlobal.appendChild(informacion)
                        let bloqueConfiguracion = document.createElement("div")
                        bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                        let tituloConfiguracion = document.createElement("div")
                        tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                        tituloConfiguracion.innerText = "Dias de antelaciÃ³n"
                        bloqueConfiguracion.appendChild(tituloConfiguracion)
                        let descripcionConfiguracion = document.createElement("div")
                        descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                        descripcionConfiguracion.innerText = "Determina el nÃºmero de dÃ­as de antelaciÃ³n escribiendo el nÃºmero de dÃ­as de antelaciÃ³n.Si, por ejemplo, escribes un mÃ­nimo de diez dÃ­as de antelaciÃ³n, se aceptarÃ¡n reservas a partir del dÃ­a nÃºmero 11 desde el dÃ­a presente. El dÃ­a presente cuenta como dÃ­a 0. Si, por ejemplo quisieras aceptar reservas para el mismo dÃ­a, entonces establece los dÃ­as de antelaciÃ³n en 0"
                        bloqueConfiguracion.appendChild(descripcionConfiguracion)
                        let valorConfiguracion = document.createElement("input")
                        valorConfiguracion.setAttribute("campo", "diasAntelacionReserva")
                        valorConfiguracion.setAttribute("valorInicial", diasAntelacionReserva)
                        valorConfiguracion.addEventListener("input", casaVitini.administracion.configuracion.limitesReservaPublica.controlCampo)
                        valorConfiguracion.classList.add("administracion_configuracion_valorConfiguracionInput")
                        valorConfiguracion.value = diasAntelacionReserva
                        valorConfiguracion.placeholder = "Determina el numero de dÃ­as de antelaciÃ³n"
                        bloqueConfiguracion.appendChild(valorConfiguracion)
                        const horaLimite = casaVitini.administracion.configuracion.limitesReservaPublica.componentesUI.horaDelMismoDia(horaLimiteDelMismoDia)
                        bloqueConfiguracion.appendChild(horaLimite)

                        contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                        bloqueConfiguracion = document.createElement("div")
                        bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                        tituloConfiguracion = document.createElement("div")
                        tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                        tituloConfiguracion.innerText = "DuraciÃ³n mÃ¡xima de la reserva"
                        bloqueConfiguracion.appendChild(tituloConfiguracion)
                        descripcionConfiguracion = document.createElement("div")
                        descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                        descripcionConfiguracion.innerText = "Determina el numero maximo de dÃ­as con noche que puede tener una reserva "
                        bloqueConfiguracion.appendChild(descripcionConfiguracion)
                        valorConfiguracion = document.createElement("input")
                        valorConfiguracion.setAttribute("campo", "diasMaximosReserva")
                        valorConfiguracion.addEventListener("input", casaVitini.administracion.configuracion.limitesReservaPublica.controlCampo)
                        valorConfiguracion.setAttribute("valorInicial", diasMaximosReserva)
                        valorConfiguracion.classList.add("administracion_configuracion_valorConfiguracionInput")
                        valorConfiguracion.value = diasMaximosReserva
                        valorConfiguracion.placeholder = "Selecciona una hora de salida, por ejemplo 19:00 "
                        bloqueConfiguracion.appendChild(valorConfiguracion)
                        contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                        bloqueConfiguracion = document.createElement("div")
                        bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                        tituloConfiguracion = document.createElement("div")
                        tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                        tituloConfiguracion.innerText = "LÃ­mite futuro para aceptar reservas"
                        bloqueConfiguracion.appendChild(tituloConfiguracion)
                        descripcionConfiguracion = document.createElement("div")
                        descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                        descripcionConfiguracion.innerText = "Determina el nÃºmero mÃ¡ximo de dÃ­as en lo que se estÃ¡ dispuesto a aceptar una reserva. Por ejemplo, si no aceptas reservas mÃ¡s allÃ¡ de un aÃ±o."
                        bloqueConfiguracion.appendChild(descripcionConfiguracion)
                        valorConfiguracion = document.createElement("input")
                        valorConfiguracion.setAttribute("campo", "limiteFuturoReserva")
                        valorConfiguracion.addEventListener("input", casaVitini.administracion.configuracion.limitesReservaPublica.controlCampo)
                        valorConfiguracion.setAttribute("valorInicial", limiteFuturoReserva)
                        valorConfiguracion.classList.add("administracion_configuracion_valorConfiguracionInput")
                        valorConfiguracion.value = limiteFuturoReserva
                        valorConfiguracion.placeholder = "Determinal el limite futuro en numero de dias"
                        bloqueConfiguracion.appendChild(valorConfiguracion)
                        contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                        marcoElastico.appendChild(contenedorConfiguracionGlobal)

                        const contenedorBotones = document.createElement("div")
                        contenedorBotones.setAttribute("contenedor", "botones")
                        contenedorBotones.classList.add("administracion_configuracion_contenedorBotones")
                        const botonGuardarCambios = document.createElement("div")
                        botonGuardarCambios.classList.add("administracion_configuracion_boton")
                        botonGuardarCambios.innerText = "Guardar cambios"
                        botonGuardarCambios.addEventListener("click", casaVitini.administracion.configuracion.limitesReservaPublica.guardarCambios)
                        contenedorBotones.appendChild(botonGuardarCambios)
                        const botonCancelarCambios = document.createElement("div")
                        botonCancelarCambios.classList.add("administracion_configuracion_boton")
                        botonCancelarCambios.addEventListener("click", casaVitini.administracion.configuracion.limitesReservaPublica.cancelarCambios)
                        botonCancelarCambios.innerText = "Cancelar cambios"
                        contenedorBotones.appendChild(botonCancelarCambios)
                        marcoElastico.appendChild(contenedorBotones)
                    }
                },
                cancelarCambios: () => {
                    const campos = document.querySelectorAll("[campo]")
                    campos.forEach((campo) => {
                        campo.value = campo.getAttribute("valorInicial")
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    contenedorBotones.removeAttribute("style")
                },
                controlCampo: () => {
                    const campos = document.querySelectorAll("[campo]")
                    let estadoFinal = null
                    campos.forEach((campo) => {
                        if (campo.value !== campo.getAttribute("valorInicial")) {
                            estadoFinal = "visible"
                        }
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    if (estadoFinal === "visible") {
                        contenedorBotones.style.display = "flex"
                    } else {
                        contenedorBotones.removeAttribute("style")
                    }
                },
                guardarCambios: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Actualizando lÃ­mites de las reservas pÃºblicas..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const campos = document.querySelectorAll("[campo]")
                    const transacccion = {
                        zona: "administracion/configuracion/limitesReservaPublica/guardarConfiguracion"
                    }
                    campos.forEach((campo) => {
                        const nombreCampo = campo.getAttribute("campo")
                        const valorCampo = campo.value
                        transacccion[nombreCampo] = String(valorCampo)
                    })
                    const respuestaServidor = await casaVitini.shell.servidor(transacccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.administracion.configuracion.cancelarCambios()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const contenedorBotones = document.querySelector("[contenedor=botones]")
                        contenedorBotones.removeAttribute("style")
                        campos.forEach((campo) => {
                            campo.setAttribute("valorInicial", campo.value)
                        })
                    }
                },
                componentesUI: {
                    horaDelMismoDia: (horaLimiteDelMismoDia) => {
                        const contenedor = document.createElement("div")
                        contenedor.classList.add(
                            "ocultoInicialmente",
                            "flexVertical",
                            "padding6",
                            "gap6",
                            "backgroundGrey1",
                            "borderRadius12"
                        )

                        const descripcion = document.createElement("p")
                        descripcion.classList.add(
                            "padding6"
                        )
                        descripcion.innerText = `Cuando seleccionas 0 dÃ­as de antelaciÃ³n, permites aceptar reservas el mismo dÃ­a presente. Es necesario determinar una hora mÃ¡xima para aceptar reservas el mismo dÃ­a. Por ejemplo, puedes no aceptar reservas mÃ¡s tarde de las 11 de la maÃ±ana. Escribe la hora en formato 24 H y con los minutos. Por ejemplo, si la hora mÃ¡xima para hacer una reserva en el mismo dÃ­a es a las once en punto de la maÃ±ana, entonces escribe 11:00. Si es a las nueve de la maÃ±ana en punto, entonces escribe 09:00. Siempre escribe los dos dÃ­gitos tanto para la hora como para los minutos. Este campo solo es obligatorio rellenarlo cuando los dÃ­as de antelaciÃ³n son 0, si no puedes dejarlo en blanco.`
                        contenedor.appendChild(descripcion)

                        const campoHora = document.createElement("input")
                        campoHora.classList.add("administracion_configuracion_valorConfiguracionInput")
                        campoHora.placeholder = "Escribe la hora en formato 24H, tal que asi 00:00"
                        campoHora.setAttribute("campo", "horaLimiteDelMismoDia")
                        campoHora.addEventListener("input", casaVitini.administracion.configuracion.limitesReservaPublica.controlCampo)
                        campoHora.setAttribute("valorInicial", horaLimiteDelMismoDia)
                        campoHora.value = horaLimiteDelMismoDia
                        contenedor.appendChild(campoHora)
                        return contenedor
                    }

                }
            },
            interruptores: {
                arranque: async () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/configuracion")
                    const marcoElastico = document.querySelector("[componente=marcoElastico]")
                    marcoElastico.style.gap = "4px"
                    const transaccion = {
                        zona: "administracion/configuracion/interruptores/obtenerInterruptores"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                    if (respuestaServidor?.error) {
                        casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const configuracionGlobal = respuestaServidor.ok
                        const aceptarReservasPublicas = configuracionGlobal.aceptarReservasPublicas
                        const estados = [
                            {
                                estadoUI: "Activado",
                                estadoIDV: "activado"
                            },
                            {
                                estadoUI: "Desactivado",
                                estadoIDV: "desactivado"
                            }
                        ]
                        const contenedorConfiguracionGlobal = document.createElement("div")
                        contenedorConfiguracionGlobal.classList.add("administracion_configuracion_contenedorConfiguracion")
                        const informacion = document.createElement("div")
                        informacion.classList.add("administracion_configuracion_informacion")
                        informacion.innerText = "Los interruptores permiten activar o desactivar funciones especÃ­ficas. Como, por ejemplo, permitir reservas pÃºblicas o no.Puede activar y desactivar los interruptores y tener un control mÃ¡s modular del sistema."
                        contenedorConfiguracionGlobal.appendChild(informacion)
                        bloqueConfiguracion = document.createElement("div")
                        bloqueConfiguracion.classList.add("administracion_configuracion_bloqueConfiguracion")
                        tituloConfiguracion = document.createElement("div")
                        tituloConfiguracion.classList.add("administracion_configuracion_tituloConfiguracion")
                        tituloConfiguracion.innerText = "Permitir reservas pÃºblicas"
                        bloqueConfiguracion.appendChild(tituloConfiguracion)
                        descripcionConfiguracion = document.createElement("div")
                        descripcionConfiguracion.classList.add("administracion_configuracion_descripcion")
                        descripcionConfiguracion.innerText = "Este interruptor determina si se deben permitir reservas pÃºblicas ahora mismo. Si el interruptor estÃ¡ activado, personas en todo el mundo podrÃ¡n pre confirmar reservas desde Casa Vitini."
                        bloqueConfiguracion.appendChild(descripcionConfiguracion)
                        const io_aceptarReservasPublicas_UI = document.createElement("select")
                        io_aceptarReservasPublicas_UI.setAttribute("interruptor", "aceptarReservasPublicas")
                        io_aceptarReservasPublicas_UI.classList.add("administracion_configuracion_valorConfiguracionInput")
                        io_aceptarReservasPublicas_UI.setAttribute("valorInicial", aceptarReservasPublicas)
                        io_aceptarReservasPublicas_UI.addEventListener("change", (e) => {
                            const metadatos = {
                                interruptorIDV: "aceptarReservasPublicas",
                                estado: e.target.value
                            }
                            e.target.style.pointerEvents = "none"
                            casaVitini.administracion.configuracion.interruptores.actualizarInterruptor(metadatos)
                        })
                        bloqueConfiguracion.appendChild(io_aceptarReservasPublicas_UI)
                        let estadoInicial = document.createElement("option")
                        estadoInicial.value = "";
                        estadoInicial.disabled = true;
                        if (!aceptarReservasPublicas) {
                            estadoInicial.selected = true;
                        }
                        estadoInicial.text = "Seleccionar el estado del interruptor";
                        io_aceptarReservasPublicas_UI.add(estadoInicial);
                        for (const detallesDelEstado of estados) {
                            const estadoIDV = detallesDelEstado.estadoIDV
                            const estadoUI = detallesDelEstado.estadoUI
                            const opcion = document.createElement("option");
                            opcion.value = estadoIDV;
                            opcion.text = estadoUI;
                            if (estadoIDV === aceptarReservasPublicas) {
                                opcion.selected = true;
                            }
                            io_aceptarReservasPublicas_UI.add(opcion);
                        }
                        contenedorConfiguracionGlobal.appendChild(bloqueConfiguracion)
                        marcoElastico.appendChild(contenedorConfiguracionGlobal)
                    }
                },
                cancelarCambios: () => {
                    const campos = document.querySelectorAll("[campo]")
                    campos.forEach((campo) => {
                        campo.value = campo.getAttribute("valorInicial")
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    contenedorBotones.removeAttribute("style")
                },
                controlCampo: () => {
                    const campos = document.querySelectorAll("[campo]")
                    let estadoFinal = null
                    campos.forEach((campo) => {
                        if (campo.value !== campo.getAttribute("valorInicial")) {
                            estadoFinal = "visible"
                        }
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    if (estadoFinal === "visible") {
                        contenedorBotones.style.display = "flex"
                    } else {
                        contenedorBotones.removeAttribute("style")
                    }
                },
                actualizarInterruptor: async (interruptor) => {
                    const seccionRenderizadaOrigen = document.querySelector("main")
                    const seccionUID = seccionRenderizadaOrigen.getAttribute("instanciaUID")
                    const interruptorIDV = interruptor.interruptorIDV
                    const estado = interruptor.estado
                    const selectorListaEstadosInterruptor = seccionRenderizadaOrigen.querySelector(`[interruptor=${interruptorIDV}]`)
                    const valorInicial = selectorListaEstadosInterruptor.getAttribute("valorInicial")
                    const estadoSoliciado = selectorListaEstadosInterruptor.querySelector(`option[value=${estado}]`)
                    let procesandoEstadoUI
                    if (estado === "activado") {
                        procesandoEstadoUI = "Activando..."
                    }
                    if (estado === "desactivado") {
                        procesandoEstadoUI = "Desactivando..."
                    }
                    estadoSoliciado.text = procesandoEstadoUI
                    const transacccion = {
                        zona: "administracion/configuracion/interruptores/actualizarEstado",
                        interruptorIDV: interruptorIDV,
                        estado: estado
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transacccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${seccionUID}"]`)
                    if (!seccionRenderizada) { return }
                    selectorListaEstadosInterruptor.removeAttribute("style")
                    if (respuestaServidor?.error) {
                        let estadoInicialUI
                        if (estado === "activado") {
                            estadoInicialUI = "Activado"
                        }
                        if (estado === "desactivado") {
                            estadoInicialUI = "Desactivado"
                        }
                        estadoSoliciado.text = estadoInicialUI
                        selectorListaEstadosInterruptor.value = valorInicial
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        let estadoFinalUI
                        if (estado === "activado") {
                            estadoFinalUI = "Activado"
                        }
                        if (estado === "desactivado") {
                            estadoFinalUI = "Desactivado"
                        }
                        estadoSoliciado.text = estadoFinalUI
                        selectorListaEstadosInterruptor.setAttribute("valorInicial", estado)
                    }
                }
            },
            mensajesEnPortada: {

                arranque: async () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/configuracion/mensajesEnPortada")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                    const soloDigitos = /^\d+$/;

                    if (comandoInicial === "mensajes_en_portada") {
                        casaVitini.administracion.configuracion.mensajesEnPortada.portadaUI()
                    } else if (soloDigitos.test(comandoInicial)) {
                        const transaccion = {
                            zona: "administracion/configuracion/mensajesEnPortada/detallesDelMensaje",
                            mensajeUID: comandoInicial
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)

                        if (!seccionRenderizada) { return }
                        if (respuestaServidor.error) {
                            const titulo = document.querySelector(".titulo")
                            titulo.innerText = "No existe ningÃºn mensaje de portada con el identificador: " + comandoInicial

                        }
                        main.setAttribute("zonaCSS", "administracion/configuracion/mensajesEnPortada/detallesDelMensaje")
                        casaVitini.administracion.configuracion.mensajesEnPortada.detallesDelMensaje.mensajeUI(respuestaServidor.ok)
                    } else {
                        const info = {
                            titulo: "Impuesto inexistente",
                            descripcion: "El impuesto al que hace referencia la URL no existe.Revisa el identificador.QuizÃ¡s fue un impuesto que tuviste hace un tiempo y que borraste"
                        }
                        casaVitini.ui.componentes.mensajeSimple(info)
                    }

                },
                portadaUI: async () => {
                    const marcoElastico = document.querySelector("[componente=marcoElastico]")
                    marcoElastico.innerHTML = null
                    const titulo = document.querySelector(".titulo")
                    titulo.innerText = "Mensajes en portada"

                    const transaccion = {
                        zona: "administracion/configuracion/mensajesEnPortada/obtenerMensajes"
                    }

                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)


                    if (respuestaServidor?.error) {
                        casaVitini.shell.controladoresUI.ocultarMenusVolatiles()
                        titulo.innerText = respuestaServidor?.error
                    }
                    if (respuestaServidor?.ok) {
                        const mensajesEnPortada = respuestaServidor.ok

                        const contenedorConfiguracionGlobal = document.createElement("div")
                        contenedorConfiguracionGlobal.classList.add("administracion_configuracion_contenedorConfiguracion")
                        const informacion = document.createElement("div")
                        informacion.classList.add("administracion_configuracion_informacion")
                        informacion.innerText = "Los mensajes en portada son textos que aparecen en portada."
                        contenedorConfiguracionGlobal.appendChild(informacion)

                        const contenedor = document.createElement("div")
                        contenedor.classList.add("contenedor")

                        const contenedorBotones = document.createElement("div")
                        contenedorBotones.classList.add("contenedorBotones")

                        const botonNuevoMensaje = document.createElement("a")
                        botonNuevoMensaje.classList.add("botonNuevoMensaje")
                        botonNuevoMensaje.innerText = "Nuevo mensaje en portada"
                        botonNuevoMensaje.setAttribute("href", "/administracion/configuracion/mensajes_en_portada/nuevo")
                        botonNuevoMensaje.setAttribute("vista", "/administracion/configuracion/mensajes_en_portada/nuevo")
                        botonNuevoMensaje.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        contenedorBotones.appendChild(botonNuevoMensaje)

                        contenedorBotones.appendChild(botonNuevoMensaje)

                        contenedor.appendChild(contenedorBotones)

                        const contenedorListaMensajes = document.createElement("div")
                        contenedorListaMensajes.classList.add("contenedorListaMensajes")

                        mensajesEnPortada.sort((a, b) => a.posicion - b.posicion);
                        const numeroTotalMensajes = mensajesEnPortada.length


                        let posicionContenedor = 0
                        for (const detallesDelMensaje of mensajesEnPortada) {

                            const mensajeUID = detallesDelMensaje.mensajeUID
                            const mensaje = detallesDelMensaje.mensaje
                            const estadoIDV = detallesDelMensaje.estadoIDV
                            const posicion = detallesDelMensaje.posicion

                            const configuracionMensaje = {
                                mensajeUID: mensajeUID,
                                mensaje: mensaje,
                                estadoIDV: estadoIDV,
                                posicion: posicion,
                                numeroTotalMensajes: numeroTotalMensajes
                            }
                            const mensajeUI = casaVitini.administracion.configuracion.mensajesEnPortada.mensajeUI(configuracionMensaje)
                            posicionContenedor = posicionContenedor + 1

                            const contenedorDePosicion = document.createElement("div")
                            contenedorDePosicion.classList.add("contenedorDePosicion")
                            contenedorDePosicion.setAttribute("posicion", posicionContenedor)

                            contenedorDePosicion.appendChild(mensajeUI)
                            contenedorListaMensajes.appendChild(contenedorDePosicion)

                        }
                        contenedor.appendChild(contenedorListaMensajes)
                        marcoElastico.appendChild(contenedor)
                    }
                },
                mensajeUI: (detallesDelMensaje) => {
                    const estados = {
                        activado: "Activado",
                        desactivado: "Desactivado"
                    }

                    const mensajeUID = detallesDelMensaje.mensajeUID
                    const mensaje = detallesDelMensaje.mensaje
                    const estadoIDV = detallesDelMensaje.estadoIDV
                    const posicion = Number(detallesDelMensaje.posicion)
                    const numeroTotalMensajes = detallesDelMensaje.numeroTotalMensajes


                    const contenedorMensaje = document.createElement("div")
                    contenedorMensaje.classList.add("contenedorMensaje")
                    contenedorMensaje.setAttribute("mensajeUID", mensajeUID)

                    const textoDelMensaje = document.createElement("div")
                    textoDelMensaje.classList.add("textoDelMensaje")
                    textoDelMensaje.innerText = mensaje
                    contenedorMensaje.appendChild(textoDelMensaje)

                    const contenedorBotonesMensaje = document.createElement("div")
                    contenedorBotonesMensaje.classList.add("contenedorBotonesMensaje")

                    const selectorEstado = document.createElement("select")
                    selectorEstado.setAttribute("componente", "selectorEstado")
                    selectorEstado.setAttribute("valorInicial", estadoIDV)
                    selectorEstado.classList.add("selector")
                    selectorEstado.addEventListener("change", (e) => {
                        const metadatos = {
                            estadoSeleccionado: e.target.value,
                            mensajeUID: mensajeUID
                        }
                        casaVitini.administracion.configuracion.mensajesEnPortada.actualizarEstado(metadatos)
                    })

                    const opcion = document.createElement("option");
                    opcion.text = "Seleccionar el estado del mensaje"
                    opcion.disabled = "true"
                    selectorEstado.add(opcion);

                    for (const [estadoIDV_, estadoUI] of Object.entries(estados)) {
                        const opcion = document.createElement("option");
                        opcion.value = estadoIDV_;
                        opcion.text = estadoUI
                        if (estadoIDV_ === estadoIDV) {
                            opcion.selected = "true"
                        }
                        selectorEstado.add(opcion);
                    }

                    contenedorBotonesMensaje.appendChild(selectorEstado)

                    const selectorPosicion = document.createElement("select")
                    selectorPosicion.classList.add("selector")
                    selectorPosicion.setAttribute("componente", "selectorPosicion")
                    selectorPosicion.addEventListener("change", (e) => {
                        const metadatos = {
                            nuevaPosicion: e.target.value,
                            mensajeUIDActual: mensajeUID
                        }
                        casaVitini.administracion.configuracion.mensajesEnPortada.moverPosicion(metadatos)
                    })

                    for (let index = 0; index < numeroTotalMensajes; index++) {
                        const posicionLoop = index + 1
                        const opcion = document.createElement("option");
                        opcion.value = posicionLoop;
                        if (posicion === posicionLoop) {
                            opcion.text = "Posicion " + posicionLoop;
                            opcion.disabled = "true"
                            opcion.selected = "true"
                        } else {
                            opcion.text = "Mover a la posicion " + posicionLoop;
                        }
                        selectorPosicion.add(opcion);
                    }
                    contenedorBotonesMensaje.appendChild(selectorPosicion)

                    const botonModificar = document.createElement("div")
                    botonModificar.classList.add("boton")
                    botonModificar.innerText = "Modificar mensaje"
                    botonModificar.setAttribute("href", "/administracion/configuracion/mensajes_en_portada/" + mensajeUID)
                    botonModificar.setAttribute("vista", "/administracion/configuracion/mensajes_en_portada/" + mensajeUID)
                    botonModificar.addEventListener("click", casaVitini.administracion.gestion_de_ofertas.traductorCambioVista)
                    contenedorBotonesMensaje.appendChild(botonModificar)

                    const botonEliminar = document.createElement("div")
                    botonEliminar.classList.add("boton")
                    botonEliminar.innerText = "Eliminar mensaje"
                    botonEliminar.addEventListener("click", () => {
                        casaVitini.administracion.configuracion.mensajesEnPortada.eliminarMensaje.UI({ mensajeUID })
                    })
                    contenedorBotonesMensaje.appendChild(botonModificar)

                    contenedorBotonesMensaje.appendChild(botonEliminar)

                    contenedorMensaje.appendChild(contenedorBotonesMensaje)
                    return contenedorMensaje


                },
                cancelarCambios: () => {
                    const campos = document.querySelectorAll("[campo]")
                    campos.forEach((campo) => {
                        campo.value = campo.getAttribute("valorInicial")
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    contenedorBotones.removeAttribute("style")
                },
                controlCampo: () => {
                    const campos = document.querySelectorAll("[campo]")
                    let estadoFinal = null
                    campos.forEach((campo) => {
                        if (campo.value !== campo.getAttribute("valorInicial")) {
                            estadoFinal = "visible"
                        }
                    })
                    const contenedorBotones = document.querySelector("[contenedor=botones]")
                    if (estadoFinal === "visible") {
                        contenedorBotones.style.display = "flex"
                    } else {
                        contenedorBotones.removeAttribute("style")
                    }
                },

                nuevo: {
                    arranque: () => {
                        const main = document.querySelector("main")
                        main.setAttribute("zonaCSS", "administracion/configuracion/mensajesEnPortada/nuevo")
                        const marcoElastico = document.querySelector("[componente=marcoElastico]")
                        marcoElastico.style.padding = "6px"
                        const botonCrearNuevoMensaje = document.querySelector("[boton=crearNuevoMensaje]")
                        botonCrearNuevoMensaje.addEventListener("click", casaVitini.administracion.configuracion.mensajesEnPortada.nuevo.crearMensaje)
                    },
                    crearMensaje: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = document.querySelector("[componente=textoDelMensaje]").value
                        const mensajeEsppera = "Creando nuevo mensaje en portada..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensajeEsppera
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const transacccion = {
                            zona: "administracion/configuracion/mensajesEnPortada/crearMensaje",
                            mensaje: mensaje
                        }



                        const respuestaServidor = await casaVitini.shell.servidor(transacccion)
                        const seccionRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!seccionRenderizada)
                            seccionRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const vistaFinal = `/administracion/configuracion/mensajes_en_portada`
                            const navegacion = {
                                vista: vistaFinal,
                                tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                },
                detallesDelMensaje: {
                    mensajeUI: (detallesDelMensaje) => {


                        const titulo = document.querySelector("main.titulo")
                        titulo.innerText = "Detalles del mensaje"

                        const mensajeUID = detallesDelMensaje.mensajeUID
                        const mensaje = detallesDelMensaje.mensaje

                        const estado = detallesDelMensaje.estado
                        const posicion = detallesDelMensaje.posicion

                        const marcoElastico = document.querySelector("[componente=marcoElastico]")

                        const contenedorMensaje = document.createElement("div")
                        contenedorMensaje.classList.add("contenedorDelMensaje")
                        contenedorMensaje.setAttribute("mensajeUID", mensajeUID)

                        const textoDelMensaje = document.createElement("textarea")
                        textoDelMensaje.classList.add("textoDelMensaje")
                        textoDelMensaje.setAttribute("componente", "textoDelMensaje")
                        textoDelMensaje.value = mensaje
                        textoDelMensaje.placeholder = "Escribe el mensaje en portada aquÃ­"
                        contenedorMensaje.appendChild(textoDelMensaje)

                        const contenedorBotones = document.createElement("div")
                        contenedorBotones.classList.add("contenedorBotones")
                        const botonGuardar = document.createElement("div")
                        botonGuardar.classList.add("boton")
                        botonGuardar.addEventListener("click", casaVitini.administracion.configuracion.mensajesEnPortada.detallesDelMensaje.guardarMensaje)
                        botonGuardar.innerText = "Guardar mensaje"

                        contenedorBotones.appendChild(botonGuardar)
                        contenedorMensaje.appendChild(contenedorBotones)
                        marcoElastico.appendChild(contenedorMensaje)



                    },
                    guardarMensaje: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensajeUID = document.querySelector("[mensajeUID]").getAttribute("mensajeUID")
                        const mensaje = document.querySelector("[componente=textoDelMensaje]").value
                        const mensajeCarga = "Guardando mensaje..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensajeCarga
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const transacccion = {
                            zona: "administracion/configuracion/mensajesEnPortada/actualizarMensaje",
                            mensaje: mensaje,
                            mensajeUID: mensajeUID
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transacccion)
                        const seccionRenderizada = document.querySelector(`main [instanciaUID="${instanciaUID}"]`)
                        if (!seccionRenderizada)
                            seccionRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const vistaFinal = `/administracion/configuracion/mensajes_en_portada`
                            const navegacion = {
                                vista: vistaFinal,
                                tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                },
                eliminarMensaje: {
                    UI: (data) => {
                        const mensajeUID = data.mensajeUID

                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                        const titulo = constructor.querySelector("[componente=titulo]")
                        titulo.innerText = "Confirmas la eliminaciÃ³n del mensaje de la portada"
                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                        mensaje.innerText = "Vas a eliminar este mensaje, no solo se borrarÃ¡ de la portada inmediatamente, sino que tambiÃ©n se eliminarÃ¡ de Casa Vitini de manera irreversible.Si solo deseas que no aparezca, puedes desactivarlo.SÃ­, por el contrario, quieres eliminarlo, entonces estÃ¡ en el lugar correcto."

                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                        botonAceptar.innerText = "Comfirmar la eliminacion del mensaje"
                        botonAceptar.addEventListener("click", () => {
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            casaVitini.administracion.configuracion.mensajesEnPortada.eliminarMensaje.confirmar(mensajeUID)
                        })
                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                        botonCancelar.innerText = "Cancelar la eliminaciÃ³n"
                        document.querySelector("main").appendChild(pantallaInmersiva)
                    },
                    confirmar: async (mensajeUID) => {

                        const instanciaUID_pantalaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                        const instanciaUID = document.querySelector("main").getAttribute("instanciaUID")
                        const mensaje = "Eliminando el mensaje..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID_pantalaDeCarga,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const transaccion = {
                            zona: "administracion/configuracion/mensajesEnPortada/eliminarMensaje",
                            mensajeUID: String(mensajeUID)
                        }

                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)


                        const instanciaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUID_pantalaDeCarga}"]`)
                        instanciaRenderizada?.remove()
                        if (respuestaServidor?.error) {
                            if (!instanciaRenderizada) { return }
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const instanciaMainRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                            if (!instanciaMainRenderizada) { }
                            const mensajeUID = respuestaServidor.mensajeUID
                            instanciaMainRenderizada.querySelector(`[mensajeUID="${mensajeUID}"]`)?.remove()
                            casaVitini.administracion.configuracion.mensajesEnPortada.portadaUI()
                        }
                    }
                },
                moverPosicion: async (o) => {
                    const nuevaPosicion = o.nuevaPosicion
                    const mensajeUIDActual = o.mensajeUIDActual
                    const posicionDelMensajeActual = document.querySelector(`[mensajeUID="${mensajeUIDActual}"]`)
                        .closest("[posicion]").getAttribute("posicion")

                    const instanciaUID_pantalaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                    const instanciaUID = document.querySelector("main").getAttribute("instanciaUID")
                    const mensaje = "Cambiando de posiciÃ³n..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID_pantalaDeCarga,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const transaccion = {
                        zona: "administracion/configuracion/mensajesEnPortada/moverPosicion",
                        mensajeUID: String(mensajeUIDActual),
                        nuevaPosicion: String(nuevaPosicion)
                    }

                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                    const instanciaRenderizada = document.querySelector(`[pantallaSuperpuesta=pantallaCargaSuperpuesta][instanciaUID="${instanciaUID_pantalaDeCarga}"]`)
                    instanciaRenderizada?.remove()
                    if (respuestaServidor?.error) {
                        if (!instanciaRenderizada) { return }
                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {

                        const instanciaMainRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaMainRenderizada) { }
                        const mensajeSeleccionado = respuestaServidor.mensajeSeleccionado
                        const mensajeAfectado = respuestaServidor.mensajeAfectado

                        //{
                        //    "ok": "Se ha actualizado correctamente la posicion",
                        //    "mensajeSeleccionado": {
                        //        "uid": "19",
                        //        "mensaje": "etyeyt"
                        //    },
                        //    "mensajeAfectado": {
                        //        "uid": "21",
                        //        "mensaje": "tyrtty"
                        //    }
                        //}


                        const numeroTotalMensajes = document.querySelectorAll("[posicion]").length

                        const contenedorSeleccionado = document.querySelector(`[posicion="${nuevaPosicion}"]`)
                        contenedorSeleccionado.innerHTML = null

                        const configuracionMensaje = {
                            mensajeUID: mensajeSeleccionado.mensajeUID,
                            mensaje: mensajeSeleccionado.mensaje,
                            estadoIDV: mensajeSeleccionado.estadoIDV,
                            posicion: nuevaPosicion,
                            numeroTotalMensajes: numeroTotalMensajes
                        }
                        const mensajeUI_seleccionado = casaVitini.administracion.configuracion.mensajesEnPortada.mensajeUI(configuracionMensaje)
                        contenedorSeleccionado.appendChild(mensajeUI_seleccionado)

                        const contenedorAfectado = document.querySelector(`[posicion="${posicionDelMensajeActual}"]`)
                        contenedorAfectado.innerHTML = null
                        const configuracionMensajeAfectado = {
                            mensajeUID: mensajeAfectado.mensajeUID,
                            mensaje: mensajeAfectado.mensaje,
                            estadoIDV: mensajeAfectado.estadoIDV,
                            posicion: posicionDelMensajeActual,
                            numeroTotalMensajes: numeroTotalMensajes
                        }
                        const mensajeUI_afectado = casaVitini.administracion.configuracion.mensajesEnPortada.mensajeUI(configuracionMensajeAfectado)
                        contenedorAfectado.appendChild(mensajeUI_afectado)
                    }

                },
                actualizarEstado: async (interruptor) => {
                    const seccionRenderizadaOrigen = document.querySelector("main")
                    const seccionUID = seccionRenderizadaOrigen.getAttribute("instanciaUID")
                    const mensajeUID = interruptor.mensajeUID
                    const estadoIDV = interruptor.estadoSeleccionado
                    const selectorListaEstadosInterruptor = seccionRenderizadaOrigen.querySelector(`[mensajeUID="${mensajeUID}"] [componente=selectorEstado]`)
                    const valorInicial = selectorListaEstadosInterruptor.getAttribute("valorInicial")
                    const estadoSoliciado = selectorListaEstadosInterruptor.querySelector(`option[value=${estadoIDV}]`)
                    let procesandoEstadoUI
                    if (estadoIDV === "activado") {
                        procesandoEstadoUI = "Activando..."
                    }
                    if (estadoIDV === "desactivado") {
                        procesandoEstadoUI = "Desactivando..."
                    }
                    estadoSoliciado.text = procesandoEstadoUI
                    const transacccion = {
                        zona: "administracion/configuracion/mensajesEnPortada/actualizarEstado",
                        mensajeUID: mensajeUID,
                        estadoIDV: estadoIDV
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transacccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${seccionUID}"]`)

                    if (!seccionRenderizada) { return }
                    selectorListaEstadosInterruptor.removeAttribute("style")
                    if (respuestaServidor?.error) {
                        let estadoInicialUI
                        if (estadoIDV === "activado") {
                            estadoInicialUI = "Activado"
                        }
                        if (estadoIDV === "desactivado") {
                            estadoInicialUI = "Desactivado"
                        }
                        estadoSoliciado.text = estadoInicialUI
                        selectorListaEstadosInterruptor.value = valorInicial
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        let estadoFinalUI
                        if (estadoIDV === "activado") {

                            estadoFinalUI = "Activado"
                        }
                        if (estadoIDV === "desactivado") {
                            estadoFinalUI = "Desactivado"
                        }
                        estadoSoliciado.text = estadoFinalUI
                        selectorListaEstadosInterruptor.setAttribute("valorInicial", estadoIDV)
                    }
                }
            }
        },
        clientes: {
            arranque: async () => {
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                const main = document.querySelector("main")
                const instanciaUID = main.getAttribute("instanciaUID")
                const parametroBuscar = granuladoURL.parametros.buscar
                const rawArray = granuladoURL.rawArray

                if (rawArray.length === 2) {
                    main.setAttribute("zonaCSS", "administracion/clientes/buscador")
                    casaVitini.administracion.clientes.buscador.buscadorUI()
                } else if (comandoInicial === "fusion") {

                    casaVitini.administracion.clientes.fusion.portada()
                    main.setAttribute("zonaCSS", "administracion/clientes/fusion")


                } else if (parametroBuscar?.length > 0) {
                    main.setAttribute("zonaCSS", "administracion/clientes/buscador")
                    casaVitini.administracion.clientes.buscador.buscadorUI()
                    if (!granuladoURL.parametros.buscar) {
                        return
                    }
                    const transaccion = {
                        zona: "administracion/clientes/buscar",
                        tipoConstruccionGrid: "total",
                        origen: "url",
                        instanciaUID: instanciaUID,
                        ...granuladoURL.parametros,
                        //granuladoURL: granuladorURL
                    }
                    transaccion.pagina = transaccion.pagina ? Number(transaccion.pagina) : 1
                    transaccion.buscar = decodeURI(transaccion.buscar)
                    if (transaccion.nombre_columna) {
                        transaccion.nombreColumna = transaccion.nombre_columna.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                        delete transaccion.nombre_columna
                    }
                    if (transaccion.sentido_columna) {
                        transaccion.sentidoColumna = transaccion.sentido_columna
                        delete transaccion.sentido_columna
                    }
                    const campoBuscador = document.querySelector("[componenteCampo=buscadorPorId]")
                    campoBuscador.value = transaccion.buscar
                    casaVitini.administracion.clientes.buscador.mostrarClientesResueltos(transaccion)
                } else if (rawArray.length === 3) {
                    const cliente = comandoInicial
                    await casaVitini.administracion.clientes.detallesCliente.portada.UI(cliente)
                    main.setAttribute("zonaCSS", "administracion/clientes/detalles")
                    const transaccion = {
                        zona: "administracion/clientes/reservasDelCliente",
                        clienteUID: cliente,
                        origen: "url",
                        tipoConstruccionGrid: "total",
                        ...granuladoURL.parametros,
                        //granuladoURL: granuladorURL
                    }
                    transaccion.pagina = transaccion.pagina ? Number(transaccion.pagina) : 1
                    if (transaccion.nombre_columna) {
                        transaccion.nombreColumna = transaccion.nombre_columna.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                        delete transaccion.nombre_columna
                    }
                    if (transaccion.sentido_columna) {
                        transaccion.sentidoColumna = transaccion.sentido_columna
                        delete transaccion.sentido_columna
                    }
                    await casaVitini.administracion.clientes.detallesCliente.portada.mostrarReservasDelClienteResueltas(transaccion)
                } else if (rawArray.length === 4 && comandoInicial === "editar") {
                    main.setAttribute("zonaCSS", "administracion/clientes/editar")
                    await casaVitini.administracion.clientes.detallesCliente.editar.UI()
                }
            },
            nuevo: {
                arranque: () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/clientes/nuevo")
                    const selectorBotonCrearCliente = document.querySelector("[componente=botonCrearCliente]")
                    selectorBotonCrearCliente.addEventListener("click", casaVitini.administracion.clientes.nuevo.crearCliente)
                },
                crearCliente: async () => {
                    const selectorCampos = document.querySelectorAll("[campo]")
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Creando nuevo cliente..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const transaccion = {
                        zona: "administracion/clientes/crearCliente"
                    }
                    selectorCampos.forEach((campo) => {
                        const nombreCampo = campo.getAttribute("campo")
                        const datosCampo = campo.value
                        transaccion[nombreCampo] = datosCampo
                    })
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const nuevoUIDCliente = respuestaServidor?.nuevoUIDCliente
                        const vista = `/administracion/clientes/${nuevoUIDCliente}`
                        const navegacion = {
                            vista: vista,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    }
                }
            },
            buscador: {
                buscadorUI: () => {
                    const espacioClientes = document.querySelector("[componente=espacioClientes]")
                    const campoBuscador = document.createElement("input")
                    campoBuscador.classList.add("campoBuscadorClientes")
                    campoBuscador.setAttribute("componente", "zonaNavegacionPaginadaClientes")
                    campoBuscador.setAttribute("componenteCampo", "buscadorPorId")
                    campoBuscador.setAttribute("placeholder", "Busque un cliente por nombre, por cualquier dato.")
                    campoBuscador.addEventListener("input", casaVitini.administracion.clientes.buscador.buscadorClientesPorCampo)
                    espacioClientes.appendChild(campoBuscador)

                    const contenedorResultados = document.createElement("div")
                    contenedorResultados.setAttribute("contenedor", "resultados")
                    contenedorResultados.classList.add(
                        "flexVertical"
                    )
                    espacioClientes.appendChild(contenedorResultados)

                },
                buscadorClientesPorCampo: async (cliente) => {

                    const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                    const espacioClientes = document.querySelector("[contenedor=resultados]")
                    const campo = document.querySelector("[componente=zonaNavegacionPaginadaClientes]")
                    const terminoBusqueda = cliente.target.value
                    document.querySelector("[componente=estadoBusqueda]")?.remove()
                    document.querySelector("[gridUID=gridClientes]")?.remove()
                    document.querySelector("[componenteID=navegacionPaginacion]")?.remove()
                    document.querySelector("[contenedor=filtrosOrden]")?.remove()
                    espacioClientes.innerHTML = null

                    const estadoBusquedaUI = document.createElement("div")
                    estadoBusquedaUI.classList.add("buscadorClientesEstadoBusqueda")
                    estadoBusquedaUI.setAttribute("componente", "estadoBusqueda")
                    estadoBusquedaUI.innerText = "Buscando..."

                    campo.parentNode.insertBefore(estadoBusquedaUI, campo.nextSibling);


                    const granuladorURL = casaVitini.utilidades.granuladorURL()
                    if (granuladorURL.parametros.buscar) {
                        history.replaceState(null, null, granuladorURL.directoriosFusion);
                    }
                    const campoVacio = cliente.target.value.length
                    if (campoVacio === 0) {
                        clearTimeout(casaVitini.componentes.temporizador);
                        document.querySelector("[componente=estadoBusqueda]")?.remove()
                        document.querySelector("[componenteID=gridClientes]")?.remove()
                        document.querySelector("[gridUI_enlazado=gridClientes]")?.remove()
                        document.querySelector("[componenteID=navegacionPaginacion]")?.remove()
                        const vistaActual = document.getElementById("uiNavegacion").getAttribute("vistaActual")
                        const resetUrl = "/administracion/clientes"
                        const titulo = "casavitini"
                        const estado = {
                            zona: vistaActual,
                            estadoInternoZona: "estado",
                            tipoCambio: "total"
                        }
                        window.history.replaceState(estado, titulo, resetUrl);
                        return
                    }
                    clearTimeout(casaVitini.componentes.temporizador);
                    casaVitini.componentes.temporizador = setTimeout(async () => {
                        const transaccion = {
                            zona: "administracion/clientes/buscar",
                            pagina: 1,
                            buscar: terminoBusqueda,
                            origen: "botonMostrarClientes",
                            tipoConstruccionGrid: "total",
                            granuladoURL: granuladorURL,
                            instanciaUID: instanciaUID
                        }


                        casaVitini.administracion.clientes.buscador.mostrarClientesResueltos(transaccion)
                    }, 1500);
                },
                mostrarClientesResueltos: async function (transaccion) {
                    const instanciaUID = transaccion.instanciaUID
                    delete transaccion.instanciaUID
                    const origen = transaccion.origen
                    delete transaccion.origen
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    delete transaccion.granuladoURL
                    const tipoConstruccionGrid = transaccion.tipoConstruccionGrid
                    delete transaccion.tipoConstruccionGrid
                    const paginaTipo = transaccion.paginaTipo
                    delete transaccion.paginaTipo


                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) {
                        return
                    }

                    if (respuestaServidor?.error) {
                        //document.querySelector("[gridUID=gridClientes]")?.remove()
                        document.querySelector("[componente=estadoBusqueda]").innerText = respuestaServidor?.error
                        return
                    }
                    if (respuestaServidor.totalClientes === 0) {
                        //document.querySelector("[gridUID=gridClientes]")?.remove()
                        document.querySelector("[componente=estadoBusqueda]").innerText = "No se han encontrado clientes"
                        return
                    }
                    document.querySelector("[componente=estadoBusqueda]")?.remove()
                    const clientes = respuestaServidor.clientes
                    const buscar = respuestaServidor.buscar
                    const paginasTotales = respuestaServidor.paginasTotales
                    const paginaActual = respuestaServidor.pagina
                    const nombreColumna = respuestaServidor.nombreColumna
                    const sentidoColumna = respuestaServidor.sentidoColumna
                    const columnasGrid = [
                        {
                            columnaUI: "UID",
                            columnaIDV: "uid",
                            columnaClase: "idColumna"
                        },
                        {
                            columnaUI: "Nombre",
                            columnaIDV: "nombre",
                            columnaClase: "entradaColumna"
                        },
                        {
                            columnaUI: "Primer apellido",
                            columnaIDV: "primerApellido",
                            columnaClase: "salidaColuma"
                        },
                        {
                            columnaUI: "Segundo Apellido",
                            columnaIDV: "segundoApellido",
                            columnaClase: "estadoColumna"
                        },
                        {
                            columnaUI: "Pasaporte",
                            columnaIDV: "pasaporte",
                            columnaClase: "pagoColumna"
                        },
                        {
                            columnaUI: "TelÃ©fono",
                            columnaIDV: "telefono",
                            columnaClase: "pagoColumna"
                        },
                        {
                            columnaUI: "Mail",
                            columnaIDV: "mail",
                            columnaClase: "pagoColumna"
                        },
                    ]
                    const parametrosFinales = {
                        buscar: buscar
                    }
                    if (paginaActual > 1 && paginasTotales > 1) {
                        parametrosFinales.pagina = paginaActual
                    }
                    if (nombreColumna) {
                        parametrosFinales.pagina = paginaActual
                        parametrosFinales.nombre_columna = nombreColumna.replace(/([a-z])([A-Z])/g, "$1_$2").toLowerCase();
                        parametrosFinales.sentido_columna = sentidoColumna
                    }
                    const estructuraParametrosFinales = []
                    for (const [parametroFinal, valorFinal] of Object.entries(parametrosFinales)) {
                        const estructura = `${parametroFinal}:${valorFinal}`
                        estructuraParametrosFinales.push(estructura)
                    }
                    let parametrosURLFInal = ""
                    if (estructuraParametrosFinales.length > 0) {
                        parametrosURLFInal = "/" + estructuraParametrosFinales.join("/")
                    }

                    this.selectorFiltro.ui({
                        columnas: columnasGrid,
                        columnaSeleccioanda: nombreColumna,
                        sentidoSeleccionado: sentidoColumna,
                        destino: "[contenedor=resultados]"
                    })

                    this.constructorTarjetas({
                        tarjetas: clientes,
                        destino: "[contenedor=resultados]"

                    })


                    const constructorURLFinal = granuladoURL.directoriosFusion + parametrosURLFInal
                    const metadatosGrid = {
                        filas: clientes,
                        sentidoColumna: sentidoColumna,
                        nombreColumna: nombreColumna,
                        tipoConstruccionGrid: tipoConstruccionGrid,
                        buscar: buscar,
                        pagina: paginaActual,
                        destino: "[contenedor=resultados]",
                        columnasGrid: columnasGrid,
                        gridUID: "gridClientes",
                        numeroColumnas: 7,
                        metodoColumna: "casaVitini.administracion.clientes.buscador.ordenarPorColumna",
                        metodoFila: "casaVitini.administracion.clientes.buscador.resolverFila",
                        mascaraHref: {
                            urlStatica: "/administracion/clientes/",
                            parametro: "clienteUID"
                        },
                        //mascaraURL: constructorURLFinal
                    }
                    casaVitini.ui.componentes.grid(metadatosGrid)
                    const metadatosPaginador = {
                        paginaActual: paginaActual,
                        paginasTotales: paginasTotales,
                        destino: "[componente=espacioClientes]",
                        metodoBoton: "casaVitini.administracion.clientes.buscador.cambiarPagina",
                        gridUID: "gridClientes",
                        granuladoURL: {
                            parametros: parametrosFinales,
                            directoriosFusion: granuladoURL.directoriosFusion
                        }
                    }
                    casaVitini.ui.componentes.paginador(metadatosPaginador)
                    transaccion.tipoConstruccionGrid = "soloLista"
                    const titulo = "Casa Vitini"
                    const estado = {
                        zona: constructorURLFinal,
                        EstadoInternoZona: "estado",
                        tipoCambio: "parcial",
                        componenteExistente: "zonaNavegacionPaginadaClientes",
                        funcionPersonalizada: "casaVitini.administracion.clientes.buscador.mostrarClientesResueltos",
                        datosPaginacion: transaccion
                    }
                    if (origen === "url" || origen === "botonMostrarClientes") {
                        window.history.replaceState(estado, titulo, constructorURLFinal);
                    }

                    if ((origen === "botonNumeroPagina" && paginaTipo === "otra") || origen === "tituloColumna") {
                        window.history.pushState(estado, titulo, constructorURLFinal);
                    }
                    if (origen === "botonNumeroPagina" && paginaTipo === "actual") {
                        window.history.replaceState(estado, titulo, constructorURLFinal);
                    }
                },
                resolverClientes: async (transaccion) => {
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    respuestaServidor
                },
                ordenarPorColumna: async (columna) => {
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const nombreColumna = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("nombreColumna")
                    const selectorColumnasentido = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("sentidoColumna")
                    const numeroPagina = columna.target.closest("[gridUID]").getAttribute("numeroPagina")
                    const terminoBusqueda = columna.target.closest("[gridUID]").getAttribute("terminoBusqueda")
                    const transaccion = {
                        zona: "administracion/clientes/buscar",
                        pagina: Number(numeroPagina),
                        buscar: terminoBusqueda,
                        tipoConstruccionGrid: "soloLista",
                        origen: "tituloColumna",
                        instanciaUID: instanciaUID,
                        granuladoURL: casaVitini.utilidades.granuladorURL()
                    }
                    if (selectorColumnasentido === "ascendente") {
                        transaccion.sentidoColumna = "descendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    if (!selectorColumnasentido) {
                        transaccion.sentidoColumna = "ascendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    casaVitini.administracion.clientes.buscador.mostrarClientesResueltos(transaccion)
                },
                cambiarPagina: async (cambiarPagina) => {
                    const gridUID = cambiarPagina.gridUID
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const gridEnlazado = document.querySelector(`[gridUID=${gridUID}]`)
                    const tipoBoton = cambiarPagina.componenteID
                    const nombreColumna = gridEnlazado.getAttribute("nombreColumnaSeleccionada")
                    const sentidoColumna = gridEnlazado.getAttribute("sentidoColumna")
                    const terminoBusqueda = gridEnlazado.getAttribute("terminoBusqueda")
                    const paginaActual = Number(gridEnlazado.getAttribute("numeroPagina"))
                    const paginaTipo = cambiarPagina.paginaTipo
                    const transacccion = {
                        tipoConstruccionGrid: "soloLista",
                        zona: "administracion/clientes/buscar",
                        nombreColumna: nombreColumna,
                        sentidoColumna: sentidoColumna,
                        buscar: terminoBusqueda,
                        tipoBusqueda: "rapido",
                        origen: "botonNumeroPagina",
                        paginaTipo: paginaTipo,
                        instanciaUID: instanciaUID,
                        granuladoURL: casaVitini.utilidades.granuladorURL()
                    }

                    if (tipoBoton === "numeroPagina") {
                        const numeroPagina = cambiarPagina.numeroPagina
                        transacccion.pagina = Number(numeroPagina)
                    }
                    if (tipoBoton === "botonAdelantePaginacion") {
                        transacccion.pagina = paginaActual + 1
                    }
                    if (tipoBoton === "botonAtrasPaginacion") {
                        transacccion.pagina = paginaActual - 1
                    }

                    casaVitini.administracion.clientes.buscador.mostrarClientesResueltos(transacccion)
                },
                resolverFila: (transaccion) => {
                    transaccion.preventDefault()
                    transaccion.stopPropagation()
                    const href = transaccion.target.closest("[href]").getAttribute("href")
                    const navegacion = {
                        vista: href,
                        tipoOrigen: "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(navegacion)
                },
                constructorTarjetas: (data) => {
                    const clientes = data.tarjetas
                    const destino = data.destino

                    const contenedorTarjetas = document.querySelector("[contenedor=tarjetas]")
                    contenedorTarjetas?.remove()

                    const contenedor = document.createElement("div")
                    contenedor.setAttribute("contenedor", "tarjetas")
                    contenedor.classList.add(
                        "flexVertical",
                        "gap6"
                    )

                    clientes.forEach(cliente => {
                        const clienteUID = cliente.clienteUID
                        const nombre = cliente.nombre
                        const primerApellido = cliente.primerApellido
                        const segundoApellido = cliente.segundoApellido
                        const pasaporte = cliente.pasaporte
                        const telefono = cliente.telefono
                        const mail = cliente.mail

                        const tarjeta = document.createElement("a")
                        tarjeta.setAttribute("componente", "tarjeta")
                        tarjeta.classList.add(
                            "flexVertical",
                            "gap6",
                            "tarjeta",
                            "borderRadius10",
                            "backgroundGrey1",
                            "padding10",
                            "areaSinDecoracionPredeterminada",
                            "ratonDefault",
                            "comportamientoBoton"
                        )
                        tarjeta.href = `/administracion/clientes/${clienteUID}`
                        tarjeta.setAttribute("vista", `/administracion/clientes/${clienteUID}`)
                        tarjeta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        contenedor.appendChild(tarjeta)

                        const datosPar = {
                            "ClienteUID": clienteUID,
                            "Nombre": nombre,
                            "Primer apellido": primerApellido,
                            "Segundo apellido": segundoApellido,
                            "Pasaporte": pasaporte,
                            "TelÃ©fono": telefono,
                            "Mail": mail
                        }

                        Object.entries(datosPar).forEach(([datoUI, data]) => {

                            const contenedor = document.createElement("div")
                            contenedor.classList.add(
                                "flexVertical"
                            )
                            if (data) {
                                tarjeta.appendChild(contenedor)
                            }
                            const titulo = document.createElement("div")
                            titulo.innerHTML = datoUI
                            contenedor.appendChild(titulo)

                            const dataUI = document.createElement("div")
                            dataUI.classList.add(
                                "negrita",
                                "textoElipsis"
                            )
                            dataUI.innerText = data
                            contenedor.appendChild(dataUI)
                        })

                    })
                    document.querySelector(destino).appendChild(contenedor)
                },
                selectorFiltro: {
                    ui: function (data) {
                        const destino = data.destino
                        const columnas = data.columnas

                        const columnaSeleccioanda = data?.columnaSeleccioanda || null
                        const sentidoSeleccionado = data?.sentidoSeleccionado || null
                        const selectorFiltroOrden = document.querySelector("[contenedor=filtrosOrden]")
                        if (selectorFiltroOrden) {
                            const selectorOrdenPorColumna = selectorFiltroOrden.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = selectorFiltroOrden.querySelector("[selector=sentido]")

                            if (columnaSeleccioanda) {
                                selectorOrdenPorColumna.value = columnaSeleccioanda

                            } else {
                                selectorOrdenPorColumna.selectedIndex = 0
                            }
                            if (sentidoSeleccionado) {
                                selectorSentido.value = sentidoSeleccionado
                            } else {
                                selectorSentido.selectedIndex = 0
                            }
                            return
                        }

                        const contenedorFiltrosOrden = document.createElement("div")
                        contenedorFiltrosOrden.classList.add(
                            "gap6",
                            "flexDerecha"
                        )
                        contenedorFiltrosOrden.setAttribute("contenedor", "filtrosOrden")

                        const botonReseteo = document.createElement("div")
                        botonReseteo.classList.add(
                            "selector",
                            "textoCentrado",
                            "comportamientoBoton",
                            "noSelecionable",
                            "ratonDefault"
                        )
                        botonReseteo.innerText = "Resetear filtros"
                        botonReseteo.addEventListener("click", (e) => {
                            const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                            const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = contenedor.querySelector("[selector=sentido]")
                            selectorColumna.selectedIndex = 0
                            selectorSentido.selectedIndex = 0
                            this.pasarela(e)
                        })
                        contenedorFiltrosOrden.appendChild(botonReseteo)

                        const selectorColumna = document.createElement("select")
                        selectorColumna.setAttribute("selector", "ordenPorColumna")
                        selectorColumna.addEventListener("change", this.pasarela)
                        selectorColumna.classList.add(
                            "selector",
                            "textoCentrado"
                        )
                        contenedorFiltrosOrden.appendChild(selectorColumna)
                        const opcionPreterminada = document.createElement("option");
                        opcionPreterminada.disabled = "true"
                        opcionPreterminada.value = ""
                        opcionPreterminada.text = "Ordenar por columna";
                        if (!columnaSeleccioanda) {
                            opcionPreterminada.selected = "true"
                        }

                        selectorColumna.add(opcionPreterminada)

                        columnas.forEach((columna) => {
                            const columnaUI = columna.columnaUI
                            const columnaIDV = columna.columnaIDV
                            const opcion = document.createElement("option");
                            opcion.value = columnaIDV;
                            opcion.text = columnaUI;
                            if (columnaSeleccioanda === columnaIDV) {
                                opcion.selected = "true"
                            }
                            selectorColumna.add(opcion);
                        })

                        const selectorSentido = document.createElement("select")
                        selectorSentido.setAttribute("selector", "sentido")
                        selectorSentido.addEventListener("change", this.pasarela)

                        selectorSentido.classList.add(
                            "selector",
                            "textoCentrado"
                        )
                        contenedorFiltrosOrden.appendChild(selectorSentido)
                        const opcionSentido = document.createElement("option");
                        opcionSentido.disabled = "true"
                        opcionSentido.text = "Sentido";
                        opcionSentido.value = ""
                        if (!sentidoSeleccionado) {
                            opcionSentido.selected = "true"
                        }
                        selectorSentido.add(opcionSentido)

                        const sentidos = [
                            {
                                sentidoUI: "Ascendente",
                                sentidoIDV: "ascendente"
                            },
                            {
                                sentidoUI: "Descendente",
                                sentidoIDV: "descendente"
                            }
                        ]

                        sentidos.forEach((sentido) => {
                            const sentidoUI = sentido.sentidoUI
                            const sentidoIDV = sentido.sentidoIDV
                            const opcion = document.createElement("option");
                            opcion.value = sentidoIDV;
                            opcion.text = sentidoUI;
                            if (sentidoSeleccionado === sentidoIDV) {
                                opcion.selected = "true"
                            }
                            selectorSentido.add(opcion);
                        })
                        document.querySelector(destino).appendChild(contenedorFiltrosOrden)
                    },
                    pasarela: (e) => {
                        const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                        const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                        const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]").value
                        const selectorSentido = contenedor.querySelector("[selector=sentido]").value
                        const ui = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        const numeroPagina = ui.querySelector("[gridUID]").getAttribute("numeroPagina")
                        const terminoBusqueda = ui.querySelector("[gridUID]").getAttribute("terminoBusqueda")

                        //let parametros = ui.querySelector("[gridUID]").getAttribute("parametros")
                        //parametros = parametros ? JSON.parse(parametros) : {}
                        const transaccion = {
                            zona: "administracion/clientes/buscar",
                            tipoBusqueda: "rapido",
                            pagina: Number(numeroPagina),
                            buscar: terminoBusqueda,
                            tipoConstruccionGrid: "soloLista",
                            origen: "tituloColumna",
                            instanciaUID: instanciaUID,
                            granuladoURL: casaVitini.utilidades.granuladorURL()
                        }
                        transaccion.sentidoColumna = selectorSentido
                        transaccion.nombreColumna = selectorColumna

                        //for (const [parametro, valor] of Object.entries(parametros)) {
                        //    transaccion[parametro] = valor
                        //}
                        casaVitini.administracion.clientes.buscador.mostrarClientesResueltos(transaccion)
                    }
                },
            },
            detallesCliente: {
                portada: {
                    UI: async (cliente) => {

                        const transaccion = {
                            zona: "administracion/clientes/detallesCliente",
                            clienteUID: cliente
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            const info = {
                                titulo: "No existe ningÃºn cliente con ese identificador.",
                                descripcion: "Revisa el identificador del cliente porque este no existe.QuizÃ¡s borraste el cliente que buscas.QuizÃ¡s te equivocaste al escribir el identificador del cliente."
                            }
                            casaVitini.ui.componentes.mensajeSimple(info)
                        }
                        if (respuestaServidor?.ok) {

                            const detallesCliente = respuestaServidor?.ok
                            const clienteUID = detallesCliente.clienteUID
                            const nombre = detallesCliente.nombre
                            const primerApellido = detallesCliente?.primerApellido
                            const segundoApellido = detallesCliente?.segundoApellido
                            const pasaporte = detallesCliente.pasaporte
                            const telefono = detallesCliente?.telefono
                            const mail = detallesCliente?.mail
                            const notas = detallesCliente?.notas

                            let selectorEspacioClientes = document.querySelector("[componente=espacioClientes]")

                            let deatallesClienteUI = document.createElement("div")
                            deatallesClienteUI.classList.add("detallesClienteUIBotones")

                            let boton = document.createElement("a")
                            boton.classList.add(
                                "detallesClienteBoton",
                                "areaSinDecoracionPredeterminada"
                            )
                            boton.setAttribute("boton", "editar")
                            boton.innerText = "Editar datos"
                            boton.href = `/administracion/clientes/${clienteUID}/editar`
                            boton.setAttribute("vista", `/administracion/clientes/${clienteUID}/editar`)
                            boton.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)

                            deatallesClienteUI.appendChild(boton)
                            selectorEspacioClientes.appendChild(deatallesClienteUI)


                            deatallesClienteUI = document.createElement("div")
                            deatallesClienteUI.classList.add("detallesClienteUI")
                            deatallesClienteUI.setAttribute("clienteUID", clienteUID)
                            deatallesClienteUI.setAttribute("componente", "clienteUID" + clienteUID)
                            let bloqueHorizontal = document.createElement("div")
                            bloqueHorizontal.classList.add("detallesClienteBloqueHorizontal")
                            let bloqueVertical = document.createElement("div")
                            bloqueVertical.classList.add("detallesClienteBloqueVertical")
                            //Nombre
                            let bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            const nombreTitulo = document.createElement("p")
                            nombreTitulo.classList.add("detallesClienteTituloDato")
                            nombreTitulo.innerText = "Nombre"
                            bloqueDato.appendChild(nombreTitulo)
                            let nombreDato = document.createElement("p")
                            nombreDato.classList.add("detallesClienteDatoCampo")
                            nombreDato.setAttribute("componenteDetalle", "nombre")
                            nombreDato.innerText = nombre
                            bloqueDato.appendChild(nombreDato)
                            //primerApellido
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            const primerApellidoTitulo = document.createElement("p")
                            primerApellidoTitulo.classList.add("detallesClienteTituloDato")
                            primerApellidoTitulo.innerText = "Primer apellido"
                            bloqueDato.appendChild(primerApellidoTitulo)
                            const primerApellidoDato = document.createElement("p")
                            primerApellidoDato.classList.add("detallesClienteDatoCampo")
                            primerApellidoDato.innerText = primerApellido
                            primerApellidoDato.setAttribute("componenteDetalle", "primerApellido")
                            bloqueDato.appendChild(primerApellidoDato)
                            //segundoApellido
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            const segundoApellidoTitulo = document.createElement("p")
                            segundoApellidoTitulo.classList.add("detallesClienteTituloDato")
                            segundoApellidoTitulo.innerText = "Segundo apellido"
                            bloqueDato.appendChild(segundoApellidoTitulo)
                            const segundoApellidoDato = document.createElement("p")
                            segundoApellidoDato.classList.add("detallesClienteDatoCampo")
                            segundoApellidoDato.innerText = segundoApellido
                            segundoApellidoDato.setAttribute("componenteDetalle", "segundoApellido")
                            bloqueDato.appendChild(segundoApellidoDato)
                            bloqueHorizontal.appendChild(bloqueVertical)
                            bloqueVertical = document.createElement("div")
                            bloqueVertical.classList.add("detallesClienteBloqueVertical")
                            //pasaporte
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            const pasaporteTitulo = document.createElement("p")
                            pasaporteTitulo.classList.add("detallesClienteTituloDato")
                            pasaporteTitulo.innerText = "Pasaporte"

                            bloqueDato.appendChild(pasaporteTitulo)
                            const pasaporteDato = document.createElement("p")
                            pasaporteDato.classList.add("detallesClienteDatoCampo")
                            pasaporteDato.setAttribute("componenteDetalle", "pasaporte")
                            pasaporteDato.innerText = pasaporte
                            bloqueDato.appendChild(pasaporteDato)

                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            if (telefono) {
                                bloqueVertical.appendChild(bloqueDato)
                            }

                            const telefonoTitulo = document.createElement("p")
                            telefonoTitulo.classList.add("detallesClienteTituloDato")
                            telefonoTitulo.innerText = "TelÃ©fono"
                            bloqueDato.appendChild(telefonoTitulo)

                            const telefonoDato = document.createElement("p")
                            telefonoDato.classList.add("detallesClienteDatoCampo")
                            telefonoDato.setAttribute("componenteDetalle", "telefono")
                            telefonoDato.innerText = telefono
                            bloqueDato.appendChild(telefonoDato)

                            //correoElectronico
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            if (mail) {
                                bloqueVertical.appendChild(bloqueDato)

                            } const correoElectronicoTitulo = document.createElement("p")
                            correoElectronicoTitulo.classList.add("detallesClienteTituloDato")
                            correoElectronicoTitulo.innerText = "Correo electrÃ³nico"
                            bloqueDato.appendChild(correoElectronicoTitulo)

                            const correoElectronicoDato = document.createElement("p")
                            correoElectronicoDato.classList.add("detallesClienteDatoCampo")
                            correoElectronicoDato.innerText = mail
                            correoElectronicoDato.setAttribute("componenteDetalle", "mail")
                            bloqueDato.appendChild(correoElectronicoDato)

                            bloqueHorizontal.appendChild(bloqueVertical)
                            deatallesClienteUI.appendChild(bloqueHorizontal)
                            bloqueHorizontal = document.createElement("div")
                            bloqueHorizontal.classList.add("detallesClienteBloqueHorizontal")
                            //notas
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueHorizontal.appendChild(bloqueDato)

                            const notasTitulo = document.createElement("p")
                            notasTitulo.classList.add("detallesClienteTituloDato")
                            notasTitulo.innerText = "Notas"
                            bloqueDato.appendChild(notasTitulo)
                            const notasDato = document.createElement("p")
                            notasDato.classList.add("detallesClienteDatoCampo")
                            notasDato.setAttribute("componenteDetalle", "notas")
                            notasDato.innerText = notas
                            bloqueDato.appendChild(notasDato)
                            if (notas) {
                                deatallesClienteUI.appendChild(bloqueHorizontal)

                            }
                            selectorEspacioClientes.appendChild(deatallesClienteUI)
                            const contenedorResultados = document.createElement("div")
                            contenedorResultados.setAttribute("contenedor", "resultados")
                            contenedorResultados.classList.add(
                                "flexVertical"
                            )
                            selectorEspacioClientes.appendChild(contenedorResultados)
                        }
                    },
                    mostrarReservasDelClienteResueltas: async function (transaccion) {
                        const instanciaUID = transaccion.instanciaUID
                        delete transaccion.instanciaUID
                        const origen = transaccion.origen
                        delete transaccion.origen
                        const granuladoURL = casaVitini.utilidades.granuladorURL()
                        delete transaccion.granuladoURL
                        const tipoConstruccionGrid = transaccion.tipoConstruccionGrid
                        delete transaccion.tipoConstruccionGrid
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const instanciaRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)

                        if (!instanciaRenderizada) {

                        }
                        if (respuestaServidor?.error) {
                            return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.totalReservas === 0) {
                            const espacioClientes = document.querySelector("[componente=espacioClientes]")
                            document.querySelector("[gridUID=gridClientes]")?.remove()
                            document.querySelector("[componente=estadoBusqueda]")?.remove()
                            const estadoBusquedaUI = document.createElement("div")
                            estadoBusquedaUI.classList.add("buscadorClientesEstadoBusqueda")
                            estadoBusquedaUI.setAttribute("componente", "estadoBusqueda")
                            estadoBusquedaUI.innerText = "Este cliente no tiene nÃ­nguna reserva asociada a el"
                            espacioClientes.appendChild(estadoBusquedaUI)
                            return

                        }
                        document.querySelector("[componente=estadoBusqueda]")?.remove()
                        const reservasDelCliente = respuestaServidor.reservas
                        const paginasTotales = respuestaServidor.paginasTotales
                        const paginaActual = respuestaServidor.pagina
                        const nombreColumna = respuestaServidor.nombreColumna
                        const sentidoColumna = respuestaServidor.sentidoColumna
                        const columnasGrid = [
                            {
                                columnaUI: "Como",
                                columnaIDV: "como",
                                columnaClase: "idColumna"
                            },
                            {
                                columnaUI: "Reserva",
                                columnaIDV: "reserva",
                                columnaClase: "entradaColumna"
                            },
                            {
                                columnaUI: "Fecha de entrada",
                                columnaIDV: "fechaEntrada",
                                columnaClase: "salidaColuma"
                            },
                            {
                                columnaUI: "Fecha de salida",
                                columnaIDV: "fechaSalida",
                                columnaClase: "estadoColumna"
                            }
                        ]
                        const parametrosFinales = {}
                        if (respuestaServidor?.pagina > 1 && paginasTotales > 1) {
                            parametrosFinales.pagina = paginaActual
                        }
                        if (nombreColumna) {
                            parametrosFinales.pagina = paginaActual
                            parametrosFinales.nombre_columna = nombreColumna.replace(/([a-z])([A-Z])/g, "$1_$2").toLowerCase();
                            parametrosFinales.sentido_columna = sentidoColumna
                        }
                        const estructuraParametrosFinales = []
                        for (const [parametroFinal, valorFinal] of Object.entries(parametrosFinales)) {
                            const estructura = `${parametroFinal}:${valorFinal}`
                            estructuraParametrosFinales.push(estructura)
                        }
                        let parametrosURLFInal = ""
                        if (estructuraParametrosFinales.length > 0) {
                            parametrosURLFInal = "/" + estructuraParametrosFinales.join("/")
                        }

                        this.selectorFiltro.ui({
                            columnas: columnasGrid,
                            columnaSeleccioanda: nombreColumna,
                            sentidoSeleccionado: sentidoColumna,
                            destino: "[contenedor=resultados]"
                        })
                        this.constructorTarjetas({
                            tarjetas: reservasDelCliente,
                            destino: "[contenedor=resultados]"
                        })

                        const constructorURLFinal = granuladoURL.directoriosFusion + parametrosURLFInal
                        const metadatosGrid = {
                            filas: reservasDelCliente,
                            sentidoColumna: sentidoColumna,
                            nombreColumna: nombreColumna,
                            tipoConstruccionGrid: tipoConstruccionGrid,
                            //buscar: buscar,
                            pagina: paginaActual,
                            destino: "[contenedor=resultados]",
                            columnasGrid: columnasGrid,
                            gridUID: "gridReservaDelCliente",
                            numeroColumnas: 4,
                            metodoColumna: "casaVitini.administracion.clientes.detallesCliente.portada.ordenarPorColumna",
                            metodoFila: "casaVitini.administracion.clientes.resolverFila",
                            mascaraHref: {
                                urlStatica: "/administracion/reservas/reserva:",
                                parametro: "reservaUID"
                            },
                            //mascaraURL: constructorURLFinal
                        }
                        casaVitini.ui.componentes.grid(metadatosGrid)
                        const metadatosPaginador = {
                            paginaActual: paginaActual,
                            paginasTotales: paginasTotales,
                            destino: "[componente=espacioClientes]",
                            metodoBoton: "casaVitini.administracion.clientes.detallesCliente.portada.cambiarPagina",
                            gridUID: "gridReservaDelCliente",
                            granuladoURL: {
                                parametros: parametrosFinales,
                                directoriosFusion: granuladoURL.directoriosFusion
                            }
                        }
                        casaVitini.ui.componentes.paginador(metadatosPaginador)
                        const clienteUID = document.querySelector("[clienteUID]").getAttribute("clienteUID")
                        transaccion.tipoConstruccionGrid = "soloLista"
                        const titulo = "ADminstar reservas"
                        const estado = {
                            zona: constructorURLFinal,
                            EstadoInternoZona: "estado",
                            tipoCambio: "parcial",
                            componenteExistente: "clienteUID" + clienteUID,
                            funcionPersonalizada: "casaVitini.administracion.clientes.detallesCliente.portada.mostrarReservasDelClienteResueltas",
                            datosPaginacion: transaccion
                        }
                        if (origen === "url" || origen === "botonMostrarClientes") {
                            window.history.replaceState(estado, titulo, constructorURLFinal);
                        }
                        if (origen === "botonNumeroPagina" || origen === "tituloColumna") {
                            window.history.pushState(estado, titulo, constructorURLFinal);
                        }
                    },
                    ordenarPorColumna: async (columna) => {
                        const nombreColumna = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("nombreColumna")
                        const selectorColumnasentido = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("sentidoColumna")
                        const numeroPagina = columna.target.closest("[gridUID]").getAttribute("numeroPagina")
                        const terminoBusqueda = columna.target.closest("[gridUID]").getAttribute("terminoBusqueda")
                        let sentidoColumna
                        const clienteUID = document.querySelector("[clienteUID]").getAttribute("clienteUID")
                        const transaccion = {
                            zona: "administracion/clientes/reservasDelCliente",
                            pagina: Number(numeroPagina),
                            clienteUID: clienteUID,
                            tipoConstruccionGrid: "soloLista",
                            origen: "tituloColumna"
                        }

                        if (selectorColumnasentido === "ascendente") {
                            transaccion.sentidoColumna = "descendente"
                            transaccion.nombreColumna = nombreColumna
                        }
                        if (!selectorColumnasentido) {
                            transaccion.sentidoColumna = "ascendente"
                            transaccion.nombreColumna = nombreColumna
                        }
                        casaVitini.administracion.clientes.detallesCliente.portada.mostrarReservasDelClienteResueltas(transaccion)
                    },
                    cambiarPagina: async (cambiarPagina) => {
                        const gridUID = cambiarPagina.gridUID
                        const gridEnlazado = document.querySelector(`[gridUID=${gridUID}]`)
                        const tipoBoton = cambiarPagina.componenteID
                        const nombreColumna = gridEnlazado.getAttribute("nombreColumnaSeleccionada")
                        const sentidoColumna = gridEnlazado.getAttribute("sentidoColumna")
                        const terminoBusqueda = gridEnlazado.getAttribute("terminoBusqueda")
                        const paginaActual = Number(gridEnlazado.getAttribute("numeroPagina"))
                        const clienteUID = document.querySelector("[clienteUID]").getAttribute("clienteUID")
                        const transacccion = {
                            zona: "administracion/clientes/reservasDelCliente",
                            nombreColumna: nombreColumna,
                            sentidoColumna: sentidoColumna,
                            cliente: Number(clienteUID),
                            tipoConstruccionGrid: "soloLista",
                            origen: "botonNumeroPagina",
                            granuladoURL: casaVitini.utilidades.granuladorURL()
                        }
                        if (tipoBoton === "numeroPagina") {
                            const numeroPagina = cambiarPagina.numeroPagina
                            transacccion.pagina = Number(numeroPagina)
                        }
                        if (tipoBoton === "botonAdelantePaginacion") {
                            const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                            let mueveNavegadorHaciaAdelante = "Desactivado";
                            if (Number(posicionRelativa) === 10) {
                                mueveNavegadorHaciaAdelante = "Activado"
                            }
                            transacccion.pagina = paginaActual + 1
                            transacccion.moverHaciaAdelanteNavegacion = mueveNavegadorHaciaAdelante
                            transacccion.sentidoNavegacion = "Adelante"
                        }
                        if (tipoBoton === "botonAtrasPaginacion") {
                            const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                            let mueveNavegadorHaciaAtras = "Desactivado";
                            if (Number(posicionRelativa) === 1) {
                                mueveNavegadorHaciaAtras = "Activado"
                            }
                            transacccion.pagina = paginaActual - 1
                            transacccion.mueveNavegadorHaciaAtras = mueveNavegadorHaciaAtras
                            transacccion.sentidoNavegacion = "Atras"
                        }
                        casaVitini.administracion.clientes.detallesCliente.portada.mostrarReservasDelClienteResueltas(transacccion)
                    },
                    editar: () => {
                        let camposLectura = document.querySelectorAll("[componenteDetalle]")
                        camposLectura.forEach((campo) => {
                            let datoCampo = campo.innerText
                            let idCampo = campo.getAttribute("componenteDetalle")
                            campo.style.display = "none"
                            let tipoElemento
                            if (idCampo === "notas") {
                                tipoElemento = "textarea"
                            } else {
                                tipoElemento = "input"
                            }
                            let campoEditable = document.createElement(tipoElemento)
                            campoEditable.classList.add("detallesClienteCampoEditable")
                            campoEditable.value = datoCampo
                            campoEditable.setAttribute("componenteEditable", idCampo)
                            let selectorContenedor = campo.parentNode
                            selectorContenedor.appendChild(campoEditable)
                        })
                        document.querySelector("[boton=editar]").classList.add("estadoInicialInvisible")
                        document.querySelector("[boton=dejarDeEditar]").classList.remove("estadoInicialInvisible")
                        document.querySelector("[boton=eliminarCliente]").classList.remove("estadoInicialInvisible")
                        document.querySelector("[boton=guardarCambios]").classList.remove("estadoInicialInvisible")
                    },
                    dejarDeEditar: () => {
                        let camposEditables = document.querySelectorAll("[componenteEditable]")
                        camposEditables.forEach((campo) => {
                            campo.remove()
                        })
                        let camposLectura = document.querySelectorAll("[componenteDetalle]")
                        camposLectura.forEach((campo) => {
                            campo.removeAttribute("style")
                        })
                        document.querySelector("[boton=editar]").classList.remove("estadoInicialInvisible")
                        document.querySelector("[boton=dejarDeEditar]").classList.add("estadoInicialInvisible")
                        document.querySelector("[boton=guardarCambios]").classList.add("estadoInicialInvisible")
                        document.querySelector("[boton=guardarCambios]").classList.add("estadoInicialInvisible")
                    },
                    guardarCambios: async () => {
                        const campos = document.querySelectorAll("[componenteDetalle]")
                        const clienteUID = document.querySelector("[clienteUID]").getAttribute("clienteUID")
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()

                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta({
                            instanciaUID: instanciaUID,
                            mensaje: "Actualizando datos del cliente..."
                        })

                        const datosParaActualizar = {
                            zona: "administracion/clientes/modificarCliente",
                            clienteUID: String(clienteUID)
                        }
                        campos.forEach((campo) => {
                            const campoDato = campo.value
                            const campoNombre = campo.getAttribute("componenteDetalle")
                            datosParaActualizar[campoNombre] = campoDato

                        })

                        const respuestaServidor = await casaVitini.shell.servidor(datosParaActualizar)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()

                        if (respuestaServidor?.error) {
                            return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            casaVitini.shell.navegacion.controladorVista({
                                vista: "/administracion/clientes/" + clienteUID,
                                tipoOrigen: "menuNavegador"
                            })
                        }
                    },
                    eliminarCliente: {
                        UI: () => {

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = "Eliminar irreversiblemente al cliente"
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = "Eliminar irreversiblemente a un cliente, elimina la informaciÃ³n de este cliente en su ficha y en las reservas donde estuvo.Es decir, desaparecerÃ¡ de las reservas donde estuvo este cliente."

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = "Comfirmar la eliminacion del cliente"
                            botonAceptar.addEventListener("click", casaVitini.administracion.clientes.detallesCliente.portada.eliminarCliente.confirmar)
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar la eliminacion"

                            document.querySelector("main").appendChild(pantallaInmersiva)
                        },
                        confirmar: async () => {
                            const campoEditable = document.querySelectorAll("[componenteEditable]")
                            const clienteUID = document.querySelector("[clienteUID]").getAttribute("clienteUID")
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const metadatosPantallaCarga = {
                                mensaje: "Esperando al servidor...",
                                instanciaUID: instanciaUID,
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                            const selectorPantallaDeCargaSuperpuestaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            const datosParaActualizar = {
                                zona: "administracion/clientes/eliminar",
                                clienteUID: String(clienteUID)
                            }
                            campoEditable.forEach((campo) => {
                                const campoID = campo.getAttribute("componenteEditable")
                                const campoDato = campo.value
                                const campoEditable = document.querySelector(`[componenteEditable=${campoID}]`)
                                const campoLectura = document.querySelector(`[componenteDetalle=${campoID}]`)
                                if (campoEditable.value !== campoLectura.innerText) {
                                    datosParaActualizar[campoID] = campoDato
                                }
                            })
                            const respuestaServidor = await casaVitini.shell.servidor(datosParaActualizar)
                            selectorPantallaDeCargaSuperpuestaRenderizada?.remove()
                            if (respuestaServidor?.error) {
                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {

                                await casaVitini.shell.navegacion.controladorVista({
                                    vista: "administracion/clientes",
                                    tipoOrigen: "menuNavegador"
                                })
                                casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.ok)
                            }
                        },
                    },
                    constructorTarjetas: (data) => {
                        const reservas = data.tarjetas
                        const destino = data.destino

                        const contenedorTarjetas = document.querySelector("[contenedor=tarjetas]")
                        contenedorTarjetas?.remove()

                        const contenedor = document.createElement("div")
                        contenedor.setAttribute("contenedor", "tarjetas")
                        contenedor.classList.add(
                            "flexVertical",
                            "gap6"

                            /*
                                {
                                        "como": "Titular",
                                        "reservaUID": "2667",
                                        "fechaEntrada": "10/07/2024",
                                        "fechaSalida": "12/07/2024"
                                    },
                            */

                        )

                        reservas.forEach(r => {
                            const como = r.como
                            const reservaUID = r.reservaUID
                            const fechaEntrada = r.fechaEntrada
                            const fechaSalida = r.fechaSalida


                            const tarjeta = document.createElement("a")
                            tarjeta.setAttribute("componente", "tarjeta")
                            tarjeta.classList.add(
                                "flexVertical",
                                "gap6",
                                "tarjeta",
                                "borderRadius10",
                                "backgroundGrey1",
                                "padding10",
                                "areaSinDecoracionPredeterminada",
                                "ratonDefault",
                                "comportamientoBoton"
                            )
                            tarjeta.href = `/administracion/reservas/reserva:${reservaUID}`
                            tarjeta.setAttribute("vista", `/administracion/reservas/reserva:${reservaUID}`)
                            tarjeta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                            contenedor.appendChild(tarjeta)

                            const datosPar = {
                                "Como": como,
                                "Reserva UID": reservaUID,
                                "Fecha Entrada": fechaEntrada,
                                "Fecha Salida": fechaSalida
                            }

                            Object.entries(datosPar).forEach(([datoUI, data]) => {

                                const contenedor = document.createElement("div")
                                contenedor.classList.add(
                                    "flexVertical"
                                )
                                if (data) {
                                    tarjeta.appendChild(contenedor)
                                }
                                const titulo = document.createElement("div")
                                titulo.innerHTML = datoUI
                                contenedor.appendChild(titulo)

                                const dataUI = document.createElement("div")
                                dataUI.classList.add(
                                    "negrita",
                                    "textoElipsis"
                                )
                                dataUI.innerText = data
                                contenedor.appendChild(dataUI)
                            })
                        })
                        document.querySelector(destino).appendChild(contenedor)
                    },
                    selectorFiltro: {
                        ui: function (data) {
                            const destino = data.destino
                            const columnas = data.columnas

                            const columnaSeleccioanda = data?.columnaSeleccioanda || null
                            const sentidoSeleccionado = data?.sentidoSeleccionado || null
                            const selectorFiltroOrden = document.querySelector("[contenedor=filtrosOrden]")
                            if (selectorFiltroOrden) {
                                const selectorOrdenPorColumna = selectorFiltroOrden.querySelector("[selector=ordenPorColumna]")
                                const selectorSentido = selectorFiltroOrden.querySelector("[selector=sentido]")

                                if (columnaSeleccioanda) {
                                    selectorOrdenPorColumna.value = columnaSeleccioanda

                                } else {
                                    selectorOrdenPorColumna.selectedIndex = 0
                                }
                                if (sentidoSeleccionado) {
                                    selectorSentido.value = sentidoSeleccionado
                                } else {
                                    selectorSentido.selectedIndex = 0
                                }
                                return
                            }

                            const contenedorFiltrosOrden = document.createElement("div")
                            contenedorFiltrosOrden.classList.add(
                                "gap6",
                                "flexDerecha"
                            )
                            contenedorFiltrosOrden.setAttribute("contenedor", "filtrosOrden")

                            const botonReseteo = document.createElement("div")
                            botonReseteo.classList.add(
                                "selector",
                                "textoCentrado",
                                "comportamientoBoton",
                                "noSelecionable",
                                "ratonDefault"
                            )
                            botonReseteo.innerText = "Resetear filtros"
                            botonReseteo.addEventListener("click", (e) => {
                                const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                                const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]")
                                const selectorSentido = contenedor.querySelector("[selector=sentido]")
                                selectorColumna.selectedIndex = 0
                                selectorSentido.selectedIndex = 0
                                this.pasarela(e)
                            })
                            contenedorFiltrosOrden.appendChild(botonReseteo)

                            const selectorColumna = document.createElement("select")
                            selectorColumna.setAttribute("selector", "ordenPorColumna")
                            selectorColumna.addEventListener("change", this.pasarela)
                            selectorColumna.classList.add(
                                "selector",
                                "textoCentrado"
                            )
                            contenedorFiltrosOrden.appendChild(selectorColumna)
                            const opcionPreterminada = document.createElement("option");
                            opcionPreterminada.disabled = "true"
                            opcionPreterminada.value = ""
                            opcionPreterminada.text = "Ordenar por columna";
                            if (!columnaSeleccioanda) {
                                opcionPreterminada.selected = "true"
                            }

                            selectorColumna.add(opcionPreterminada)

                            columnas.forEach((columna) => {
                                const columnaUI = columna.columnaUI
                                const columnaIDV = columna.columnaIDV
                                const opcion = document.createElement("option");
                                opcion.value = columnaIDV;
                                opcion.text = columnaUI;
                                if (columnaSeleccioanda === columnaIDV) {
                                    opcion.selected = "true"
                                }
                                selectorColumna.add(opcion);
                            })

                            const selectorSentido = document.createElement("select")
                            selectorSentido.setAttribute("selector", "sentido")
                            selectorSentido.addEventListener("change", this.pasarela)

                            selectorSentido.classList.add(
                                "selector",
                                "textoCentrado"
                            )
                            contenedorFiltrosOrden.appendChild(selectorSentido)
                            const opcionSentido = document.createElement("option");
                            opcionSentido.disabled = "true"
                            opcionSentido.text = "Sentido";
                            opcionSentido.value = ""
                            if (!sentidoSeleccionado) {
                                opcionSentido.selected = "true"
                            }
                            selectorSentido.add(opcionSentido)

                            const sentidos = [
                                {
                                    sentidoUI: "Ascendente",
                                    sentidoIDV: "ascendente"
                                },
                                {
                                    sentidoUI: "Descendente",
                                    sentidoIDV: "descendente"
                                }
                            ]

                            sentidos.forEach((sentido) => {
                                const sentidoUI = sentido.sentidoUI
                                const sentidoIDV = sentido.sentidoIDV
                                const opcion = document.createElement("option");
                                opcion.value = sentidoIDV;
                                opcion.text = sentidoUI;
                                if (sentidoSeleccionado === sentidoIDV) {
                                    opcion.selected = "true"
                                }
                                selectorSentido.add(opcion);
                            })


                            document.querySelector(destino).appendChild(contenedorFiltrosOrden)
                        },
                        pasarela: (e) => {
                            const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                            const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                            const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]").value
                            const selectorSentido = contenedor.querySelector("[selector=sentido]").value
                            const ui = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            const numeroPagina = ui.querySelector("[gridUID]").getAttribute("numeroPagina")
                            const clienteUID = document.querySelector("[clienteUID]").getAttribute("clienteUID")

                            const transaccion = {
                                zona: "administracion/clientes/reservasDelCliente",
                                pagina: Number(numeroPagina),
                                clienteUID: clienteUID,
                                tipoConstruccionGrid: "soloLista",
                                origen: "tituloColumna"
                            }
                            transaccion.sentidoColumna = selectorSentido
                            transaccion.nombreColumna = selectorColumna

                            //for (const [parametro, valor] of Object.entries(parametros)) {
                            //    transaccion[parametro] = valor
                            //}
                            casaVitini.administracion.clientes.detallesCliente.portada.mostrarReservasDelClienteResueltas(transaccion)
                        }
                    },
                },
                editar: {
                    UI: async () => {
                        const granuladoURL = casaVitini.utilidades.granuladorURL()
                        const clienteUID = granuladoURL.directorios[granuladoURL.directorios.length - 2]


                        const transaccion = {
                            zona: "administracion/clientes/detallesCliente",
                            clienteUID: clienteUID
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            const info = {
                                titulo: "No existe ningun cliente con ese identificador",
                                descripcion: "Revisa el identificador del cliente porque este no existe.QuizÃ¡s borraste el cliente que buscas.QuizÃ¡s te equivocaste al escribir el identificador del cliente."
                            }
                            casaVitini.ui.componentes.mensajeSimple(info)
                        }
                        if (respuestaServidor?.ok) {
                            const detallesCliente = respuestaServidor?.ok
                            const clienteUID = detallesCliente.clienteUID
                            const nombre = detallesCliente.nombre
                            const primerApellido = detallesCliente?.primerApellido
                            const segundoApellido = detallesCliente?.segundoApellido
                            const pasaporte = detallesCliente.pasaporte
                            const telefono = detallesCliente?.telefono
                            const mail = detallesCliente?.mail
                            const notas = detallesCliente?.notas

                            let selectorEspacioClientes = document.querySelector("[componente=espacioClientes]")

                            let deatallesClienteUI = document.createElement("div")
                            deatallesClienteUI.classList.add("detallesClienteUIBotones")

                            selectorEspacioClientes.appendChild(deatallesClienteUI)
                            deatallesClienteUI = document.createElement("div")
                            deatallesClienteUI.classList.add("detallesClienteUI")
                            deatallesClienteUI.setAttribute("clienteUID", clienteUID)


                            let bloqueHorizontal = document.createElement("div")
                            bloqueHorizontal.classList.add("detallesClienteBloqueHorizontal")
                            let bloqueVertical = document.createElement("div")
                            bloqueVertical.classList.add("detallesClienteBloqueVertical")
                            //Nombre
                            let bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            let nombreTitulo = document.createElement("p")
                            nombreTitulo.classList.add("detallesClienteTituloDato")
                            nombreTitulo.innerText = "Nombre"
                            bloqueDato.appendChild(nombreTitulo)
                            let nombreDato = document.createElement("input")
                            nombreDato.classList.add(
                                "campoTexto"
                            )
                            nombreDato.setAttribute("componenteDetalle", "nombre")
                            nombreDato.value = nombre
                            bloqueDato.appendChild(nombreDato)
                            //primerApellido
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            let primerApellidoTitulo = document.createElement("p")
                            primerApellidoTitulo.classList.add("detallesClienteTituloDato")
                            primerApellidoTitulo.innerText = "Primer apellido"
                            bloqueDato.appendChild(primerApellidoTitulo)
                            let primerApellidoDato = document.createElement("input")
                            primerApellidoDato.classList.add(
                                "campoTexto"

                            )
                            primerApellidoDato.value = primerApellido
                            primerApellidoDato.setAttribute("componenteDetalle", "primerApellido")
                            bloqueDato.appendChild(primerApellidoDato)
                            //segundoApellido
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            let segundoApellidoTitulo = document.createElement("p")
                            segundoApellidoTitulo.classList.add("detallesClienteTituloDato")
                            segundoApellidoTitulo.innerText = "Segundo apellido"
                            bloqueDato.appendChild(segundoApellidoTitulo)
                            let segundoApellidoDato = document.createElement("input")
                            segundoApellidoDato.classList.add(
                                "campoTexto"

                            )
                            segundoApellidoDato.value = segundoApellido
                            segundoApellidoDato.setAttribute("componenteDetalle", "segundoApellido")
                            bloqueDato.appendChild(segundoApellidoDato)
                            bloqueHorizontal.appendChild(bloqueVertical)
                            bloqueVertical = document.createElement("div")
                            bloqueVertical.classList.add("detallesClienteBloqueVertical")
                            //pasaporte
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            let pasaporteTitulo = document.createElement("p")
                            pasaporteTitulo.classList.add("detallesClienteTituloDato")
                            pasaporteTitulo.innerText = "Pasaporte"
                            bloqueDato.appendChild(pasaporteTitulo)
                            let pasaporteDato = document.createElement("input")
                            pasaporteDato.classList.add(
                                "campoTexto"

                            )
                            pasaporteDato.setAttribute("componenteDetalle", "pasaporte")
                            pasaporteDato.value = pasaporte
                            bloqueDato.appendChild(pasaporteDato)
                            //telefono
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            let telefonoTitulo = document.createElement("p")
                            telefonoTitulo.classList.add("detallesClienteTituloDato")
                            telefonoTitulo.innerText = "TelÃ©fono"
                            bloqueDato.appendChild(telefonoTitulo)
                            let telefonoDato = document.createElement("input")
                            telefonoDato.classList.add(
                                "campoTexto"

                            )
                            telefonoDato.setAttribute("componenteDetalle", "telefono")
                            telefonoDato.value = telefono
                            bloqueDato.appendChild(telefonoDato)
                            //correoElectronico
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueVertical.appendChild(bloqueDato)
                            let correoElectronicoTitulo = document.createElement("p")
                            correoElectronicoTitulo.classList.add("detallesClienteTituloDato")
                            correoElectronicoTitulo.innerText = "Correo electrÃ³nico"
                            bloqueDato.appendChild(correoElectronicoTitulo)
                            let correoElectronicoDato = document.createElement("input")
                            correoElectronicoDato.classList.add(
                                "campoTexto"

                            )
                            correoElectronicoDato.value = mail
                            correoElectronicoDato.setAttribute("componenteDetalle", "correoElectronico")
                            bloqueDato.appendChild(correoElectronicoDato)
                            bloqueHorizontal.appendChild(bloqueVertical)
                            deatallesClienteUI.appendChild(bloqueHorizontal)
                            bloqueHorizontal = document.createElement("div")
                            bloqueHorizontal.classList.add("detallesClienteBloqueHorizontalNotas")
                            //notas
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("detallesClienteBloqueDato")
                            bloqueHorizontal.appendChild(bloqueDato)
                            let notasTitulo = document.createElement("p")
                            notasTitulo.classList.add("detallesClienteTituloDato")
                            notasTitulo.innerText = "Notas"
                            bloqueDato.appendChild(notasTitulo)
                            let notasDato = document.createElement("textarea")
                            notasDato.classList.add(
                                "campoTexto"

                            )
                            notasDato.setAttribute("componenteDetalle", "notas")
                            notasDato.rows = "4"
                            notasDato.value = notas
                            bloqueDato.appendChild(notasDato)
                            deatallesClienteUI.appendChild(bloqueHorizontal)

                            selectorEspacioClientes.appendChild(deatallesClienteUI)

                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add(
                                "flexVertical",
                                "gap6",
                                "padding12"
                            )
                            deatallesClienteUI.appendChild(contenedorBotones)


                            let boton = document.createElement("div")
                            boton.classList.add("detallesClienteBoton")
                            boton.setAttribute("boton", "guardarCambios")
                            boton.addEventListener("click", casaVitini.administracion.clientes.detallesCliente.portada.guardarCambios)
                            boton.innerText = "Guardar cambios"
                            contenedorBotones.appendChild(boton)

                            boton = document.createElement("div")
                            boton.classList.add("detallesClienteBoton")
                            boton.setAttribute("boton", "eliminarCliente")
                            boton.addEventListener("click", casaVitini.administracion.clientes.detallesCliente.portada.eliminarCliente.UI)
                            boton.innerText = "Eliminar cliente"
                            contenedorBotones.appendChild(boton)


                        }
                    },
                },

            },
            fusion: {
                portada: {
                    arranque: () => {
                        const selectorCampos = document.querySelectorAll("[campo]")
                        selectorCampos.forEach(campo => {
                            campo.addEventListener("input", (e) => {
                                const terminoBusqueda = e.target.value
                                const contenedor = e.target.getAttribute("campo")
                                casaVitini.administracion.clientes.fusion.listaResultadosUI({
                                    terminoBusqueda,
                                    contenedor
                                })
                            })
                        })
                        const botonFusion = document.querySelector("[boton=fusion]")
                        botonFusion.addEventListener("click", () => {

                            const clienteOrigen = document.querySelector("[contenedor=origen]").querySelector("[estado=seleccionado]")
                            const clienteDestino = document.querySelector("[contenedor=destino]").querySelector("[estado=seleccionado]")

                            if (!clienteOrigen) {
                                const m = "Por favor, primero selecciona el cliente de ORIGEN. Para ello, busca en el campo de bÃºsqueda del campo cliente ORIGEN y selecciona el cliente ORIGEN."
                                casaVitini.ui.componentes.advertenciaInmersiva(m)
                            } else if (!clienteDestino) {
                                const m = "Por favor, primero selecciona el cliente de DESTINO; para ello, busca en el campo de bÃºsqueda del campo cliente DESTINO y selecciona el cliente DESTINO."
                                casaVitini.ui.componentes.advertenciaInmersiva(m)
                            } else {
                                casaVitini.administracion.clientes.fusion.confirmarFusion.UI()
                            }
                        })
                    }
                },
                listaResultadosUI: async function (data) {

                    const contenedor = data.contenedor
                    const terminoBusqueda = data.terminoBusqueda
                    const selectorContenedor = document.querySelector(`[contenedor="${contenedor}"]`)
                    const selectorContenedorListaResultados = selectorContenedor.querySelector(`[componente=listaResultados]`)

                    const contenedorListaResultdos = document.createElement("div")
                    contenedorListaResultdos.setAttribute("componente", "listaResultados")
                    if (!selectorContenedorListaResultados) {
                        selectorContenedor.appendChild(contenedorListaResultdos)
                    }
                    const selectorContenedorListaResultados_renderizada = selectorContenedor.querySelector(`[componente=listaResultados]`)
                    selectorContenedorListaResultados_renderizada.innerHTML = null

                    const campoVacio = terminoBusqueda.length
                    if (campoVacio === 0) {
                        clearTimeout(casaVitini.componentes.temporizador);
                        selectorContenedorListaResultados_renderizada?.remove()
                        return
                    }

                    const info = document.createElement("p")
                    info.classList.add(
                        "infoBuscando",
                        "padding6"
                    )
                    info.setAttribute("componente", "info")
                    info.innerText = "Buscando..."

                    const selectorInfoRenderizada = selectorContenedor.querySelector("[componente=info]")
                    if (!selectorInfoRenderizada) {
                        selectorContenedorListaResultados_renderizada.appendChild(info)
                    }

                    clearTimeout(casaVitini.componentes.temporizador);
                    casaVitini.administracion.clientes.fusion.contenedorEventoTemporal[contenedor] = setTimeout(() => {
                        const instanciaUIDBuscador = casaVitini.utilidades.codigoFechaInstancia()
                        selectorContenedorListaResultados_renderizada.setAttribute("instanciaUIDBuscador", instanciaUIDBuscador)
                        this.transactor({
                            terminoBusqueda,
                            instanciaUIDBuscador,
                        })
                    }, 1500);
                },
                transactor: async function (data) {
                    const terminoBusqueda = data.terminoBusqueda
                    const instanciaUIDBuscador = data.instanciaUIDBuscador

                    const transaccion = {
                        zona: "administracion/clientes/buscar",
                        tipoBusqueda: "rapido",
                        buscar: terminoBusqueda
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                    const listaBuscadorRenderizada = document.querySelector(`[instanciaUIDBuscador="${instanciaUIDBuscador}"]`)
                    if (!listaBuscadorRenderizada) {
                        return
                    }
                    if (respuestaServidor?.error) {
                        return listaBuscadorRenderizada.querySelector("[componente=info]").innerHTML = respuestaServidor?.error
                    }

                    const resultadosClientes = respuestaServidor?.clientes
                    if (resultadosClientes.length === 0) {
                        return listaBuscadorRenderizada.querySelector("[componente=info]").innerHTML = "Nada encontrado"
                    }
                    listaBuscadorRenderizada.innerHTML = null
                    resultadosClientes.forEach((clienteEncontrado) => {
                        const clienteUID = clienteEncontrado.clienteUID
                        const nombre = clienteEncontrado.nombre
                        const primerApellido = clienteEncontrado.primerApellido
                        const segundoApellido = clienteEncontrado.segundoApellido
                        const pasaporte = clienteEncontrado.pasaporte
                        const bloqueCliente = document.createElement("div")
                        bloqueCliente.classList.add(
                            "administracionReservaDetallesBuscadorRapidoBloqueCliente",
                            "borderRadius12"
                        )
                        bloqueCliente.setAttribute("clienteUID", clienteUID)
                        bloqueCliente.setAttribute("componente", "elementoResultadosBuscadorRapido")
                        bloqueCliente.addEventListener("click", (e) => {

                            const selectorResultadosContenedor = e.target.closest("[componente=listaResultados]").querySelectorAll("[componente=elementoResultadosBuscadorRapido]")
                            selectorResultadosContenedor.forEach((resultado) => {
                                resultado.removeAttribute("estado")
                                resultado.removeAttribute("style")
                            })
                            const resultadoSeleccionado = e.target
                            resultadoSeleccionado.setAttribute("estado", "seleccionado")
                            resultadoSeleccionado.style.background = "blue"
                            resultadoSeleccionado.style.color = "white"
                        })

                        const filaNombre = document.createElement("p")
                        filaNombre.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaNombre")
                        filaNombre.setAttribute("dato", "nombre")
                        filaNombre.innerText = `${nombre} ${primerApellido} ${segundoApellido}`
                        bloqueCliente.appendChild(filaNombre)
                        const filaPasaporte = document.createElement("p")
                        filaPasaporte.classList.add("administracionReservaDetallesBuscadorRapidoBloqueClienteFilaPasaporte")
                        filaPasaporte.setAttribute("dato", "pasaporte")
                        filaPasaporte.innerText = pasaporte
                        bloqueCliente.appendChild(filaPasaporte)
                        listaBuscadorRenderizada.appendChild(bloqueCliente)
                    })
                },
                contenedorEventoTemporal: {},
                confirmarFusion: {
                    UI: function () {
                        const clienteOrigen = document.querySelector("[contenedor=origen]").querySelector("[estado=seleccionado]")
                        const clienteDestino = document.querySelector("[contenedor=destino]").querySelector("[estado=seleccionado]")

                        const nombreOrigen = clienteOrigen.querySelector("[dato=nombre]").innerText
                        const pasaporteOrigen = clienteOrigen.querySelector("[dato=pasaporte]").innerText
                        const uidOrigen = clienteOrigen.getAttribute("clienteUID")

                        const nombreDestino = clienteDestino.querySelector("[dato=nombre]").innerText
                        const pasaporteDestino = clienteDestino.querySelector("[dato=pasaporte]").innerText
                        const uidDestino = clienteDestino.getAttribute("clienteUID")

                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                        const contenedor = pantallaInmersiva.querySelector("[componente=contenedor]")

                        const titulo = constructor.querySelector("[componente=titulo]")
                        titulo.innerText = "Operacion de fusiÃ³n irreversible"
                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                        mensaje.innerText = `Se va a fusionar como cliente ORIGEN a ${nombreOrigen} (${pasaporteOrigen}) con el cliente DESTINO ${nombreDestino} (${pasaporteDestino}). Esta operaciÃ³n es irreversible. El cliente ORIGEN serÃ¡ eliminado y sustituido por el cliente destino en todas las reservas donde estÃ© presente el cliente ORIGEN. Una vez se haya sustituido al cliente ORIGEN por el DESTINO en las reservas, el cliente ORIGEN serÃ¡ eliminado del hub de clientes.`

                        const contenedorFusion = document.createElement("div")
                        contenedorFusion.classList.add(
                            "flexVertical",
                            "gap6"
                        )
                        contenedor.appendChild(contenedorFusion)

                        const origenUI = document.createElement("div")
                        origenUI.classList.add(
                            "flexVertical",
                            "padding12",
                            "backgroundGrey1",
                            "borderRadius14"
                        )
                        contenedorFusion.appendChild(origenUI)

                        const tituloOrigenUI = document.createElement("p")
                        tituloOrigenUI.innerText = "<<< ORIGEN"
                        origenUI.appendChild(tituloOrigenUI)


                        const nombreOrigenUI = document.createElement("p")
                        nombreOrigenUI.classList.add(
                            "negrita"
                        )
                        nombreOrigenUI.innerText = nombreOrigen
                        origenUI.appendChild(nombreOrigenUI)

                        const pasaporteOrigenUI = document.createElement("p")
                        pasaporteOrigenUI.innerText = pasaporteOrigen
                        origenUI.appendChild(pasaporteOrigenUI)

                        const destinoUI = document.createElement("div")
                        destinoUI.classList.add(
                            "flexVertical",
                            "padding12",
                            "backgroundGrey1",
                            "borderRadius14"
                        )
                        contenedorFusion.appendChild(destinoUI)

                        const tituloDestinoUI = document.createElement("p")
                        tituloDestinoUI.innerText = ">>> DESTINO"
                        destinoUI.appendChild(tituloDestinoUI)

                        const nombreDestinoUI = document.createElement("p")
                        nombreDestinoUI.classList.add(
                            "negrita"
                        )
                        nombreDestinoUI.innerText = nombreDestino
                        destinoUI.appendChild(nombreDestinoUI)

                        const pasaporteDestinoUI = document.createElement("p")
                        pasaporteDestinoUI.innerText = pasaporteDestino
                        destinoUI.appendChild(pasaporteDestinoUI)


                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                        botonAceptar.innerText = "Comfirmar e iniciar la fusiÃ³n"
                        botonAceptar.addEventListener("click", () => {
                            this.confirmar({
                                clienteOrigenUID: uidOrigen,
                                clienteDestinoUID: uidDestino

                            })
                        })
                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                        botonCancelar.innerText = "Cancelar la eliminacion"

                        document.querySelector("main").appendChild(pantallaInmersiva)
                    },
                    confirmar: async (data) => {
                        const clienteOrigenUID = data.clienteOrigenUID
                        const clienteDestinoUID = data.clienteDestinoUID

                        const instanciaUID_main = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const metadatosPantallaCarga = {
                            mensaje: "Fusionando clientes...",
                            instanciaUID: instanciaUID,
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                        const selectorPantallaDeCargaSuperpuestaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        const datosParaActualizar = {
                            zona: "administracion/clientes/fusion",
                            clienteUID_origen: clienteOrigenUID,
                            clienteUID_destino: clienteDestinoUID
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(datosParaActualizar)
                        selectorPantallaDeCargaSuperpuestaRenderizada?.remove()
                        const instanciaUI_main_renderizada = document.querySelector(`[instanciaUID="${instanciaUID_main}"]`)
                        if (!instanciaUI_main_renderizada) {
                            return
                        }
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const m = "Se ha producido la fusion"
                            instanciaUI_main_renderizada.innerHTML = null
                            instanciaUI_main_renderizada.innerText = m
                        }
                    },
                },
            }
        },
        precios: {
            arranque: async () => {
                const main = document.querySelector("main")
                const seccionRenderizadaOrigen = document.querySelector("main")
                main.style.wordBreak = "break-word"
                const instanciaUID = seccionRenderizadaOrigen.getAttribute("instanciaUID")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                if (comandoInicial === "precios" && Object.keys(granuladoURL.parametros).length === 0) {
                    main.setAttribute("zonaCSS", "administracion/precios")
                    casaVitini.administracion.precios.portadaUI()
                } else if (granuladoURL.parametros && comandoInicial !== "precios") {
                    main.setAttribute("zonaCSS", "administracion/precios")
                    const info = {
                        titulo: "No existe ningÃºn perfil de precio base con ese identificador.",
                        descripcion: "Revisa el identificado porque no existe el perfil de precio que solicitas."
                    }
                    casaVitini.ui.componentes.mensajeSimple(info)
                } else if (granuladoURL.parametros.apartamentos) {
                    main.setAttribute("zonaCSS", "administracion/precios/detalles")
                    const transaccion = {
                        zona: "administracion/precios/detallePrecioBaseApartamento",
                        apartamentoIDV: granuladoURL.parametros.apartamentos
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada)
                        if (respuestaServidor.error) {
                            const titulo = document.querySelector(".titulo")
                            titulo.innerText = "No existe ningÃºn precio con el identificador: " + granuladoURL.parametros.apartamentos

                        }
                    casaVitini.administracion.precios.detallesApartamenro(respuestaServidor)
                } else if (granuladoURL.parametros.impuestos) {
                    const transaccion = {
                        zona: "administracion/impuestos/detalleImpuesto",
                        impuestoUID: Number(granuladoURL.parametros.impuestos)
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada)
                        if (respuestaServidor.error) {
                            const titulo = document.querySelector(".titulo")
                            titulo.innerText = "No existe ningÃºn impuesto con el identificador: " + granuladoURL.parametros.apartamentos

                        }
                    casaVitini.administracion.precios.detalleImpuesto(respuestaServidor)
                }
            },
            portadaUI: async () => {
                const selectorEspacioPreciosEImpuestos = document.querySelector("[componente=precios]")
                const transaccion = {
                    zona: "administracion/precios/listaPreciosApartamentos"
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                if (respuestaServidor?.error) {
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    const preciosApartmentos = respuestaServidor?.ok
                    const bloqueGlobalApartamentos = document.createElement("div")
                    bloqueGlobalApartamentos.classList.add("preciosEImpuestosBloqueGlobal")
                    const contenedorTituloYOpciones = document.createElement("div")
                    contenedorTituloYOpciones.classList.add("preciosEImpuestosTituloYOpciones")
                    const tituloBloque = document.createElement("p")
                    tituloBloque.classList.add("preciosEImpuestosBloqueTitulo")
                    tituloBloque.innerText = "Precios de los apartmentos"
                    contenedorTituloYOpciones.appendChild(tituloBloque)
                    bloqueGlobalApartamentos.appendChild(contenedorTituloYOpciones)
                    const bloqueHorizontal = document.createElement("div")
                    bloqueHorizontal.classList.add("precioEImpuestosBloqueHorizotnal")
                    preciosApartmentos.forEach((detalleApartamento) => {
                        const uidPrecioApartamento = detalleApartamento.uid
                        const apartamentoIDV = detalleApartamento.apartamento
                        const precio = detalleApartamento.precio
                        const moneda = detalleApartamento.moneda
                        const apartamentoUI = detalleApartamento.apartamentoUI
                        const totalImpuestos = detalleApartamento.totalImpuestos
                        const totalNocheBruto = detalleApartamento.totalNocheBruto
                        const bloqueApartamento = document.createElement("a")
                        bloqueApartamento.classList.add("preciosEImpuestosBloqueApartamento")
                        bloqueApartamento.setAttribute("href", "/administracion/precios/apartamentos:" + apartamentoIDV)
                        bloqueApartamento.setAttribute("vista", "/administracion/precios/apartamentos:" + apartamentoIDV)
                        bloqueApartamento.setAttribute("apartamentoIDV", apartamentoIDV)
                        bloqueApartamento.addEventListener("click", casaVitini.administracion.precios.entrarDetallesApartamento)
                        const tituloApartamento = document.createElement("p")
                        tituloApartamento.classList.add("preciosEImpuestosTituloApartamento")
                        tituloApartamento.innerText = apartamentoUI
                        bloqueApartamento.appendChild(tituloApartamento)
                        if (precio) {
                            //Total neto por dia
                            let bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("precioEImpuestosBloqueDato")
                            let tituloDato = document.createElement("p")
                            tituloDato.classList.add("precioEImpuestosOpcionApartamentoTitulo")
                            tituloDato.innerText = "Total neto por noche"
                            bloqueDato.appendChild(tituloDato)
                            let datoUI = document.createElement("p")
                            datoUI.classList.add("precioEImpuestosOpcionApartamentoDato")
                            datoUI.innerText = precio
                            bloqueDato.appendChild(datoUI)
                            bloqueApartamento.appendChild(bloqueDato)
                            //Total solo de impuestos
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("precioEImpuestosBloqueDato")
                            tituloDato = document.createElement("p")
                            tituloDato.classList.add("precioEImpuestosOpcionApartamentoTitulo")
                            tituloDato.innerText = "Total impuestos aplicados por noche"
                            bloqueDato.appendChild(tituloDato)
                            datoUI = document.createElement("p")
                            datoUI.classList.add("precioEImpuestosOpcionApartamentoDato")
                            datoUI.innerText = totalImpuestos
                            bloqueDato.appendChild(datoUI)
                            bloqueApartamento.appendChild(bloqueDato)
                            //Total bruto apartamento
                            bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("precioEImpuestosBloqueDato")
                            tituloDato = document.createElement("p")
                            tituloDato.classList.add("precioEImpuestosOpcionApartamentoTitulo")
                            tituloDato.innerText = "Total bruto por noche"
                            bloqueDato.appendChild(tituloDato)
                            datoUI = document.createElement("p")
                            datoUI.classList.add("precioEImpuestosOpcionApartamentoDato")
                            datoUI.innerText = totalNocheBruto
                            bloqueDato.appendChild(datoUI)
                            bloqueApartamento.appendChild(bloqueDato)
                        } else {
                            //Inforamcion apartamento sin perfil de precio
                            let bloqueDato = document.createElement("div")
                            bloqueDato.classList.add("precioEImpuestosBloqueDato")
                            datoUI = document.createElement("p")
                            datoUI.classList.add("precioEImpuestosOpcionApartamentoDato")
                            datoUI.innerText = "Este apartamento tiene una configuraciÃ³n de apartamento, pero no tiene ningÃºn perfil de precio creado, por lo tanto, no estÃ¡ disponible para reservar al ser un requisito para construir una configuraciÃ³n vÃ¡lida."
                            bloqueDato.appendChild(datoUI)
                            bloqueApartamento.appendChild(bloqueDato)
                        }
                        bloqueHorizontal.appendChild(bloqueApartamento)
                    })
                    bloqueGlobalApartamentos.appendChild(bloqueHorizontal)
                    selectorEspacioPreciosEImpuestos.appendChild(bloqueGlobalApartamentos)
                }
            },
            gridPrecios: async (entrada) => {
            },
            detallesApartamenro: async (respuestaServidor) => {
                if (respuestaServidor?.error) {
                    const info = {
                        titulo: "No existe ningÃºn perfil de precio base con ese identificador.",
                        descripcion: "Revisa el identificado porque no existe el perfil de precio que solicitas."
                    }
                    casaVitini.ui.componentes.mensajeSimple(info)
                } else if (respuestaServidor?.ok) {


                    const detallesApartamento = respuestaServidor?.ok
                    const apartamentoUI = detallesApartamento.apartamentoUI
                    const apartamentoIDV = detallesApartamento.apartamentoIDV
                    const precioNetoPorNoche = detallesApartamento.precioNetoPorNoche
                    const totalImpuestos = detallesApartamento.totalImpuestos
                    const totalBrutoPorNoche = detallesApartamento.totalBrutoPorNoche
                    const impuestos = detallesApartamento.impuestos

                    const selectorTitulo = document.querySelector(".titulo")
                    selectorTitulo.innerText = "Perfil de precio del " + apartamentoUI

                    const selectorEspacioPreciosEImpuestos = document.querySelector("[componente=precios]")
                    const bloqueContenedorHorizontal = document.createElement("div")
                    bloqueContenedorHorizontal.classList.add("preciosEImpuestosDetalleApartamentoBloqueHorizontal")
                    const bloqueDetallesApartamento = document.createElement("div")
                    bloqueDetallesApartamento.classList.add("preciosEImpuestosDetalleApartamentoDetallesApartmento")
                    bloqueDetallesApartamento.setAttribute("componente", "contenedorDetallesApartamento")
                    bloqueDetallesApartamento.setAttribute("apartamentoIDV", apartamentoIDV)
                    const tituloApartamento = document.createElement("p")
                    tituloApartamento.classList.add("preciosEImpuestosDetalleApartamentoTituloApartamento")
                    tituloApartamento.innerText = apartamentoUI
                    bloqueDetallesApartamento.appendChild(tituloApartamento)
                    //precio neto por dia
                    let bloqueDato = document.createElement("div")
                    bloqueDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesBloqueDato")
                    let tituloDato = document.createElement("div")
                    tituloDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesTituloDato")
                    tituloDato.innerText = "Precio neto por noche"
                    bloqueDato.appendChild(tituloDato)
                    let precioDato = document.createElement("p")
                    precioDato.classList.add("preciosEImpuestosDetalleApartamentoDatoNumero")
                    precioDato.setAttribute("precioNetoPorNoche", precioNetoPorNoche)
                    precioDato.innerText = precioNetoPorNoche
                    bloqueDato.appendChild(precioDato)
                    bloqueDetallesApartamento.appendChild(bloqueDato)
                    //total impuestos
                    bloqueDato = document.createElement("div")
                    bloqueDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesBloqueDato")
                    tituloDato = document.createElement("div")
                    tituloDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesTituloDato")
                    tituloDato.innerText = "Total impuestos por noche"
                    bloqueDato.appendChild(tituloDato)
                    precioDato = document.createElement("p")
                    precioDato.classList.add("preciosEImpuestosDetalleApartamentoDatoNumero")
                    precioDato.setAttribute("totalImpuestos", totalImpuestos)
                    precioDato.innerText = totalImpuestos
                    bloqueDato.appendChild(precioDato)
                    bloqueDetallesApartamento.appendChild(bloqueDato)
                    //total bruto por dia
                    bloqueDato = document.createElement("div")
                    bloqueDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesBloqueDato")
                    tituloDato = document.createElement("div")
                    tituloDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesTituloDato")
                    tituloDato.innerText = "Total bruto por noche"
                    bloqueDato.appendChild(tituloDato)
                    precioDato = document.createElement("p")
                    precioDato.classList.add("preciosEImpuestosDetalleApartamentoDatoNumero")
                    precioDato.setAttribute("totalBrutoPorNoche", totalBrutoPorNoche)

                    precioDato.innerText = totalBrutoPorNoche
                    bloqueDato.appendChild(precioDato)
                    bloqueDetallesApartamento.appendChild(bloqueDato)
                    let bloqueBotones = document.createElement("div")
                    bloqueBotones.classList.add("preciosEImpuestosDetalleApartamentoDetallesBloqueBotones")
                    bloqueBotones.setAttribute("componente", "bloqueBotones")
                    let boton = document.createElement("div")
                    boton.classList.add("preciosEImpuestosDetalleApartamentoDetallesBoton")
                    boton.innerText = "Modificar precio"
                    boton.setAttribute("componente", "botonModificar")
                    boton.addEventListener("click", casaVitini.administracion.precios.nuevoPrecioApartamentoUI)
                    bloqueBotones.appendChild(boton)
                    //boton = document.createElement("div")
                    //boton.classList.add("preciosEImpuestosDetalleApartamentoDetallesBoton")
                    //boton.innerText = "Eliminar perfil de precio"
                    //boton.setAttribute("componente", "botonEliminarPerfilPrecio")
                    //boton.addEventListener("click", casaVitini.administracion.precios.eliminarPerfilPrecio.UI)
                    //bloqueBotones.appendChild(boton)
                    boton = document.createElement("div")
                    boton.classList.add("preciosEImpuestosDetalleApartamentoDetallesBoton")
                    boton.classList.add("elementoOcultoInicialmente")
                    boton.setAttribute("componente", "botonCancelar")
                    boton.addEventListener("click", () => {
                        casaVitini.administracion.precios.cancelarModificarPrecio()
                    })
                    boton.innerText = "Cancelar"
                    bloqueBotones.appendChild(boton)
                    boton = document.createElement("div")
                    boton.classList.add("preciosEImpuestosDetalleApartamentoDetallesBoton")
                    boton.classList.add("elementoOcultoInicialmente")
                    boton.setAttribute("componente", "botonPrevisualizar")
                    boton.innerText = "Simular nuevo precio"
                    boton.addEventListener("click", casaVitini.administracion.precios.previsualizarPrecioApartamento)
                    bloqueBotones.appendChild(boton)
                    boton = document.createElement("div")
                    boton.classList.add("preciosEImpuestosDetalleApartamentoDetallesBoton")
                    boton.classList.add("elementoOcultoInicialmente")
                    boton.setAttribute("componente", "botonCancelarSimulacion")
                    boton.innerText = "Dejar de simular precio"
                    boton.addEventListener("click", casaVitini.administracion.precios.cancelarSimulacion)
                    bloqueBotones.appendChild(boton)
                    boton = document.createElement("div")
                    boton.classList.add("preciosEImpuestosDetalleApartamentoDetallesBoton")
                    boton.classList.add("elementoOcultoInicialmente")
                    boton.innerText = "Establecer nuevo precio neto"
                    boton.addEventListener("click", () => {
                        casaVitini.administracion.precios.establecerNuevoPrecioNetoApartamento()
                    })
                    boton.setAttribute("componente", "botonGuardar")
                    bloqueBotones.appendChild(boton)
                    boton = document.createElement("a")
                    boton.classList.add("preciosEImpuestosDetalleApartamentoDetallesBoton")
                    boton.innerText = "Ir a la configuraciÃ³n del apartamento"
                    boton.setAttribute("href", "/administracion/arquitectura_del_alojamiento/configuraciones/" + apartamentoIDV)
                    boton.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/configuraciones/" + apartamentoIDV)
                    boton.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    bloqueBotones.appendChild(boton)
                    bloqueDetallesApartamento.appendChild(bloqueBotones)
                    bloqueContenedorHorizontal.appendChild(bloqueDetallesApartamento)
                    selectorEspacioPreciosEImpuestos.appendChild(bloqueContenedorHorizontal)
                    let bloqueDetalles = document.createElement("div")
                    bloqueDetalles.classList.add("preciosEImpuestosDetalleApartamentoDetallesApartmento")
                    bloqueDetalles.setAttribute("componente", "bloqueDetallesImpuestos")
                    let tituloImpuesto = document.createElement("div")
                    tituloImpuesto.classList.add("preciosEImpuestosDetalleApartamentoDetallesTituloImpuesto")
                    tituloImpuesto.innerText = "Impuestos Aplicados"
                    bloqueDetalles.appendChild(tituloImpuesto)
                    impuestos.forEach((detalleImpuesto) => {
                        const nombreImpuesto = detalleImpuesto.nombreImpuesto
                        const tipoImpositivo = detalleImpuesto.tipoImpositivo
                        const tipoValorIDV = detalleImpuesto.tipoValorIDV
                        const totalImpuesto = detalleImpuesto.totalImpuesto
                        const impuestoUID = detalleImpuesto.impuestoUID

                        const tipoValorUI = {
                            tasa: "Tasa",
                            porcentaje: "Porcentaje"
                        }

                        let bloqueImpuesto = document.createElement("div")
                        bloqueImpuesto.classList.add("preciosEImpuestosDetalleApartamentoDetallesBloqueImpuesto")
                        bloqueImpuesto.setAttribute("impuestoUID", impuestoUID)
                        let tituloDato = document.createElement("div")
                        tituloDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesTituloDato")
                        tituloDato.innerText = nombreImpuesto
                        bloqueImpuesto.appendChild(tituloDato)
                        let bloqueDato = document.createElement("div")
                        bloqueDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesBloqueDatoImpuesto")
                        let tituloBloque = document.createElement("p")
                        tituloBloque.classList.add("preciosEImpuestosDetalleApartamentoDetallesTituloBloque")
                        tituloBloque.innerText = "Tipo impositivo"
                        bloqueDato.appendChild(tituloBloque)
                        let precioDato = document.createElement("p")
                        precioDato.classList.add("preciosEImpuestosDetalleApartamentoDatoNumeroImpuesto")
                        precioDato.innerText = tipoImpositivo
                        bloqueDato.appendChild(precioDato)
                        bloqueImpuesto.appendChild(bloqueDato)
                        bloqueDato = document.createElement("div")
                        bloqueDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesBloqueDatoImpuesto")
                        tituloBloque = document.createElement("p")
                        tituloBloque.classList.add("preciosEImpuestosDetalleApartamentoDetallesTituloBloque")
                        tituloBloque.innerText = "Tipo valor"
                        bloqueDato.appendChild(tituloBloque)
                        precioDato = document.createElement("p")
                        precioDato.classList.add("preciosEImpuestosDetalleApartamentoDatoNumeroImpuesto")
                        precioDato.innerText = tipoValorUI[tipoValorIDV]
                        bloqueDato.appendChild(precioDato)
                        bloqueImpuesto.appendChild(bloqueDato)
                        bloqueDato = document.createElement("div")
                        bloqueDato.classList.add("preciosEImpuestosDetalleApartamentoDetallesBloqueDatoImpuesto")
                        bloqueDato.setAttribute("componente", "contenedorTotalImpuesto")
                        tituloBloque = document.createElement("p")
                        tituloBloque.classList.add("preciosEImpuestosDetalleApartamentoDetallesTituloBloque")
                        tituloBloque.innerText = "Total impuesto"
                        bloqueDato.appendChild(tituloBloque)
                        precioDato = document.createElement("p")
                        precioDato.classList.add("preciosEImpuestosDetalleApartamentoDatoNumeroImpuesto")
                        precioDato.setAttribute("totalImpuesto", totalImpuesto)
                        precioDato.innerText = totalImpuesto
                        bloqueDato.appendChild(precioDato)
                        bloqueImpuesto.appendChild(bloqueDato)
                        bloqueDetalles.appendChild(bloqueImpuesto)
                    })
                    bloqueContenedorHorizontal.appendChild(bloqueDetalles)
                }
            },
            nuevoPrecioApartamentoUI: () => {
                let selectorBloqueBotones = document.querySelector("[componente=bloqueBotones]")
                let selectorcontenedorDetallesApartamento = document.querySelector("[componente=contenedorDetallesApartamento]")
                document.querySelector("[componente=botonModificar]").classList.add("elementoOcultoInicialmente")
                //document.querySelector("[componente=botonEliminarPerfilPrecio]").classList.add("elementoOcultoInicialmente")
                document.querySelector("[componente=botonCancelar]").classList.remove("elementoOcultoInicialmente")
                document.querySelector("[componente=botonGuardar]").classList.remove("elementoOcultoInicialmente")
                document.querySelector("[componente=botonPrevisualizar]").classList.remove("elementoOcultoInicialmente")
                let contenedorNuevoPrecioUI = document.createElement("div")
                contenedorNuevoPrecioUI.classList.add("preciosEImpuestosDetalleApartamentoDetallesEntradaContenedorNuevoPrecioUI")
                contenedorNuevoPrecioUI.setAttribute("componente", "contenedorNuevoPrecio")
                let info = document.createElement("div")
                info.classList.add("preciosEImpuestosDetalleApartamentoDetallesEntradaContenedorInfo")
                info.innerText = "Escriba el nuevo precio en el campo de precio.Puedes previsualizar el precio antes de aplicarlo."
                contenedorNuevoPrecioUI.appendChild(info)
                let entradaNuevoPrecio = document.createElement("input")
                entradaNuevoPrecio.classList.add("preciosEImpuestosDetalleApartamentoDetallesEntradaNuevoPrecio")
                entradaNuevoPrecio.setAttribute("componente", "campoNuevoPrecio")
                entradaNuevoPrecio.placeholder = "00.00"
                contenedorNuevoPrecioUI.appendChild(entradaNuevoPrecio)
                selectorcontenedorDetallesApartamento.insertBefore(contenedorNuevoPrecioUI, selectorBloqueBotones);
            },
            previsualizarPrecioApartamento: async () => {
                const selectorCampoNuevoPrecio = document.querySelector("[componente=campoNuevoPrecio]")
                const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                const mensaje = "Calculando previsualizacion del precio..."
                const datosPantallaSuperpuesta = {
                    instanciaUID: instanciaUID,
                    mensaje: mensaje
                }
                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                const apartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                const transaccion = {
                    zona: "administracion/precios/previsualizarPrecioApartamento",
                    apartamentoIDV: apartamentoIDV,
                    propuestaPrecio: selectorCampoNuevoPrecio.value
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                if (!instanciaRenderizada) { return }
                instanciaRenderizada.remove()

                if (respuestaServidor?.error) {
                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    document.querySelector("[componente=botonCancelarSimulacion]").classList.remove("elementoOcultoInicialmente")
                    document.querySelector("[componente=botonPrevisualizar]").style.background = "green"
                    document.querySelector("[componente=botonPrevisualizar]").style.color = "white"
                    const propuestaDetalles = respuestaServidor?.ok
                    const precioNetoPorNochePropuesto = propuestaDetalles.precioNetoPorNochePropuesto
                    const totalImpuestos = propuestaDetalles.totalImpuestos
                    const totalBrutoPorNoche = propuestaDetalles.totalBrutoPorNoche
                    const selectorAreaApartamento = document.querySelector(`[apartamentoIDV="${apartamentoIDV}"]`)
                    const selectorPrecioNetoPorDia = selectorAreaApartamento.querySelector("[precioNetoPorNoche]")
                    selectorPrecioNetoPorDia.style.color = "green"
                    selectorPrecioNetoPorDia.innerText = precioNetoPorNochePropuesto + " (SimulaciÃ³n)"

                    const selectorTotalImpuestos = selectorAreaApartamento.querySelector("[totalImpuestos]")
                    selectorTotalImpuestos.style.color = "green"
                    selectorTotalImpuestos.innerText = totalImpuestos + " (SimulaciÃ³n)"

                    const selectorTotalBrutoPorDia = selectorAreaApartamento.querySelector("[totalBrutoPorNoche]")
                    selectorTotalBrutoPorDia.style.color = "green"
                    selectorTotalBrutoPorDia.innerText = totalBrutoPorNoche + " (SimulaciÃ³n)"

                    const impuestosPorPropuesta = propuestaDetalles.impuestos
                    impuestosPorPropuesta.forEach((impuestoPropuesta) => {
                        const impuestoUID = impuestoPropuesta.impuestoUID
                        const totalImpuesto = impuestoPropuesta.totalImpuesto
                        const selectorTotalImpuesto = document.querySelector(`[impuestoUID="${impuestoUID}"] [totalImpuesto]`)
                        selectorTotalImpuesto.style.color = "green"
                        selectorTotalImpuesto.innerText = totalImpuesto + " (SimulaciÃ³n)"
                    })
                }
            },
            establecerNuevoPrecioNetoApartamento: async function () {
                const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                const mensaje = "Actualizando el precio del apartamento...."
                const datosPantallaSuperpuesta = {
                    instanciaUID: instanciaUID,
                    mensaje: mensaje
                }
                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                const selectorCampoNuevoPrecio = document.querySelector("[componente=campoNuevoPrecio]")
                const selectorApartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                const transaccion = {
                    zona: "administracion/precios/establecerNuevoPrecioApartamento",
                    apartamentoIDV: selectorApartamentoIDV,
                    nuevoPrecio: String(selectorCampoNuevoPrecio.value)
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                if (!instanciaRenderizada) { return }
                instanciaRenderizada.remove()
                if (respuestaServidor?.error) {
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    this.cancelarSimulacion()
                    this.cancelarModificarPrecio()
                    const propuestaDetalles = respuestaServidor?.ok
                    const precioNetoPorNoche = propuestaDetalles.precioNetoPorNoche
                    const totalImpuestos = propuestaDetalles.totalImpuestos
                    const totalBrutoPorNoche = propuestaDetalles.totalBrutoPorNoche

                    const areaApartamento = document.querySelector(`[apartamentoIDV="${selectorApartamentoIDV}"]`)

                    const selectorPrecioNetoPorNoche = areaApartamento.querySelector("[precioNetoPorNoche]")
                    selectorPrecioNetoPorNoche.removeAttribute("style")
                    selectorPrecioNetoPorNoche.innerText = precioNetoPorNoche

                    const selectorTotalImpuestos = areaApartamento.querySelector("[totalImpuestos]")
                    selectorTotalImpuestos.removeAttribute("style")
                    selectorTotalImpuestos.innerText = totalImpuestos

                    const selectorTotalBrutoPorNoche = areaApartamento.querySelector("[totalBrutoPorNoche]")
                    selectorTotalBrutoPorNoche.removeAttribute("style")
                    selectorTotalBrutoPorNoche.innerText = totalBrutoPorNoche

                    const impuestosPorPropuesta = propuestaDetalles.impuestos
                    impuestosPorPropuesta.forEach((impuestoPropuesta) => {
                        const impuestoUID = impuestoPropuesta.impuestoUID
                        const totalImpuesto = impuestoPropuesta.totalImpuesto
                        const selectorTotalImpuesto = document.querySelector(`[impuestoUID="${impuestoUID}"] [totalImpuesto]`)
                        selectorTotalImpuesto.innerText = totalImpuesto
                    })
                }
            },
            cancelarSimulacion: () => {
                const apartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                const selectorAreaApartamento = document.querySelector(`[apartamentoIDV="${apartamentoIDV}"]`)
                const selectorPrecioNetoPorDia = selectorAreaApartamento.querySelector("[precioNetoPorNoche]")
                selectorPrecioNetoPorDia.removeAttribute("style")
                selectorPrecioNetoPorDia.innerText = selectorPrecioNetoPorDia.getAttribute("precioNetoPorNoche")

                const selectorTotalImpuestos = selectorAreaApartamento.querySelector("[totalImpuestos]")
                selectorTotalImpuestos.removeAttribute("style")
                selectorTotalImpuestos.innerText = selectorTotalImpuestos.getAttribute("totalImpuestos")

                const selectorTotalBrutoPorDia = selectorAreaApartamento.querySelector("[totalBrutoPorNoche]")
                selectorTotalBrutoPorDia.removeAttribute("style")
                selectorTotalBrutoPorDia.innerText = selectorTotalBrutoPorDia.getAttribute("totalBrutoPorNoche")

                const selectorImpuestosRenderizados = document.querySelectorAll(`[impuestoUID]`)
                selectorImpuestosRenderizados.forEach((impuestoRenderizado) => {
                    const selectorTotalImpuesto = impuestoRenderizado.querySelector("[totalImpuesto]")
                    selectorTotalImpuesto.removeAttribute("style")
                    selectorTotalImpuesto.innerText = selectorTotalImpuesto.getAttribute(`totalImpuesto`)
                })
                document.querySelector("[componente=botonCancelarSimulacion]").classList.add("elementoOcultoInicialmente")
                document.querySelector("[componente=botonPrevisualizar]").removeAttribute("style")
                const selectorCampoPrecio = document.querySelector("[componente=campoNuevoPrecio]")
                if (selectorCampoPrecio) {
                    selectorCampoPrecio.value = ""

                }
            },
            cancelarModificarPrecio: async function () {
                document.querySelector("[componente=botonCancelarSimulacion]").classList.add("elementoOcultoInicialmente")
                document.querySelector("[componente=botonPrevisualizar]").removeAttribute("style")
                document.querySelector("[componente=botonModificar]").classList.remove("elementoOcultoInicialmente")
                //document.querySelector("[componente=botonEliminarPerfilPrecio]").classList.remove("elementoOcultoInicialmente")
                document.querySelector("[componente=botonCancelar]").classList.add("elementoOcultoInicialmente")
                document.querySelector("[componente=botonGuardar]").classList.add("elementoOcultoInicialmente")
                document.querySelector("[componente=botonPrevisualizar]").classList.add("elementoOcultoInicialmente")
                document.querySelector("[componente=contenedorNuevoPrecio]")?.remove()
                this.cancelarSimulacion()
            },
            eliminarPerfilPrecio: {
                UI: () => {
                    const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                    const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                    const titulo = constructor.querySelector("[componente=titulo]")
                    titulo.innerText = "Confirmar la eliminaciÃ³n del perfil del precio del apartamento"
                    const mensaje = constructor.querySelector("[componente=mensajeUI]")
                    mensaje.innerText = "Vas a eliminar el perfil de precio de un apartamento.Esta acciÃ³n serÃ¡ inmediata e impedirÃ¡ reservar el apartamento, ya que no se pueden hacer reservas sin un precio asignado.Si estÃ¡s de acuerdo con esta operaciÃ³n, confirma cuando desees; de lo contrario, cancela el proceso."
                    const botonAceptar = constructor.querySelector("[boton=aceptar]")
                    botonAceptar.innerText = "Comfirmar la eliminacion"
                    botonAceptar.addEventListener("click", casaVitini.administracion.precios.eliminarPerfilPrecio.confirmarEliminarPrecio)
                    const botonCancelar = constructor.querySelector("[boton=cancelar]")
                    botonCancelar.innerText = "Cancelar la eliminacion"

                    document.querySelector("main").appendChild(pantallaInmersiva)
                },
                confirmarEliminarPrecio: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Eliminado el perfil de precio..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const apartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                    const transaccion = {
                        zona: "administracion/precios/eliminarPerfilPrecioApartamento",
                        apartamentoIDV: apartamentoIDV
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const entrada = {
                            vista: "/administracion/precios",
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(entrada)
                    }
                }
            },
            entrarDetallesApartamento: (apartamento) => {
                apartamento.stopPropagation()
                apartamento.preventDefault()
                const apartamentoIDV = apartamento.target.closest("[apartamentoIDV]").getAttribute("apartamentoIDV");
                const vista = "/administracion/precios/apartamentos:" + apartamentoIDV
                const entrada = {
                    "vista": vista,
                    "tipoOrigen": "menuNavegador"
                }
                casaVitini.shell.navegacion.controladorVista(entrada)
            },
        },
        simuladorDePrecios: {
            arranque: async function () {
                const main = document.querySelector("main")
                const instanciaUID = main.getAttribute("instanciaUID")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]

                const parametros = granuladoURL.parametros
                if (comandoInicial === "simulador_de_precios" && !parametros.simulacion) {
                    this.portada.contenedorBotones()
                    this.portada.mostrarSimulacionesResueltas(granuladoURL.parametros)
                } else if (comandoInicial === "simulador_de_precios" && parametros.simulacion) {
                    main.setAttribute("zonaCSS", "administracion/simuladorDePrecios/detalles")
                    const transaccion = {
                        zona: "administracion/simuladorDePrecios/detallesSimulacion",
                        simulacionUID: String(parametros.simulacion)
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada) { return }
                    if (respuestaServidor.error) {
                        const titulo = document.querySelector(".titulo")
                        titulo.innerText = "No existe ningÃºns simulaciÃ³n con el identificador: " + parametros.simulacion
                        main.innerHTML = null
                        main.appendChild(titulo)
                        return
                    }
                    this.detallesSimulacion.detalleSimulacion(respuestaServidor)
                }
                else {
                    casaVitini.ui.componentes.urlDesconocida()

                }

            },
            portada: {
                mostrarSimulacionesResueltas: async function (listasImpuestos) {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/impuestos")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    const transaccion = {
                        zona: "administracion/simuladorDePrecios/listaSimulacionesPaginados",
                        origen: "url",
                        tipoConstruccionGrid: "total",
                        ...listasImpuestos
                    }

                    transaccion.pagina = transaccion.pagina ? Number(transaccion.pagina) : 1
                    if ((transaccion.nombre_columna)?.toLowerCase() === "impuesto_uid") {
                        transaccion.nombreColumna = "impuestoUID"
                        delete transaccion.nombre_columna
                    } else if (transaccion.nombre_columna) {
                        transaccion.nombreColumna = transaccion.nombre_columna.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                        delete transaccion.nombre_columna
                    }
                    if (transaccion.sentido_columna) {
                        transaccion.sentidoColumna = transaccion.sentido_columna
                        delete transaccion.sentido_columna
                    }
                    const origen = transaccion.origen
                    delete transaccion.origen
                    const tipoConstruccionGrid = transaccion.tipoConstruccionGrid
                    delete transaccion.tipoConstruccionGrid
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada) { return }
                    if (respuestaServidor?.error) {
                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }

                    if (respuestaServidor?.totalSimulaciones === 0) {
                        const espacioClientes = document.querySelector("[componente=espacio]")
                        document.querySelector("[gridUID=gridImpuestos]")?.remove()
                        document.querySelector("[componente=estadoBusqueda]")?.remove()
                        const estadoBusquedaUI = document.createElement("div")
                        estadoBusquedaUI.classList.add(
                            "buscadorClientesEstadoBusqueda",
                            "textoCentrado"
                        )
                        estadoBusquedaUI.setAttribute("componente", "estadoBusqueda")
                        estadoBusquedaUI.innerText = "No hay simulaciones configurados"
                        espacioClientes.appendChild(estadoBusquedaUI)
                        return

                    }
                    const simulaciones = respuestaServidor.simulaciones
                    const sentidoColumna = respuestaServidor.sentidoColumna
                    const nombreColumna = respuestaServidor.nombreColumna
                    const pagina = respuestaServidor.pagina
                    const paginasTotales = respuestaServidor.paginasTotales
                    const columnasGrid = [
                        {
                            columnaUI: "UID",
                            columnaIDV: "uid",
                            columnaClase: "idColumna"
                        },
                        {
                            columnaUI: "Nombre",
                            columnaIDV: "nombre",
                            columnaClase: "entradaColumna"
                        },
                        {
                            columnaUI: "Fecah de creaciÃ³n",
                            columnaIDV: "fechaCreacion",
                            columnaClase: "salidaColuma"
                        },
                        {
                            columnaUI: "Fecha de entrada",
                            columnaIDV: "fechaEntrada",
                            columnaClase: "estadoColumna"
                        },
                        {
                            columnaUI: "Fecha de salida",
                            columnaIDV: "fechaSalida",
                            columnaClase: "pagoColumna"
                        }
                    ]
                    const parametrosFinales = {}
                    if (pagina > 1 && paginasTotales > 1) {
                        parametrosFinales.pagina = pagina
                    }
                    if (nombreColumna) {
                        parametrosFinales.pagina = pagina
                        parametrosFinales.nombre_columna = nombreColumna.replace(/([a-z])([A-Z])/g, "$1_$2").toLowerCase();
                        parametrosFinales.sentido_columna = sentidoColumna
                    }
                    const estructuraParametrosFinales = []
                    for (const [parametroFinal, valorFinal] of Object.entries(parametrosFinales)) {
                        const estructura = `${parametroFinal}:${valorFinal}`
                        estructuraParametrosFinales.push(estructura)
                    }
                    let parametrosURLFInal = ""
                    if (estructuraParametrosFinales.length > 0) {
                        parametrosURLFInal = "/" + estructuraParametrosFinales.join("/")
                    }

                    this.selectorFiltro.ui({
                        columnas: columnasGrid,
                        columnaSeleccioanda: nombreColumna,
                        sentidoSeleccionado: sentidoColumna,
                        destino: "[contenedor=resultados]"
                    })

                    this.constructorTarjetas({
                        tarjetas: simulaciones,
                        destino: "[contenedor=resultados]"

                    })

                    const constructorURLFinal = granuladoURL.directoriosFusion + parametrosURLFInal
                    const metadatosGrid = {
                        filas: simulaciones,
                        sentidoColumna: sentidoColumna,
                        nombreColumna: nombreColumna,
                        tipoConstruccionGrid: tipoConstruccionGrid,
                        pagina: pagina,
                        destino: "[contenedor=resultados]",
                        columnasGrid: columnasGrid,
                        gridUID: "gridSimulaciones",
                        numeroColumnas: 5,
                        metodoColumna: "casaVitini.administracion.simuladorDePrecios.portada.ordenarPorColumna",
                        metodoFila: "casaVitini.administracion.simuladorDePrecios.portada.resolverFila",
                        mascaraHref: {
                            urlStatica: "/administracion/simulador_de_precios/simulacion:",
                            parametro: "simulacionUID"
                        },
                        //mascaraURL: constructorURLFinal
                    }
                    casaVitini.ui.componentes.grid(metadatosGrid)
                    const metadatosPaginador = {
                        paginaActual: pagina,
                        paginasTotales: paginasTotales,
                        destino: "[componente=espacio]",
                        metodoBoton: "casaVitini.administracion.simuladorDePrecios.portada.cambiarPagina",
                        prefijoHref: "/administracion/simulador_de_precios/simulacion:",
                        gridUID: "gridSimulaciones",
                        granuladoURL: {
                            parametros: parametrosFinales,
                            directoriosFusion: granuladoURL.directoriosFusion
                        }
                    }
                    casaVitini.ui.componentes.paginador(metadatosPaginador)
                    transaccion.tipoConstruccionGrid = "soloLista"
                    const titulo = "ADminstar reservas"
                    const estado = {
                        zona: constructorURLFinal,
                        EstadoInternoZona: "estado",
                        tipoCambio: "parcial",
                        componenteExistente: "contenedorBotonesSimulador",
                        funcionPersonalizada: "casaVitini.administracion.simuladorDePrecios.portada.mostrarImpuestosResueltos",
                        datosPaginacion: transaccion
                    }
                    if (origen === "url" || origen === "botonMostrarClientes") {
                        window.history.replaceState(estado, titulo, constructorURLFinal);
                    }
                    if (origen === "botonNumeroPagina" || origen === "tituloColumna") {
                        window.history.pushState(estado, titulo, constructorURLFinal);
                    }
                },
                resolverFila: (transaccion) => {
                    transaccion.preventDefault()
                    transaccion.stopPropagation()
                    const impuestoUID = transaccion.target.parentNode.getAttribute("href")
                    const navegacion = {
                        vista: impuestoUID,
                        tipoOrigen: "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(navegacion)
                },
                constructorTarjetas: (data) => {
                    const simulaciones = data.tarjetas
                    const destino = data.destino

                    const contenedorTarjetas = document.querySelector("[contenedor=tarjetas]")
                    contenedorTarjetas?.remove()

                    const contenedor = document.createElement("div")
                    contenedor.setAttribute("contenedor", "tarjetas")
                    contenedor.classList.add(
                        "flexVertical",
                        "gap6"
                    )

                    simulaciones.forEach(s => {
                        const simluacionUID = s.simulacionUID
                        const nombre = s.nombre
                        const fechaCreacion = s.fechaCreacion
                        const fechaEntrada = s.fechaEntrada
                        const fechaSalida = s.fechaSalida


                        const tarjeta = document.createElement("a")
                        tarjeta.setAttribute("componente", "tarjeta")
                        tarjeta.classList.add(
                            "flexVertical",
                            "gap6",
                            "tarjeta",
                            "borderRadius10",
                            "backgroundGrey1",
                            "padding10",
                            "areaSinDecoracionPredeterminada",
                            "ratonDefault",
                            "comportamientoBoton"
                        )
                        tarjeta.href = `/administracion/simulador_de_precios/simulacion:${simluacionUID}`
                        tarjeta.setAttribute("vista", `/administracion/simulador_de_precios/simulacion:${simluacionUID}`)
                        tarjeta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        contenedor.appendChild(tarjeta)

                        const datosPar = {
                            "UID": simluacionUID,
                            "Nombre": nombre,
                            "Fecha creaciÃ³n": fechaCreacion,
                            "Fecha entrada": fechaEntrada,
                            "Fecha salida": fechaSalida,


                        }

                        Object.entries(datosPar).forEach(([datoUI, data]) => {

                            const contenedor = document.createElement("div")
                            contenedor.classList.add(
                                "flexVertical"
                            )
                            if (data) {
                                tarjeta.appendChild(contenedor)
                            }
                            const titulo = document.createElement("div")
                            titulo.innerHTML = datoUI
                            contenedor.appendChild(titulo)

                            const dataUI = document.createElement("div")
                            dataUI.classList.add(
                                "negrita",
                                "textoElipsis"
                            )
                            dataUI.innerText = data
                            contenedor.appendChild(dataUI)
                        })
                    })
                    document.querySelector(destino).appendChild(contenedor)
                },
                selectorFiltro: {
                    ui: function (data) {
                        const destino = data.destino
                        const columnas = data.columnas

                        const columnaSeleccioanda = data?.columnaSeleccioanda || null
                        const sentidoSeleccionado = data?.sentidoSeleccionado || null
                        const selectorFiltroOrden = document.querySelector("[contenedor=filtrosOrden]")
                        if (selectorFiltroOrden) {
                            const selectorOrdenPorColumna = selectorFiltroOrden.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = selectorFiltroOrden.querySelector("[selector=sentido]")

                            if (columnaSeleccioanda) {
                                selectorOrdenPorColumna.value = columnaSeleccioanda

                            } else {
                                selectorOrdenPorColumna.selectedIndex = 0
                            }
                            if (sentidoSeleccionado) {
                                selectorSentido.value = sentidoSeleccionado
                            } else {
                                selectorSentido.selectedIndex = 0
                            }
                            return
                        }

                        const contenedorFiltrosOrden = document.createElement("div")
                        contenedorFiltrosOrden.classList.add(
                            "gap6",
                            "flexDerecha"
                        )
                        contenedorFiltrosOrden.setAttribute("contenedor", "filtrosOrden")

                        const botonReseteo = document.createElement("div")
                        botonReseteo.classList.add(
                            "selector",
                            "textoCentrado",
                            "comportamientoBoton",
                            "noSelecionable",
                            "ratonDefault"
                        )
                        botonReseteo.innerText = "Resetear filtros"
                        botonReseteo.addEventListener("click", (e) => {
                            const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                            const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = contenedor.querySelector("[selector=sentido]")
                            selectorColumna.selectedIndex = 0
                            selectorSentido.selectedIndex = 0
                            this.pasarela(e)
                        })
                        contenedorFiltrosOrden.appendChild(botonReseteo)

                        const selectorColumna = document.createElement("select")
                        selectorColumna.setAttribute("selector", "ordenPorColumna")
                        selectorColumna.addEventListener("change", this.pasarela)
                        selectorColumna.classList.add(
                            "selector",
                            "textoCentrado"
                        )
                        contenedorFiltrosOrden.appendChild(selectorColumna)
                        const opcionPreterminada = document.createElement("option");
                        opcionPreterminada.disabled = "true"
                        opcionPreterminada.value = ""
                        opcionPreterminada.text = "Ordenar por columna";
                        if (!columnaSeleccioanda) {
                            opcionPreterminada.selected = "true"
                        }

                        selectorColumna.add(opcionPreterminada)

                        columnas.forEach((columna) => {
                            const columnaUI = columna.columnaUI
                            const columnaIDV = columna.columnaIDV
                            const opcion = document.createElement("option");
                            opcion.value = columnaIDV;
                            opcion.text = columnaUI;
                            if (columnaSeleccioanda === columnaIDV) {
                                opcion.selected = "true"
                            }
                            selectorColumna.add(opcion);
                        })

                        const selectorSentido = document.createElement("select")
                        selectorSentido.setAttribute("selector", "sentido")
                        selectorSentido.addEventListener("change", this.pasarela)

                        selectorSentido.classList.add(
                            "selector",
                            "textoCentrado"
                        )
                        contenedorFiltrosOrden.appendChild(selectorSentido)
                        const opcionSentido = document.createElement("option");
                        opcionSentido.disabled = "true"
                        opcionSentido.text = "Sentido";
                        opcionSentido.value = ""
                        if (!sentidoSeleccionado) {
                            opcionSentido.selected = "true"
                        }
                        selectorSentido.add(opcionSentido)

                        const sentidos = [
                            {
                                sentidoUI: "Ascendente",
                                sentidoIDV: "ascendente"
                            },
                            {
                                sentidoUI: "Descendente",
                                sentidoIDV: "descendente"
                            }
                        ]

                        sentidos.forEach((sentido) => {
                            const sentidoUI = sentido.sentidoUI
                            const sentidoIDV = sentido.sentidoIDV
                            const opcion = document.createElement("option");
                            opcion.value = sentidoIDV;
                            opcion.text = sentidoUI;
                            if (sentidoSeleccionado === sentidoIDV) {
                                opcion.selected = "true"
                            }
                            selectorSentido.add(opcion);
                        })

                        document.querySelector(destino).appendChild(contenedorFiltrosOrden)
                    },
                    pasarela: (e) => {
                        const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                        const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                        const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]").value
                        const selectorSentido = contenedor.querySelector("[selector=sentido]").value
                        const ui = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        const numeroPagina = ui.querySelector("[gridUID]").getAttribute("numeroPagina")
                        const transaccion = {
                            zona: "administracion/simuladorDePrecios/listaSimulacionesPaginados",
                            pagina: Number(numeroPagina),
                            tipoConstruccionGrid: "soloLista",
                            origen: "tituloColumna",
                            granuladoURL: casaVitini.utilidades.granuladorURL()
                        }
                        transaccion.sentidoColumna = selectorSentido
                        transaccion.nombreColumna = selectorColumna

                        casaVitini.administracion.simuladorDePrecios.portada.mostrarSimulacionesResueltas(transaccion)
                    }
                },
                cambiarPagina: async (cambiarPagina) => {
                    const gridUID = cambiarPagina.gridUID
                    const gridEnlazado = document.querySelector(`[gridUID=${gridUID}]`)
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const tipoBoton = cambiarPagina.componenteID
                    const nombreColumna = gridEnlazado.getAttribute("nombreColumnaSeleccionada")
                    const sentidoColumna = gridEnlazado.getAttribute("sentidoColumna")
                    const terminoBusqueda = gridEnlazado.getAttribute("terminoBusqueda")
                    const paginaActual = Number(gridEnlazado.getAttribute("numeroPagina"))
                    const transacccion = {
                        zona: "administracion/simuladorDePrecios/listaSimulacionesPaginados",
                        nombreColumna: nombreColumna,
                        sentidoColumna: sentidoColumna,
                        buscar: terminoBusqueda,
                        tipoBusqueda: "rapido",
                        instanciaUID: instanciaUID
                    }
                    if (tipoBoton === "numeroPagina") {
                        const numeroPagina = cambiarPagina.numeroPagina
                        transacccion.pagina = Number(numeroPagina)
                        transacccion.origen = "botonNumeroPagina"
                    }
                    if (tipoBoton === "botonAdelantePaginacion") {
                        const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                        let mueveNavegadorHaciaAdelante = "Desactivado";
                        if (Number(posicionRelativa) === 10) {
                            mueveNavegadorHaciaAdelante = "Activado"
                        }
                        transacccion.pagina = paginaActual + 1
                        transacccion.origen = "botonNumeroPagina"
                        transacccion.moverHaciaAdelanteNavegacion = mueveNavegadorHaciaAdelante
                        transacccion.sentidoNavegacion = "Adelante"
                    }
                    if (tipoBoton === "botonAtrasPaginacion") {
                        const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                        let mueveNavegadorHaciaAtras = "Desactivado";
                        if (Number(posicionRelativa) === 1) {
                            mueveNavegadorHaciaAtras = "Activado"
                        }
                        transacccion.pagina = paginaActual - 1
                        transacccion.origen = "botonNumeroPagina"
                        transacccion.mueveNavegadorHaciaAtras = mueveNavegadorHaciaAtras
                        transacccion.sentidoNavegacion = "Atras"
                    }
                    transacccion.tipoConstruccionGrid = "soloLista"
                    casaVitini.administracion.simuladorDePrecios.portada.mostrarSimulacionesResueltas(transacccion)
                },
                ordenarPorColumna: async function (columna) {

                    const nombreColumna = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("nombreColumna")
                    const selectorColumnasentido = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("sentidoColumna")
                    const numeroPagina = columna.target.closest("[gridUID]").getAttribute("numeroPagina")
                    const transaccion = {
                        zona: "administracion/simuladorDePrecios/listaSimulacionesPaginados",
                        pagina: Number(numeroPagina),
                        tipoConstruccionGrid: "soloLista",
                        origen: "tituloColumna"
                    }

                    if (selectorColumnasentido === "ascendente") {
                        transaccion.sentidoColumna = "descendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    if (!selectorColumnasentido) {
                        transaccion.sentidoColumna = "ascendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    casaVitini.administracion.simuladorDePrecios.portada.mostrarSimulacionesResueltas(transaccion)
                },
                contenedorBotones: () => {
                    const espacioImpuestos = document.querySelector("[contenedor=botones]")
                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.classList.add("administracion_impuestos_contenedorBotones")
                    contenedorBotones.setAttribute("componente", "contenedorBotonesSimulador")
                    const botonCrearImpuesto = document.createElement("a")
                    botonCrearImpuesto.classList.add("administracion_impuestos_botonV1")
                    botonCrearImpuesto.innerText = "Nueva simulaciÃ³n"
                    botonCrearImpuesto.setAttribute("href", "/administracion/simulador_de_precios/nueva_simulacion")
                    botonCrearImpuesto.setAttribute("vista", "/administracion/simulador_de_precios/nueva_simulacion")
                    botonCrearImpuesto.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    contenedorBotones.appendChild(botonCrearImpuesto)
                    espacioImpuestos.appendChild(contenedorBotones)
                },
            },
            nuevaSimulacion: {
                arranque: async function () {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/simuladorPrecios/nuevaSimulacion")

                    const selectorEspacio = document.querySelector("[componente=espacio]")

                    const bloqueBloqueoApartamentos = document.createElement("div")
                    bloqueBloqueoApartamentos.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                    const tituloBloquoApartamentos = document.createElement("div")
                    tituloBloquoApartamentos.classList.add(
                        "flexVertical",
                        "textoCentrado"
                    )
                    tituloBloquoApartamentos.innerText = "Cree una simulaciÃ³n de un desglose total. Esto le permite cerciorarse en detalle de cÃ³mo se aplican las reservas, los impuestos, los servicios, las ofertas y los comportamientos de precio. Para empezar a crear una simulacion, determina un nombre para esta. Luego tambien podras cambiar el nombre en cualquier momento."
                    bloqueBloqueoApartamentos.appendChild(tituloBloquoApartamentos)
                    selectorEspacio.appendChild(bloqueBloqueoApartamentos)


                    const campoNombre = document.createElement("input")
                    campoNombre.setAttribute("campo", "nombre")
                    campoNombre.classList.add(
                        "padding12",
                        "backgroundGrey1",
                        "borderRadius10"
                    )
                    campoNombre.placeholder = "Escribe el nombre de la nueva simulaciÃ³n"
                    selectorEspacio.appendChild(campoNombre)


                    const botonCrear = document.createElement("div")
                    botonCrear.classList.add(
                        "botonV1",
                        "comportamientoBoton",
                        "padding6",
                        "textoCentrado",
                        "backgroundGrey1",
                        "borderRadius8",
                        "noSelecionable"
                    )
                    botonCrear.innerText = "Crear nueva simulaciÃ³n"
                    botonCrear.addEventListener("click", this.guardarNuevaSimulacion)
                    selectorEspacio.appendChild(botonCrear)



                    // const simulacionUI = casaVitini.administracion.simuladorDePrecios.componentes.simulacionUI()
                    // selectorEspacio.appendChild(simulacionUI)
                    // const selectorContenedorBotones = simulacionUI.querySelector("[contenedor=botones]")

                    // const botonGenerar = document.createElement("div")
                    // botonGenerar.classList.add(
                    //     "botonV1",
                    //     "comportamientoBoton",
                    //     "padding6",
                    //     "textoCentrado",
                    //     "backgroundGrey1",
                    //     "borderRadius8",
                    //     "noSelecionable"
                    // )
                    // botonGenerar.innerText = "Generar desglose financiero"
                    // botonGenerar.addEventListener("click", () => {
                    //     this.generarDesglose()

                    // })
                    // selectorContenedorBotones.appendChild(botonGenerar)

                },
                guardarNuevaSimulacion: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Guardando simulacion..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje,
                        identificadorVisual: "pantallaDeCarga"
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)

                    const nombre = document.querySelector("[campo=nombre]").value
                    // const fechaCreacion = document.querySelector("[calendario=unico]").getAttribute("memoriaVolatil")
                    // const fechaEntrada = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    // const fechaSalida = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    // const selectorApartamentos = document.querySelectorAll("[apartamentoSeleccionado]")
                    // const apartamentosIDVARRAY = []
                    // selectorApartamentos.forEach((apartamento) => {
                    //     const apartamentoIDV = apartamento.getAttribute("apartamentoSeleccionado")
                    //     apartamentosIDVARRAY.push(apartamentoIDV)
                    // })

                    const transaccion = {
                        zona: "administracion/simuladorDePrecios/guardarSimulacion",
                        nombre
                    }

                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()

                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const simuacionUID = respuestaServidor.simulacionUID
                        const entrada = {
                            vista: "/administracion/simulador_de_precios/simulacion:" + simuacionUID,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(entrada)
                    }
                },
                generarDesglose: async function () {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()

                    const info = document.createElement("div")
                    info.setAttribute("contenedor", "info")
                    info.classList.add(
                        "textoCentrado",
                        "flexVertical"
                    )
                    info.innerText = "Generando simulaciÃ³n..."

                    const contenedorSimulacion = document.querySelector("[contenedor=simulacion]")
                    contenedorSimulacion.appendChild(info)
                    contenedorSimulacion.setAttribute("instanciaUID", instanciaUID)

                    const fechaCreacion = document.querySelector("[calendario=unico]").getAttribute("memoriaVolatil")
                    const fechaEntrada = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    const fechaSalida = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    const selectorApartamentos = document.querySelectorAll("[apartamentoSeleccionado]")
                    const apartamentosIDVARRAY = []
                    selectorApartamentos.forEach((apartamento) => {
                        const apartamentoIDV = apartamento.getAttribute("apartamentoSeleccionado")
                        apartamentosIDVARRAY.push(apartamentoIDV)
                    })

                    const transaccion = {
                        zona: "administracion/simuladorDePrecios/generarSimulacion",
                        fechaCreacion,
                        fechaEntrada,
                        fechaSalida,
                        apartamentosIDVARRAY
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.innerHTML = null
                    if (respuestaServidor?.error) {
                        contenedorSimulacion.innerHTML = null
                        const infoEr = document.createElement("div")
                        infoEr.classList.add(
                            "textoCentrado",
                            "flexVertical"
                        )
                        infoEr.innerText = respuestaServidor?.error
                        instanciaRenderizada.appendChild(infoEr)
                    }
                    if (respuestaServidor?.ok) {

                        const contenedorFinanciero = respuestaServidor

                        const contenedorNoGuardado = document.createElement("div")
                        contenedorNoGuardado.classList.add(
                            "flexVertical",
                            "gap6"
                        )
                        contenedorSimulacion.appendChild(contenedorNoGuardado)


                        const infoEstadoNoGuardado = document.createElement("div")
                        infoEstadoNoGuardado.classList.add(
                            "flexVertical",
                            //"padding10",
                            "textoCentrado"
                        )
                        infoEstadoNoGuardado.innerText = "SimulaciÃ³n sin guardar.Guarde la simulaciÃ³n para acceder a las funciones avanzadas."
                        contenedorNoGuardado.appendChild(infoEstadoNoGuardado)

                        const campoNombre = document.createElement("input")
                        campoNombre.setAttribute("campo", "nombre")
                        campoNombre.classList.add(
                            "padding6",
                            "backgroundGrey1",
                            "borderRadius8",
                            "padding10",
                            "simplificadorCampo",
                            "noSelecionable"
                        )
                        campoNombre.placeholder = "Escriba un nombre para la simulaciÃ³n"
                        //botonCancelar.addEventListener("click", null)
                        contenedorNoGuardado.appendChild(campoNombre)

                        const botonGuardar = document.createElement("div")
                        botonGuardar.classList.add(
                            "botonV1",
                            "comportamientoBoton",
                            "padding6",
                            "textoCentrado",
                            "backgroundGrey1",
                            "borderRadius8",
                            "noSelecionable"
                        )
                        botonGuardar.innerText = "Guardar simulaciÃ³n"
                        botonGuardar.addEventListener("click", this.guardarNuevaSimulacion)
                        //botonCancelar.addEventListener("click", null)
                        contenedorNoGuardado.appendChild(botonGuardar)

                        casaVitini.ui.componentes.contenedorFinanciero.constructor({
                            destino: `[contenedor=simulacion]`,
                            contenedorFinanciero,
                            modoUI: "plaza"
                        })

                    }

                },
            },
            detallesSimulacion: {
                detalleSimulacion: async function (respuestaServidor) {
                    if (respuestaServidor?.error) {
                        const info = {
                            titulo: "No existe ninguna simulaciÃ³n con ese identificador",
                            descripcion: "La simulaciÃ³n a que hace referencia la URL no existe.Revisa el identificador.QuizÃ¡s fue una simulaciÃ³n que tuviste hace un tiempo y que borraste"
                        }
                        casaVitini.ui.componentes.mensajeSimple(info)
                    }
                    if (respuestaServidor?.ok) {
                        const selectorEspacio = document.querySelector("[componente=espacio]")
                        const contenedor = document.createElement("div")
                        contenedor.classList.add("contenedorNuevaSimiulacion")
                        selectorEspacio.appendChild(contenedor)
                        const instanciaUID = document.querySelector("main").getAttribute("instanciaUID")

                        const simulacionUI = casaVitini.administracion.simuladorDePrecios.componentes.simulacionUI()
                        selectorEspacio.appendChild(simulacionUI)

                        const selectorTitulo = document.querySelector(".titulo")
                        selectorTitulo.classList.add(
                            "padding5"
                        )
                        selectorTitulo.style.position = "sticky"
                        selectorTitulo.style.top = "20px"
                        selectorTitulo.style.zIndex = "2"

                        const controladorAlturaTituloDinamico = (e) => {
                            const selectorInstanciaActual = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            if (!selectorInstanciaActual) {
                                document.removeEventListener("scroll", controladorAlturaTituloDinamico)

                            }
                            const altura = window.scrollY || window.pageYOffset;

                            if (altura > 20) {
                                selectorTitulo.style.boxShadow = "0px 0px 28px 0px rgba(0, 0, 0, 0.5)"
                                selectorTitulo.style.backdropFilter = "blur(50px)"
                                selectorTitulo.style.webkitBackdropFilter = "blur(50px)"
                                selectorTitulo.style.position = "sticky"
                                selectorTitulo.style.top = "20px"
                                selectorTitulo.style.zIndex = "2"
                                selectorTitulo.style.background = "#rgb(255 255 255/25%)"
                                selectorTitulo.style.paddingRight = "20px"
                                selectorTitulo.style.borderRadius = "42px"
                                selectorTitulo.style.paddingLeft = "20px"
                                selectorTitulo.style.paddingTop = "5px"
                                selectorTitulo.style.paddingBottom = "5px"
                                selectorTitulo.style.color = "black"
                            } else {
                                selectorTitulo.removeAttribute("style")
                            }
                        }
                        document.addEventListener("scroll", controladorAlturaTituloDinamico)

                        const contenedorSimulacion = document.querySelector("[contenedor=simulacion]")
                        contenedorSimulacion.classList.add(
                            "borderRadius12",
                            "borderGrey1"
                        )
                        const contenedorGlobal = simulacionUI.querySelector("[contenedor=botones]")


                        const campoNombre = document.createElement("input")
                        campoNombre.setAttribute("campo", "nombre")
                        campoNombre.classList.add(
                            "padding6",
                            "backgroundGrey1",
                            "borderRadius8",
                            "padding10",
                            "simplificadorCampo",
                            "noSelecionable"
                        )
                        campoNombre.placeholder = "Escriba un nombre para la simulaciÃ³n"
                        //botonCancelar.addEventListener("click", null)
                        contenedorGlobal.appendChild(campoNombre)

                        const contenedorBotones = document.createElement("div")
                        contenedorBotones.classList.add(
                            "gridHorizotnal2C",
                            "gap6"
                        )
                        contenedorGlobal.appendChild(contenedorBotones)


                        const botonGuardar = document.createElement("div")
                        botonGuardar.classList.add(
                            "botonV1",
                            "comportamientoBoton",
                            "padding6",
                            "textoCentrado",
                            "backgroundGrey1",
                            "borderRadius8",
                            "noSelecionable"
                        )
                        botonGuardar.innerText = "Guardar simulaciÃ³n"
                        botonGuardar.addEventListener("click", () => {
                            this.actualizarNombreSimulacion()
                        })
                        //botonCancelar.addEventListener("click", null)
                        contenedorBotones.appendChild(botonGuardar)

                        const botonEliminar = document.createElement("div")
                        botonEliminar.classList.add(
                            "botonV1",
                            "comportamientoBoton",
                            "padding6",
                            "textoCentrado",
                            "backgroundGrey1",
                            "borderRadius8",
                            "noSelecionable"
                        )
                        botonEliminar.innerText = "Eliminar simulaciÃ³n"
                        botonEliminar.addEventListener("click", () => {
                            this.eliminarSimulacion.UI()
                        })
                        contenedorBotones.appendChild(botonEliminar)

                        const selectorNombre = simulacionUI.querySelector("[campo=nombre]")
                        const selectorFechaEntrada = simulacionUI.querySelector("[calendario=entrada]")
                        const selectorFechaSalida = simulacionUI.querySelector("[calendario=salida]")
                        const selectorFechaCreacion = simulacionUI.querySelector("[calendario=unico]")
                        const selectorsApartamentos = simulacionUI.querySelector("[contenedor=apartamentosSeleccianados]")
                        const instanciaUID_contenedorApartamentos = selectorsApartamentos.querySelector("[instanciaUID]").getAttribute("instanciaUID")

                        const simulacionData = respuestaServidor
                        const nombre = simulacionData.nombre
                        const zonaIDV = simulacionData.zonaIDV
                        const simulacionUID = simulacionData.simulacionUID
                        const fechaCreacion = simulacionData?.fechaCreacion
                        const fechaEntrada = simulacionData?.fechaEntrada
                        const fechaSalida = simulacionData?.fechaSalida
                        const contenedorFinanciero = simulacionData.contenedorFinanciero
                        const apartamentos = simulacionData.apartamentos
                        const servicios = simulacionData.servicios || []
                        const codigosDescuento = simulacionData.codigosDescuento || []

                        const hubFecha = (fecha) => {
                            if (fecha) {
                                return casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fecha)
                            } else {
                                return "(Seleccionar)"
                            }
                        }

                        selectorEspacio.setAttribute("simulacionUID", simulacionUID)
                        selectorNombre.value = nombre
                        if (fechaCreacion) {
                            selectorFechaCreacion.setAttribute("memoriaVolatil", fechaCreacion)
                        }
                        if (fechaEntrada) {
                            selectorFechaEntrada.setAttribute("memoriaVolatil", fechaEntrada)
                        }
                        if (fechaSalida) {
                            selectorFechaSalida.setAttribute("memoriaVolatil", fechaSalida)
                        }

                        selectorFechaCreacion.querySelector("[fechaUI=unico]").innerText = hubFecha(fechaCreacion)
                        selectorFechaEntrada.querySelector("[fechaUI=fechaInicio]").innerText = hubFecha(fechaEntrada)
                        selectorFechaSalida.querySelector("[fechaUI=fechaFin]").innerText = hubFecha(fechaSalida)


                        for (const contenedorApartamento of apartamentos) {
                            const apartamentoIDV = contenedorApartamento.apartamentoIDV
                            const error = `ConfiguracÃ­on de alojamiento inexistente (${apartamentoIDV})`
                            const configuracionDeAlojamiento = await casaVitini.administracion.componentes.obtenerConfiguracionAlojamiento(apartamentoIDV)
                            const apartamentoUI = configuracionDeAlojamiento?.apartamentoUI || error
                            const infoSinApartamento = document.querySelector("[componente=infoSinApartamento]")
                            infoSinApartamento.style.display = "none"

                            const selectorApartamentoUI = casaVitini.administracion.simuladorDePrecios.componentes.apartamentoUI({
                                apartamentoIDV,
                                apartamentoUI,
                                instanciaUID: instanciaUID_contenedorApartamentos,
                                tipoDespliegue: "parcial"
                            })
                            const selectorZonaApartamentos = document.querySelector("[componente=zonaAnadirApartamento]")
                            selectorZonaApartamentos.appendChild(selectorApartamentoUI)
                        }






                        if (servicios.length === 0) {
                            const contenedorServicios = simulacionUI.querySelector(`[contenedor=servicios]`)

                            const infoSinEnlaces = casaVitini
                                .administracion
                                .simuladorDePrecios
                                .componentes
                                .servicios
                                .componentesUI
                                .infoSinServiciosUI()
                            contenedorServicios.appendChild(infoSinEnlaces)
                        }

                        const selectorZonaIDV = simulacionUI.querySelector("[selector=zonaIDV]")
                        selectorZonaIDV.value = zonaIDV

                        if (servicios.length > 0) {
                            const contenedorListaServicios = simulacionUI.querySelector(`[componente=contenedorListaServiciosEnReserva]`)
                            for (const servicioEnReserva of servicios) {
                                const servicioUI = casaVitini
                                    .administracion
                                    .simuladorDePrecios
                                    .componentes
                                    .servicios
                                    .componentesUI
                                    .servicioUI({
                                        servicioUID_enSimulacion: servicioEnReserva.servicioUID,
                                        instanciaUID_contenedorServicios: simulacionUID,
                                        nombreInterno: servicioEnReserva.nombre,
                                        contenedor: servicioEnReserva.contenedor
                                    })
                                contenedorListaServicios.appendChild(servicioUI)
                            }
                        }

                        if (contenedorFinanciero.desgloseFinanciero) {
                            casaVitini.ui.componentes.contenedorFinanciero.constructor({
                                destino: `[contenedor=simulacion]`,
                                contenedorFinanciero,
                                modoUI: "simulador"
                            })
                        } else {
                            simulacionUI.querySelector("[contenedor=simulacion]").style.display = "none"
                        }

                    }
                },
                componentesUI: {
                    insertarDescuentos: {
                        ui: async function (data) {
                            const main = document.querySelector("main")
                            const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                            const simulacionUID = main.querySelector("[simulacionUID]").getAttribute("simulacionUID")
                            const instanciaUID_insertarDescuentosUI = ui.getAttribute("instanciaUID")
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                            main.appendChild(ui)
                            const constructor = ui.querySelector("[componente=contenedor]")
                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Obteniendo ofertas...",
                                textoBoton: "Cancelar"
                            })
                            constructor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/ofertas/listasOfertasAdministracion"
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const uiRenderizada = document.querySelectorAll(`[instanciaUID="${instanciaUID_insertarDescuentosUI}"]`)
                            if (!uiRenderizada) { return }
                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                spinner.remove()
                                constructor.appendChild(this.botonCancelar())

                                const ofertas = respuestaServidor.ok

                                const contenedorOfertas = document.createElement("div")
                                contenedorOfertas.classList.add(
                                    "maxWidth1280px",
                                    "width100",
                                    "flexVertical",
                                    "gap6",
                                )
                                constructor.appendChild(contenedorOfertas)
                                const estadoUI_ = (estadoIDV) => {

                                    if (estadoIDV === "activado") {
                                        return "Activada"
                                    } else if (estadoIDV === "desactivado") {
                                        return "Desactivada"
                                    }

                                }

                                ofertas.forEach((detalles) => {
                                    const nombreOferta = detalles.nombreOferta
                                    const ofertaUID = detalles.ofertaUID
                                    const fechaInicio = detalles.fechaInicio
                                    const fechaFinal = detalles.fechaFinal
                                    const estadoIDV = detalles.estadoIDV
                                    const zonaIDV = detalles.zonaIDV


                                    const contenedorOferta = document.createElement("div")
                                    contenedorOferta.setAttribute("ofertaUID", ofertaUID)
                                    contenedorOferta.classList.add(
                                        "borderRadius12",
                                        "width100",
                                        "flexVertical",
                                        "backgroundGrey1",
                                        "padding6",
                                        "gap6"
                                    )

                                    const contenedorGlobal = document.createElement("div")

                                    const nombreOfertaUI = document.createElement("div")
                                    nombreOfertaUI.classList.add("negrita")
                                    nombreOfertaUI.innerText = nombreOferta
                                    contenedorGlobal.appendChild(nombreOfertaUI)

                                    const estadoTitulo = document.createElement("div")
                                    estadoTitulo.innerText = "Estado de la oferta"
                                    contenedorGlobal.appendChild(estadoTitulo)


                                    const estadoUI = document.createElement("div")
                                    estadoUI.classList.add("negrita")
                                    estadoUI.innerText = estadoUI_(estadoIDV)
                                    contenedorGlobal.appendChild(estadoUI)
                                    contenedorOferta.appendChild(contenedorGlobal)

                                    const contendorBotones = document.createElement("div")
                                    contendorBotones.classList.add(
                                        "flexHorizontal",
                                        "gap6",
                                    )

                                    const botonInsertar = document.createElement("div")
                                    botonInsertar.classList.add(
                                        "borderRadius8",
                                        "backgroundGrey1",
                                        "comportamientoBoton",
                                        "padding8"
                                    )
                                    botonInsertar.innerText = "Insertar descuento en la reserva"
                                    botonInsertar.addEventListener("click", () => {
                                        this.confirmarInsertar({
                                            simulacionUID,
                                            ofertaUID,
                                            instanciaUID_insertarDescuentosUI,
                                            instanciaUID_contenedorFinanciero
                                        })

                                    })
                                    contendorBotones.appendChild(botonInsertar)

                                    const botonVerOferta = document.createElement("a")
                                    botonVerOferta.classList.add(
                                        "borderRadius8",
                                        "backgroundGrey1",
                                        "comportamientoBoton",
                                        "padding8",
                                        "limpiezaBotonA"
                                    )
                                    botonVerOferta.innerText = "Ir a la oferta"
                                    botonVerOferta.setAttribute("href", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                    botonVerOferta.setAttribute("vista", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                    botonVerOferta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                    contendorBotones.appendChild(botonVerOferta)


                                    contenedorOferta.appendChild(contendorBotones)

                                    contenedorOfertas.appendChild(contenedorOferta)
                                })
                                constructor.appendChild(this.botonCancelar())

                            }

                        },
                        botonCancelar: () => {
                            const botonCancelar = document.createElement("div")
                            botonCancelar.classList.add("boton")
                            botonCancelar.setAttribute("boton", "cancelar")
                            botonCancelar.innerText = "Cerrar y volver a la reserva"
                            botonCancelar.addEventListener("click", () => {
                                return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            })
                            return botonCancelar
                        },
                        confirmarInsertar: async function (data) {
                            const simulacionUID = data.simulacionUID
                            const ofertaUID = String(data.ofertaUID)
                            const instanciaUID_insertarDescuentosUI = data.instanciaUID_insertarDescuentosUI
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero

                            const ui = document.querySelector(`[instanciaUID="${instanciaUID_insertarDescuentosUI}"]`)
                            const contenedor = ui.querySelector("[componente=contenedor]")
                            contenedor.innerHTML = null

                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Insertando oferta en la reserva..."
                            })
                            contenedor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/descuentos/insertarDescuentoPorAdministrador",
                                simulacionUID,
                                ofertaUID
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const uiRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                            if (!uiRenderizada) { return }

                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                    simulacionUID
                                })
                            }

                        },

                    },
                    insertarOfertasCompatibles: {
                        ui: async function (data) {
                            const main = document.querySelector("main")
                            const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                            const simulacionUID = main.querySelector("[simulacionUID]").getAttribute("simulacionUID")
                            const instanciaUID_insertarDescuentosUI = ui.getAttribute("instanciaUID")
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                            main.appendChild(ui)
                            const constructor = ui.querySelector("[componente=contenedor]")
                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Obteniendo ofertas compatibles con la oferta...",
                                textoBoton: "Cancelar"
                            })
                            constructor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/descuentos/obtenerDescuentosCompatiblesConLaSimulacion",
                                simulacionUID
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const uiRenderizada = document.querySelectorAll(`[instanciaUID="${instanciaUID_insertarDescuentosUI}"]`)
                            if (!uiRenderizada) { return }
                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {


                                const ofertas = respuestaServidor.ofertasCompatibles
                                const contenedorOfertas = document.createElement("div")
                                contenedorOfertas.classList.add(
                                    "maxWidth1280px",
                                    "width100",
                                    "flexVertical",
                                    "gap6",
                                )
                                constructor.appendChild(contenedorOfertas)

                                spinner.remove()
                                if (ofertas.length > 0) {
                                    constructor.appendChild(this.botonCancelar())

                                } else {
                                    const info = document.createElement("p")
                                    info.classList.add(
                                        "textoCentrado"
                                    )
                                    info.innerText = "No hay ofertas compatibles con esta reserva. Si quieres insertar ofertas no compatibles de manera arbitraria, a esta reserva usa el botÃ³n de insertar descuentos."
                                    constructor.appendChild(info)

                                }

                                const estadoUI_ = (estadoIDV) => {

                                    if (estadoIDV === "activado") {
                                        return "Activada"
                                    } else if (estadoIDV === "desactivado") {
                                        return "Desactivada"
                                    }
                                }

                                ofertas.forEach((contenedorOferta) => {
                                    const detalles = contenedorOferta.oferta
                                    const nombreOferta = detalles.nombreOferta
                                    const ofertaUID = detalles.ofertaUID
                                    const fechaInicio = detalles.fechaInicio
                                    const fechaFinal = detalles.fechaFinal
                                    const estadoIDV = detalles.estadoIDV
                                    const zonaIDV = detalles.zonaIDV

                                    const contenedorOfertaUI = document.createElement("div")
                                    contenedorOfertaUI.setAttribute("ofertaUID", ofertaUID)
                                    contenedorOfertaUI.classList.add(
                                        "borderRadius12",
                                        "width100",
                                        "flexVertical",
                                        "backgroundGrey1",
                                        "padding6",
                                        "gap6"
                                    )

                                    const contenedorGlobal = document.createElement("div")

                                    const nombreOfertaUI = document.createElement("div")
                                    nombreOfertaUI.classList.add("negrita")
                                    nombreOfertaUI.innerText = nombreOferta
                                    contenedorGlobal.appendChild(nombreOfertaUI)

                                    const estadoTitulo = document.createElement("div")
                                    estadoTitulo.innerText = "Estado de la oferta"
                                    contenedorGlobal.appendChild(estadoTitulo)

                                    const estadoUI = document.createElement("div")
                                    estadoUI.classList.add("negrita")
                                    estadoUI.innerText = estadoUI_(estadoIDV)
                                    contenedorGlobal.appendChild(estadoUI)
                                    contenedorOfertaUI.appendChild(contenedorGlobal)

                                    const contendorBotones = document.createElement("div")
                                    contendorBotones.classList.add(
                                        "flexHorizontal",
                                        "gap6",
                                    )

                                    const botonInsertar = document.createElement("div")
                                    botonInsertar.classList.add(
                                        "borderRadius8",
                                        "backgroundGrey1",
                                        "comportamientoBoton",
                                        "padding8"
                                    )

                                    botonInsertar.innerText = "Insertar descuento en la reserva"
                                    botonInsertar.addEventListener("click", () => {
                                        this.confirmarInsertarCompatible({
                                            simulacionUID,
                                            ofertaUID,
                                            instanciaUID_insertarDescuentosUI,
                                            instanciaUID_contenedorFinanciero
                                        })
                                    })
                                    contendorBotones.appendChild(botonInsertar)

                                    const botonVerOferta = document.createElement("a")
                                    botonVerOferta.classList.add(
                                        "borderRadius8",
                                        "backgroundGrey1",
                                        "comportamientoBoton",
                                        "padding8",
                                        "limpiezaBotonA"
                                    )
                                    botonVerOferta.innerText = "Ir a la oferta"
                                    botonVerOferta.setAttribute("href", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                    botonVerOferta.setAttribute("vista", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                    botonVerOferta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                    contendorBotones.appendChild(botonVerOferta)

                                    contenedorOfertaUI.appendChild(contendorBotones)

                                    contenedorOfertas.appendChild(contenedorOfertaUI)
                                })
                                constructor.appendChild(this.botonCancelar())

                            }

                        },
                        botonCancelar: () => {
                            const botonCancelar = document.createElement("div")
                            botonCancelar.classList.add("boton")
                            botonCancelar.setAttribute("boton", "cancelar")
                            botonCancelar.innerText = "Cerrar y volver a la reserva"
                            botonCancelar.addEventListener("click", () => {
                                return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            })
                            return botonCancelar
                        },
                        confirmarInsertarCompatible: async function (data) {
                            const simulacionUID = data.simulacionUID
                            const ofertaUID = String(data.ofertaUID)
                            const instanciaUID_insertarDescuentosUI = data.instanciaUID_insertarDescuentosUI
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero

                            const ui = document.querySelector(`[instanciaUID="${instanciaUID_insertarDescuentosUI}"]`)
                            const contenedor = ui.querySelector("[componente=contenedor]")
                            contenedor.innerHTML = null

                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Insertando oferta en la reserva..."
                            })
                            contenedor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/descuentos/insertarDescuentoPorCompatible",
                                simulacionUID,
                                ofertaUID
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const uiRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                            if (!uiRenderizada) { return }

                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                    simulacionUID
                                })
                            }

                        },

                    },
                    sobreControlPrecios: {
                        botonAlterarPrecio: () => {
                            const botonDeslegarOpciones = document.createElement("div")
                            botonDeslegarOpciones.classList.add(
                                "padding6",
                                "botonV1",
                                "comportamientoBoton"
                            )
                            botonDeslegarOpciones.innerText = "Alterar precio"
                            return botonDeslegarOpciones
                        },
                        nocheUI: async function (data) {
                            const fechaNoche = data.fechaNoche
                            const apartamentoIDV = data.apartamentoIDV
                            const main = document.querySelector("main")
                            const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                            const simulacionUID = main.querySelector("[simulacionUID]").getAttribute("simulacionUID")
                            const instanciaUID_sobreControlUI = ui.getAttribute("instanciaUID")
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                            main.appendChild(ui)
                            const contenedor = ui.querySelector("[componente=contenedor]")
                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Obteniendo detalles de la noche...",
                                textoBoton: "Cancelar"
                            })
                            contenedor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/sobreControlPrecios/obtenerDetallesSobreControlNoche",
                                simulacionUID,
                                apartamentoIDV: apartamentoIDV,
                                fechaNoche: fechaNoche
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const uiRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)

                            if (!uiRenderizada) { return }
                            if (respuestaServidor?.error) {
                                uiRenderizada?.remove()
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor.ok) {
                                contenedor.innerHTML = null

                                const data = respuestaServidor.ok
                                const instantanea = data.instantaneaNetoApartamento
                                const apartamentoUI = instantanea.apartamentoUI
                                const precioNetoApartamento = instantanea.precioNetoApartamento

                                const sobreControl = data?.sobreControl
                                const detallesSobreControl = sobreControl.detallesSobreControl || {}
                                const operacion = detallesSobreControl?.operacion
                                const valorSobreControl = detallesSobreControl?.valor || "0.00"

                                const titulo = document.createElement("div")
                                titulo.classList.add(
                                    "textSize16",
                                    "textoCentrado"
                                )
                                titulo.innerText = `Detalles del ${apartamentoUI} en la noche de ${fechaNoche}`
                                contenedor.appendChild(titulo)

                                const contenedorValorOrigen = document.createElement("div")
                                contenedorValorOrigen.classList.add(
                                    "flexVertical",
                                    "backgroundGrey1",
                                    "padding12",
                                    "borderRadius8"
                                )
                                contenedor.appendChild(contenedorValorOrigen)

                                const tituloValorOrigen = document.createElement("div")
                                tituloValorOrigen.innerText = "Valor origen"
                                contenedorValorOrigen.appendChild(tituloValorOrigen)

                                const datoValorOrigen = document.createElement("div")
                                datoValorOrigen.classList.add(
                                    "negrita"
                                )
                                datoValorOrigen.innerText = precioNetoApartamento
                                contenedorValorOrigen.appendChild(datoValorOrigen)

                                const selectorTipoSobreControl = document.createElement("select")
                                selectorTipoSobreControl.classList.add(
                                    "selectorLista"
                                )
                                selectorTipoSobreControl.setAttribute("campo", "tipoOperacion")

                                const tituloSelector = document.createElement("option");
                                if (!operacion) {
                                    tituloSelector.selected = true;
                                }
                                tituloSelector.disabled = true;
                                tituloSelector.text = "Seleccionar el tipo de sobre control";
                                selectorTipoSobreControl.appendChild(tituloSelector);

                                const opciones = [
                                    { value: "aumentarPorPorcentaje", text: "Aumentar por porcentaje" },
                                    { value: "reducirPorPorcentaje", text: "Reducir por porcentaje" },
                                    { value: "aumentarPorCantidadFija", text: "Aumentar por cantidad fija" },
                                    { value: "reducirPorCantidadFila", text: "Reducir por cantidad fila" },
                                    { value: "establecerCantidad", text: "Establecer cantidad" }
                                ]
                                for (const opcionData of opciones) {
                                    const value = opcionData.value
                                    const text = opcionData.text
                                    const opcion = document.createElement("option");
                                    opcion.value = opcionData.value;
                                    opcion.text = opcionData.text;
                                    if (operacion === value) {
                                        opcion.selected = true;
                                    }
                                    selectorTipoSobreControl.appendChild(opcion);
                                }
                                contenedor.appendChild(selectorTipoSobreControl)
                                const campoValor = document.createElement("input")
                                campoValor.classList.add(
                                    "campoTexto"
                                )
                                campoValor.setAttribute("campo", "valor")
                                campoValor.placeholder = "Escribe la cantidad con dos decimales separados por punto, por ejemplo 0.00"
                                campoValor.value = valorSobreControl

                                contenedor.appendChild(campoValor)


                                if (Object.keys(detallesSobreControl).length > 0) {
                                    const boton = document.createElement("div")
                                    boton.classList.add("boton")
                                    boton.innerText = "Actualizar sobre control de precio"
                                    boton.addEventListener("click", () => {
                                        this.confirmar({
                                            instanciaUID_sobreControlUI,
                                            instanciaUID_contenedorFinanciero,
                                            simulacionUID,
                                            apartamentoIDV,
                                            tipoOperacion: selectorTipoSobreControl.value,
                                            fechaNoche,
                                            valorSobreControl: campoValor.value
                                        })
                                    })
                                    contenedor.appendChild(boton)
                                    const botonEliminar = document.createElement("div")
                                    botonEliminar.classList.add("boton")
                                    botonEliminar.innerText = "Eliminar sobre control de precio"
                                    botonEliminar.addEventListener("click", () => {
                                        this.eliminarSobreControl({
                                            instanciaUID_sobreControlUI,
                                            instanciaUID_contenedorFinanciero,
                                            simulacionUID,
                                            apartamentoIDV,
                                            fechaNoche
                                        })
                                    })
                                    contenedor.appendChild(botonEliminar)
                                } else {
                                    const boton = document.createElement("div")
                                    boton.classList.add("boton")
                                    boton.innerText = "Crear sobre control de precio"
                                    boton.addEventListener("click", () => {
                                        this.confirmar({
                                            instanciaUID_sobreControlUI,
                                            instanciaUID_contenedorFinanciero,
                                            simulacionUID,
                                            apartamentoIDV,
                                            tipoOperacion: selectorTipoSobreControl.value,
                                            fechaNoche,
                                            valorSobreControl: campoValor.value
                                        })
                                    })
                                    contenedor.appendChild(boton)
                                }

                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("boton")
                                botonCancelar.innerText = "Cancelar y volver al desglose por noche."
                                botonCancelar.addEventListener("click", () => {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                })
                                contenedor.appendChild(botonCancelar)
                            }
                        },
                        confirmar: async function (data) {
                            const instanciaUID_sobreControlUI = data.instanciaUID_sobreControlUI
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                            const simulacionUID = data.simulacionUID
                            const apartamentoIDV = data.apartamentoIDV
                            const tipoOperacion = data.tipoOperacion
                            const fechaNoche = data.fechaNoche
                            const valorSobreControl = data.valorSobreControl
                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/sobreControlPrecios/actualizarSobreControlNoche",
                                simulacionUID,
                                apartamentoIDV,
                                fechaNoche,
                                tipoOperacion,
                                valorSobreControl
                            }
                            const uiRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)
                            const contenedor = uiRenderizada.querySelector("[componente=contenedor]")
                            //contenedor.innerHTML = null

                            const instanciaPantallaCarga = casaVitini.utilidades.codigoFechaInstancia()
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta({
                                mensaje: "Aplicando sobrecontrol de precio",
                                textoBoton: "ocultar",
                                instanciaUID: instanciaPantallaCarga
                            })

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaPantallaCargaUI = document.querySelector(`[instanciaUID="${instanciaPantallaCarga}"]`)
                            instanciaPantallaCargaUI?.remove()

                            const uiContenedorFinanciero = document.querySelector(`[instanciaUID="${instanciaUID_contenedorFinanciero}"]`)
                            //if (!uiContenedorFinanciero) { return }

                            if (respuestaServidor?.error) {
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor.ok) {
                                const sobreControlUI = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)
                                if (sobreControlUI) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                }

                                const selectorDesgloseEnPantalla = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                                if (!selectorDesgloseEnPantalla) {
                                    return
                                }
                                return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                    simulacionUID
                                })

                            }
                        },
                        eliminarSobreControl: async (data) => {
                            const instanciaUID_sobreControlUI = data.instanciaUID_sobreControlUI
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                            const simulacionUID = data.simulacionUID
                            const apartamentoIDV = data.apartamentoIDV
                            const fechaNoche = data.fechaNoche
                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/sobreControlPrecios/eliminarSobreControlNoche",
                                simulacionUID,
                                apartamentoIDV,
                                fechaNoche
                            }
                            const uiRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)
                            const instanciaPantallaCarga = casaVitini.utilidades.codigoFechaInstancia()
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta({
                                mensaje: "Eliminado sobrecontrol de precio",
                                textoBoton: "ocultar",
                                instanciaUID: instanciaPantallaCarga
                            })

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaPantallaCargaUI = document.querySelector(`[instanciaUID="${instanciaPantallaCarga}"]`)
                            instanciaPantallaCargaUI?.remove()

                            if (respuestaServidor?.error) {
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor.ok) {
                                const sobreControlUI = document.querySelector(`[instanciaUID="${instanciaUID_sobreControlUI}"]`)
                                if (sobreControlUI) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                }

                                const selectorDesgloseEnPantalla = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                                if (!selectorDesgloseEnPantalla) {
                                    return
                                }
                                return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                    simulacionUID
                                })
                            }
                        }

                    },
                    eliminarOfertaEnSimulacion: {
                        ui: async function (data) {

                            const nombreOferta = data.nombreOferta
                            const ofertaUID = data.ofertaUID
                            const posicion = data.posicion
                            const simulacionUID = document.querySelector("[simulacionUID]").getAttribute("simulacionUID")
                            const origen = data.origen

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const instanciaUID = pantallaInmersiva.getAttribute("instanciaUID")
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.classList.add(
                                "negrita"
                            )
                            titulo.innerText = nombreOferta
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = `Confirmas o no la eliminaciÃ³n de la oferta de la reserva, Â¿Estas de acuerdo?`

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = "Confirmar la eliminaciÃ³n de la oferta de esta reserva"
                            botonAceptar.addEventListener("click", () => {
                                this.confirmar({
                                    simulacionUID,
                                    ofertaUID,
                                    posicion,
                                    origen,
                                    instanciaUID
                                })
                            })
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar y volver a la reserva"
                            document.querySelector("main").appendChild(pantallaInmersiva)

                        },
                        confirmar: async (data) => {

                            const ofertaUID = data.ofertaUID
                            const posicion = data.posicion
                            const simulacionUID = data.simulacionUID
                            const origen = data.origen

                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const mensaje = "Elimiando oferta de la reserva..."
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID,
                                mensaje: mensaje
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/descuentos/eliminarDescuentoEnSimulacion",
                                simulacionUID: String(simulacionUID),
                                ofertaUID: String(ofertaUID),
                                origen,
                                posicion: String(posicion)
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            instanciaRenderizada.remove()

                            if (respuestaServidor?.error) {
                                return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                    simulacionUID
                                })
                            }
                        }

                    },
                    actualizarEstadoAutorizacion: async (data) => {

                        const ofertaUID = data.ofertaUID
                        const simulacionUID = document.querySelector("[simulacionUID]").getAttribute("simulacionUID")
                        const e = data.e
                        const area = e.target.closest("[ofertaUID][posicion]")
                        const autorizacionUI = area.querySelector("[dato=autorizacion]")
                        const estadoActualData = area.querySelector("[estadoActual]")
                        const estadoActual = estadoActualData.getAttribute("estadoActual")

                        const transaccion = {
                            zona: "administracion/simuladorDePrecios/descuentos/actualizarAutorizacionDescuentoCompatible",
                            simulacionUID: String(simulacionUID),
                            ofertaUID: String(ofertaUID),
                        }

                        if (estadoActual === "aceptada") {
                            autorizacionUI.innerText = "Rechazando..."
                            transaccion.nuevaAutorizacion = "rechazada"
                        } else if (estadoActual === "rechazada") {
                            autorizacionUI.innerText = "Aceptando..."
                            transaccion.nuevaAutorizacion = "aceptada"
                        }

                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const estadoAutorizado = respuestaServidor.autorizacion
                            estadoActualData.setAttribute("estadoActual", estadoAutorizado)
                            if (estadoAutorizado === "aceptada") {
                                autorizacionUI.innerText = "Aceptada"
                                estadoActualData.innerText = "Rechazar oferta"
                            } else if (estadoAutorizado === "rechazada") {
                                autorizacionUI.innerText = "Rechazada"
                                estadoActualData.innerText = "Aceptar oferta"
                            }
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                simulacionUID
                            })
                        }
                    },
                    insertarImpuesto: {
                        ui: async function (data) {
                            const main = document.querySelector("main")
                            const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                            const simulacionUID = main.querySelector("[simulacionUID]").getAttribute("simulacionUID")
                            const instanciaUID_insertarImpuestoUI = ui.getAttribute("instanciaUID")
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                            main.appendChild(ui)
                            const constructor = ui.querySelector("[componente=contenedor]")
                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Obteniendo impuestos...",
                                textoBoton: "Cancelar"
                            })
                            constructor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/impuestos/listarTodosLosImpuestos"
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const uiRenderizada = document.querySelectorAll(`[instanciaUID="${instanciaUID_insertarImpuestoUI}"]`)
                            if (!uiRenderizada) { return }
                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                spinner.remove()
                                constructor.appendChild(this.botonCancelar())

                                const impuestos = respuestaServidor.impuestos

                                const contenedorOfertas = document.createElement("div")
                                contenedorOfertas.classList.add(
                                    "maxWidth1280px",
                                    "width100",
                                    "flexVertical",
                                    "gap6",
                                )
                                constructor.appendChild(contenedorOfertas)
                                const estadoUI_ = (estadoIDV) => {

                                    if (estadoIDV === "activado") {
                                        return "Activada"
                                    } else if (estadoIDV === "desactivado") {
                                        return "Desactivada"
                                    }

                                }

                                impuestos.forEach((impuesto) => {
                                    const impuestoUID = impuesto.impuestoUID
                                    const nombre = impuesto.nombre
                                    const tipoImpositivo = impuesto.tipoImpositivo
                                    const tipoValorIDV = impuesto.tipoValorIDV
                                    const entidadIDV = impuesto.entidadIDV
                                    const estadoIDV = impuesto.estadoIDV


                                    const contenedorOferta = document.createElement("div")
                                    contenedorOferta.setAttribute("impuestoUID", impuestoUID)
                                    contenedorOferta.classList.add(
                                        "borderRadius12",
                                        "width100",
                                        "flexVertical",
                                        "backgroundGrey1",
                                        "padding6",
                                        "gap6"
                                    )

                                    const contenedorGlobal = document.createElement("div")

                                    const nombreOfertaUI = document.createElement("div")
                                    nombreOfertaUI.classList.add("negrita")
                                    nombreOfertaUI.innerText = nombre
                                    contenedorGlobal.appendChild(nombreOfertaUI)

                                    const estadoTitulo = document.createElement("div")
                                    estadoTitulo.innerText = "Estado del impuesto"
                                    contenedorGlobal.appendChild(estadoTitulo)


                                    const estadoUI = document.createElement("div")
                                    estadoUI.classList.add("negrita")
                                    estadoUI.innerText = estadoUI_(estadoIDV)
                                    contenedorGlobal.appendChild(estadoUI)
                                    contenedorOferta.appendChild(contenedorGlobal)

                                    const contendorBotones = document.createElement("div")
                                    contendorBotones.classList.add(
                                        "flexHorizontal",
                                        "gap6",
                                    )

                                    const botonInsertar = document.createElement("div")
                                    botonInsertar.classList.add(
                                        "borderRadius8",
                                        "backgroundGrey1",
                                        "comportamientoBoton",
                                        "padding8"
                                    )
                                    botonInsertar.innerText = "Insertar impuesto en la reserva"
                                    botonInsertar.addEventListener("click", () => {
                                        this.confirmarInsertar({
                                            simulacionUID,
                                            impuestoUID,
                                            instanciaUID_insertarImpuestoUI,
                                            instanciaUID_contenedorFinanciero
                                        })
                                    })
                                    contendorBotones.appendChild(botonInsertar)

                                    const botonVerOferta = document.createElement("a")
                                    botonVerOferta.classList.add(
                                        "borderRadius8",
                                        "backgroundGrey1",
                                        "comportamientoBoton",
                                        "padding8",
                                        "limpiezaBotonA"
                                    )
                                    botonVerOferta.innerText = "Ir al impuesto"
                                    botonVerOferta.setAttribute("href", "/administracion/impuestos/" + impuestoUID)
                                    botonVerOferta.setAttribute("vista", "/administracion/impuestos/" + impuestoUID)
                                    botonVerOferta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                    contendorBotones.appendChild(botonVerOferta)


                                    contenedorOferta.appendChild(contendorBotones)

                                    contenedorOfertas.appendChild(contenedorOferta)
                                })
                                constructor.appendChild(this.botonCancelar())

                            }

                        },
                        botonCancelar: () => {
                            const botonCancelar = document.createElement("div")
                            botonCancelar.classList.add("boton")
                            botonCancelar.setAttribute("boton", "cancelar")
                            botonCancelar.innerText = "Cerrar y volver a la reserva"
                            botonCancelar.addEventListener("click", () => {
                                return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            })
                            return botonCancelar
                        },
                        confirmarInsertar: async function (data) {
                            const simulacionUID = data.simulacionUID
                            const impuestoUID = String(data.impuestoUID)
                            const instanciaUID_insertarImpuestoUI = data.instanciaUID_insertarImpuestoUI
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero

                            const ui = document.querySelector(`[instanciaUID="${instanciaUID_insertarImpuestoUI}"]`)
                            const contenedor = ui.querySelector("[componente=contenedor]")
                            contenedor.innerHTML = null

                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Insertando oferta en la reserva..."
                            })
                            contenedor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/impuestos/insertarImpuestoEnSimulacion",
                                impuestoUID,
                                simulacionUID
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const uiRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                            if (!uiRenderizada) { return }

                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                    simulacionUID
                                })
                            }
                        },

                    },
                    eliminarImpuesto: {
                        ui: async function (data) {
                            const nombreImpuesto = data.nombreImpuesto
                            const impuestoUID = data.impuestoUID
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                            const simulacionUID = document.querySelector("main").querySelector("[simulacionUID]").getAttribute("simulacionUID")

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                            const instanciaUID_eliminarImpuestoUI = pantallaInmersiva.getAttribute("instanciaUID")


                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = `Confirmar eliminar impuesto ${nombreImpuesto} de la reserva`
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = "Var a eliminar el impuesto de la reserva, Â¿Estas de acuerdo ? "

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = "Comfirmar la eliminacion"
                            botonAceptar.addEventListener("click", () => {
                                this.confirmarEliminar({
                                    impuestoUID,
                                    simulacionUID,
                                    instanciaUID_contenedorFinanciero,
                                    instanciaUID_eliminarImpuestoUI
                                })
                            })
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar y volver"

                            document.querySelector("main").appendChild(pantallaInmersiva)

                        },
                        confirmarEliminar: async function (data) {
                            const simulacionUID = data.simulacionUID
                            const impuestoUID = String(data.impuestoUID)
                            const instanciaUID_eliminarImpuestoUI = data.instanciaUID_eliminarImpuestoUI
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero



                            const ui = document.querySelector(`[instanciaUID="${instanciaUID_eliminarImpuestoUI}"]`)
                            const contenedor = ui.querySelector("[componente=constructor]")
                            contenedor.innerHTML = null

                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Eliminado impuesto en la reserva..."
                            })
                            contenedor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/impuestos/eliminarImpuestoEnSimulacion",
                                simulacionUID,
                                impuestoUID
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const uiRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                            if (!uiRenderizada) { return }

                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                    simulacionUID
                                })
                            }

                        },

                    },
                    crearImpuestoAdHoc: {
                        ui: async function (data) {
                            const nombreImpuesto = data.nombreImpuesto
                            const impuestoUID = data.impuestoUID
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                            const simulacionUID = document.querySelector("main").querySelector("[simulacionUID]").getAttribute("simulacionUID")

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                            const instanciaUID_eliminarImpuestoUI = pantallaInmersiva.getAttribute("instanciaUID")
                            const contenedor = pantallaInmersiva.querySelector("[componente=contenedor]")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = `Crear impuesto dedicado solo para esta reserva`
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = "Rellena el formulario para crear un impuesto solo para esta reserva.Este impuesto creado solo existirÃ¡ en esta reserva.Si necesitas crear un impuesto que quieras usar para insertar en reservas, pero que no se aplique, crea un impuesto en la secciÃ³n de impuesto y mantenlo desactivado."

                            const contenedorFormulario = document.createElement("div")
                            contenedorFormulario.classList.add(
                                "flexVertical",
                                "gap6"
                            )
                            contenedor.appendChild(contenedorFormulario)


                            const campoCraerNuevoImpuesto = document.createElement("input")
                            campoCraerNuevoImpuesto.classList.add(
                                "padding10",
                                "borderRadius10"

                            )
                            campoCraerNuevoImpuesto.setAttribute("comNuevoImpuesto", "nombreImpuesto")
                            campoCraerNuevoImpuesto.placeholder = "Escribo el nombre del nuevo impuesto"
                            contenedorFormulario.appendChild(campoCraerNuevoImpuesto)

                            const campoTipoImpositivo = document.createElement("input")
                            campoTipoImpositivo.classList.add(
                                "padding10",
                                "borderRadius10"
                            )
                            campoTipoImpositivo.setAttribute("comNuevoImpuesto", "tipoImpositivo")
                            campoTipoImpositivo.placeholder = "0.00"
                            contenedorFormulario.appendChild(campoTipoImpositivo)

                            const contenedorOpciones = document.createElement("select")
                            contenedorOpciones.classList.add(
                                "padding10",
                                "borderRadius10"
                            )
                            contenedorOpciones.setAttribute("comNuevoImpuesto", "tipoValor")
                            const tipoValorLista = [
                                {
                                    tipoValorIDV: "",
                                    tipoValorUI: "Selecciona el tipo de impuesto"
                                },
                                {
                                    tipoValorIDV: "porcentaje",
                                    tipoValorUI: "Porcentaje"
                                },
                                {
                                    tipoValorIDV: "tasa",
                                    tipoValorUI: "Tasa"
                                },

                            ]
                            tipoValorLista.forEach((contenedorTipoValor) => {
                                const tipoValorIDV = contenedorTipoValor.tipoValorIDV
                                const tipoValorUI = contenedorTipoValor.tipoValorUI
                                const opcion = document.createElement("option");
                                if (!tipoValorIDV) {
                                    opcion.selected = true;
                                    opcion.disabled = true;

                                }
                                opcion.value = tipoValorIDV;
                                opcion.text = tipoValorUI;
                                opcion.setAttribute("opcion", tipoValorIDV)
                                contenedorOpciones.add(opcion);
                            })
                            contenedorFormulario.appendChild(contenedorOpciones)


                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = "Crear impuesto dedicado para esta reserva"
                            botonAceptar.addEventListener("click", () => {
                                this.confirmarCrearImpuestoAdHoc({
                                    simulacionUID,
                                    instanciaUID_contenedorFinanciero,
                                    instanciaUID_eliminarImpuestoUI,
                                    nombreImpuesto: campoCraerNuevoImpuesto.value,
                                    tipoImpositivo: campoTipoImpositivo.value,
                                    tipoValorIDV: contenedorOpciones.value

                                })
                            })
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar y volver"

                            document.querySelector("main").appendChild(pantallaInmersiva)

                        },
                        confirmarCrearImpuestoAdHoc: async function (data) {
                            const simulacionUID = data.simulacionUID
                            const nombreImpuesto = data.nombreImpuesto
                            const tipoImpositivo = data.tipoImpositivo
                            const tipoValorIDV = data.tipoValorIDV

                            const instanciaUID_eliminarImpuestoUI = data.instanciaUID_eliminarImpuestoUI
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero

                            const instanciaUID_pantallaDeCargaSuperPuesta = casaVitini.utilidades.codigoFechaInstancia()

                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID_pantallaDeCargaSuperPuesta,
                                mensaje: "Creando impuesto dedicado e insertando en la reserva..."
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/impuestos/insertarImpuestoDedicadoEnSimulacion",
                                simulacionUID,
                                nombreImpuesto,
                                tipoImpositivo,
                                tipoValorIDV,
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            document.querySelector(`[instanciaUID="${instanciaUID_pantallaDeCargaSuperPuesta}"]`)?.remove()

                            const uiRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                            if (!uiRenderizada) { return }

                            if (respuestaServidor?.error) {
                                return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                    simulacionUID
                                })
                            }
                        },

                    },
                    reconstruirDesgloseFinanciero: {
                        ui: async function (data) {
                            const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                            const simulacionUID = document.querySelector("main").querySelector("[simulacionUID]").getAttribute("simulacionUID")

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                            const contenedor = pantallaInmersiva.querySelector("[componente=contenedor]")
                            const instanciaUID_reconstrucion = pantallaInmersiva.getAttribute("instanciaUID")
                            document.querySelector("main").appendChild(pantallaInmersiva)



                            const tituloUI = document.createElement("p")
                            tituloUI.classList.add("titulo")
                            tituloUI.setAttribute("componente", "titulo")
                            tituloUI.innerText = `Elige el origen de la reconstrucion del desglose financiero de la reserva ${simulacionUID}`
                            contenedor.appendChild(tituloUI)



                            const mensajeUI = document.createElement("div")
                            mensajeUI.classList.add("mensajeUI")
                            mensajeUI.setAttribute("componente", "mensajeUI")
                            mensajeUI.innerText = "Esta operaciÃ³n reconstruye el desglose financiero.Reconstruir desde la instantÃ¡nea regenera el desglose financiero desde las instantÃ¡neas del contenedor financiero de la reserva.Esta operaciÃ³n es Ãºtil si no se ha reconstituido por alguna razÃ³n el desglose financiero correctamente tras alguna operaciÃ³n."
                            contenedor.appendChild(mensajeUI)


                            const botonDesdeInstantaneas = document.createElement("div")
                            botonDesdeInstantaneas.classList.add("boton")
                            botonDesdeInstantaneas.setAttribute("boton", "aceptar")
                            botonDesdeInstantaneas.innerText = "Reconstruir desde instantaneas"
                            botonDesdeInstantaneas.addEventListener("click", () => {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                this.desdeInstantaneas.ui({
                                    simulacionUID,
                                    instanciaUID_contenedorFinanciero,
                                    instanciaUID_reconstrucion
                                })
                            })
                            contenedor.appendChild(botonDesdeInstantaneas)


                            const mensajeUI_ = document.createElement("div")
                            mensajeUI_.classList.add("mensajeUI")
                            mensajeUI_.setAttribute("componente", "mensajeUI")
                            mensajeUI_.innerText = "Reconstruir el desglose financiero desde el hub, reconstruirÃ¡ el desglose financiero actualizando las instantÃ¡neas de la reserva desde el hub de precios base, comportamiento de precios y ofertas actualmente configurados.Esta operaciÃ³n es irreversible y puede ser Ãºtil cuando necesito actualizar ciertos datos del contenedor financiero de la reserva desde los hubs de origen."
                            contenedor.appendChild(mensajeUI_)

                            const botonDesdeHub = document.createElement("div")
                            botonDesdeHub.classList.add("boton")
                            botonDesdeHub.setAttribute("boton", "aceptar")
                            botonDesdeHub.innerText = "Reconstruir desde el hub"
                            botonDesdeHub.addEventListener("click", () => {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                this.desdeHub.ui({
                                    simulacionUID,
                                    instanciaUID_contenedorFinanciero,
                                    instanciaUID_reconstrucion
                                })

                            })

                            contenedor.appendChild(botonDesdeHub)

                            const botonCancelar = document.createElement("div")
                            botonCancelar.classList.add("boton")
                            botonCancelar.setAttribute("boton", "cancelar")
                            botonCancelar.innerText = "Cancelar y volver"
                            botonCancelar.addEventListener("click", () => {
                                return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            })
                            contenedor.appendChild(botonCancelar)

                        },
                        desdeInstantaneas: {
                            ui: async function (data) {
                                const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                const simulacionUID = document.querySelector("main").querySelector("[simulacionUID]").getAttribute("simulacionUID")

                                const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                                const instanciaUID_reconstrucion = pantallaInmersiva.getAttribute("instanciaUID")


                                const titulo = constructor.querySelector("[componente=titulo]")
                                titulo.innerText = `Confirmar reconstruir el desglose de la reserva ${simulacionUID} de las instantaneas`
                                const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                mensaje.innerText = "Esta operaciÃ³n reconstruye el desglose financiero.SÃ­ ha ocurrido un algÃºn tipo de error en algÃºn cÃ¡lculo durante la construcciÃ³n del desglose financiero, esta opciÃ³n podrÃ­a recuperar la interferencia del desglose financiero."

                                const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                botonAceptar.innerText = "Comfirmar la reconstrucciÃ³n"
                                botonAceptar.addEventListener("click", () => {
                                    this.confirmarReconstrucion({
                                        simulacionUID,
                                        instanciaUID_contenedorFinanciero,
                                        instanciaUID_reconstrucion
                                    })
                                })
                                const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                botonCancelar.innerText = "Cancelar y volver"

                                document.querySelector("main").appendChild(pantallaInmersiva)

                            },
                            confirmarReconstrucion: async function (data) {
                                const simulacionUID = data.simulacionUID
                                const instanciaUID_reconstrucion = data.instanciaUID_reconstrucion
                                const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero

                                const ui = document.querySelector(`[instanciaUID="${instanciaUID_reconstrucion}"]`)
                                const contenedor = ui.querySelector("[componente=constructor]")
                                contenedor.innerHTML = null

                                const spinner = casaVitini.ui.componentes.spinner({
                                    mensaje: "Reconstruyendo el desglose financiero desde las instantÃ¡neas de la reserva..."
                                })
                                contenedor.appendChild(spinner)

                                const transaccion = {
                                    zona: "administracion/simuladorDePrecios/contenedorFinanciero/reconstruirDesgloseDesdeInstantaneas",
                                    simulacionUID
                                }

                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const uiRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                                if (!uiRenderizada) { return }

                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                        simulacionUID
                                    })
                                }

                            },
                        },
                        desdeHub: {
                            ui: async function (data) {
                                const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero
                                const simulacionUID = document.querySelector("main").querySelector("[simulacionUID]").getAttribute("simulacionUID")

                                const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                                const instanciaUID_reconstrucion = pantallaInmersiva.getAttribute("instanciaUID")
                                const contenedor = pantallaInmersiva.querySelector("[componente=contenedor]")
                                contenedor.classList.add(
                                    "flexVertical"
                                )



                                const titulo = constructor.querySelector("[componente=titulo]")
                                titulo.innerText = `Confirmar reconstruir el desglose de la reserva ${simulacionUID} desde el hub (Oeracion irreversible)`
                                const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                mensaje.innerText = "Esta operaciÃ³n reconstruye el desglose financiero, actualizando las instantÃ¡neas desde el hub de precios base, comportamientos de precio, ofertas e impuestos.Esta operaciÃ³n es irreversible porque sobrescribe los datos actuales de las instantÃ¡neas y reconstruye todo el contenedor financiero de la reserva.Para evitar falsos clics, por favor, escribe la palabra, reconstruir, en el campo de texto."

                                const campo = document.createElement("input")
                                campo.placeholder = "Escribe la palabra reconstruir"
                                campo.classList.add(
                                    "borderRadius10",
                                    "padding10"
                                )
                                contenedor.appendChild(campo)
                                const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                botonAceptar.innerText = "Comfirmar la reconstrucciÃ³n irreversible de todo el contenedor financiero de la reserva"
                                botonAceptar.addEventListener("click", () => {
                                    this.confirmarReconstrucion({
                                        simulacionUID,
                                        instanciaUID_contenedorFinanciero,
                                        instanciaUID_reconstrucion,
                                        palabra: campo.value
                                    })
                                })
                                const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                botonCancelar.innerText = "Cancelar y volver"

                                document.querySelector("main").appendChild(pantallaInmersiva)

                            },
                            confirmarReconstrucion: async function (data) {
                                const simulacionUID = data.simulacionUID
                                const palabra = data.palabra
                                const instanciaUID_contenedorFinanciero = data.instanciaUID_contenedorFinanciero

                                const instanciaUID_pantallaDeCargaSuperPuesta = casaVitini.utilidades.codigoFechaInstancia()

                                const datosPantallaSuperpuesta = {
                                    instanciaUID: instanciaUID_pantallaDeCargaSuperPuesta,
                                    mensaje: "Reconstruyendo todo el contenedor financiero de la reserva desde los hubs..."
                                }
                                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)

                                const transaccion = {
                                    zona: "administracion/simuladorDePrecios/contenedorFinanciero/reconstruirDesgloseDesdeHubs",
                                    simulacionUID,
                                    palabra
                                }

                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const pantallaDeCarga_renderizda = document.querySelector(`[instanciaUID="${instanciaUID_pantallaDeCargaSuperPuesta}"]`)
                                pantallaDeCarga_renderizda?.remove()

                                const uiRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                                if (!uiRenderizada) { return }

                                if (respuestaServidor?.error) {
                                    return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)

                                }
                                if (respuestaServidor?.ok) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                                        simulacionUID
                                    })
                                }

                            },
                        }

                    },
                    desplegarContenedorFinanciero: async (data) => {
                        const simulacionUID = data.simulacionUID
                        const transaccion = {
                            zona: "administracion/simuladorDePrecios/detallesSimulacion",
                            simulacionUID: String(simulacionUID)
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                        const instanciaRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                        if (!instanciaRenderizada) {
                            return
                        }
                        if (respuestaServidor?.error) {
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const contenedorFinanciero = respuestaServidor.contenedorFinanciero
                            casaVitini.ui.componentes.contenedorFinanciero.constructor({
                                destino: `[simulacionUID="${simulacionUID}"] [contenedor=simulacion]`,
                                contenedorFinanciero,
                                modoUI: "simulador"
                            })
                        }
                    }
                },
                eliminarSimulacion: {
                    UI: function () {
                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                        const titulo = constructor.querySelector("[componente=titulo]")
                        titulo.innerText = "Confirmar la eliminaciÃ³n de la simulaciÃ³n"
                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                        mensaje.innerText = "Vas a eliminar la simulacuiÃ³n"

                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                        botonAceptar.innerText = "Comfirmar la eliminacion del impuesto"
                        botonAceptar.addEventListener("click", () => {
                            this.confirmarEliminacion()
                        })
                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                        botonCancelar.innerText = "Cancelar la eliminaciÃ³n"
                        document.querySelector("main").appendChild(pantallaInmersiva)
                    },
                    confirmarEliminacion: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Eliminado simulaciuon..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const simulacionUID = document.querySelector("[simulacionUID]").getAttribute("simulacionUID")
                        const transaccion = {
                            zona: "administracion/simuladorDePrecios/eliminarSimulacion",
                            simulacionUID: String(simulacionUID)
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            const entrada = {
                                vista: "/administracion/simulador_de_precios",
                                //tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(entrada)
                        }
                    }
                },
                actualizarNombreSimulacion: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Actualizando el nombre de la simulaciÃ³n..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje,
                        identificadorVisual: "pantallaDeCarga"
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)

                    const nombre = document.querySelector("[campo=nombre]").value
                    const simulacionUID = document.querySelector("[simulacionUID]").getAttribute("simulacionUID")

                    const transaccion = {
                        zona: "administracion/simuladorDePrecios/actualizarNombreSimulacion",
                        simulacionUID,
                        nombre

                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()

                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                    }
                },
            },
            componentes: {
                simulacionUI: function () {
                    const contenedor = document.createElement("div")
                    contenedor.classList.add(
                        "flexVertical",
                        "gap6"
                    )
                    //Fecha de creacion simulada
                    const instanciaUID_contenedorFechas = casaVitini.utilidades.codigoFechaInstancia()
                    //Boton resetear fechas
                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.setAttribute("contenedor", "botones")
                    contenedorBotones.classList.add(
                        "flexVertical",
                        "gap6"
                    )
                    contenedor.appendChild(contenedorBotones)

                    const contenedorFechaCreacion = document.createElement("div");
                    contenedorFechaCreacion.setAttribute("calendario", "fechaCreacion");
                    contenedorFechaCreacion.setAttribute("CSS", "selectorFechas")
                    contenedorFechaCreacion.classList.add(
                        "flexVertical",
                        "gap6"
                    )
                    contenedorFechaCreacion.setAttribute("paralizadorEvento", "ocultadorCalendarios");
                    contenedorFechaCreacion.setAttribute("instanciaUID_contenedorFechas", instanciaUID_contenedorFechas)
                    contenedor.appendChild(contenedorFechaCreacion);



                    const contenedorZonaIDV = document.createElement("div")
                    contenedorZonaIDV.classList.add(
                        "flexVertical"
                    )
                    contenedorFechaCreacion.appendChild(contenedorZonaIDV)
                    const opcionesEntidad = [
                        {
                            zonaIDV: "",
                            zonaUI: "Zona simulada"
                        },
                        {
                            zonaIDV: "global",
                            zonaUI: "Global"
                        },
                        {
                            zonaIDV: "privada",
                            zonaUI: "Privada"
                        },
                        {
                            zonaIDV: "publica",
                            zonaUI: "PÃºblica"
                        },

                    ]
                    const selectorZonaIDV = document.createElement("select")
                    selectorZonaIDV.addEventListener("change", casaVitini.administracion.simuladorDePrecios.componentes.actualizaSimulacion)

                    selectorZonaIDV.classList.add(
                        "selectorZonas",
                        "padding10",
                        "borderRadius6",
                        "selectorLista"
                    )
                    selectorZonaIDV.setAttribute("selector", "zonaIDV")
                    opcionesEntidad.forEach((e) => {
                        const zonaIDV = e.zonaIDV
                        const zonaUI = e.zonaUI
                        const opcion = document.createElement("option");

                        if (zonaIDV === "") {
                            opcion.disabled = true;
                            opcion.selected = true;

                        }

                        opcion.value = zonaIDV;
                        opcion.text = zonaUI;
                        selectorZonaIDV.add(opcion);
                    })
                    contenedorZonaIDV.appendChild(selectorZonaIDV)




                    const selectorFechaCreacion = document.createElement("div")
                    selectorFechaCreacion.classList.add("contenedorFecha");
                    selectorFechaCreacion.setAttribute("calendario", "unico");

                    selectorFechaCreacion.addEventListener("click", async () => {
                        await casaVitini.ui.componentes.calendario.configurarCalendario({
                            perfilMes: "calendario_unico_perfilSimple",
                            contenedorOrigenIDV: "[calendario=unico]",
                            instanciaUID_contenedorFechas,
                            rangoIDV: "unico",
                            metodoSelectorDia: "casaVitini.administracion.simuladorDePrecios.componentes.metodoSelectorDias",
                        })
                    })

                    const tituloFechaCreacion = document.createElement("p");
                    tituloFechaCreacion.classList.add("negrita");
                    tituloFechaCreacion.textContent = "Fecha de creaciÃ³n simulada"
                    selectorFechaCreacion.appendChild(tituloFechaCreacion)

                    const fechaCreacionUI = document.createElement("p");
                    fechaCreacionUI.classList.add("fechaInicio");
                    fechaCreacionUI.setAttribute("fechaUI", "unico");
                    fechaCreacionUI.textContent = "(Seleccionar)";
                    selectorFechaCreacion.appendChild(fechaCreacionUI)

                    contenedorFechaCreacion.appendChild(selectorFechaCreacion);


                    const botonResetearFechas = document.createElement("div")
                    botonResetearFechas.classList.add(
                        "botonV1",
                        "comportamientoBoton",
                        "padding6",
                        "textoCentrado",
                        "backgroundGrey1",
                        "borderRadius8",
                        "noSelecionable"
                    )
                    botonResetearFechas.innerText = "Borrar el rango de fechas"
                    botonResetearFechas.addEventListener("click", () => {
                        const selectorFechaEntrada = document.querySelector("[calendario=entrada]")
                        const selectorFechaSalida = document.querySelector("[calendario=salida]")

                        selectorFechaEntrada.removeAttribute("memoriaVolatil")
                        selectorFechaSalida.removeAttribute("memoriaVolatil")

                        selectorFechaEntrada.querySelector("[fechaUI=fechaInicio]").innerText = "(Seleccionar)"
                        selectorFechaSalida.querySelector("[fechaUI=fechaFin]").innerText = "(Seleccionar)"


                    })
                    contenedor.appendChild(botonResetearFechas)

                    const selectorRangoSimulado = casaVitini.ui.componentes.componentesComplejos.contenedorFechasUI({
                        metodoSelectorDia: "casaVitini.administracion.simuladorDePrecios.componentes.metodoSelectorDias",
                        nombreContenedor: "rangoDeSimulacion",
                        modo: "administracion",
                    })
                    contenedor.appendChild(selectorRangoSimulado)

                    const porApartamentoDedicado = document.createElement("div");
                    porApartamentoDedicado.classList.add(
                        "flexVertical",
                        "gap6",
                        "backgroundGrey1",
                        "padding6",
                        "borderRadius12"
                    );
                    porApartamentoDedicado.setAttribute("zonaOferta", "porApartamentosEspecificos");
                    porApartamentoDedicado.setAttribute("contenedor", "apartamentosSeleccianados")
                    contenedor.appendChild(porApartamentoDedicado)

                    const tituloApartamentos = document.createElement("p")
                    tituloApartamentos.classList.add(
                        "negrita",
                        "padding10"
                    )
                    tituloApartamentos.innerText = "Apartamentos de la simulaciÃ³n"
                    porApartamentoDedicado.appendChild(tituloApartamentos)

                    const selectorApartamentosEspecificosUI = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.despliegue({
                        textoContenedorVacio: "AÃ±ade apartamentos a la simulaciÃ³n",
                        tipoDespliegue: "parcial",
                        metodoPersonalizado: "simulador"
                    })
                    porApartamentoDedicado.appendChild(selectorApartamentosEspecificosUI)


                    const contenedorZonaCodigo = document.createElement("div")
                    contenedorZonaCodigo.setAttribute("contenedor", "codigosDescuento")
                    contenedorZonaCodigo.classList.add(
                        "flexVertical",
                        "gap6",
                        "backgroundGrey1",
                        "padding6",
                        "borderRadius12"
                    )

                    contenedor.appendChild(contenedorZonaCodigo)

                    const contendorBotonesCampoCodigoDescuento = document.createElement("div")
                    contendorBotonesCampoCodigoDescuento.classList.add(
                        "flexHorizontal",
                        "flexApiladoI"
                    )
                    contenedorZonaCodigo.appendChild(contendorBotonesCampoCodigoDescuento)


                    const botonAgregarCampoCodigoDescuento = document.createElement("div")
                    botonAgregarCampoCodigoDescuento.classList.add(
                        "botonV1"
                    )
                    botonAgregarCampoCodigoDescuento.innerText = "Agregar campo de descuento"
                    botonAgregarCampoCodigoDescuento.addEventListener("click", () => {

                        const contenedorCodigosDecuentos = document.querySelector("[contenedor=codigosDescuento]")
                        const lista = contenedorCodigosDecuentos.querySelector("[contenedor=listaDescuentos]")
                        lista.removeAttribute("style")
                        const contenedorCampoUI = casaVitini.administracion.simuladorDePrecios.componentes.contenedorCodigosDescuento.contenedorCampo()
                        lista.appendChild(contenedorCampoUI)

                        const botonComprobar = casaVitini.administracion.simuladorDePrecios.componentes.contenedorCodigosDescuento.botonComprobar()
                        const selectorBotonComprobar_renderizado = contenedorCodigosDecuentos.querySelector("[boton=comprobar]")
                        if (!selectorBotonComprobar_renderizado) {
                            contenedorCodigosDecuentos.appendChild(botonComprobar)
                        }
                    })
                    contendorBotonesCampoCodigoDescuento.appendChild(botonAgregarCampoCodigoDescuento)



                    const contenedorCodigosDescuentosPorVerificar = document.createElement("div")
                    contenedorCodigosDescuentosPorVerificar.setAttribute("contenedor", "listaDescuentos")
                    contenedorCodigosDescuentosPorVerificar.style.display = "none"
                    contenedorCodigosDescuentosPorVerificar
                    contenedorCodigosDescuentosPorVerificar.classList.add(
                        "flexVertical",
                        "gap6",
                        "padding6"
                    )
                    contenedorZonaCodigo.appendChild(contenedorCodigosDescuentosPorVerificar)


                    const contenedorServicios = document.createElement("div");
                    contenedorServicios.classList.add(
                        "flexVertical",
                        "gap6",
                        "backgroundGrey1",
                        "padding6",
                        "borderRadius12"
                    );
                    contenedorServicios.setAttribute("contenedor", "servicios")
                    contenedor.appendChild(contenedorServicios)

                    const tituloServicios = document.createElement("p")
                    tituloServicios.classList.add(
                        "negrita",
                        "padding10"
                    )
                    tituloServicios.innerText = "Servicios de la simulaciÃ³n"
                    contenedorServicios.appendChild(tituloServicios)


                    const serviciosUI = casaVitini.administracion.simuladorDePrecios.componentes.servicios.arranque()
                    contenedorServicios.appendChild(serviciosUI)




                    const contenedorSimulacion = document.createElement("div")
                    contenedorSimulacion.setAttribute("contenedor", "simulacion")
                    contenedor.appendChild(contenedorSimulacion)

                    return contenedor

                },
                metodoSelectorDias: async function (e) {
                    const fechaCreacion = document.querySelector("[calendario=unico]").getAttribute("memoriaVolatil")
                    const fechaCreacion_humana = document.querySelector("[calendario=unico]").querySelector("[fechaUI=unico]").innerText
                    casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia(e)
                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                    casaVitini.administracion.simuladorDePrecios.componentes.actualizaSimulacion({
                        fechaCreacion,
                        fechaCreacion_humana
                    })

                },
                actualizaSimulacion: async (data) => {

                    const fechaCreacionUI = document.querySelector("[calendario=unico]")
                    const fechaCreacion = fechaCreacionUI?.getAttribute("memoriaVolatil") || null

                    const fechaEntradaUI = document.querySelector("[calendario=entrada]")
                    const fechaEntrada = fechaEntradaUI?.getAttribute("memoriaVolatil") || null

                    const fechaSalidaUI = document.querySelector("[calendario=salida]")
                    const fechaSalida = fechaSalidaUI?.getAttribute("memoriaVolatil") || null

                    const apartamentosIDVARRAYUI = document.querySelectorAll("[apartamentoSeleccionado]")

                    const zonaIDVUI = document.querySelector("[selector=zonaIDV]")
                    const zonaIDV = zonaIDVUI.value

                    const simulacionUID = document.querySelector("[simulacionUID]")?.getAttribute("simulacionUID")
                    if (!simulacionUID) {
                        return
                    }
                    const selectorContendorSimulacion = document.querySelector("[contenedor=simulacion]")
                    selectorContendorSimulacion.removeAttribute("style")
                    selectorContendorSimulacion.innerHTML = null
                    const spinnerSimple = casaVitini.ui.componentes.spinnerSimple()
                    selectorContendorSimulacion.appendChild(spinnerSimple)

                    const fechaCreacion_recovery = data?.fechaCreacion
                    const fechaCreacion_recovery_huaman = data?.fechaCreacion_humana
                    const apartamentosIDVARRAY = []
                    apartamentosIDVARRAYUI.forEach((apartamento) => {
                        const apartamentoIDV = apartamento.getAttribute("apartamentoSeleccionado")
                        apartamentosIDVARRAY.push(apartamentoIDV)
                    })

                    const transaccion = {
                        zona: "administracion/simuladorDePrecios/actualizarSimulacionPorDataGlobal",
                        fechaCreacion,
                        fechaEntrada,
                        fechaSalida,
                        apartamentosIDVARRAY,
                        simulacionUID,
                        zonaIDV
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    selectorContendorSimulacion.innerHTML = null

                    if (respuestaServidor.llavesFaltantes) {
                        const llavesFaltantes = respuestaServidor.llavesFaltantes
                        const llaves = [
                            "fechaEntrada",
                            "fechaSalida",
                            "fechaCreacion",
                            "apartamentosIDVARRAY",
                            "zonaIDV"
                        ]
                        const dic = {
                            fechaCreacion: "[calendario=unico]",
                            fechaEntrada: "[calendario=entrada]",
                            fechaSalida: "[calendario=salida]",
                            apartamentosIDVARRAY: "[contenedor=apartamentosSeleccianados]",
                            zonaIDV: "[selector=zonaIDV]"
                        }
                        llaves.forEach((llave) => {
                            if (llavesFaltantes.includes(llave)) {
                                const selector = dic[llave];
                                const elemento = document.querySelector(selector);
                                if (elemento) {
                                    elemento.classList.add("parpadeoFondoAzul");
                                }
                            } else {
                                const selector = dic[llave];
                                const elemento = document.querySelector(selector);
                                if (elemento) {
                                    elemento.classList.remove("parpadeoFondoAzul");
                                }
                            }
                        })
                    } else if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        if (fechaCreacion_recovery) {
                            document.querySelector("[calendario=unico]").setAttribute("memoriaVolatil", fechaCreacion_recovery)
                            document.querySelector("[calendario=unico]").querySelector("[fechaUI=unico]").innerText = fechaCreacion_recovery_huaman
                        }
                    }
                    if (respuestaServidor?.ok) {
                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                        return casaVitini.administracion.simuladorDePrecios.detallesSimulacion.componentesUI.desplegarContenedorFinanciero({
                            simulacionUID
                        })
                    }

                },
                apartamentoUI: function (data) {

                    const apartamentoIDV = data.apartamentoIDV
                    const apartamentoUI = data.apartamentoUI
                    const tipoDespliegue = data.tipoDespliegue
                    const seleccionadoInicial = data.seleccionadoInicial
                    const descuentoTotal = data.descuentoTotal || "0.00"


                    const apartamentoSeleccionadoUI = document.createElement("div")
                    apartamentoSeleccionadoUI.classList.add("crearOfertaApartamentoSeleccionadoUI")
                    apartamentoSeleccionadoUI.setAttribute("apartamentoSeleccionado", apartamentoIDV)
                    const tituloApartamento = document.createElement("div")
                    tituloApartamento.classList.add("crearOfertaApartamentoSeleccionadoUITitulo")
                    tituloApartamento.innerText = apartamentoUI
                    apartamentoSeleccionadoUI.appendChild(tituloApartamento)
                    const botonEliminarApartamento = document.createElement("div")
                    botonEliminarApartamento.classList.add("crearOfertaBoton")
                    botonEliminarApartamento.innerText = "Eliminar apartamento 11"
                    botonEliminarApartamento.addEventListener("click", (e) => {
                        const apartamentoRenderizado = e.target.closest("[apartamentoSeleccionado]")
                        apartamentoRenderizado.remove()
                        const instanciaUID = data.instanciaUID
                        const area = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        const conteoApartamentos = area.querySelectorAll(`[apartamentoSeleccionado]`)
                        if (conteoApartamentos.length === 0) {
                            area.querySelector("[componente=infoSinApartamento]").removeAttribute("style")
                        }
                        casaVitini.administracion.simuladorDePrecios.componentes.actualizaSimulacion()
                    })
                    apartamentoSeleccionadoUI.appendChild(botonEliminarApartamento)
                    return apartamentoSeleccionadoUI
                },
                servicios: {
                    arranque: () => {

                        const contenedor = document.createElement("div")
                        contenedor.setAttribute("class", "contenedorServicios")
                        contenedor.setAttribute("componente", "categoriaServicios")

                        const contenedorInformacionGlobal = document.createElement("div")
                        contenedorInformacionGlobal.classList.add("administracion_reservas_detallesReserva_contenedorEnlacesDePago")

                        contenedor.appendChild(contenedorInformacionGlobal)
                        const bloqueBotones = document.createElement("div")
                        bloqueBotones.classList.add("detallesReserva_enlacesDePago_bloqueBotones")

                        const botonCrearPagoManual = document.createElement("div")
                        botonCrearPagoManual.classList.add("detallesReserva_transacciones_botonV1")
                        botonCrearPagoManual.innerText = "Insertar un servicio"
                        botonCrearPagoManual.addEventListener("click", () => {
                            casaVitini.administracion.simuladorDePrecios.componentes.servicios.componentesUI.insertarServicio.ui({
                            })
                        })
                        bloqueBotones.appendChild(botonCrearPagoManual)
                        contenedorInformacionGlobal.appendChild(bloqueBotones)

                        const contenedorListaServicios = document.createElement("div")
                        contenedorListaServicios.classList.add("listaServicios")
                        contenedorListaServicios.setAttribute("componente", "contenedorListaServiciosEnReserva")
                        contenedor.appendChild(contenedorListaServicios)

                        return contenedor

                    },
                    componentesUI: {
                        insertarServicio: {
                            ui: async function () {
                                const main = document.querySelector("main")
                                const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                const instanciaUID_insertarServiciosUI = ui.getAttribute("instanciaUID")
                                main.appendChild(ui)
                                const constructor = ui.querySelector("[componente=contenedor]")
                                const spinner = casaVitini.ui.componentes.spinner({
                                    mensaje: "Obteniendo servicios...",
                                    textoBoton: "Cancelar"
                                })
                                constructor.appendChild(spinner)

                                const transaccion = {
                                    zona: "administracion/servicios/obtenerServicios"
                                }

                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const uiRenderizada = document.querySelectorAll(`[instanciaUID="${instanciaUID_insertarServiciosUI}"]`)
                                if (!uiRenderizada) { return }
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    spinner.remove()
                                    constructor.appendChild(this.botonCancelar())

                                    const servicios = respuestaServidor.servicios

                                    const contenedor = document.createElement("div")
                                    contenedor.classList.add(
                                        "maxWidth1280px",
                                        "width100",
                                        "flexVertical",
                                        "gap10",
                                    )
                                    constructor.appendChild(contenedor)
                                    const estadoUI_ = (estadoIDV) => {

                                        if (estadoIDV === "activado") {
                                            return "Activada"
                                        } else if (estadoIDV === "desactivado") {
                                            return "Desactivada"
                                        }

                                    }

                                    servicios.forEach((detalles) => {
                                        const nombre = detalles.nombre
                                        const servicioUID = detalles.servicioUID
                                        const estadoIDV = detalles.estadoIDV
                                        const zonaIDV = detalles.zonaIDV
                                        const contenedorData = detalles.contenedor


                                        const contenedorServicio = document.createElement("div")
                                        contenedorServicio.setAttribute("servicioUID", servicioUID)
                                        contenedorServicio.classList.add(
                                            "borderRadius12",
                                            "width100",
                                            "flexVertical",
                                            "backgroundGrey1",
                                            "padding6",
                                            "gap6"
                                        )

                                        const contenedorGlobal = document.createElement("div")
                                        contenedorGlobal.classList.add(
                                            "flexVertical",
                                            "padding6",
                                            "gap6"
                                        )

                                        const nombreOfertaUI = document.createElement("div")
                                        nombreOfertaUI.classList.add("negrita")
                                        nombreOfertaUI.innerText = nombre
                                        contenedorGlobal.appendChild(nombreOfertaUI)

                                        const estadoTitulo = document.createElement("div")
                                        estadoTitulo.innerText = "Estado del servicio"
                                        contenedorGlobal.appendChild(estadoTitulo)


                                        const estadoUI = document.createElement("div")
                                        estadoUI.classList.add("negrita")
                                        estadoUI.innerText = estadoUI_(estadoIDV)
                                        contenedorGlobal.appendChild(estadoUI)
                                        contenedorServicio.appendChild(contenedorGlobal)

                                        const contendorBotones = document.createElement("div")
                                        contendorBotones.classList.add(
                                            "flexHorizontal",
                                            "gap6",
                                        )

                                        const botonInsertar = document.createElement("div")
                                        botonInsertar.classList.add(
                                            "borderRadius8",
                                            "backgroundGrey1",
                                            "comportamientoBoton",
                                            "padding8"
                                        )
                                        botonInsertar.innerText = "Insertar servicios en la simulaciÃ³n"
                                        botonInsertar.addEventListener("click", () => {
                                            this.confirmarInsertar({
                                                servicioUID
                                            })

                                        })
                                        contendorBotones.appendChild(botonInsertar)

                                        const botonVerOferta = document.createElement("a")
                                        botonVerOferta.classList.add(
                                            "borderRadius8",
                                            "backgroundGrey1",
                                            "comportamientoBoton",
                                            "padding8",
                                            "limpiezaBotonA"
                                        )
                                        botonVerOferta.innerText = "Ir al servicio"
                                        botonVerOferta.setAttribute("href", "/administracion/servicios/servicio:" + servicioUID)
                                        botonVerOferta.setAttribute("vista", "/administracion/servicios/servicio:" + servicioUID)
                                        botonVerOferta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                        contendorBotones.appendChild(botonVerOferta)

                                        contenedorServicio.appendChild(contendorBotones)
                                        contenedor.appendChild(contenedorServicio)
                                    })
                                    constructor.appendChild(this.botonCancelar())

                                }

                            },
                            botonCancelar: () => {
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("boton")
                                botonCancelar.setAttribute("boton", "cancelar")
                                botonCancelar.innerText = "Cerrar y volver a la reserva"
                                botonCancelar.addEventListener("click", () => {
                                    return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                })
                                return botonCancelar
                            },
                            confirmarInsertar: async function (data) {
                                const simulacionUID = document.querySelector("[simulacionUID]").getAttribute("simulacionUID")
                                const servicioUID = String(data.servicioUID)
                                const ui = document.querySelector(`[contenedor=servicios]`)
                                // const contenedor = ui.querySelector("[componente=contenedorInfoSinServicios]")


                                // const spinner = casaVitini.ui.componentes.spinner({
                                //     mensaje: "Insertando servicio en la reserva..."
                                // })
                                // contenedor.appendChild(spinner)

                                const transaccion = {
                                    zona: "administracion/simuladorDePrecios/servicios/insertarServicioEnSimulacion",
                                    simulacionUID,
                                    servicioUID
                                }

                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const uiRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"] [contenedor=servicios]`)
                                if (!uiRenderizada) { return }
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {

                                    const servicioData = respuestaServidor.servicio
                                    const nombreInterno = servicioData.nombre
                                    const contenedor = servicioData.contenedor
                                    const servicioUID_enSimulacion = servicioData.servicioUID


                                    const servicioUI = casaVitini.administracion.simuladorDePrecios.componentes.servicios.componentesUI.servicioUI({
                                        servicioUID_enSimulacion: servicioUID_enSimulacion,
                                        instanciaUID_contenedorServicios: "contenedorServicios",
                                        nombreInterno: nombreInterno,
                                        contenedor: contenedor
                                    })
                                    const selectorInfo = uiRenderizada.querySelector("[componente=contenedorInfoSinServicios]")
                                    selectorInfo?.remove()

                                    const selectorListaServicios = uiRenderizada.querySelector("[componente=contenedorListaServiciosEnReserva]")
                                    selectorListaServicios.appendChild(servicioUI)

                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    // casaVitini.administracion.simuladorDePrecios.componentes.actualizaSimulacion()

                                    const desgloseFinanciero = respuestaServidor?.desgloseFinanciero
                                    if (desgloseFinanciero) {
                                        casaVitini.ui.componentes.contenedorFinanciero.constructor({
                                            destino: `[simulacionUID="${simulacionUID}"] [contenedor=simulacion]`,
                                            contenedorFinanciero: { desgloseFinanciero },
                                            modoUI: "simulador"
                                        })
                                    }
                                }

                            },
                        },
                        servicioUI: (data) => {
                            const servicioUID_enSimulacion = data.servicioUID_enSimulacion
                            const instanciaUID_contenedorServicios = data.instanciaUID_contenedorServicios
                            const nombreInterno = data.nombreInterno
                            const contenedor = data.contenedor

                            const precio = contenedor.precio
                            const definicion = contenedor.definicion
                            const fechaFinal = contenedor.fechaFinal
                            const duracionIDV = contenedor.duracionIDV
                            const fechaInicio = contenedor.fechaInicio
                            const tituloPublico = contenedor.tituloPublico
                            const disponibilidadIDV = contenedor.disponibilidadIDV

                            const diccionario = {
                                disponibilidad: {
                                    constante: "Disponible",
                                    variable: "Disponibilidad variable"
                                }
                            }

                            const servicioUI = document.createElement("div")
                            servicioUI.setAttribute("servicioUID_enSimulacion", servicioUID_enSimulacion)
                            servicioUI.classList.add(
                                "flexVertical",
                                "padding14",
                                "backgroundGrey1",
                                "borderRadius14"
                            )
                            const contenedorInterno = document.createElement("div")
                            contenedorInterno.classList.add(
                                "flexVertical",
                                "gap6"
                            )
                            servicioUI.appendChild(contenedorInterno)

                            const nombreInternoUI = document.createElement("p")
                            nombreInternoUI.innerText = `${nombreInterno}`
                            contenedorInterno.appendChild(nombreInternoUI)

                            const contenedorGlobal = document.createElement("div")
                            contenedorGlobal.classList.add(
                                "contenedorGlobal"
                            )
                            servicioUI.appendChild(contenedorGlobal)

                            const esferaSeleccionable = document.createElement("div")
                            esferaSeleccionable.classList.add(
                                "esferaSeleccionable"
                            )
                            contenedorGlobal.appendChild(esferaSeleccionable)

                            const indicadorDeSeleccion = document.createElement("div")
                            indicadorDeSeleccion.setAttribute("componente", "indicadorSelecion")
                            indicadorDeSeleccion.classList.add(
                                "indicadorDeSeleccion"
                            )
                            esferaSeleccionable.appendChild(indicadorDeSeleccion)

                            const titulo = document.createElement("p")
                            titulo.classList.add(
                                "padding6",
                                "negrita"
                            )
                            titulo.innerText = tituloPublico
                            contenedorGlobal.appendChild(titulo)


                            const disponibilidadUI = document.createElement("p")
                            disponibilidadUI.classList.add(
                                "padding6"
                            )
                            disponibilidadUI.innerText = diccionario.disponibilidad[disponibilidadIDV]
                            servicioUI.appendChild(disponibilidadUI)


                            if (disponibilidadIDV === "variable") {

                                const info = document.createElement("p")
                                info.classList.add(
                                    "padding6"
                                )
                                info.innerText = `Este servicio tiene una disponibilidad limitada. Es por eso que si selecciona este servicio, nos pondremos en contacto con el titular de la reserva en las prÃ³ximas horas para confirmarle la disponibilidad del servicio para su reserva.`
                                servicioUI.appendChild(info)
                            }

                            const precioUI = document.createElement("p")
                            precioUI.classList.add(
                                "padding6",
                                "negrita"
                            )
                            precioUI.innerText = precio + "$"
                            servicioUI.appendChild(precioUI)

                            if (duracionIDV === "rango") {
                                const contenedorDuracion = document.createElement("div")
                                contenedorDuracion.classList.add(
                                    "flexVertical",
                                    "padding6"

                                )
                                servicioUI.appendChild(contenedorDuracion)

                                const info = document.createElement("p")
                                info.classList.add("negrita")
                                info.innerText = `Servicio disponible solo desde ${fechaInicio} hata ${fechaFinal}. Ambas fechas incluidas.`
                                contenedorDuracion.appendChild(info)

                            }
                            const definicionUI = document.createElement("p")
                            definicionUI.classList.add(
                                "padding6"
                            )
                            definicionUI.innerText = definicion
                            servicioUI.appendChild(definicionUI)

                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add("administracion_reservas_detallesReservas_enlacesDePago_contenedorBotones")
                            const botonIr = document.createElement("a")
                            botonIr.classList.add("administracion_reservas_detallesReservas_enlacesDePago_botonV1")
                            botonIr.innerText = "Ir al servicio"
                            // botonIr.setAttribute("href", "/servicios/servicio:" + servicioUID)
                            botonIr.setAttribute("target", "_blank")
                            //contenedorBotones.appendChild(botonIr)

                            const botonEliminar = document.createElement("div")
                            botonEliminar.classList.add("administracion_reservas_detallesReservas_enlacesDePago_botonV1")
                            botonEliminar.innerText = "Eliminar servicio de la reserva"
                            botonEliminar.addEventListener("click", () => {
                                casaVitini
                                    .administracion
                                    .simuladorDePrecios
                                    .componentes
                                    .servicios
                                    .componentesUI.
                                    eliminarServicio
                                    .ui({
                                        instanciaUID_contenedorServicios,
                                        servicioUID_enSimulacion,
                                        nombreInterno
                                    })
                            })
                            contenedorBotones.appendChild(botonEliminar)
                            servicioUI.appendChild(contenedorBotones)



                            return servicioUI
                        },
                        eliminarServicio: {
                            ui: async function (data) {
                                const nombreInterno = data.nombreInterno
                                const instanciaUID_contenedorServicios = data.instanciaUID_contenedorServicios
                                const servicioUID_enSimulacion = data.servicioUID_enSimulacion

                                const simulacionUID = document.querySelector("[simulacionUID]").getAttribute("simulacionUID")


                                const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                const instanciaUID_eliminarServicio = ui.getAttribute("instanciaUID")
                                const constructor = ui.querySelector("[componente=constructor]")

                                const titulo = constructor.querySelector("[componente=titulo]")
                                titulo.innerText = `Confirmar eliminar el servicio ${nombreInterno} de la reserva`
                                const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                mensaje.innerText = "Var a eliminar el servicio de la reserva, Â¿Estas de acuerdo?"

                                const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                botonAceptar.innerText = "Comfirmar la eliminacion"
                                botonAceptar.addEventListener("click", () => {
                                    this.confirmarEliminar({
                                        servicioUID_enSimulacion,
                                        instanciaUID_eliminarServicio,
                                        instanciaUID_contenedorServicios,
                                        simulacionUID
                                    })
                                })
                                const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                botonCancelar.innerText = "Cancelar y volver"
                                document.querySelector("main").appendChild(ui)

                            },
                            confirmarEliminar: async function (data) {
                                const servicioUID_enSimulacion = String(data.servicioUID_enSimulacion)
                                // no se elimina el cartel por que no encuentra el identificador unico de la instancia.
                                const instanciaUID_eliminarServicio = data.instanciaUID_eliminarServicio
                                const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                                const simulacionUID = data.simulacionUID
                                const instanciaUID_contenedorServicios = data.instanciaUID_contenedorServicios
                                const ui = document.querySelector(`[instanciaUID="${instanciaUID_eliminarServicio}"]`)
                                const contenedor = ui.querySelector("[componente=constructor]")
                                contenedor.innerHTML = null

                                const spinner = casaVitini.ui.componentes.spinner({
                                    mensaje: "Eliminado servicio en la reserva..."
                                })
                                contenedor.appendChild(spinner)

                                const transaccion = {
                                    zona: "administracion/simuladorDePrecios/servicios/eliminarServicioEnSimulacion",
                                    servicioUID_enSimulacion
                                }

                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                if (respuestaServidor?.error) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    const simulacionUIRenderizada = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                                    if (!simulacionUIRenderizada) {
                                        return
                                    }
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    simulacionUIRenderizada.querySelector(`[servicioUID_enSimulacion="${servicioUID_enSimulacion}"]`)?.remove()

                                    const selectorContenedoresDeServiciosRenderizados = simulacionUIRenderizada.querySelectorAll("[servicioUID_enSimulacion]")
                                    if (selectorContenedoresDeServiciosRenderizados.length === 0) {
                                        const infoSinEnlaces = casaVitini
                                            .administracion
                                            .simuladorDePrecios
                                            .componentes
                                            .servicios
                                            .componentesUI
                                            .infoSinServiciosUI()
                                        const selectorContenedorDinamico = document.querySelector("[contenedor=servicios]")
                                        selectorContenedorDinamico.appendChild(infoSinEnlaces)
                                    }
                                    const desgloseFinanciero = respuestaServidor?.desgloseFinanciero
                                    if (desgloseFinanciero) {


                                        casaVitini.ui.componentes.contenedorFinanciero.constructor({
                                            destino: `[simulacionUID="${simulacionUID}"] [contenedor=simulacion]`,
                                            contenedorFinanciero: { desgloseFinanciero },
                                            modoUI: "simulador"
                                        })
                                    }
                                }

                            },

                        },
                        infoSinServiciosUI: () => {
                            const infoSinEnlaces = document.createElement("div")
                            infoSinEnlaces.classList.add("reservaDetalles_transacciones_enlacesDePago_infoSinEnlaces")
                            infoSinEnlaces.setAttribute("componente", "contenedorInfoSinServicios")
                            infoSinEnlaces.innerText = "No hay ningÃºn servicio en la reserva simulada."
                            return infoSinEnlaces
                        }
                    },

                },
                contenedorCodigosDescuento: {
                    infoInit: () => {
                        const info = document.createElement("div")
                        info.classList.add(
                            "flexVertical"
                        )
                        info.innerText = "AÃ±ada descuentos para verificarlos"
                        return info
                    },
                    descuentoUI: (data) => {
                        const descuentoBASE64 = data.descuentoBASE64

                        const contenedor = document.createElement("div")
                        contenedor.classList.add(
                            "flexVertical"
                        )
                        const info = document.createElement("p")
                        info.innerText = descuentoBASE64
                        contenedor.appendChild(info)

                        const botonEliminar = document.createElement("p")
                        botonEliminar.innerText = "Elimnar codigo descuento"
                        contenedor.appendChild(botonEliminar)

                        return contenedor
                    },
                    contenedorCampo: (data) => {

                        const campoData = data?.campoData || ""

                        const contenedor = document.createElement("div")
                        contenedor.style.gridTemplateColumns = "1fr auto"
                        contenedor.setAttribute("componente", "campoDescuento")
                        contenedor.classList.add(
                            "gridHorizotnal2C",
                            "gap6",
                            "padding6",
                            "borderRadius12",
                            "borderGrey1"
                        )

                        const campoCodigo = document.createElement("input")
                        campoCodigo.setAttribute("campo", "codigoDescuento")
                        campoCodigo.classList.add(
                            "padding10",
                            "borderRadius8",
                        )
                        campoCodigo.placeholder = "Inserta un codigo de descuento para comprobar"
                        campoCodigo.value = campoData
                        contenedor.appendChild(campoCodigo)

                        const botonComprobar = document.createElement("div")
                        botonComprobar.classList.add(
                            "padding10",
                            "borderRadius8",
                            "botonV1",
                        )
                        botonComprobar.innerText = "Eliminar"
                        botonComprobar.addEventListener("click", (e) => {

                            const contenedorDescuentos = e.target.closest("[contenedor=codigosDescuento]")
                            const numeroCampos = contenedorDescuentos.querySelectorAll("[componente=campoDescuento]")
                            if (numeroCampos.length === 1) {
                                contenedorDescuentos.querySelector("[boton=comprobar]")?.remove()
                                const lista = contenedorDescuentos.querySelector("[contenedor=listaDescuentos]")
                                lista.style.display = "none"
                            }
                            const contenedorCampo = e.target.closest("[componente=campoDescuento]")
                            contenedorCampo?.remove()
                        })
                        contenedor.appendChild(botonComprobar)
                        return contenedor
                    },
                    botonComprobar: function () {
                        const boton = document.createElement("div")
                        boton.setAttribute("boton", "comprobar")
                        boton.classList.add(
                            "botonV1"
                        )
                        boton.innerText = "Comprobar codigo."
                        boton.addEventListener("click", () => {
                            this.cribadoOfertas.ui()
                        })
                        return boton
                    },
                    cribadoOfertas: {
                        ui: async function () {
                            const main = document.querySelector("main")
                            const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                            main.appendChild(ui)
                            const instanciaUID_cribadoOfertas = ui.getAttribute("instanciaUID")
                            const simulacionUID = main.querySelector("[simulacionUID]").getAttribute("simulacionUID")
                            const contenedorDescuentosSimulacion = main.querySelector("[contenedor=codigosDescuento]")
                            const selectorCamposCodigos = contenedorDescuentosSimulacion.querySelector("[contenedor=listaDescuentos]").querySelectorAll("[campo=codigoDescuento]")
                            const codigosDescuentosPorVerificar = []
                            selectorCamposCodigos.forEach((contenedor) => {
                                const campo = contenedor.value
                                if (campo.length > 0) {
                                    codigosDescuentosPorVerificar.push(campo)
                                }
                            })

                            if (codigosDescuentosPorVerificar.length === 0) {
                                const m = "Escribe algÃºn cÃ³digo en el campo de cÃ³digos, estÃ¡n todos vacÃ­os."
                                return casaVitini.ui.componentes.advertenciaInmersiva(m)
                            }

                            const constructor = ui.querySelector("[componente=contenedor]")
                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Obteniendo ofertas compatibles con los codigos de descuento...",
                                textoBoton: "Cancelar"
                            })
                            constructor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/simuladorDePrecios/descuentos/comprobarCodigosEnSimulacion",
                                simulacionUID,
                                codigosDescuentos: codigosDescuentosPorVerificar
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)


                            const uiRenderizada = document.querySelectorAll(`[instanciaUID="${instanciaUID_cribadoOfertas}"]`)
                            if (!uiRenderizada) { return }
                            spinner.remove()
                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                constructor.appendChild(this.componentes.botonCancelar())
                                const ofertasCompatibles = respuestaServidor.ofertas.compatible
                                const ofertasIncompatibles = respuestaServidor.ofertas.incompatible


                                // Nombre d ela oferta 
                                // condiciones que se cumplen y no
                                // boton para ira  al oferta
                                // Si se puee insertar oferta por condicion

                                const contenedorOfertas = document.createElement("div")
                                contenedorOfertas.classList.add(
                                    "maxWidth1280px",
                                    "width100",
                                    "flexVertical",
                                    "gap6",
                                )
                                constructor.appendChild(contenedorOfertas)

                                const contenedorCompatibles = document.createElement("div")
                                contenedorCompatibles.classList.add(
                                    "flexVertical",
                                    "gap6"
                                )
                                if (ofertasCompatibles.length > 0) {
                                    contenedorOfertas.appendChild(contenedorCompatibles)
                                }
                                const tituloCompatibles = document.createElement("p")
                                tituloCompatibles.classList.add(
                                    "padding6"
                                )
                                tituloCompatibles.innerText = "Ofertas compatibles por cÃ³digo y el resto de condiciones. Estas ofertas son compatibles totalmente con la simulaciÃ³n. Puede aÃ±adirlas desde aquÃ­."
                                contenedorCompatibles.appendChild(tituloCompatibles)

                                ofertasCompatibles.forEach((oferta) => {

                                    const ofertaUI = this.componentes.ofertaUI({
                                        contenedorOferta: oferta,
                                        simulacionUID,
                                        instanciaUID_cribadoOfertas
                                    })
                                    const enSimulacion = oferta?.enSimulacion
                                    if (enSimulacion === "si") {
                                        ofertaUI.querySelector("[boton=insertarOferta]")?.remove()
                                        const info = document.createElement("p")
                                        info.classList.add(
                                            "padding6"
                                        )
                                        info.innerText = "Esta oferta compatible ya estÃ¡ aÃ±adida a la simulaciÃ³n. Las ofertas basadas en condiciones solo se pueden aÃ±adir una vez. Si necesitas aÃ±adir esta oferta, puedes hacerlo administrativamente desde el contenedor financiero."
                                        ofertaUI.appendChild(info)
                                    }


                                    contenedorCompatibles.appendChild(ofertaUI)
                                })

                                const contenedorIncompatibles = document.createElement("div")
                                contenedorIncompatibles.classList.add(
                                    "flexVertical",
                                    "gap6"
                                )
                                if (ofertasIncompatibles.length > 0) {
                                    contenedorOfertas.appendChild(contenedorIncompatibles)
                                }

                                const tituloIncompatibles = document.createElement("p")
                                tituloIncompatibles.classList.add(
                                    "padding6"
                                )
                                tituloIncompatibles.innerText = "Ofertas compatibles por cÃ³digo por no con el resto de condiciones. Las condiciones que no se cumplen estÃ¡n marcadas con un borde rojo."
                                contenedorIncompatibles.appendChild(tituloIncompatibles)


                                ofertasIncompatibles.forEach((oferta) => {
                                    const condicionesQueNoSeCumple = oferta.condicionesQueNoSeCumple
                                    const ofertaUI = this.componentes.ofertaUI({
                                        contenedorOferta: oferta,
                                        instanciaUID_cribadoOfertas
                                    })
                                    ofertaUI.querySelector("[boton=insertarOferta]")?.remove()
                                    contenedorIncompatibles.appendChild(ofertaUI)

                                    condicionesQueNoSeCumple.forEach((condicionIDV) => {

                                        const selectorContenedorCondicion = ofertaUI.querySelector(`[tipoCondicion="${condicionIDV}"]`)
                                        selectorContenedorCondicion.classList.add(
                                            "borderRadius12",
                                        )
                                        selectorContenedorCondicion.style.border = "1px solid red"
                                    })


                                })

                                constructor.appendChild(this.componentes.botonCancelar())


                            }

                        },
                        componentes: {
                            condicionesUI: (data) => {
                                const condicionesArray = data.condicionesArray
                                const contenedorCondiciones = document.createElement("div")
                                contenedorCondiciones.setAttribute("contenedor", "condiciones")
                                contenedorCondiciones.classList.add(
                                    "flexVertical",
                                    "gap6",
                                    "backgroundGrey1",
                                    "padding6",
                                    "borderRadius14"
                                )
                                const tituloContendor = document.createElement("div")
                                tituloContendor.classList.add(
                                    "negrita",
                                    "padding6",

                                )
                                tituloContendor.innerText = "Condiciones de la oferta"
                                contenedorCondiciones.appendChild(tituloContendor)

                                condicionesArray.forEach((condicion) => {
                                    const tipoCondicion = condicion.tipoCondicion

                                    const contenedorCondicion = document.createElement("div")
                                    contenedorCondicion.classList.add("contenedorCondicion")
                                    contenedorCondicion.setAttribute("tipoCondicion", tipoCondicion)
                                    contenedorCondicion.classList.add(
                                        "flexVertical",
                                        "padding6",
                                    )
                                    const definicionCondicion = casaVitini
                                        .ui
                                        .componentes
                                        .contenedorFinanciero
                                        .componentesUI
                                        .ofertas
                                        .componentesUI
                                        .definicionCondiciones({
                                            tipoCondicion,
                                            condicion
                                        })
                                    contenedorCondicion.appendChild(definicionCondicion)
                                    contenedorCondiciones.appendChild(contenedorCondicion)
                                })
                                return contenedorCondiciones

                            },
                            ofertaUI: function (data) {

                                const contenedorOferta = data.contenedorOferta
                                const simulacionUID = data.simulacionUID
                                const instanciaUID_cribadoOfertas = data.instanciaUID_cribadoOfertas

                                const ofertaData = contenedorOferta.oferta
                                const nombreOferta = ofertaData.nombreOferta
                                const ofertaUID = ofertaData.ofertaUID
                                const fechaInicio = ofertaData.fechaInicio
                                const fechaFinal = ofertaData.fechaFinal
                                const estadoIDV = ofertaData.estadoIDV
                                const zonaIDV = ofertaData.zonaIDV
                                const condicionesArray = ofertaData.condicionesArray


                                const estadoUI_ = (estadoIDV) => {

                                    if (estadoIDV === "activado") {
                                        return "Activada"
                                    } else if (estadoIDV === "desactivado") {
                                        return "Desactivada"
                                    }

                                }

                                const contenedorOfertaUI = document.createElement("div")
                                contenedorOfertaUI.setAttribute("ofertaUID", ofertaUID)
                                contenedorOfertaUI.classList.add(
                                    "borderRadius12",
                                    "width100",
                                    "flexVertical",
                                    "backgroundGrey1",
                                    "padding6",
                                    "gap6"
                                )

                                const contenedorGlobal = document.createElement("div")
                                contenedorGlobal.classList.add(
                                    "flexVertical",
                                    "padding12",
                                    "gap6"
                                )

                                const nombreOfertaUI = document.createElement("div")
                                nombreOfertaUI.classList.add("negrita")
                                nombreOfertaUI.innerText = nombreOferta
                                contenedorGlobal.appendChild(nombreOfertaUI)

                                const estadoTitulo = document.createElement("div")
                                estadoTitulo.innerText = "Estado de la oferta"
                                contenedorGlobal.appendChild(estadoTitulo)


                                const estadoUI = document.createElement("div")
                                estadoUI.classList.add("negrita")
                                estadoUI.innerText = estadoUI_(estadoIDV)
                                contenedorGlobal.appendChild(estadoUI)
                                contenedorOfertaUI.appendChild(contenedorGlobal)

                                const descuentosUI = this.condicionesUI({ condicionesArray })
                                contenedorOfertaUI.appendChild(descuentosUI)

                                const contendorBotones = document.createElement("div")
                                contendorBotones.classList.add(
                                    "flexHorizontal",
                                    "gap6",
                                )

                                const botonInsertar = document.createElement("div")
                                botonInsertar.setAttribute("boton", "insertarOferta")
                                botonInsertar.classList.add(
                                    "borderRadius8",
                                    "backgroundGrey1",
                                    "comportamientoBoton",
                                    "padding8"
                                )
                                botonInsertar.innerText = "Insertar descuento en la reserva"
                                botonInsertar.addEventListener("click", () => {
                                    this.confirmarInsertar({
                                        simulacionUID,
                                        ofertaUID,
                                        instanciaUID_cribadoOfertas,
                                    })

                                })
                                contendorBotones.appendChild(botonInsertar)

                                const botonVerOferta = document.createElement("a")
                                botonVerOferta.classList.add(
                                    "borderRadius8",
                                    "backgroundGrey1",
                                    "comportamientoBoton",
                                    "padding8",
                                    "limpiezaBotonA"
                                )
                                botonVerOferta.innerText = "Ir a la oferta"
                                botonVerOferta.setAttribute("href", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                botonVerOferta.setAttribute("vista", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                botonVerOferta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                contendorBotones.appendChild(botonVerOferta)

                                contenedorOfertaUI.appendChild(contendorBotones)

                                return contenedorOfertaUI
                            },
                            botonCancelar: () => {
                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("boton")
                                botonCancelar.setAttribute("boton", "cancelar")
                                botonCancelar.innerText = "Cerrar y volver a la simulaciÃ³n"
                                botonCancelar.addEventListener("click", () => {
                                    return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                })
                                return botonCancelar
                            },
                            confirmarInsertar: async function (data) {
                                const simulacionUID = data.simulacionUID
                                const ofertaUID = String(data.ofertaUID)
                                const instanciaUID_cribadoOfertas = data.instanciaUID_cribadoOfertas
                                const main = document.querySelector("main")
                                const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                                const instanciaUID = ui.getAttribute("instanciaUID")
                                main.appendChild(ui)
                                const contenedor = ui.querySelector("[componente=contenedor]")
                                contenedor.innerHTML = null

                                const spinner = casaVitini.ui.componentes.spinner({
                                    mensaje: "Insertando oferta en la simulaciÃ³n..."
                                })
                                contenedor.appendChild(spinner)

                                const transaccion = {
                                    zona: "administracion/simuladorDePrecios/descuentos/insertarDescuentoPorCompatiblePorCodigo",
                                    simulacionUID: String(simulacionUID),
                                    ofertaUID,
                                    codigosDescuentos: [
                                        "ey"
                                    ]
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                const uiRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                                uiRenderizada?.remove()


                                if (respuestaServidor?.error) {
                                    return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                                }

                                if (respuestaServidor?.ok) {
                                    const uiOfertaEnInstancia = document.querySelector(`[instanciaUID="${instanciaUID_cribadoOfertas}"] [ofertaUID="${ofertaUID}"]`)
                                    if (uiOfertaEnInstancia) {
                                        uiOfertaEnInstancia.querySelector("[boton=insertarOferta]")?.remove()
                                        const info = document.createElement("p")
                                        info.classList.add(
                                            "padding6"
                                        )
                                        info.innerText = "Oferta reciÃ©n aÃ±adida correctamente a la simulaciÃ³n. No se puede volver a aÃ±adir una oferta basada en condiciones. Para aÃ±adir una oferta arbitrariamente, hazlo mediante el botÃ³n de aÃ±adir ofertas administrativamente en la secciÃ³n ofertas del contenedor financiero de la simulaciÃ³n."
                                        uiOfertaEnInstancia.appendChild(info)


                                    }
                                    const uiSimulacion = document.querySelector(`[simulacionUID="${simulacionUID}"]`)
                                    if (uiSimulacion) {
                                        const desgloseFinanciero = respuestaServidor?.desgloseFinanciero
                                        if (desgloseFinanciero) {
                                            casaVitini.ui.componentes.contenedorFinanciero.constructor({
                                                destino: `[simulacionUID="${simulacionUID}"] [contenedor=simulacion]`,
                                                contenedorFinanciero: { desgloseFinanciero },
                                                modoUI: "simulador"
                                            })
                                        }
                                    }

                                }

                            },
                        }
                    }
                }
            }
        },
        impuestos: {
            arranque: async () => {
                const main = document.querySelector("main")
                const instanciaUID = main.getAttribute("instanciaUID")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                const soloDigitos = /^\d+$/;

                if (comandoInicial === "impuestos") {
                    casaVitini.administracion.impuestos.contenedorBotones()
                    casaVitini.administracion.impuestos.mostrarImpuestosResueltos(granuladoURL.parametros)
                } else if (soloDigitos.test(comandoInicial)) {
                    main.setAttribute("zonaCSS", "administracion/impuestos/detalles")
                    const transaccion = {
                        zona: "administracion/impuestos/detalleImpuesto",
                        impuestoUID: String(comandoInicial)
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada) { return }
                    if (respuestaServidor.error) {
                        const titulo = document.querySelector(".titulo")
                        titulo.innerText = "No existe ningÃºn impuesto con el identificador: " + comandoInicial
                        main.innerHTML = null
                        main.appendChild(titulo)
                        return
                    }
                    casaVitini.administracion.impuestos.detalleImpuesto(respuestaServidor)
                }
                else {
                    casaVitini.ui.componentes.urlDesconocida()

                }

            },
            mostrarImpuestosResueltos: async function (listasImpuestos) {
                const main = document.querySelector("main")
                main.setAttribute("zonaCSS", "administracion/impuestos")
                const instanciaUID = main.getAttribute("instanciaUID")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const transaccion = {
                    zona: "administracion/impuestos/listaImpuestosPaginados",
                    origen: "url",
                    tipoConstruccionGrid: "total",
                    ...listasImpuestos
                }

                transaccion.pagina = transaccion.pagina ? Number(transaccion.pagina) : 1
                if ((transaccion.nombre_columna)?.toLowerCase() === "impuesto_uid") {
                    transaccion.nombreColumna = "impuestoUID"
                    delete transaccion.nombre_columna
                } else if (transaccion.nombre_columna) {
                    transaccion.nombreColumna = transaccion.nombre_columna.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                    delete transaccion.nombre_columna
                }
                if (transaccion.sentido_columna) {
                    transaccion.sentidoColumna = transaccion.sentido_columna
                    delete transaccion.sentido_columna
                }
                const origen = transaccion.origen
                delete transaccion.origen
                const tipoConstruccionGrid = transaccion.tipoConstruccionGrid
                delete transaccion.tipoConstruccionGrid
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                if (!seccionRenderizada) { return }
                if (respuestaServidor?.error) {
                    return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }

                if (respuestaServidor?.totalImpuestos === 0) {
                    const espacioClientes = document.querySelector("[componente=espacioImpuestos]")
                    document.querySelector("[gridUID=gridImpuestos]")?.remove()
                    document.querySelector("[componente=estadoBusqueda]")?.remove()
                    const estadoBusquedaUI = document.createElement("div")
                    estadoBusquedaUI.classList.add("buscadorClientesEstadoBusqueda")
                    estadoBusquedaUI.setAttribute("componente", "estadoBusqueda")
                    estadoBusquedaUI.innerText = "No hay impuestos configurados"
                    espacioClientes.appendChild(estadoBusquedaUI)
                    return

                }
                const impuestos = respuestaServidor.impuestos

                const dicccionario = {
                    estados: {
                        activado: "Activado",
                        desactivado: "Desactivado"
                    },
                    tiposValores: {
                        porcentaje: "Porcentaje",
                        tasa: "Tasa"
                    },
                    entidades: {
                        reserva: "Reserva",
                        servicio: "Servicio",
                        global: "Global"

                    },
                }

                for (const detallesDelImpuesto of impuestos) {
                    const tipoValorIDV = detallesDelImpuesto.tipoValorIDV
                    const entidadIDV = detallesDelImpuesto.entidadIDV
                    const estadoIDV = detallesDelImpuesto.estadoIDV
                    detallesDelImpuesto.tipoValorIDV = dicccionario.tiposValores[tipoValorIDV]
                    detallesDelImpuesto.estadoIDV = dicccionario.estados[estadoIDV]
                    detallesDelImpuesto.entidadIDV = dicccionario.entidades[entidadIDV]
                }
                const sentidoColumna = respuestaServidor.sentidoColumna
                const nombreColumna = respuestaServidor.nombreColumna
                const pagina = respuestaServidor.pagina
                const paginasTotales = respuestaServidor.paginasTotales
                const columnasGrid = [
                    {
                        columnaUI: "UID",
                        columnaIDV: "impuestoUID",
                        columnaClase: "idColumna"
                    },
                    {
                        columnaUI: "Impuesto",
                        columnaIDV: "nombre",
                        columnaClase: "entradaColumna"
                    },
                    {
                        columnaUI: "Tipo Impositivo",
                        columnaIDV: "tipoImpositivo",
                        columnaClase: "salidaColuma"
                    },
                    {
                        columnaUI: "Tipo Valor",
                        columnaIDV: "tipoValor",
                        columnaClase: "estadoColumna"
                    },
                    {
                        columnaUI: "Entidad",
                        columnaIDV: "entidad",
                        columnaClase: "pagoColumna"
                    },
                    {
                        columnaUI: "Estado",
                        columnaIDV: "estado",
                        columnaClase: "pagoColumna"
                    }
                ]
                const parametrosFinales = {}
                if (pagina > 1 && paginasTotales > 1) {
                    parametrosFinales.pagina = pagina
                }
                if (nombreColumna) {
                    parametrosFinales.pagina = pagina
                    parametrosFinales.nombre_columna = nombreColumna.replace(/([a-z])([A-Z])/g, "$1_$2").toLowerCase();
                    parametrosFinales.sentido_columna = sentidoColumna
                }
                const estructuraParametrosFinales = []
                for (const [parametroFinal, valorFinal] of Object.entries(parametrosFinales)) {
                    const estructura = `${parametroFinal}:${valorFinal}`
                    estructuraParametrosFinales.push(estructura)
                }
                let parametrosURLFInal = ""
                if (estructuraParametrosFinales.length > 0) {
                    parametrosURLFInal = "/" + estructuraParametrosFinales.join("/")
                }

                this.selectorFiltro.ui({
                    columnas: columnasGrid,
                    columnaSeleccioanda: nombreColumna,
                    sentidoSeleccionado: sentidoColumna,
                    destino: "[contenedor=resultados]"
                })

                this.constructorTarjetas({
                    tarjetas: impuestos,
                    destino: "[contenedor=resultados]"

                })



                const constructorURLFinal = granuladoURL.directoriosFusion + parametrosURLFInal
                const metadatosGrid = {
                    filas: impuestos,
                    sentidoColumna: sentidoColumna,
                    nombreColumna: nombreColumna,
                    tipoConstruccionGrid: tipoConstruccionGrid,
                    pagina: pagina,
                    destino: "[contenedor=resultados]",
                    columnasGrid: columnasGrid,
                    gridUID: "gridImpuestos",
                    numeroColumnas: 6,
                    metodoColumna: "casaVitini.administracion.impuestos.ordenarPorColumna",
                    metodoFila: "casaVitini.administracion.impuestos.resolverFila",
                    mascaraHref: {
                        urlStatica: "/administracion/impuestos/",
                        parametro: "impuestoUID"
                    },
                    //mascaraURL: constructorURLFinal
                }
                casaVitini.ui.componentes.grid(metadatosGrid)
                const metadatosPaginador = {
                    paginaActual: pagina,
                    paginasTotales: paginasTotales,
                    destino: "[componente=espacioImpuestos]",
                    metodoBoton: "casaVitini.administracion.impuestos.cambiarPagina",
                    prefijoHref: "/administracion/impuestos/",
                    gridUID: "gridImpuestos",
                    granuladoURL: {
                        parametros: parametrosFinales,
                        directoriosFusion: granuladoURL.directoriosFusion
                    }
                }
                casaVitini.ui.componentes.paginador(metadatosPaginador)
                transaccion.tipoConstruccionGrid = "soloLista"
                const titulo = "ADminstar reservas"
                const estado = {
                    zona: constructorURLFinal,
                    EstadoInternoZona: "estado",
                    tipoCambio: "parcial",
                    componenteExistente: "contenedorBotonesImpuestos",
                    funcionPersonalizada: "casaVitini.administracion.impuestos.mostrarImpuestosResueltos",
                    datosPaginacion: transaccion
                }
                if (origen === "url" || origen === "botonMostrarClientes") {
                    window.history.replaceState(estado, titulo, constructorURLFinal);
                }
                if (origen === "botonNumeroPagina" || origen === "tituloColumna") {
                    window.history.pushState(estado, titulo, constructorURLFinal);
                }
            },
            resolverFila: (transaccion) => {
                transaccion.preventDefault()
                transaccion.stopPropagation()
                const impuestoUID = transaccion.target.parentNode.getAttribute("href")
                const navegacion = {
                    vista: impuestoUID,
                    tipoOrigen: "menuNavegador"
                }
                casaVitini.shell.navegacion.controladorVista(navegacion)
            },
            detalleImpuesto: async (respuestaServidor) => {
                if (respuestaServidor?.error) {
                    const info = {
                        titulo: "Impuesto inexistente",
                        descripcion: "El impuesto al que hace referencia la URL no existe.Revisa el identificador.QuizÃ¡s fue un impuesto que tuviste hace un tiempo y que borraste."
                    }
                    casaVitini.ui.componentes.mensajeSimple(info)
                }
                if (respuestaServidor?.ok) {
                    const detallesImpuesto = respuestaServidor?.ok
                    const impuestoUID = detallesImpuesto.impuestoUID
                    const nombre = detallesImpuesto.nombre
                    const tipoValorIDV = detallesImpuesto.tipoValorIDV
                    const tipoImpositivo = detallesImpuesto.tipoImpositivo
                    const entidadIDV = detallesImpuesto.entidadIDV
                    const estadoIDV = detallesImpuesto.estadoIDV


                    const dicccionario = {
                        estados: {
                            activado: "Activado",
                            desactivado: "Desactivado"
                        },
                        tiposValores: {
                            porcentaje: "Porcentaje",
                            tasa: "Tasa"
                        },
                        entidades: {
                            reserva: "Reserva",
                            servicio: "Servicio",
                            global: "Global"
                        },
                    }


                    let selectorEspacioPreciosEImpuestos = document.querySelector("[componente=impuestos]")
                    let bloqueDetallesImpuesto = document.createElement("div")
                    bloqueDetallesImpuesto.classList.add("detalleImpuestoBloque")
                    bloqueDetallesImpuesto.setAttribute("impuestoUID", impuestoUID)
                    bloqueDetallesImpuesto.setAttribute("componente", "bloqueDetalles")
                    let nombreImpuestoUI = document.createElement("p")
                    nombreImpuestoUI.classList.add("detalleImpuestoNombre")
                    nombreImpuestoUI.setAttribute("detalleImpuesto", "nombre")
                    nombreImpuestoUI.innerText = nombre
                    bloqueDetallesImpuesto.appendChild(nombreImpuestoUI)
                    let bloqueDato = document.createElement("div")
                    bloqueDato.classList.add("detalleImpuestoBloqueDato")
                    bloqueDato.setAttribute("bloqueDato", "tipoImpositivo")
                    let tituloDato = document.createElement("p")
                    tituloDato.classList.add("detalleImpuestoTituloDato")
                    tituloDato.innerText = "Tipo impositivo"
                    bloqueDato.appendChild(tituloDato)
                    let datoLectura = document.createElement("p")
                    datoLectura.classList.add("detalleImpuestoDatoLectura")
                    datoLectura.setAttribute("detalleImpuesto", "tipoImpositivo")
                    datoLectura.innerText = tipoImpositivo
                    bloqueDato.appendChild(datoLectura)
                    bloqueDetallesImpuesto.appendChild(bloqueDato)
                    bloqueDato = document.createElement("div")
                    bloqueDato.classList.add("detalleImpuestoBloqueDato")
                    bloqueDato.setAttribute("bloqueDato", "tipoValorIDV")
                    tituloDato = document.createElement("p")
                    tituloDato.classList.add("detalleImpuestoTituloDato")
                    tituloDato.innerText = "Tipo valor"
                    bloqueDato.appendChild(tituloDato)
                    datoLectura = document.createElement("p")
                    datoLectura.classList.add("detalleImpuestoDatoLectura")
                    datoLectura.setAttribute("detalleImpuesto", "tipoValorIDV")
                    datoLectura.setAttribute("tipoValorIDV", tipoValorIDV)
                    datoLectura.innerText = dicccionario.tiposValores[tipoValorIDV]
                    bloqueDato.appendChild(datoLectura)
                    bloqueDetallesImpuesto.appendChild(bloqueDato)
                    bloqueDato = document.createElement("div")
                    bloqueDato.classList.add("detalleImpuestoBloqueDato")
                    bloqueDato.setAttribute("bloqueDato", "entidadIDV")
                    tituloDato = document.createElement("p")
                    tituloDato.classList.add("detalleImpuestoTituloDato")
                    tituloDato.innerText = "Entidad"
                    bloqueDato.appendChild(tituloDato)
                    datoLectura = document.createElement("p")
                    datoLectura.classList.add("detalleImpuestoDatoLectura")
                    datoLectura.setAttribute("detalleImpuesto", "entidadIDV")
                    datoLectura.setAttribute("entidadIDV", entidadIDV)
                    datoLectura.innerText = dicccionario.entidades[entidadIDV]
                    bloqueDato.appendChild(datoLectura)
                    bloqueDetallesImpuesto.appendChild(bloqueDato)
                    bloqueDato = document.createElement("div")
                    bloqueDato.classList.add("detalleImpuestoBloqueDato")
                    bloqueDato.setAttribute("bloqueDato", "estadoIDV")
                    tituloDato = document.createElement("p")
                    tituloDato.classList.add("detalleImpuestoTituloDato")
                    tituloDato.innerText = "Estado del impuesto"
                    bloqueDato.appendChild(tituloDato)
                    datoLectura = document.createElement("p")
                    datoLectura.classList.add("detalleImpuestoDatoLectura")
                    datoLectura.setAttribute("detalleImpuesto", "estadoIDV")
                    datoLectura.setAttribute("estadoIDV", estadoIDV)
                    datoLectura.innerText = dicccionario.estados[estadoIDV]
                    bloqueDato.appendChild(datoLectura)
                    bloqueDetallesImpuesto.appendChild(bloqueDato)
                    bloqueDato = document.createElement("div")
                    bloqueDato.classList.add("detalleImpuestoBloqueDato")
                    bloqueDato.setAttribute("bloqueDato", "moneda")
                    //tituloDato = document.createElement("p")
                    //tituloDato.classList.add("detalleImpuestoTituloDato")
                    //tituloDato.innerText = "Moneda"
                    //bloqueDato.appendChild(tituloDato)
                    //datoLectura = document.createElement("p")
                    //datoLectura.classList.add("detalleImpuestoDatoLectura")
                    //datoLectura.setAttribute("detalleImpuesto", "moneda")
                    //datoLectura.setAttribute("monedaIDV", monedaIDV)
                    //datoLectura.innerText = monedaUI
                    //bloqueDato.appendChild(datoLectura)
                    //bloqueDetallesImpuesto.appendChild(bloqueDato)
                    selectorEspacioPreciosEImpuestos.appendChild(bloqueDetallesImpuesto)
                    let bloqueBotones = document.createElement("div")
                    bloqueBotones.classList.add("detalleImpuestoBloqueBotones")
                    let boton = document.createElement("p")
                    boton.classList.add("detalleImpuestoBoton")
                    boton.setAttribute("boton", "editarImpuesto")
                    boton.innerText = "Editar impuesto"
                    boton.addEventListener("click", casaVitini.administracion.impuestos.editarImpuesto)
                    bloqueBotones.appendChild(boton)
                    boton = document.createElement("p")
                    boton.classList.add("detalleImpuestoBoton")
                    boton.classList.add("elementoOcultoInicialmente")
                    boton.setAttribute("boton", "guardarCambios")
                    boton.addEventListener("click", casaVitini.administracion.impuestos.guardarModificacionesImpuesto)
                    boton.innerText = "Guardar cambios"
                    bloqueBotones.appendChild(boton)
                    boton = document.createElement("p")
                    boton.classList.add("detalleImpuestoBoton")
                    boton.classList.add("elementoOcultoInicialmente")
                    boton.setAttribute("boton", "cancelarCambios")
                    boton.addEventListener("click", casaVitini.administracion.impuestos.cancelarCambiosImpuesto)
                    boton.innerText = "Cancelar cambios"
                    bloqueBotones.appendChild(boton)
                    boton = document.createElement("p")
                    boton.classList.add("detalleImpuestoBoton")
                    boton.classList.add("elementoOcultoInicialmente")
                    boton.setAttribute("boton", "eliminarImpuesto")
                    boton.addEventListener("click", casaVitini.administracion.impuestos.eliminarPerfilImpuestos.UI)
                    boton.innerText = "Eliminar impuesto"
                    bloqueBotones.appendChild(boton)
                    selectorEspacioPreciosEImpuestos.appendChild(bloqueBotones)
                }
            },
            editarImpuesto: async () => {
                document.querySelector("[boton=editarImpuesto]").classList.add("elementoOcultoInicialmente")
                document.querySelector("[boton=guardarCambios]").classList.remove("elementoOcultoInicialmente")
                document.querySelector("[boton=cancelarCambios]").classList.remove("elementoOcultoInicialmente")
                document.querySelector("[boton=eliminarImpuesto]").classList.remove("elementoOcultoInicialmente")
                const opcionesTipoValor = [
                    {
                        tipoValorIDV: "tasa",
                        tipoValorUI: "Tasa"
                    }, {
                        tipoValorIDV: "porcentaje",
                        tipoValorUI: "Porcentaje"
                    }
                ]
                const opcionesEntidad = [
                    {
                        entidadIDV: "reserva",
                        entidadUI: "Reserva"
                    },
                    {
                        entidadIDV: "servicio",
                        entidadUI: "Servicio"
                    },
                    {
                        entidadIDV: "global",
                        entidadUI: "Global"
                    }
                ]
                const listaEstados = [
                    {
                        estadoIDV: "activado",
                        estadoUI: "Activado"
                    }, {
                        estadoIDV: "desactivado",
                        estadoUI: "Desactivado"
                    }
                ]
                const selectorDatoLectura = document.querySelectorAll("[detalleImpuesto]")
                selectorDatoLectura.forEach((detalleImpuesto) => {
                    detalleImpuesto.style.display = "none"
                    const nombreDetalles = detalleImpuesto.getAttribute("detalleImpuesto")
                    const datoDetalle = detalleImpuesto.innerText
                    const campoEditable = document.createElement("input")
                    campoEditable.classList.add("detalleImpuestoCampoEditable")
                    campoEditable.setAttribute("componente", "campoEditable")
                    campoEditable.setAttribute("campoEditable", nombreDetalles)
                    campoEditable.setAttribute("datoActual", datoDetalle)
                    campoEditable.value = datoDetalle
                    if (nombreDetalles === "nombre") {
                        const selectorBloqueDetalles = document.querySelector("[componente=bloqueDetalles")
                        const selectorPrimerBloqueDAtos = document.querySelector("[bloqueDato=tipoImpositivo]")
                        campoEditable.placeholder = "Escribe un nombre para el impuesto"
                        campoEditable.classList.add("nombreImpuestoCampo")
                        selectorBloqueDetalles.insertBefore(campoEditable, selectorPrimerBloqueDAtos);
                    }
                    if (nombreDetalles === "tipoValorIDV") {
                        const tipoValorIDV_actual = detalleImpuesto.getAttribute("tipoValorIDV")
                        const contenedorOpciones = document.createElement("select")
                        contenedorOpciones.classList.add("detalleImpuestoSelectorLista")
                        contenedorOpciones.setAttribute("componente", "campoEditable")
                        contenedorOpciones.setAttribute("campoEditable", nombreDetalles)
                        contenedorOpciones.setAttribute("datoActual", tipoValorIDV_actual)
                        opcionesTipoValor.forEach((opcionTipoValor) => {
                            const tipoValorIDV = opcionTipoValor.tipoValorIDV
                            const tipoValorUI = opcionTipoValor.tipoValorUI
                            const opcion = document.createElement("option");
                            opcion.value = tipoValorIDV;
                            opcion.text = tipoValorUI;
                            opcion.setAttribute("opcion", tipoValorIDV)
                            contenedorOpciones.add(opcion);
                        })
                        contenedorOpciones.value = tipoValorIDV_actual;
                        const selectorBloqueDato = document.querySelector(`[bloqueDato="${nombreDetalles}"]`)
                        selectorBloqueDato.appendChild(contenedorOpciones)
                        if (nombreDetalles === "tipoImpositivo") {
                            const selectorBloqueDato = document.querySelector(`[bloqueDato="${nombreDetalles}"]`)
                            selectorBloqueDato.appendChild(campoEditable)
                        }
                    }
                    if (nombreDetalles === "entidadIDV") {
                        const aplicacionSobreIDV_actual = detalleImpuesto.getAttribute("entidadIDV")
                        const contenedorOpciones = document.createElement("select")
                        contenedorOpciones.classList.add("detalleImpuestoSelectorLista")
                        contenedorOpciones.setAttribute("componente", "campoEditable")
                        contenedorOpciones.setAttribute("campoEditable", nombreDetalles)
                        contenedorOpciones.setAttribute("datoActual", aplicacionSobreIDV_actual)
                        opcionesEntidad.forEach((e) => {
                            const entidadIDV = e.entidadIDV
                            const entidadUI = e.entidadUI
                            const opcion = document.createElement("option");
                            opcion.value = entidadIDV;
                            opcion.text = entidadUI;
                            opcion.setAttribute("opcion", entidadIDV)
                            contenedorOpciones.add(opcion);
                        })
                        contenedorOpciones.value = aplicacionSobreIDV_actual;
                        const selectorBloqueDato = document.querySelector(`[bloqueDato="${nombreDetalles}"]`)
                        selectorBloqueDato.appendChild(contenedorOpciones)
                        if (nombreDetalles === "tipoImpositivo") {
                            const selectorBloqueDato = document.querySelector(`[bloqueDato="${nombreDetalles}"]`)
                            selectorBloqueDato.appendChild(campoEditable)
                        }
                    }
                    if (nombreDetalles === "estadoIDV") {
                        const estadoIDV_Actual = detalleImpuesto.getAttribute("estadoIDV")
                        const contenedorOpciones = document.createElement("select")
                        contenedorOpciones.classList.add("detalleImpuestoSelectorLista")
                        contenedorOpciones.setAttribute("componente", "campoEditable")
                        contenedorOpciones.setAttribute("campoEditable", nombreDetalles)
                        contenedorOpciones.setAttribute("datoActual", estadoIDV_Actual)
                        listaEstados.forEach((estado) => {
                            const estadoIDV = estado.estadoIDV
                            const estadoUI = estado.estadoUI
                            const opcion = document.createElement("option");
                            opcion.value = estadoIDV;
                            opcion.text = `${estadoUI}`;
                            opcion.setAttribute("opcion", estadoIDV)
                            contenedorOpciones.add(opcion);
                        })
                        contenedorOpciones.value = estadoIDV_Actual;
                        const selectorBloqueDato = document.querySelector(`[bloqueDato="${nombreDetalles}"]`)
                        selectorBloqueDato.appendChild(contenedorOpciones)
                        if (nombreDetalles === "tipoImpositivo") {
                            const selectorBloqueDato = document.querySelector(`[bloqueDato="${nombreDetalles}"]`)
                            selectorBloqueDato.appendChild(campoEditable)
                        }
                    }
                    if (nombreDetalles === "tipoImpositivo") {
                        const selectorBloqueDato = document.querySelector(`[bloqueDato="${nombreDetalles}"]`)
                        campoEditable.placeholder = "Escribe un tipo impositivo(00.00)"

                        selectorBloqueDato.appendChild(campoEditable)
                    }
                })
            },
            cancelarCambiosImpuesto: () => {
                document.querySelector("[boton=editarImpuesto]").classList.remove("elementoOcultoInicialmente")
                document.querySelector("[boton=guardarCambios]").classList.add("elementoOcultoInicialmente")
                document.querySelector("[boton=cancelarCambios]").classList.add("elementoOcultoInicialmente")
                document.querySelector("[boton=eliminarImpuesto]").classList.add("elementoOcultoInicialmente")
                const selectorCamposEditables = document.querySelectorAll("[componente=campoEditable]")
                selectorCamposEditables.forEach((campoEditable) => {
                    campoEditable.remove()
                })
                const selectorDatoLectura = document.querySelectorAll("[detalleImpuesto]")
                selectorDatoLectura.forEach((detalleImpuesto) => {
                    detalleImpuesto.removeAttribute("style")
                })
            },
            guardarModificacionesImpuesto: async () => {
                const impuestoUID = document.querySelector("[impuestoUID]").getAttribute("impuestoUID")
                const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                const mensaje = "Guardando impuesto..."
                const datosPantallaSuperpuesta = {
                    instanciaUID: instanciaUID,
                    mensaje: mensaje
                }
                casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                const transaccion = {
                    zona: "administracion/impuestos/guardarModificacionImpuesto",
                    impuestoUID: String(impuestoUID)
                }
                const selectorCamposEditables = document.querySelectorAll("[componente=campoEditable]")
                selectorCamposEditables.forEach(campoEditable => {
                    const nombreCampoEditable = campoEditable.getAttribute("campoEditable")
                    const datoCampoEditable = campoEditable.value
                    transaccion[nombreCampoEditable] = datoCampoEditable
                })

                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                if (!instanciaRenderizada) { return }
                instanciaRenderizada.remove()
                if (respuestaServidor?.error) {
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    const detalleImpuestoActualizado = respuestaServidor?.detallesImpuesto
                    const nombre = detalleImpuestoActualizado.nombre
                    const impuestoUID = detalleImpuestoActualizado.impuestoUID
                    const tipoImpositivo = detalleImpuestoActualizado.tipoImpositivo
                    const tipoValorIDV = detalleImpuestoActualizado.tipoValorIDV
                    const estadoIDV = detalleImpuestoActualizado.estadoIDV
                    const entidadIDV = detalleImpuestoActualizado.entidadIDV

                    const dicccionario = {
                        estados: {
                            activado: "Activado",
                            desactivado: "Desactivado"
                        },
                        tiposValores: {
                            porcentaje: "Porcentaje",
                            tasa: "Tasa"
                        },
                        entidades: {
                            reserva: "Reserva",
                            servicio: "Servicios",
                            global: "Global"
                        },
                    }

                    const selectorCamposEditables = document.querySelectorAll("[componente=campoEditable]")
                    selectorCamposEditables.forEach(campoEditable => campoEditable.remove())
                    const selectorNombreImpuesto = document.querySelector("[detalleImpuesto=nombre]")

                    selectorNombreImpuesto.innerText = nombre
                    const selectotipoImpositivo = document.querySelector("[detalleImpuesto=tipoImpositivo]")
                    selectotipoImpositivo.innerText = tipoImpositivo

                    const selectorTipoValor = document.querySelector("[detalleImpuesto=tipoValorIDV]")
                    selectorTipoValor.setAttribute("tipoValor", tipoValorIDV)
                    selectorTipoValor.innerText = dicccionario.tiposValores[tipoValorIDV]

                    const selectorEntidad = document.querySelector("[detalleImpuesto=entidadIDV]")
                    selectorEntidad.setAttribute("entidadIDV", entidadIDV)
                    selectorEntidad.innerText = dicccionario.entidades[entidadIDV]

                    const selectorMoneda = document.querySelector("[detalleImpuesto=estadoIDV]")
                    selectorMoneda.setAttribute("estadoIDV", estadoIDV)
                    selectorMoneda.innerText = dicccionario.estados[estadoIDV]

                    const selectorDatoLectura = document.querySelectorAll("[detalleImpuesto]")
                    selectorDatoLectura.forEach((detalleImpuesto) => {
                        detalleImpuesto.removeAttribute("style")
                    })
                    document.querySelector("[boton=editarImpuesto]").classList.remove("elementoOcultoInicialmente")
                    document.querySelector("[boton=guardarCambios]").classList.add("elementoOcultoInicialmente")
                    document.querySelector("[boton=cancelarCambios]").classList.add("elementoOcultoInicialmente")
                    document.querySelector("[boton=eliminarImpuesto]").classList.add("elementoOcultoInicialmente")
                }
            },
            eliminarPerfilImpuestos: {
                UI: () => {
                    const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                    const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                    const titulo = constructor.querySelector("[componente=titulo]")
                    titulo.innerText = "Confirmar la eliminaciÃ³n del perfil del impuesto"
                    const mensaje = constructor.querySelector("[componente=mensajeUI]")
                    mensaje.innerText = "Vas a eliminar un impuesto y su aplicaciÃ³n serÃ¡ inmediata en los precios de las reservas."

                    const botonAceptar = constructor.querySelector("[boton=aceptar]")
                    botonAceptar.innerText = "Comfirmar la eliminacion del impuesto"
                    botonAceptar.addEventListener("click", casaVitini.administracion.impuestos.eliminarPerfilImpuestos.confirmarEliminacion)
                    const botonCancelar = constructor.querySelector("[boton=cancelar]")
                    botonCancelar.innerText = "Cancelar la eliminacion"

                    document.querySelector("main").appendChild(pantallaInmersiva)
                },
                confirmarEliminacion: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Eliminado impuesto..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const impuestoUID = document.querySelector("[impuestoUID]").getAttribute("impuestoUID")
                    const transaccion = {
                        zona: "administracion/impuestos/eliminarPerfilImpuesto",
                        impuestoUID: String(impuestoUID)
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                        selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                            advertenciaInmersiva.remove()
                        })
                        const entrada = {
                            vista: "/administracion/impuestos",
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(entrada)
                    }
                }
            },
            crearImpuesto: {
                arranque: async () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/impuestos/nuevo")

                    const opcionesTipoValor = [
                        {
                            tipoValorIDV: "porcentaje",
                            tipoValorUI: "Porcentaje"
                        },
                        {
                            tipoValorIDV: "tasa",
                            tipoValorUI: "Tasa"
                        }
                    ]

                    const opcionesEntidad = [
                        {
                            entidadIDV: "reserva",
                            entidadUI: "Reserva"
                        },
                        {
                            entidadIDV: "servicio",
                            entidadUI: "Servicios"
                        },
                        {
                            entidadIDV: "global",
                            entidadUI: "Global"
                        },

                    ]

                    const selectorEspacioImpuestos = document.querySelector("[componente=espacioImpuestos]")
                    const contenedorNuevoImpuesto = document.createElement("div")
                    contenedorNuevoImpuesto.classList.add("contenedorNuevoImpuesto")
                    const bloqueBloqueoApartamentos = document.createElement("div")
                    bloqueBloqueoApartamentos.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                    const tituloBloquoApartamentos = document.createElement("div")
                    tituloBloquoApartamentos.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                    tituloBloquoApartamentos.innerText = "Para crear un nuevo impuesto, rellene los datos de este, establece un nombre, una cantidad y seleccione las opciones restantes."
                    bloqueBloqueoApartamentos.appendChild(tituloBloquoApartamentos)
                    let campoCraerNuevoImpuesto = document.createElement("input")
                    campoCraerNuevoImpuesto.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto")
                    campoCraerNuevoImpuesto.setAttribute("comNuevoImpuesto", "nombre")
                    campoCraerNuevoImpuesto.placeholder = "Escribo el nombre del nuevo impuesto"
                    bloqueBloqueoApartamentos.appendChild(campoCraerNuevoImpuesto)
                    campoCraerNuevoImpuesto = document.createElement("input")
                    campoCraerNuevoImpuesto.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto")
                    campoCraerNuevoImpuesto.setAttribute("comNuevoImpuesto", "tipoImpositivo")
                    campoCraerNuevoImpuesto.placeholder = "0.00"
                    bloqueBloqueoApartamentos.appendChild(campoCraerNuevoImpuesto)
                    let contenedorOpciones = document.createElement("select")
                    contenedorOpciones.classList.add("detalleImpuestoSelectorLista")
                    contenedorOpciones.setAttribute("comNuevoImpuesto", "tipoValorIDV")

                    const opTipoValor = document.createElement("option")
                    opTipoValor.selected = "true"
                    opTipoValor.disabled = "true"
                    opTipoValor.value = ""
                    opTipoValor.text = "Selecciona el tipo de valor del impuesto"
                    contenedorOpciones.appendChild(opTipoValor)

                    opcionesTipoValor.forEach((opcionTipoValor) => {
                        const tipoValorIDV = opcionTipoValor.tipoValorIDV
                        const tipoValorUI = opcionTipoValor.tipoValorUI
                        const opcion = document.createElement("option");
                        opcion.value = tipoValorIDV;
                        opcion.text = tipoValorUI;
                        opcion.setAttribute("opcion", tipoValorIDV)
                        contenedorOpciones.add(opcion);
                    })
                    bloqueBloqueoApartamentos.appendChild(contenedorOpciones)
                    contenedorOpciones = document.createElement("select")
                    contenedorOpciones.classList.add("detalleImpuestoSelectorLista")
                    contenedorOpciones.setAttribute("comNuevoImpuesto", "entidadIDV")


                    const opEntidades = document.createElement("option")
                    opEntidades.selected = "true"
                    opEntidades.disabled = "true"
                    opEntidades.value = ""
                    opEntidades.text = "Selecciona el tipo de entidad"
                    contenedorOpciones.appendChild(opEntidades)

                    opcionesEntidad.forEach((entidad) => {
                        const entidadIDV = entidad.entidadIDV
                        const entidadUI = entidad.entidadUI
                        const opcion = document.createElement("option");
                        opcion.value = entidadIDV;
                        opcion.text = entidadUI;
                        opcion.setAttribute("opcion", entidadIDV)
                        contenedorOpciones.add(opcion);
                    })
                    bloqueBloqueoApartamentos.appendChild(contenedorOpciones)

                    contenedorNuevoImpuesto.appendChild(bloqueBloqueoApartamentos)
                    const bloqueBotones = document.createElement("div")
                    bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                    const botonCancelar = document.createElement("div")
                    botonCancelar.classList.add("detallesReservaCancelarBoton")
                    botonCancelar.setAttribute("componente", "botonConfirmarCancelarReserva")
                    botonCancelar.innerText = "Crear nuevo impuesto"
                    botonCancelar.addEventListener("click", casaVitini.administracion.impuestos.crearImpuesto.confirmarCrearImpuesto)
                    bloqueBotones.appendChild(botonCancelar)
                    const botonCancelarProcesoCancelacion = document.createElement("div")
                    botonCancelarProcesoCancelacion.classList.add("detallesReservaCancelarBoton")
                    botonCancelarProcesoCancelacion.innerText = "Cancelar"
                    botonCancelarProcesoCancelacion.addEventListener("click", () => {
                        const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                        selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                            advertenciaInmersiva.remove()
                        })
                    })
                    //bloqueBotones.appendChild(botonCancelarProcesoCancelacion)
                    contenedorNuevoImpuesto.appendChild(bloqueBotones)
                    selectorEspacioImpuestos.appendChild(contenedorNuevoImpuesto)

                },
                confirmarCrearImpuesto: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Creando nuevo impuesto..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje,
                        identificadorVisual: "pantallaDeCarga"
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const transaccion = {
                        zona: "administracion/impuestos/crearNuevoImpuesto"
                    }

                    let selectorCampos = document.querySelectorAll("[comNuevoImpuesto]")
                    selectorCampos.forEach((campoNuevoImpuesto) => {
                        const nombreCampo = campoNuevoImpuesto.getAttribute("comNuevoImpuesto")
                        const datoCampo = campoNuevoImpuesto.value
                        transaccion[nombreCampo] = datoCampo
                    })

                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()


                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const nuevoUIDIMpuesto = respuestaServidor?.nuevoImpuestoUID
                        const entrada = {
                            vista: "/administracion/impuestos/" + nuevoUIDIMpuesto,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(entrada)
                    }
                }
            },
            cambiarPagina: async (cambiarPagina) => {
                const gridUID = cambiarPagina.gridUID
                const gridEnlazado = document.querySelector(`[gridUID=${gridUID}]`)
                const main = document.querySelector("main")
                const instanciaUID = main.getAttribute("instanciaUID")
                const tipoBoton = cambiarPagina.componenteID
                const nombreColumna = gridEnlazado.getAttribute("nombreColumnaSeleccionada")
                const sentidoColumna = gridEnlazado.getAttribute("sentidoColumna")
                const terminoBusqueda = gridEnlazado.getAttribute("terminoBusqueda")
                const paginaActual = Number(gridEnlazado.getAttribute("numeroPagina"))
                const transacccion = {
                    zona: "administracion/impuestos/listaImpuestosPaginados",
                    // nombreColumna: nombreColumna,
                    // sentidoColumna: sentidoColumna,
                    // buscar: terminoBusqueda,
                    // tipoBusqueda: "rapido",
                    //instanciaUID: instanciaUID
                }
                if (nombreColumna) {
                    transacccion.nombreColumna = nombreColumna
                }
                if (sentidoColumna) {
                    transacccion.sentidoColumna = sentidoColumna
                }
                if (tipoBoton === "numeroPagina") {
                    const numeroPagina = cambiarPagina.numeroPagina
                    transacccion.pagina = Number(numeroPagina)
                    transacccion.origen = "botonNumeroPagina"
                }
                if (tipoBoton === "botonAdelantePaginacion") {
                    const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                    let mueveNavegadorHaciaAdelante = "Desactivado";
                    if (Number(posicionRelativa) === 10) {
                        mueveNavegadorHaciaAdelante = "Activado"
                    }
                    transacccion.pagina = paginaActual + 1
                    transacccion.origen = "botonNumeroPagina"
                    transacccion.moverHaciaAdelanteNavegacion = mueveNavegadorHaciaAdelante
                    transacccion.sentidoNavegacion = "Adelante"
                }
                if (tipoBoton === "botonAtrasPaginacion") {
                    const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                    let mueveNavegadorHaciaAtras = "Desactivado";
                    if (Number(posicionRelativa) === 1) {
                        mueveNavegadorHaciaAtras = "Activado"
                    }
                    transacccion.pagina = paginaActual - 1
                    transacccion.origen = "botonNumeroPagina"
                    transacccion.mueveNavegadorHaciaAtras = mueveNavegadorHaciaAtras
                    transacccion.sentidoNavegacion = "Atras"
                }
                transacccion.tipoConstruccionGrid = "soloLista"
                casaVitini.administracion.impuestos.mostrarImpuestosResueltos(transacccion)
            },
            ordenarPorColumna: async (columna) => {

                const nombreColumna = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("nombreColumna")
                const selectorColumnasentido = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("sentidoColumna")
                const numeroPagina = columna.target.closest("[gridUID]").getAttribute("numeroPagina")
                const transaccion = {
                    zona: "administracion/impuestos/listaImpuestosPaginados",
                    pagina: Number(numeroPagina),
                    tipoConstruccionGrid: "soloLista",
                    origen: "tituloColumna"
                }

                if (selectorColumnasentido === "ascendente") {
                    transaccion.sentidoColumna = "descendente"
                    transaccion.nombreColumna = nombreColumna
                }
                if (!selectorColumnasentido) {
                    transaccion.sentidoColumna = "ascendente"
                    transaccion.nombreColumna = nombreColumna
                }
                casaVitini.administracion.impuestos.mostrarImpuestosResueltos(transaccion)
            },
            contenedorBotones: () => {
                const espacioImpuestos = document.querySelector("[componente=impuestos]")
                const contenedorBotones = document.createElement("div")
                contenedorBotones.classList.add("administracion_impuestos_contenedorBotones")
                contenedorBotones.setAttribute("componente", "contenedorBotonesImpuestos")
                const botonCrearImpuesto = document.createElement("a")
                botonCrearImpuesto.classList.add("administracion_impuestos_botonV1")
                botonCrearImpuesto.innerText = "Crear impuesto"
                botonCrearImpuesto.setAttribute("href", "/administracion/impuestos/crear_nuevo_impuesto")
                botonCrearImpuesto.setAttribute("vista", "/administracion/impuestos/crear_nuevo_impuesto")
                botonCrearImpuesto.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                contenedorBotones.appendChild(botonCrearImpuesto)
                espacioImpuestos.appendChild(contenedorBotones)
            },
            constructorTarjetas: (data) => {
                const impuestos = data.tarjetas
                const destino = data.destino

                const contenedorTarjetas = document.querySelector("[contenedor=tarjetas]")
                contenedorTarjetas?.remove()

                const contenedor = document.createElement("div")
                contenedor.setAttribute("contenedor", "tarjetas")
                contenedor.classList.add(
                    "flexVertical",
                    "gap6"
                )

                impuestos.forEach(i => {
                    const impuestoUID = i.impuestoUID
                    const nombre = i.nombre
                    const tipoImpositivo = i.tipoImpositivo
                    const tipoValorIDV = i.tipoValorIDV
                    const entidadIDV = i.entidadIDV
                    const estadoIDV = i.estadoIDV

                    const tarjeta = document.createElement("a")
                    tarjeta.setAttribute("componente", "tarjeta")
                    tarjeta.classList.add(
                        "flexVertical",
                        "gap6",
                        "tarjeta",
                        "borderRadius10",
                        "backgroundGrey1",
                        "padding10",
                        "areaSinDecoracionPredeterminada",
                        "ratonDefault",
                        "comportamientoBoton"
                    )
                    tarjeta.href = `/administracion/impuestos/${impuestoUID}`
                    tarjeta.setAttribute("vista", `/administracion/impuestos/${impuestoUID}`)
                    tarjeta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    contenedor.appendChild(tarjeta)

                    const datosPar = {
                        "ClienteUID": impuestoUID,
                        "Nombre": nombre,
                        "Tipo impositivo": tipoImpositivo,
                        "Tipo valor": tipoValorIDV,
                        "Entidad": entidadIDV,
                        "Estado": estadoIDV,

                    }

                    Object.entries(datosPar).forEach(([datoUI, data]) => {

                        const contenedor = document.createElement("div")
                        contenedor.classList.add(
                            "flexVertical"
                        )
                        if (data) {
                            tarjeta.appendChild(contenedor)
                        }
                        const titulo = document.createElement("div")
                        titulo.innerHTML = datoUI
                        contenedor.appendChild(titulo)

                        const dataUI = document.createElement("div")
                        dataUI.classList.add(
                            "negrita",
                            "textoElipsis"
                        )
                        dataUI.innerText = data
                        contenedor.appendChild(dataUI)
                    })
                })
                document.querySelector(destino).appendChild(contenedor)
            },
            selectorFiltro: {
                ui: function (data) {
                    const destino = data.destino
                    const columnas = data.columnas

                    const columnaSeleccioanda = data?.columnaSeleccioanda || null
                    const sentidoSeleccionado = data?.sentidoSeleccionado || null
                    const selectorFiltroOrden = document.querySelector("[contenedor=filtrosOrden]")
                    if (selectorFiltroOrden) {
                        const selectorOrdenPorColumna = selectorFiltroOrden.querySelector("[selector=ordenPorColumna]")
                        const selectorSentido = selectorFiltroOrden.querySelector("[selector=sentido]")

                        if (columnaSeleccioanda) {
                            selectorOrdenPorColumna.value = columnaSeleccioanda

                        } else {
                            selectorOrdenPorColumna.selectedIndex = 0
                        }
                        if (sentidoSeleccionado) {
                            selectorSentido.value = sentidoSeleccionado
                        } else {
                            selectorSentido.selectedIndex = 0
                        }
                        return
                    }

                    const contenedorFiltrosOrden = document.createElement("div")
                    contenedorFiltrosOrden.classList.add(
                        "gap6",
                        "flexDerecha"
                    )
                    contenedorFiltrosOrden.setAttribute("contenedor", "filtrosOrden")

                    const botonReseteo = document.createElement("div")
                    botonReseteo.classList.add(
                        "selector",
                        "textoCentrado",
                        "comportamientoBoton",
                        "noSelecionable",
                        "ratonDefault"
                    )
                    botonReseteo.innerText = "Resetear filtros"
                    botonReseteo.addEventListener("click", (e) => {
                        const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                        const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]")
                        const selectorSentido = contenedor.querySelector("[selector=sentido]")
                        selectorColumna.selectedIndex = 0
                        selectorSentido.selectedIndex = 0
                        this.pasarela(e)
                    })
                    contenedorFiltrosOrden.appendChild(botonReseteo)

                    const selectorColumna = document.createElement("select")
                    selectorColumna.setAttribute("selector", "ordenPorColumna")
                    selectorColumna.addEventListener("change", this.pasarela)
                    selectorColumna.classList.add(
                        "selector",
                        "textoCentrado"
                    )
                    contenedorFiltrosOrden.appendChild(selectorColumna)
                    const opcionPreterminada = document.createElement("option");
                    opcionPreterminada.disabled = "true"
                    opcionPreterminada.value = ""
                    opcionPreterminada.text = "Ordenar por columna";
                    if (!columnaSeleccioanda) {
                        opcionPreterminada.selected = "true"
                    }

                    selectorColumna.add(opcionPreterminada)

                    columnas.forEach((columna) => {
                        const columnaUI = columna.columnaUI
                        const columnaIDV = columna.columnaIDV
                        const opcion = document.createElement("option");
                        opcion.value = columnaIDV;
                        opcion.text = columnaUI;
                        if (columnaSeleccioanda === columnaIDV) {
                            opcion.selected = "true"
                        }
                        selectorColumna.add(opcion);
                    })

                    const selectorSentido = document.createElement("select")
                    selectorSentido.setAttribute("selector", "sentido")
                    selectorSentido.addEventListener("change", this.pasarela)

                    selectorSentido.classList.add(
                        "selector",
                        "textoCentrado"
                    )
                    contenedorFiltrosOrden.appendChild(selectorSentido)
                    const opcionSentido = document.createElement("option");
                    opcionSentido.disabled = "true"
                    opcionSentido.text = "Sentido";
                    opcionSentido.value = ""
                    if (!sentidoSeleccionado) {
                        opcionSentido.selected = "true"
                    }
                    selectorSentido.add(opcionSentido)

                    const sentidos = [
                        {
                            sentidoUI: "Ascendente",
                            sentidoIDV: "ascendente"
                        },
                        {
                            sentidoUI: "Descendente",
                            sentidoIDV: "descendente"
                        }
                    ]

                    sentidos.forEach((sentido) => {
                        const sentidoUI = sentido.sentidoUI
                        const sentidoIDV = sentido.sentidoIDV
                        const opcion = document.createElement("option");
                        opcion.value = sentidoIDV;
                        opcion.text = sentidoUI;
                        if (sentidoSeleccionado === sentidoIDV) {
                            opcion.selected = "true"
                        }
                        selectorSentido.add(opcion);
                    })
                    document.querySelector(destino).appendChild(contenedorFiltrosOrden)
                },
                pasarela: (e) => {
                    const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                    const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                    const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]").value
                    const selectorSentido = contenedor.querySelector("[selector=sentido]").value
                    const ui = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    const numeroPagina = ui.querySelector("[gridUID]").getAttribute("numeroPagina")
                    const transaccion = {
                        zona: "administracion/impuestos/listaImpuestosPaginados",
                        pagina: Number(numeroPagina),
                        tipoConstruccionGrid: "soloLista",
                        origen: "tituloColumna",
                        granuladoURL: casaVitini.utilidades.granuladorURL()
                    }
                    transaccion.sentidoColumna = selectorSentido
                    transaccion.nombreColumna = selectorColumna

                    casaVitini.administracion.impuestos.mostrarImpuestosResueltos(transaccion)
                }
            },
        },
        gestion_de_ofertas: {
            arranque: async function () {
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                const main = document.querySelector("main")
                if (comandoInicial === "gestion_de_ofertas" && Object.keys(granuladoURL.parametros).length === 0) {
                    main.setAttribute("zonaCSS", "administracion/ofertas")
                    this.portada.portadaUI()
                } else if (granuladoURL.parametros.oferta) {
                    main.setAttribute("zonaCSS", "administracion/ofertas/ofertaUI")
                    this.detallesOferta.obtenerDetallesOferta(granuladoURL.parametros.oferta)
                } else {
                    const info = {
                        titulo: "No existe ninguna oferta con ese identificador",
                        descripcion: "La oferta que buscas con ese identificador no existe.Comprueba el identificador de la reserva"
                    }
                    casaVitini.ui.componentes.mensajeSimple(info)
                }
            },
            portada: {
                portadaUI: async function () {
                    const espacioOfertas = document.querySelector("[componente=espacioOfertas]")
                    const contenedor = document.createElement("div")
                    contenedor.classList.add("gestionDeOfertasContenedor")
                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.classList.add("gestionDeOfertasContenedorBotones")
                    const botonCrearOfertas = document.createElement("a")
                    botonCrearOfertas.classList.add("gestionDeOfertasBotonCrearOferta")
                    botonCrearOfertas.innerText = "Crear una nueva oferta"
                    botonCrearOfertas.setAttribute("href", "/administracion/gestion_de_ofertas/crear_oferta")
                    botonCrearOfertas.setAttribute("vista", "/administracion/gestion_de_ofertas/crear_oferta")
                    botonCrearOfertas.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    contenedorBotones.appendChild(botonCrearOfertas)
                    contenedor.appendChild(contenedorBotones)
                    const contenedorOfertas = document.createElement("div")
                    contenedorOfertas.classList.add("gestionDeOfertasContedorOfertas")
                    contenedorOfertas.setAttribute("componente", "espacioListaOfertas")
                    contenedor.appendChild(contenedorOfertas)
                    espacioOfertas.appendChild(contenedor)
                    const transaccion = {
                        zona: "administracion/ofertas/listasOfertasAdministracion"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const espacioListaOfertas = document.querySelector("[componente=espacioListaOfertas]")

                        const ofertasEncontradas = respuestaServidor?.ok
                        if (typeof ofertasEncontradas === "string") {
                            const ofertaUI = document.createElement("a")
                            ofertaUI.classList.add("ofertaUINoHay")
                            const tituloOferta = document.createElement("p")
                            tituloOferta.classList.add("ofertaUITituloOferta")
                            tituloOferta.innerText = "No hay ofertas configuradas"
                            ofertaUI.appendChild(tituloOferta)
                            espacioListaOfertas.appendChild(ofertaUI)

                        }
                        if (Array.isArray(ofertasEncontradas) && ofertasEncontradas.length > 0) {
                            ofertasEncontradas.forEach((detalleOferta) => {

                                const ofertaUID = detalleOferta.ofertaUID
                                const nombreOferta = detalleOferta.nombreOferta
                                const fechaInicio = detalleOferta.fechaInicio
                                const fechaFinal = detalleOferta.fechaFinal
                                const entidadIDV = detalleOferta.entidadIDV
                                const estadoIDV = detalleOferta.estadoIDV
                                const zonaIDV = detalleOferta.zonaIDV
                                const condicionesArray = detalleOferta.condicionesArray
                                const descuentosJSON = detalleOferta.descuentosJSON

                                const estadoUI = {
                                    activado: "Activada",
                                    desactivado: "Desactivada"
                                }
                                const entidadUI = {
                                    reserva: "Reserva"
                                }
                                const zonaUI = {
                                    global: "Global",
                                    privado: "privado",
                                    publico: "publica"
                                }
                                const ofertaUI = document.createElement("a")
                                ofertaUI.classList.add("ofertaUI")
                                ofertaUI.setAttribute("ofertaUID", ofertaUID)
                                ofertaUI.setAttribute("href", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                ofertaUI.setAttribute("vista", "/administracion/gestion_de_ofertas/oferta:" + ofertaUID)
                                ofertaUI.addEventListener("click", casaVitini.administracion.gestion_de_ofertas.traductorCambioVista)
                                const tituloOferta = document.createElement("p")
                                tituloOferta.classList.add("ofertaUITituloOferta")
                                tituloOferta.innerText = nombreOferta
                                ofertaUI.appendChild(tituloOferta)
                                const contenedorGlobalOferta = document.createElement("div")
                                contenedorGlobalOferta.classList.add("ofertaUIContenedorGlobalOferta")
                                //-------------------------------------
                                const contenedorDetalleOferta = document.createElement("div")
                                contenedorDetalleOferta.classList.add("ofertaUIContenedorDetalles")
                                //-------------------------------------
                                const fechaInicioContenedor = document.createElement("div")
                                fechaInicioContenedor.classList.add("ofertaUIFechaContenedor")
                                const tituloFechaInicio = document.createElement("div")
                                tituloFechaInicio.classList.add("ofertaUITituloFecha")
                                tituloFechaInicio.innerText = "Fecha de inicio"
                                fechaInicioContenedor.appendChild(tituloFechaInicio)
                                const datoFechaInicio = document.createElement("div")
                                datoFechaInicio.classList.add("ofertaUIDatoFecha")
                                datoFechaInicio.innerText = fechaInicio
                                fechaInicioContenedor.appendChild(datoFechaInicio)
                                contenedorDetalleOferta.appendChild(fechaInicioContenedor)
                                const fechaFinContenedor = document.createElement("div")
                                fechaFinContenedor.classList.add("ofertaUIFechaContenedor")
                                const tituloFechaFin = document.createElement("div")
                                tituloFechaFin.classList.add("ofertaUITituloFecha")
                                tituloFechaFin.innerText = "Fecha de fin"
                                fechaFinContenedor.appendChild(tituloFechaFin)
                                const datoFechaFin = document.createElement("div")
                                datoFechaFin.classList.add("ofertaUIDatoFecha")
                                datoFechaFin.innerText = fechaFinal
                                fechaFinContenedor.appendChild(datoFechaFin)
                                contenedorDetalleOferta.appendChild(fechaFinContenedor)
                                contenedorGlobalOferta.appendChild(contenedorDetalleOferta)
                                ofertaUI.appendChild(contenedorGlobalOferta)
                                //--------------------------------------
                                let contenedorPropiedadesOferta = document.createElement("div")
                                contenedorPropiedadesOferta.classList.add("ofertaUIContenedorPropiedades")
                                ///

                                const bloqueEstado = document.createElement("div")
                                bloqueEstado.classList.add("ofertaUIBloqueOpcion")
                                const tituloEstado = document.createElement("p")
                                tituloEstado.classList.add("ofertaUITituloOpcion")
                                tituloEstado.innerText = "Estado de la oferta"
                                bloqueEstado.appendChild(tituloEstado)
                                const estadoUIX = document.createElement("p")
                                estadoUIX.classList.add("ofertaUIDatoOpcion")
                                estadoUIX.innerText = estadoUI[estadoIDV]
                                bloqueEstado.appendChild(estadoUIX)
                                contenedorPropiedadesOferta.appendChild(bloqueEstado)



                                let bloqueOpcion = document.createElement("div")
                                bloqueOpcion.classList.add("ofertaUIBloqueOpcion")
                                let tituloOpcion = document.createElement("p")
                                tituloOpcion.classList.add("ofertaUITituloOpcion")
                                tituloOpcion.innerText = "Entidad"
                                bloqueOpcion.appendChild(tituloOpcion)
                                let datoOpcion = document.createElement("p")
                                datoOpcion.classList.add("ofertaUIDatoOpcion")
                                datoOpcion.innerText = entidadUI[entidadIDV]
                                bloqueOpcion.appendChild(datoOpcion)
                                contenedorPropiedadesOferta.appendChild(bloqueOpcion)


                                tituloOpcion = document.createElement("p")
                                tituloOpcion.classList.add("ofertaUITituloOpcion")
                                tituloOpcion.innerText = "Zona de publicaciÃ³n"
                                bloqueOpcion.appendChild(tituloOpcion)
                                datoOpcion = document.createElement("p")
                                datoOpcion.classList.add("ofertaUIDatoOpcion")
                                datoOpcion.innerText = zonaUI[zonaIDV]
                                bloqueOpcion.appendChild(datoOpcion)

                                contenedorPropiedadesOferta.appendChild(bloqueOpcion)
                                contenedorGlobalOferta.appendChild(contenedorPropiedadesOferta)

                                const contenedorCYD = document.createElement("div")
                                contenedorCYD.classList.add(
                                    "flexVertical",
                                    "gap6"
                                )
                                contenedorCYD.setAttribute("contenedor", "condicionesDescuentos")

                                const condicionesUI = this.condicionesUI({
                                    condicionesArray
                                })
                                contenedorCYD.appendChild(condicionesUI)

                                const descuentoUI = this.descuentosUI({
                                    descuentosJSON
                                })
                                contenedorCYD.appendChild(descuentoUI)

                                contenedorGlobalOferta.appendChild(contenedorCYD)
                                espacioListaOfertas.appendChild(ofertaUI)
                            })
                        }
                    }
                },
                condicionesUI: (data) => {
                    const condicionesArray = data.condicionesArray
                    const contenedorCondiciones = document.createElement("div")
                    contenedorCondiciones.setAttribute("contenedor", "condiciones")
                    contenedorCondiciones.classList.add(
                        "flexVertical",
                        "gap6",
                        "backgroundGrey1",
                        "padding6",
                        "borderRadius14"
                    )
                    const tituloContendor = document.createElement("div")
                    tituloContendor.classList.add(
                        "negrita",
                        "padding6",

                    )
                    tituloContendor.innerText = "Condiciones de la oferta"
                    contenedorCondiciones.appendChild(tituloContendor)

                    condicionesArray.forEach((condicion) => {
                        const tipoCondicion = condicion.tipoCondicion

                        const contenedorCondicion = document.createElement("div")
                        contenedorCondicion.classList.add("contenedorCondicion")
                        contenedorCondicion.setAttribute("tipoCondicion", tipoCondicion)
                        contenedorCondicion.classList.add(
                            "flexVertical",
                            "padding6",
                        )
                        const definicionCondicion = casaVitini
                            .ui
                            .componentes
                            .contenedorFinanciero
                            .componentesUI
                            .ofertas
                            .componentesUI
                            .definicionCondiciones({
                                tipoCondicion,
                                condicion
                            })
                        contenedorCondicion.appendChild(definicionCondicion)
                        contenedorCondiciones.appendChild(contenedorCondicion)
                    })
                    return contenedorCondiciones

                },
                descuentosUI: (data) => {
                    const descuentosJSON = data.descuentosJSON
                    const tipoDescuento = descuentosJSON?.tipoDescuento
                    const subTipoDescuento = descuentosJSON?.subTipoDescuento

                    const contenedorDescuentos = document.createElement("div")
                    contenedorDescuentos.setAttribute("contenedor", "descuentos")
                    contenedorDescuentos.classList.add(
                        "flexVertical",
                        "backgroundGrey1",
                        "padding12",
                        "borderRadius14",
                        "gap6"
                    )
                    const tituloContendor = document.createElement("div")
                    tituloContendor.classList.add(
                        "negrita",

                    )
                    tituloContendor.innerText = "Descuentos de la oferta"
                    contenedorDescuentos.appendChild(tituloContendor)

                    const desfinicionDescuento = casaVitini
                        .ui
                        .componentes
                        .contenedorFinanciero
                        .componentesUI
                        .ofertas
                        .componentesUI.definicionDescuentos({
                            tipoDescuento,
                            subTipoDescuento,
                            descuentosJSON
                        })
                    contenedorDescuentos.appendChild(desfinicionDescuento)

                    return contenedorDescuentos
                },
            },
            crearOferta: {
                arranque: () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/ofertas/ofertaUI")
                    const selector = document.querySelector("[componente=espacioOfertas]")
                    const ofertaUI = casaVitini.administracion.gestion_de_ofertas.detalleUI("crearOferta")
                    selector.appendChild(ofertaUI)
                    selector.setAttribute("modo", "crearOferta")
                    const botonesCrearOferta = casaVitini.administracion.gestion_de_ofertas.componenteUI.botonesCrearOferta()
                    main.appendChild(botonesCrearOferta)
                },
                crearOfertaConfirmar: async () => {

                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const metadatosPantallaCarga = {
                        mensaje: "Creando reserva...",
                        instanciaUID: instanciaUID,
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(metadatosPantallaCarga)
                    const transaccion = casaVitini.administracion.gestion_de_ofertas.utilidades.constructorObjeto()
                    transaccion.zona = "administracion/ofertas/crearOferta"
                    transaccion.entidadIDV = "reserva"


                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const pantallaDeCargaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!pantallaDeCargaRenderizada) {
                        return
                    }
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {

                        const nuevaOferta = respuestaServidor?.oferta.ofertaUID
                        const vista = `/administracion/gestion_de_ofertas/oferta:${nuevaOferta}`
                        const navegacion = {
                            vista: vista,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    }
                },

            },
            detallesOferta: {
                obtenerDetallesOferta: async function (ofertaUID) {
                    const instanciaUID = document.querySelector("main").getAttribute("instanciaUID")
                    const transaccion = {
                        zona: "administracion/ofertas/detallesOferta",
                        ofertaUID: ofertaUID
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada) { return }
                    if (respuestaServidor?.error) {
                        const info = {
                            titulo: "No existe ningÃºna oferta con ese identificador",
                            descripcion: "Revisa el identificador porque esta oferta que buscas no existe.QuizÃ¡s este identificador existiÃ³ y borraste esta oferta.."
                        }
                        casaVitini.ui.componentes.mensajeSimple(info)
                    } else if (respuestaServidor?.ok) {
                        const oferta = respuestaServidor.ok
                        const ofertaUID = oferta.ofertaUID
                        const espacioOfertasGlobal = document.querySelector("[componente=espacioOfertas]")
                        espacioOfertasGlobal.setAttribute("instantanea", JSON.stringify(oferta))
                        espacioOfertasGlobal.setAttribute("ofertaUID", ofertaUID)

                        espacioOfertasGlobal.innerHTML = null
                        const ofertaUI = casaVitini.administracion.gestion_de_ofertas.detalleUI("editarOferta")
                        espacioOfertasGlobal.appendChild(ofertaUI)
                        await this.aplicaData({
                            oferta: oferta,
                            instanciaUID_destino: instanciaUID
                        })
                        const selectorBoton = seccionRenderizada.querySelector("[boton=anadirCondicion]")
                        selectorBoton.removeAttribute("style")
                        const botonesModificacion = casaVitini.administracion.gestion_de_ofertas.componenteUI.botonesDuranteModificacionOferta()
                        espacioOfertasGlobal.appendChild(botonesModificacion)
                    }
                },
                aplicaData: async function (data) {

                    const oferta = data.oferta
                    const instanciaUID_destino = data.instanciaUID_destino
                    const ofertaUI = document.querySelector(`[instanciaUID="${instanciaUID_destino}"]`)

                    const nombreOferta = oferta.nombreOferta
                    const ofertaUID = oferta.ofertaUID
                    const fechaInicio_ISO = oferta.fechaInicio
                    const fechaFinal_ISO = oferta.fechaFinal
                    const condicionesArray = oferta.condicionesArray
                    const descuentosJSON = oferta.descuentosJSON
                    const estadoIDV = oferta.estadoIDV
                    const zonaIDV = oferta.zonaIDV
                    const modo = data.modo || null

                    const fechaInicio_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaInicio_ISO)
                    const fechaFinal_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaFinal_ISO)

                    const espacioOfertasGlobal = ofertaUI.querySelector("[componente=espacioOfertas]")
                    espacioOfertasGlobal.setAttribute("ofertaUID", String(ofertaUID))
                    espacioOfertasGlobal.setAttribute("modo", "editarOferta")

                    //Esto no debe revertirse
                    if (modo !== "resversion") {
                        const selectorEstadoOfertaUI = ofertaUI.querySelector("[componente=estadoOferta]")
                        if (estadoIDV === "desactivado") {
                            selectorEstadoOfertaUI.setAttribute("estadoOferta", estadoIDV)
                            selectorEstadoOfertaUI.style.background = "#ff000091"
                            selectorEstadoOfertaUI.innerHTML = "Oferta desactivada"
                        }
                        if (estadoIDV === "activado") {
                            selectorEstadoOfertaUI.setAttribute("estadoOferta", estadoIDV)
                            selectorEstadoOfertaUI.style.background = "#00ff006e"
                            selectorEstadoOfertaUI.innerHTML = "Oferta activada"
                        }
                    }


                    const campoNombreOferta = ofertaUI.querySelector("[campoOferta=nombreOferta]")
                    campoNombreOferta.value = nombreOferta

                    const selectorFechaInicio = ofertaUI.querySelector("[calendario=entrada]")
                    selectorFechaInicio.setAttribute("memoriaVolatil", fechaInicio_ISO)
                    const selectorFechaInicioUI = ofertaUI.querySelector("[fechaUI=fechaInicio]")
                    selectorFechaInicioUI.innerText = fechaInicio_humana

                    const selectorZonaIDV = ofertaUI.querySelector("[campo=zonaIDV]")
                    selectorZonaIDV.value = zonaIDV

                    const selectorFechaFin = ofertaUI.querySelector("[calendario=salida]")
                    selectorFechaFin.setAttribute("memoriaVolatil", fechaFinal_ISO)
                    const selectorFechaFinUI = ofertaUI.querySelector("[fechaUI=fechaFin]")
                    selectorFechaFinUI.innerText = fechaFinal_humana

                    const contenedorSuperBloque = ofertaUI.querySelector("[contenedor=superBloque]")
                    const spinner = casaVitini.ui.componentes.spinnerSimple()
                    contenedorSuperBloque.appendChild(spinner)


                    const contenedorCondiciones = ofertaUI.querySelector("[contenedor=condiciones]")
                    contenedorCondiciones.style.display = "none"
                    const selectorOfertasRenderizdas = contenedorCondiciones.querySelectorAll("[zonaOferta]")
                    selectorOfertasRenderizdas.forEach((ofertaObsoleta) => ofertaObsoleta.remove())
                    const contenedorDescuentosUI = casaVitini.administracion.gestion_de_ofertas.componenteUI.condicionesUI

                    for (const condicion of condicionesArray) {
                        const tipoCondicion = condicion.tipoCondicion
                        const descuentoUI = contenedorDescuentosUI[tipoCondicion]()

                        if (tipoCondicion === "porNumeroDeApartamentos") {
                            const tipoConteo = condicion.tipoConteo
                            const numeroDeApartamentos = condicion.numeroDeApartamentos

                            const selectorTipoConteo = descuentoUI.querySelector("[campoOferta=tipoConteo]")
                            selectorTipoConteo.value = tipoConteo
                            const selectorNumeroApartamentos = descuentoUI.querySelector("[campoOferta=numeroDeApartamentos]")
                            selectorNumeroApartamentos.value = numeroDeApartamentos
                        } else if (tipoCondicion === "porCodigoDescuento") {
                            const codigoDescuento = condicion.codigoDescuento
                            //const codigoAscii = casaVitini.utilidades.conversor.base64HaciaCadena(codigoDescuento)

                            const selectorCampoCodigo = descuentoUI.querySelector("[campo=codigoDescuento]")
                            selectorCampoCodigo.value = codigoDescuento
                        } else if (tipoCondicion === "porDiasDeAntelacion") {
                            const tipoConteo = condicion.tipoConteo
                            const numeroDeDias = condicion.numeroDeDias

                            const selectorTipoConteo = descuentoUI.querySelector("[campoOferta=tipoConteo]")
                            selectorTipoConteo.value = tipoConteo
                            const selectorNumeroDeDias = descuentoUI.querySelector("[campoOferta=numeroDeDias]")
                            selectorNumeroDeDias.value = numeroDeDias

                        } else if (tipoCondicion === "porDiasDeReserva") {
                            const tipoConteo = condicion.tipoConteo
                            const numeroDeDias = condicion.numeroDeDias

                            const selectorTipoConteo = descuentoUI.querySelector("[campoOferta=tipoConteo]")
                            selectorTipoConteo.value = tipoConteo
                            const selectorNumeroDeDias = descuentoUI.querySelector("[campoOferta=numeroDeDias]")
                            selectorNumeroDeDias.value = numeroDeDias
                        } else if (tipoCondicion === "conFechaCreacionEntreRango") {

                        } else if (tipoCondicion === "conFechaEntradaEntreRango") {
                            const fechaInicioRango_ISO = condicion.fechaInicioRango_ISO
                            const fechaFinalRango_ISO = condicion.fechaFinalRango_ISO

                            const fechaInicioRango_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaInicioRango_ISO)
                            const fechaFinalRango_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaFinalRango_ISO)

                            const selectorEntrada = descuentoUI.querySelector("[calendario=entrada]")
                            const entradaUI = selectorEntrada.querySelector("[fechaUI]")

                            const selectorSalida = descuentoUI.querySelector("[calendario=salida]")
                            const salidaUI = selectorSalida.querySelector("[fechaUI]")

                            selectorEntrada.setAttribute("memoriaVolatil", fechaInicioRango_ISO)
                            selectorSalida.setAttribute("memoriaVolatil", fechaFinalRango_ISO)

                            entradaUI.innerText = fechaInicioRango_humana
                            salidaUI.innerText = fechaFinalRango_humana
                        } else if (tipoCondicion === "porRangoDeFechas") {
                            const fechaInicioRango_ISO = condicion.fechaInicioRango_ISO
                            const fechaFinalRango_ISO = condicion.fechaFinalRango_ISO

                            const fechaInicioRango_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaInicioRango_ISO)
                            const fechaFinalRango_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaFinalRango_ISO)

                            const selectorEntrada = descuentoUI.querySelector("[calendario=entrada]")
                            const entradaUI = selectorEntrada.querySelector("[fechaUI]")

                            const selectorSalida = descuentoUI.querySelector("[calendario=salida]")
                            const salidaUI = selectorSalida.querySelector("[fechaUI]")

                            selectorEntrada.setAttribute("memoriaVolatil", fechaInicioRango_ISO)
                            selectorSalida.setAttribute("memoriaVolatil", fechaFinalRango_ISO)

                            entradaUI.innerText = fechaInicioRango_humana
                            salidaUI.innerText = fechaFinalRango_humana
                        } else if (tipoCondicion === "porApartamentosEspecificos") {
                            const tipoDeEspecificidad = condicion.tipoDeEspecificidad
                            const apartamentos = condicion.apartamentos
                            const instanciaUID = descuentoUI.querySelector("[instanciaUID]").getAttribute("instanciaUID")
                            const selectorTipoEspeficidad = descuentoUI.querySelector("[campo=tipoDeEspecificidad]")
                            selectorTipoEspeficidad.value = tipoDeEspecificidad

                            for (const contenedorApartamento of apartamentos) {
                                const apartamentoIDV = contenedorApartamento.apartamentoIDV
                                const error = `ConfiguracÃ­on de alojamiento inexistente (${apartamentoIDV})`
                                const configuracionDeAlojamiento = await casaVitini.administracion.componentes.obtenerConfiguracionAlojamiento(apartamentoIDV)
                                const apartamentoUI = configuracionDeAlojamiento?.apartamentoUI || error
                                const infoSinApartamento = descuentoUI.querySelector("[componente=infoSinApartamento]")
                                infoSinApartamento.style.display = "none"

                                const selectorApartamentoUI = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.apartamentoUI({
                                    apartamentoIDV,
                                    apartamentoUI,
                                    instanciaUID,
                                    tipoDespliegue: "parcial"
                                })
                                const selectorZonaApartamentos = descuentoUI.querySelector("[componente=zonaAnadirApartamento]")


                                selectorZonaApartamentos.appendChild(selectorApartamentoUI)

                            }
                        }
                        contenedorCondiciones.appendChild(descuentoUI)

                    }
                    casaVitini.administracion.gestion_de_ofertas.componenteUI.controlDespliegeContenedorDescuento()

                    const contenedorDescuentos = ofertaUI.querySelector("[contenedor=descuentos]")
                    contenedorDescuentos.style.display = "none"
                    contenedorDescuentos.innerHTML = null

                    const descuentosUI = casaVitini.administracion.gestion_de_ofertas.componenteUI.contenedorDescuento()
                    contenedorDescuentos.appendChild(descuentosUI)


                    const tipoDescuento = descuentosJSON.tipoDescuento

                    const selectorTipoDescuentos = contenedorDescuentos.querySelector("[componente=tipoDescuento]")
                    selectorTipoDescuentos.value = tipoDescuento

                    casaVitini.administracion.gestion_de_ofertas.componenteUI.controladorDescuentos({
                        descuentoIDV: tipoDescuento
                    })

                    if (tipoDescuento === "totalNeto") {
                        const contenedor = contenedorDescuentos.querySelector("[descuentoIDV=totalNeto]")
                        const descuentoTotal = descuentosJSON.descuentoTotal
                        const tipoAplicacion = descuentosJSON.tipoAplicacion

                        const campoTipoDesceunto = contenedor.querySelector("[campoOferta=tipoDescuento]")
                        campoTipoDesceunto.value = tipoAplicacion

                        const campoDescuentoGlobal = contenedor.querySelector("[campoOferta=descuentoGlobal]")
                        campoDescuentoGlobal.value = descuentoTotal

                    } else if (tipoDescuento === "mismoDescuentoParaCadaApartamento") {
                        const contenedor = contenedorDescuentos.querySelector("[descuentoIDV=mismoDescuentoParaCadaApartamento]")
                        const descuentoTotal = descuentosJSON.descuentoTotal
                        const tipoAplicacion = descuentosJSON.tipoAplicacion

                        const campoTipoDesceunto = contenedor.querySelector("[campoOferta=tipoDescuento]")
                        campoTipoDesceunto.value = tipoAplicacion

                        const campoDescuentoGlobal = contenedor.querySelector("[campoOferta=descuentoGlobal]")
                        campoDescuentoGlobal.value = descuentoTotal

                    } else if (tipoDescuento === "individualPorApartamento") {
                        const apartamentos = descuentosJSON.apartamentos

                        const contenedorApartamentos = contenedorDescuentos.querySelector("[descuentoIDV=individualPorApartamento]")
                        const instanciaUID = contenedorApartamentos.getAttribute("instanciaUID")

                        for (const apartamento of apartamentos) {
                            const apartamentoIDV = apartamento.apartamentoIDV
                            const descuentoTotal = apartamento.descuentoTotal
                            const tipoAplicacion = apartamento.tipoAplicacion
                            const error = `ConfiguracÃ­on de alojamiento inexistente (${apartamentoIDV})`
                            const configuracionDeAlojamiento = await casaVitini.administracion.componentes.obtenerConfiguracionAlojamiento(apartamentoIDV)
                            const apartamentoUI = configuracionDeAlojamiento?.apartamentoUI || error
                            const infoSinApartamento = contenedorApartamentos.querySelector("[componente=infoSinApartamento]")
                            infoSinApartamento.style.display = "none"

                            const selectorApartamentoUI = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.apartamentoUI({
                                apartamentoIDV,
                                apartamentoUI,
                                instanciaUID,
                                tipoDespliegue: "total",
                                seleccionadoInicial: tipoAplicacion,
                                descuentoTotal: descuentoTotal
                            })
                            const selectorZonaApartamentos = contenedorApartamentos.querySelector("[componente=zonaAnadirApartamento]")
                            selectorZonaApartamentos.appendChild(selectorApartamentoUI)
                        }
                    } else if (tipoDescuento === "porRango") {

                        const contenedorPorRango = contenedorDescuentos.querySelector("[descuentoIDV=porRango]")
                        const selectorSubTipo = contenedorPorRango.querySelector("[componente=subTipoDescuento]")

                        const selectorEntrada = contenedorPorRango.querySelector("[calendario=entrada]")
                        const selectorSalida = contenedorPorRango.querySelector("[calendario=salida]")

                        const fechaInicioRango_ISO = descuentosJSON.fechaInicioRango_ISO
                        const fechaFinalRango_ISO = descuentosJSON.fechaFinalRango_ISO

                        const fechaInicioRango_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaInicioRango_ISO)
                        const fechaFinalRango_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaFinalRango_ISO)

                        const entradaUI = selectorEntrada.querySelector("[fechaUI]")
                        const salidaUI = selectorSalida.querySelector("[fechaUI]")

                        selectorEntrada.setAttribute("memoriaVolatil", fechaInicioRango_ISO)
                        selectorSalida.setAttribute("memoriaVolatil", fechaFinalRango_ISO)

                        entradaUI.innerText = fechaInicioRango_humana
                        salidaUI.innerText = fechaFinalRango_humana

                        const subTipoDescuento = descuentosJSON.subTipoDescuento

                        if (subTipoDescuento === "totalNetoPorRango") {
                            const tipoAplicacion = descuentosJSON.tipoAplicacion
                            const descuentoTotal = descuentosJSON.descuentoTotal

                            selectorSubTipo.value = subTipoDescuento
                            casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.componentes.controladorUI({
                                contenedorIDV: subTipoDescuento
                            })

                            const contenedorTotalNetoPorRango = contenedorPorRango.querySelector("[contenedorPorRango=totalNetoPorRango]")
                            const selectorTipoDescuento = contenedorTotalNetoPorRango.querySelector("[campoOferta=tipoDescuento]")
                            selectorTipoDescuento.value = tipoAplicacion

                            const selectorDescuentoGlobal = contenedorTotalNetoPorRango.querySelector("[campoOferta=descuentoGlobal]")
                            selectorDescuentoGlobal.value = descuentoTotal
                        } else if (subTipoDescuento === "porDiasDelRango") {

                            const descuentoPorDias = descuentosJSON.descuentoPorDias
                            const contenedorDias = contenedorPorRango.querySelector("[contenedorPorRango=porDiasDelRango]")
                            contenedorDias.classList.remove("estadoInicialInvisible")
                            contenedorDias.innerHTML = null

                            selectorSubTipo.value = subTipoDescuento

                            for (const detallesDelDia of descuentoPorDias) {
                                const tipoDescuentoDelDia = detallesDelDia.tipoDescuento
                                const fecha = detallesDelDia.fecha

                                const contenedorDia = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.componentes.constructorDiaUI({
                                    fecha: fecha
                                })
                                contenedorDias.appendChild(contenedorDia)

                                const selectorContextoAplicacion = contenedorDia.querySelector("[campoOferta=contextoAplicacion]")
                                selectorContextoAplicacion.value = tipoDescuentoDelDia


                                if (tipoDescuentoDelDia === "netoPorDia") {
                                    const descuentoTotal = detallesDelDia.descuentoTotal
                                    const tipoAplicacion = detallesDelDia.tipoAplicacion

                                    const contenedorNetoDelDia = contenedorDia.querySelector("[contenedorDelDia=netoPorDia]")
                                    contenedorNetoDelDia.classList.remove("estadoInicialInvisible")

                                    const campoDescuentoTotal = contenedorNetoDelDia.querySelector("[campoOferta=descuentoGlobal]")
                                    campoDescuentoTotal.value = descuentoTotal

                                    const selectorTipoDescuento = contenedorNetoDelDia.querySelector("[campoOferta=tipoDescuento]")
                                    selectorTipoDescuento.value = tipoAplicacion

                                } else if (tipoDescuentoDelDia === "netoPorApartamentoDelDia") {
                                    const apartamentos = detallesDelDia.apartamentos

                                    const contenedorNetoPorApartamentoDelDia = contenedorDia.querySelector("[contenedorDelDia=netoPorApartamentoDelDia]")
                                    contenedorNetoPorApartamentoDelDia.classList.remove("estadoInicialInvisible")

                                    for (const apartamento of apartamentos) {
                                        const apartamentoIDV = apartamento.apartamentoIDV
                                        const descuentoTotal = apartamento.descuentoTotal
                                        const tipoAplicacion = apartamento.tipoAplicacion
                                        const error = `ConfiguracÃ­on de alojamiento inexistente (${apartamentoIDV})`
                                        const configuracionDeAlojamiento = await casaVitini.administracion.componentes.obtenerConfiguracionAlojamiento(apartamentoIDV)
                                        const apartamentoUI = configuracionDeAlojamiento?.apartamentoUI || error
                                        const infoSinApartamento = contenedorDia.querySelector("[componente=infoSinApartamento]")
                                        infoSinApartamento.style.display = "none"

                                        const selectorApartamentoUI = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.apartamentoUI({
                                            apartamentoIDV,
                                            apartamentoUI,
                                            instanciaUID: fecha,
                                            tipoDespliegue: "total",
                                            seleccionadoInicial: tipoAplicacion,
                                            descuentoTotal: descuentoTotal
                                        })
                                        const selectorZonaApartamentos = contenedorDia.querySelector("[componente=zonaAnadirApartamento]")
                                        selectorZonaApartamentos.appendChild(selectorApartamentoUI)
                                    }
                                }
                            }
                        }

                        const area = document.querySelector("[contenedor=descuentos] [area=descuentosPorRango]")
                        const contenedorPorDiasDentro = area.querySelector("[contenedorPorRango=porDiasDelRango]")
                        const fechas = casaVitini.utilidades.conversor.extraerFechasInternas(fechaInicioRango_ISO, fechaFinalRango_ISO)

                        for (const fecha of fechas) {
                            const selectorDiaRenderizado = contenedorPorDiasDentro.querySelector(`[instanciaUID="${fecha}"]`)
                            if (!selectorDiaRenderizado) {
                                const contenedorDia = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.componentes.constructorDiaUI({
                                    fecha: fecha
                                })
                                contenedorPorDiasDentro.appendChild(contenedorDia)
                            }
                        }

                    }

                    const selectorSpinnerRenderizado = ofertaUI.querySelector("[contenedor=spinner]")
                    selectorSpinnerRenderizado.remove()

                    const selectorCondicionesRenderizado = ofertaUI.querySelector("[contenedor=condiciones]")
                    selectorCondicionesRenderizado.removeAttribute("style")


                    const selectorDescuentosRenderizado = ofertaUI.querySelector("[contenedor=descuentos]")
                    selectorDescuentosRenderizado.removeAttribute("style")

                },

                ofertaModos: async (modo) => {
                    const contenedorBotones = document.querySelector("[componente=espacioCrearOferta] [contenedor=botones]")

                    if (modo === "modoEditar") {
                        contenedorBotones.innerHTML = null
                        const botones = casaVitini.administracion.gestion_de_ofertas.componenteUI.botonesDuranteModificacionOferta()
                        contenedorBotones.appendChild(botones)
                        document.querySelector("[componente=soloLecturaInfo]")?.classList.remove("elementoOcultoInicialmente")

                    }
                    if (modo === "modoCancelar") {
                        contenedorBotones.innerHTML = null
                        const botones = casaVitini.administracion.gestion_de_ofertas.componenteUI.botonesModificarOferta()
                        contenedorBotones.appendChild(botones)

                        document.querySelector("[componente=soloLecturaInfo]")?.classList.remove("elementoOcultoInicialmente")
                    }
                },
                estadoOferta: async (estadoOferta) => {
                    const ofertaUID = document.querySelector("[ofertaUID]")?.getAttribute("ofertaUID")
                    if (!ofertaUID) {
                        const error = "No se puede cambiar el estado de esta oferta porque no tiene un identificador Ãºnico de oferta (ofertaUID).Esto puede deberse a que aÃºn no has creado la oferta o que la has borrado.Si estÃ¡s creando una oferta, por favor asegÃºrate de crearla pulsando el botÃ³n 'Crear oferta' antes de activarla."
                        casaVitini.ui.componentes.advertenciaInmersiva(error)
                    }
                    const selectorEstadoOfertaUI = document.querySelector("[estadoOferta]")


                    const estadoActualMemoriaVolatil = selectorEstadoOfertaUI.innerText
                    selectorEstadoOfertaUI.innerText = "Esperando al servidor...."
                    const estadoOfertaActual = estadoOferta.target.getAttribute("estadoOferta")
                    let estadoOfertaPropuesto
                    if (estadoOfertaActual === "desactivado") {
                        estadoOfertaPropuesto = "activado"
                    }
                    if (estadoOfertaActual === "activado") {
                        estadoOfertaPropuesto = "desactivado"
                    }
                    const transaccion = {
                        zona: "administracion/ofertas/actualizarEstadoOferta",
                        ofertaUID: String(ofertaUID),
                        estadoIDV: estadoOfertaPropuesto
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        document.querySelector("[estadoOferta]").innerText = estadoActualMemoriaVolatil
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const estadoIDV = respuestaServidor?.estadoIDV
                        selectorEstadoOfertaUI.setAttribute("estadoOferta", estadoIDV)
                        let estadoOfertaUI
                        if (estadoIDV === "activado") {
                            selectorEstadoOfertaUI.style.background = "#00ff006e"
                            estadoOfertaUI = "Oferta activada"
                        }
                        if (estadoIDV === "desactivado") {
                            selectorEstadoOfertaUI.style.background = "#ff000091"
                            estadoOfertaUI = "Oferta desactivada"
                        }
                        selectorEstadoOfertaUI.innerText = estadoOfertaUI
                    }
                },
                guardarCambiosOferta: async function () {
                    const instanciaUID_pantallaEspera = casaVitini.utilidades.codigoFechaInstancia()
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")
                    const ofertaUID = main.querySelector("[componente=espacioOfertas]").getAttribute("ofertaUID")

                    const mensaje = "Actualizando oferta..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID_pantallaEspera,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const oferta = casaVitini.administracion.gestion_de_ofertas.utilidades.constructorObjeto()

                    const transaccion = {
                        zona: "administracion/ofertas/actualizarOferta",
                        ofertaUID: String(ofertaUID),
                        ...oferta
                    }

                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    document.querySelector(`[instanciaUID="${instanciaUID_pantallaEspera}"]`)?.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const ofertaActualizada = respuestaServidor.ofertaActualizada

                        const espacioOfertasGlobal = document.querySelector("[componente=espacioOfertas]")
                        espacioOfertasGlobal.setAttribute("instantanea", JSON.stringify(ofertaActualizada))

                        await casaVitini.administracion.gestion_de_ofertas.detallesOferta.aplicaData({
                            oferta: ofertaActualizada,
                            instanciaUID_destino: instanciaUID
                        })
                    }
                },
                eliminarOferta: {
                    UI: async () => {

                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                        const titulo = constructor.querySelector("[componente=titulo]")
                        titulo.innerText = "Confirmar eliminar oferta"
                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                        mensaje.innerText = "Var a eliminar la oferta y su aplicacion sera inmediata en los precios, Â¿Estas de acuerdo ? "

                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                        botonAceptar.innerText = "Comfirmar la eliminacion"
                        botonAceptar.addEventListener("click", casaVitini.administracion.gestion_de_ofertas.detallesOferta.eliminarOferta.confirmar)
                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                        botonCancelar.innerText = "Cancelar la eliminacion"

                        document.querySelector("main").appendChild(pantallaInmersiva)

                    },
                    confirmar: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Eliminado el oferta..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const ofertaUID = document.querySelector("[ofertaUID]").getAttribute("ofertaUID")
                        const transaccion = {
                            zona: "administracion/ofertas/eliminarOferta",
                            ofertaUID: String(ofertaUID)
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const vista = `/administracion/gestion_de_ofertas`
                            const navegacion = {
                                vista: vista,
                                tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                }
            },
            traductorCambioVista: (oferta) => {
                oferta.preventDefault()
                oferta.stopPropagation()
                const vista = oferta.target.closest("[vista]").getAttribute("vista")
                const entrada = {
                    vista: vista,
                    tipoOrigen: "menuNavegador"
                }
                casaVitini.shell.navegacion.controladorVista(entrada)
            },
            detalleUI: (modoUI) => {
                const instanciaUID_contenedorFechas = casaVitini.utilidades.codigoFechaInstancia()
                const divPrincipal = document.createElement("div");
                divPrincipal.setAttribute("componente", "espacioCrearOferta");
                divPrincipal.classList.add("espacioClientes");

                const divContenedorNombreYEstado = document.createElement("div");

                if (modoUI === "editarOferta") {
                    divContenedorNombreYEstado.classList.add("crearOfertaContenedorHorizontalV2");

                    const botonEstadoOferta = document.createElement("div")
                    botonEstadoOferta.classList.add("creatOfertaBotonEstado")
                    botonEstadoOferta.setAttribute("componente", "estadoOferta")
                    botonEstadoOferta.addEventListener("click", casaVitini.administracion.gestion_de_ofertas.detallesOferta.estadoOferta)
                    botonEstadoOferta.innerText = "Oferta desactivada"
                    divContenedorNombreYEstado.appendChild(botonEstadoOferta)

                }
                if (modoUI === "crearOferta") {
                    divContenedorNombreYEstado.classList.add("crearOfertaContenedorHorizontalModoCrear");
                }
                //Crear el input
                const input = document.createElement("input");
                input.setAttribute("type", "text");
                input.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                input.setAttribute("campoOferta", "nombreOferta");
                input.setAttribute("placeholder", "Escriba un nombre a esta oferta, el nombre sera publico");
                divContenedorNombreYEstado.appendChild(input)
                divPrincipal.appendChild(divContenedorNombreYEstado)
                //Crear el div contenedor

                const titulo = document.createElement("p");
                titulo.classList.add("crearOfertaTituloOpcion");
                titulo.textContent = "Selecciona el rango de fechas de vigencia de la oferta.Este rango determina el inicio y el final de la vigencia de la oferta.Cuando se realiza una reserva, se determina si, en el momento de hacer una reserva, con la fecha de creaciÃ³n, esta, la reserva, puede acceder a la oferta.";
                divPrincipal.appendChild(titulo);

                const divContenedor = document.createElement("div");
                divContenedor.classList.add("administracion_ofertas_crearOfertas_contenedorFecha");
                divContenedor.setAttribute("instanciaUID_contenedorFechas", instanciaUID_contenedorFechas)
                //Crear el primer div contenedor horizontal
                const divContenedorHorizontal = document.createElement("div");
                divContenedorHorizontal.classList.add("crearOfertaContenedorHorizontal");
                //Crear el div contenedor de fecha de inicio
                const divContenedorFechaInicio = document.createElement("div");
                divContenedorFechaInicio.classList.add("contenedorFecha");
                divContenedorFechaInicio.setAttribute("calendario", "entrada");
                divContenedorFechaInicio.setAttribute("componente", "inicioOferta");
                divContenedorFechaInicio.setAttribute("paralizadorEvento", "ocultadorCalendarios");
                divContenedorFechaInicio.addEventListener("click", async () => {
                    await casaVitini.ui.componentes.calendario.configurarCalendario({
                        perfilMes: "calendario_entrada_perfilSimple",
                        contenedorOrigenIDV: "[calendario=entrada]",
                        instanciaUID_contenedorFechas,
                        rangoIDV: "inicioRango",
                        metodoSelectorDia: null
                    })
                })

                //Crear el pÃ¡rrafo de la fecha de inicio
                const pFechaInicio = document.createElement("p");
                pFechaInicio.classList.add("tituloFecha");
                pFechaInicio.textContent = "Fecha de inicio";
                //Crear el pÃ¡rrafo de la fecha de inicio seleccionada
                const pFechaInicioSeleccionada = document.createElement("p");
                pFechaInicioSeleccionada.classList.add("fechaInicio");
                pFechaInicioSeleccionada.setAttribute("fechaUI", "fechaInicio");
                pFechaInicioSeleccionada.textContent = "(Seleccionar)";
                //Agregar los elementos al div contenedor de fecha de inicio
                divContenedorFechaInicio.appendChild(pFechaInicio);
                divContenedorFechaInicio.appendChild(pFechaInicioSeleccionada);
                //Crear el div contenedor de fecha de fin
                const divContenedorFechaFin = document.createElement("div");
                divContenedorFechaFin.classList.add("contenedorFecha");
                divContenedorFechaFin.setAttribute("calendario", "salida");
                divContenedorFechaFin.setAttribute("paralizadorEvento", "ocultadorCalendarios");
                divContenedorFechaFin.setAttribute("componente", "finOferta");

                divContenedorFechaFin.addEventListener("click", async () => {
                    await casaVitini.ui.componentes.calendario.configurarCalendario({
                        perfilMes: "calendario_salida_perfilSimple",
                        contenedorOrigenIDV: "[calendario=salida]",
                        instanciaUID_contenedorFechas,
                        rangoIDV: "finalRango",
                        metodoSelectorDia: null
                    })
                })
                const contenedorZonaOferta = document.createElement("div")
                contenedorZonaOferta.classList.add("contenedorZonaOferta")

                const selectorZonaOferta = document.createElement("select")
                selectorZonaOferta.classList.add(
                    "selector",
                    "textCentrado"
                )
                selectorZonaOferta.setAttribute("campo", "zonaIDV")
                const opcionPredeterminada = document.createElement("option")
                opcionPredeterminada.selected = true
                opcionPredeterminada.disabled = true;
                opcionPredeterminada.value = "no"
                opcionPredeterminada.text = "Zona de la oferta"
                selectorZonaOferta.appendChild(opcionPredeterminada)
                const opciones = [
                    { value: "publica", text: "Zona publica" },
                    { value: "global", text: "Zona global" },
                    { value: "privada", text: "Zona privada" }
                ]
                for (const opcionData of opciones) {
                    const opcion = document.createElement("option");
                    opcion.value = opcionData.value;
                    opcion.text = opcionData.text;
                    selectorZonaOferta.appendChild(opcion);
                }
                contenedorZonaOferta.appendChild(selectorZonaOferta)

                //Crear el pÃ¡rrafo de la fecha de fin
                const pFechaFin = document.createElement("p");
                pFechaFin.classList.add("tituloFecha");
                pFechaFin.textContent = "Fecha fin";
                //Crear el pÃ¡rrafo de la fecha de fin seleccionada
                const pFechaFinSeleccionada = document.createElement("p");
                pFechaFinSeleccionada.classList.add("fechaFin");
                pFechaFinSeleccionada.setAttribute("fechaUI", "fechaFin");
                pFechaFinSeleccionada.textContent = "(Seleccionar)";
                //Agregar los elementos al div contenedor de fecha de fin
                divContenedorFechaFin.appendChild(pFechaFin);
                divContenedorFechaFin.appendChild(pFechaFinSeleccionada);
                //Agregar los elementos al primer div contenedor horizontal
                divContenedorHorizontal.appendChild(divContenedorFechaInicio);
                divContenedorHorizontal.appendChild(contenedorZonaOferta);
                divContenedorHorizontal.appendChild(divContenedorFechaFin);
                //Agregar el primer div contenedor horizontal al div contenedor
                divContenedor.appendChild(divContenedorHorizontal);
                //Agregar el div contenedor al div principal
                divPrincipal.appendChild(divContenedor);
                //Crear el segundo div contenedor

                const botonAnadirCondicion = document.createElement("div")
                botonAnadirCondicion.classList.add("botonV1")
                botonAnadirCondicion.setAttribute("boton", "anadirCondicion")
                if (modoUI === "editarOferta") {
                    botonAnadirCondicion.style.display = "none"
                }
                botonAnadirCondicion.innerText = "AÃ±adir condiciÃ³n"
                botonAnadirCondicion.addEventListener("click", casaVitini.administracion.gestion_de_ofertas.componenteUI.selectorTipoOferta)
                divPrincipal.appendChild(botonAnadirCondicion)

                const contonenedorPropiedades = document.createElement("div")
                contonenedorPropiedades.setAttribute("contenedor", "superBloque")
                contonenedorPropiedades.classList.add(
                    "flexVertical",
                    "gap6"
                )
                divPrincipal.appendChild(contonenedorPropiedades)

                const contenedorCondiciones = document.createElement("div")
                contenedorCondiciones.setAttribute("contenedor", "condiciones")
                contenedorCondiciones.classList.add("contenedorCondiciones")
                contonenedorPropiedades.appendChild(contenedorCondiciones)

                const infoCondiciones = document.createElement("div")
                infoCondiciones.setAttribute("info", "condiciones")
                infoCondiciones.classList.add(
                    "textoCentrado",
                    "padding10"
                )
                infoCondiciones.innerText = "Inserta condiciones a esta oferta."
                contenedorCondiciones.appendChild(infoCondiciones)

                const contenedorDescuentos = document.createElement("div")
                contenedorDescuentos.setAttribute("contenedor", "descuentos")
                contonenedorPropiedades.appendChild(contenedorDescuentos)

                const descuentosUI = casaVitini.administracion.gestion_de_ofertas.componenteUI.contenedorDescuento()
                contenedorDescuentos.appendChild(descuentosUI)

                return divPrincipal
            },
            componenteUI: {
                botonesCrearOferta: () => {
                    const pBotonCrearOferta_O1 = document.createElement("p");
                    pBotonCrearOferta_O1.classList.add("botonV1");
                    pBotonCrearOferta_O1.textContent = "Crear oferta";
                    pBotonCrearOferta_O1.setAttribute("componente", "botonCrearOferta");
                    pBotonCrearOferta_O1.addEventListener("click", casaVitini.administracion.gestion_de_ofertas.crearOferta.crearOfertaConfirmar)
                    return pBotonCrearOferta_O1
                },
                botonesModificarOferta: () => {
                    const botonModificarOferta = document.createElement("div")
                    botonModificarOferta.classList.add("botonV1");
                    botonModificarOferta.setAttribute("componente", "botonEditarOferta");
                    botonModificarOferta.setAttribute("tipoOferta", "conXApartamentosEnConcreto");
                    botonModificarOferta.addEventListener("click", () => {
                        casaVitini.administracion.gestion_de_ofertas.detallesOferta.ofertaModos("modoEditar")
                    })
                    botonModificarOferta.textContent = "Modificar oferta";
                    return botonModificarOferta
                },
                botonesDuranteModificacionOferta: function () {
                    const divBotones_O1 = document.createElement("div");
                    divBotones_O1.classList.add("crearOfertaEpacioBotones");
                    divBotones_O1.setAttribute("componente", "espacioBotones")

                    const pBotonGuardarOferta_O1 = document.createElement("div")
                    pBotonGuardarOferta_O1.classList.add("botonV1");
                    pBotonGuardarOferta_O1.setAttribute("componente", "botonGuardarCambios");
                    pBotonGuardarOferta_O1.setAttribute("tipoOferta", "conXApartamentosEnConcreto");
                    pBotonGuardarOferta_O1.addEventListener("click", casaVitini.administracion.gestion_de_ofertas.detallesOferta.guardarCambiosOferta)
                    pBotonGuardarOferta_O1.textContent = "Actualizar oferta";

                    const pBotonCancelarCambiosOferta_O1 = document.createElement("p");
                    pBotonCancelarCambiosOferta_O1.classList.add("botonV1");
                    pBotonCancelarCambiosOferta_O1.setAttribute("componente", "botonCancelarCambios");
                    pBotonCancelarCambiosOferta_O1.setAttribute("tipoOferta", "conXApartamentosEnConcreto");
                    pBotonCancelarCambiosOferta_O1.addEventListener("click", async () => {
                        const selectorInstantena = document.querySelector("[instantanea]").getAttribute("instantanea")
                        const instantanea = JSON.parse(selectorInstantena)
                        const instanciaUID_destino = document.querySelector(`main[instanciaUID]`).getAttribute("instanciaUID")
                        await casaVitini.administracion.gestion_de_ofertas.detallesOferta.aplicaData({
                            oferta: instantanea,
                            instanciaUID_destino: instanciaUID_destino,
                            modo: "resversion"
                        })
                    })
                    pBotonCancelarCambiosOferta_O1.textContent = "Revertir cambios";

                    const pBotonEliminarOferta_O1 = document.createElement("p");
                    pBotonEliminarOferta_O1.classList.add("botonV1");
                    pBotonEliminarOferta_O1.setAttribute("componente", "botonEliminarOferta");
                    pBotonEliminarOferta_O1.addEventListener("click", casaVitini.administracion.gestion_de_ofertas.detallesOferta.eliminarOferta.UI)
                    pBotonEliminarOferta_O1.textContent = "Eliminar oferta";
                    divBotones_O1.appendChild(pBotonGuardarOferta_O1);
                    divBotones_O1.appendChild(pBotonCancelarCambiosOferta_O1);
                    divBotones_O1.appendChild(pBotonEliminarOferta_O1);
                    return divBotones_O1
                },
                contenedorDescuento: function () {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()

                    const contenedorDescuentos = document.createElement("div");
                    contenedorDescuentos.classList.add("contenedorDescuento");
                    contenedorDescuentos.setAttribute("contenedorDescuento", instanciaUID)
                    contenedorDescuentos.setAttribute("instanciaUID", instanciaUID)

                    //Crear el pÃ¡rrafo dentro del tercer div interno
                    const titulo = document.createElement("p");
                    titulo.classList.add("crearOfertaTituloOpcion");
                    titulo.textContent =
                        "Determina dÃ³nde se aplica el descuento de esta oferta. Este tipo de oferta que has seleccionado se basa en los apartamentos concretos que tiene que escoger el cliente. Es por eso que, aparte de la opciÃ³n de descuento al neto de la reserva, puedes establecer descuentos individuales por apartamento dedicado.";
                    contenedorDescuentos.appendChild(titulo);

                    //Crear el select dentro del tercer div interno
                    const selectorDescuento = document.createElement("select");
                    selectorDescuento.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                    selectorDescuento.setAttribute("campoOferta", "contextoAplicacion");
                    selectorDescuento.setAttribute("componente", "tipoDescuento");
                    selectorDescuento.addEventListener("change", (e) => {
                        const descuentoIDV = e.target.value
                        this.controladorDescuentos({
                            descuentoIDV
                        })
                    })

                    const opcionesSelector = [{
                        nombre: "Â¿Donde se aplica el descuento de esta oferta?",
                        inicial: "si",
                    },
                    {
                        nombre: "AplicaciÃ³n del descuento a cualquier apartamento de la reserva de manera individual.",
                        descuentoIDV: "mismoDescuentoParaCadaApartamento",
                    },
                    {
                        nombre: "AplicaciÃ³n al neto de la reserva.",
                        descuentoIDV: "totalNeto",
                    },
                    {
                        nombre: "AplicaciÃ³n a los dÃ­as dentro de un rango.",
                        descuentoIDV: "porRango",
                    },
                    {
                        nombre: "AplicaciÃ³n individual por apartamento.",
                        descuentoIDV: "individualPorApartamento",
                    },]


                    for (const opcion of opcionesSelector) {

                        const nombre = opcion.nombre
                        const inicial = opcion.inicial
                        const descuentoIDV = opcion.descuentoIDV

                        const opcionUI = document.createElement("option")
                        if (inicial === "si") {
                            opcionUI.selected = true;
                            opcionUI.disabled = true;
                        } else {
                            opcionUI.value = descuentoIDV
                        }
                        opcionUI.textContent = nombre

                        selectorDescuento.appendChild(opcionUI)
                    }
                    contenedorDescuentos.appendChild(selectorDescuento)
                    const descuentoIndividualPorApartmento = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.individualPorApartamento()
                    contenedorDescuentos.appendChild(descuentoIndividualPorApartmento)
                    const descuentoTotalNeto = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.totalNeto()
                    contenedorDescuentos.appendChild(descuentoTotalNeto)
                    const mismoDescuentoParaCadaApartamento = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.mismoDescuentoParaCadaApartamento()
                    contenedorDescuentos.appendChild(mismoDescuentoParaCadaApartamento)
                    const descuentoPorRango = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.arranque()
                    contenedorDescuentos.appendChild(descuentoPorRango)

                    return contenedorDescuentos

                },
                contenedorSelectorApartamentosEspecificos: () => {
                    //Crear el elemento div principal
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const porApartamentoDedicado = document.createElement("div");
                    porApartamentoDedicado.classList.add("contenedorDescuento");
                    porApartamentoDedicado.setAttribute("instanciaUID", instanciaUID)

                    const divCrearOfertaEspacioOpciones_3 = document.createElement("div");
                    divCrearOfertaEspacioOpciones_3.classList.add("crearOfeartaEspacioOpciones");

                    const divCrearOfertaConentenedor4_3 = document.createElement("div");
                    divCrearOfertaConentenedor4_3.setAttribute("controladorDesliegue", "descuentosDedicados");
                    divCrearOfertaConentenedor4_3.setAttribute("parteOferta", "descuentosDedicados");


                    const contenedorSelectorApartamentos = document.createElement("div");
                    contenedorSelectorApartamentos.classList.add("crearOfertaConentenedor");
                    contenedorSelectorApartamentos.setAttribute("parteOferta", "apartamentosDedicados");

                    const pCrearOFertaBotonAnadirApartamento_3 = document.createElement("p");
                    pCrearOFertaBotonAnadirApartamento_3.classList.add("crearOFertaBotonAnadirApartamento");
                    pCrearOFertaBotonAnadirApartamento_3.setAttribute("componente", "botonAnadirApartamentoOferta");
                    pCrearOFertaBotonAnadirApartamento_3.textContent = "AÃ±adir apartamento";
                    pCrearOFertaBotonAnadirApartamento_3.addEventListener("click", (e) => {
                        const data = {
                            e: e,
                            instanciaUID: instanciaUID,
                        }
                        casaVitini.administracion.gestion_de_ofertas.crearOferta.apartamentosDisponibles(data)
                    })
                    contenedorSelectorApartamentos.appendChild(pCrearOFertaBotonAnadirApartamento_3);



                    const divCrearOfertaZonaAnadirApartamento_3 = document.createElement("div");
                    divCrearOfertaZonaAnadirApartamento_3.classList.add("crearOfertaZonaAnadirApartamento");
                    divCrearOfertaZonaAnadirApartamento_3.setAttribute("componente", "zonaAnadirApartamento");

                    const pCrearApartamentoInfoSinApartamento_3 = document.createElement("p");
                    pCrearApartamentoInfoSinApartamento_3.classList.add("crearApartamentoInfoSinApartamento");
                    pCrearApartamentoInfoSinApartamento_3.setAttribute("componente", "infoSinApartamento");
                    pCrearApartamentoInfoSinApartamento_3.textContent =
                        "AÃ±ade apartamentos a esta condiciÃ³n para determinar que apartamentos en concreto tienen que estar en una reserva para acceder a esta oferta";
                    divCrearOfertaZonaAnadirApartamento_3.appendChild(pCrearApartamentoInfoSinApartamento_3);
                    contenedorSelectorApartamentos.appendChild(divCrearOfertaZonaAnadirApartamento_3);
                    divCrearOfertaConentenedor4_3.appendChild(contenedorSelectorApartamentos);

                    divCrearOfertaEspacioOpciones_3.appendChild(divCrearOfertaConentenedor4_3);
                    porApartamentoDedicado.appendChild(divCrearOfertaEspacioOpciones_3);

                    return porApartamentoDedicado

                },
                selectorTipoOferta: () => {

                    const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                    const constructor = pantallaInmersiva.querySelector("[componente=contenedor]")
                    const destino = pantallaInmersiva.querySelector("[destino=inyector]")

                    const tituloUI = document.createElement("p")
                    tituloUI.classList.add("titulo")
                    tituloUI.setAttribute("componente", "titulo")
                    tituloUI.innerText = "AÃ±adir condiciÃ³n"
                    constructor.appendChild(tituloUI)




                    const divContenedorHorizontalTipoOfertas = document.createElement("div");
                    divContenedorHorizontalTipoOfertas.classList.add("crearOfertaContenedorHorizontalTipoOfertas");
                    //Crear las opciones de tipo de oferta

                    const infoReservas = document.createElement("p")
                    infoReservas.classList.add(
                        "negrita",
                        "padding6"
                    )
                    infoReservas.setAttribute("componente", "titulo")
                    infoReservas.innerText = "Condiciones para reservas"
                    constructor.appendChild(infoReservas)



                    const divContenedorTipoOfertas = document.createElement("div");
                    divContenedorTipoOfertas.classList.add("crearOfertaConentenedor");
                    destino.appendChild(divContenedorTipoOfertas);
                    divContenedorTipoOfertas.appendChild(divContenedorHorizontalTipoOfertas);

                    //Crear el pÃ¡rrafo del tÃ­tulo de tipo de oferta
                    const opcionesTipoOferta = [
                        {
                            tipo: "conFechaEntradaEntreRango",
                            titulo: "Con fecha de entrada entre rango.",
                            descripcion: "Aplicar esta oferta cuando la fecha de entrada de una reserva estÃ¡ dentro de un rango de fechas."
                        },
                        {
                            tipo: "conFechaCreacionEntreRango",
                            titulo: "Con fecha de creaciÃ³n entre rango.",
                            descripcion: "Aplicar esta oferta cuando la fecha de creaciÃ³n de una reserva estÃ¡ dentro del rango de vigencia de la oferta."
                        },
                        {
                            tipo: "porNumeroDeApartamentos",
                            titulo: "Por nÃºmero de apartamentos ",
                            descripcion: "Aplicar oferta cuando una reserva cumple con el nÃºmero de apartamentos requeridos por este tipo de condiciÃ³n."
                        },
                        {
                            tipo: "porApartamentosEspecificos",
                            titulo: "Por apartamentos especÃ­ficos ",
                            descripcion: "Aplicar oferta cuando una reserva contiene los apartamentos en especÃ­fico que requiere esta condiciÃ³n."
                        },
                        {
                            tipo: "porDiasDeAntelacion",
                            titulo: "Por dÃ­as de antelaciÃ³n ",
                            descripcion: "Aplicar oferta cuando una reserva cumple con el requisito de los dÃ­as de antelaciÃ³n que requiere la condiciÃ³n."
                        },
                        {
                            tipo: "porDiasDeReserva",
                            titulo: "Por dÃ­as de la reserva",
                            descripcion: "Aplicar oferta cuando una reserva cumple con los requisitos de dÃ­as de duraciÃ³n que requiere la condiciÃ³n."
                        },
                        {
                            tipo: "porRangoDeFechas",
                            titulo: "Por rango de fechas de la reserva",
                            descripcion: "Aplicar esta oferta cuando se realiza una reserva cuyo rango determinado por la fecha de entrada y la fecha de salida se cruza con el rango de duraciÃ³n determinado en esta condiciÃ³n."
                        }, {
                            tipo: "porCodigoDescuento",
                            titulo: "Por cÃ³digo de descuento",
                            descripcion: "Aplicar esta oferta a la reserva que inserte un cÃ³digo de descuento."
                        }
                    ];
                    //Crear las opciones de tipo de oferta y agregarlos al div contenedor horizontal de tipo de ofertas
                    for (const opcion of opcionesTipoOferta) {
                        const tipoOferta = opcion.tipo
                        const divOpcionTipoOferta = document.createElement("div");
                        divOpcionTipoOferta.classList.add("opcionTipoOFerta");
                        divOpcionTipoOferta.setAttribute("tipoOferta", tipoOferta);
                        divOpcionTipoOferta.addEventListener("click", () => {
                            const espacioCrearOferta = document.querySelector("[componente=espacioCrearOferta] [contenedor=condiciones]")
                            const ofertaUI = casaVitini.administracion.gestion_de_ofertas.componenteUI.condicionesUI[tipoOferta]()
                            espacioCrearOferta.appendChild(ofertaUI)
                            casaVitini.administracion.gestion_de_ofertas.componenteUI.controlDespliegeContenedorDescuento()
                            return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                        })
                        const pTituloTipoOferta = document.createElement("p");
                        pTituloTipoOferta.classList.add("crearOfertaTituloTipoOferta");
                        pTituloTipoOferta.textContent = opcion.titulo;
                        divContenedorTipoOfertas.appendChild(pTituloTipoOferta);

                        const pDescripcionTipoOferta = document.createElement("p");
                        pDescripcionTipoOferta.classList.add("crearOfertaDescripcionTipoOferta");
                        pDescripcionTipoOferta.textContent = opcion.descripcion;
                        divOpcionTipoOferta.appendChild(pTituloTipoOferta);
                        divOpcionTipoOferta.appendChild(pDescripcionTipoOferta);
                        divContenedorHorizontalTipoOfertas.appendChild(divOpcionTipoOferta);
                    }

                    const botonCancelar = document.createElement("div")
                    botonCancelar.classList.add("boton")
                    botonCancelar.innerText = "Cerrar y volver al a ediciÃ³n de la oferta"
                    botonCancelar.setAttribute("boton", "cancelar")
                    botonCancelar.addEventListener("click", () => {
                        return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                    })
                    constructor.appendChild(botonCancelar)
                    document.querySelector("main").appendChild(pantallaInmersiva)
                },
                eliminarContenedorCondicion: (tipoCondicion) => {
                    tipoCondicion.target.closest("[zonaOferta]").remove()
                    return casaVitini.administracion.gestion_de_ofertas.componenteUI.controlDespliegeContenedorDescuento()
                },
                controlDespliegeContenedorDescuento: () => {
                    const contenedorCondiciones = document.querySelector("[componente=espacioCrearOferta] [contenedor=condiciones]")
                    const contenedorDescuentos = document.querySelector("[componente=espacioCrearOferta] [contenedor=descuentos]")
                    const ofertasRenderizadas = contenedorCondiciones.querySelectorAll("[zonaOferta]")
                    const selectorContenedorInfoCondiciones = contenedorCondiciones.querySelector("[info=condiciones]")
                    if (ofertasRenderizadas.length > 0) {
                        selectorContenedorInfoCondiciones.style.display = "none"
                    } else {
                        selectorContenedorInfoCondiciones.removeAttribute("style")
                    }
                },
                condicionesUI: {
                    botonEliminarCondicion: () => {
                        const botonBorrarCondicion = document.createElement("p")
                        botonBorrarCondicion.classList.add("botonV1")
                        botonBorrarCondicion.setAttribute("componente", "titulo")
                        botonBorrarCondicion.innerText = "Eliminar condiciÃ³n"
                        botonBorrarCondicion.addEventListener("click", casaVitini.administracion.gestion_de_ofertas.componenteUI.eliminarContenedorCondicion)
                        return botonBorrarCondicion
                    },
                    porNumeroDeApartamentos: function () {
                        const contenedor = document.createElement("div");
                        contenedor.setAttribute("zonaOferta", "porNumeroDeApartamentos");

                        contenedor.classList.add("contenedorCondicion");

                        const contenedorBotonesGlobales = document.createElement("div")
                        contenedorBotonesGlobales.classList.add("contenedorBotonesGlobal")
                        contenedorBotonesGlobales.setAttribute("contenedorEnCondicion", "botones")
                        contenedor.appendChild(contenedorBotonesGlobales)

                        const botonEliminarCondicion = this.botonEliminarCondicion()
                        contenedorBotonesGlobales.appendChild(botonEliminarCondicion)


                        const titulo = document.createElement("p");
                        titulo.classList.add(
                            "textoCentrado",
                            "negrita"
                        );
                        titulo.textContent = "Por nÃºmero de apartamentos";
                        contenedor.appendChild(titulo);


                        const descripcionCondicion = document.createElement("p");
                        descripcionCondicion.classList.add("crearOfertaTituloOpcion");
                        descripcionCondicion.textContent = "Aplicar oferta cuando una reserva cumple con el nÃºmero de apartamentos requeridos por este tipo de condiciÃ³n.";
                        contenedor.appendChild(descripcionCondicion);


                        //Crear el select para el tipo de descuento
                        const seleccionaTipoNumero = document.createElement("select");
                        seleccionaTipoNumero.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        seleccionaTipoNumero.setAttribute("campoOferta", "tipoConteo");
                        //Crear las opciones del select
                        const optionO1 = document.createElement("option");
                        optionO1.selected = true;
                        optionO1.disabled = true;
                        optionO1.setAttribute("value", "");
                        optionO1.textContent = "Selecciona si a partir de o un nÃºmero exacto de apartamentos.";
                        const optionO2 = document.createElement("option");
                        optionO2.value = "numeroExacto";
                        optionO2.textContent = "Con un nÃºmero exacto de apartamentos.";
                        const opcion03 = document.createElement("option");
                        opcion03.value = "aPartirDe";
                        opcion03.textContent = "Hasta un nÃºmero exacto de apartamentos.";
                        const opcion04 = document.createElement("option");
                        opcion04.value = "hastaUnNumeroExacto";
                        opcion04.textContent = "A partir de un nÃºmero exacto de apartamentos.";
                        seleccionaTipoNumero.appendChild(optionO1);
                        seleccionaTipoNumero.appendChild(optionO2);
                        seleccionaTipoNumero.appendChild(opcion03)
                        seleccionaTipoNumero.appendChild(opcion04)
                        contenedor.appendChild(seleccionaTipoNumero);

                        //Crear el input para el nÃºmero de apartamentos
                        const inputNumeroApartamentos_O1 = document.createElement("input");
                        inputNumeroApartamentos_O1.setAttribute("type", "text");
                        inputNumeroApartamentos_O1.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        inputNumeroApartamentos_O1.placeholder = "0";
                        inputNumeroApartamentos_O1.setAttribute("campoOferta", "numeroDeApartamentos");
                        contenedor.appendChild(inputNumeroApartamentos_O1);
                        //Agregar el tÃ­tulo y el input al primer contenedor
                        return contenedor
                    },
                    porCodigoDescuento: function () {
                        //Crear el elemento div principal
                        const contenedor = document.createElement("div");
                        contenedor.classList.add("contenedorCondicion");
                        contenedor.setAttribute("zonaOferta", "porCodigoDescuento");


                        const contenedorBotonesGlobales = document.createElement("div")
                        contenedorBotonesGlobales.classList.add("contenedorBotonesGlobal")
                        contenedorBotonesGlobales.setAttribute("contenedorEnCondicion", "botones")
                        contenedor.appendChild(contenedorBotonesGlobales)


                        const botonEliminarCondicion = this.botonEliminarCondicion()
                        contenedorBotonesGlobales.appendChild(botonEliminarCondicion)


                        const titulo = document.createElement("p");
                        titulo.classList.add(
                            "textoCentrado",
                            "negrita"
                        );
                        titulo.textContent = "Por cÃ³digo de descuento";
                        contenedor.appendChild(titulo);


                        const descripcionCondicion = document.createElement("p");
                        descripcionCondicion.classList.add("crearOfertaTituloOpcion");
                        descripcionCondicion.textContent = "Aplicar esta oferta a la reserva que inserte un cÃ³digo de descuento.";
                        contenedor.appendChild(descripcionCondicion);


                        const campoCodigo = document.createElement("input")
                        campoCodigo.setAttribute("campo", "codigoDescuento")
                        campoCodigo.classList.add("campoTextoSimple")
                        campoCodigo.placeholder = "Escribe el cÃ³digo"
                        contenedor.appendChild(campoCodigo)

                        return contenedor
                    },
                    porDiasDeAntelacion: function () {
                        const contenedor = document.createElement("div");
                        contenedor.setAttribute("zonaOferta", "porDiasDeAntelacion");
                        contenedor.classList.add("contenedorCondicion");

                        const contenedorBotonesGlobales = document.createElement("div")
                        contenedorBotonesGlobales.classList.add("contenedorBotonesGlobal")
                        contenedorBotonesGlobales.setAttribute("contenedorEnCondicion", "botones")
                        contenedor.appendChild(contenedorBotonesGlobales)


                        const botonEliminarCondicion = this.botonEliminarCondicion()
                        contenedorBotonesGlobales.appendChild(botonEliminarCondicion)

                        //Crear el elemento div para el espacio de opciones
                        const divEspacioOpciones_O1 = document.createElement("div");
                        divEspacioOpciones_O1.classList.add("crearOfeartaEspacioOpciones");
                        //Crear el primer contenedor de opciones
                        const divContenedor1_O1 = document.createElement("div");
                        divContenedor1_O1.classList.add("crearOfertaConentenedor");

                        const titulo = document.createElement("p");
                        titulo.classList.add(
                            "textoCentrado",
                            "negrita"
                        );
                        titulo.textContent = "Por dÃ­as de antelaciÃ³n";
                        contenedor.appendChild(titulo);


                        const descripcionCondicion = document.createElement("p");
                        descripcionCondicion.classList.add("crearOfertaTituloOpcion");
                        descripcionCondicion.textContent = "Aplicar oferta cuando una reserva cumple con el requisito de los dÃ­as de antelaciÃ³n que requiere la condiciÃ³n.";
                        contenedor.appendChild(descripcionCondicion);

                        //Crear el select para el tipo de descuento
                        const seleccionaTipoNumero = document.createElement("select");
                        seleccionaTipoNumero.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        seleccionaTipoNumero.setAttribute("campoOferta", "tipoConteo");
                        //Crear las opciones del select
                        const optionO1 = document.createElement("option");
                        optionO1.selected = true;
                        optionO1.disabled = true;
                        optionO1.setAttribute("value", "");
                        optionO1.textContent = "Selecciona si a partir de o un nÃºmero exacto de dÃ­as.";
                        const optionO2 = document.createElement("option");
                        optionO2.value = "numeroExacto";
                        optionO2.textContent = "Con un nÃºmero exacto de dÃ­as de antelaciÃ³n.";
                        const opcion03 = document.createElement("option");
                        opcion03.value = "aPartirDe";
                        opcion03.textContent = "A partir de un nÃºmero exacto de dÃ­as de antelaciÃ³n.";
                        const opcion04 = document.createElement("option");
                        opcion04.value = "hastaUnNumeroExacto";
                        opcion04.textContent = "Hasta un nÃºmero exacto de dÃ­as de antelaciÃ³n.";
                        seleccionaTipoNumero.appendChild(optionO1);
                        seleccionaTipoNumero.appendChild(optionO2);
                        seleccionaTipoNumero.appendChild(opcion03);
                        seleccionaTipoNumero.appendChild(opcion04);
                        divContenedor1_O1.appendChild(seleccionaTipoNumero);

                        //Crear el input para el nÃºmero de apartamentos
                        const inputNumeroApartamentos_O1 = document.createElement("input");
                        inputNumeroApartamentos_O1.setAttribute("type", "text");
                        inputNumeroApartamentos_O1.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        inputNumeroApartamentos_O1.placeholder = "Determina el nÃºmero de dÃ­as de antelaciÃ³n.";
                        inputNumeroApartamentos_O1.setAttribute("campoOferta", "numeroDeDias");
                        //Agregar el tÃ­tulo y el input al primer contenedor
                        divContenedor1_O1.appendChild(inputNumeroApartamentos_O1);



                        //Agregar los contenedores de opciones al espacio de opciones
                        divEspacioOpciones_O1.appendChild(divContenedor1_O1);
                        contenedor.appendChild(divEspacioOpciones_O1);


                        return contenedor
                    },
                    porDiasDeReserva: function () {
                        const contenedor = document.createElement("div");
                        contenedor.setAttribute("zonaOferta", "porDiasDeReserva");
                        contenedor.classList.add("contenedorCondicion");



                        const contenedorBotonesGlobales = document.createElement("div")
                        contenedorBotonesGlobales.classList.add("contenedorBotonesGlobal")
                        contenedorBotonesGlobales.setAttribute("contenedorEnCondicion", "botones")
                        contenedor.appendChild(contenedorBotonesGlobales)



                        const botonEliminarCondicion = this.botonEliminarCondicion()
                        contenedorBotonesGlobales.appendChild(botonEliminarCondicion)

                        //Crear el elemento div para el espacio de opciones
                        const divEspacioOpciones_O1 = document.createElement("div");
                        divEspacioOpciones_O1.classList.add("crearOfeartaEspacioOpciones");
                        //Crear el primer contenedor de opciones
                        const divContenedor1_O1 = document.createElement("div");
                        divContenedor1_O1.classList.add("crearOfertaConentenedor");
                        //Crear el elemento p para el tÃ­tulo de la primera opciÃ³n

                        const titulo = document.createElement("p");
                        titulo.classList.add(
                            "textoCentrado",
                            "negrita"
                        );
                        titulo.textContent = "Por dÃ­as de la reserva";
                        contenedor.appendChild(titulo);


                        const descripcionCondicion = document.createElement("p");
                        descripcionCondicion.classList.add("crearOfertaTituloOpcion");
                        descripcionCondicion.textContent = "Aplicar oferta cuando una reserva cumple con los requisitos de dÃ­as de duraciÃ³n que requiere la condiciÃ³n.";
                        contenedor.appendChild(descripcionCondicion);

                        //Crear el select para el tipo de descuento
                        const seleccionaTipoNumero = document.createElement("select");
                        seleccionaTipoNumero.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        seleccionaTipoNumero.setAttribute("campoOferta", "tipoConteo");
                        //Crear las opciones del select
                        const optionO1 = document.createElement("option");
                        optionO1.selected = true;
                        optionO1.disabled = true;
                        optionO1.setAttribute("value", "");
                        optionO1.textContent = "Selecciona si a partir de o un nÃºmero exacto de dÃ­as con noche.";
                        const optionO2 = document.createElement("option");
                        optionO2.value = "numeroExacto";
                        optionO2.textContent = "Con un nÃºmero exacto de dÃ­as con noche de la reserva.";
                        const opcion03 = document.createElement("option");
                        opcion03.value = "aPartirDe";
                        opcion03.textContent = "AA partir de un nÃºmero exacto de dÃ­as con noche de la reserva.";
                        const opcion04 = document.createElement("option");
                        opcion04.value = "hastaUnNumeroExacto";
                        opcion04.textContent = "Hasta un nÃºmero exacto de dÃ­as con noche de la reserva.";
                        seleccionaTipoNumero.appendChild(optionO1);
                        seleccionaTipoNumero.appendChild(optionO2);
                        seleccionaTipoNumero.appendChild(opcion03);
                        seleccionaTipoNumero.appendChild(opcion04);
                        divEspacioOpciones_O1.appendChild(divContenedor1_O1);

                        //Crear el input para el nÃºmero de apartamentos
                        const inputNumeroApartamentos_O1 = document.createElement("input");
                        inputNumeroApartamentos_O1.setAttribute("type", "text");
                        inputNumeroApartamentos_O1.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        inputNumeroApartamentos_O1.placeholder = "Determina el nÃºmero de dÃ­as con noche de la reserva.";
                        inputNumeroApartamentos_O1.setAttribute("campoOferta", "numeroDeDias");
                        //Agregar el tÃ­tulo y el input al primer contenedor
                        divContenedor1_O1.appendChild(seleccionaTipoNumero);
                        divContenedor1_O1.appendChild(inputNumeroApartamentos_O1);


                        contenedor.appendChild(divEspacioOpciones_O1);

                        return contenedor
                    },
                    conFechaCreacionEntreRango: function () {

                        const contenedor = document.createElement("div");
                        contenedor.setAttribute("zonaOferta", "conFechaCreacionEntreRango");
                        contenedor.classList.add("contenedorCondicion");

                        const contenedorBotonesGlobales = document.createElement("div")
                        contenedorBotonesGlobales.classList.add("contenedorBotonesGlobal")
                        contenedorBotonesGlobales.setAttribute("contenedorEnCondicion", "botones")
                        contenedor.appendChild(contenedorBotonesGlobales)

                        const botonEliminarCondicion = this.botonEliminarCondicion()
                        contenedorBotonesGlobales.appendChild(botonEliminarCondicion)

                        const titulo = document.createElement("p");
                        titulo.classList.add(
                            "textoCentrado",
                            "negrita"
                        );
                        titulo.textContent = "Con fecha de creaciÃ³n entre rango.";
                        contenedor.appendChild(titulo);


                        const descripcionCondicion = document.createElement("p");
                        descripcionCondicion.classList.add("crearOfertaTituloOpcion");
                        descripcionCondicion.textContent = "Aplicar esta oferta cuando la fecha de creaciÃ³n de una reserva estÃ¡ dentro del rango de vigencia de la oferta.";
                        contenedor.appendChild(descripcionCondicion);

                        return contenedor
                    },
                    conFechaEntradaEntreRango: function () {

                        const contenedor = document.createElement("div");
                        contenedor.setAttribute("zonaOferta", "conFechaEntradaEntreRango");
                        contenedor.classList.add("contenedorCondicion");

                        const contenedorBotonesGlobales = document.createElement("div")
                        contenedorBotonesGlobales.classList.add("contenedorBotonesGlobal")
                        contenedorBotonesGlobales.setAttribute("contenedorEnCondicion", "botones")
                        contenedor.appendChild(contenedorBotonesGlobales)

                        const botonEliminarCondicion = this.botonEliminarCondicion()
                        contenedorBotonesGlobales.appendChild(botonEliminarCondicion)

                        const titulo = document.createElement("p");
                        titulo.classList.add(
                            "textoCentrado",
                            "negrita"
                        );
                        titulo.textContent = "Con fecha de entrada entre rango";
                        contenedor.appendChild(titulo);


                        const descripcionCondicion = document.createElement("p");
                        descripcionCondicion.classList.add("crearOfertaTituloOpcion");
                        descripcionCondicion.textContent = "Aplicar esta oferta cuando la fecha de entrada de una reserva estÃ¡ dentro de un rango de fechas.";
                        contenedor.appendChild(descripcionCondicion);

                        const contenedorFechasUI = casaVitini.ui.componentes.componentesComplejos.contenedorFechasUI({
                            modo: "administracion",

                        })
                        contenedor.appendChild(contenedorFechasUI)

                        return contenedor
                    },
                    porRangoDeFechas: function () {

                        const contenedor = document.createElement("div");
                        contenedor.setAttribute("zonaOferta", "porRangoDeFechas");
                        contenedor.classList.add("contenedorCondicion");

                        const contenedorBotonesGlobales = document.createElement("div")
                        contenedorBotonesGlobales.classList.add("contenedorBotonesGlobal")
                        contenedorBotonesGlobales.setAttribute("contenedorEnCondicion", "botones")


                        const botonEliminarCondicion = this.botonEliminarCondicion()
                        contenedorBotonesGlobales.appendChild(botonEliminarCondicion)

                        contenedor.appendChild(contenedorBotonesGlobales)
                        const titulo = document.createElement("p");
                        titulo.classList.add(
                            "textoCentrado",
                            "negrita"
                        );
                        titulo.textContent = "Por rango de fechas de la reserva";
                        contenedor.appendChild(titulo);


                        const descripcionCondicion = document.createElement("p");
                        descripcionCondicion.classList.add("crearOfertaTituloOpcion");
                        descripcionCondicion.textContent = "Aplicar esta oferta cuando se realiza una reserva cuyo rango determinado por la fecha de entrada y la fecha de salida se cruza con el rango de duraciÃ³n determinado en esta condiciÃ³n.";
                        contenedor.appendChild(descripcionCondicion);

                        const contenedorFechasUI = casaVitini.ui.componentes.componentesComplejos.contenedorFechasUI({
                            modo: "administracion",

                        })
                        contenedor.appendChild(contenedorFechasUI)

                        return contenedor
                    },
                    porApartamentosEspecificos: function () {
                        //Crear el elemento div principal
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()

                        const contenedor = document.createElement("div");
                        contenedor.classList.add("contenedorDescuento");
                        //Puede que polemico
                        //  porApartamentoDedicado.setAttribute("instanciaUID", instanciaUID)
                        contenedor.setAttribute("zonaOferta", "porApartamentosEspecificos");


                        const contenedorBotonesGlobales = document.createElement("div")
                        contenedorBotonesGlobales.classList.add("contenedorBotonesGlobal")
                        contenedorBotonesGlobales.setAttribute("contenedorEnCondicion", "botones")
                        contenedor.appendChild(contenedorBotonesGlobales)


                        const botonEliminarCondicion = this.botonEliminarCondicion()
                        contenedorBotonesGlobales.appendChild(botonEliminarCondicion)

                        const titulo = document.createElement("p");
                        titulo.classList.add(
                            "textoCentrado",
                            "negrita"
                        );
                        titulo.textContent = "Por apartamentos especÃ­ficos ";
                        contenedor.appendChild(titulo);


                        const descripcionCondicion = document.createElement("p");
                        descripcionCondicion.classList.add("crearOfertaTituloOpcion");
                        descripcionCondicion.textContent = "Aplicar oferta cuando una reserva contiene los apartamentos en especÃ­fico que requiere esta condiciÃ³n.";
                        contenedor.appendChild(descripcionCondicion);


                        const selector = document.createElement("select")
                        selector.classList.add(
                            "selectorLista")
                        selector.setAttribute("campo", "tipoDeEspecificidad")
                        contenedor.appendChild(selector)

                        const tituloSelector = document.createElement("option")
                        tituloSelector.value = ""
                        tituloSelector.selected = true
                        tituloSelector.disabled = true
                        tituloSelector.text = "Seleccionar el tipo condicional."
                        selector.add(tituloSelector)

                        const tipoExacto = document.createElement("option")
                        tipoExacto.value = "exactamente"
                        tipoExacto.text = "La reserva debe contener exactamente estos apartamentos."
                        selector.add(tipoExacto)

                        const tipoAlguno = document.createElement("option")
                        tipoAlguno.value = "alguno"
                        tipoAlguno.text = "La reserva debe de contener alguno de estos apartamentos."
                        selector.add(tipoAlguno)

                        const tipoExactamenteEntreOtros = document.createElement("option")
                        tipoExactamenteEntreOtros.value = "exactamenteEntreOtros"
                        tipoExactamenteEntreOtros.text = "La reserva debe contener exactamente estos apartamentos y, ademÃ¡s, puede contener otros."
                        selector.add(tipoExactamenteEntreOtros)

                        const tipoNOAlguno = document.createElement("option")
                        tipoNOAlguno.value = "noDebeContenedorAlguno"
                        tipoNOAlguno.text = "La reserva no debe de contener alguno de estos apartamentos."
                        selector.add(tipoNOAlguno)

                        const tipoNOAlgunoExacto = document.createElement("option")
                        tipoNOAlgunoExacto.value = "noDebeContenedorExactamente"
                        tipoNOAlgunoExacto.text = "La reserva no debe de contener exactamente de estos apartamentos."
                        selector.add(tipoNOAlgunoExacto)

                        const tipoNOAlgunoExactoEntreOtros = document.createElement("option")
                        tipoNOAlgunoExactoEntreOtros.value = "noDebeContenedorExactamenteEntreOtros"
                        tipoNOAlgunoExactoEntreOtros.text = "La reserva no debe de contener exactamente de estos apartamentos, entre otros."
                        // selector.add(tipoNOAlgunoExactoEntreOtros)

                        const texto = "AÃ±ade apartamentos a esta condiciÃ³n para determinar quÃ© apartamentos en concreto tienen que estar en una reserva para acceder a esta oferta."

                        const selectorApartamentosEspecificosUI = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.despliegue({
                            textoContenedorVacio: texto,
                            tipoDespliegue: "parcial"
                        })
                        contenedor.appendChild(selectorApartamentosEspecificosUI)
                        return contenedor
                    }

                },
                descuentosUI: {
                    individualPorApartamento: () => {
                        const contenedorDescuento = document.createElement("div");
                        contenedorDescuento.classList.add("crearOfertaConentenedor", "estadoInicialInvisible");
                        contenedorDescuento.setAttribute("descuentoIDV", "individualPorApartamento");

                        const titulo = document.createElement("p");
                        titulo.classList.add("crearOfertaTituloOpcion");
                        titulo.textContent =
                            "AÃ±ade quÃ© apartamentos en concreto debe de seleccionar el cliente para que se aplique esta oferta.";
                        contenedorDescuento.appendChild(titulo);

                        const selectorApartamentosEspecificosUI = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.despliegue({
                            textoContenedorVacio: "No hay ningÃºn apartamento dentro de esta reserva.Pulse el botÃ³n AÃ±adir apartamento para aÃ±adir apartamentos en especÃ­fico.",
                            tipoDespliegue: "total"
                        })
                        contenedorDescuento.appendChild(selectorApartamentosEspecificosUI);
                        return contenedorDescuento
                    },
                    totalNeto: () => {
                        const contenedorDescuento = document.createElement("div");
                        contenedorDescuento.classList.add("crearOfertaConentenedor", "estadoInicialInvisible");
                        contenedorDescuento.setAttribute("descuentoIDV", "totalNeto");

                        const titulo = document.createElement("p");
                        titulo.classList.add("crearOfertaTituloOpcion");
                        titulo.textContent =
                            "Determina si esta oferta serÃ¡ un descuento por porcentaje o una rebaja fija del precio y luego determina esa cantidad.";
                        contenedorDescuento.appendChild(titulo);

                        const selector = document.createElement("select");
                        selector.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        selector.setAttribute("campoOferta", "tipoDescuento");

                        const opcionInicial = document.createElement("option");
                        opcionInicial.selected = true;
                        opcionInicial.disabled = true;
                        opcionInicial.setAttribute("value", "");
                        opcionInicial.textContent = "Selecciona el tipo de descuento";

                        const opcionPorcentaje = document.createElement("option");
                        opcionPorcentaje.value = "porcentaje";
                        opcionPorcentaje.textContent = "Descuento por porcentaje";

                        const opcionCantidad = document.createElement("option");
                        opcionCantidad.value = "cantidadFija";
                        opcionCantidad.textContent = "Descuento por cantidad fija";

                        selector.appendChild(opcionInicial);
                        selector.appendChild(opcionPorcentaje);
                        selector.appendChild(opcionCantidad);
                        contenedorDescuento.appendChild(selector);

                        const campo = document.createElement("input");
                        campo.setAttribute("type", "text");
                        campo.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        campo.setAttribute("placeholder", "00.00");
                        campo.setAttribute("campoOferta", "descuentoGlobal");
                        contenedorDescuento.appendChild(campo);

                        return contenedorDescuento
                    },
                    mismoDescuentoParaCadaApartamento: () => {
                        const contenedorDescuento = document.createElement("div");
                        contenedorDescuento.classList.add("crearOfertaConentenedor", "estadoInicialInvisible");
                        contenedorDescuento.setAttribute("descuentoIDV", "mismoDescuentoParaCadaApartamento");

                        const titulo = document.createElement("p");
                        titulo.classList.add("crearOfertaTituloOpcion");
                        titulo.textContent =
                            "Determina si esta oferta serÃ¡ un descuento para cada apartamento por porcentaje o una rebaja fija del precio y luego determina esa cantidad.";
                        contenedorDescuento.appendChild(titulo);

                        const selector = document.createElement("select");
                        selector.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        selector.setAttribute("campoOferta", "tipoDescuento");

                        const opcionInicial = document.createElement("option");
                        opcionInicial.selected = true;
                        opcionInicial.disabled = true;
                        opcionInicial.setAttribute("value", "");
                        opcionInicial.textContent = "Selecciona el tipo de descuento.";

                        const opcionPorcentaje = document.createElement("option");
                        opcionPorcentaje.value = "porcentaje";
                        opcionPorcentaje.textContent = "Descuento por porcentaje";

                        const opcionCantidad = document.createElement("option");
                        opcionCantidad.value = "cantidadFija";
                        opcionCantidad.textContent = "Descuento por cantidad fija";

                        selector.appendChild(opcionInicial);
                        selector.appendChild(opcionPorcentaje);
                        selector.appendChild(opcionCantidad);
                        contenedorDescuento.appendChild(selector);

                        const campo = document.createElement("input");
                        campo.setAttribute("type", "text");
                        campo.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                        campo.setAttribute("placeholder", "00.00");
                        campo.setAttribute("campoOferta", "descuentoGlobal");
                        contenedorDescuento.appendChild(campo);

                        return contenedorDescuento
                    },
                    porRango: {
                        arranque: () => {
                            const contenedorDescuento = document.createElement("div");
                            contenedorDescuento.classList.add("crearOfertaConentenedor", "estadoInicialInvisible");
                            contenedorDescuento.setAttribute("descuentoIDV", "porRango");
                            contenedorDescuento.setAttribute("area", "descuentosPorRango")

                            const titulo = document.createElement("p");
                            titulo.classList.add("crearOfertaTituloOpcion");
                            titulo.textContent =
                                "Determina el rango de aplicaciÃ³n del descuento.Una vez selecciones el rango.PodrÃ¡s determinar si aplicar un descuento al neto total de la reserva que estÃ© dentro de ese rango.Es decir, los dÃ­as de la reserva con noche que estÃ©n dentro de ese rango.TambiÃ©n puedes aplicar un descuento personalizado dentro de cada dÃ­a con noche.Determinando si el descuento se aplica al neto de un dÃ­a o a apartamentos especÃ­ficos dentro de un dÃ­a.";
                            contenedorDescuento.appendChild(titulo);

                            const contenedorFechasUI = casaVitini.ui.componentes.componentesComplejos.contenedorFechasUI({
                                metodoSelectorDia: "casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.componentes.pasarelaSelectorDia",
                                nombreContenedor: "totalNetoPorRango",
                                modo: "administracion",

                            })
                            contenedorDescuento.appendChild(contenedorFechasUI)

                            const selectorTipoDescuento = document.createElement("select");
                            selectorTipoDescuento.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                            selectorTipoDescuento.setAttribute("campoOferta", "contextoAplicacion");
                            selectorTipoDescuento.setAttribute("componente", "subTipoDescuento");
                            selectorTipoDescuento.addEventListener("change", (e) => {
                                casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.componentes.controladorUI({
                                    contenedorIDV: e.target.value
                                })
                            })
                            const opcionesSelector = [{
                                nombre: "Determina, dentro del rango seleccionado, cÃ³mo se aplica el descuento.",
                                inicial: "si",
                            }, {
                                nombre: "AAplicar descuento al total neto de la suma de los dÃ­as de la reserva dentro del rango.",
                                descuentoIDV: "totalNetoPorRango",
                            }, {
                                nombre: "Aplicar descuentos individuales a los dÃ­as de la reserva dentro del rango.",
                                descuentoIDV: "porDiasDelRango",
                            }]

                            for (const opcion of opcionesSelector) {
                                const nombre = opcion.nombre
                                const inicial = opcion.inicial
                                const descuentoIDV = opcion.descuentoIDV
                                const opcionUI = document.createElement("option")
                                if (inicial === "si") {
                                    opcionUI.selected = true;
                                    opcionUI.disabled = true;
                                } else {
                                    opcionUI.value = descuentoIDV
                                }
                                opcionUI.textContent = nombre
                                selectorTipoDescuento.appendChild(opcionUI)
                            }
                            contenedorDescuento.appendChild(selectorTipoDescuento)

                            const totalNetoPorRango = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.totalNetoPorRango()
                            contenedorDescuento.appendChild(totalNetoPorRango)

                            const porDiasDelRango = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.porDiasDelRango.arranque()
                            contenedorDescuento.appendChild(porDiasDelRango)

                            return contenedorDescuento
                        },
                        infoInicialSinApartametno: () => {
                            const info = document.createElement("p")
                            info.classList.add(
                                "texto",
                                "textoCentrado",
                                "padding6"
                            )
                            info.innerText = "Selecciona un rango de fecha para determinar en quÃ© rango de la reserva se aplicarÃ¡n los descuentos y poder personalizar los dÃ­as."
                            return info
                        },
                        totalNetoPorRango: () => {
                            const contenedor = document.createElement("div")
                            contenedor.classList.add("estadoInicialInvisible", "contenedorInternoPorRango")
                            contenedor.setAttribute("contenedorPorRango", "totalNetoPorRango")

                            const selector = document.createElement("select");
                            selector.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto",);
                            selector.setAttribute("campoOferta", "tipoDescuento");

                            const opcionInicial = document.createElement("option");
                            opcionInicial.selected = true;
                            opcionInicial.disabled = true;
                            opcionInicial.setAttribute("value", "");
                            opcionInicial.textContent = "Selecciona el tipo de descuento al total neto de los dÃ­as de la reserva dentro del rango.";

                            const opcionPorcentaje = document.createElement("option");
                            opcionPorcentaje.value = "porcentaje";
                            opcionPorcentaje.textContent = "Descuento por porcentaje";

                            const opcionCantidad = document.createElement("option");
                            opcionCantidad.value = "cantidadFija";
                            opcionCantidad.textContent = "Descuento por cantidad fija";

                            selector.appendChild(opcionInicial);
                            selector.appendChild(opcionPorcentaje);
                            selector.appendChild(opcionCantidad);
                            contenedor.appendChild(selector);

                            const campo = document.createElement("input");
                            campo.setAttribute("type", "text");
                            campo.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                            campo.setAttribute("placeholder", "00.00");
                            campo.setAttribute("campoOferta", "descuentoGlobal");
                            contenedor.appendChild(campo);

                            return contenedor

                        },
                        porDiasDelRango: {
                            arranque: () => {
                                const contenedor = document.createElement("div")
                                contenedor.setAttribute("contenedor", "porDiasDentroDelRango")
                                contenedor.setAttribute("contenedorPorRango", "porDiasDelRango")
                                contenedor.classList.add("estadoInicialInvisible", "contenedorInternoPorRango")
                                const info = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.infoInicialSinApartametno()
                                contenedor.appendChild(info)
                                return contenedor
                            },
                            totalNetoPorDiaUI: (data) => {
                                const instanciaUID = data.instanciaUID
                                const contenedorOpcionNetoDia = document.createElement("div")
                                contenedorOpcionNetoDia.classList.add(
                                    "estadoInicialInvisible",
                                    "contenedorVertical",
                                    "gap6"
                                )
                                contenedorOpcionNetoDia.setAttribute("contenedorDelDia", "netoPorDia")
                                contenedorOpcionNetoDia.setAttribute("instanciaUID", instanciaUID)
                                const selector = document.createElement("select");
                                selector.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                                selector.setAttribute("campoOferta", "tipoDescuento");

                                const opcionInicial = document.createElement("option");
                                opcionInicial.selected = true;
                                opcionInicial.disabled = true;
                                opcionInicial.setAttribute("value", "");
                                opcionInicial.textContent = "Selecciona el tipo de descuento al total neto de los dÃ­as de la reserva dentro del rango.";

                                const opcionPorcentaje = document.createElement("option");
                                opcionPorcentaje.value = "porcentaje";
                                opcionPorcentaje.textContent = "Descuento por porcentaje";

                                const opcionCantidad = document.createElement("option");
                                opcionCantidad.value = "cantidadFija";
                                opcionCantidad.textContent = "Descuento por cantidad fija";

                                selector.appendChild(opcionInicial);
                                selector.appendChild(opcionPorcentaje);
                                selector.appendChild(opcionCantidad);
                                contenedorOpcionNetoDia.appendChild(selector);

                                const campo = document.createElement("input");
                                campo.setAttribute("type", "text");
                                campo.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                                campo.setAttribute("placeholder", "00.00");
                                campo.setAttribute("campoOferta", "descuentoGlobal");
                                contenedorOpcionNetoDia.appendChild(campo);

                                return contenedorOpcionNetoDia
                            },
                            totalNetoPorApartamentosDelDiaUI: (data) => {
                                const instanciaUID = data.instanciaUID

                                const contenedorPorApartamento = document.createElement("div")
                                contenedorPorApartamento.classList.add(
                                    "estadoInicialInvisible",
                                    "contenedorVertical",
                                    "gap6"
                                )
                                contenedorPorApartamento.setAttribute("contenedorDelDia", "netoPorApartamentoDelDia")
                                contenedorPorApartamento.setAttribute("instanciaUID", instanciaUID)

                                const titulo = document.createElement("p");
                                titulo.classList.add("crearOfertaTituloOpcion");
                                titulo.textContent =
                                    "AAÃ±ade quÃ© apartamentos en concreto debe de seleccionar el cliente para que se aplique esta oferta.";
                                contenedorPorApartamento.appendChild(titulo);
                                const selectorApartamentosEspecificosUI = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.despliegue({
                                    textoContenedorVacio: "AÃ±ade apartamentos a esta condiciÃ³n para determinar quÃ© apartamentos en concreto tienen que estar en una reserva para acceder a esta oferta.",
                                    tipoDespliegue: "total"
                                })
                                contenedorPorApartamento.appendChild(selectorApartamentosEspecificosUI);
                                return contenedorPorApartamento
                            },
                        },
                        infoSinApartamentos: () => {
                            const info = document.createElement("P")
                            info.innerText = "AÃ±ade algÃºn apartamento."
                        },
                        componentes: {
                            pasarelaSelectorDia: function (e) {
                                casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia(e)
                                const area = document.querySelector("[contenedor=descuentos] [area=descuentosPorRango]")
                                const contenedorPorDiasDentro = area.querySelector("[contenedorPorRango=porDiasDelRango]")
                                const fechaInicioRango = area.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                                const fechaFinalRango = area.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")

                                contenedorPorDiasDentro.innerHTML = null
                                if (fechaInicioRango && fechaFinalRango) {
                                    //const fechaInicioRango_ISO = casaVitini.utilidades.conversor.fecha_humana_hacia_ISO(fechaInicioRango)
                                    //const fechaFinalRango_ISO = casaVitini.utilidades.conversor.fecha_humana_hacia_ISO(fechaFinalRango)

                                    const fechas = casaVitini.utilidades.conversor.extraerFechasInternas(fechaInicioRango, fechaFinalRango)

                                    for (const fecha of fechas) {
                                        const selectorDiaRenderizado = contenedorPorDiasDentro.querySelector(`[instanciaUID="${fecha}"]`)
                                        if (!selectorDiaRenderizado) {
                                            const contenedorDia = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.componentes.constructorDiaUI({
                                                fecha: fecha
                                            })
                                            contenedorPorDiasDentro.appendChild(contenedorDia)
                                        }
                                    }
                                } else {
                                    const info = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.infoInicialSinApartametno()
                                    contenedorPorDiasDentro.appendChild(info)
                                }

                            },
                            controladorUI: (data) => {
                                const contenedorIDV = data.contenedorIDV
                                const areaDescuentosPorRano = document.querySelector("[contenedor=descuentos]").querySelector("[area=descuentosPorRango]")
                                const selectorContenedores = areaDescuentosPorRano.querySelectorAll("[contenedorPorRango]")

                                selectorContenedores.forEach((contenedor) => {
                                    contenedor.classList.add("estadoInicialInvisible")
                                })
                                areaDescuentosPorRano.querySelector(`[contenedorPorRango=${contenedorIDV}]`).classList.remove("estadoInicialInvisible")
                            },
                            constructorDiaUI: (data) => {

                                const fecha = data.fecha
                                const tipoDescuento = data.tipoDescuento
                                const fechaDia_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fecha)

                                const contenedorDia = document.createElement("div")
                                contenedorDia.classList.add("contenedorDia")
                                contenedorDia.setAttribute("fechaDelDia", fecha)
                                contenedorDia.setAttribute("contenedor", "dia")
                                contenedorDia.setAttribute("instanciaUID", fecha)

                                const fechaDelDiaUI = document.createElement("p")
                                fechaDelDiaUI.classList.add("texto", "textoCentrado", "negrita", "padding6")
                                fechaDelDiaUI.innerHTML = fechaDia_humana
                                contenedorDia.appendChild(fechaDelDiaUI)

                                const selectorEnDia = document.createElement("select");
                                selectorEnDia.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                                selectorEnDia.setAttribute("campoOferta", "contextoAplicacion");
                                selectorEnDia.addEventListener("change", (e) => {
                                    const areaDia = e.target.closest("[contenedor=dia]")
                                    const conteneodrIDV = e.target.value
                                    const selectoresContenedor = areaDia.querySelectorAll("[contenedorDelDia")
                                    for (const contenedor of selectoresContenedor) {
                                        contenedor.classList.add("estadoInicialInvisible")
                                    }
                                    areaDia.querySelector(`[contenedorDelDia="${conteneodrIDV}"]`).classList.remove("estadoInicialInvisible")
                                })
                                const opcionesSelector = [{
                                    nombre: "Determina, dentro de este dÃ­a, cÃ³mo se aplica un descuento al neto del dÃ­a o por apartamentos del dÃ­a.",
                                    inicial: "si",
                                }, {
                                    nombre: "Aplicar descuento al total neto del dÃ­a.",
                                    descuentoIDV: "netoPorDia",
                                }, {
                                    nombre: "Aplicar descuentos individuales a los apartamientos del dÃ­a.",
                                    descuentoIDV: "netoPorApartamentoDelDia",
                                }]

                                for (const opcion of opcionesSelector) {
                                    const nombre = opcion.nombre
                                    const inicial = opcion.inicial
                                    const descuentoIDV = opcion.descuentoIDV
                                    const opcionUI = document.createElement("option")
                                    if (inicial === "si") {
                                        opcionUI.selected = true;
                                        opcionUI.disabled = true;
                                    } else {
                                        opcionUI.value = descuentoIDV
                                    }
                                    opcionUI.textContent = nombre
                                    selectorEnDia.appendChild(opcionUI)
                                    contenedorDia.appendChild(selectorEnDia)
                                }
                                if (tipoDescuento) {
                                    selectorEnDia.value = tipoDescuento
                                }
                                const totalNetoPorDiaUI = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.porDiasDelRango.totalNetoPorDiaUI({
                                    instanciaUID: fecha
                                })
                                contenedorDia.appendChild(totalNetoPorDiaUI)

                                const totalNetoPorApartametnosDelDiaUI = casaVitini.administracion.gestion_de_ofertas.componenteUI.descuentosUI.porRango.porDiasDelRango.totalNetoPorApartamentosDelDiaUI({
                                    instanciaUID: fecha
                                })
                                contenedorDia.appendChild(totalNetoPorApartametnosDelDiaUI)
                                return contenedorDia
                            }
                        }
                    }
                },
                controladorDescuentos: (data) => {
                    const descuentoIDV = data.descuentoIDV
                    const areaDescuentosUI = document.querySelector("[contenedor=descuentos]")
                    const selectorDescuentosUI = areaDescuentosUI.querySelectorAll("[descuentoIDV]")
                    selectorDescuentosUI.forEach((descuentoUI) => {
                        descuentoUI.classList.add("estadoInicialInvisible")
                    })
                    areaDescuentosUI.querySelector(`[descuentoIDV="${descuentoIDV}"]`)?.classList.remove("estadoInicialInvisible")
                }

            },
            utilidades: {
                constructorObjeto: () => {

                    const nombreOferta = document.querySelector("[campoOferta=nombreOferta]").value
                    const fechaInicio_ISO = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    const fechaFinal_ISO = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")

                    const zonaIDV = document.querySelector("[campo=zonaIDV]").value

                    const contenedorCondiciones = document.querySelector("[contenedor=condiciones]")

                    const oferta = {
                        nombreOferta,
                        zonaIDV,
                        entidadIDV: "reserva",
                        fechaInicio: fechaInicio_ISO,
                        fechaFinal: fechaFinal_ISO,
                        condicionesArray: [],
                        descuentosJSON: {}
                    }
                    const condiciones = contenedorCondiciones.querySelectorAll(`[zonaOferta]`)
                    condiciones.forEach((espacioCondicion) => {
                        const tipoCondicion = espacioCondicion.getAttribute("zonaOferta")
                        const estructuraConficion = {}
                        if (tipoCondicion === "porNumeroDeApartamentos") {
                            const tipoConteo = espacioCondicion.querySelector("[campoOferta=tipoConteo]").value
                            const numeroDeApartamentos = espacioCondicion.querySelector("[campoOferta=numeroDeApartamentos]").value

                            estructuraConficion.tipoCondicion = tipoCondicion
                            estructuraConficion.tipoConteo = tipoConteo
                            estructuraConficion.numeroDeApartamentos = numeroDeApartamentos

                            oferta.condicionesArray.push(estructuraConficion)
                        } else if (tipoCondicion === "porApartamentosEspecificos") {
                            estructuraConficion.tipoCondicion = tipoCondicion
                            const tipoDeEspecificidad = espacioCondicion.querySelector("[campo=tipoDeEspecificidad]").value
                            estructuraConficion.tipoDeEspecificidad = tipoDeEspecificidad
                            estructuraConficion.apartamentos = []

                            const apartamentosSeleccionados = espacioCondicion.querySelectorAll("[apartamentoSeleccionado]")
                            apartamentosSeleccionados.forEach((apartamento) => {
                                const apartamentoIDV = apartamento.getAttribute("apartamentoSeleccionado")
                                estructuraConficion.apartamentos.push({
                                    apartamentoIDV: apartamentoIDV
                                })
                            })
                            oferta.condicionesArray.push(estructuraConficion)

                        } else if (tipoCondicion === "porDiasDeAntelacion") {
                            const tipoConteo = espacioCondicion.querySelector("[campoOferta=tipoConteo]").value
                            const numeroDeDias = espacioCondicion.querySelector("[campoOferta=numeroDeDias]").value

                            estructuraConficion.tipoCondicion = tipoCondicion
                            estructuraConficion.tipoConteo = tipoConteo
                            estructuraConficion.numeroDeDias = numeroDeDias

                            oferta.condicionesArray.push(estructuraConficion)
                        } else if (tipoCondicion === "porDiasDeReserva") {
                            const tipoConteo = espacioCondicion.querySelector("[campoOferta=tipoConteo]").value
                            const numeroDeDias = espacioCondicion.querySelector("[campoOferta=numeroDeDias]").value

                            estructuraConficion.tipoCondicion = tipoCondicion
                            estructuraConficion.tipoConteo = tipoConteo
                            estructuraConficion.numeroDeDias = numeroDeDias
                            oferta.condicionesArray.push(estructuraConficion)

                        } else if (tipoCondicion === "conFechaCreacionEntreRango") {
                            estructuraConficion.tipoCondicion = tipoCondicion
                            oferta.condicionesArray.push(estructuraConficion)
                        } else if (tipoCondicion === "conFechaEntradaEntreRango") {
                            estructuraConficion.tipoCondicion = tipoCondicion

                            const fechaInicioRango_ISO = espacioCondicion.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                            const fechaFinalRango_ISO = espacioCondicion.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")

                            estructuraConficion.fechaInicioRango_ISO = fechaInicioRango_ISO
                            estructuraConficion.fechaFinalRango_ISO = fechaFinalRango_ISO


                            oferta.condicionesArray.push(estructuraConficion)

                        } else if (tipoCondicion === "porRangoDeFechas") {
                            estructuraConficion.tipoCondicion = tipoCondicion

                            const fechaInicioRango_ISO = espacioCondicion.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                            const fechaFinalRango_ISO = espacioCondicion.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")

                            estructuraConficion.fechaInicioRango_ISO = fechaInicioRango_ISO
                            estructuraConficion.fechaFinalRango_ISO = fechaFinalRango_ISO
                            oferta.condicionesArray.push(estructuraConficion)

                        } else if (tipoCondicion === "porCodigoDescuento") {
                            estructuraConficion.tipoCondicion = tipoCondicion
                            const codigoDescuento = espacioCondicion.querySelector("[campo=codigoDescuento]").value
                            estructuraConficion.codigoDescuento = codigoDescuento
                            oferta.condicionesArray.push(estructuraConficion)

                        } else {
                            const error = "No se reconoce el tipo de oferta"
                            return casaVitini.ui.vistas.adver(error)
                        }
                    })


                    const contenedorDescuentos = document.querySelector("[contenedor=descuentos]")
                    const tipoDescuento = contenedorDescuentos.querySelector("[componente=tipoDescuento]")?.value
                    if (tipoDescuento === "totalNeto") {
                        const descuentoTotal = contenedorDescuentos.querySelector(`[descuentoIDV="${tipoDescuento}"] [campoOferta=descuentoGlobal]`).value
                        const tipoAplicacion = contenedorDescuentos.querySelector(`[descuentoIDV="${tipoDescuento}"] [campoOferta=tipoDescuento]`).value

                        const estructuraDescuento = {
                            tipoDescuento: tipoDescuento,
                            tipoAplicacion: tipoAplicacion,
                            descuentoTotal: descuentoTotal
                        }
                        oferta.descuentosJSON = estructuraDescuento
                    } else if (tipoDescuento === "mismoDescuentoParaCadaApartamento") {
                        const descuentoTotal = contenedorDescuentos.querySelector(`[descuentoIDV="${tipoDescuento}"] [campoOferta=descuentoGlobal]`).value
                        const tipoAplicacion = contenedorDescuentos.querySelector(`[descuentoIDV="${tipoDescuento}"] [campoOferta=tipoDescuento]`).value

                        const estructuraDescuento = {
                            tipoDescuento: tipoDescuento,
                            tipoAplicacion: tipoAplicacion,
                            descuentoTotal: descuentoTotal
                        }
                        oferta.descuentosJSON = estructuraDescuento
                    } else if (tipoDescuento === "individualPorApartamento") {
                        const apartamentos = []

                        const apartamentosSeleccionados = contenedorDescuentos.querySelector("[descuentoidv=individualPorApartamento]").querySelectorAll("[apartamentoSeleccionado]")
                        apartamentosSeleccionados.forEach((apartamento) => {
                            const apartamentoIDV = apartamento.getAttribute("apartamentoSeleccionado")
                            const descuentoTotal = apartamento.querySelector("[campoapartamentoseleccionado=descuentoTotal]").value
                            const tipoDescuento = apartamento.querySelector("[campoapartamentoseleccionado=tipoDescuento]").value

                            const estructuraApartamento = {
                                apartamentoIDV,
                                descuentoTotal,
                                tipoAplicacion: tipoDescuento
                            }
                            apartamentos.push(estructuraApartamento)

                        })
                        const estructuraDescuento = {
                            tipoDescuento: tipoDescuento,
                            apartamentos: apartamentos
                        }
                        oferta.descuentosJSON = estructuraDescuento

                    } else if (tipoDescuento === "porRango") {
                        const area = contenedorDescuentos.querySelector("[area=descuentosPorRango]")
                        const fechaInicioRango_ISO = area.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                        const fechaFinalRango_ISO = area.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                        const subTipoDescuento = area.querySelector("[componente=subTipoDescuento]").value
                        //const fechaInicioRango_ISO = casaVitini.utilidades.conversor.fecha_humana_hacia_ISO(fechaInicioRango_humana)
                        //const fechaFinalRango_ISO = casaVitini.utilidades.conversor.fecha_humana_hacia_ISO(fechaFinalRango_humana)
                        const estructuraDescuento = {
                            tipoDescuento: tipoDescuento,
                            fechaInicioRango_ISO: fechaInicioRango_ISO,
                            fechaFinalRango_ISO: fechaFinalRango_ISO,
                            subTipoDescuento: subTipoDescuento,
                        }
                        oferta.descuentosJSON = estructuraDescuento

                        if (subTipoDescuento === "totalNetoPorRango") {
                            const descuentoTotal = area.querySelector("[campoOferta=descuentoGlobal]").value
                            const tipoAplicacion = area.querySelector("[campoOferta=tipoDescuento]").value
                            estructuraDescuento.tipoAplicacion = tipoAplicacion
                            estructuraDescuento.descuentoTotal = descuentoTotal
                        }

                        if (subTipoDescuento === "porDiasDelRango") {
                            estructuraDescuento.descuentoPorDias = []

                            const contenedorPorDiasPorRango = area.querySelectorAll("[contenedor=dia]")
                            contenedorPorDiasPorRango.forEach((dia) => {

                                const fechaDelDia = dia.getAttribute("fechaDelDia")

                                const estructuraDescuentoPorDia = {
                                    fecha: fechaDelDia
                                }
                                const tipoDescuentoEnElDia = dia.querySelector("[campoOferta=contextoAplicacion]").value
                                estructuraDescuentoPorDia.tipoDescuento = tipoDescuentoEnElDia


                                if (tipoDescuentoEnElDia === "netoPorDia") {
                                    const descuentoTotal = dia.querySelector("[campoOferta=descuentoGlobal]").value
                                    const tipoAplicacion = dia.querySelector("[campoOferta=tipoDescuento]").value

                                    estructuraDescuentoPorDia.tipoAplicacion = tipoAplicacion
                                    estructuraDescuentoPorDia.descuentoTotal = descuentoTotal

                                    estructuraDescuento.descuentoPorDias.push(estructuraDescuentoPorDia)

                                } else if (tipoDescuentoEnElDia === "netoPorApartamentoDelDia") {
                                    const contenedorApartamentos = dia.querySelectorAll("[apartamentoSeleccionado]")
                                    estructuraDescuentoPorDia.apartamentos = []

                                    contenedorApartamentos.forEach((apartamento) => {
                                        const aparatmentoIDV = apartamento.getAttribute("apartamentoSeleccionado")
                                        const tipoAplicacion = apartamento.querySelector("[campoApartamentoSeleccionado=tipoDescuento]").value
                                        const descuentoTotal = apartamento.querySelector("[campoApartamentoSeleccionado=descuentoTotal]").value

                                        const descuentoPorApartamento = {
                                            apartamentoIDV: aparatmentoIDV,
                                            tipoAplicacion: tipoAplicacion,
                                            descuentoTotal: descuentoTotal,
                                        }

                                        estructuraDescuentoPorDia.apartamentos.push(descuentoPorApartamento)

                                    })
                                    estructuraDescuento.descuentoPorDias.push(estructuraDescuentoPorDia)

                                }
                            })
                        }
                    }
                    return oferta
                },
            }
        },
        comportamiento_de_precios: {
            arranque: async () => {
                const main = document.querySelector("main")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                if (comandoInicial === "comportamiento_de_precios" && Object.keys(granuladoURL.parametros).length === 0) {

                    main.setAttribute("zonaCSS", "administracion/comportamiento_de_precios")
                    casaVitini.administracion.comportamiento_de_precios.portadaUI()
                } else if (granuladoURL.parametros.comportamiento) {

                    main.setAttribute("zonaCSS", "administracion/comportamiento_de_precios/comportamientoUI")
                    casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.UI(granuladoURL.parametros.comportamiento)
                } else {

                    const info = {
                        titulo: "No existe ninguna reserva con ese identificador",
                        descripcion: "No existe ningÃºn comportamiento de precio con este identificador."
                    }
                    casaVitini.ui.componentes.mensajeSimple(info)
                }

            },
            portadaUI: async () => {
                const espacioOfertas = document.querySelector("[componente=espacioComportamiento]")
                const contenedor = document.createElement("div")
                contenedor.classList.add("gestionDeOfertasContenedor")
                const contenedorBotones = document.createElement("div")
                contenedorBotones.classList.add("gestionDeOfertasContenedorBotones")
                const botonCrearOfertas = document.createElement("a")
                botonCrearOfertas.classList.add("gestionDeOfertasBotonCrearOferta")
                botonCrearOfertas.innerText = "Crear un comportamiento de precios"
                botonCrearOfertas.setAttribute("href", "/administracion/comportamiento_de_precios/crear_comportamiento")
                botonCrearOfertas.setAttribute("vista", "/administracion/comportamiento_de_precios/crear_comportamiento")
                botonCrearOfertas.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                contenedorBotones.appendChild(botonCrearOfertas)
                contenedor.appendChild(contenedorBotones)
                const contenedorOfertas = document.createElement("div")
                contenedorOfertas.classList.add("comportamintoDePreciosSuperBloque")
                contenedorOfertas.setAttribute("componente", "espacioListaOfertas")
                contenedor.appendChild(contenedorOfertas)
                espacioOfertas.appendChild(contenedor)
                const transaccion = {
                    zona: "administracion/comportamientoDePrecios/listaComportamientosPrecios"
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                if (respuestaServidor?.error) {
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    const espacioListaOfertas = document.querySelector("[componente=espacioListaOfertas]")
                    const comportamientosCondigurados = respuestaServidor?.comportamientosDePrecio
                    if (comportamientosCondigurados.length === 0) {
                        const ofertaUI = document.createElement("a")
                        ofertaUI.classList.add("ofertaUINoHay")
                        const tituloOferta = document.createElement("p")
                        tituloOferta.classList.add("ofertaUITituloOferta")
                        tituloOferta.innerText = "No hay ningÃºn comportamiento de precios configurado.Pulsa en el botÃ³n para crear un nuevo comportamiento de precio para crear uno."
                        ofertaUI.appendChild(tituloOferta)
                        espacioListaOfertas.appendChild(ofertaUI)
                        return
                    } else if (comportamientosCondigurados.length > 0) {


                        const comportamientosUI = (data) => {
                            const contenedor = data.contenedor
                            const tipo = contenedor.tipo
                            const comportamientoUID = data.comportamientoUID
                            const nombreComportamiento = data.nombreComportamiento
                            const estadoIDV = data.estadoIDV

                            const objetoEstado = {
                                activado: "Comportamiento activado",
                                desactivado: "Comportamiento desactivado"
                            }

                            const definicionTipo = {
                                porRango: "Basado en el rango de vigencia del comportamiento.",
                                porDias: "Basado en dÃ­as de la semana.",
                                porCreacion: "Basado en el rango de vigencia del comportamiento y el rango de creaciÃ³n."

                            }

                            const descripcionObjeto = {
                                porRango: "Este comportamiento solo se aplica a los dÃ­as con noche que estÃ©n dentro del rango especificado.",
                                porDias: "Este comportamiento se aplica a los dÃ­as con noche de la semana especÃ­ficos.Este comportamiento se aplicarÃ¡ repetidamente hasta que se desactive o elimine.",
                                porCreacion: "Este comportamiento solo se aplica a los dÃ­as con noche que estÃ©n dentro del rango especificado.Siempre que la reserva se halla hecha entre los rangos de creaciÃ³n especificados."

                            }

                            const comportamientoUI = document.createElement("a")
                            comportamientoUI.classList.add("comportamientoUI")
                            comportamientoUI.setAttribute("comportamientoUI", comportamientoUID)
                            comportamientoUI.setAttribute("href", "/administracion/comportamiento_de_precios/comportamiento: " + comportamientoUID)
                            comportamientoUI.setAttribute("vista", "/administracion/comportamiento_de_precios/comportamiento: " + comportamientoUID)
                            comportamientoUI.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.traductorCambioVista)

                            const contenedorTituloEstado = document.createElement("div")
                            contenedorTituloEstado.classList.add("contenedorTituloEstado")

                            const tituloComportamiento = document.createElement("p")
                            tituloComportamiento.classList.add("ofertaUITituloOferta")
                            tituloComportamiento.classList.add("negrita")
                            tituloComportamiento.innerText = nombreComportamiento
                            contenedorTituloEstado.appendChild(tituloComportamiento)

                            const estadoComportamiento = document.createElement("p")
                            estadoComportamiento.classList.add("ofertaUITituloOferta")
                            estadoComportamiento.innerText = objetoEstado[estadoIDV]
                            contenedorTituloEstado.appendChild(estadoComportamiento)


                            const definicionTipoUI = document.createElement("p")
                            definicionTipoUI.classList.add("ofertaUITituloOferta")
                            definicionTipoUI.innerText = definicionTipo[tipo]
                            contenedorTituloEstado.appendChild(definicionTipoUI)

                            comportamientoUI.appendChild(contenedorTituloEstado)

                            const descripcion = document.createElement("p")
                            descripcion.classList.add("contenedorTituloEstado")
                            descripcion.innerText = descripcionObjeto[tipo]
                            comportamientoUI.appendChild(descripcion)


                            if (tipo === "porRango") {
                                const fechaInicio = contenedor.fechaInicio
                                const fechaFinal = contenedor.fechaFinal

                                const contenedorGlobalOferta = document.createElement("div")
                                contenedorGlobalOferta.classList.add("ofertaUIContenedorComportamiento")
                                //-------------------------------------
                                const contenedorDetalleOferta = document.createElement("div")
                                contenedorDetalleOferta.classList.add("ofertaUIContenedorDetalles")
                                //-------------------------------------
                                const fechaInicioContenedor = document.createElement("div")
                                fechaInicioContenedor.classList.add("comportamientoUIFechaContenedor")
                                const tituloFechaInicio = document.createElement("div")
                                tituloFechaInicio.classList.add("ofertaUITituloFecha")
                                tituloFechaInicio.innerText = "Fecha de inicio del comportamiento"
                                fechaInicioContenedor.appendChild(tituloFechaInicio)
                                const datoFechaInicio = document.createElement("div")
                                datoFechaInicio.classList.add("ofertaUIDatoFecha")
                                datoFechaInicio.innerText = fechaInicio
                                fechaInicioContenedor.appendChild(datoFechaInicio)
                                contenedorGlobalOferta.appendChild(fechaInicioContenedor)
                                const fechaFinContenedor = document.createElement("div")
                                fechaFinContenedor.classList.add("comportamientoUIFechaContenedor")
                                const tituloFechaFin = document.createElement("div")
                                tituloFechaFin.classList.add("ofertaUITituloFecha")
                                tituloFechaFin.innerText = "Fecha de fin  del comportamiento"
                                fechaFinContenedor.appendChild(tituloFechaFin)
                                const datoFechaFin = document.createElement("div")
                                datoFechaFin.classList.add("ofertaUIDatoFecha")
                                datoFechaFin.innerText = fechaFinal
                                fechaFinContenedor.appendChild(datoFechaFin)
                                contenedorGlobalOferta.appendChild(fechaFinContenedor)
                                comportamientoUI.appendChild(contenedorGlobalOferta)
                                //--------------------------------------
                                return comportamientoUI
                            } else if (tipo === "porDias") {
                                const diasArray = contenedor.dias
                                const numeroDedias = diasArray.length

                                const contenedorGlobalOferta = document.createElement("div")
                                contenedorGlobalOferta.classList.add("contenedorDiasSelecionados")
                                contenedorGlobalOferta.style.gridTemplateColumns = `repeat(${numeroDedias}, 1fr)`

                                //-------------------------------------
                                const contenedorDetalleOferta = document.createElement("div")
                                contenedorDetalleOferta.classList.add("ofertaUIContenedorDetalles")
                                //-------------------------------------

                                const diasObjeto = {
                                    lunes: "Lunes",
                                    martes: "Martes",
                                    miercoles: "MiÃ©rcoles",
                                    jueves: "Jueves",
                                    viernes: "Viernes",
                                    sabado: "SÃ¡bado",
                                    domingo: "Domingo"
                                }

                                for (const dia of diasArray) {
                                    const contenedorDia = document.createElement("div")
                                    contenedorDia.classList.add("diaSeleciconadoCelda")
                                    contenedorDia.innerText = diasObjeto[dia]
                                    contenedorGlobalOferta.appendChild(contenedorDia)

                                }
                                comportamientoUI.appendChild(contenedorGlobalOferta)
                                return comportamientoUI


                            } else if (tipo === "porCreacion") {
                                const fechaFinal_creacionReserva = contenedor.fechaFinal_creacionReserva
                                const fechaInicio_creacionReserva = contenedor.fechaInicio_creacionReserva

                                const fechaInicio = contenedor.fechaInicio
                                const fechaFinal = contenedor.fechaFinal

                                const contenedorGlobalOferta = document.createElement("div")
                                contenedorGlobalOferta.classList.add("ofertaUIContenedorComportamiento")

                                const fechaInicioContenedor = document.createElement("div")
                                fechaInicioContenedor.classList.add("comportamientoUIFechaContenedor")
                                const tituloFechaInicio = document.createElement("div")
                                tituloFechaInicio.classList.add("ofertaUITituloFecha")
                                tituloFechaInicio.innerText = "Fecha de inicio del comportamiento"
                                fechaInicioContenedor.appendChild(tituloFechaInicio)
                                const datoFechaInicio = document.createElement("div")
                                datoFechaInicio.classList.add("ofertaUIDatoFecha")
                                datoFechaInicio.innerText = fechaInicio
                                fechaInicioContenedor.appendChild(datoFechaInicio)
                                contenedorGlobalOferta.appendChild(fechaInicioContenedor)
                                const fechaFinContenedor = document.createElement("div")
                                fechaFinContenedor.classList.add("comportamientoUIFechaContenedor")
                                const tituloFechaFin = document.createElement("div")
                                tituloFechaFin.classList.add("ofertaUITituloFecha")
                                tituloFechaFin.innerText = "Fecha de fin del comportamiento"
                                fechaFinContenedor.appendChild(tituloFechaFin)
                                const datoFechaFin = document.createElement("div")
                                datoFechaFin.classList.add("ofertaUIDatoFecha")
                                datoFechaFin.innerText = fechaFinal
                                fechaFinContenedor.appendChild(datoFechaFin)
                                contenedorGlobalOferta.appendChild(fechaFinContenedor)
                                comportamientoUI.appendChild(contenedorGlobalOferta)

                                //--------------------------------------
                                const infoCreacion = document.createElement("div")
                                infoCreacion.innerText = "El rango de creacion determina que la fecah de creacion de una reserva, debe de estar dentro de este rango para que se aplique el comportamiento de precio."
                                comportamientoUI.appendChild(infoCreacion)


                                const contenedorRangoCreacion = document.createElement("div")
                                contenedorRangoCreacion.classList.add("ofertaUIContenedorComportamiento")

                                const fechaInicioCreacionContenedor = document.createElement("div")
                                fechaInicioCreacionContenedor.classList.add("comportamientoUIFechaContenedor")

                                const tituloFechaInicioCreacion = document.createElement("div")
                                tituloFechaInicioCreacion.classList.add("ofertaUITituloFecha")
                                tituloFechaInicioCreacion.innerText = "Fecha de inicio del rango de creaciÃ³n"
                                fechaInicioCreacionContenedor.appendChild(tituloFechaInicioCreacion)

                                const datoFechaInicioCreacion = document.createElement("div")
                                datoFechaInicioCreacion.classList.add("ofertaUIDatoFecha")
                                datoFechaInicioCreacion.innerText = fechaFinal_creacionReserva
                                fechaInicioCreacionContenedor.appendChild(datoFechaInicioCreacion)
                                contenedorRangoCreacion.appendChild(fechaInicioCreacionContenedor)

                                const fechaFinContenedorCreacion = document.createElement("div")
                                fechaFinContenedorCreacion.classList.add("comportamientoUIFechaContenedor")

                                const tituloFechaFinCreacion = document.createElement("div")
                                tituloFechaFinCreacion.classList.add("ofertaUITituloFecha")
                                tituloFechaFinCreacion.innerText = "Fecha de fin del rango de creaciÃ³n"
                                fechaFinContenedorCreacion.appendChild(tituloFechaFinCreacion)

                                const datoFechaFinCreacion = document.createElement("div")
                                datoFechaFinCreacion.classList.add("ofertaUIDatoFecha")
                                datoFechaFinCreacion.innerText = fechaInicio_creacionReserva
                                fechaFinContenedorCreacion.appendChild(datoFechaFinCreacion)

                                contenedorRangoCreacion.appendChild(fechaFinContenedorCreacion)
                                comportamientoUI.appendChild(contenedorRangoCreacion)

                                return comportamientoUI
                            }

                        }

                        comportamientosCondigurados.forEach((detallesComportamiento) => {
                            const comportamientoUI = comportamientosUI(detallesComportamiento)

                            espacioListaOfertas.appendChild(comportamientoUI)
                        })
                    }
                }
            },
            crearComportamiento: {
                arranque: () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/comportamiento_de_precios/comportamientoUI")
                    const selector = document.querySelector("[componente=espacioComportamiento]")
                    //const comportamientoUI = 
                    casaVitini.administracion.comportamiento_de_precios.detalleUI("crearOferta")
                    //selector.appendChild(comportamientoUI)
                },
                desplegarOpcionesOferta: (opcionOferta) => {
                    const tipoOferta = opcionOferta.target.closest("[tipoOferta]").getAttribute("tipoOferta")
                    const selectorZonaOferta = document.querySelectorAll("[zonaOferta]")
                    selectorZonaOferta.forEach((zonaOferta) => {
                        zonaOferta.classList.add("estadoInicialInvisible")
                    })
                    document.querySelector(`[zonaOferta=${tipoOferta}]`).classList.remove("estadoInicialInvisible")
                    const selectoresBotonDeplegarOpcionesOferta = document.querySelectorAll("[tipoOferta]")
                    selectoresBotonDeplegarOpcionesOferta.forEach((boton) => {
                        boton.removeAttribute("style")
                    })
                    opcionOferta.target.closest("[tipoOferta]").style.background = "blue"
                    opcionOferta.target.closest("[tipoOferta]").style.color = "white"
                },
                constructorCalendario_antiguo: async (boton) => {
                    const botonID = boton.target.closest("[componente]").getAttribute("componente")
                    const alturaDinamicaArriba = casaVitini.utilidades.observador.medirPorJerarquiaDom.vertical.desdeAbajoDelElemento(boton.target.closest("[componente]"))
                    const bloqueCalendario = document.querySelector("[componente=bloqueCalendario]")
                    const calendario = document.querySelector("[contenedor=calendario]")
                    const fechaEntradaSelecionda = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    const fechaSalidaSelecionda = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const fechaEntradaVolatil_Humana = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoEntrada
                    let mesSeleccionadoEntrada
                    let anoSeleccionadoEntrada
                    let datosFechaEntradaSeleccionada
                    if (fechaEntradaVolatil_Humana) {
                        const fechaEntradaAarray = fechaEntradaVolatil_Humana.split("/")
                        diaSeleccionadoEntrada = Number(fechaEntradaAarray[0])
                        mesSeleccionadoEntrada = Number(fechaEntradaAarray[1])
                        anoSeleccionadoEntrada = Number(fechaEntradaAarray[2])
                    }
                    const fechaSalidaVolatil_Humana = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoSalida
                    let mesSeleccionadoSalida
                    let anoSeleccionadoSalida
                    let datosFechaSalidaSeleccionada
                    if (fechaSalidaVolatil_Humana) {
                        const fechaSaliraArray = fechaSalidaVolatil_Humana.split("/")
                        diaSeleccionadoSalida = Number(fechaSaliraArray[0])
                        mesSeleccionadoSalida = Number(fechaSaliraArray[1])
                        anoSeleccionadoSalida = Number(fechaSaliraArray[2])
                    }
                    if (botonID === "inicioOferta") {
                        if (calendario?.getAttribute("calendarioIO") === "entrada") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                        }
                        if (calendario?.getAttribute("calendarioIO") === "salida") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            //
                        }
                        let resolucionCalendario
                        if (fechaEntradaVolatil_Humana) {
                            resolucionCalendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                mes: Number(mesSeleccionadoEntrada),
                                ano: Number(anoSeleccionadoEntrada)
                            }
                        } else {
                            resolucionCalendario = {
                                tipo: "actual",
                                comando: "construyeObjeto"
                            }
                        }
                        let metadatosCalendario = {
                            tipoFecha: "entrada",
                            almacenamientoCalendarioID: "administracionCalendario",
                            perfilMes: "calendario_entrada_perfilSimple",
                            calendarioIO: "entrada",
                            mensajeInfo: "Selecciona la fecha de inicio en la que el comportamiento se empieza a aplicar.",
                            alturaDinamica: alturaDinamicaArriba,
                            instanciaUID: instanciaUID,
                            metodoSelectorDia: "casaVitini.administracion.comportamiento_de_precios.crearComportamiento.seleccionarDia"
                        }
                        casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(metadatosCalendario)
                        document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                        const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(resolucionCalendario)
                        calendarioResuelto.instanciaUID = instanciaUID
                        await casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                    }
                    if (botonID === "finOferta") {
                        if (calendario?.getAttribute("calendarioIO") === "salida") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                        }
                        if (calendario?.getAttribute("calendarioIO") === "entrada") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            //
                        }
                        let resolucionCalendario
                        if (fechaEntradaSelecionda && !fechaSalidaSelecionda) {
                            fechaEntradaSelecionda = JSON.parse(fechaEntradaSelecionda)
                            let mesEntradaSeleccionado = fechaEntradaSelecionda.mes
                            let anoEntradaSeleccionado = fechaEntradaSelecionda.ano
                            resolucionCalendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                mes: Number(mesEntradaSeleccionado),
                                ano: Number(anoEntradaSeleccionado)
                            }
                        }
                        if (fechaSalidaSelecionda) {
                            fechaSalidaSelecionda = JSON.parse(fechaSalidaSelecionda)
                            let mesSalidaSeleccionado = fechaSalidaSelecionda.mes
                            let anoSalidaSeleccionado = fechaSalidaSelecionda.ano
                            resolucionCalendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                mes: Number(mesSalidaSeleccionado),
                                ano: Number(anoSalidaSeleccionado)
                            }
                        }
                        if (!fechaEntradaSelecionda && !fechaSalidaSelecionda) {
                            resolucionCalendario = {
                                tipo: "actual",
                                comando: "construyeObjeto"
                            }
                        }
                        let metadatosCalendario = {
                            tipoFecha: "salida",
                            almacenamientoCalendarioID: "administracionCalendario",
                            perfilMes: "calendario_salida_perfilSimple",
                            calendarioIO: "salida",
                            mensajeInfo: "Selecciona la fecha final de comportamiento en el que se dejara de aplicar",
                            alturaDinamica: alturaDinamicaArriba,
                            instanciaUID: instanciaUID,
                            metodoSelectorDia: "casaVitini.administracion.comportamiento_de_precios.crearComportamiento.seleccionarDia"
                        }
                        casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(metadatosCalendario)
                        document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                        const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(resolucionCalendario)
                        calendarioResuelto.instanciaUID = instanciaUID
                        casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                    }
                },
                constructorCalendario: async (boton) => {
                    const botonID = boton.target.closest("[componente]").getAttribute("componente")
                    const alturaDinamicaArriba = casaVitini.utilidades.observador.medirPorJerarquiaDom.vertical.desdeAbajoDelElemento(boton.target.closest("[calendario]")) + 20
                    const bloqueCalendario = document.querySelector("[componente=bloqueCalendario]")
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const selectorCalendario = document.querySelector("[contenedor=calendario]")
                    const fechaEntradaVolatil_Humana = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoEntrada
                    let mesSeleccionadoEntrada
                    let anoSeleccionadoEntrada
                    let datosFechaEntradaSeleccionada
                    if (fechaEntradaVolatil_Humana) {
                        const fechaEntradaAarray = fechaEntradaVolatil_Humana.split("/")
                        diaSeleccionadoEntrada = Number(fechaEntradaAarray[0])
                        mesSeleccionadoEntrada = Number(fechaEntradaAarray[1])
                        anoSeleccionadoEntrada = Number(fechaEntradaAarray[2])
                    }
                    const fechaSalidaVolatil_Humana = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoSalida
                    let mesSeleccionadoSalida
                    let anoSeleccionadoSalida
                    let datosFechaSalidaSeleccionada
                    if (fechaSalidaVolatil_Humana) {
                        const fechaSaliraArray = fechaSalidaVolatil_Humana.split("/")
                        diaSeleccionadoSalida = Number(fechaSaliraArray[0])
                        mesSeleccionadoSalida = Number(fechaSaliraArray[1])
                        anoSeleccionadoSalida = Number(fechaSaliraArray[2])
                    }
                    if (botonID === "inicioOferta") {
                        if (selectorCalendario?.getAttribute("calendarioIO") === "salida") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                        }
                        if (selectorCalendario?.getAttribute("calendarioIO") === "entrada") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                        }
                        if (fechaEntradaVolatil_Humana) {
                            const calendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                tipoFecha: "entrada",
                                diaSeleccionado: diaSeleccionadoEntrada,
                                mes: Number(mesSeleccionadoEntrada),
                                ano: Number(anoSeleccionadoEntrada)
                            }
                            const tipoFecha = {
                                tipoFecha: "entrada",
                                almacenamientoCalendarioID: "AdministracionCalendario",
                                perfilMes: "calendario_entrada_perfilSimple",
                                calendarioIO: "entrada",
                                mensajeInfo: "Selecciona una fecha de entrada para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia",
                                seleccionableDiaLimite: "si"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        } else {
                            const calendario = {
                                tipo: "actual",
                                comando: "construyeObjeto",
                                tipoFecha: "entrada",
                                //"diaSeleccionado": almacenamientoAdministracion.Entrada.Dia,
                                //"mes": almacenamientoAdministracion.Entrada.Mes,
                                //"ano": almacenamientoAdministracion.Entrada.Ano
                            }
                            const tipoFecha = {
                                tipoFecha: "entrada",
                                almacenamientoCalendarioID: "administracionCalendario",
                                perfilMes: "calendario_entrada_perfilSimple",
                                calendarioIO: "entrada",
                                mensajeInfo: "Selecciona una fecha de entrada para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia",
                                seleccionableDiaLimite: "si"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        }
                    }
                    if (botonID === "finOferta") {
                        if (selectorCalendario?.getAttribute("calendarioIO") === "salida") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                        }
                        if (selectorCalendario?.getAttribute("calendarioIO") === "entrada") {
                            bloqueCalendario.remove()
                            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            //
                        }
                        if (!fechaEntradaVolatil_Humana && !fechaSalidaVolatil_Humana) {
                            const calendario = {
                                tipo: "actual",
                                comando: "construyeObjeto",
                                tipoFecha: "salida",
                            }
                            const tipoFecha = {
                                tipoFecha: "salida",
                                almacenamientoCalendarioID: "administracionCalendario",
                                perfilMes: "calendario_salida_perfilSimple",
                                calendarioIO: "salida",
                                mensajeInfo: "Selecciona una fecha de salida para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia",
                                seleccionableDiaLimite: "si"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        }
                        if (fechaEntradaVolatil_Humana && !fechaSalidaVolatil_Humana) {
                            const calendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                tipoFecha: "salida",
                                diaSeleccionado: diaSeleccionadoEntrada,
                                mes: Number(mesSeleccionadoEntrada),
                                ano: Number(anoSeleccionadoEntrada)
                            }
                            //let Dia_Entrada_Selecioando = Number(reservaLocal.Entrada.Dia)
                            const tipoFecha = {
                                tipoFecha: "salida",
                                almacenamientoCalendarioID: "administracionCalendario",
                                perfilMes: "calendario_salida_perfilSimple",
                                calendarioIO: "salida",
                                mensajeInfo: "Selecciona una fecha de salida para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia",
                                seleccionableDiaLimite: "si"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.tiempo = "presente"
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        }
                        if (fechaSalidaVolatil_Humana) {
                            const calendario = {
                                tipo: "personalizado",
                                comando: "construyeObjeto",
                                tipoFecha: "salida",
                                diaSeleccionado: diaSeleccionadoSalida,
                                mes: Number(mesSeleccionadoSalida),
                                ano: Number(anoSeleccionadoSalida)
                            }
                            //let Dia_Entrada_Selecioando = Number(reservaLocal.Entrada.Dia)
                            const tipoFecha = {
                                tipoFecha: "salida",
                                almacenamientoCalendarioID: "administracionCalendario",
                                perfilMes: "calendario_salida_perfilSimple",
                                calendarioIO: "salida",
                                mensajeInfo: "Selecciona una fecha de salida para buscar reservas por un rango",
                                alturaDinamica: alturaDinamicaArriba,
                                instanciaUID: instanciaUID,
                                metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia",
                                seleccionableDiaLimite: "si"
                            }
                            casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(tipoFecha)
                            document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                            const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                            calendarioResuelto.instanciaUID = instanciaUID
                            casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                        }
                    }
                },
                seleccionarDia: (dia) => {
                    let diaSeleccionadoComoElemento = dia.target;
                    let calendario = document.querySelector("[componente=bloqueCalendario] [componente=marcoCalendario]")
                    let calendarioIO = calendario.getAttribute("calendarioIO")
                    let diaSeleccionado = dia.target.getAttribute("dia")
                    diaSeleccionado = diaSeleccionado.padStart(2, "0")
                    diaSeleccionado = Number(diaSeleccionado)
                    let anoSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("ano")
                    anoSeleccionado = anoSeleccionado.padStart(4, "0")
                    anoSeleccionado = Number(anoSeleccionado)
                    let mesSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("mes")
                    mesSeleccionado = mesSeleccionado.padStart(2, "0")
                    mesSeleccionado = Number(mesSeleccionado)
                    const fechaSeleccionadaUI = `${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}`
                    let selectorDias = document.querySelectorAll("[calendarioIO] [dia]")
                    selectorDias.forEach((dia) => {
                        //dia.classList.remove("calendarioDiaDisponible")
                        dia.classList.remove("calendarioDiaReserva")
                        dia.classList.remove("calendarioDiaSeleccionado")
                    })
                    if (diaSeleccionadoComoElemento.getAttribute("estadoDia") === "seleccionado") {
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        if (calendarioIO === "entrada") {
                            document.querySelector("[calendario=entrada]").removeAttribute("memoriaVolatil")
                            document.querySelector("[data=fechaInicioData]").innerText = "Seleccionar fecha de entrada"
                        }
                        if (calendarioIO === "salida") {
                            document.querySelector("[calendario=salida]").removeAttribute("memoriaVolatil")
                            document.querySelector("[data=fechaFinData]").innerText = "Seleccionar fecha de salida"
                        }
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        diaSeleccionadoComoElemento.removeAttribute("estadoDia")

                    }
                    let diasDisponibles = document.querySelectorAll("[estado=disponible]")
                    diasDisponibles.forEach(diaDisponible => {
                        diaDisponible.removeAttribute("estadoDia")
                        diaDisponible.style.background = ""
                        diaDisponible.style.color = ""
                    })
                    diaSeleccionadoComoElemento.setAttribute("estadoDia", "seleccionado")
                    diaSeleccionadoComoElemento.classList.add("calendarioDiaSeleccionado")
                    let fechaEntradaSelecionda = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoEntrada
                    let mesSeleccionadoEntrada
                    let anoSeleccionadoEntrada
                    let datosFechaEntradaSeleccionada
                    if (fechaEntradaSelecionda) {
                        const fechaEntradaSelecionda_array = fechaEntradaSelecionda.split("/")
                        diaSeleccionadoEntrada = fechaEntradaSelecionda_array[0]
                        diaSeleccionadoEntrada = Number(diaSeleccionadoEntrada)
                        mesSeleccionadoEntrada = fechaEntradaSelecionda_array[1]
                        mesSeleccionadoEntrada = Number(mesSeleccionadoEntrada)
                        anoSeleccionadoEntrada = fechaEntradaSelecionda_array[2]
                        anoSeleccionadoEntrada = Number(anoSeleccionadoEntrada)
                        datosFechaEntradaSeleccionada = "existen"
                    }
                    let fechaSalidaSelecionda = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoSalida
                    let mesSeleccionadoSalida
                    let anoSeleccionadoSalida
                    let datosFechaSalidaSeleccionada
                    if (fechaSalidaSelecionda) {
                        const fechaSalidaSelecionda_array = fechaSalidaSelecionda.split("/")
                        diaSeleccionadoSalida = fechaSalidaSelecionda_array[0]
                        diaSeleccionadoSalida = Number(diaSeleccionadoSalida)
                        mesSeleccionadoSalida = fechaSalidaSelecionda_array[1]
                        mesSeleccionadoSalida = Number(mesSeleccionadoSalida)
                        anoSeleccionadoSalida = fechaSalidaSelecionda_array[2]
                        anoSeleccionadoSalida = Number(anoSeleccionadoSalida)
                        datosFechaSalidaSeleccionada = "existen"
                    }
                    if (calendarioIO === "entrada") {
                        document.querySelector("[calendario=entrada]").setAttribute("memoriaVolatil", fechaSeleccionadaUI)
                        document.querySelector("[calendario=entrada]").setAttribute("fechaInicioFinal", fechaSeleccionadaUI)
                        document.querySelector("[data=fechaInicioData]").innerText = fechaSeleccionadaUI
                        if (fechaSalidaSelecionda) {
                            if (mesSeleccionadoSalida === mesSeleccionado && anoSeleccionado === anoSeleccionadoSalida) {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado && Number(dia.getAttribute("dia")) <= diaSeleccionadoSalida) {
                                        // dia.classList.remove("calendarioDiaDisponible")
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                    }
                    if (calendarioIO === "salida") {
                        document.querySelector("[calendario=salida]").setAttribute("memoriaVolatil", fechaSeleccionadaUI)
                        document.querySelector("[calendario=salida]").setAttribute("fechaFinFinal", fechaSeleccionadaUI)
                        document.querySelector("[data=fechaFinData]").innerText = fechaSeleccionadaUI
                        if (fechaEntradaSelecionda) {
                            if (mesSeleccionadoEntrada === mesSeleccionado && anoSeleccionado === anoSeleccionadoEntrada) {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado && Number(dia.getAttribute("dia")) >= diaSeleccionadoEntrada) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                    }
                },
                crearComortamientoConfirmar: async function () {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Creando comportamiento de precio..."

                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const contenedorComportamiento = casaVitini.administracion.comportamiento_de_precios.constructorObjeto()

                    const transaccion = {
                        zona: "administracion/comportamientoDePrecios/crearComportamiento",
                        ...contenedorComportamiento
                    }



                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const comportamientoUID = respuestaServidor?.comportamientoUID
                        const vista = `/administracion/comportamiento_de_precios/comportamiento:${comportamientoUID}`
                        const navegacion = {
                            vista: vista,
                            //tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    }
                },
                apartamentosDisponibles: async (data) => {

                    //apartamento.preventDefault()
                    const apartamento = data.e
                    const destino = data.destino

                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                    apartamento.stopPropagation()
                    const selectorMenuObsoleto = document.querySelector("[comMenu=menuVolatilApartamentoDisponbiles]")

                    if (selectorMenuObsoleto) {
                        selectorMenuObsoleto.remove()

                    }
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const alturaDinamica = apartamento.target.getBoundingClientRect().bottom;
                    const horizontalDinamico = apartamento.target.getBoundingClientRect().left;
                    const anchoDinamico = apartamento.target.getBoundingClientRect().width;
                    document.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.crearComportamiento.ocultarMenusVolatiles)
                    const apartamentosUI = document.createElement("div")
                    apartamentosUI.classList.add("crearOfertaMenuVolatilAnadirApartamento")
                    apartamentosUI.setAttribute("comMenu", "menuVolatilApartamentoDisponbiles")
                    apartamentosUI.setAttribute("componente", "menuVolatil")
                    apartamentosUI.setAttribute("instanciaUID", instanciaUID)
                    apartamentosUI.style.top = (alturaDinamica + 6) + "px"
                    apartamentosUI.style.left = (horizontalDinamico) + "px"
                    apartamentosUI.style.maxWidth = 500 + "px"
                    apartamentosUI.innerText = "Obteniendo apartamentos..."
                    document.querySelector("main").appendChild(apartamentosUI)
                    const transaccion = {
                        zona: "administracion/componentes/apartamentosDisponiblesConfigurados"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[componente=menuVolatil][instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    if (respuestaServidor?.error) {
                        instanciaRenderizada.remove()
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        instanciaRenderizada.innerHTML = null
                        const apartamentosDisponibles = respuestaServidor?.ok
                        apartamentosDisponibles.forEach((apartamentoDisponible) => {
                            const apartamentoIDV = apartamentoDisponible.apartamentoIDV
                            const apartamentoUI = apartamentoDisponible.apartamentoUI
                            const estadoUI = apartamentoDisponible.estadoUI
                            const apartamentoDetallesUI = document.createElement("div")
                            apartamentoDetallesUI.classList.add("crearOfertaApartamentoUI")
                            apartamentoDetallesUI.addEventListener("click", (e) => {
                                casaVitini.administracion.comportamiento_de_precios.crearComportamiento.insertarApartamento({
                                    e,
                                    destino: destino
                                })
                            })
                            apartamentoDetallesUI.setAttribute("apartamentoIDV", apartamentoIDV)
                            apartamentoDetallesUI.setAttribute("apartamentoUI", apartamentoUI)
                            apartamentoDetallesUI.setAttribute("apartamentoComoOpcion", apartamentoIDV)
                            const apartamentoTitulo = document.createElement("p")
                            apartamentoTitulo.classList.add("crearOfertaApartamentoTItulo")
                            apartamentoTitulo.innerText = apartamentoUI
                            apartamentoDetallesUI.appendChild(apartamentoTitulo)
                            const apartamentoEstadoUI = document.createElement("p")
                            apartamentoEstadoUI.classList.add("crearOfertaApartamentoEstado")
                            apartamentoEstadoUI.setAttribute("estadouI", estadoUI)
                            apartamentoEstadoUI.innerText = estadoUI
                            apartamentoDetallesUI.appendChild(apartamentoEstadoUI)
                            instanciaRenderizada.appendChild(apartamentoDetallesUI)
                        })
                        const selectorApartamentoYaRenderizado = document.querySelectorAll(`[apartamentoComoOpcion]`)
                        if (selectorApartamentoYaRenderizado.length === 0) {
                            const info = document.createElement("p")
                            info.classList.add("crearApartamentoInfoSinApartamento")
                            info.setAttribute("componente", "infoSinApartamento")
                            info.innerText = "Todos los apartamentos disponibles estÃ¡n insertados en la oferta."
                            instanciaRenderizada.appendChild(info)
                        }
                    }
                },
                ocultarMenusVolatiles: (menuVolatil) => {
                    let componente = menuVolatil?.target.getAttribute("componente")
                    if (componente === "menuDesplegable") {

                    }
                    if (componente !== "menuVolatil") {
                        let selectorMenusVolatiles = document.querySelectorAll("[componente=menuVolatil]")
                        document.removeEventListener("click", casaVitini.administracion.gestion_de_ofertas.crearOferta.ocultarMenusVolatiles)
                        selectorMenusVolatiles.forEach(menuVolatil => {
                            menuVolatil.remove()
                        })
                    }
                },
                insertarApartamento: (data) => {
                    const apartamento = data.e
                    const destino = data.destino
                    const apartamentoIDV = apartamento.target.closest("[apartamentoIDV]").getAttribute("apartamentoIDV")
                    const apartamentoUI = apartamento.target.closest("[apartamentoIDV]").getAttribute("apartamentoUI")
                    const detallesApartamento = {
                        apartamentoIDV: apartamentoIDV,
                        apartamentoUI: apartamentoUI
                    }
                    //Descuento dedicado
                    const opciones = {
                        apartamentoIDV: apartamentoIDV,
                        apartamentoUI: apartamentoUI
                    }
                    const descuentoDedicadoUI = casaVitini.administracion.comportamiento_de_precios.crearComportamiento.insertarOpcionesApartamento(opciones)


                    const zonaDescuentoDedicados = document.querySelector(destino)

                    zonaDescuentoDedicados.style.display = "grid"
                    zonaDescuentoDedicados.appendChild(descuentoDedicadoUI)
                },
                insertarApartamentoUI: async (detallesApartmento) => {
                    let apartamentoIDV = detallesApartmento.apartamentoIDV
                    let apartamentoUI = detallesApartmento.apartamentoUI
                    let apartamentoSeleccionadoUI = document.createElement("div")
                    apartamentoSeleccionadoUI.classList.add("crearOfertaApartamentoSeleccionadoUI")
                    apartamentoSeleccionadoUI.setAttribute("apartamentoSeleccionado", apartamentoIDV)
                    let tituloApartamento = document.createElement("div")
                    tituloApartamento.classList.add("crearOfertaApartamentoSeleccionadoUITitulo")
                    tituloApartamento.innerText = apartamentoUI
                    apartamentoSeleccionadoUI.appendChild(tituloApartamento)
                    let botonEliminarApartamento = document.createElement("div")
                    botonEliminarApartamento.classList.add("crearOfertaBoton")
                    botonEliminarApartamento.innerText = "Eliminar apartamento333"
                    botonEliminarApartamento.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.crearComportamiento.eliminarApartamenro)
                    apartamentoSeleccionadoUI.appendChild(botonEliminarApartamento)
                    return apartamentoSeleccionadoUI
                },
                insertarOpcionesApartamento: (opcionesApartamento) => {
                    const apartamentoIDV = opcionesApartamento.apartamentoIDV
                    const apartamentoUI = opcionesApartamento.apartamentoUI
                    const cantidad = opcionesApartamento.cantidad ? opcionesApartamento.cantidad : null
                    const simboloIDV = opcionesApartamento.simboloIDV ? opcionesApartamento.simboloIDV : null
                    const descuentoDedicadoUI = document.createElement("div")
                    descuentoDedicadoUI.classList.add("crearOfertaApartamentoSeleccionadoUI")
                    descuentoDedicadoUI.setAttribute("descuentoDedicadoUI", apartamentoUI)
                    descuentoDedicadoUI.setAttribute("descuentoDedicadoIDV", apartamentoIDV)
                    descuentoDedicadoUI.setAttribute("apartamentoSeleccionado", apartamentoIDV)
                    descuentoDedicadoUI.setAttribute("contenedor", "apartamentoDedicado")
                    tituloApartamento = document.createElement("div")
                    tituloApartamento.classList.add("crearOfertaDescuentoDedicadoUITitulo")
                    tituloApartamento.innerText = apartamentoUI
                    descuentoDedicadoUI.appendChild(tituloApartamento)
                    const cantidadUI = document.createElement("input")
                    cantidadUI.classList.add("crearOferDescuentoDedicadoCantidad")
                    cantidadUI.setAttribute("campoApartamentoSeleccionado", "cantidad")
                    cantidadUI.placeholder = "Inserta la cantidad"
                    cantidadUI.value = cantidad
                    descuentoDedicadoUI.appendChild(cantidadUI)
                    const tipoDescuento = document.createElement("select")
                    tipoDescuento.classList.add("crearOfertaDescuentoDedicadoListaTipoDescuento")
                    tipoDescuento.setAttribute("campoApartamentoSeleccionado", "simboloIDV")
                    const opcionPredeterminada = document.createElement("option")
                    if (!simboloIDV) {
                        opcionPredeterminada.selected = true;
                    }
                    opcionPredeterminada.disabled = true;
                    opcionPredeterminada.value = "no"
                    opcionPredeterminada.text = "Selecciona el tipo de comportamiento."
                    tipoDescuento.appendChild(opcionPredeterminada)
                    const opciones = [
                        { value: "aumentoPorcentaje", text: "Aumentar precio por porcentaje." },
                        { value: "aumentoCantidad", text: "Aumentar precio por cantidad." },
                        { value: "reducirCantidad", text: "Reducir precio por cantidad" },
                        { value: "reducirPorcentaje", text: "Reducir precio por porcentaje" },
                        { value: "precioEstablecido", text: "Establecer el precio" }
                    ];
                    for (const opcionData of opciones) {
                        const opcion = document.createElement("option");
                        if (simboloIDV === opcionData.value) {
                            opcion.selected = true;
                        }
                        opcion.value = opcionData.value;
                        opcion.text = opcionData.text;
                        opcion.setAttribute("apartamentoIDV", apartamentoIDV);
                        tipoDescuento.appendChild(opcion);
                    }
                    descuentoDedicadoUI.appendChild(tipoDescuento)
                    const botonEliminarApartamento = document.createElement("div")
                    botonEliminarApartamento.classList.add("crearComportamientoBotonEliminarApartamento")
                    botonEliminarApartamento.innerText = "Eliminar apartamento"
                    //botonEliminarApartamento.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.crearComportamiento.eliminarApartamenro)
                    botonEliminarApartamento.addEventListener("click", (e) => {
                        const apartamentoRenderizado = e.target.closest("[apartamentoSeleccionado]")
                        const area = e.target.closest("[componente=zonaAnadirApartamento]")
                        apartamentoRenderizado.remove()

                        const conteoApartamentos = area.querySelectorAll(`[apartamentoSeleccionado]`)
                        if (conteoApartamentos.length === 0) {
                            area.querySelector("[componente=infoSinApartamento]").removeAttribute("style")
                        }
                    })
                    descuentoDedicadoUI.appendChild(botonEliminarApartamento)
                    return descuentoDedicadoUI
                },
                eliminarApartamenro: (apartamento) => {
                    let apartamentoIDV = apartamento.target.parentNode.getAttribute("apartamentoSeleccionado")
                    apartamento.target.parentNode.remove()
                    let conteoDescuentoDedicados = document.querySelector("[componente=comportamientoSuperBloque]").querySelectorAll("[descuentoDedicadoUI]")
                    if (conteoDescuentoDedicados.length === 0) {
                        document.querySelector("[componente=infoDescuentoDedicados]").removeAttribute("style")
                        document.querySelector("[componente=comportamientoSuperBloque]").style.display = "flex"
                    }
                },
                opcionesOferta: (opcion) => {
                    let opciones = opcion.target.value
                    //Primer oculta todo
                    let selectorOpciones = document.querySelectorAll("[controladorDesliegue]")
                    selectorOpciones.forEach((opcion) => {
                        opcion.classList.add("estadoInicialInvisible")
                    })
                    //Luego despliega
                    let zonaDespliegue
                    if (opciones === "totalNetoApartamentoDedicado") {
                        zonaDespliegue = "descuentosDedicados"
                    }
                    if (opciones === "totalNetoApartmento") {
                        zonaDespliegue = "descuentoGlobal"
                    }
                    if (opciones === "totalNetoReserva") {
                        zonaDespliegue = "descuentoGlobal"
                    }
                    document.querySelector(`[controladorDesliegue="${zonaDespliegue}"]`)?.classList.remove("estadoInicialInvisible")
                },

            },
            detallesComportamiento: {
                UI: async (comportamientoUID) => {
                    const seccionRenderizadaOrigen = document.querySelector("main")
                    const instanciaUID = seccionRenderizadaOrigen.getAttribute("instanciaUID")
                    const transaccion = {
                        zona: "administracion/comportamientoDePrecios/detallesComportamiento",
                        comportamientoUID: String(comportamientoUID)
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada) { return }
                    if (respuestaServidor?.error) {
                        const titulo = document.querySelector(".titulo")
                        titulo.innerText = "No existe ningÃºn comportamiento de precio con el identificador: " + comportamientoUID
                        return
                    }
                    if (respuestaServidor?.ok) {
                        const detalles = respuestaServidor?.detallesComportamiento
                        const comportamientoUID = detalles.comportamientoUID
                        const estadoIDV = detalles.estadoIDV
                        const espacioOfertas = document.querySelector("[componente=espacioComportamiento]")
                        espacioOfertas.setAttribute("comportamientoUID", comportamientoUID)
                        espacioOfertas.setAttribute("valoresIniciales", JSON.stringify(detalles))
                        const soloLecturaUI = document.createElement("div")
                        soloLecturaUI.classList.add("editarOfertaSoloLecturaUI")
                        const soloLecturaInfo = document.createElement("p")
                        soloLecturaInfo.classList.add("editarOfertaSoloLecutraInfo")
                        soloLecturaInfo.setAttribute("componente", "soloLecturaInfo")
                        soloLecturaInfo.innerText = "Modo solo lectura"
                        soloLecturaUI.appendChild(soloLecturaInfo)
                        espacioOfertas.appendChild(soloLecturaUI)
                        const ofertaUI = await casaVitini.administracion.comportamiento_de_precios.detalleUI("editarOferta")

                        espacioOfertas.appendChild(ofertaUI)

                        const selectorEstadoComportamiento = document.querySelector("[componente=estadoComportamiento]")
                        if (estadoIDV === "desactivado") {
                            selectorEstadoComportamiento.setAttribute("estado", estadoIDV)
                            selectorEstadoComportamiento.innerHTML = "Comportamiento desactivado"
                            selectorEstadoComportamiento.style.background = "#ff000091"
                        }
                        if (estadoIDV === "activado") {
                            selectorEstadoComportamiento.setAttribute("estado", estadoIDV)
                            selectorEstadoComportamiento.style.background = "#00ff006e"
                            selectorEstadoComportamiento.innerHTML = "Comportamiento activado"
                        }
                        casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.imprimirDatosEnUI()
                    }
                },
                guardarCambiosComportamiento: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Actualizando comportamiento de precio..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const main = document.querySelector("main")
                    const comportamientoUID = document.querySelector("[comportamientoUID]").getAttribute("comportamientoUID")
                    const contenedorComportamiento = casaVitini.administracion.comportamiento_de_precios.constructorObjeto()

                    const transaccion = {
                        zona: "administracion/comportamientoDePrecios/actualizarComportamiento",
                        comportamientoUID: String(comportamientoUID),
                        ...contenedorComportamiento

                    }

                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {

                        const comportamientoActualizado = respuestaServidor.comportamientoActualizado
                        const espacioOfertas = document.querySelector("[componente=espacioComportamiento]")
                        espacioOfertas.setAttribute("valoresIniciales", JSON.stringify(comportamientoActualizado))
                        const modo = {
                            modo: "botonCancelarCambios"
                        }
                        casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.comportamientoModos(modo)

                    }
                },
                comportamientoModos: (modo) => {
                    let botonModo
                    if (modo.target) {
                        botonModo = modo.target.getAttribute("componente")
                    }
                    if (modo.modo) {
                        botonModo = modo.modo
                    }
                    if (botonModo === "botonEditarOferta") {
                        let selectorBotonesEditar = document.querySelectorAll("[componente=botonEditarOferta]")
                        selectorBotonesEditar.forEach((boton) => {
                            boton.classList.add("elementoOcultoInicialmente")
                        })
                        let selectorBotonesGuardarCambios = document.querySelectorAll("[componente=botonGuardarCambios]")
                        selectorBotonesGuardarCambios.forEach((boton) => {
                            boton.classList.remove("elementoOcultoInicialmente")
                        })
                        let selectorBotonesCancelarCambios = document.querySelectorAll("[componente=botonCancelarCambios]")
                        selectorBotonesCancelarCambios.forEach((boton) => {
                            boton.classList.remove("elementoOcultoInicialmente")
                        })
                        let selectorBotonesEliminarOferta = document.querySelectorAll("[componente=botonEliminarOferta]")
                        selectorBotonesEliminarOferta.forEach((boton) => {
                            boton.classList.remove("elementoOcultoInicialmente")
                        })
                        document.querySelector("[componente=espacioCrearOferta]").classList.remove("eventosDesactivadosInicialmente")
                        document.querySelector("[componente=soloLecturaInfo]").innerText = "Modo ediciÃ³n"
                    }
                    if (botonModo === "botonCancelarCambios") {
                        document.querySelector("[componente=soloLecturaInfo]").innerText = "Modo solo lectura"

                        const selectorBotonesEditar = document.querySelectorAll("[componente=botonEditarOferta]")
                        selectorBotonesEditar.forEach((boton) => {
                            boton.classList.remove("elementoOcultoInicialmente")
                        })
                        const selectorBotonesGuardarCambios = document.querySelectorAll("[componente=botonGuardarCambios]")
                        selectorBotonesGuardarCambios.forEach((boton) => {
                            boton.classList.add("elementoOcultoInicialmente")
                        })
                        const selectorBotonesCancelarCambios = document.querySelectorAll("[componente=botonCancelarCambios]")
                        selectorBotonesCancelarCambios.forEach((boton) => {
                            boton.classList.add("elementoOcultoInicialmente")
                        })
                        const selectorBotonesEliminarOferta = document.querySelectorAll("[componente=botonEliminarOferta]")
                        selectorBotonesEliminarOferta.forEach((boton) => {
                            boton.classList.add("elementoOcultoInicialmente")
                        })
                        document.querySelector("[componente=espacioCrearOferta]").classList.add("eventosDesactivadosInicialmente")
                        document.querySelector("[componente=soloLecturaInfo]").classList.remove("elementoOcultoInicialmente")

                        casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.imprimirDatosEnUI()
                    }
                },
                estadoComportamiento: async (estadoOferta) => {
                    let comportamientoUID = document.querySelector("[comportamientoUID]").getAttribute("comportamientoUID")
                    let selectorEstadoComportamientoUI = document.querySelector("[componente=estadoComportamiento]")
                    let estadoActualMemoriaVolatil = selectorEstadoComportamientoUI.innerText
                    selectorEstadoComportamientoUI.innerText = "Esperando al servidor...."
                    let estadoOfertaActual = estadoOferta.target.getAttribute("estado")
                    let estadoComportamientoPropuesto
                    if (estadoOfertaActual === "desactivado") {
                        estadoComportamientoPropuesto = "activado"
                    }
                    if (estadoOfertaActual === "activado") {
                        estadoComportamientoPropuesto = "desactivado"
                    }
                    const transaccion = {
                        zona: "administracion/comportamientoDePrecios/actualizarEstadoComportamiento",
                        comportamientoUID: String(comportamientoUID),
                        estadoPropuesto: estadoComportamientoPropuesto
                    }
                    let respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        document.querySelector("[componente=estadoComportamiento]").innerText = estadoActualMemoriaVolatil
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        let estadoComportamientoConfirmado = respuestaServidor?.estadoComportamiento
                        selectorEstadoComportamientoUI.setAttribute("estado", estadoComportamientoConfirmado)
                        let estadoComportamientoUI
                        if (estadoComportamientoConfirmado === "activado") {
                            selectorEstadoComportamientoUI.style.background = "#00ff006e"
                            estadoComportamientoUI = "Comportamiento activado"
                        }
                        if (estadoComportamientoConfirmado === "desactivado") {
                            selectorEstadoComportamientoUI.style.background = "#ff000091"
                            estadoComportamientoUI = "Comportamiento desactivado"
                        }
                        selectorEstadoComportamientoUI.innerText = estadoComportamientoUI
                    }
                },
                eliminarComportamiento: {
                    UI: async () => {
                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                        const titulo = constructor.querySelector("[componente=titulo]")
                        titulo.innerText = "Confirmar la eliminaciÃ³n del comportamiento de precio"
                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                        mensaje.innerText = "Var a eliminar un comportamiento de precios configurado, Â¿Estas de acuerdo ? "

                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                        botonAceptar.innerText = "Comfirmar la eliminacion"
                        botonAceptar.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.eliminarComportamiento.confirmar)
                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                        botonCancelar.innerText = "Cancelar la eliminacion"

                        document.querySelector("main").appendChild(pantallaInmersiva)

                    },
                    confirmar: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Eliminado el comportamiento del precio..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const comportamientoUID = document.querySelector("[comportamientoUID]").getAttribute("comportamientoUID")
                        const transaccion = {
                            zona: "administracion/comportamientoDePrecios/eliminarComportamiento",
                            comportamientoUID: String(comportamientoUID)
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                            selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                advertenciaInmersiva.remove()
                            })
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const vista = `/administracion/comportamiento_de_precios`
                            const navegacion = {
                                vista: vista,
                                //"tipoOrigen": "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                },
                controladoresUI: {
                    opcionesTipo: (tipo) => {
                        const selectorBotones = document.querySelectorAll("[botonTipo]")
                        selectorBotones.forEach((boton) => {
                            boton.removeAttribute("style")
                            boton.removeAttribute("estado")

                        })
                        const botonSeleccionado = document.querySelector(`[botonTipo="${tipo}"]`)
                        if (botonSeleccionado) {
                            botonSeleccionado.style.background = "blue"
                            botonSeleccionado.style.color = "white"
                            botonSeleccionado.setAttribute("estado", "activado")

                        }

                        const selectoresContenedoresTipo = document.querySelectorAll(`[contenedor_tipobloqueo]`)
                        selectoresContenedoresTipo.forEach((contenedor) => {
                            contenedor.removeAttribute("style")
                        })

                        const contenedorSeleccionado = document.querySelector(`[contenedor_tipobloqueo="${tipo}"]`)
                        if (contenedorSeleccionado) {
                            document.querySelector("[contenedor=tipoComportamientos]").classList.remove("ocultoInicial")

                            contenedorSeleccionado.style.display = "flex"
                        }
                    },
                    selectorDiasSemana: (diasArray) => {
                        const selectorDias = document.querySelectorAll("[componente=diaUI]")
                        selectorDias.forEach((dia) => {
                            dia.removeAttribute("style")
                            dia.removeAttribute("estado")
                        })

                        for (const diaIDV of diasArray) {
                            const selectorDia = document.querySelector(`[componente=diaUI][diaIDV="${diaIDV}"]`)
                            selectorDia.setAttribute("estado", "activado")
                            selectorDia.style.background = "blue"
                            selectorDia.style.color = "white"
                        }
                    }

                },
                imprimirDatosEnUI: function () {
                    const datos = JSON.parse(document.querySelector("[valoresIniciales]").getAttribute("valoresIniciales"))
                    const nombreComportamiento = datos.nombreComportamiento
                    const contenedor = datos.contenedor
                    const tipo = contenedor.tipo
                    const apartamentos = contenedor.apartamentos

                    const campoNombre = document.querySelector("[campoOferta=nombreOferta]")
                    campoNombre.value = nombreComportamiento

                    casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.controladoresUI.opcionesTipo(tipo)
                    const areaContenedor = document.querySelector(`[contenedor_tipobloqueo="${tipo}"]`)

                    if (tipo === "porRango") {
                        const contenedorFechasRango = areaContenedor.querySelector("[nombreContenedor=rangoComportamiento]")
                        const selectorFechaInicio = contenedorFechasRango.querySelector("[calendario=entrada]")
                        const selectorFechaFin = contenedorFechasRango.querySelector("[calendario=salida]")
                        const selectorFechaInicioUI = contenedorFechasRango.querySelector("[fechaUI=fechaInicio]")
                        const selectorFechaFinUI = contenedorFechasRango.querySelector("[fechaUI=fechaFin]")

                        const selectorDias = document.querySelectorAll("[componente=diaUI]")
                        selectorDias.forEach((dia) => {
                            dia.removeAttribute("style")
                            dia.removeAttribute("estado")
                        })

                        const fechaInicio = contenedor.fechaInicio
                        const fechaFinal = contenedor.fechaFinal
                        selectorFechaInicio.setAttribute("memoriaVolatil", fechaInicio)
                        selectorFechaFin.setAttribute("memoriaVolatil", fechaFinal)
                        selectorFechaInicioUI.innerText = fechaInicio
                        selectorFechaFinUI.innerText = fechaFinal
                    } else if (tipo === "porDias") {
                        const diasArray = contenedor.dias
                        casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.controladoresUI.selectorDiasSemana(diasArray)
                    } else if (tipo === "porCreacion") {
                        const selectorFechaInicio = areaContenedor.querySelector("[calendario=entrada]")
                        const selectorFechaFin = areaContenedor.querySelector("[calendario=salida]")
                        const selectorFechaInicioUI = areaContenedor.querySelector("[fechaUI=fechaInicio]")
                        const selectorFechaFinUI = areaContenedor.querySelector("[fechaUI=fechaFin]")

                        const fechaInicio = contenedor.fechaInicio
                        const fechaFinal = contenedor.fechaFinal
                        selectorFechaInicio.setAttribute("memoriaVolatil", fechaInicio)
                        selectorFechaFin.setAttribute("memoriaVolatil", fechaFinal)
                        selectorFechaInicioUI.innerText = fechaInicio
                        selectorFechaFinUI.innerText = fechaFinal

                        const contenedorFechasCreacion = areaContenedor.querySelector("[nombreContenedor=rangoReservaCreacion]")

                        const selectorFechaInicioCreacion = contenedorFechasCreacion.querySelector("[calendario=entrada]")
                        const selectorFechaFinCreacion = contenedorFechasCreacion.querySelector("[calendario=salida]")
                        const selectorFechaInicioUICreacion = contenedorFechasCreacion.querySelector("[fechaUI=fechaInicio]")
                        const selectorFechaFinUICreacion = contenedorFechasCreacion.querySelector("[fechaUI=fechaFin]")

                        const fechaInicio_creacionReserva = contenedor.fechaInicio_creacionReserva
                        const fechaFinal_creacionReserva = contenedor.fechaFinal_creacionReserva
                        selectorFechaInicioCreacion.setAttribute("memoriaVolatil", fechaInicio_creacionReserva)
                        selectorFechaFinCreacion.setAttribute("memoriaVolatil", fechaFinal_creacionReserva)
                        selectorFechaInicioUICreacion.innerText = fechaInicio_creacionReserva
                        selectorFechaFinUICreacion.innerText = fechaFinal_creacionReserva
                    }

                    const contenedorApartamentos = areaContenedor.querySelector(`[componente=zonaAnadirApartamento]`)
                    contenedorApartamentos.querySelector(`[componente=infoSinApartamento]`).style.display = "none"
                    const apartamentosObsoletos = contenedorApartamentos.querySelectorAll("[contenedor=apartamentoDedicado]")
                    apartamentosObsoletos.forEach(apartamento => apartamento.remove())
                    for (const detalleApartamento of apartamentos) {
                        const apartamentoIDV = detalleApartamento.apartamentoIDV
                        const apartamentoUI = detalleApartamento.apartamentoUI
                        const cantidad = detalleApartamento.cantidad
                        const simboloIDV = detalleApartamento.simboloIDV
                        const insertarOpcionesApartamento = casaVitini.administracion.comportamiento_de_precios.crearComportamiento.insertarOpcionesApartamento({
                            apartamentoIDV: apartamentoIDV,
                            apartamentoUI: apartamentoUI,
                            simboloIDV: simboloIDV,
                            cantidad: cantidad
                        })
                        contenedorApartamentos.appendChild(insertarOpcionesApartamento)
                        // contenedorApartamentos.style.display = "grid"
                    }
                }
            },
            traductorCambioVista: (oferta) => {
                oferta.preventDefault()
                oferta.stopPropagation()
                let vista = oferta.target.closest("[vista]").getAttribute("vista")
                let entrada = {
                    "vista": vista,
                    "tipoOrigen": "menuNavegador"
                }
                casaVitini.shell.navegacion.controladorVista(entrada)
            },
            detalleUI: async function (modo) {
                const selector = document.querySelector("[componente=espacioComportamiento]")

                if (modo !== "editarOferta" && modo !== "crearOferta") {
                    const error = "Â¿En quÃ© modo quieres que despliegue la interfaz de oferta en editarOferat o en crearOferta"
                    casaVitini.ui.componentes.advertenciaInmersiva(error)
                }

                const divPrincipal = document.createElement("div");
                divPrincipal.setAttribute("componente", "espacioCrearOferta");
                divPrincipal.classList.add("espacioComportamiento");
                selector.appendChild(divPrincipal)

                if (modo === "editarOferta") {
                    divPrincipal.classList.add("eventosDesactivadosInicialmente")
                }

                const divContenedorNombreYEstado = document.createElement("div");
                if (modo === "editarOferta") {
                    divContenedorNombreYEstado.classList.add("crearOfertaContenedorHorizontalV2");
                }
                if (modo === "crearOferta") {
                    divContenedorNombreYEstado.classList.add("crearOfertaContenedorHorizontal_modoCrear");
                }

                if (modo === "editarOferta") {
                    const botonEstadoOferta = document.createElement("div")
                    botonEstadoOferta.classList.add("creatOfertaBotonEstado")
                    botonEstadoOferta.setAttribute("componente", "estadoComportamiento")
                    botonEstadoOferta.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.estadoComportamiento)
                    botonEstadoOferta.style.pointerEvents = "all"
                    botonEstadoOferta.innerText = "Comportamiento desactivado"
                    divContenedorNombreYEstado.appendChild(botonEstadoOferta)
                }

                //Crear el input
                const input = document.createElement("input");
                input.setAttribute("type", "text");
                input.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                input.setAttribute("campoOferta", "nombreOferta");
                input.setAttribute("placeholder", "Escribe un nombre para idenfiticar el comportamiento");
                divContenedorNombreYEstado.appendChild(input)
                divPrincipal.appendChild(divContenedorNombreYEstado)
                //Crear el div contenedor

                const selectorTipoComportamiento = this.compomentesUI.barraGlobal()
                divPrincipal.appendChild(selectorTipoComportamiento)

                const contenedorTipoComportamiento = document.createElement("div")
                contenedorTipoComportamiento.setAttribute("contenedor", "tipoComportamientos")
                contenedorTipoComportamiento.classList.add(
                    "flexVertical",
                    "backgroundGrey1",
                    "padding6",
                    "borderRadius12",
                    "ocultoInicial"
                )
                divPrincipal.appendChild(contenedorTipoComportamiento)

                const contenedorPorRango = this.compomentesUI.perfilesComportamiento.porRango()
                contenedorTipoComportamiento.appendChild(contenedorPorRango)
                const contenedorPorDias = this.compomentesUI.perfilesComportamiento.porDias()
                contenedorTipoComportamiento.appendChild(contenedorPorDias)
                const contenedorPorCreacion = await this.compomentesUI.perfilesComportamiento.porCreacion()
                contenedorTipoComportamiento.appendChild(contenedorPorCreacion)


                const divCrearOfertaEpacioBotones_3 = document.createElement("div");
                divCrearOfertaEpacioBotones_3.classList.add("crearOfertaEpacioBotones");
                divCrearOfertaEpacioBotones_3.style.pointerEvents = "all"
                //Crear el pÃ¡rrafo "Crear oferta" dentro del segundo div principal
                const pCrearOfervaBotonV1_3 = document.createElement("p");
                pCrearOfervaBotonV1_3.classList.add("crearOfervaBotonV1");
                pCrearOfervaBotonV1_3.setAttribute("tipoOferta", "porApartamentoDedicado");
                if (modo === "crearOferta") {
                    pCrearOfervaBotonV1_3.setAttribute("componente", "botonCrearOferta");
                    pCrearOfervaBotonV1_3.textContent = "Crear comportamiento";
                    pCrearOfervaBotonV1_3.addEventListener("click", () => {
                        casaVitini.administracion.comportamiento_de_precios.crearComportamiento.crearComortamientoConfirmar()
                    })
                }
                if (modo === "editarOferta") {
                    pCrearOfervaBotonV1_3.setAttribute("componente", "botonEditarOferta");
                    pCrearOfervaBotonV1_3.textContent = "Editar comportamiento";
                    pCrearOfervaBotonV1_3.style.pointerEvents = "all"
                    pCrearOfervaBotonV1_3.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.comportamientoModos)
                }
                //divCrearOfertaEpacioBotones_3.appendChild(pCrearOfervaBotonV1_3);
                const pBotonGuardarOferta_03 = document.createElement("p");
                pBotonGuardarOferta_03.classList.add("crearOfervaBotonV1");
                pBotonGuardarOferta_03.classList.add("elementoOcultoInicialmente");
                pBotonGuardarOferta_03.setAttribute("componente", "botonGuardarCambios");
                pBotonGuardarOferta_03.setAttribute("tipoOferta", "porApartamentoDedicado");
                pBotonGuardarOferta_03.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.guardarCambiosComportamiento)
                pBotonGuardarOferta_03.textContent = "Guardar comportamiento";
                const pBotonCancelarCambiosOferta_O3 = document.createElement("p");
                pBotonCancelarCambiosOferta_O3.classList.add("crearOfervaBotonV1");
                pBotonCancelarCambiosOferta_O3.classList.add("elementoOcultoInicialmente");
                pBotonCancelarCambiosOferta_O3.setAttribute("componente", "botonCancelarCambios");
                pBotonCancelarCambiosOferta_O3.setAttribute("tipoOferta", "porApartamentoDedicado");
                pBotonCancelarCambiosOferta_O3.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.comportamientoModos)
                pBotonCancelarCambiosOferta_O3.textContent = "Cancelar cambios y dejar de editar";
                const pBotonEliminarOferta_O3 = document.createElement("p");
                pBotonEliminarOferta_O3.classList.add("crearOfervaBotonV1");
                pBotonEliminarOferta_O3.classList.add("elementoOcultoInicialmente");
                pBotonEliminarOferta_O3.setAttribute("componente", "botonEliminarOferta");
                pBotonEliminarOferta_O3.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.eliminarComportamiento.UI)
                pBotonEliminarOferta_O3.textContent = "Eliminar comportamiento";
                divCrearOfertaEpacioBotones_3.appendChild(pBotonGuardarOferta_03);
                divCrearOfertaEpacioBotones_3.appendChild(pBotonCancelarCambiosOferta_O3);
                divCrearOfertaEpacioBotones_3.appendChild(pBotonEliminarOferta_O3);
                divPrincipal.appendChild(pCrearOfervaBotonV1_3)
                divPrincipal.appendChild(divCrearOfertaEpacioBotones_3)
                return divPrincipal
                //contenedorTipoComportamiento.appendChild(porApartamentoDedicado);
                //Agregar el div principal al documento body
            },
            compomentesUI: {
                contenedorSelectorApartamento: () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()

                    const contenedorApartamentos = document.createElement("div")
                    contenedorApartamentos.setAttribute("instanciaUID", instanciaUID)
                    contenedorApartamentos.setAttribute("contenedor", "apartamentosDelComportamiento")
                    contenedorApartamentos.classList.add(
                        "flexVertical",
                        "gap6"
                    );


                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.classList.add("crearComportameintoEspacioBotones")
                    //Crear el pÃ¡rrafo "AÃ±adir apartamento" dentro del segundo div interno
                    const pCrearOFertaBotonAnadirApartamento_31 = document.createElement("p");
                    pCrearOFertaBotonAnadirApartamento_31.classList.add("crearOFertaBotonAnadirApartamento");
                    pCrearOFertaBotonAnadirApartamento_31.setAttribute("componente", "botonAnadirApartamentoOferta");
                    pCrearOFertaBotonAnadirApartamento_31.textContent = "AÃ±adir apartamento";
                    pCrearOFertaBotonAnadirApartamento_31.addEventListener("click", (e) => {
                        casaVitini.administracion.comportamiento_de_precios.crearComportamiento.apartamentosDisponibles({
                            e: e,
                            destino: `[instanciaUID="${instanciaUID}"] [componente=comportamientoSuperBloque]`
                        })
                    })
                    contenedorBotones.appendChild(pCrearOFertaBotonAnadirApartamento_31);
                    contenedorApartamentos.appendChild(contenedorBotones)
                    //Crear el elemento div principal
                    const porApartamentoDedicado = document.createElement("div");
                    porApartamentoDedicado.classList.add("espaciadoInterno");
                    porApartamentoDedicado.setAttribute("zonaOferta", "porApartamentoDedicado");
                    porApartamentoDedicado.setAttribute("contenedor", "apartamentos");
                    //Crear el primer div interno
                    const divCrearOfertaEspacioOpciones_3 = document.createElement("div");
                    divCrearOfertaEspacioOpciones_3.classList.add("administracion_comportamientoPreciso_crearComportameinto_espacioContenedorApartamentos");
                    divCrearOfertaEspacioOpciones_3.setAttribute("componente", "comportamientoSuperBloque")
                    contenedorApartamentos.appendChild(divCrearOfertaEspacioOpciones_3);

                    //Crear el segundo pÃ¡rrafo dentro del quinto div interno
                    const pCrearOfertaTituloOpcion5_3 = document.createElement("p");
                    pCrearOfertaTituloOpcion5_3.classList.add("crearComportamientoConentenedor");
                    pCrearOfertaTituloOpcion5_3.setAttribute("componente", "infoDescuentoDedicados");
                    pCrearOfertaTituloOpcion5_3.textContent =
                        "Ahora mismo no tienes ningÃºn apartamento seleccionado para poder aplicarle un comportamiento de precio.Pulsa en el botÃ³n AÃ±adir apartamento para comenzar.";
                    divCrearOfertaEspacioOpciones_3.appendChild(pCrearOfertaTituloOpcion5_3);
                    return contenedorApartamentos

                },
                insertarComportamientoPorAntelacion: function (data) {

                    const diasAntelacion = data.diasAntelacion
                    if (!diasAntelacion) {
                        const error = "Inserta al menos un numero"
                        return casaVitini.ui.componentes.advertenciaInmersiva(error)
                    }

                    const selectorPerfilRepedito = document.querySelector(`[perfil=diasAntelacion][diaAntelacion="${diasAntelacion}"]`)
                    if (selectorPerfilRepedito) {
                        const error = `Ya has insertar un perfil para ${diasAntelacion} de antelacion`
                        return casaVitini.ui.componentes.advertenciaInmersiva(error)
                    }

                    const contenedor = document.createElement("div")
                    contenedor.setAttribute("perfil", "diasAntelacion")
                    contenedor.classList.add(
                        "backgroundGrey1",
                        "padding6"
                    )
                    contenedor.setAttribute("diaAntelacion", diasAntelacion)

                    const botonEliminar = document.createElement("div")
                    botonEliminar.classList.add("botonV1")
                    botonEliminar.innerText = "Eliminar comportamiento"
                    botonEliminar.addEventListener("click", (e) => {
                        const contenedorUI = e.target.closest("[perfil=diasAntelacion]")
                        contenedorUI.remove()
                    })
                    contenedor.appendChild(botonEliminar)

                    const titulo = document.createElement("div")
                    titulo.classList.add(
                        "padding6"
                    )
                    titulo.innerText = `Aplicar comportamiento a los apartamentos cuando se haga una reserva con ${diasAntelacion} o mÃ¡s dÃ­as de antelaciÃ³n`
                    contenedor.appendChild(titulo)


                    const selectorUI = this.contenedorSelectorApartamento()
                    contenedor.appendChild(selectorUI)

                    const destino = document.querySelector("[contenedor=comportamientosPorDiasAntelacion]")
                    destino.appendChild(contenedor)
                },
                barraGlobal: () => {
                    const selectorBoton = (boton) => {
                        const botonID = boton.target.getAttribute("botonTipo")
                        casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.controladoresUI.opcionesTipo(botonID)
                    }
                    const selectorTipoComportamiento = document.createElement("div")
                    selectorTipoComportamiento.classList.add("selectorTipoComportamiento")

                    const botonTipoComportamiento_porRango = document.createElement("div")
                    botonTipoComportamiento_porRango.classList.add("botonTipoComportamiento")
                    botonTipoComportamiento_porRango.setAttribute("botonTipo", "porRango")
                    botonTipoComportamiento_porRango.innerText = "Por rango de fechas"
                    botonTipoComportamiento_porRango.addEventListener("click", selectorBoton)
                    selectorTipoComportamiento.appendChild(botonTipoComportamiento_porRango)

                    const botonTipoComportamiento_porCreacion = document.createElement("div")
                    botonTipoComportamiento_porCreacion.classList.add("botonTipoComportamiento")
                    botonTipoComportamiento_porCreacion.setAttribute("botonTipo", "porCreacion")
                    botonTipoComportamiento_porCreacion.innerText = "Por rango de fechas y rango de creaciÃ³n de reserva"
                    botonTipoComportamiento_porCreacion.addEventListener("click", selectorBoton)
                    selectorTipoComportamiento.appendChild(botonTipoComportamiento_porCreacion)

                    const botonTipoComportamiento_porDias = document.createElement("div")
                    botonTipoComportamiento_porDias.classList.add("botonTipoComportamiento")
                    botonTipoComportamiento_porDias.setAttribute("botonTipo", "porDias")
                    botonTipoComportamiento_porDias.innerText = "Por dÃ­as de la semana"
                    botonTipoComportamiento_porDias.addEventListener("click", selectorBoton)
                    selectorTipoComportamiento.appendChild(botonTipoComportamiento_porDias)

                    const botonTipoComportamiento_porDiasAntelacion = document.createElement("div")
                    botonTipoComportamiento_porDiasAntelacion.classList.add("botonTipoComportamiento")
                    botonTipoComportamiento_porDiasAntelacion.setAttribute("botonTipo", "porAntelacion")
                    botonTipoComportamiento_porDiasAntelacion.innerText = "Por dÃ­as de antelaciÃ³n"
                    botonTipoComportamiento_porDiasAntelacion.addEventListener("click", selectorBoton)
                    //selectorTipoComportamiento.appendChild(botonTipoComportamiento_porDiasAntelacion)
                    return selectorTipoComportamiento
                },
                perfilesComportamiento: {

                    porRango: () => {

                        const instanciaUID_contenedorFechas = casaVitini.utilidades.codigoFechaInstancia()


                        const contenedorTipoPorRango = document.createElement("div");
                        contenedorTipoPorRango.classList.add("crearComportameintoContendorFechas");
                        contenedorTipoPorRango.setAttribute("contenedor_tipoBloqueo", "porRango")
                        contenedorTipoPorRango.setAttribute("instanciaUID_contenedorFechas", instanciaUID_contenedorFechas)

                        const info = document.createElement("p")
                        info.classList.add(
                            "padding6",
                            "textoCentrado"
                        )
                        info.innerText = "Seleccionar el rango de dÃ­as en los cuales se aplicarÃ¡ el comportamiento de precio de los apartamentos."
                        contenedorTipoPorRango.appendChild(info)
                        const fechasRangoAplicacion = casaVitini.ui.componentes.componentesComplejos.contenedorFechasUI({
                            nombreContenedor: "rangoComportamiento",
                            modo: "administracion",

                        })
                        contenedorTipoPorRango.appendChild(fechasRangoAplicacion);
                        //   const contenedorApartamentos = casaVitini.administracion.comportamiento_de_precios.compomentesUI.contenedorSelectorApartamento()
                        const contenedorApartamentos = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.despliegue({
                            textoContenedorVacio: "AÃ±ade apartamentos para determinar el comportamiento de precio.",
                            tipoDespliegue: "total",
                            metodoPersonalizado: "comportamientoDePrecios"
                        })

                        contenedorTipoPorRango.appendChild(contenedorApartamentos);

                        return contenedorTipoPorRango
                    },
                    porCreacion: async () => {
                        const instanciaUID_contenedorFechas = casaVitini.utilidades.codigoFechaInstancia()

                        const contenedorTipoPorCreacion = document.createElement("div");
                        contenedorTipoPorCreacion.classList.add("crearComportameintoContendorFechas");
                        contenedorTipoPorCreacion.setAttribute("contenedor_tipoBloqueo", "porCreacion")
                        contenedorTipoPorCreacion.setAttribute("instanciaUID_contenedorFechas", instanciaUID_contenedorFechas)

                        const info = document.createElement("p")
                        info.classList.add(
                            "padding6",
                            "textoCentrado"
                        )
                        info.innerText = "Seleccionar el rango de dÃ­as en los cuales se aplicarÃ¡ el comportamiento de precio de los apartamentos."
                        contenedorTipoPorCreacion.appendChild(info)
                        const fechasRangoAplicacion = casaVitini.ui.componentes.componentesComplejos.contenedorFechasUI({
                            //metodoSelectorDia: "null"
                            nombreContenedor: "rangoComportamiento",
                            modo: "administracion",

                        })
                        contenedorTipoPorCreacion.appendChild(fechasRangoAplicacion);
                        await casaVitini.utilidades.ralentizador(1)
                        const info1 = document.createElement("p")
                        info1.classList.add(
                            "padding6",
                            "textoCentrado"
                        )
                        info1.innerText = "Selecciona el rango en el cual tiene que estar la fecha de creaciÃ³n de la reserva para aplicarse este comportamiento."
                        contenedorTipoPorCreacion.appendChild(info1)
                        const fechasRangoCreacion = casaVitini.ui.componentes.componentesComplejos.contenedorFechasUI({
                            //metodoSelectorDia: "null"
                            nombreContenedor: "rangoReservaCreacion",
                            modo: "administracion",

                        })
                        contenedorTipoPorCreacion.appendChild(fechasRangoCreacion);

                        //const contenedorApartamentos = casaVitini.administracion.comportamiento_de_precios.compomentesUI.contenedorSelectorApartamento()
                        const contenedorApartamentos = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.despliegue({
                            textoContenedorVacio: "AÃ±ade apartamentos para determinar el comportamiento de precio.",
                            tipoDespliegue: "total",
                            metodoPersonalizado: "comportamientoDePrecios"
                        })

                        contenedorTipoPorCreacion.appendChild(contenedorApartamentos);

                        return contenedorTipoPorCreacion
                    },
                    porDias: () => {


                        const selectorDiaSemana = (e) => {
                            const dia = e.target
                            const estadoDia = dia.getAttribute("estado")

                            if (estadoDia === "activado") {
                                dia.removeAttribute("style")
                                dia.removeAttribute("estado")
                            } else {
                                dia.setAttribute("estado", "activado")
                                dia.style.background = "blue"
                                dia.style.color = "white"
                            }
                        }

                        const comportamientoPorDias = document.createElement("div")
                        comportamientoPorDias.classList.add("contenedorOculto");
                        comportamientoPorDias.setAttribute("contenedor_tipoBloqueo", "porDias")
                        comportamientoPorDias.classList.add(
                            "flexVertical",
                            "gap6"
                        )

                        const contenedorTipoPorDias = document.createElement("div");
                        contenedorTipoPorDias.classList.add("contenedorPorDias");
                        const dias = [
                            {
                                nombreIDV: "lunes",
                                nombreUI: "Lunes"
                            },
                            {
                                nombreIDV: "martes",
                                nombreUI: "Martes"
                            },
                            {
                                nombreIDV: "miercoles",
                                nombreUI: "MiÃ©rcoles"
                            },
                            {
                                nombreIDV: "jueves",
                                nombreUI: "Jueves"
                            },
                            {
                                nombreIDV: "viernes",
                                nombreUI: "Viernes"
                            },
                            {
                                nombreIDV: "sabado",
                                nombreUI: "SÃ¡bado"
                            },
                            {
                                nombreIDV: "domingo",
                                nombreUI: "Domingo"
                            }
                        ]

                        for (const dia of dias) {
                            const nombreUI = dia.nombreUI
                            const nombreIDV = dia.nombreIDV

                            const diaUI = document.createElement("div")
                            diaUI.classList.add("diaUI")
                            diaUI.classList.add("negrita")
                            diaUI.setAttribute("componente", "diaUI")
                            diaUI.setAttribute("diaIDV", nombreIDV)
                            diaUI.innerText = nombreUI
                            diaUI.addEventListener("click", selectorDiaSemana)
                            contenedorTipoPorDias.appendChild(diaUI)
                        }
                        comportamientoPorDias.appendChild(contenedorTipoPorDias);
                        //const contenedorApartamentosParaDias = casaVitini.administracion.comportamiento_de_precios.compomentesUI.contenedorSelectorApartamento()
                        const contenedorApartamentos = casaVitini.ui.componentes.componentesComplejos.selectorApartamentosEspecificosUI.despliegue({
                            textoContenedorVacio: "AÃ±ade apartamentos para determinar el comportamiento de precio.",
                            tipoDespliegue: "total",
                            metodoPersonalizado: "comportamientoDePrecios"
                        })

                        comportamientoPorDias.appendChild(contenedorApartamentos);
                        return comportamientoPorDias

                    },
                    porDiasDeAntelacion: () => {
                        const comportamientoPorAntelacion = document.createElement("div")
                        comportamientoPorAntelacion.classList.add("contenedorOculto");
                        comportamientoPorAntelacion.setAttribute("contenedor_tipoBloqueo", "porAntelacion")
                        comportamientoPorAntelacion.classList.add(
                            "flexVertical",
                            "gap6",
                            "padding6"
                        )

                        contenedorTipoComportamiento.appendChild(comportamientoPorAntelacion);
                        const fechasUI = casaVitini.ui.componentes.componentesComplejos.contenedorFechasUI({
                            //metodoSelectorDia: "null",
                            modo: "administracion",

                        })
                        comportamientoPorAntelacion.appendChild(fechasUI)

                        const contenedorSelectorAntelacion = document.createElement("div")
                        contenedorSelectorAntelacion.classList.add(
                            "flexVertical"
                        )
                        comportamientoPorAntelacion.appendChild(contenedorSelectorAntelacion)

                        const botonAnadirComportamientoPorDiasDeAntecion = document.createElement("div")
                        botonAnadirComportamientoPorDiasDeAntecion.classList.add("botonV1")
                        botonAnadirComportamientoPorDiasDeAntecion.innerText = "AÃ±adir comportamiento por antelacion"
                        botonAnadirComportamientoPorDiasDeAntecion.addEventListener("click", () => {
                            const campoDiasAntelacion = document.querySelector("[campo=diasAntelacion]").value
                            this.compomentesUI.insertarComportamientoPorAntelacion({
                                diasAntelacion: campoDiasAntelacion
                            })
                        })
                        comportamientoPorAntelacion.appendChild(botonAnadirComportamientoPorDiasDeAntecion)

                        const entradDias = document.createElement("input")
                        entradDias.setAttribute("campo", "diasAntelacion")
                        entradDias.type = "number"
                        entradDias.classList.add(
                            "padding6",
                            "borderRadius6"
                        )
                        entradDias.placeholder = "Inserta el numero maximo de dias de antelacion"
                        comportamientoPorAntelacion.appendChild(entradDias)


                        const contenedorPerfilDiasAntelacion = document.createElement("div")
                        contenedorPerfilDiasAntelacion.setAttribute("contenedor", "comportamientosPorDiasAntelacion")
                        comportamientoPorAntelacion.appendChild(contenedorPerfilDiasAntelacion)
                        return comportamientoPorAntelacion
                    }







                }
            },
            constructorObjeto: () => {
                const tipo = document.querySelector("[botonTipo][estado=activado]")?.getAttribute("botonTipo")
                const nombreComportamiento = document.querySelector("[campoOferta=nombreOferta]").value
                const contenedorGlobal = {
                    nombreComportamiento: nombreComportamiento,
                    contenedor: {
                        tipo
                    }
                }
                const contenedorComportamiento = contenedorGlobal.contenedor
                if (tipo === "porRango") {
                    const area = document.querySelector(`[contenedor_tipobloqueo=porRango]`)
                    const fechaInicio_ISO = area.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    const fechaFinal_ISO = area.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")

                    contenedorComportamiento.fechaInicio = fechaInicio_ISO
                    contenedorComportamiento.fechaFinal = fechaFinal_ISO
                    contenedorComportamiento.apartamentos = []
                    const selectoresApartamentos = document.querySelectorAll(`[contenedor_tipobloqueo=porRango] [apartamentoseleccionado]`)
                    selectoresApartamentos.forEach((apartamentos) => {
                        const apartamentoIDV = apartamentos.getAttribute("descuentoDedicadoIDV")
                        const cantidad = apartamentos.querySelector("[campoApartamentoSeleccionado=cantidad]").value
                        const simboloIDV = apartamentos.querySelector("[campoApartamentoSeleccionado=simboloIDV]").value
                        const apartamentoFinal = {
                            apartamentoIDV: apartamentoIDV,
                            cantidad: cantidad,
                            simboloIDV: simboloIDV
                        }
                        contenedorComportamiento.apartamentos.push(apartamentoFinal)
                    })
                } else if (tipo === "porCreacion") {
                    const area = document.querySelector(`[contenedor_tipobloqueo=porCreacion]`)
                    const contenedorRangoComportamiento = area.querySelector("[nombreContenedor=rangoComportamiento]")
                    const contenedorRangoReservaCreacion = area.querySelector("[nombreContenedor=rangoReservaCreacion]")

                    const fechaInicioRangoComportamiento_ISO = contenedorRangoComportamiento.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    const fechaFinalRangoComportamiento_ISO = contenedorRangoComportamiento.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    const fechaInicioRangoReservaCreacion_ISO = contenedorRangoReservaCreacion.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    const fechaFinalRangoReservaCreacion_ISO = contenedorRangoReservaCreacion.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")

                    contenedorComportamiento.fechaInicio = fechaInicioRangoComportamiento_ISO
                    contenedorComportamiento.fechaFinal = fechaFinalRangoComportamiento_ISO
                    contenedorComportamiento.fechaInicio_creacionReserva = fechaInicioRangoReservaCreacion_ISO
                    contenedorComportamiento.fechaFinal_creacionReserva = fechaFinalRangoReservaCreacion_ISO
                    contenedorComportamiento.apartamentos = []
                    const selectoresApartamentos = document.querySelectorAll(`[contenedor_tipobloqueo=porCreacion] [apartamentoseleccionado]`)
                    selectoresApartamentos.forEach((apartamentos) => {
                        const apartamentoIDV = apartamentos.getAttribute("descuentoDedicadoIDV")
                        const cantidad = apartamentos.querySelector("[campoApartamentoSeleccionado=cantidad]").value
                        const simboloIDV = apartamentos.querySelector("[campoApartamentoSeleccionado=simboloIDV]").value
                        const apartamentoFinal = {
                            apartamentoIDV: apartamentoIDV,
                            cantidad: cantidad,
                            simboloIDV: simboloIDV
                        }
                        contenedorComportamiento.apartamentos.push(apartamentoFinal)
                    })
                } else if (tipo === "porDias") {
                    const selectorDiasSeleccionados = document.querySelectorAll("[componente=diaUI][estado=activado]")
                    const diasSeleccionados = []
                    selectorDiasSeleccionados.forEach((diaSeleecionado) => {
                        const diaIDV = diaSeleecionado.getAttribute("diaIDV")
                        diasSeleccionados.push(diaIDV)
                    })

                    contenedorComportamiento.dias = diasSeleccionados
                    const selectoresApartamentos = document.querySelectorAll(`[contenedor_tipobloqueo=porDias] [apartamentoseleccionado]`)
                    contenedorComportamiento.apartamentos = []

                    selectoresApartamentos.forEach((apartamentos) => {
                        const apartamentoIDV = apartamentos.getAttribute("descuentoDedicadoIDV")
                        const cantidad = apartamentos.querySelector("[campoApartamentoSeleccionado=cantidad]").value
                        const simboloIDV = apartamentos.querySelector("[campoApartamentoSeleccionado=simboloIDV]").value
                        const apartamentoFinal = {
                            apartamentoIDV: apartamentoIDV,
                            cantidad: cantidad,
                            simboloIDV: simboloIDV
                        }
                        contenedorComportamiento.apartamentos.push(apartamentoFinal)
                    })
                } else if (tipo === "porAntelacion") {

                    const area = document.querySelector(`[contenedor_tipobloqueo=porAntelacion]`)
                    const fechaInicio_humana = area.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    const fechaFinal_humana = area.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")

                    const fechaInicio_ISO = casaVitini.utilidades.conversor.fecha_humana_hacia_ISO(fechaInicio_humana)
                    const fechaFinal_ISO = casaVitini.utilidades.conversor.fecha_humana_hacia_ISO(fechaFinal_humana)

                    contenedorComportamiento.fechaInicio = fechaInicio_ISO
                    contenedorComportamiento.fechaFinal = fechaFinal_ISO
                    const contenedorAntelaciones = []
                    const selectorCotnenedorPorAntelacion = document.querySelectorAll(`[contenedor_tipobloqueo=porAntelacion] [diaAntelacion]`)

                    selectorCotnenedorPorAntelacion.forEach((contenedor) => {

                        const diasAntelacion = contenedor.getAttribute("diaAntelacion")
                        const estructura = {
                            diasAntelacion: diasAntelacion,
                            apartamentos: {}
                        }
                        const selectorApartamentosPerfil = contenedor.querySelectorAll("[contenedor=apartamentoDedicado]")
                        selectorApartamentosPerfil.forEach((apartamentoDedicado) => {

                            const apartamentoIDV = apartamentoDedicado.getAttribute("descuentoDedicadoIDV")
                            const cantidad = apartamentoDedicado.querySelector("[campoApartamentoSeleccionado=cantidad]").value
                            const simboloIDV = apartamentoDedicado.querySelector("[campoApartamentoSeleccionado=simboloIDV]").value

                            const estructuraApartametno = {
                                cantidad,
                                simboloIDV
                            }
                            estructura.apartamentos[apartamentoIDV] = estructuraApartametno
                        })
                        contenedorAntelaciones.push(estructura)
                    })

                    contenedorComportamiento.perfilesAntelacion = contenedorAntelaciones
                }
                return contenedorGlobal


            }
        },
        enlacesDePago: {
            arranque: async () => {
                const main = document.querySelector("main")
                main.setAttribute("zonaCSS", "administracion/enlacesDePago")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const directorioUltimo = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                const parametros = granuladoURL.parametros
                if (directorioUltimo === "enlaces_de_pago") {
                    return casaVitini.administracion.enlacesDePago.portadaUI()
                } else {
                    if (parametros.enlace) {
                        casaVitini.administracion.enlacesDePago.detallesEnlace.UI(parametros.enlace)
                    }
                }
                const info = {
                    titulo: "No existe ningÃºn enlace de pago con ese identificador.",
                    descripcion: "El enlace de pago que buscas con ese identificador no existe.Comprueba el identificador de la reserva"
                }
                casaVitini.ui.componentes.mensajeSimple(info)
            },
            portadaUI: async () => {
                const espacio = document.querySelector("[componente=enlacesDePago]")
                const contenedor = document.createElement("div")
                contenedor.classList.add("enlacesDePago_contenedor")
                const contenedorBotones = document.createElement("div")
                contenedorBotones.classList.add("enlacesDePago_contenedorBotones")
                const botonCrearEnlace = document.createElement("a")
                botonCrearEnlace.classList.add("gestionDeOfertasBotonCrearOferta")
                botonCrearEnlace.innerText = "Crear un enlace de pago"
                botonCrearEnlace.setAttribute("href", "/administracion/enlaces_de_pago/crear_enlace")
                botonCrearEnlace.setAttribute("vista", "/administracion/enlaces_de_pago/crear_enlace")
                botonCrearEnlace.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                //contenedorBotones.appendChild(botonCrearEnlace)
                contenedor.appendChild(contenedorBotones)
                const contenedorOfertas = document.createElement("div")
                contenedorOfertas.classList.add("comportamintoDePreciosSuperBloque")
                contenedorOfertas.setAttribute("componente", "espacioEnlacesRenderizados")
                contenedor.appendChild(contenedorOfertas)
                espacio.appendChild(contenedor)
                const transaccion = {
                    zona: "administracion/enlacesDePago/obtenerEnlaces"
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                if (respuestaServidor?.error) {
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    const espacioEnlacesRenderizados = document.querySelector("[componente=espacioEnlacesRenderizados]")
                    const enlacesCreados = respuestaServidor?.ok
                    if (enlacesCreados.length === 0) {
                        const enlaceUI = document.createElement("a")
                        enlaceUI.classList.add("ofertaUINoHay")
                        const tituloOferta = document.createElement("p")
                        tituloOferta.classList.add("ofertaUITituloOferta")
                        tituloOferta.innerText = "No hay ningÃºn enlace creado.Desde aquÃ­ puedes ver todos los enlaces de pago generados desde las reservas de una forma centralizada.Puedes generar un enlace de pago desde la reserva en la pestaÃ±a enlaces de pago."
                        enlaceUI.appendChild(tituloOferta)
                        espacioEnlacesRenderizados.appendChild(enlaceUI)
                        return
                    }
                    if (Array.isArray(enlacesCreados) && enlacesCreados.length > 0) {
                        enlacesCreados.forEach((detalleOferta) => {
                            const enlaceUID = detalleOferta.enlace
                            const nombreEnlace = detalleOferta.nombreEnlace
                            const reservaUID = detalleOferta.reservaUID
                            const totalReserva = detalleOferta.totalReserva
                            const cantidad = detalleOferta.cantidad
                            const descripcion = detalleOferta.descripcion
                            const estadoPagoIDV = detalleOferta.estadoPagoIDV
                            const estadoPagoUI = {
                                pagaodo: "Enlace pagado",
                                noPagado: "Enlace no pagado"
                            }
                            const descripcionFinalUI = descripcion ? descripcion : "Este enlace no tiene descripciÃ³n"
                            const enlaceUI = document.createElement("a")
                            enlaceUI.classList.add("enlaceUI")
                            enlaceUI.setAttribute("enlaceUID", enlaceUID)
                            //enlaceUI.addEventListener("click", casaVitini.administracion.enlacesDePago.traductorCambioVista)
                            const tituloEnlace = document.createElement("p")
                            tituloEnlace.classList.add("ofertaUITituloOferta")
                            tituloEnlace.setAttribute("valorInicial", nombreEnlace)
                            tituloEnlace.innerText = nombreEnlace
                            enlaceUI.appendChild(tituloEnlace)
                            const precioUI = document.createElement("p")
                            precioUI.classList.add("ofertaUITituloOferta")
                            precioUI.innerText = totalReserva + "$ " + estadoPagoUI[estadoPagoIDV]
                            enlaceUI.appendChild(precioUI)
                            const tituloReserva = document.createElement("a")
                            tituloReserva.classList.add("enlaceUIContenedor_vinculo")
                            tituloReserva.setAttribute("href", "/administracion/reservas/reserva:" + reservaUID + "/enlaces_de_pago")
                            tituloReserva.setAttribute("vista", "/administracion/reservas/reserva:" + reservaUID + "/enlaces_de_pago")
                            tituloReserva.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                            tituloReserva.innerText = `Reserva ${reservaUID} (Ir a la reserva)`
                            enlaceUI.appendChild(tituloReserva)
                            const irAlEnlace = document.createElement("a")
                            irAlEnlace.classList.add("enlaceUIContenedor_vinculo")
                            irAlEnlace.setAttribute("href", "/pagos/" + enlaceUID)
                            irAlEnlace.setAttribute("vista", "/pagos/" + enlaceUID)
                            irAlEnlace.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                            irAlEnlace.innerText = "Ir al enlace"
                            enlaceUI.appendChild(irAlEnlace)
                            const enlaceUIContenedor = document.createElement("div")
                            enlaceUIContenedor.classList.add("enlaceUIContenedor")
                            const descripcionUI = document.createElement("div")
                            descripcionUI.classList.add("ofertaUITituloFecha")
                            descripcionUI.innerText = "DescripciÃ³n del enlace"
                            enlaceUIContenedor.appendChild(descripcionUI)
                            const datoFechaFin = document.createElement("div")
                            datoFechaFin.classList.add("ofertaUIDatoFecha")
                            datoFechaFin.setAttribute("valorInicial", descripcion)
                            datoFechaFin.innerText = descripcionFinalUI
                            enlaceUIContenedor.appendChild(datoFechaFin)
                            enlaceUI.appendChild(enlaceUIContenedor)
                            espacioEnlacesRenderizados.appendChild(enlaceUI)
                        })
                    }
                }
            },
            detallesEnlace: {
                UI: async (uid) => {
                    const transaccion = {
                        zona: "administracion/enlacesDePago/detallesDelEnlace",
                        enlaceUID: Number(uid)
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        const info = {
                            titulo: "No existe ningun enlace de pago con ese identificador",
                            descripcion: "El enlace de pago que buscas con ese identificador no existe.Comprueba el identificador de la reserva"
                        }
                        casaVitini.ui.componentes.mensajeSimple(info)
                    }
                    if (respuestaServidor?.ok) {
                        const detallesEnlace = respuestaServidor?.ok
                        const uidEnlace = detallesEnlace.reserva
                        const nombreEnlace = detallesEnlace.nombreEnlace
                        const codigo = detallesEnlace.codigo
                        const reserva = detallesEnlace.reserva
                        const precio = detallesEnlace.precio
                        const descripcion = detallesEnlace.descripcion
                        const estadoPago = detallesEnlace.estadoPago
                        let estadoUIFinal
                        if (estadoPago === "sinInformacion") {
                            estadoUIFinal = "Estado del pago sin informacion."
                        }
                        if (estadoPago === "pagado") {
                            estadoUIFinal = "Pago realizado"
                        }
                        if (estadoPago === "noPagado") {
                            estadoUIFinal = "No pagado"
                        }
                        const espacioDetallesEnlace = document.querySelector("[componente=enlacesDePago]")
                        espacioDetallesEnlace.setAttribute("comportamientoUID", uid)
                        const contenedorDetallesEnlace = document.createElement("div")
                        contenedorDetallesEnlace.classList.add("detallesEnlace_contenedor")
                        contenedorDetallesEnlace.setAttribute("enlaceUID", uidEnlace)
                        const nombreEnlaceUI = document.createElement("input")
                        nombreEnlaceUI.classList.add("detallesEnlace_nombreEnlace")
                        nombreEnlaceUI.setAttribute("campo", "nombreEnlace")
                        nombreEnlaceUI.setAttribute("valorInicial", nombreEnlace)
                        nombreEnlaceUI.addEventListener("input", casaVitini.administracion.enlacesDePago.controladorBotones)
                        nombreEnlaceUI.placeholder = "Escribe un nombre para este enlace y poder identificarlo rÃ¡pidamente"
                        nombreEnlaceUI.value = nombreEnlace
                        contenedorDetallesEnlace.appendChild(nombreEnlaceUI)
                        const precioUI = document.createElement("div")
                        precioUI.classList.add("detallesEnlace_precio")
                        precioUI.innerText = precio + "$"
                        contenedorDetallesEnlace.appendChild(precioUI)
                        const estadoPagoUI = document.createElement("div")
                        estadoPagoUI.classList.add("detallesEnlace_estadoPago")
                        estadoPagoUI.innerText = estadoUIFinal
                        contenedorDetallesEnlace.appendChild(estadoPagoUI)
                        const codigoUI = document.createElement("a")
                        codigoUI.classList.add("detallesEnlace_codigo")
                        codigoUI.setAttribute("href", "/pago: " + codigo)
                        codigoUI.setAttribute("vista", "/pago: " + codigo)
                        codigoUI.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        codigoUI.innerText = "Ir al enlace del pago"
                        contenedorDetallesEnlace.appendChild(codigoUI)
                        const reservaUI = document.createElement("a")
                        reservaUI.classList.add("detallesEnlace_codigo")
                        reservaUI.setAttribute("href", "/administracion/reservas/" + reserva)
                        reservaUI.setAttribute("vista", "/administracion/reservas/" + reserva)
                        reservaUI.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        reservaUI.innerText = `Ir a la reserva (${reserva})`
                        contenedorDetallesEnlace.appendChild(reservaUI)
                        const descripcionUI = document.createElement("textarea")
                        descripcionUI.classList.add("detallesEnlace_descripcion")
                        descripcionUI.setAttribute("campo", "descripcion")
                        descripcionUI.setAttribute("valorInicial", descripcion)
                        descripcionUI.addEventListener("input", casaVitini.administracion.enlacesDePago.controladorBotones)
                        descripcionUI.placeholder = "No es obligatorio escribir una descripciÃ³n, pero si lo necesitas, puedes definir un poco mÃ¡s a este enlace aparte de por su nombre."
                        descripcionUI.value = descripcion
                        contenedorDetallesEnlace.appendChild(descripcionUI)
                        espacioDetallesEnlace.appendChild(contenedorDetallesEnlace)
                        const contenedorBotones = document.createElement("div")
                        contenedorBotones.classList.add("detalesEnlace_contenedorBotones")
                        const botonGuardar = document.createElement("div")
                        botonGuardar.classList.add("detallesEnlace_botonV1")
                        botonGuardar.classList.add("ocultoInicial")
                        botonGuardar.setAttribute("boton", "guardarCambios")
                        botonGuardar.addEventListener("click", casaVitini.administracion.enlacesDePago.guardarCambios)
                        botonGuardar.innerText = "Guardar cambios"
                        contenedorBotones.appendChild(botonGuardar)
                        const botonCancelarCambios = document.createElement("div")
                        botonCancelarCambios.classList.add("detallesEnlace_botonV1")
                        botonCancelarCambios.classList.add("ocultoInicial")
                        botonCancelarCambios.setAttribute("boton", "cancelarCambios")
                        botonCancelarCambios.innerText = "Cancelar cambios"
                        botonCancelarCambios.addEventListener("click", casaVitini.administracion.enlacesDePago.cancelarCambios)
                        contenedorBotones.appendChild(botonCancelarCambios)
                        const botonEliminarEnlace = document.createElement("div")
                        botonEliminarEnlace.classList.add("detallesEnlace_botonV1")
                        botonEliminarEnlace.setAttribute("boton", "eliminarEnlace")
                        botonEliminarEnlace.addEventListener("click", casaVitini.administracion.enlacesDePago.eliminarEnlace.UI)
                        botonEliminarEnlace.innerText = "Eliminar enlace"
                        contenedorBotones.appendChild(botonEliminarEnlace)
                        espacioDetallesEnlace.appendChild(contenedorBotones)
                    }
                    //Acabar el resto de detalles oferta
                }
            },
            cancelarCambios: () => {
                const campos = document.querySelectorAll("[campo]")
                campos.forEach((campo) => {
                    const valorInicial = campo.getAttribute("valorInicial")
                    campo.value = valorInicial
                })
                const botonGuardarCambios = document.querySelector("[boton=guardarCambios]")
                const cancelarCambios = document.querySelector("[boton=cancelarCambios]")
                const eliminarEnlace = document.querySelector("[boton=eliminarEnlace]")
                botonGuardarCambios.removeAttribute("style")
                cancelarCambios.removeAttribute("style")
            },
            eliminarEnlace: {
                UI: async () => {
                    const advertenciaInmersivaIU = document.createElement("div")
                    advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                    advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                    const contenedorAdvertenciaInmersiva = document.createElement("div")
                    contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                    const tituloCancelarReserva = document.createElement("p")
                    tituloCancelarReserva.classList.add("detallesReservaTituloCancelarReserva")
                    tituloCancelarReserva.innerText = "Eliminar enlae de pago"
                    contenedorAdvertenciaInmersiva.appendChild(tituloCancelarReserva)
                    const bloqueBloqueoApartamentos = document.createElement("div")
                    bloqueBloqueoApartamentos.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                    const tituloBloquoApartamentos = document.createElement("div")
                    tituloBloquoApartamentos.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                    tituloBloquoApartamentos.innerText = "Â¿Quieres confirmar la eliminaciÃ³n de este enlace de pago? Sus implicaciones serÃ¡n inmediatas y el enlace de acceso temporal pasarÃ¡ a ser obsoleto."
                    bloqueBloqueoApartamentos.appendChild(tituloBloquoApartamentos)
                    contenedorAdvertenciaInmersiva.appendChild(bloqueBloqueoApartamentos)
                    const bloqueBotones = document.createElement("div")
                    bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                    const botonCancelar = document.createElement("div")
                    botonCancelar.classList.add("detallesReservaCancelarBoton")
                    botonCancelar.setAttribute("componente", "botonConfirmarCancelarReserva")
                    botonCancelar.innerText = "Confirmar y eliminar enlace"
                    botonCancelar.addEventListener("click", casaVitini.administracion.enlacesDePago.eliminarEnlace.confirmar)
                    bloqueBotones.appendChild(botonCancelar)
                    const botonCancelarProcesoCancelacion = document.createElement("div")
                    botonCancelarProcesoCancelacion.classList.add("detallesReservaCancelarBoton")
                    botonCancelarProcesoCancelacion.innerText = "Cancelar la eliminacion del enlace"
                    botonCancelarProcesoCancelacion.addEventListener("click", () => {
                        let selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                        selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                            advertenciaInmersiva.remove()
                        })
                    })
                    bloqueBotones.appendChild(botonCancelarProcesoCancelacion)
                    contenedorAdvertenciaInmersiva.appendChild(bloqueBotones)
                    advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                    document.body.appendChild(advertenciaInmersivaIU)
                },
                confirmar: async () => {
                    let comportamientoUID = document.querySelector("[comportamientoUID]").getAttribute("comportamientoUID")
                    const transaccion = {
                        zona: "administracion/comportamientoDePrecios/eliminarComportamiento",
                        "comportamientoUID": Number(comportamientoUID)
                    }
                    let respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        let selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                        selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                            advertenciaInmersiva.remove()
                        })
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        let vista = `/administracion/comportamiento_de_precios`
                        let navegacion = {
                            "vista": vista,
                            "tipoOrigen": "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    }
                }
            },
            traductorCambioVista: (oferta) => {
                oferta.preventDefault()
                oferta.stopPropagation()
                const vista = oferta.target.closest("[vista]").getAttribute("vista")
                const entrada = {
                    "vista": vista,
                    "tipoOrigen": "menuNavegador"
                }
                casaVitini.shell.navegacion.controladorVista(entrada)
            },
            detalleUI: (modo) => {
                if (modo !== "editarOferta" && modo !== "crearOferta") {
                    const error = "Â¿En quÃ© modo quieres que despliegue la interfaz de oferta en editarOferat o en crearOferta"
                    casaVitini.ui.componentes.advertenciaInmersiva(error)
                }
                //Crear el elemento div principal
                const divPrincipal = document.createElement("div");
                divPrincipal.setAttribute("componente", "espacioCrearOferta");
                divPrincipal.classList.add("espacioClientes");
                if (modo === "editarOferta") {
                    divPrincipal.classList.add("eventosDesactivadosInicialmente")
                }
                const divContenedorNombreYEstado = document.createElement("div");
                divContenedorNombreYEstado.classList.add("crearOfertaContenedorHorizontalV2");
                const botonEstadoOferta = document.createElement("div")
                botonEstadoOferta.classList.add("creatOfertaBotonEstado")
                botonEstadoOferta.setAttribute("componente", "estadoComportamiento")
                botonEstadoOferta.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.estadoComportamiento)
                botonEstadoOferta.style.pointerEvents = "all"
                botonEstadoOferta.innerText = "Comportamiento desactivado"
                divContenedorNombreYEstado.appendChild(botonEstadoOferta)
                //Crear el input
                const input = document.createElement("input");
                input.setAttribute("type", "text");
                input.classList.add("preciosEImpuestosbotonOpcionCrearNuevoImpuesto");
                input.setAttribute("campoOferta", "nombreOferta");
                input.setAttribute("placeholder", "Escribe un nombre para idenfiticar el comportamiento");
                divContenedorNombreYEstado.appendChild(input)
                divPrincipal.appendChild(divContenedorNombreYEstado)
                //Crear el div contenedor
                const divContenedor = document.createElement("div");
                divContenedor.classList.add("crearOfertaConentenedor");
                //Crear el primer div contenedor horizontal
                const divContenedorHorizontal = document.createElement("div");
                divContenedorHorizontal.classList.add("crearOfertaContenedorHorizontal");
                //Crear el div contenedor de fecha de inicio
                const divContenedorFechaInicio = document.createElement("div");
                divContenedorFechaInicio.classList.add("contenedorFecha");
                divContenedorFechaInicio.setAttribute("calendario", "entrada");
                divContenedorFechaInicio.setAttribute("componente", "inicioOferta");
                divContenedorFechaInicio.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.crearComportamiento.constructorCalendario)
                //Crear el pÃ¡rrafo de la fecha de inicio
                const pFechaInicio = document.createElement("p");
                pFechaInicio.classList.add("tituloFecha");
                pFechaInicio.textContent = "Fecha de inicio";
                //Crear el pÃ¡rrafo de la fecha de inicio seleccionada
                const pFechaInicioSeleccionada = document.createElement("p");
                pFechaInicioSeleccionada.classList.add("fechaInicio");
                pFechaInicioSeleccionada.setAttribute("data", "fechaInicioData");
                pFechaInicioSeleccionada.textContent = "(Seleccionar)";
                //Agregar los elementos al div contenedor de fecha de inicio
                divContenedorFechaInicio.appendChild(pFechaInicio);
                divContenedorFechaInicio.appendChild(pFechaInicioSeleccionada);
                //Crear el div contenedor de fecha de fin
                const divContenedorFechaFin = document.createElement("div");
                divContenedorFechaFin.classList.add("contenedorFecha");
                divContenedorFechaFin.setAttribute("calendario", "salida");
                divContenedorFechaFin.setAttribute("componente", "finOferta");
                divContenedorFechaFin.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.crearComportamiento.constructorCalendario)
                //Crear el pÃ¡rrafo de la fecha de fin
                const pFechaFin = document.createElement("p");
                pFechaFin.classList.add("tituloFecha");
                pFechaFin.textContent = "Fecha fin";
                //Crear el pÃ¡rrafo de la fecha de fin seleccionada
                const pFechaFinSeleccionada = document.createElement("p");
                pFechaFinSeleccionada.classList.add("fechaFin");
                pFechaFinSeleccionada.setAttribute("data", "fechaFinData");
                pFechaFinSeleccionada.textContent = "(Seleccionar)";
                //Agregar los elementos al div contenedor de fecha de fin
                divContenedorFechaFin.appendChild(pFechaFin);
                divContenedorFechaFin.appendChild(pFechaFinSeleccionada);
                //Agregar los elementos al primer div contenedor horizontal
                divContenedorHorizontal.appendChild(divContenedorFechaInicio);
                divContenedorHorizontal.appendChild(divContenedorFechaFin);
                //Agregar el primer div contenedor horizontal al div contenedor
                divContenedor.appendChild(divContenedorHorizontal);
                //Agregar el div contenedor al div principal
                divPrincipal.appendChild(divContenedor);
                const contenedorBotones = document.createElement("div")
                contenedorBotones.classList.add("crearComportameintoEspacioBotones")
                //Crear el pÃ¡rrafo "AÃ±adir apartamento" dentro del segundo div interno
                const pCrearOFertaBotonAnadirApartamento_31 = document.createElement("p");
                pCrearOFertaBotonAnadirApartamento_31.classList.add("crearOFertaBotonAnadirApartamento");
                pCrearOFertaBotonAnadirApartamento_31.setAttribute("componente", "botonAnadirApartamentoOferta");
                pCrearOFertaBotonAnadirApartamento_31.textContent = "AÃ±adir apartamento";
                pCrearOFertaBotonAnadirApartamento_31.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.crearComportamiento.apartamentosDisponibles)
                contenedorBotones.appendChild(pCrearOFertaBotonAnadirApartamento_31);
                divPrincipal.appendChild(contenedorBotones)
                //Crear el elemento div principal
                const porApartamentoDedicado = document.createElement("div");
                porApartamentoDedicado.classList.add("espaciadoInterno");
                porApartamentoDedicado.setAttribute("zonaOferta", "porApartamentoDedicado");
                //Crear el primer div interno
                const divCrearOfertaEspacioOpciones_3 = document.createElement("div");
                divCrearOfertaEspacioOpciones_3.classList.add("crearOfeartaEspacioOpcionesV3");
                divCrearOfertaEspacioOpciones_3.setAttribute("componente", "comportamientoSuperBloque")
                porApartamentoDedicado.appendChild(divCrearOfertaEspacioOpciones_3);
                //Crear el segundo pÃ¡rrafo dentro del quinto div interno
                const pCrearOfertaTituloOpcion5_3 = document.createElement("p");
                pCrearOfertaTituloOpcion5_3.classList.add("crearComportamientoConentenedor");
                pCrearOfertaTituloOpcion5_3.setAttribute("componente", "infoDescuentoDedicados");
                pCrearOfertaTituloOpcion5_3.textContent =
                    "Ahora mismo no tienes ningÃºn apartamento seleccionado para poder aplicarle un comportamiento de precio. Pulsa en el botÃ³n AÃ±adir apartamento para comenzar.";
                divCrearOfertaEspacioOpciones_3.appendChild(pCrearOfertaTituloOpcion5_3);
                //Crear el segundo div principal
                const divCrearOfertaEpacioBotones_3 = document.createElement("div");
                divCrearOfertaEpacioBotones_3.classList.add("crearOfertaEpacioBotones");
                divCrearOfertaEpacioBotones_3.style.pointerEvents = "all"
                porApartamentoDedicado.appendChild(divCrearOfertaEpacioBotones_3);
                //Crear el pÃ¡rrafo "Crear oferta" dentro del segundo div principal
                const pCrearOfervaBotonV1_3 = document.createElement("p");
                pCrearOfervaBotonV1_3.classList.add("crearOfervaBotonV1");
                pCrearOfervaBotonV1_3.setAttribute("tipoOferta", "porApartamentoDedicado");
                if (modo === "crearOferta") {
                    pCrearOfervaBotonV1_3.setAttribute("componente", "botonCrearOferta");
                    pCrearOfervaBotonV1_3.textContent = "Crear comportamiento";
                    pCrearOfervaBotonV1_3.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.crearComportamiento.crearComortamientoConfirmar)
                }
                if (modo === "editarOferta") {
                    pCrearOfervaBotonV1_3.setAttribute("componente", "botonEditarOferta");
                    pCrearOfervaBotonV1_3.textContent = "Editar comportamiento";
                    pCrearOfervaBotonV1_3.style.pointerEvents = "all"
                    pCrearOfervaBotonV1_3.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.ofertaModos)
                }
                divCrearOfertaEpacioBotones_3.appendChild(pCrearOfervaBotonV1_3);
                const pBotonGuardarOferta_03 = document.createElement("p");
                pBotonGuardarOferta_03.classList.add("crearOfervaBotonV1");
                pBotonGuardarOferta_03.classList.add("elementoOcultoInicialmente");
                pBotonGuardarOferta_03.setAttribute("componente", "botonGuardarCambios");
                pBotonGuardarOferta_03.setAttribute("tipoOferta", "porApartamentoDedicado");
                pBotonGuardarOferta_03.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.guardarCambiosComportamiento)
                pBotonGuardarOferta_03.textContent = "Guardar comportamiento";
                const pBotonCancelarCambiosOferta_O3 = document.createElement("p");
                pBotonCancelarCambiosOferta_O3.classList.add("crearOfervaBotonV1");
                pBotonCancelarCambiosOferta_O3.classList.add("elementoOcultoInicialmente");
                pBotonCancelarCambiosOferta_O3.setAttribute("componente", "botonCancelarCambios");
                pBotonCancelarCambiosOferta_O3.setAttribute("tipoOferta", "porApartamentoDedicado");
                pBotonCancelarCambiosOferta_O3.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.ofertaModos)
                pBotonCancelarCambiosOferta_O3.textContent = "Cancelar cambios y dejar de editar";
                const pBotonEliminarOferta_O3 = document.createElement("p");
                pBotonEliminarOferta_O3.classList.add("crearOfervaBotonV1");
                pBotonEliminarOferta_O3.classList.add("elementoOcultoInicialmente");
                pBotonEliminarOferta_O3.setAttribute("componente", "botonEliminarOferta");
                pBotonEliminarOferta_O3.addEventListener("click", casaVitini.administracion.comportamiento_de_precios.detallesComportamiento.eliminarComportamiento.UI)
                pBotonEliminarOferta_O3.textContent = "Eliminar comportamiento";
                divCrearOfertaEpacioBotones_3.appendChild(pBotonGuardarOferta_03);
                divCrearOfertaEpacioBotones_3.appendChild(pBotonCancelarCambiosOferta_O3);
                divCrearOfertaEpacioBotones_3.appendChild(pBotonEliminarOferta_O3);
                divPrincipal.appendChild(porApartamentoDedicado);
                //Agregar el div principal al documento body
                divPrincipal;
            },
        },
        bloqueos_temporales: {
            arranque: async () => {
                const main = document.querySelector("main")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]

                if (comandoInicial === "gestion_de_bloqueos_temporales") {
                    main.setAttribute("zonaCSS", "administracion/gestion_de_bloqueos")
                    casaVitini.administracion.bloqueos_temporales.portadaUI()
                    return

                }
                let interruptor = "ignorar"
                const directoriosFiltrados = []
                granuladoURL.directorios.forEach((directorio) => {
                    if (interruptor === "noIgnorar") {
                        directoriosFiltrados.push(directorio)
                    }
                    if (directorio === "gestion_de_bloqueos_temporales") {
                        interruptor = "noIgnorar"
                    }
                })

                if (directoriosFiltrados.length === 1) {

                    main.setAttribute("zonaCSS", "administracion/gestion_de_bloqueos/por_apartamento")
                    return casaVitini.administracion.bloqueos_temporales.bloqueosPorApartamento.UI(directoriosFiltrados[0])
                } else if (directoriosFiltrados.length === 2) {

                    main.setAttribute("zonaCSS", "administracion/gestion_de_bloqueos/bloqueoUI")
                    return casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.UI(directoriosFiltrados)
                } else {
                    const info = {
                        titulo: "No existe ningÃºn bloqueo temporal con ese identificador.",
                        descripcion: "El bloqueo temporal que buscas con ese identificador no existe.Comprueba el identificador de la reserva"
                    }
                    casaVitini.ui.componentes.mensajeSimple(info)
                }

            },
            portadaUI: async () => {
                const selectorEspacioBotonesGlobales = document.querySelector("[componente=espacioBotonesGlobales]")
                const selectorEspacioBloqueos = document.querySelector("[componente=bloqueosTemporales]")
                const selectorTitulo = document.querySelector("[componente=titulo]")
                selectorTitulo.innerText = "Bloqueos de los Apartamentos"
                const contenedorBotonesPortada = document.createElement("div")
                contenedorBotonesPortada.classList.add("portadaBloqueos_espacioBotones")
                const botonCrearBloqueoUI = document.createElement("a")
                botonCrearBloqueoUI.classList.add("portadaBloqueos_botonV1")
                botonCrearBloqueoUI.innerHTML = "Crear un bloqueo"
                botonCrearBloqueoUI.setAttribute("vista", "/administracion/gestion_de_bloqueos_temporales/crear_bloqueo")
                botonCrearBloqueoUI.setAttribute("href", "/administracion/gestion_de_bloqueos_temporales/crear_bloqueo")
                botonCrearBloqueoUI.addEventListener("click", (boton) => {
                    boton.preventDefault()
                    const vista = boton.target.getAttribute("vista")
                    const navegacion = {
                        "vista": vista,
                        "tipoOrigen": "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(navegacion)
                })
                contenedorBotonesPortada.appendChild(botonCrearBloqueoUI)
                selectorEspacioBotonesGlobales.appendChild(contenedorBotonesPortada)
                const transaccion = {
                    zona: "administracion/bloqueos/listarApartamentosConBloqueos"
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                if (respuestaServidor?.error) {
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    const apartamentosConBloqueos = respuestaServidor?.ok
                    if (apartamentosConBloqueos.length === 0) {
                        const informacionUI = document.createElement("div")
                        informacionUI.innerText = "No hay ningun bloqueo configurado"
                        selectorEspacioBloqueos.appendChild(informacionUI)
                    }
                    apartamentosConBloqueos.forEach((detalleDelApartamento) => {
                        const apartamentoIDV = detalleDelApartamento.apartamentoIDV
                        const apartamentoUI = detalleDelApartamento.apartamentoUI
                        const numeroDeBloqueos = detalleDelApartamento.numeroDeBloqueos
                        let mensajeNumeroBloqueos
                        if (numeroDeBloqueos === 1) {
                            mensajeNumeroBloqueos = `Hay ${numeroDeBloqueos} bloqueo configurado para este apartamento`
                        }
                        if (numeroDeBloqueos > 1) {
                            mensajeNumeroBloqueos = `Hay ${numeroDeBloqueos} bloqueos configurados para este apartamento`
                        }
                        const bloqueApartamentoUI = document.createElement("a")
                        bloqueApartamentoUI.classList.add("gestionBloqueoApartamento_bloqueApartamentoUI")
                        bloqueApartamentoUI.setAttribute("apartamentoIDV", apartamentoIDV)
                        bloqueApartamentoUI.setAttribute("href", "/administracion/gestion_de_bloqueos_temporales/" + apartamentoIDV)
                        bloqueApartamentoUI.setAttribute("vista", "/administracion/gestion_de_bloqueos_temporales/" + apartamentoIDV)
                        bloqueApartamentoUI.addEventListener("click", casaVitini.administracion.bloqueos_temporales.traductorCambioVista)
                        const tituloApartamentoUI = document.createElement("div")
                        tituloApartamentoUI.classList.add("gestionBloqueoApartamento_tituloApartamentoUI")
                        tituloApartamentoUI.classList.add("negrita")
                        tituloApartamentoUI.innerText = apartamentoUI
                        bloqueApartamentoUI.appendChild(tituloApartamentoUI)
                        const numeroBloqueosUI = document.createElement("div")
                        numeroBloqueosUI.classList.add("gestionBloqueoApartamento_numeroBloqueosUI")
                        numeroBloqueosUI.innerText = mensajeNumeroBloqueos
                        bloqueApartamentoUI.appendChild(numeroBloqueosUI)
                        selectorEspacioBloqueos.appendChild(bloqueApartamentoUI)
                    })
                }
            },
            traductorCambioVista: (apartamento) => {
                apartamento.preventDefault()
                apartamento.stopPropagation()
                const vista = apartamento.target.closest("[vista]").getAttribute("vista")
                const entrada = {
                    vista: vista,
                    tipoOrigen: "menuNavegador"
                }
                casaVitini.shell.navegacion.controladorVista(entrada)
            },
            bloqueosPorApartamento: {
                UI: async (apartamento) => {
                    const seccionRenderizadaOrigen = document.querySelector("main")
                    const instanciaUID = seccionRenderizadaOrigen.getAttribute("instanciaUID")
                    const selectorTitulo = document.querySelector("[componente=titulo]")
                    selectorTitulo.innerText = "Bloqueos temporales"
                    const selectorEspacioBloqueos = document.querySelector("[componente=bloqueosTemporales]")
                    const transaccion = {
                        zona: "administracion/bloqueos/listaBloquoeosDelApartamento",
                        apartamentoIDV: apartamento
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada)
                        if (respuestaServidor?.error) {
                            const info = {
                                titulo: "No existe el identificador del apartamento",
                                descripcion: respuestaServidor.error
                            }
                            casaVitini.ui.componentes.mensajeSimple(info)
                        }
                    if (respuestaServidor?.ok) {
                        const apartamentoIDV = respuestaServidor?.apartamentoIDV
                        const apartamentoUI = respuestaServidor?.apartamentoUI
                        const bloqueos = respuestaServidor?.ok
                        selectorTitulo.innerText = "Bloqueos temporales del " + apartamentoUI
                        if (bloqueos.length === 0) {

                            const mensaje = document.createElement("p")
                            mensaje.innerText = "El apartamento no tiene ningÃºn bloqueo definido"
                            seccionRenderizadaOrigen.appendChild(mensaje)

                        }


                        bloqueos.forEach((detalleBloqueo) => {
                            const tipoBloqueoIDV = detalleBloqueo.tipoBloqueoIDV
                            const fechaInicio = detalleBloqueo.fechaInicio
                            const fechaFin = detalleBloqueo.fechaFin
                            const motivo = detalleBloqueo.motivo
                            const zonaIDV = detalleBloqueo.zonaIDV
                            const bloqueoUID = detalleBloqueo.bloqueoUID


                            //Contenedor bloqueo
                            const bloqueBloqueoUI = document.createElement("a")
                            bloqueBloqueoUI.classList.add("listaBloqueos_bloqueBloqueoUI")
                            bloqueBloqueoUI.setAttribute("bloqueoUID", bloqueoUID)
                            bloqueBloqueoUI.setAttribute("href", "/administracion/gestion_de_bloqueos_temporales/" + apartamentoIDV + "/" + bloqueoUID)
                            bloqueBloqueoUI.setAttribute("vista", "/administracion/gestion_de_bloqueos_temporales/" + apartamentoIDV + "/" + bloqueoUID)
                            bloqueBloqueoUI.addEventListener("click", casaVitini.administracion.bloqueos_temporales.bloqueosPorApartamento.traductorCambioVista)
                            let tipoBloqueoDefinicion
                            if (tipoBloqueoIDV === "rangoTemporal") {
                                tipoBloqueoDefinicion = "Rango temporal"
                            }
                            if (tipoBloqueoIDV === "permanente") {
                                tipoBloqueoDefinicion = "Permanente"
                            }
                            if (tipoBloqueoIDV === "rangoTemporal") {

                                const fechaInicio_huamna = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaInicio)
                                const fechaFin_huamna = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaFin)

                                //Contendor fechas
                                const contenedorFecha = document.createElement("div")
                                contenedorFecha.classList.add("listaBloqueo_contenedorFecha")
                                const contenedorFechaInicio = document.createElement("div")
                                contenedorFechaInicio.classList.add("administracion_bloqueos_detallesBloqueo_contenedorFechaIndividual")
                                const tipoEntradaUITituloUI = document.createElement("div")
                                tipoEntradaUITituloUI.classList.add("administracion_bloqueos_detallesBloqueo_contenedorFechaIndividual_titulo")
                                tipoEntradaUITituloUI.classList.add("negrita")
                                tipoEntradaUITituloUI.innerText = "Fecha de inicio del bloqueo"
                                contenedorFechaInicio.appendChild(tipoEntradaUITituloUI)
                                const entradaUI = document.createElement("div")
                                entradaUI.classList.add("administracion_bloqueos_detallesBloqueo_contenedorFechaIndividual_fecha")
                                entradaUI.innerText = fechaInicio_huamna
                                contenedorFechaInicio.appendChild(entradaUI)
                                contenedorFecha.appendChild(contenedorFechaInicio)
                                const contenedorFechaFin = document.createElement("div")
                                contenedorFechaFin.classList.add("administracion_bloqueos_detallesBloqueo_contenedorFechaIndividual")
                                const tipoSalidaUITituloUI = document.createElement("div")
                                tipoSalidaUITituloUI.classList.add("administracion_bloqueos_detallesBloqueo_contenedorFechaIndividual_titulo")
                                tipoSalidaUITituloUI.classList.add("negrita")
                                tipoSalidaUITituloUI.innerText = "Fecha de fin del bloqueo"
                                contenedorFechaFin.appendChild(tipoSalidaUITituloUI)
                                const salidaUI = document.createElement("div")
                                salidaUI.classList.add("administracion_bloqueos_detallesBloqueo_contenedorFechaIndividual_fecha")
                                salidaUI.innerText = fechaFin_huamna
                                contenedorFechaFin.appendChild(salidaUI)
                                contenedorFecha.appendChild(contenedorFechaFin)
                                bloqueBloqueoUI.appendChild(contenedorFecha)
                            }
                            //Contenedor Tipo bloqueo
                            const contenedorTipoBloqueo = document.createElement("div")
                            contenedorTipoBloqueo.classList.add("listaBloqueos_contenedorTipoBloqueo")
                            const tipoBloqueoTituloUI = document.createElement("div")
                            tipoBloqueoTituloUI.classList.add("administracion_bloqueos_listaBloqueos_titutloTipoBloqueo")
                            tipoBloqueoTituloUI.classList.add("negrita")
                            tipoBloqueoTituloUI.innerText = "Tipo bloqueo"
                            contenedorTipoBloqueo.appendChild(tipoBloqueoTituloUI)
                            const tipoBloqueoUI = document.createElement("div")
                            tipoBloqueoUI.classList.add("listaBloqueos_tipoBloqueo")
                            tipoBloqueoUI.innerText = tipoBloqueoDefinicion
                            contenedorTipoBloqueo.appendChild(tipoBloqueoUI)
                            bloqueBloqueoUI.appendChild(contenedorTipoBloqueo)
                            ///Contendor Zona
                            const contenedorZonaUI = document.createElement("div")
                            contenedorZonaUI.classList.add("listaBloqueo_contenedorZonaUI")
                            const tituloZonaUI = document.createElement("div")
                            tituloZonaUI.classList.add("litaBloqueos_tituloZona")
                            tituloZonaUI.classList.add("negrita")
                            tituloZonaUI.innerText = "Contexto de aplicaciÃ³n"
                            contenedorZonaUI.appendChild(tituloZonaUI)
                            let zonaDefinicionUI
                            if (zonaIDV === "privado") {
                                zonaDefinicionUI = "Privado - Solo se aplica a la zona de administraciÃ³n"
                            }
                            if (zonaIDV === "publico") {
                                zonaDefinicionUI = "PÃºblico - Solo se aplica a la zona publica"
                            } if (zonaIDV === "global") {
                                zonaDefinicionUI = "Global - Se aplica a toda la zona, tando pÃºblica como administrativa"
                            }
                            const zonaUI = document.createElement("div")
                            zonaUI.classList.add("listaBloqueos_zonaUI")
                            zonaUI.innerText = zonaDefinicionUI
                            contenedorZonaUI.appendChild(zonaUI)
                            bloqueBloqueoUI.appendChild(contenedorZonaUI)
                            let motivoFinal
                            if (motivo === null) {
                                motivoFinal = "Este bloqueo no tiene ningÃºn motivo definido, serÃ­a recomendable definir un motivo para poder identificar rÃ¡pidamente porque existe este bloqueo"
                            } else {
                                motivoFinal = motivo
                            }
                            //Motivo
                            //Contenedor motivo bloqueo
                            const contenedorMotivoBloqueo = document.createElement("div")
                            contenedorMotivoBloqueo.classList.add("listaBloqueos_contenedorTipoBloqueo")
                            const motivoBloqueoTituloUI = document.createElement("div")
                            motivoBloqueoTituloUI.classList.add("administracion_bloqueos_listaBloqueos_titutloTipoBloqueo")
                            motivoBloqueoTituloUI.classList.add("negrita")
                            motivoBloqueoTituloUI.innerText = "Motivo del bloqueo"
                            contenedorMotivoBloqueo.appendChild(motivoBloqueoTituloUI)
                            const motivoUI = document.createElement("div")
                            motivoUI.classList.add("listaBloqueos_motivo")
                            motivoUI.innerText = motivoFinal
                            contenedorMotivoBloqueo.appendChild(motivoUI)
                            bloqueBloqueoUI.appendChild(contenedorMotivoBloqueo)
                            selectorEspacioBloqueos.appendChild(bloqueBloqueoUI)
                        })
                    }
                },
                traductorCambioVista: (uidBloqueo) => {
                    uidBloqueo.preventDefault()
                    uidBloqueo.stopPropagation()
                    const vista = uidBloqueo.target.closest("[vista]").getAttribute("vista")
                    const entrada = {
                        "vista": vista,
                        "tipoOrigen": "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(entrada)
                }
            },
            detallesDelBloqueo: {
                UI: async (url) => {
                    const seccionRenderizadaOrigen = document.querySelector("main")
                    const instanciaUID = seccionRenderizadaOrigen.getAttribute("instanciaUID")
                    const apartmentoIDV = url[0]
                    const bloqueoUID = url[1]
                    const selectorTitulo = document.querySelector("[componente=titulo]")
                    selectorTitulo.innerText = "Detalles del bloqueo"
                    const selectorEspacioBloqueos = document.querySelector("[componente=bloqueosTemporales]")
                    const transaccion = {
                        zona: "administracion/bloqueos/detallesDelBloqueo",
                        apartamentoIDV: apartmentoIDV,
                        bloqueoUID: String(bloqueoUID)
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!seccionRenderizada) { return }
                    if (respuestaServidor?.error) {
                        const info = {
                            titulo: "No existe el bloqueo del apartamento",
                            descripcion: respuestaServidor.error
                        }
                        casaVitini.ui.componentes.mensajeSimple(info)
                    }
                    if (respuestaServidor?.ok) {
                        const apartamentoIDV = respuestaServidor?.apartamentoIDV
                        const apartamentoUI = respuestaServidor?.apartamentoUI
                        const detallesDelBloqueo = respuestaServidor?.ok
                        const tipoBloqueoIDV = detallesDelBloqueo.tipoBloqueoIDV
                        const fechaInicio = detallesDelBloqueo.fechaInicio
                        const fechaFin = detallesDelBloqueo.fechaFin
                        const motivo = detallesDelBloqueo.motivo
                        const zonaIDV = detallesDelBloqueo.zonaIDV
                        const bloqueoUID = detallesDelBloqueo.bloqueoUID
                        selectorTitulo.innerText = "Detalles del bloqueo " + bloqueoUID + " del " + apartamentoUI
                        const contenedorGlobal = document.createElement("div")
                        contenedorGlobal.classList.add("detallesBloqueos_contenedorGlobal")
                        contenedorGlobal.setAttribute("componente", "contenedorGlobal")
                        //Contenedor bloqueo
                        const bloqueBloqueoUI = document.createElement("div")
                        bloqueBloqueoUI.classList.add("detallesBloqueos_bloqueBloqueoUI")
                        bloqueBloqueoUI.setAttribute("componente", "contenedorDelBloqueo")
                        bloqueBloqueoUI.style.pointerEvents = "none"
                        bloqueBloqueoUI.setAttribute("bloqueoUID", bloqueoUID)
                        bloqueBloqueoUI.setAttribute("apartamentoIDV", apartamentoIDV)
                        let tipoBloqueoDefinicion
                        if (tipoBloqueoIDV === "rangoTemporal") {
                            tipoBloqueoDefinicion = "Rango temporal"
                        }
                        if (tipoBloqueoIDV === "permanente") {
                            tipoBloqueoDefinicion = "Permanente"
                        }
                        //Contenedor Tipo bloqueo
                        const contenedorTipoBloqueo = document.createElement("div")
                        contenedorTipoBloqueo.classList.add("detallesloqueos_contenedorBloquesGlobales")
                        const contenedorTipoBloqueoV2 = document.createElement("div")
                        contenedorTipoBloqueoV2.classList.add("detallesBloqueo_contenedorTipoBloqueoV2")
                        const tipoBloqueoTituloUI = document.createElement("div")
                        tipoBloqueoTituloUI.classList.add("listaBloqueos_titulo")
                        tipoBloqueoTituloUI.classList.add("negrita")
                        tipoBloqueoTituloUI.innerText = "Tipo bloqueo"
                        contenedorTipoBloqueoV2.appendChild(tipoBloqueoTituloUI)
                        const tipoBloqueoUI = document.createElement("select")
                        tipoBloqueoUI.classList.add("administracion_bloqueos_detallesBloqueo_listaSelec")
                        tipoBloqueoUI.setAttribute("datoBloqueo", "tipoBloqueoIDV")
                        tipoBloqueoUI.setAttribute("datoInicial", tipoBloqueoIDV)
                        tipoBloqueoUI.innerText = tipoBloqueoDefinicion
                        tipoBloqueoUI.addEventListener("change", casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.controladorSelectorRangoTemporalUI)
                        const opcion_permamente = document.createElement("option");
                        opcion_permamente.value = "permanente";
                        if (tipoBloqueoIDV === "permanente") {
                            opcion_permamente.selected = true;
                        }
                        opcion_permamente.text = "Permanente";
                        tipoBloqueoUI.add(opcion_permamente);
                        const opcion_rangoTemporal = document.createElement("option");
                        if (tipoBloqueoIDV === "rangoTemporal") {
                            opcion_rangoTemporal.selected = true;
                        }
                        opcion_rangoTemporal.value = "rangoTemporal";
                        opcion_rangoTemporal.text = "Rango temporal";
                        tipoBloqueoUI.add(opcion_rangoTemporal);
                        contenedorTipoBloqueoV2.appendChild(tipoBloqueoUI)
                        contenedorTipoBloqueo.appendChild(contenedorTipoBloqueoV2)
                        bloqueBloqueoUI.appendChild(contenedorTipoBloqueo)
                        const contenedorZonaUI = document.createElement("div")
                        contenedorZonaUI.classList.add("detallesBloqueo_contenedorZonaUI")
                        const tituloZonaUI = document.createElement("div")
                        tituloZonaUI.classList.add("listaBloqueos_titulo")
                        tituloZonaUI.classList.add("negrita")
                        tituloZonaUI.innerText = "Contexto de aplicaciÃ³n"
                        contenedorZonaUI.appendChild(tituloZonaUI)
                        let zonaDefinicionUI
                        if (zonaIDV === "privado") {
                            zonaDefinicionUI = "Privado - Solo se aplica a la zona de administraciÃ³n"
                        }
                        if (zonaIDV === "publico") {
                            zonaDefinicionUI = "PÃºblico - Solo se aplica a la zona publica"
                        } if (zonaIDV === "global") {
                            zonaDefinicionUI = "Global - Se aplica a toda la zona, tando pÃºblica como administrativa"
                        }
                        const zonaUI = document.createElement("select")
                        zonaUI.classList.add("administracion_bloqueos_detallesBloqueo_listaSelec")
                        zonaUI.setAttribute("datoBloqueo", "zonaIDV")
                        zonaUI.setAttribute("datoInicial", zonaIDV)
                        const opcion_publico = document.createElement("option");
                        if (zonaIDV === "publico") {
                            opcion_publico.selected = true;
                        }
                        opcion_publico.value = "publico";
                        opcion_publico.text = "PÃºblico - Zona pÃºblica";
                        zonaUI.add(opcion_publico);
                        const opcion_privado = document.createElement("option");
                        if (zonaIDV === "privado") {
                            opcion_privado.selected = true;
                        }
                        opcion_privado.value = "privado";
                        opcion_privado.text = "Privado - Zona administrativa";
                        zonaUI.add(opcion_privado);
                        const opcion_global = document.createElement("option");
                        if (zonaIDV === "global") {
                            opcion_global.selected = true;
                        }
                        opcion_global.value = "global";
                        opcion_global.text = "Global - Zona pÃºblica y administrativa";
                        zonaUI.add(opcion_global);
                        contenedorZonaUI.appendChild(zonaUI)
                        contenedorTipoBloqueo.appendChild(contenedorZonaUI)
                        if (tipoBloqueoIDV === "rangoTemporal") {
                            const metadatosconstructorRangoTemporalUI = {
                                fechaInicio,
                                fechaFin,
                                modo: "estadoConDatos"
                            }
                            const selectorRangoUI = casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.selectorRangoTemporalUI(metadatosconstructorRangoTemporalUI)
                            bloqueBloqueoUI.appendChild(selectorRangoUI)
                        }
                        if (tipoBloqueoIDV === "permanente") {
                            const metadatosconstructorRangoTemporalUI = {
                                modo: "estadoInicial"
                            }
                            const selectorRangoUI = casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.selectorRangoTemporalUI(metadatosconstructorRangoTemporalUI)
                            bloqueBloqueoUI.appendChild(selectorRangoUI)
                        }
                        ///Contendor Zona
                        const motivoUI = document.createElement("textarea")
                        motivoUI.classList.add("detalleBloqueos_motivo")
                        motivoUI.setAttribute("componente", "contenedorMotivo")
                        motivoUI.setAttribute("datoBloqueo", "motivoUI")
                        if (motivo === null) {
                            motivoUI.setAttribute("datoInicial", "")
                        } else {
                            motivoUI.setAttribute("datoInicial", motivo)
                        }
                        motivoUI.innerText = motivo
                        motivoUI.rows = 10
                        if (motivo === null) {
                            motivoUI.placeholder = "Este bloqueo no tiene ningÃºn motivo definido, serÃ­a recomendable definir un motivo para poder identificar rÃ¡pidamente porque existe este bloqueo"
                        }
                        bloqueBloqueoUI.appendChild(motivoUI)
                        contenedorGlobal.appendChild(bloqueBloqueoUI)
                        selectorEspacioBloqueos.appendChild(contenedorGlobal)
                        casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.controladorBotonesGlobales.modificar()
                    }
                },
                traductorCambioVista: (uidBloqueo) => {
                    uidBloqueo.preventDefault()
                    uidBloqueo.stopPropagation()
                    const vista = uidBloqueo.target.closest("[vista]").getAttribute("vista")
                    const entrada = {
                        "vista": vista,
                        "tipoOrigen": "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(entrada)
                },
                traductorConstructorCalendario: (calendario) => {
                    const componente = calendario.target.closest("[calendario]")
                    casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.constructorCalendario(componente)
                },
                //constructorCalendario: async (boton) => {
                //    let botonID = boton.getAttribute("componente")
                //    const alturaDinamicaArriba = casaVitini.utilidades.observador.medirPorJerarquiaDom.vertical.desdeAbajoDelElemento(boton) + 20
                //    const bloqueCalendario = document.querySelector("[componente=bloqueCalendario]")
                //    const calendario = document.querySelector("[contenedor=calendario]")
                //    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                //    if (botonID === "fechaEntrada") {
                //        if (calendario?.getAttribute("calendarioIO") === "entrada") {
                //            bloqueCalendario.remove()
                //            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                //        }
                //        if (calendario?.getAttribute("calendarioIO") === "salida") {
                //            bloqueCalendario.remove()
                //            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                //            //
                //        }
                //        let fechaEntrada = document.querySelector("[calendario=entrada][componente=fechaEntrada]").getAttribute("memoriaVolatil")
                //        let resolucionCalendario
                //        if (fechaEntrada) {
                //            fechaEntrada = fechaEntrada.split("/")
                //            let diaEntrada = fechaEntrada[0]
                //            diaEntrada = Number(diaEntrada)
                //            let mesEntrada = fechaEntrada[1]
                //            mesEntrada = Number(mesEntrada)
                //            let anoEntrada = fechaEntrada[2]
                //            anoEntrada = Number(anoEntrada)
                //            resolucionCalendario = {
                //                tipo: "personalizado",
                //                comando: "construyeObjeto",
                //                ano: anoEntrada,
                //                mes: mesEntrada
                //            }
                //        }
                //        if (!fechaEntrada) {
                //            resolucionCalendario = {
                //                tipo: "actual",
                //                comando: "construyeObjeto"
                //            }
                //        }
                //        let metadatosCalendario = {
                //            tipoFecha: "entrada",
                //            almacenamientoCalendarioID: "administracionCalendario",
                //            perfilMes: "calendario_entrada_perfilSimple",
                //            calendarioIO: "entrada",
                //            mensajeInfo: "Selecciona la fecha de inicio del bloqueo",
                //            alturaDinamica: alturaDinamicaArriba,
                //            instanciaUID: instanciaUID,
                //            metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia",
                //            seleccionableDiaLimite: "si"
                //        }
                //        casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(metadatosCalendario)
                //        document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                //        const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(resolucionCalendario)
                //        calendarioResuelto.instanciaUID = instanciaUID
                //        await casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                //    }
                //    if (botonID === "fechaSalida") {
                //        if (calendario?.getAttribute("calendarioIO") === "salida") {
                //            bloqueCalendario.remove()
                //            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)

                //        }
                //        if (calendario?.getAttribute("calendarioIO") === "entrada") {
                //            bloqueCalendario.remove()
                //            document.removeEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                //            //
                //        }
                //        let fechaSalida = document.querySelector("[calendario=salida][componente=fechaSalida]").getAttribute("memoriaVolatil")
                //        let resolucionCalendario
                //        if (fechaSalida) {
                //            fechaSalida = fechaSalida.split("/")
                //            let diaSalida = fechaSalida[0]
                //            diaSalida = Number(diaSalida)
                //            let mesSalida = fechaSalida[1]
                //            mesSalida = Number(mesSalida)
                //            let anoSalida = fechaSalida[2]
                //            anoSalida = Number(anoSalida)
                //            resolucionCalendario = {
                //                comando: "construyeObjeto",
                //                tipo: "personalizado",
                //                ano: anoSalida,
                //                mes: mesSalida
                //            }
                //        }
                //        if (!fechaSalida) {
                //            resolucionCalendario = {
                //                comando: "construyeObjeto",
                //                tipo: "actual"
                //            }
                //        }
                //        let metadatosCalendario = {
                //            tipoFecha: "salida",
                //            almacenamientoCalendarioID: "administracionCalendario",
                //            perfilMes: "calendario_salida_perfilSimple",
                //            calendarioIO: "salida",
                //            mensajeInfo: "Selecciona la fecha de final del bloqueo.",
                //            alturaDinamica: alturaDinamicaArriba,
                //            instanciaUID: instanciaUID,
                //            metodoSelectorDia: "casaVitini.ui.componentes.calendario.calendarioCompartido.seleccionarDia",
                //            seleccionableDiaLimite: "si"
                //        }
                //        casaVitini.ui.componentes.calendario.constructorCalendarioNuevo(metadatosCalendario)
                //        document.addEventListener("click", casaVitini.shell.controladoresUI.ocultarElementos)
                //        const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(resolucionCalendario)
                //        calendarioResuelto.instanciaUID = instanciaUID
                //        casaVitini.ui.componentes.calendario.constructorMesNuevo(calendarioResuelto)
                //    }
                //},
                selectorRangoTemporalUI: (rango) => {
                    const fechaInicio = rango.fechaInicio
                    const fechaFin = rango.fechaFin
                    const modo = rango.modo
                    const instanciaUID_contenedorFechas = casaVitini.utilidades.codigoFechaInstancia()

                    if (modo !== "estadoInicial" && modo !== "estadoConDatos") {
                        const error = "selectorRAngoTemporalUI necesita un modo, puede ser estadoInicial o estadoConDatos"
                        casaVitini.ui.componentes.advertenciaInmersiva(error)
                    }
                    //Contendor fechas
                    let memoriaVolatilEntrada;
                    let memoriaVolatilSalida;
                    let fechaInicioUI = ""
                    let fechaFinUI = ""
                    if (modo === "estadoConDatos") {
                        fechaInicioUI = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaInicio)
                        fechaFinUI = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaFin)
                    }
                    if (modo === "estadoInicial") {
                        fechaInicioUI = "(Seleccionar fecha de inicio)"
                        fechaFinUI = "(Seleccionar fecha de fin)"
                    }
                    const contenedorFecha = document.createElement("div")
                    contenedorFecha.classList.add("detallesDelBloqueo_contenedorFecha")
                    contenedorFecha.setAttribute("componente", "contenedorFechas")
                    contenedorFecha.setAttribute("instanciaUID_contenedorFechas", instanciaUID_contenedorFechas)

                    if (modo === "estadoInicial") {
                        contenedorFecha.style.display = "none"
                    }
                    const contenedorFechaEntrada = document.createElement("div")
                    contenedorFechaEntrada.classList.add("detallesBloqueo_contenedorFechaEntrada")
                    contenedorFechaEntrada.setAttribute("calendario", "entrada")
                    contenedorFechaEntrada.setAttribute("componente", "fechaEntrada")
                    contenedorFechaEntrada.setAttribute("paralizadorEvento", "ocultadorCalendarios")
                    if (modo === "estadoConDatos") {
                        contenedorFechaEntrada.setAttribute("memoriaVolatil", fechaInicio)
                        contenedorFechaEntrada.setAttribute("valorInicial", fechaInicio)
                    }
                    //contenedorFechaEntrada.addEventListener("click", casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.traductorConstructorCalendario)
                    contenedorFechaEntrada.addEventListener("click", async () => {
                        await casaVitini.ui.componentes.calendario.configurarCalendario({
                            perfilMes: "calendario_entrada_perfilSimple",
                            contenedorOrigenIDV: "[calendario=entrada]",
                            instanciaUID_contenedorFechas,
                            rangoIDV: "inicioRango",
                            metodoSelectorDia: null
                        })
                    })

                    const tipoEntradaUITituloUI = document.createElement("div")
                    tipoEntradaUITituloUI.classList.add("listaBloqueos_titulo")
                    tipoEntradaUITituloUI.classList.add("negrita")
                    tipoEntradaUITituloUI.innerText = "Fecha de inicio del bloqueo"
                    contenedorFechaEntrada.appendChild(tipoEntradaUITituloUI)
                    const entradaUI = document.createElement("div")
                    entradaUI.classList.add("listaBloqueos_fecha")
                    entradaUI.setAttribute("fechaUI", "fechaInicio")
                    entradaUI.innerText = fechaInicioUI
                    contenedorFechaEntrada.appendChild(entradaUI)
                    contenedorFecha.appendChild(contenedorFechaEntrada)
                    const contenedorFechaSalida = document.createElement("div")
                    contenedorFechaSalida.classList.add("detallesBloqueo_contenedorFechaSalida")
                    contenedorFechaSalida.setAttribute("calendario", "salida")
                    contenedorFechaSalida.setAttribute("componente", "fechaSalida")
                    contenedorFechaSalida.setAttribute("paralizadorEvento", "ocultadorCalendarios")
                    if (modo === "estadoConDatos") {
                        contenedorFechaSalida.setAttribute("memoriaVolatil", fechaFin)
                        contenedorFechaSalida.setAttribute("valorInicial", fechaFin)
                    }
                    //contenedorFechaSalida.addEventListener("click", casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.traductorConstructorCalendario)
                    contenedorFechaSalida.addEventListener("click", async () => {
                        await casaVitini.ui.componentes.calendario.configurarCalendario({
                            perfilMes: "calendario_salida_perfilSimple",
                            contenedorOrigenIDV: "[calendario=salida]",
                            instanciaUID_contenedorFechas,
                            rangoIDV: "finalRango",
                            metodoSelectorDia: null
                        })
                    })
                    const tipoSalidaUITituloUI = document.createElement("div")
                    tipoSalidaUITituloUI.classList.add("listaBloqueos_titulo")
                    tipoSalidaUITituloUI.classList.add("negrita")
                    tipoSalidaUITituloUI.innerText = "Fecha de fin del bloqueo"
                    contenedorFechaSalida.appendChild(tipoSalidaUITituloUI)
                    const salidaUI = document.createElement("div")
                    salidaUI.classList.add("listaBloqueos_fecha")
                    salidaUI.setAttribute("fechaUI", "fechaFin")
                    salidaUI.innerText = fechaFinUI
                    contenedorFechaSalida.appendChild(salidaUI)
                    contenedorFecha.appendChild(contenedorFechaSalida)
                    return contenedorFecha
                },
                controladorSelectorRangoTemporalUI: (tipoBloqueoUI) => {
                    const tipoBloqueo = tipoBloqueoUI.target.value
                    const selectorContenedorFechas = document.querySelector("[componente=contenedorFechas]")
                    if (tipoBloqueo === "permanente") {
                        if (selectorContenedorFechas) {
                            selectorContenedorFechas.style.display = "none"
                        }
                    }
                    if (tipoBloqueo === "rangoTemporal") {
                        if (selectorContenedorFechas) {
                            selectorContenedorFechas.style.display = "flex"
                        }
                    }
                },
                botonesDetallesBloqueoUI: (configuracion) => {
                    if (configuracion !== "crear" && configuracion !== "modificar" && configuracion !== "guardarEliminar") {
                        const error = "Este componente necesita un tipo de configuraciÃ³n, esta puede ser, crear, modificar o guardarEliminar"
                        casaVitini.ui.componentes.advertenciaInmersiva(error)
                    }
                    const selectorContenedorBotonesRenderizado = document.querySelector("[componente=contenedorBotones]")
                    selectorContenedorBotonesRenderizado?.remove()
                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.classList.add("detallesBloqueo_contenedorBotones")
                    contenedorBotones.setAttribute("componente", "contenedorBotones")
                    if (configuracion === "crear") {
                        const botonCrear = document.createElement("div")
                        botonCrear.classList.add("detallesBloqueo_botonV1")
                        botonCrear.innerText = "Crear bloqueo"
                        botonCrear.addEventListener("click", () => {
                            casaVitini.administracion.bloqueos_temporales.crearBloqueo.transactor()
                        })
                        contenedorBotones.appendChild(botonCrear)
                    }
                    if (configuracion === "modificar") {
                        const botonModificiar = document.createElement("div")
                        botonModificiar.classList.add("detallesBloqueo_botonV1")
                        botonModificiar.innerText = "Modificiar bloqueo"
                        botonModificiar.addEventListener("click", () => {
                            casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.controladorBotonesGlobales.guardarEliminar()
                        })
                        contenedorBotones.appendChild(botonModificiar)
                    }
                    if (configuracion === "guardarEliminar") {
                        const botonGuardarCambios = document.createElement("div")
                        botonGuardarCambios.classList.add("detallesBloqueo_botonV1")
                        botonGuardarCambios.innerText = "Guardar cambios"
                        botonGuardarCambios.addEventListener("click", () => {
                            casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.guardarCambios()
                        })
                        contenedorBotones.appendChild(botonGuardarCambios)
                        const botonEliminarBloqueo = document.createElement("div")
                        botonEliminarBloqueo.classList.add("detallesBloqueo_botonV1")
                        botonEliminarBloqueo.innerText = "Eliminar bloqueo"
                        botonEliminarBloqueo.addEventListener("click", () => {
                            casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.eliminarBloqueo.UI()
                        })
                        contenedorBotones.appendChild(botonEliminarBloqueo)
                        const botonCancelarCambios = document.createElement("div")
                        botonCancelarCambios.classList.add("detallesBloqueo_botonV1")
                        botonCancelarCambios.innerText = "Cancelar cambios"
                        botonCancelarCambios.addEventListener("click", () => {
                            casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.controladorBotonesGlobales.modificar()
                            casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.cancelarCambios()
                        })
                        contenedorBotones.appendChild(botonCancelarCambios)
                    }
                    return contenedorBotones
                },
                controladorBotonesGlobales: {
                    //Crear es para la seccion de crear
                    crear: () => {
                        const selectorContendorGlobal = document.querySelector("[componente=contenedorGlobal]")
                        const botonesGlobalesUI = casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.botonesDetallesBloqueoUI("crear")
                        selectorContendorGlobal.append(botonesGlobalesUI)
                    },
                    modificar: () => {
                        const selectorContendorGlobal = document.querySelector("[componente=contenedorGlobal]")
                        const botonesGlobalesUI = casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.botonesDetallesBloqueoUI("modificar")
                        selectorContendorGlobal.append(botonesGlobalesUI)
                        const selectorContendorBloqueo = document.querySelector("[componente=contenedorDelBloqueo]")
                        selectorContendorBloqueo.style.pointerEvents = "none"
                    },
                    guardarEliminar: () => {
                        const selectorContendorGlobal = document.querySelector("[componente=contenedorGlobal]")
                        const botonesGlobalesUI = casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.botonesDetallesBloqueoUI("guardarEliminar")
                        selectorContendorGlobal.append(botonesGlobalesUI)
                        const selectorContendorBloqueo = document.querySelector("[componente=contenedorDelBloqueo]")
                        selectorContendorBloqueo.style.pointerEvents = "all"
                    }
                },
                guardarCambios: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Actualizando bloqueo..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const selectorBloqueUID = document.querySelector("[bloqueoUID]")
                    const bloqueUID = selectorBloqueUID.getAttribute("bloqueoUID")
                    const selectorTipoBloqueo = document.querySelector("[datoBloqueo=tipoBloqueoIDV]")
                    const tipoBloqueoIDV = selectorTipoBloqueo.value
                    const selectorZona = document.querySelector("[datoBloqueo=zonaIDV]")
                    const zonaIDV = selectorZona.value
                    const fechaInicio = document.querySelector("[calendario=entrada").getAttribute("memoriaVolatil")
                    const fechaFin = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    const selectorMotivo = document.querySelector("[datoBloqueo=motivoUI]")
                    const motivo = selectorMotivo.value || null
                    const transaccion = {
                        zona: "administracion/bloqueos/modificarBloqueo",
                        bloqueoUID: String(bloqueUID),
                        tipoBloqueoIDV,
                        zonaIDV,
                        fechaInicio: fechaInicio,
                        fechaFin: fechaFin,
                        motivo
                    }

                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {

                        const bloqueoActualizado = respuestaServidor.bloqueo
                        const tipoBloqueoIDV = bloqueoActualizado.tipoBloqueoIDV
                        const fechaInicio = bloqueoActualizado.fechaInicio
                        const fechaFin = bloqueoActualizado.fechaFin
                        const motivo = bloqueoActualizado.motivo || ""
                        const zonaIDV = bloqueoActualizado.zonaIDV

                        if (tipoBloqueoIDV === "temporal") {
                            const fechaInicio_elemento = document.querySelector("[calendario=entrada]")
                            const fechaFin_elemento = document.querySelector("[calendario=salida]")
                            const fechaInicio_ISO = fechaInicio_elemento.getAttribute("memoriaVolatil")
                            const fechaFin_ISO = fechaFin_elemento.getAttribute("memoriaVolatil")

                            const fechaInicio_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaInicio)
                            const fechaFin_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaFin)

                            document.querySelector("[fechaUI=fechaInicio]").innerText = fechaInicio_humana
                            fechaInicio_elemento.setAttribute("valorInicial", fechaInicio_ISO)

                            document.querySelector("[fechaUI=fechaFin]").innerText = fechaFin_humana
                            fechaFin_elemento.setAttribute("valorInicial", fechaFin_ISO)
                        }

                        selectorTipoBloqueo.setAttribute("datoInicial", tipoBloqueoIDV)
                        selectorTipoBloqueo.value = tipoBloqueoIDV
                        selectorZona.setAttribute("datoInicial", zonaIDV)
                        selectorZona.value = zonaIDV
                        selectorMotivo.setAttribute("datoInicial", motivo)
                        selectorMotivo.value = motivo
                        casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.controladorBotonesGlobales.modificar()
                        const selectorContendorBloqueo = document.querySelector("[componente=contenedorDelBloqueo]")
                        selectorContendorBloqueo.style.pointerEvents = "none"
                    }
                },
                eliminarBloqueo: {
                    UI: async () => {

                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                        const titulo = constructor.querySelector("[componente=titulo]")
                        titulo.innerText = "Confirmar eliminar el bloqueo"
                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                        mensaje.innerText = "Vas a eliminar el bloqueo y sus implicaciones serÃ¡n inmediatas. Â¿EstÃ¡s de acuerdo?"

                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                        botonAceptar.innerText = "Confirmar la eliminaciÃ³n"
                        botonAceptar.addEventListener("click", casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.eliminarBloqueo.confirmar)
                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                        botonCancelar.innerText = "Cancelar la eliminaciÃ³n"

                        document.querySelector("main").appendChild(pantallaInmersiva)

                    },
                    confirmar: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Elimiando bloqueo..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const bloqueoUID = document.querySelector("[bloqueoUID]").getAttribute("bloqueoUID")
                        const apartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                        const transaccion = {
                            zona: "administracion/bloqueos/eliminarBloqueo",
                            bloqueoUID: String(bloqueoUID)
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()

                        if (respuestaServidor?.error) {
                            casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const tipoRetroceso = respuestaServidor?.tipoRetroceso
                            let vistaFinal
                            if (tipoRetroceso === "aPortada") {
                                vistaFinal = `/administracion/gestion_de_bloqueos_temporales`
                            }
                            if (tipoRetroceso === "aApartamento") {
                                vistaFinal = `/administracion/gestion_de_bloqueos_temporales/` + apartamentoIDV
                            }
                            const navegacion = {
                                vista: vistaFinal,
                                //tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                },
                cancelarCambios: () => {
                    //Revertir cambios
                    const tipoBloqueo = document.querySelector("[datoBloqueo=tipoBloqueoIDV]")
                    const zona = document.querySelector("[datoBloqueo=zonaIDV]")
                    const motivo = document.querySelector("[datoBloqueo=motivoUI]")
                    const fechaInicio = document.querySelector("[calendario=entrada]")
                    const fechaFin = document.querySelector("[calendario=salida]")
                    const tipoBloqueoInicial = tipoBloqueo.getAttribute("datoInicial")
                    const zonaInicial = zona.getAttribute("datoInicial")
                    const motivoInicial = motivo.getAttribute("datoInicial") || ""
                    const fechaInicio_valorInicial = fechaInicio.getAttribute("valorInicial")
                    const fechaFin_valorInicial = fechaFin.getAttribute("valorInicial")

                    if (tipoBloqueoInicial === "rangoTemporal") {
                        const fechaInicio_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaInicio_valorInicial)
                        const fechaFinal_humana = casaVitini.utilidades.conversor.fecha_ISO_hacia_humana(fechaFin_valorInicial)

                        fechaInicio.querySelector("[fechaUI=fechaInicio]").innerText = fechaInicio_humana
                        fechaFin.querySelector("[fechaUI=fechaFin]").innerText = fechaFinal_humana
                    }

                    tipoBloqueo.value = tipoBloqueoInicial
                    zona.value = zonaInicial
                    motivo.value = motivoInicial
                    const contenedorFechas = document.querySelector("[componente=contenedorFechas]")
                    if (tipoBloqueoInicial === "rangoTemporal") {
                        contenedorFechas.style.display = "flex"
                    }
                    if (tipoBloqueoInicial === "permanente") {
                        contenedorFechas.style.display = "none"
                    }
                    //Em en el caso de la fecha hay que eliminar las propuestas
                    const selectorNuevasPropuestas = document.querySelectorAll("[componente=bloqueNuevaPropuesta]")
                    selectorNuevasPropuestas.forEach((nuevaPropuesta) => {
                        nuevaPropuesta.remove()
                    })
                }
            },
            componentes: {
                seleccionarDia_antiguo: (dia) => {
                    let diaSeleccionadoComoElemento = dia.target;
                    let calendario = document.querySelector("[componente=bloqueCalendario] [componente=marcoCalendario]")
                    let calendarioIO = calendario.getAttribute("calendarioIO")
                    let diaSeleccionado = dia.target.getAttribute("dia")
                    const diaSeleccionadoTexto = diaSeleccionado.padStart(2, "0")
                    const diaSeleccionadoNumero = Number(diaSeleccionado)
                    let mesSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("mes")
                    const mesSeleccionadoTexto = mesSeleccionado.padStart(2, "0")
                    const mesmesSeleccionadoNumero = Number(mesSeleccionado)
                    const anoSeleccionado = Number(document.querySelector("[componente=mesReferencia]").getAttribute("ano"))
                    let fechaSeleccionadaUI = `${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}`
                    const fechaSeleccionadaTexto = `${diaSeleccionadoTexto}/${mesSeleccionadoTexto}/${anoSeleccionado}`
                    let selectorDias = document.querySelectorAll("[calendarioIO] [dia]")
                    const memoriaVolatilInicialEntrada = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatilInicial")
                    let diaInicialEntrada
                    let mesInicialEntrada
                    let anoInicialEntrada
                    if (memoriaVolatilInicialEntrada) {
                        const memoriaVolatilInicialEntradaFormateada = memoriaVolatilInicialEntrada.split("/")
                        diaInicialEntrada = memoriaVolatilInicialEntradaFormateada[0]
                        mesInicialEntrada = memoriaVolatilInicialEntradaFormateada[1]
                        anoInicialEntrada = memoriaVolatilInicialEntradaFormateada[2]
                    }
                    const memoriaVolatilInicialSalida = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatilInicial")
                    let diaSalidaEntrada
                    let mesSalidaEntrada
                    let anoSalidaEntrada
                    if (memoriaVolatilInicialSalida) {
                        const memoriaVolatilInicialSalidaFormateada = memoriaVolatilInicialSalida.split("/")
                        diaSalidaEntrada = memoriaVolatilInicialSalidaFormateada[0]
                        mesSalidaEntrada = memoriaVolatilInicialSalidaFormateada[1]
                        anoSalidaEntrada = memoriaVolatilInicialSalidaFormateada[2]
                    }
                    const fechaEntradaVolatil_Humana = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoEntrada
                    let mesSeleccionadoEntrada
                    let anoSeleccionadoEntrada
                    if (fechaEntradaVolatil_Humana) {
                        const fechaEntradaAarray = fechaEntradaVolatil_Humana.split("/")
                        diaSeleccionadoEntrada = Number(fechaEntradaAarray[0])
                        mesSeleccionadoEntrada = Number(fechaEntradaAarray[1])
                        anoSeleccionadoEntrada = Number(fechaEntradaAarray[2])
                        datosFechaEntradaSeleccionada = "existen"
                    }
                    const fechaSalidaVolatil_Humana = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoSalida
                    let mesSeleccionadoSalida
                    let anoSeleccionadoSalida
                    let datosFechaSalidaSeleccionada
                    if (fechaSalidaVolatil_Humana) {
                        const fechaSaliraArray = fechaSalidaVolatil_Humana.split("/")
                        diaSeleccionadoSalida = Number(fechaSaliraArray[0])
                        mesSeleccionadoSalida = Number(fechaSaliraArray[1])
                        anoSeleccionadoSalida = Number(fechaSaliraArray[2])
                        datosFechaSalidaSeleccionada = "existen"
                    }
                    selectorDias.forEach((dia) => {
                        //dia.classList.remove("calendarioDiaDisponible")
                        dia.classList.remove("calendarioDiaReserva")
                        dia.classList.remove("calendarioDiaSeleccionado")
                    })
                    if (diaSeleccionadoComoElemento.getAttribute("estadoDia") === "seleccionado") {
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        if (calendarioIO === "entrada") {
                            document.querySelector("[calendario=entrada][componente=fechaEntrada] [componente=bloqueNuevaPropuesta]")?.remove()
                            if (!memoriaVolatilInicialEntrada) {
                                document.querySelector("[calendario=entrada]").removeAttribute("memoriaVolatil")
                            }
                            if (memoriaVolatilInicialEntrada) {
                                document.querySelector("[calendario=entrada]").setAttribute("memoriaVolatil", memoriaVolatilInicialEntrada)
                                if (mesInicialEntrada === mesSeleccionado && anoSeleccionado === anoInicialEntrada) {
                                    selectorDias.forEach((dia) => {
                                        if (Number(dia.getAttribute("dia")) === Number(diaInicialEntrada)) {
                                            dia.classList.add("calendarioDiaSeleccionado")
                                        }
                                        if (Number(dia.getAttribute("dia")) > Number(diaInicialEntrada) && Number(dia.getAttribute("dia")) < diaSalidaEntrada) {
                                            dia.classList.add("calendarioDiaReserva")
                                        }
                                    })
                                }
                            }
                        }
                        if (calendarioIO === "salida") {
                            document.querySelector("[calendario=salida][componente=fechaSalida] [componente=bloqueNuevaPropuesta]")?.remove()
                            if (!memoriaVolatilInicialSalida) {
                                document.querySelector("[calendario=salida]").removeAttribute("memoriaVolatil")
                            }
                            if (memoriaVolatilInicialSalida) {
                                document.querySelector("[calendario=salida]").setAttribute("memoriaVolatil", memoriaVolatilInicialSalida)
                                if (mesSalidaEntrada === mesSeleccionado && anoSeleccionado === anoSalidaEntrada) {
                                    selectorDias.forEach((dia) => {
                                        if (Number(dia.getAttribute("dia")) === Number(diaSalidaEntrada)) {
                                            dia.classList.add("calendarioDiaSeleccionado")
                                        }
                                        if (Number(dia.getAttribute("dia")) < Number(diaSalidaEntrada) && Number(dia.getAttribute("dia")) > diaInicialEntrada) {
                                            dia.classList.add("calendarioDiaReserva")
                                        }
                                    })
                                }
                            }
                        }
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        diaSeleccionadoComoElemento.removeAttribute("estadoDia")

                    }
                    let diasDisponibles = document.querySelectorAll("[estado=disponible]")
                    diasDisponibles.forEach(diaDisponible => {
                        diaDisponible.removeAttribute("estadoDia")
                        diaDisponible.style.background = ""
                        diaDisponible.style.color = ""
                    })
                    diaSeleccionadoComoElemento.setAttribute("estadoDia", "seleccionado")
                    diaSeleccionadoComoElemento.classList.add("calendarioDiaSeleccionado")
                    if (calendarioIO === "entrada") {
                        document.querySelector("[calendario=entrada]").setAttribute("memoriaVolatil", fechaSeleccionadaTexto)
                        if (fechaSalidaVolatil_Humana) {
                            if (mesSeleccionadoSalida === mesSeleccionado && anoSeleccionado === anoSeleccionadoSalida) {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado && Number(dia.getAttribute("dia")) < diaSeleccionadoSalida) {
                                        dia.classList.remove("calendarioDiaDisponible")
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado) {
                                        dia.classList.remove("calendarioDiaDisponible")
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                        const selectorBloqueFechaEntrada = document.querySelector("[calendario=entrada][componente=fechaEntrada]")
                        document.querySelector("[calendario=entrada][componente=fechaEntrada] [componente=bloqueNuevaPropuesta]")?.remove()
                        const bloqueNuevaPropuesta = document.createElement("div")
                        bloqueNuevaPropuesta.classList.add("adminsitracion_bloqueos_detallesBloquoes_contenedorNuevaPropuesta")
                        bloqueNuevaPropuesta.setAttribute("componente", "bloqueNuevaPropuesta")
                        bloqueNuevaPropuesta.setAttribute("datoBloqueo", "fechaInicio")
                        bloqueNuevaPropuesta.setAttribute("fechaInicioPropuesta", fechaSeleccionadaTexto)
                        bloqueNuevaPropuesta.innerText = `Nueva fecha de inicio de bloqueo propuesta: ${fechaSeleccionadaUI}. Para guardar la propueda, guarde los cambios. Para cancelar pulse ne cancelar cambios.`
                        selectorBloqueFechaEntrada.appendChild(bloqueNuevaPropuesta)
                    }
                    if (calendarioIO === "salida") {
                        document.querySelector("[calendario=salida]").setAttribute("memoriaVolatil", fechaSeleccionadaTexto)
                        //document.querySelector("[calendario=salida]").setAttribute("fechaFinFinal", fechaSeleccionadaUI)
                        if (fechaEntradaVolatil_Humana) {
                            if (mesSeleccionadoEntrada === mesSeleccionado && anoSeleccionado === anoSeleccionadoEntrada) {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado && Number(dia.getAttribute("dia")) > diaSeleccionadoEntrada) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                        const selectorBloqueFechaSalida = document.querySelector("[calendario=salida][componente=fechaSalida]")
                        document.querySelector("[calendario=salida][componente=fechaSalida] [componente=bloqueNuevaPropuesta]")?.remove()
                        const bloqueNuevaPropuesta = document.createElement("div")
                        bloqueNuevaPropuesta.classList.add("adminsitracion_bloqueos_detallesBloquoes_contenedorNuevaPropuesta")
                        bloqueNuevaPropuesta.setAttribute("componente", "bloqueNuevaPropuesta")
                        bloqueNuevaPropuesta.setAttribute("datoBloqueo", "fechaFin")
                        bloqueNuevaPropuesta.setAttribute("fechaFinPropuesta", fechaSeleccionadaTexto)
                        bloqueNuevaPropuesta.innerText = `Nueva fecha de fin de bloqueo propuesta: ${fechaSeleccionadaUI}. Para guardar la propuesta, guarde los cambios. Para cancelar, pulse en cancelar cambios.`
                        selectorBloqueFechaSalida.appendChild(bloqueNuevaPropuesta)
                    }
                },
                seleccionarDia: (dia) => {
                    let diaSeleccionadoComoElemento = dia.target;
                    let calendario = document.querySelector("[componente=bloqueCalendario] [componente=marcoCalendario]")
                    let calendarioIO = calendario.getAttribute("calendarioIO")
                    const diaSeleccionado = dia.target.getAttribute("dia").padStart(2, "0")
                    const anoSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("ano").padStart(4, "0")
                    const mesSeleccionado = document.querySelector("[componente=mesReferencia]").getAttribute("mes").padStart(2, "0")
                    let fechaSeleccionada = {
                        dia: diaSeleccionado,
                        mes: mesSeleccionado,
                        ano: anoSeleccionado
                    }
                    const fechaSeleccionadaUI = `${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}`
                    const fechaSeleccionadaTexto = `${diaSeleccionado}/${mesSeleccionado}/${anoSeleccionado}`
                    let selectorDias = document.querySelectorAll("[calendarioIO] [dia]")
                    selectorDias.forEach((dia) => {
                        //dia.classList.remove("calendarioDiaDisponible")
                        dia.classList.remove("calendarioDiaReserva")
                        dia.classList.remove("calendarioDiaSeleccionado")
                    })
                    if (diaSeleccionadoComoElemento.getAttribute("estadoDia") === "seleccionado") {
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        if (calendarioIO === "entrada") {
                            document.querySelector("[calendario=entrada]").removeAttribute("memoriaVolatil")
                            //document.querySelector("[dataReserva=fechaEntrada]").innerText = "Seleccionar fecha de entrada"
                        }
                        if (calendarioIO === "salida") {
                            document.querySelector("[calendario=salida]").removeAttribute("memoriaVolatil")
                            //document.querySelector("[dataReserva=fechaSalida]").innerText = "Seleccionar fecha de salida"
                        }
                        diaSeleccionadoComoElemento.classList.remove("calendarioDiaSeleccionado")
                        diaSeleccionadoComoElemento.removeAttribute("estadoDia")

                    }
                    let diasDisponibles = document.querySelectorAll("[estado=disponible]")
                    diasDisponibles.forEach(diaDisponible => {
                        diaDisponible.removeAttribute("estadoDia")
                        diaDisponible.style.background = ""
                        diaDisponible.style.color = ""
                    })
                    diaSeleccionadoComoElemento.setAttribute("estadoDia", "seleccionado")
                    diaSeleccionadoComoElemento.classList.add("calendarioDiaSeleccionado")
                    let fechaEntradaSelecionda = document.querySelector("[calendario=entrada]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoEntrada
                    let mesSeleccionadoEntrada
                    let anoSeleccionadoEntrada
                    let datosFechaEntradaSeleccionada
                    if (fechaEntradaSelecionda) {
                        const fechaEntradaSelecionda_array = fechaEntradaSelecionda.split("/")
                        diaSeleccionadoEntrada = fechaEntradaSelecionda_array[0]
                        diaSeleccionadoEntrada = Number(diaSeleccionadoEntrada)
                        mesSeleccionadoEntrada = fechaEntradaSelecionda_array[1]
                        mesSeleccionadoEntrada = Number(mesSeleccionadoEntrada)
                        anoSeleccionadoEntrada = fechaEntradaSelecionda_array[2]
                        anoSeleccionadoEntrada = Number(anoSeleccionadoEntrada)
                        datosFechaEntradaSeleccionada = "existen"
                    }
                    let fechaSalidaSelecionda = document.querySelector("[calendario=salida]").getAttribute("memoriaVolatil")
                    let diaSeleccionadoSalida
                    let mesSeleccionadoSalida
                    let anoSeleccionadoSalida
                    let datosFechaSalidaSeleccionada
                    if (fechaSalidaSelecionda) {
                        const fechaSalidaSelecionda_array = fechaSalidaSelecionda.split("/")
                        diaSeleccionadoSalida = fechaSalidaSelecionda_array[0]
                        diaSeleccionadoSalida = Number(diaSeleccionadoSalida)
                        mesSeleccionadoSalida = fechaSalidaSelecionda_array[1]
                        mesSeleccionadoSalida = Number(mesSeleccionadoSalida)
                        anoSeleccionadoSalida = fechaSalidaSelecionda_array[2]
                        anoSeleccionadoSalida = Number(anoSeleccionadoSalida)
                        datosFechaSalidaSeleccionada = "existen"
                    }
                    if (calendarioIO === "entrada") {
                        document.querySelector("[calendario=entrada]").setAttribute("memoriaVolatil", fechaSeleccionadaUI)
                        document.querySelector("[calendario=entrada]").setAttribute("fechaInicioFinal", fechaSeleccionadaUI)
                        //document.querySelector("[data=fechaInicioData]").innerText = fechaSeleccionadaUI
                        if (fechaSalidaSelecionda) {
                            if (mesSeleccionadoSalida === mesSeleccionado && anoSeleccionado === anoSeleccionadoSalida) {
                                selectorDias.forEachEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado && Number(dia.getAttribute("dia")) <= diaSeleccionadoSalida) {
                                        // dia.classList.remove("calendarioDiaDisponible")
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) > diaSeleccionado) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                        const selectorBloqueFechaEntrada = document.querySelector("[calendario=entrada][componente=fechaEntrada]")
                        document.querySelector("[calendario=entrada][componente=fechaEntrada] [componente=bloqueNuevaPropuesta]")?.remove()
                        const bloqueNuevaPropuesta = document.createElement("div")
                        bloqueNuevaPropuesta.classList.add("adminsitracion_bloqueos_detallesBloquoes_contenedorNuevaPropuesta")
                        bloqueNuevaPropuesta.setAttribute("componente", "bloqueNuevaPropuesta")
                        bloqueNuevaPropuesta.setAttribute("datoBloqueo", "fechaInicio")
                        bloqueNuevaPropuesta.setAttribute("fechaInicioPropuesta", fechaSeleccionadaTexto)
                        bloqueNuevaPropuesta.innerText = `Nueva fecha de inicio de bloqueo propuesta: ${fechaSeleccionadaUI}. Para guardar la propuesta, guarde los cambios. Para cancelar, pulse en cancelar cambios.`
                        selectorBloqueFechaEntrada.appendChild(bloqueNuevaPropuesta)
                    }
                    if (calendarioIO === "salida") {
                        document.querySelector("[calendario=salida]").setAttribute("memoriaVolatil", fechaSeleccionadaUI)
                        document.querySelector("[calendario=salida]").setAttribute("fechaFinFinal", fechaSeleccionadaUI)
                        //document.querySelector("[data=fechaFinData]").innerText = fechaSeleccionadaUI
                        if (fechaEntradaSelecionda) {
                            if (mesSeleccionadoEntrada === mesSeleccionado && anoSeleccionado === anoSeleccionadoEntrada) {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado && Number(dia.getAttribute("dia")) >= diaSeleccionadoEntrada) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            } else {
                                selectorDias.forEach((dia) => {
                                    if (Number(dia.getAttribute("dia")) < diaSeleccionado) {
                                        dia.classList.add("calendarioDiaReserva")
                                    }
                                })
                            }
                        }
                        const selectorBloqueFechaSalida = document.querySelector("[calendario=salida][componente=fechaSalida]")
                        document.querySelector("[calendario=salida][componente=fechaSalida] [componente=bloqueNuevaPropuesta]")?.remove()
                        const bloqueNuevaPropuesta = document.createElement("div")
                        bloqueNuevaPropuesta.classList.add("adminsitracion_bloqueos_detallesBloquoes_contenedorNuevaPropuesta")
                        bloqueNuevaPropuesta.setAttribute("componente", "bloqueNuevaPropuesta")
                        bloqueNuevaPropuesta.setAttribute("datoBloqueo", "fechaFin")
                        bloqueNuevaPropuesta.setAttribute("fechaFinPropuesta", fechaSeleccionadaTexto)
                        bloqueNuevaPropuesta.innerText = `Nueva fecha de fin de bloqueo propuesta: ${fechaSeleccionadaUI}. Para guardar la propuesta, guarde los cambios. Para cancelar pulse en cancelar cambios.`
                        selectorBloqueFechaSalida.appendChild(bloqueNuevaPropuesta)
                    }
                },
            },
            crearBloqueo: {
                arranque: () => {
                    casaVitini.administracion.bloqueos_temporales.crearBloqueo.UI()
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/gestion_de_bloqueos/bloqueoUI")
                },
                UI: async () => {
                    const selectorEspacioBloqueos = document.querySelector("[componente=bloqueosTemporales]")
                    const contenedorGlobal = document.createElement("div")
                    contenedorGlobal.classList.add("detallesBloqueos_contenedorGlobal")
                    contenedorGlobal.setAttribute("componente", "contenedorGlobal")
                    //Contenedor bloqueo
                    const bloqueBloqueoUI = document.createElement("div")
                    bloqueBloqueoUI.classList.add("detallesBloqueos_bloqueBloqueoUI")
                    bloqueBloqueoUI.setAttribute("componente", "contenedorDelBloqueo")
                    //Contenedor selector apartmetnos
                    const contenedorOpcionesTroncales = document.createElement("div")
                    contenedorOpcionesTroncales.classList.add("detallesloqueos_contenedorBloquesGlobales")
                    const contenedorApartamentosV2 = document.createElement("div")
                    contenedorApartamentosV2.classList.add("detallesBloqueo_contenedorTipoBloqueoV2")
                    const tipoApartamentoTituloUI = document.createElement("div")
                    tipoApartamentoTituloUI.classList.add("listaBloqueos_titulo")
                    tipoApartamentoTituloUI.classList.add("negrita")
                    tipoApartamentoTituloUI.innerText = "Apartamento: "
                    contenedorApartamentosV2.appendChild(tipoApartamentoTituloUI)
                    const tipoApartamentoUI = document.createElement("select")
                    tipoApartamentoUI.classList.add("administracion_bloqueos_detallesBloqueo_listaSelec")
                    tipoApartamentoUI.setAttribute("datoBloqueo", "apartamento")
                    tipoApartamentoUI.addEventListener("change", casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.controladorSelectorRangoTemporalUI)
                    const tipoApartamentoInicio = document.createElement("option");
                    tipoApartamentoInicio.value = "";
                    tipoApartamentoInicio.selected = true;
                    tipoApartamentoInicio.disabled = true;
                    tipoApartamentoInicio.text = "Seleccionar el apartamento";
                    tipoApartamentoUI.add(tipoApartamentoInicio);
                    const apartamentosArray = await casaVitini.administracion.bloqueos_temporales.crearBloqueo.obtenerApartamentos()
                    if (apartamentosArray.length === 0) {
                        const opcion = document.createElement("option");
                        opcion.value = "";
                        opcion.disabled = true;
                        opcion.text = "No hay ningun apartamento disponible";
                        tipoApartamentoUI.add(opcion);
                    }
                    if (apartamentosArray.length > 0) {
                        apartamentosArray.forEach((detallesApartamento) => {
                            const apartamentoIDV = detallesApartamento.apartamentoIDV
                            const aparatmentoUI = detallesApartamento.apartamentoUI
                            const opcion = document.createElement("option");
                            opcion.value = apartamentoIDV;
                            opcion.text = aparatmentoUI;
                            tipoApartamentoUI.add(opcion);
                        })
                    }
                    contenedorApartamentosV2.appendChild(tipoApartamentoUI)
                    contenedorOpcionesTroncales.appendChild(contenedorApartamentosV2)
                    const contenedorTipoBloqueoV2 = document.createElement("div")
                    contenedorTipoBloqueoV2.classList.add("detallesBloqueo_contenedorTipoBloqueoV2")
                    const tipoBloqueoTituloUI = document.createElement("div")
                    tipoBloqueoTituloUI.classList.add("listaBloqueos_titulo")
                    tipoBloqueoTituloUI.classList.add("negrita")
                    tipoBloqueoTituloUI.innerText = "Tipo bloqueo"
                    contenedorTipoBloqueoV2.appendChild(tipoBloqueoTituloUI)
                    const tipoBloqueoUI = document.createElement("select")
                    tipoBloqueoUI.classList.add("administracion_bloqueos_detallesBloqueo_listaSelec")
                    tipoBloqueoUI.setAttribute("datoBloqueo", "tipoBloqueoIDV")
                    tipoBloqueoUI.addEventListener("change", casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.controladorSelectorRangoTemporalUI)
                    const tipoBloqueoInicio = document.createElement("option");
                    tipoBloqueoInicio.value = "";
                    tipoBloqueoInicio.selected = true;
                    tipoBloqueoInicio.disabled = true;
                    tipoBloqueoInicio.text = "Seleccionar el tipo de bloqueo";
                    tipoBloqueoUI.add(tipoBloqueoInicio);
                    const opcion_permamente = document.createElement("option");
                    opcion_permamente.value = "permanente";
                    opcion_permamente.text = "Permanente";
                    tipoBloqueoUI.add(opcion_permamente);
                    const opcion_rangoTemporal = document.createElement("option");
                    opcion_rangoTemporal.value = "rangoTemporal";
                    opcion_rangoTemporal.text = "Rango temporal";
                    tipoBloqueoUI.add(opcion_rangoTemporal);
                    contenedorTipoBloqueoV2.appendChild(tipoBloqueoUI)
                    contenedorOpcionesTroncales.appendChild(contenedorTipoBloqueoV2)
                    const contenedorZonaUI = document.createElement("div")
                    contenedorZonaUI.classList.add("detallesBloqueo_contenedorZonaUI")
                    const tituloZonaUI = document.createElement("div")
                    tituloZonaUI.classList.add("litaBloqueos_tituloZona")
                    tituloZonaUI.classList.add("negrita")
                    tituloZonaUI.innerText = "Contexto de aplicaciÃ³n"
                    contenedorZonaUI.appendChild(tituloZonaUI)
                    const zonaUI = document.createElement("select")
                    zonaUI.classList.add("administracion_bloqueos_detallesBloqueo_listaSelec")
                    zonaUI.setAttribute("datoBloqueo", "zonaIDV")
                    const zonaInicio = document.createElement("option");
                    zonaInicio.value = "";
                    zonaInicio.selected = true;
                    zonaInicio.disabled = true;
                    zonaInicio.text = "Seleccionar en que zona se aplica en bloqueo";
                    zonaUI.add(zonaInicio);
                    const opcion_publico = document.createElement("option");
                    opcion_publico.value = "publico";
                    opcion_publico.text = "PÃºblico - Zona pÃºblica";
                    zonaUI.add(opcion_publico);
                    const opcion_privado = document.createElement("option");
                    opcion_privado.value = "privado";
                    opcion_privado.text = "Privado - Zona administrativa";
                    zonaUI.add(opcion_privado);
                    const opcion_global = document.createElement("option");
                    opcion_global.value = "global";
                    opcion_global.text = "Global - Zona pÃºblica y administrativa";
                    zonaUI.add(opcion_global);
                    contenedorZonaUI.appendChild(zonaUI)
                    contenedorOpcionesTroncales.appendChild(contenedorZonaUI)
                    bloqueBloqueoUI.appendChild(contenedorOpcionesTroncales)
                    const metadatosconstructorRangoTemporalUI = {
                        modo: "estadoInicial"
                    }
                    const selectorRangoUI = casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.selectorRangoTemporalUI(metadatosconstructorRangoTemporalUI)
                    bloqueBloqueoUI.appendChild(selectorRangoUI)
                    ///Contendor Zona
                    const motivoUI = document.createElement("textarea")
                    motivoUI.classList.add("detalleBloqueos_motivo")
                    motivoUI.setAttribute("componente", "contenedorMotivo")
                    motivoUI.setAttribute("datoBloqueo", "motivoUI")
                    motivoUI.rows = 10
                    motivoUI.placeholder = "Escriba una breve descripciÃ³n de por quÃ© existe este bloqueo. Esto ayudarÃ¡ a recordar rÃ¡pidamente por quÃ© existe este bloqueo, no es obligatorio pero sÃ­ recomendable."
                    bloqueBloqueoUI.appendChild(motivoUI)
                    contenedorGlobal.appendChild(bloqueBloqueoUI)
                    selectorEspacioBloqueos.appendChild(contenedorGlobal)
                    casaVitini.administracion.bloqueos_temporales.detallesDelBloqueo.controladorBotonesGlobales.crear()
                },
                transactor: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Creando bloqueo..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const apartamentoIDV = document.querySelector("[datoBloqueo=apartamento]").value
                    const tipoBloqueoIDV = document.querySelector("[datoBloqueo=tipoBloqueoIDV]").value
                    const zonaIDV = document.querySelector("[datoBloqueo=zonaIDV]").value
                    const fechaInicio = document.querySelector("[calendario=entrada")?.getAttribute("memoriaVolatil")
                    const fechaFin = document.querySelector("[calendario=salida]")?.getAttribute("memoriaVolatil")
                    const motivo = document.querySelector("[datoBloqueo=motivoUI]").value || null
                    const transaccion = {
                        zona: "administracion/bloqueos/crearNuevoBloqueo",
                        apartamentoIDV,
                        tipoBloqueoIDV,
                        zonaIDV,
                        fechaInicio,
                        fechaFin,
                        motivo,
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const nuevoUID = respuestaServidor?.nuevoBloqueoUID
                        const vistaFinal = `/administracion/gestion_de_bloqueos_temporales/` + apartamentoIDV + "/" + nuevoUID
                        const navegacion = {
                            vista: vistaFinal,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    }
                },
                obtenerApartamentos: async () => {
                    const transaccion = {
                        zona: "administracion/componentes/apartamentosDisponiblesConfigurados"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        return respuestaServidor?.ok
                    }
                }
            }
        },
        arquitectura_del_alojamiento: {
            arranque: async () => {
                const main = document.querySelector("main")
                main.setAttribute("zonaCSS", "administracion/arquitectura_de_alojamiento")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                casaVitini.administracion.arquitectura_del_alojamiento.portadaUI()
            },
            portadaUI: () => {
                const espacioBotonesGlobales = document.querySelector("[componente=espacioBotonesGlobales]")
                const espacioConfiguracionDelAlojamiento = document.querySelector("[componente=configuracionDelAlojamiento]")
                const contenedorBotonesPortada = document.createElement("dv")
                contenedorBotonesPortada.classList.add("confAlojamiento_contenedor")
                const botonAlojameintoUI = document.createElement("a")
                botonAlojameintoUI.classList.add("confAlojamiento_botonPortadaUI")
                botonAlojameintoUI.innerText = "ConfiguraciÃ³n del alojamiento"
                botonAlojameintoUI.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/configuraciones")
                botonAlojameintoUI.setAttribute("href", "/administracion/arquitectura_del_alojamiento/configuraciones")
                botonAlojameintoUI.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                contenedorBotonesPortada.appendChild(botonAlojameintoUI)
                const botonEntidadesAlojamientoUI = document.createElement("a")
                botonEntidadesAlojamientoUI.classList.add("confAlojamiento_botonPortadaUI")
                botonEntidadesAlojamientoUI.innerText = "Entidades de alojamiento"
                botonEntidadesAlojamientoUI.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/entidades")
                botonEntidadesAlojamientoUI.setAttribute("href", "/administracion/arquitectura_del_alojamiento/entidades")
                botonEntidadesAlojamientoUI.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                contenedorBotonesPortada.appendChild(botonEntidadesAlojamientoUI)
                espacioConfiguracionDelAlojamiento.appendChild(contenedorBotonesPortada)
            },
            entidades: {
                arranque: () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/arquitectura_de_alojamiento/entidades")
                    const urlRaw = window.location.pathname;
                    let url = urlRaw.toLowerCase()
                    url = url.split("/")
                    url = url.filter((url) => url)
                    delete url[0]
                    delete url[1]
                    delete url[2]
                    url = url.filter((url) => url)
                    if (url.length === 0) {

                        casaVitini.administracion.arquitectura_del_alojamiento.entidades.portadaUI()

                    } else if (url.length === 1) {

                        //casaVitini.administracion.configuracion_de_alojamiento.bloqueosPorApartamento.UI(url)
                    } else if (url.length === 2) {

                        //casaVitini.administracion.configuracion_de_alojamiento.detallesDelBloqueo.UI(url)
                    }
                },
                portadaUI: async () => {
                    const espacioBotonesGlobales = document.querySelector("[componente=espacioBotonesGlobales]")
                    const espacioConfiguracionDelAlojamiento = document.querySelector("[componente=configuracionDelAlojamiento]")
                    const transaccion = {
                        zona: "administracion/arquitectura/entidades/listarEntidadesAlojamiento"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const apartamentos = respuestaServidor?.ok?.apartamentos || []
                        const habitaciones = respuestaServidor?.ok?.habitaciones || []
                        const camas = respuestaServidor?.ok?.camas || []
                        //Contenedor global
                        const contenedorGlobal = document.createElement("div")
                        contenedorGlobal.classList.add("confAlojamiento_entidades_contenedorGlobal")
                        //Apartmentos
                        const contenedorApartamentos = document.createElement("div")
                        contenedorApartamentos.classList.add("confAlojamiento_entidades_contenedor")
                        const contenedorBotonSeccionEntidad = document.createElement("div")
                        contenedorBotonSeccionEntidad.classList.add("confAlojamiento_entidades_contenedorBotones")
                        const botonAnadirApartamento = document.createElement("a")
                        botonAnadirApartamento.classList.add("confAlojamiento_entidades_botonContenedor")
                        botonAnadirApartamento.innerText = "Crear un nuevo apartamento"
                        botonAnadirApartamento.setAttribute("href", "/administracion/arquitectura_del_alojamiento/entidades/crear_entidad/tipo:apartamento")
                        botonAnadirApartamento.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/entidades/crear_entidad/tipo:apartamento")
                        botonAnadirApartamento.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        contenedorBotonSeccionEntidad.appendChild(botonAnadirApartamento)
                        contenedorApartamentos.appendChild(contenedorBotonSeccionEntidad)
                        const contenedorApartamentosExistentes = document.createElement("div")
                        contenedorApartamentosExistentes.classList.add("confAlojamiento_entidades_contenedorEntidades")
                        if (apartamentos.length === 0) {
                            const infoNoApartamentoUI = document.createElement("div")
                            infoNoApartamentoUI.classList.add("confAlojamiento_entidades_carteInfo")
                            infoNoApartamentoUI.innerText = "No hay nigÃºn apartamto"
                            contenedorApartamentosExistentes.appendChild(infoNoApartamentoUI)
                        }
                        if (apartamentos.length > 0) {
                            apartamentos.forEach((detalleApartamento) => {
                                const apartamentoIDV = detalleApartamento.apartamentoIDV
                                const apartamentoUI = detalleApartamento.apartamentoUI
                                const estado = detalleApartamento.estado
                                const contenedorDetalleApartamento = document.createElement("a")
                                contenedorDetalleApartamento.classList.add("confAlojamiento_entidades_contenedorDetalles")
                                contenedorDetalleApartamento.setAttribute("apartamentoIDV", apartamentoIDV)
                                contenedorDetalleApartamento.setAttribute("href", "/administracion/arquitectura_del_alojamiento/entidades/editar_entidad/apartamento:" + apartamentoIDV)
                                contenedorDetalleApartamento.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/entidades/editar_entidad/apartamento:" + apartamentoIDV)
                                contenedorDetalleApartamento.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.entidades.traductorCambioVista)
                                const tituloApartamento = document.createElement("div")
                                tituloApartamento.classList.add("confAlojamiento_entidades_titulo")
                                tituloApartamento.classList.add("negrita")
                                tituloApartamento.innerText = apartamentoUI
                                contenedorDetalleApartamento.appendChild(tituloApartamento)
                                const tituloApartamentoIDV = document.createElement("div")
                                tituloApartamentoIDV.classList.add("confAlojamiento_entidades_tituloIDV")
                                tituloApartamentoIDV.innerText = apartamentoIDV
                                contenedorDetalleApartamento.appendChild(tituloApartamentoIDV)
                                contenedorApartamentosExistentes.appendChild(contenedorDetalleApartamento)
                            })
                            contenedorApartamentos.appendChild(contenedorApartamentosExistentes)
                        }
                        contenedorGlobal.appendChild(contenedorApartamentos)
                        //Habitaciones
                        const contenedorHabitaciones = document.createElement("div")
                        contenedorHabitaciones.classList.add("confAlojamiento_entidades_contenedor")
                        const contenedorBotonSeccionHabitacion = document.createElement("div")
                        contenedorBotonSeccionHabitacion.classList.add("confAlojamiento_entidades_contenedorBotones")
                        const botonAnadirHabitacion = document.createElement("a")
                        botonAnadirHabitacion.classList.add("confAlojamiento_entidades_botonContenedor")
                        botonAnadirHabitacion.innerText = "Crear una nueva habitaciÃ³n"
                        botonAnadirHabitacion.setAttribute("href", "/administracion/arquitectura_del_alojamiento/entidades/crear_entidad/tipo:habitacion")
                        botonAnadirHabitacion.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/entidades/crear_entidad/tipo:habitacion")
                        botonAnadirHabitacion.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.entidades.traductorCambioVista)
                        contenedorBotonSeccionHabitacion.appendChild(botonAnadirHabitacion)
                        contenedorHabitaciones.appendChild(contenedorBotonSeccionHabitacion)
                        const contenedorHabitacionesExistentes = document.createElement("div")
                        contenedorHabitacionesExistentes.classList.add("confAlojamiento_entidades_contenedorEntidades")
                        if (habitaciones.length === 0) {
                            const infoNoApartamentoUI = document.createElement("div")
                            infoNoApartamentoUI.classList.add("confAlojamiento_entidades_carteInfo")
                            infoNoApartamentoUI.innerText = "No hay ninguna habitacion construida"
                            contenedorHabitacionesExistentes.appendChild(infoNoApartamentoUI)
                        }
                        if (habitaciones.length > 0) {
                            habitaciones.forEach((detallesHabitacion) => {
                                const habitacionIDV = detallesHabitacion.habitacionIDV
                                const habitacionUI = detallesHabitacion.habitacionUI
                                const contenedorDetalleHabitacion = document.createElement("a")
                                contenedorDetalleHabitacion.classList.add("confAlojamiento_entidades_contenedorDetalles")
                                contenedorDetalleHabitacion.setAttribute("habitacionIDV", habitacionIDV)
                                contenedorDetalleHabitacion.setAttribute("href", "/administracion/arquitectura_del_alojamiento/entidades/editar_entidad/habitacion: " + habitacionIDV)
                                contenedorDetalleHabitacion.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/entidades/editar_entidad/habitacion: " + habitacionIDV)
                                contenedorDetalleHabitacion.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.entidades.traductorCambioVista)
                                const tituloHabitacion = document.createElement("div")
                                tituloHabitacion.classList.add("confAlojamiento_entidades_titulo")
                                tituloHabitacion.classList.add("negrita")
                                tituloHabitacion.innerText = habitacionUI
                                contenedorDetalleHabitacion.appendChild(tituloHabitacion)
                                const titulohabitacionIDV = document.createElement("div")
                                titulohabitacionIDV.classList.add("confAlojamiento_entidades_tituloIDV")
                                titulohabitacionIDV.innerText = habitacionIDV
                                contenedorDetalleHabitacion.appendChild(titulohabitacionIDV)
                                contenedorHabitacionesExistentes.appendChild(contenedorDetalleHabitacion)
                            })
                            contenedorHabitaciones.appendChild(contenedorHabitacionesExistentes)
                        }
                        contenedorGlobal.appendChild(contenedorHabitaciones)
                        //Camas
                        const contenedorCamas = document.createElement("div")
                        contenedorCamas.classList.add("confAlojamiento_entidades_contenedor")
                        const contenedorBotonSeccionCamas = document.createElement("div")
                        contenedorBotonSeccionCamas.classList.add("confAlojamiento_entidades_contenedorBotones")
                        const botonAnadirCamas = document.createElement("a")
                        botonAnadirCamas.classList.add("confAlojamiento_entidades_botonContenedor")
                        botonAnadirCamas.innerText = "Crear una nueva cama"
                        botonAnadirCamas.setAttribute("href", "/administracion/arquitectura_del_alojamiento/entidades/crear_entidad/tipo:cama")
                        botonAnadirCamas.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/entidades/crear_entidad/tipo:cama")
                        botonAnadirCamas.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        contenedorBotonSeccionCamas.appendChild(botonAnadirCamas)
                        contenedorCamas.appendChild(contenedorBotonSeccionCamas)
                        const contenedorCamasExistentes = document.createElement("div")
                        contenedorCamasExistentes.classList.add("confAlojamiento_entidades_contenedorEntidades")
                        if (camas.length === 0) {
                            const infoNoApartamentoUI = document.createElement("div")
                            infoNoApartamentoUI.classList.add("confAlojamiento_entidades_carteInfo")
                            infoNoApartamentoUI.innerText = "No hay ninguna habitacion construida"
                            contenedorCamasExistentes.appendChild(infoNoApartamentoUI)
                        }
                        if (camas.length > 0) {
                            camas.forEach((detallesCama) => {
                                const camaIDV = detallesCama.camaIDV
                                const camaUI = detallesCama.camaUI
                                const contenedorDetalleCama = document.createElement("a")
                                contenedorDetalleCama.classList.add("confAlojamiento_entidades_contenedorDetalles")
                                contenedorDetalleCama.setAttribute("camaIDV", camaIDV)
                                contenedorDetalleCama.setAttribute("href", "/administracion/arquitectura_del_alojamiento/entidades/editar_entidad/cama: " + camaIDV)
                                contenedorDetalleCama.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/entidades/editar_entidad/cama: " + camaIDV)
                                contenedorDetalleCama.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.entidades.traductorCambioVista)
                                const tituloCama = document.createElement("div")
                                tituloCama.classList.add("confAlojamiento_entidades_titulo")
                                tituloCama.classList.add("negrita")
                                tituloCama.innerText = camaUI
                                contenedorDetalleCama.appendChild(tituloCama)
                                const tituloCamaIDV = document.createElement("div")
                                tituloCamaIDV.classList.add("confAlojamiento_entidades_tituloIDV")
                                tituloCamaIDV.innerText = camaIDV
                                contenedorDetalleCama.appendChild(tituloCamaIDV)
                                contenedorCamasExistentes.appendChild(contenedorDetalleCama)
                            })
                            contenedorCamas.appendChild(contenedorCamasExistentes)
                        }
                        contenedorGlobal.appendChild(contenedorCamas)
                        espacioConfiguracionDelAlojamiento.appendChild(contenedorGlobal)
                    }
                },
                traductorCambioVista: (entidad) => {
                    entidad.preventDefault()
                    entidad.stopPropagation()
                    const vista = entidad.target.closest("[vista]").getAttribute("vista")
                    const entrada = {
                        "vista": vista,
                        "tipoOrigen": "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(entrada)
                },
                crearEntidad: {
                    arranque: () => {
                        const main = document.querySelector("main")
                        main.setAttribute("zonaCSS", "administracion/arquitectura_del_alojamiento/entidades/entidadUI")
                        const urlRaw = window.location.pathname;
                        let url = urlRaw.toLowerCase()
                        url = url.split("/")
                        url = url.filter((url) => url)
                        delete url[0]
                        delete url[1]
                        delete url[2]
                        delete url[3]
                        url = url.filter((url) => url)
                        const entradaTipoEntidad = url[0].split(":")
                        if (entradaTipoEntidad[0] === "tipo") {
                            const tipoEntidad = entradaTipoEntidad[1]
                            casaVitini.administracion.arquitectura_del_alojamiento.entidades.crearEntidad.portadaUI(tipoEntidad)
                        } else {
                            //Carter de informacion dicieno que si no se defino un tipo de entidad entonces no se muestra nada
                        }
                    },
                    portadaUI: async (entidad) => {
                        const espacioBotonesGlobales = document.querySelector("[componente=espacioBotonesGlobales]")
                        const espacioConfiguracionDelAlojamiento = document.querySelector("[componente=configuracionDelAlojamiento]")
                        const selectorTitulo = document.querySelector("[componente=titulo]")
                        if (entidad === "apartamento") {
                            selectorTitulo.innerText = "Crear un nuevo apartamento como entidad"
                            //Los apartamento nuevo como entidad se insertan con el estao no disponible
                            const contenedorEntidad = document.createElement("div")
                            contenedorEntidad.classList.add("confAlojamiento_entidades_crearEntidad_contenedorEntidad")
                            contenedorEntidad.setAttribute("tipoEntidad", "apartamento")
                            const bloqueTituloApartamento = document.createElement("div")
                            bloqueTituloApartamento.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                            const infoTituloApartamento = document.createElement("div")
                            infoTituloApartamento.classList.add("confAlojamiento_entidades_crearEntidad_info")
                            infoTituloApartamento.innerText = "Escriba el nombre del apartamento. El nombre debe de ser Ãºnico, no pueden existir dos apartamentos con el mismo nombre."
                            bloqueTituloApartamento.appendChild(infoTituloApartamento)
                            const campoTituloApartamento = document.createElement("input")
                            campoTituloApartamento.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                            campoTituloApartamento.setAttribute("campo", "apartamentoUI")
                            campoTituloApartamento.placeholder = "Nombre del apartamento"
                            bloqueTituloApartamento.appendChild(campoTituloApartamento)
                            contenedorEntidad.appendChild(bloqueTituloApartamento)
                            const bloqueApartamentoIDV = document.createElement("div")
                            bloqueApartamentoIDV.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                            const infoApartamentoIDV = document.createElement("div")
                            infoApartamentoIDV.classList.add("confAlojamiento_entidades_crearEntidad_info")
                            infoApartamentoIDV.innerText = "Escriba un identificador visual para el apartamento, este solo puede estar compuesto por minÃºsculas y nÃºmeros, nada mÃ¡s ni siquiera espacios o caracteres de puntuaciÃ³n. Si quiere, puede dejar en blanco este campo y el sistema lo rellenarÃ¡ con un identificador visual automÃ¡ticamente. Pero es recomendable que lo haga usted y haga un patrÃ³n sencillo para poder identificar visualmente el apartamento y si por alguna situaciÃ³n no se pudiera acceder al identificador de interfaz de usuario."
                            bloqueApartamentoIDV.appendChild(infoApartamentoIDV)
                            const campoApartamentoIDV = document.createElement("input")
                            campoApartamentoIDV.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                            campoApartamentoIDV.setAttribute("campo", "apartamentoIDV")
                            campoApartamentoIDV.placeholder = "Identificador visual del apartamento(ApartamentoIDV)"
                            bloqueApartamentoIDV.appendChild(campoApartamentoIDV)
                            contenedorEntidad.appendChild(bloqueApartamentoIDV)
                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add("confAlojamiento_entidades_crearEntidad_contenedorBotones")
                            const botonCrearEntidad = document.createElement("div")
                            botonCrearEntidad.classList.add("confAlojamiento_entidades_createEntiad_boton")
                            botonCrearEntidad.innerText = "Crear nuevo apartamento como entidad"
                            botonCrearEntidad.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.entidades.crearEntidad.crearEntidadTransactor)
                            contenedorBotones.appendChild(botonCrearEntidad)
                            contenedorEntidad.appendChild(contenedorBotones)
                            espacioConfiguracionDelAlojamiento.appendChild(contenedorEntidad)
                        }
                        if (entidad === "habitacion") {
                            selectorTitulo.innerText = "Crear una nueva habitaciÃ³n como entidad"
                            //Los apartamento nuevo como entidad se insertan con el estao no disponible
                            const contenedorEntidad = document.createElement("div")
                            contenedorEntidad.classList.add("confAlojamiento_entidades_crearEntidad_contenedorEntidad")
                            contenedorEntidad.setAttribute("tipoEntidad", "habitacion")
                            const bloqueTituloHabitacion = document.createElement("div")
                            bloqueTituloHabitacion.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                            const infoTituloHabitacion = document.createElement("div")
                            infoTituloHabitacion.classList.add("confAlojamiento_entidades_crearEntidad_info")
                            infoTituloHabitacion.innerText = "Escriba el nombre de la nueva habitaciÃ³n. El nombre debe de ser Ãºnico e irrepetible."
                            bloqueTituloHabitacion.appendChild(infoTituloHabitacion)
                            const campoTituloHabitacion = document.createElement("input")
                            campoTituloHabitacion.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                            campoTituloHabitacion.setAttribute("campo", "habitacionUI")
                            campoTituloHabitacion.placeholder = "Nombre del la habitaciÃ³n"
                            bloqueTituloHabitacion.appendChild(campoTituloHabitacion)
                            contenedorEntidad.appendChild(bloqueTituloHabitacion)
                            const bloqueHabitacionIDV = document.createElement("div")
                            bloqueHabitacionIDV.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                            const infoHabitacionIDV = document.createElement("div")
                            infoHabitacionIDV.classList.add("confAlojamiento_entidades_crearEntidad_info")
                            infoHabitacionIDV.innerText = "Escriba un identificador visual para la nueva habitaciÃ³n, este solo puede estar compuesto por minÃºsculas y nÃºmeros, nada mÃ¡s ni siquiera espacios o caracteres de puntuaciÃ³n. Si quiere, puede dejar en blanco este campo y el sistema lo rellenarÃ¡ con identificador visual automÃ¡ticamente. Pero es recomendable que lo hagan ustedes y siga un patrÃ³n sencillo para poder identificar visualmente el apartamento y, por alguna situaciÃ³n, no se pudiera acceder al identificador de interfaz."
                            bloqueHabitacionIDV.appendChild(infoHabitacionIDV)
                            const campoHabitacionIDV = document.createElement("input")
                            campoHabitacionIDV.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                            campoHabitacionIDV.setAttribute("campo", "habitacionIDV")
                            campoHabitacionIDV.placeholder = "Identificador visual de la habitaciÃ³n(HabitacionIDV)"
                            bloqueHabitacionIDV.appendChild(campoHabitacionIDV)
                            contenedorEntidad.appendChild(bloqueHabitacionIDV)
                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add("confAlojamiento_entidades_crearEntidad_contenedorBotones")
                            const botonCrearEntidad = document.createElement("div")
                            botonCrearEntidad.classList.add("confAlojamiento_entidades_createEntiad_boton")
                            botonCrearEntidad.innerText = "Crear nueva habitaciÃ³n como entidad"
                            botonCrearEntidad.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.entidades.crearEntidad.crearEntidadTransactor)
                            contenedorBotones.appendChild(botonCrearEntidad)
                            contenedorEntidad.appendChild(contenedorBotones)
                            espacioConfiguracionDelAlojamiento.appendChild(contenedorEntidad)
                        }
                        if (entidad === "cama") {
                            selectorTitulo.innerText = "Crear una nueva cama como entidad"
                            //Los apartamento nuevo como entidad se insertan con el estao no disponible
                            const contenedorEntidad = document.createElement("div")
                            contenedorEntidad.classList.add("confAlojamiento_entidades_crearEntidad_contenedorEntidad")
                            contenedorEntidad.setAttribute("tipoEntidad", "cama")
                            const bloqueTituloCama = document.createElement("div")
                            bloqueTituloCama.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                            const infoTituloCama = document.createElement("div")
                            infoTituloCama.classList.add("confAlojamiento_entidades_crearEntidad_info")
                            infoTituloCama.innerText = "Escriba el nombre de la nueva cama.El nombre debe de ser Ãºnico e irrepetible"
                            bloqueTituloCama.appendChild(infoTituloCama)
                            const campoTituloCama = document.createElement("input")
                            campoTituloCama.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                            campoTituloCama.setAttribute("campo", "camaUI")
                            campoTituloCama.placeholder = "Nombre del la cama"
                            bloqueTituloCama.appendChild(campoTituloCama)
                            contenedorEntidad.appendChild(bloqueTituloCama)
                            const bloqueCamaIDV = document.createElement("div")
                            bloqueCamaIDV.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                            const infoCamaIDV = document.createElement("div")
                            infoCamaIDV.classList.add("confAlojamiento_entidades_crearEntidad_info")
                            infoCamaIDV.innerText = "Escriba un identificador visual para la nueva cama, este solo puede estar compuesto por minÃºsculas y nÃºmeros, nada mÃ¡s ni siquiera espacios o caracteres de puntuaciÃ³n. Si quiere, puede dejar en blanco este campo y el sistema lo rellenarÃ¡ con identificador visual automÃ¡ticamente. Pero es recomendable que lo hagan ustedes y siga un patrÃ³n sencillo para poder identificar visualmente el apartamento y, por alguna situaciÃ³n, no se pudiera acceder al identificador de interfaz."
                            bloqueCamaIDV.appendChild(infoCamaIDV)
                            const campoCamaIDV = document.createElement("input")
                            campoCamaIDV.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                            campoCamaIDV.placeholder = "Identificador visual de la cama(CamaIDV)"
                            campoCamaIDV.setAttribute("campo", "camaIDV")
                            bloqueCamaIDV.appendChild(campoCamaIDV)
                            contenedorEntidad.appendChild(bloqueCamaIDV)
                            const bloqueCapacidadPernoctativa = document.createElement("div")
                            bloqueCapacidadPernoctativa.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                            const infoCaapacidadPernoctativa = document.createElement("div")
                            infoCaapacidadPernoctativa.classList.add("confAlojamiento_entidades_crearEntidad_info")
                            infoCaapacidadPernoctativa.innerText = "Escriba la capacidad pernoctativa de la cama."
                            bloqueCapacidadPernoctativa.appendChild(infoCaapacidadPernoctativa)
                            const campoCapacidadPernoctativa = document.createElement("input")
                            campoCapacidadPernoctativa.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                            campoCapacidadPernoctativa.placeholder = "Escriba el nÃºmero de plazas de la cama, por ejemplo: 2."
                            campoCapacidadPernoctativa.setAttribute("campo", "capacidad")
                            bloqueCapacidadPernoctativa.appendChild(campoCapacidadPernoctativa)
                            contenedorEntidad.appendChild(bloqueCapacidadPernoctativa)

                            const contenedorSelector = document.createElement("div")
                            contenedorSelector.classList.add(
                                "padding6",
                                "flexVertical",
                                "gap6"
                            )
                            contenedorEntidad.appendChild(contenedorSelector)

                            const infoSelector = document.createElement("div")
                            infoSelector.innerText = "Selecciona el tipo de cama. La cama compartida es aquella que puede ser insertada en varias configuraciones de alojamiento diferentes, mientras que la cama del tipo fÃ­sico es aquella que, es usada como cama extra."
                            contenedorSelector.appendChild(infoSelector)

                            const selectorTipoCama = document.createElement("select")
                            selectorTipoCama.setAttribute("campo", "tipoCama")
                            selectorTipoCama.classList.add(
                                "padding10",
                                "borderRadius10",
                                "backgroundGrey1",
                                "simplificadorCampo"
                            )
                            const opcion = document.createElement("option");
                            opcion.value = "";
                            opcion.disabled = true;
                            opcion.selected = true;
                            opcion.text = "Selecciona el tipo de cama";
                            selectorTipoCama.add(opcion);
                            const opcionCamaCompartida = document.createElement("option");
                            opcionCamaCompartida.value = "compartida";
                            opcionCamaCompartida.text = "Compartida";
                            selectorTipoCama.add(opcionCamaCompartida);
                            const opcionCamaFisica = document.createElement("option");
                            opcionCamaFisica.value = "fisica";
                            opcionCamaFisica.text = "FÃ­sica";
                            selectorTipoCama.add(opcionCamaFisica);
                            contenedorSelector.appendChild(selectorTipoCama)

                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add("confAlojamiento_entidades_crearEntidad_contenedorBotones")
                            const botonCrearEntidad = document.createElement("div")
                            botonCrearEntidad.classList.add("confAlojamiento_entidades_createEntiad_boton")
                            botonCrearEntidad.innerText = "Crear nueva cama como entidad"
                            botonCrearEntidad.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.entidades.crearEntidad.crearEntidadTransactor)
                            contenedorBotones.appendChild(botonCrearEntidad)
                            contenedorEntidad.appendChild(contenedorBotones)
                            espacioConfiguracionDelAlojamiento.appendChild(contenedorEntidad)
                        }
                    },
                    crearEntidadTransactor: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Creando entidad..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const transaccion = {
                            zona: "administracion/arquitectura/entidades/crearEntidadAlojamiento"
                        }
                        const selectorTipoEntidad = document.querySelector("[tipoEntidad]").getAttribute("tipoEntidad")
                        transaccion.tipoEntidad = selectorTipoEntidad
                        const selectorCampos = document.querySelectorAll("[campo]")
                        selectorCampos.forEach((campo) => {
                            const nombreCampo = campo.getAttribute("campo")
                            const datoCampo = campo.value
                            transaccion[nombreCampo] = datoCampo
                        })

                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const nuevoUID = respuestaServidor?.nuevoUID
                            const vista = `/administracion/arquitectura_del_alojamiento/entidades/editar_entidad/${selectorTipoEntidad}:${nuevoUID}`
                            const navegacion = {
                                vista: vista,
                                tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                },
                editarEntidad: {
                    arranque: () => {
                        const main = document.querySelector("main")

                        main.setAttribute("zonaCSS", "administracion/arquitectura_del_alojamiento/entidades/entidadUI")
                        const granuladorURL = casaVitini.utilidades.granuladorURL()
                        const parametros = granuladorURL.parametros
                        casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.portadaUI(Object.entries(parametros)[0])
                    },
                    portadaUI: async (entidadMatriz) => {
                        const seccionRenderizadaOrigen = document.querySelector("main")
                        const instanciaUID = seccionRenderizadaOrigen.getAttribute("instanciaUID")
                        const espacioBotonesGlobales = document.querySelector("[componente=espacioBotonesGlobales]")
                        const espacioConfiguracionDelAlojamiento = document.querySelector("[componente=configuracionDelAlojamiento]")
                        const selectorTitulo = document.querySelector("[componente=titulo]")
                        const tipoEntidad = entidadMatriz[0]
                        const entidadIDV = entidadMatriz[1]
                        if (tipoEntidad === "apartamento") {
                            if (!entidadIDV) {
                                //Se tiene que especificar que pasa si no se especificael identificado del apartmentoIDV
                            }
                            const transaccion = {
                                zona: "administracion/arquitectura/entidades/detallesDeEntidadDeAlojamiento",
                                tipoEntidad: "apartamento",
                                entidadIDV: entidadIDV
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                            const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)

                            if (!seccionRenderizada) { return }
                            if (respuestaServidor?.error) {
                                const info = {
                                    titulo: "No existe ningÃºn apartamento como entidad con ese identificadorIDV",
                                    descripcion: "No existe la entidad que buscas. Por favor, revisa el identificadorIDV que solicitaste porque este no existe. QuizÃ¡s este identificador fue de una entidad de alojamiento que tuviste en el pasado y que borraste."
                                }
                                casaVitini.ui.componentes.mensajeSimple(info)
                            }
                            if (respuestaServidor?.ok) {

                                const apartamentoIDV = respuestaServidor?.ok.apartamentoIDV
                                const apartamentoUI = respuestaServidor?.ok.apartamentoUI
                                //const superficie = respuestaServidor?.ok[0].superficie
                                const caracteristicas = respuestaServidor.caracteristicas
                                selectorTitulo.innerText = "Editar apartamento como entidad"
                                const contenedorEntidad = document.createElement("div")
                                contenedorEntidad.classList.add("confAlojamiento_entidades_crearEntidad_contenedorEntidad")
                                contenedorEntidad.setAttribute("tipoEntidad", "apartamento")
                                contenedorEntidad.setAttribute("entidadIDV", apartamentoIDV)
                                const contenedorEntidadDatos = document.createElement("div")
                                contenedorEntidadDatos.classList.add("confAlojamiento_entidades_editarEntidad_contenedorEntidadDatos")
                                contenedorEntidadDatos.setAttribute("componente", "contenedorEntidadDatos")
                                const bloqueTituloApartamento = document.createElement("div")
                                bloqueTituloApartamento.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                                const infoTituloApartamento = document.createElement("div")
                                infoTituloApartamento.classList.add("confAlojamiento_entidades_crearEntidad_info")
                                infoTituloApartamento.innerText = "Nombre del apartamento"
                                bloqueTituloApartamento.appendChild(infoTituloApartamento)
                                const campoTituloApartamento = document.createElement("input")
                                campoTituloApartamento.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                                campoTituloApartamento.placeholder = "Escriba un nombre para el apartamento"
                                campoTituloApartamento.setAttribute("valorInicial", apartamentoUI)
                                campoTituloApartamento.setAttribute("campo", "apartamentoUI")
                                campoTituloApartamento.value = apartamentoUI
                                bloqueTituloApartamento.appendChild(campoTituloApartamento)
                                contenedorEntidadDatos.appendChild(bloqueTituloApartamento)
                                const bloqueApartamentoIDV = document.createElement("div")
                                bloqueApartamentoIDV.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                                const infoApartamentoIDV = document.createElement("div")
                                infoApartamentoIDV.classList.add("confAlojamiento_entidades_crearEntidad_info")
                                infoApartamentoIDV.innerText = "Identificador visual del apartamento"
                                bloqueApartamentoIDV.appendChild(infoApartamentoIDV)
                                const campoApartamentoIDV = document.createElement("input")
                                campoApartamentoIDV.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                                campoApartamentoIDV.placeholder = "Identificador visual del apartamento(apartamentoIDV)"
                                campoApartamentoIDV.setAttribute("valorInicial", apartamentoIDV)
                                campoApartamentoIDV.setAttribute("componente", "entidadIDV")
                                campoApartamentoIDV.setAttribute("campo", "apartamentoIDV")
                                campoApartamentoIDV.value = apartamentoIDV
                                bloqueApartamentoIDV.appendChild(campoApartamentoIDV)
                                contenedorEntidadDatos.appendChild(bloqueApartamentoIDV)
                                const superBloqueCaracteristicas = document.createElement("div")
                                superBloqueCaracteristicas.classList.add("contenedorCaracteristicas")
                                const infoSuperficie = document.createElement("div")
                                infoSuperficie.classList.add("confAlojamiento_entidades_crearEntidad_info")
                                infoSuperficie.innerText = "CaracterÃ­sticas del apartamento"
                                superBloqueCaracteristicas.appendChild(infoSuperficie)
                                const contenedorCaracteristicas = document.createElement("div")
                                contenedorCaracteristicas.classList.add("administracion_arquitectura_entidades_detallesEntidad_contenedorCaracteristicas")
                                contenedorCaracteristicas.setAttribute("contenedor", "caracteristicas")
                                contenedorCaracteristicas.setAttribute("caracteristicasIniciales", JSON.stringify(caracteristicas))
                                for (const caracteristica of caracteristicas) {
                                    const filaCaracteristicaUI = casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.caracteristicasUI(caracteristica)
                                    contenedorCaracteristicas.appendChild(filaCaracteristicaUI)
                                }
                                superBloqueCaracteristicas.appendChild(contenedorCaracteristicas)
                                const botonAnadirCaracteristica = document.createElement("div")
                                botonAnadirCaracteristica.classList.add("administracion_arquitectura_entidades_detallesEntidad_botonAnadir")
                                botonAnadirCaracteristica.innerText = "AÃ±adir caracteristica"
                                botonAnadirCaracteristica.addEventListener("click", () => {
                                    const selectorContenedorCaracteristicas = document.querySelector("[contenedor=caracteristicas]")
                                    const filaCaracteristicaUI = casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.caracteristicasUI()
                                    selectorContenedorCaracteristicas.appendChild(filaCaracteristicaUI)
                                })
                                superBloqueCaracteristicas.appendChild(botonAnadirCaracteristica)
                                contenedorEntidadDatos.appendChild(superBloqueCaracteristicas)
                                contenedorEntidad.appendChild(contenedorEntidadDatos)
                                const contenedorBotones = document.createElement("div")
                                contenedorBotones.classList.add("confAlojamiento_entidades_crearEntidad_contenedorBotones")
                                contenedorBotones.setAttribute("componente", "contenedorBotonEditar")
                                const botonCrearEntidad = document.createElement("div")
                                botonCrearEntidad.classList.add("confAlojamiento_entidades_createEntiad_boton")
                                botonCrearEntidad.innerText = "Editar apartamento como entidad"
                                botonCrearEntidad.addEventListener("click", () => {
                                    casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.controladorModoEditar("editar")
                                })
                                contenedorBotones.appendChild(botonCrearEntidad)
                                contenedorEntidad.appendChild(contenedorBotones)
                                const botonesOpcionesEdicion = casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.botonesEdicion()
                                contenedorEntidad.appendChild(botonesOpcionesEdicion)
                                espacioConfiguracionDelAlojamiento.appendChild(contenedorEntidad)
                            }

                        } else if (tipoEntidad === "habitacion") {
                            if (!entidadIDV) {
                                //Se tiene que especificar que pasa si no se especificael identificado del apartmentoIDV
                            }
                            const transaccion = {
                                zona: "administracion/arquitectura/entidades/detallesDeEntidadDeAlojamiento",
                                tipoEntidad: "habitacion",
                                entidadIDV: entidadIDV
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                            if (!seccionRenderizada) { return }
                            if (respuestaServidor?.error) {
                                const info = {
                                    titulo: "No existe ninguna habitaciÃ³n como entidad con ese identificador",
                                    descripcion: "No existe la entidad que buscas. Por favor, revisa el identificador que solicitaste porque este no existe. QuizÃ¡s este identificador fue de una entidad de alojamiento que tuviste en el pasado y que borraste."
                                }
                                casaVitini.ui.componentes.mensajeSimple(info)
                            }
                            if (respuestaServidor?.ok) {
                                const habitacionIDV = respuestaServidor?.ok.habitacionIDV
                                const habitacionUI = respuestaServidor?.ok.habitacionUI
                                selectorTitulo.innerText = "Editar habitaciÃ³n como entidad"
                                const contenedorEntidad = document.createElement("div")
                                contenedorEntidad.classList.add("confAlojamiento_entidades_crearEntidad_contenedorEntidad")
                                contenedorEntidad.setAttribute("tipoEntidad", "habitacion")
                                contenedorEntidad.setAttribute("entidadIDV", habitacionIDV)
                                const contenedorEntidadDatos = document.createElement("div")
                                contenedorEntidadDatos.classList.add("confAlojamiento_entidades_editarEntidad_contenedorEntidadDatos")
                                contenedorEntidadDatos.setAttribute("componente", "contenedorEntidadDatos")
                                const bloqueTituloHabitacion = document.createElement("div")
                                bloqueTituloHabitacion.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                                const infoTituloHabitacion = document.createElement("div")
                                infoTituloHabitacion.classList.add("confAlojamiento_entidades_crearEntidad_info")
                                infoTituloHabitacion.innerText = "Nombre de la habitaciÃ³n"
                                bloqueTituloHabitacion.appendChild(infoTituloHabitacion)
                                const campoTituloHabitacion = document.createElement("input")
                                campoTituloHabitacion.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                                campoTituloHabitacion.placeholder = "Escriba un nombre para la habitaciÃ³n"
                                campoTituloHabitacion.setAttribute("valorInicial", habitacionUI)
                                campoTituloHabitacion.setAttribute("campo", "habitacionUI")
                                campoTituloHabitacion.value = habitacionUI
                                bloqueTituloHabitacion.appendChild(campoTituloHabitacion)
                                contenedorEntidadDatos.appendChild(bloqueTituloHabitacion)
                                const bloqueHabitacionIDV = document.createElement("div")
                                bloqueHabitacionIDV.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                                const infoHabitacionIDV = document.createElement("div")
                                infoHabitacionIDV.classList.add("confAlojamiento_entidades_crearEntidad_info")
                                infoHabitacionIDV.innerText = "Identificador visual de la nueva habitaciÃ³n"
                                bloqueHabitacionIDV.appendChild(infoHabitacionIDV)
                                const campoHabitacionIDV = document.createElement("input")
                                campoHabitacionIDV.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                                campoHabitacionIDV.placeholder = "Identificador visual de la habitaciÃ³n(HabitacionIDV)"
                                campoHabitacionIDV.setAttribute("valorInicial", habitacionIDV)
                                campoHabitacionIDV.setAttribute("componente", "entidadIDV")
                                campoHabitacionIDV.setAttribute("campo", "habitacionIDV")
                                campoHabitacionIDV.value = habitacionIDV
                                bloqueHabitacionIDV.appendChild(campoHabitacionIDV)
                                contenedorEntidadDatos.appendChild(bloqueHabitacionIDV)
                                contenedorEntidad.appendChild(contenedorEntidadDatos)
                                const contenedorBotones = document.createElement("div")
                                contenedorBotones.classList.add("confAlojamiento_entidades_crearEntidad_contenedorBotones")
                                contenedorBotones.setAttribute("componente", "contenedorBotonEditar")
                                const botonCrearEntidad = document.createElement("div")
                                botonCrearEntidad.classList.add("confAlojamiento_entidades_createEntiad_boton")
                                botonCrearEntidad.innerText = "Editar habitaciÃ³n como entidad"
                                botonCrearEntidad.addEventListener("click", () => {
                                    casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.controladorModoEditar("editar")
                                })
                                contenedorBotones.appendChild(botonCrearEntidad)
                                contenedorEntidad.appendChild(contenedorBotones)
                                const botonesOpcionesEdicion = casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.botonesEdicion()
                                contenedorEntidad.appendChild(botonesOpcionesEdicion)
                                espacioConfiguracionDelAlojamiento.appendChild(contenedorEntidad)
                            }

                        } else if (tipoEntidad === "cama") {
                            if (!entidadIDV) {
                                //Se tiene que especificar que pasa si no se especificael identificado del apartmentoIDV
                            }
                            const transaccion = {
                                zona: "administracion/arquitectura/entidades/detallesDeEntidadDeAlojamiento",
                                tipoEntidad: "cama",
                                entidadIDV: entidadIDV
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                            if (!seccionRenderizada) { return }
                            if (respuestaServidor?.error) {
                                const info = {
                                    titulo: "No existe ninguna cama como entidad con ese identificador",
                                    descripcion: "No existe la entidad que buscas. Por favor, revisa el identificador que solicitaste porque este no existe. QuizÃ¡s este identificador fue de una entidad de alojamiento que tuviste en el pasado y que borraste."
                                }
                                casaVitini.ui.componentes.mensajeSimple(info)
                            }
                            if (respuestaServidor?.ok) {
                                const camaIDV = respuestaServidor?.ok.camaIDV
                                const tipoIDV = respuestaServidor?.ok.tipoIDV
                                const camaUI = respuestaServidor?.ok.camaUI
                                const capacidad = respuestaServidor?.ok.capacidad



                                const tipoCamaUI = (tipoIDV) => {
                                    if (tipoIDV === "compartida") {
                                        return "Compartida"
                                    } else if (tipoIDV === "fisica") {
                                        return "FÃ­sica"
                                    }
                                }


                                ///Atencion los IDV deben de ser minuscuasl todos!!!!
                                selectorTitulo.innerText = "Editar cama como entidad"
                                const contenedorEntidad = document.createElement("div")
                                contenedorEntidad.classList.add("confAlojamiento_entidades_crearEntidad_contenedorEntidad")
                                contenedorEntidad.setAttribute("tipoEntidad", "cama")
                                contenedorEntidad.setAttribute("entidadIDV", camaIDV)
                                const contenedorEntidadDatos = document.createElement("div")
                                contenedorEntidadDatos.classList.add("confAlojamiento_entidades_editarEntidad_contenedorEntidadDatos")
                                contenedorEntidadDatos.setAttribute("componente", "contenedorEntidadDatos")
                                const bloqueTituloCama = document.createElement("div")
                                bloqueTituloCama.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")


                                const infoDescription = document.createElement("div")
                                infoDescription.classList.add("confAlojamiento_entidades_crearEntidad_info")
                                infoDescription.innerText = "Editar una cama como entidad creada, actualizarÃ¡ el nombre de la cama y su identificador visual si se cambian en las reservas activas presentes y futuras para preservas la integridad de los datos."
                                bloqueTituloCama.appendChild(infoDescription)

                                const infoTituloCama = document.createElement("div")
                                infoTituloCama.classList.add("confAlojamiento_entidades_crearEntidad_info")
                                infoTituloCama.innerText = "Nombre de la cama"
                                bloqueTituloCama.appendChild(infoTituloCama)

                                const campoTituloCama = document.createElement("input")
                                campoTituloCama.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                                campoTituloCama.placeholder = "Escriba un nombre para la cama"
                                campoTituloCama.setAttribute("valorInicial", camaUI)
                                campoTituloCama.setAttribute("campo", "camaUI")
                                campoTituloCama.value = camaUI
                                bloqueTituloCama.appendChild(campoTituloCama)
                                contenedorEntidadDatos.appendChild(bloqueTituloCama)
                                const bloqueCamaIDV = document.createElement("div")
                                bloqueCamaIDV.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                                const infoCamaIDV = document.createElement("div")
                                infoCamaIDV.classList.add("confAlojamiento_entidades_crearEntidad_info")
                                infoCamaIDV.innerText = "Identificador visual de la nueva cama"
                                bloqueCamaIDV.appendChild(infoCamaIDV)
                                const campoCamaIDV = document.createElement("input")
                                campoCamaIDV.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                                campoCamaIDV.placeholder = "Identificador visual de la cama(camaIDV)"
                                campoCamaIDV.setAttribute("valorInicial", camaIDV)
                                campoCamaIDV.setAttribute("componente", "entidadIDV")
                                campoCamaIDV.setAttribute("campo", "camaIDV")
                                campoCamaIDV.value = camaIDV
                                bloqueCamaIDV.appendChild(campoCamaIDV)
                                contenedorEntidadDatos.appendChild(bloqueCamaIDV)
                                contenedorEntidad.appendChild(contenedorEntidadDatos)
                                const bloqueCapacidadPernoctativa = document.createElement("div")
                                bloqueCapacidadPernoctativa.classList.add("confAlojamiento_entidades_crearEntidad_bloqueTitulo")
                                const infoCapacidadPernoctativa = document.createElement("div")
                                infoCapacidadPernoctativa.classList.add("confAlojamiento_entidades_crearEntidad_info")
                                infoCapacidadPernoctativa.innerText = "Capacidad pernoctativa de la cama"
                                bloqueCapacidadPernoctativa.appendChild(infoCapacidadPernoctativa)
                                const campoCapacidadPernoctativa = document.createElement("input")
                                campoCapacidadPernoctativa.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                                campoCapacidadPernoctativa.placeholder = "Escriba la capaciad pernoctativa de la cama por ejemplo 2"
                                campoCapacidadPernoctativa.setAttribute("valorInicial", capacidad)
                                campoCapacidadPernoctativa.setAttribute("campo", "capacidad")
                                campoCapacidadPernoctativa.value = capacidad
                                bloqueCapacidadPernoctativa.appendChild(campoCapacidadPernoctativa)
                                contenedorEntidadDatos.appendChild(bloqueCapacidadPernoctativa)

                                const contenedorTipoInfoCama = document.createElement("div")
                                contenedorTipoInfoCama.classList.add(
                                    "flexVertical",
                                    "padding6",
                                )
                                contenedorEntidadDatos.appendChild(contenedorTipoInfoCama)

                                const tituloTipoCama = document.createElement("div")
                                tituloTipoCama.classList.add(
                                    "negrita",
                                    "padding6"
                                )
                                tituloTipoCama.innerText = "Tipo cama"

                                contenedorTipoInfoCama.appendChild(tituloTipoCama)

                                const infoSelector = document.createElement("div")
                                infoSelector.classList.add(
                                    "padding6"
                                )
                                infoSelector.innerText = tipoCamaUI(tipoIDV)
                                infoSelector.setAttribute("tipoIDV", tipoIDV)

                                contenedorTipoInfoCama.appendChild(infoSelector)

                                contenedorEntidad.appendChild(contenedorEntidadDatos)
                                const contenedorBotones = document.createElement("div")
                                contenedorBotones.classList.add("confAlojamiento_entidades_crearEntidad_contenedorBotones")
                                contenedorBotones.setAttribute("componente", "contenedorBotonEditar")
                                const botonCrearEntidad = document.createElement("div")
                                botonCrearEntidad.classList.add("confAlojamiento_entidades_createEntiad_boton")
                                botonCrearEntidad.innerText = "Editar cama como entidad"
                                botonCrearEntidad.addEventListener("click", () => {
                                    casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.controladorModoEditar("editar")
                                })
                                contenedorBotones.appendChild(botonCrearEntidad)
                                contenedorEntidad.appendChild(contenedorBotones)
                                const botonesOpcionesEdicion = casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.botonesEdicion()
                                contenedorEntidad.appendChild(botonesOpcionesEdicion)
                                espacioConfiguracionDelAlojamiento.appendChild(contenedorEntidad)
                            }

                        } else {
                            const info = {
                                titulo: "No existe ninguna entidad con ese identificador",
                                descripcion: "No existe la entidad que buscas. Por favor, revisa el identificador que solicitaste porque este no existe. QuizÃ¡s este identificador fue de una entidad de alojamiento que tuviste en el pasado y que borraste."
                            }
                            casaVitini.ui.componentes.mensajeSimple(info)
                        }




                    },
                    botonesEdicion: () => {
                        const contenedorBotones = document.createElement("div")
                        contenedorBotones.classList.add("confAlojamiento_entidades_crearEntidad_contenedorBotones")
                        contenedorBotones.setAttribute("componente", "contenedorOpcionesDeEdicion")
                        contenedorBotones.style.display = "none"
                        const botonGuardarCambios = document.createElement("div")
                        botonGuardarCambios.classList.add("confAlojamiento_entidades_createEntiad_boton")
                        botonGuardarCambios.innerText = "Guardar cambios"
                        botonGuardarCambios.addEventListener("click", () => {
                            casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.guardarCambios()
                        })
                        contenedorBotones.appendChild(botonGuardarCambios)
                        const botonEliminarEntidad = document.createElement("div")
                        botonEliminarEntidad.classList.add("confAlojamiento_entidades_createEntiad_boton")
                        botonEliminarEntidad.innerText = "Eliminar entidad"
                        botonEliminarEntidad.addEventListener("click", () => {
                            casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.eliminarEntidad.UI()
                        })
                        contenedorBotones.appendChild(botonEliminarEntidad)
                        const botonCancelarCambios = document.createElement("div")
                        botonCancelarCambios.classList.add("confAlojamiento_entidades_createEntiad_boton")
                        botonCancelarCambios.innerText = "Cancelar cambios"
                        botonCancelarCambios.addEventListener("click", () => {
                            casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.controladorModoEditar("cancelar")
                        })
                        contenedorBotones.appendChild(botonCancelarCambios)
                        return contenedorBotones
                    },
                    controladorModoEditar: (modo) => {
                        if (modo !== "editar" && modo !== "cancelar" && modo !== "guardado") {
                            const error = "El componente controladorModoEditar no comprende el parÃ¡metro"
                            casaVitini.ui.componentes.advertenciaInmersiva(error)
                        }
                        const selectorContenedorBotonEditar = document.querySelector("[componente=contenedorBotonEditar]")
                        const selectorContenedorOpcionesEdicion = document.querySelector("[componente=contenedorOpcionesDeEdicion]")
                        const selectorContenedorEntidadDatos = document.querySelector("[componente=contenedorEntidadDatos]")
                        if (modo === "editar") {
                            selectorContenedorBotonEditar.style.display = "none"
                            selectorContenedorOpcionesEdicion.style.display = "flex"
                            selectorContenedorEntidadDatos.style.pointerEvents = "all"
                        }
                        if (modo === "guardado") {
                            selectorContenedorBotonEditar.style.display = "flex"
                            selectorContenedorOpcionesEdicion.style.display = "none"
                            selectorContenedorEntidadDatos.style.pointerEvents = "none"
                        }
                        if (modo === "cancelar") {
                            selectorContenedorBotonEditar.style.display = "flex"
                            selectorContenedorOpcionesEdicion.style.display = "none"
                            selectorContenedorEntidadDatos.removeAttribute("style")
                            const selectorCampos = document.querySelectorAll("[campo]")
                            selectorCampos.forEach((campo) => {
                                const valorInicial = campo.getAttribute("valorInicial")
                                if (valorInicial) {
                                    campo.value = valorInicial
                                } else {
                                    campo.parentElement.remove()
                                }
                            })
                            const contenedorCaracteristicas = document.querySelector("[contenedor=caracteristicas]")
                            if (contenedorCaracteristicas) {
                                const caracteristicasApartamento = contenedorCaracteristicas.getAttribute("caracteristicasIniciales")
                                const caracteristicasParseadas = caracteristicasApartamento ? JSON.parse(caracteristicasApartamento) : []
                                contenedorCaracteristicas.innerHTML = null
                                for (const caracteristica of caracteristicasParseadas) {

                                    const filaCaracteristicaUI = casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.caracteristicasUI(caracteristica)
                                    contenedorCaracteristicas.appendChild(filaCaracteristicaUI)
                                }
                            }
                        }
                    },
                    guardarCambios: async () => {

                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Actualizando entidad..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const selectorTipoEntidada = document.querySelector("[tipoEntidad]").getAttribute("tipoEntidad")
                        const entidadIDV = document.querySelector("[entidadIDV]").getAttribute("entidadIDV")
                        const metadatos = {
                            zona: "administracion/arquitectura/entidades/modificarEntidadAlojamiento",
                            tipoEntidad: selectorTipoEntidada,
                            entidadIDV
                        }

                        const selectorCampos = document.querySelectorAll("[campo]")
                        selectorCampos.forEach((campo) => {
                            const nombreCampo = campo.getAttribute("campo")
                            const datoCampo = campo.value
                            metadatos[nombreCampo] = datoCampo
                        })

                        if (selectorTipoEntidada === "apartamento") {
                            metadatos.caracteristicas = []
                            const selectorCaracteristicas = document.querySelectorAll("[campo=caracteristica]")
                            selectorCaracteristicas.forEach((caracteristica) => {
                                const valorActual = caracteristica.value.trim()
                                if (valorActual) {
                                    metadatos.caracteristicas.push(valorActual)
                                }

                            })
                        }

                        const respuestaServidor = await casaVitini.shell.servidor(metadatos)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const selectorComponenteEntidadIDV = document.querySelector("[componente=entidadIDV]").value
                            document.querySelector("[entidadIDV]").setAttribute("entidadIDV", selectorComponenteEntidadIDV)
                            const selectorCampos = document.querySelectorAll("[campo]")
                            selectorCampos.forEach((campo) => {
                                const datoCampo = campo.value
                                campo.setAttribute("valorInicial", datoCampo)
                            })
                            const listaCaracteristicas = respuestaServidor.apartamentoComoEntidadActualziado?.caracteristicas

                            if (selectorTipoEntidada === "apartamento" && listaCaracteristicas) {
                                const contenedorCaracteristicas = document.querySelector("[contenedor=caracteristicas]")
                                contenedorCaracteristicas.setAttribute("caracteristicasIniciales", JSON.stringify(listaCaracteristicas))
                            }



                            //Se tiene que volver a recoger el entidadIDV para que ahora se recoga actualizado del campo modificado
                            const entidadIDV = document.querySelector("[entidadIDV]").getAttribute("entidadIDV")
                            const urlVista = "/administracion/arquitectura_del_alojamiento/entidades/editar_entidad/" + selectorTipoEntidada + ":" + entidadIDV;
                            const navegacion = {
                                vista: urlVista,
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                            casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.controladorModoEditar("guardado")
                        }
                    },
                    eliminarEntidad: {
                        UI: async () => {
                            const tipoEntidad = document.querySelector("[tipoEntidad]").getAttribute("tipoEntidad")
                            let entidadUI
                            let textoDescriptivo
                            let tituloAdvertencia
                            if (tipoEntidad === "apartamento") {
                                entidadUI = document.querySelector("[campo=apartamentoUI]").getAttribute("valorInicial")
                                tituloAdvertencia = "Confirmar eliminar el apartamento como entidad"
                                textoDescriptivo = "Vas a eliminar este apartamento como entidad. Esto implica eliminar el apartamento como entidad, el perfil de precio del apartamento, los comportamientos de precios y los bloqueos asociados a este apartamento. Sus implicaciones son inmediatas. Â¿Quieres confirmar la eliminaciÃ³n de este apartamento como entidad? "
                            }
                            if (tipoEntidad === "habitacion") {
                                entidadUI = document.querySelector("[campo=habitacionUI]").getAttribute("valorInicial")
                                tituloAdvertencia = "Confirmar eliminar la habitaciÃ³n como entidad"
                                textoDescriptivo = "Vas a eliminar esta habitaciÃ³n como entidad. Esto implica eliminar la habitaciÃ³n como entidad y su existencia en las configuraciones de alojamiento. Esto implica que el apartamento que contenÃ­a esta habitaciÃ³n dejarÃ¡ de mostrarla por su inexistencia. Sus implicaciones son inmediatas. Â¿Quieres confirmar la eliminaciÃ³n de esta habitaciÃ³n como entidad ?"
                            }
                            if (tipoEntidad === "cama") {
                                entidadUI = document.querySelector("[campo=camaUI]").getAttribute("valorInicial")
                                tituloAdvertencia = "Confirmar eliminar la cama como entidad"
                                textoDescriptivo = "Vas a eliminar esta cama como entidad. Esto implica eliminar la cama como entidad y su existencia en las configuraciones de alojamiento. Esto implica que las habitaciones que contenÃ­an esta cama dejarÃ¡n de mostrarla por su inexistencia. Sus implicaciones son inmediatas. Â¿Quieres confirmar la eliminaciÃ³n de esta cama como entidad? "
                            }

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = tituloAdvertencia
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = textoDescriptivo

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = "Comfirmar la eliminacion"
                            botonAceptar.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.entidades.editarEntidad.eliminarEntidad.confirmar)
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar la eliminacion"

                            document.querySelector("main").appendChild(pantallaInmersiva)
                        },
                        confirmar: async () => {


                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const mensaje = "Eliminado..."
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID,
                                mensaje: mensaje
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)

                            const tipoEntidad = document.querySelector("[tipoEntidad]").getAttribute("tipoEntidad")
                            const entidadIDV = document.querySelector("[entidadIDV]").getAttribute("entidadIDV")
                            const transaccion = {
                                zona: "administracion/arquitectura/entidades/eliminarEntidadAlojamiento",
                                tipoEntidad: tipoEntidad,
                                entidadIDV: entidadIDV
                            }

                            if (tipoEntidad === "cama") {
                                const tipoIDV = document.querySelector("[tipoIDV]").getAttribute("tipoIDV")
                                transaccion.tipoIDV = tipoIDV

                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            if (!instanciaRenderizada) { return }
                            instanciaRenderizada.remove()

                            if (respuestaServidor?.error) {
                                let selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                                selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                    advertenciaInmersiva.remove()
                                })
                                casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                const vista = `/administracion/arquitectura_del_alojamiento/entidades`
                                const navegacion = {
                                    vista: vista,
                                    //tipoOrigen: "menuNavegador"
                                }
                                casaVitini.shell.navegacion.controladorVista(navegacion)
                            }
                        }
                    },
                    caracteristicasUI: (data) => {
                        const caracteristicaUI = data?.caracteristicaUI || ""
                        const caracteristicaFila = document.createElement("div")
                        caracteristicaFila.classList.add("administracion_arquitectura_entidades_detallesEntidad_filaCaracteristica")
                        caracteristicaFila.setAttribute("contenedor", "caracteristica")
                        const campoCaracteristica = document.createElement("input")
                        campoCaracteristica.classList.add("confAlojamiento_entidades_crearEntidad_campoEntrada")
                        campoCaracteristica.placeholder = "Escriba la superficie del apartamento"
                        campoCaracteristica.setAttribute("valorInicial", caracteristicaUI)
                        campoCaracteristica.placeholder = "Escriba la caracterÃ­stica"
                        campoCaracteristica.setAttribute("campo", "caracteristica")
                        campoCaracteristica.value = caracteristicaUI || ""
                        caracteristicaFila.appendChild(campoCaracteristica)
                        const botonBorrar = document.createElement("div")
                        botonBorrar.classList.add("administracion_arquitectura_entidades_detallesEntidad_botonBorrarFila")
                        botonBorrar.innerText = "Borrar"
                        botonBorrar.addEventListener("click", (e) => {
                            e.target.closest("[contenedor=caracteristica]").remove()
                        })
                        caracteristicaFila.appendChild(botonBorrar)
                        return caracteristicaFila
                    }
                }
            },
            configuraciones: {
                arranque: async () => {
                    const main = document.querySelector("main")
                    const urlRaw = window.location.pathname;
                    let url = urlRaw.toLowerCase()
                    url = url.split("/")
                    url = url.filter((url) => url)
                    delete url[0]
                    delete url[1]
                    delete url[2]
                    url = url.filter((url) => url)
                    if (url.length === 0) {
                        main.setAttribute("zonaCSS", "administracion/arquitectura_de_alojamiento/configuraciones")
                        casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.portadaUI()
                    } else if (url.length === 1) {
                        main.setAttribute("zonaCSS", "administracion/arquitectura_de_alojamiento/configuraciones/detalles")
                        const apartamentoIDV = url
                        casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.portadaUI(apartamentoIDV)
                    } else if (url.length === 2) {
                        //casaVitini.administracion.configuracion_de_alojamiento.detallesDelBloqueo.UI(url)
                    }
                },
                portadaUI: async () => {
                    const selectorEspacioConfiguracionDelALojamiento = document.querySelector(" [componente=espacioConfiguracionDelAlojamiento]")
                    const espacioBotonesGlobales = document.createElement("div")
                    espacioBotonesGlobales.classList.add("espacioBotonesGlobales")
                    espacioBotonesGlobales.setAttribute("componente", "espacioBotonesGlobales")
                    const botonCrearConfiguracion = document.createElement("a")
                    botonCrearConfiguracion.classList.add("arquitecturaConfApartamento_portada_boton")
                    botonCrearConfiguracion.innerText = "Crear nueva configuraciÃ³n de alojamiento"
                    botonCrearConfiguracion.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/configuraciones/crear")
                    botonCrearConfiguracion.setAttribute("href", "/administracion/arquitectura_del_alojamiento/configuraciones/crear")
                    botonCrearConfiguracion.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    espacioBotonesGlobales.appendChild(botonCrearConfiguracion)
                    selectorEspacioConfiguracionDelALojamiento.appendChild(espacioBotonesGlobales)
                    const contenedorConfiguracionesPortada = document.createElement("div")
                    contenedorConfiguracionesPortada.classList.add("adminsitracion_arquitectura_configruaciones_portada_contenedorCongfiguraciones")
                    const transaccion = {
                        zona: "administracion/arquitectura/configuraciones/listarConfiguracionApartamentos"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const configuracionesApartamentos = respuestaServidor?.ok
                        if (configuracionesApartamentos.length === 0) {
                            ///CARTEL de no existen configuraciones
                        }
                        if (configuracionesApartamentos.length > 0) {
                            for (const detalleApartamento of configuracionesApartamentos) {
                                const apartamentoIDV = detalleApartamento.apartamentoIDV
                                const apartamentoUI = detalleApartamento.apartamentoUI
                                const zonaIDV = detalleApartamento.zonaIDV
                                const estadoConfiguracion = detalleApartamento.estadoConfiguracion
                                let estadoConfiguracionUI
                                if (estadoConfiguracion === "disponible") {
                                    estadoConfiguracionUI = "Disponible"
                                }
                                if (estadoConfiguracion === "nodisponible") {
                                    estadoConfiguracionUI = "No disponible"
                                }
                                const zonaUI = {
                                    privada: "Zona privada",
                                    global: "Zona global",
                                    publica: "Zona pÃºblica"
                                }
                                const contenedorApartamento = document.createElement("a")
                                contenedorApartamento.classList.add("arquitecturaConfiguracionesAlojamiento_contenedorConfiguracion")
                                contenedorApartamento.setAttribute("apartamentoIDV", apartamentoIDV)
                                contenedorApartamento.setAttribute("href", "/administracion/arquitectura_del_alojamiento/configuraciones/" + apartamentoIDV)
                                contenedorApartamento.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/configuraciones/" + apartamentoIDV)
                                contenedorApartamento.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.traductorCambioVista)
                                const contenedorTitulo = document.createElement("div")
                                contenedorTitulo.classList.add("arquitecturaConfAlojamiento_configuracionesTitulo")
                                contenedorTitulo.classList.add("negrita")
                                contenedorTitulo.innerText = apartamentoUI
                                contenedorApartamento.appendChild(contenedorTitulo)
                                const contenedorExplicacion = document.createElement("div")
                                contenedorExplicacion.classList.add("arquitecturaConfAlojamiento_configuracionesTitulo")
                                contenedorExplicacion.innerText = estadoConfiguracionUI
                                contenedorApartamento.appendChild(contenedorExplicacion)
                                const zona = document.createElement("div")
                                zona.classList.add("arquitecturaConfAlojamiento_configuracionesTitulo")
                                zona.innerText = zonaUI[zonaIDV]
                                contenedorApartamento.appendChild(zona)
                                contenedorConfiguracionesPortada.appendChild(contenedorApartamento)
                            }
                            selectorEspacioConfiguracionDelALojamiento.appendChild(contenedorConfiguracionesPortada)
                        }
                        //selectorEspacioConfiguracionDelALojamiento.appendChild(espacioConfiguracionesAlojamientoUI)
                    }
                },
                traductorCambioVista: (configuracion) => {
                    configuracion.preventDefault()
                    configuracion.stopPropagation()
                    const vista = configuracion.target.closest("[vista]").getAttribute("vista")
                    const entrada = {
                        "vista": vista,
                        "tipoOrigen": "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(entrada)
                },
                detallesConfiguracion: {
                    portadaUI: async (IDV) => {
                        const seccionRenderizadaOrigen = document.querySelector("main")
                        const instanciaUID = seccionRenderizadaOrigen.getAttribute("instanciaUID")
                        const apartamentoIDV = IDV[0]
                        const selectorTitulo = document.querySelector(" [componente=titulo]")
                        selectorTitulo.innerText = "ConfiguraciÃ³n del apartamento"
                        document.querySelector("[componente=espacioConfiguracionDelAlojamiento]").style.gap = "0"
                        const selectorEspacioConfiguracion = document.querySelector("[componente=espacioConfiguracionDelAlojamiento]")
                        const transaccion = {
                            zona: "administracion/arquitectura/configuraciones/detalleConfiguracionAlojamiento",
                            apartamentoIDV: apartamentoIDV
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                        const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)

                        if (!seccionRenderizada) { return }
                        if (respuestaServidor?.error) {
                            const info = {
                                titulo: "No existe la configuraciÃ³n de alojamiento",
                                descripcion: respuestaServidor.error
                            }
                            casaVitini.ui.componentes.mensajeSimple(info)
                        }
                        if (respuestaServidor?.ok) {


                            const apartamentoIDV = respuestaServidor?.apartamentoIDV
                            const apartamentoUI = respuestaServidor?.apartamentoUI
                            const zonaIDV = respuestaServidor.zonaIDV
                            const estadoConfiguracion = respuestaServidor?.estadoConfiguracion
                            const habitaciones = respuestaServidor?.habitaciones

                            let estadoConfiguracionUI
                            if (estadoConfiguracion === "nodisponible") {
                                estadoConfiguracionUI = "No disponible"
                            }
                            if (estadoConfiguracion === "disponible") {
                                estadoConfiguracionUI = "Disponible"
                            }
                            let zonaUI
                            if (zonaIDV === "publica") {
                                zonaUI = "Publica"
                            }
                            if (zonaIDV === "global") {
                                zonaUI = "Global"
                            }
                            if (zonaIDV === "privada") {
                                zonaUI = "Privada"
                            }

                            const contenedorApartamento = document.createElement("div")
                            contenedorApartamento.classList.add("arquitecturaConfApartamento_contenedor")
                            contenedorApartamento.setAttribute("apartamentoIDV", apartamentoIDV)
                            contenedorApartamento.setAttribute("contenedor", "configuracionAlojamiento")

                            const contenedorTituloYBoton = document.createElement("div")
                            contenedorTituloYBoton.classList.add("arquitecturaConfApartamento_contenedorTituloYBotones")
                            const tituloApartamento = document.createElement("div")
                            tituloApartamento.classList.add("arquitecturaConfApartamento_titulo")
                            tituloApartamento.classList.add("negrita")
                            tituloApartamento.innerText = apartamentoUI
                            contenedorTituloYBoton.appendChild(tituloApartamento)
                            const contenedorBotonesGlobalesApartamento = document.createElement("div")
                            contenedorBotonesGlobalesApartamento.classList.add("arquitecturaConfApartamento_contenedorBotonesGlobales")
                            const botonIrPerfilPrecio = document.createElement("a")
                            botonIrPerfilPrecio.classList.add("arquitecturaConfApartamento_boton")
                            botonIrPerfilPrecio.innerText = "Ir al perfil del precio"
                            botonIrPerfilPrecio.setAttribute("vista", "/administracion/precios/apartamentos:" + apartamentoIDV)
                            botonIrPerfilPrecio.setAttribute("href", "/administracion/precios/apartamentos:" + apartamentoIDV)
                            botonIrPerfilPrecio.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                            contenedorBotonesGlobalesApartamento.appendChild(botonIrPerfilPrecio)
                            const botonAddHabitacion = document.createElement("div")
                            botonAddHabitacion.classList.add("arquitecturaConfApartamento_boton")
                            botonAddHabitacion.innerText = "AÃ±adir habitaciÃ³n"
                            botonAddHabitacion.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.addHabitacion.UI)
                            contenedorBotonesGlobalesApartamento.appendChild(botonAddHabitacion)
                            contenedorTituloYBoton.appendChild(contenedorBotonesGlobalesApartamento)
                            const botonEstadoApartamento = document.createElement("div")
                            botonEstadoApartamento.classList.add("arquitecturaConfApartamento_boton")
                            botonEstadoApartamento.setAttribute("estadoActual", estadoConfiguracion)
                            botonEstadoApartamento.addEventListener("click", (e) => {
                                const estadoActual = e.target.closest("[estadoActual]").getAttribute("estadoActual")

                                casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.actualizarEstadoConfiguracion.UI({
                                    estadoActual
                                })
                            })
                            const tituloEstado = document.createElement("p")
                            tituloEstado.classList.add("arquitecturaConfApartamento_infoEstadoV")
                            tituloEstado.classList.add("negrita")
                            tituloEstado.innerText = "Estado"
                            const infoEstado = document.createElement("p")
                            infoEstado.classList.add("arquitecturaConfApartamento_infoEstado")
                            infoEstado.classList.add("negrita")
                            infoEstado.setAttribute("componente", "estadoActualUI")
                            infoEstado.innerText = estadoConfiguracionUI
                            botonEstadoApartamento.appendChild(infoEstado)
                            contenedorBotonesGlobalesApartamento.appendChild(botonEstadoApartamento)

                            const botonZonaPublicacion = document.createElement("div")
                            botonZonaPublicacion.classList.add("arquitecturaConfApartamento_boton")
                            botonZonaPublicacion.setAttribute("data", "zonaPublicacion")
                            botonZonaPublicacion.innerText = zonaUI
                            botonZonaPublicacion.addEventListener("click", () => {
                                casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionZona.ui({
                                    apartamentoIDV
                                })
                            })
                            contenedorBotonesGlobalesApartamento.appendChild(botonZonaPublicacion)


                            contenedorApartamento.appendChild(contenedorTituloYBoton)
                            const contenedorImg = document.createElement("div")
                            contenedorImg.classList.add("arquitecturaConfApartamento_contenedorImg")
                            contenedorImg.setAttribute("componente", "contenedorImagenConfiguracion")
                            contenedorApartamento.appendChild(contenedorImg)
                            const contenedorHabitaciones = document.createElement("div")
                            contenedorHabitaciones.classList.add("arquitecturaConfApartamento_contenedorHabitaciones")
                            contenedorHabitaciones.setAttribute("componente", "contenedorHabitaciones")
                            for (const habitacion of habitaciones) {
                                const habitacionUID = habitacion.componenteUID
                                const habitacionIDV = habitacion.habitacionIDV
                                const habitacionUI = habitacion.habitacionUI
                                const camas = habitacion.camas
                                const metadatosHabitacion = {
                                    habitacionUI: habitacionUI,
                                    habitacionIDV: habitacionIDV,
                                    habitacionUID: habitacionUID,
                                }

                                const contenedorHabitacionUI = casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.componentesUI.habitacionUI(metadatosHabitacion)
                                const contenedorCamas = document.createElement("div")
                                contenedorCamas.classList.add("arquitecturaConfApartamento_contenedorCamas")
                                if (camas.length === 0) {

                                    const infoNoCamas = casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.componentesUI.noCamaInfoUI()
                                    contenedorHabitacionUI.appendChild(infoNoCamas)
                                }
                                if (camas.length > 0) {
                                    for (const detallesCama of camas) {
                                        const tipoIDV = detallesCama.tipoIDV
                                        const camaIDV = detallesCama.camaIDV
                                        const camaUI = detallesCama.camaUI
                                        const capacidad = detallesCama.capacidad
                                        const camaUID = detallesCama.camaUID


                                        const metadatosCama = {
                                            tipoIDV: tipoIDV,
                                            camaIDV: camaIDV,
                                            camaUI: camaUI,
                                            capacidad: capacidad,
                                            camaUID: camaUID,
                                        }
                                        const contenedorCama = casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.componentesUI.camaUI(metadatosCama)
                                        contenedorHabitacionUI.appendChild(contenedorCama)
                                    }
                                }
                                //contenedorHabitacion.appendChild(contenedorCamas)
                                contenedorHabitaciones.appendChild(contenedorHabitacionUI)
                            }
                            contenedorApartamento.appendChild(contenedorHabitaciones)
                            selectorEspacioConfiguracion.appendChild(contenedorApartamento)
                            const contenedorBotonesGlobalesInferiores = document.createElement("div")
                            contenedorBotonesGlobalesInferiores.classList.add("arquitecturaConfApartamento_espacioEliminarConfiguracionApartamento")
                            const botonEliminarConfiguracion = document.createElement("div")
                            botonEliminarConfiguracion.classList.add("arquitecturaConfApartamento_eliminarConfiguracionApartamento")
                            botonEliminarConfiguracion.innerText = "Eliminar configuraciÃ³n del apartamento"
                            botonEliminarConfiguracion.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.eliminarConfiguracion.UI)
                            contenedorBotonesGlobalesInferiores.appendChild(botonEliminarConfiguracion)
                            const selectorEspacioGlobalConfiguracion = document.querySelector("[componente=espacioConfiguracionDelAlojamiento]")
                            selectorEspacioGlobalConfiguracion.appendChild(contenedorBotonesGlobalesInferiores)


                            casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.obtenerImgen(apartamentoIDV)

                        }
                    },
                    addHabitacion: {
                        UI: async () => {
                            const main = document.querySelector("main")
                            const apartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                            const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                            const instanciaUID = ui.getAttribute("instanciaUID")
                            const contenedor = ui.querySelector("[componente=contenedor]")
                            main.appendChild(ui)

                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Obteniendo habitaciones...",
                                textoBoton: "Cancelar"
                            })
                            contenedor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/listarHabitacionesDisponbilesApartamentoConfiguracion",
                                apartamentoIDV: apartamentoIDV
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            if (!instanciaRenderizada) { return }
                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                contenedor.innerHTML = null
                                const habitacionesDisponbiles = respuestaServidor?.ok

                                if (habitacionesDisponbiles.length === 0) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const error = "Ya estÃ¡n todas las habitaciones insertadas en esta configuraciÃ³n de apartamento."
                                    casaVitini.ui.componentes.advertenciaInmersiva(error)
                                }
                                if (habitacionesDisponbiles.length > 0) {
                                    for (const detallesHabitacion of habitacionesDisponbiles) {
                                        const habitacionIDV = detallesHabitacion.habitacionIDV
                                        const habitacionUI = detallesHabitacion.habitacionUI
                                        const tituloHabitacion = document.createElement("div")
                                        tituloHabitacion.classList.add("confApartamento_contenedorMenu_tituloApartamento")
                                        tituloHabitacion.setAttribute("habitacionIDV", habitacionIDV)
                                        tituloHabitacion.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.addHabitacion.transactor)
                                        tituloHabitacion.innerText = habitacionUI
                                        contenedor.appendChild(tituloHabitacion)
                                    }
                                }

                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("boton")
                                botonCancelar.setAttribute("boton", "cancelar")
                                botonCancelar.innerText = "Cancelar y volver a tras"
                                botonCancelar.addEventListener("click", () => {
                                    return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                })
                                contenedor.appendChild(botonCancelar)
                            }
                        },
                        transactor: async (habitacion) => {
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const mensaje = "AÃ±adiendo cama ..."
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID,
                                mensaje: mensaje
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const apartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                            const habitacionIDV = habitacion.target.getAttribute("habitacionIDV")
                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/addHabitacionToConfiguracionApartamento",
                                apartamentoIDV: apartamentoIDV,
                                habitacionIDV: habitacionIDV
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            if (!instanciaRenderizada) { return }
                            instanciaRenderizada.remove()
                            if (respuestaServidor?.error) {
                                return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()

                                const contenedorHabitacion = casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.componentesUI.habitacionUI({
                                    habitacionUID: respuestaServidor?.habitacionUID,
                                    habitacionIDV: respuestaServidor?.habitacionIDV,
                                    habitacionUI: respuestaServidor?.habitacionUI
                                })
                                const infoNoCamas = casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.componentesUI.noCamaInfoUI()
                                contenedorHabitacion.appendChild(infoNoCamas)
                                const selectorContenedorHabitaciones = document.querySelector("[componente=contenedorHabitaciones]")
                                selectorContenedorHabitaciones.appendChild(contenedorHabitacion)
                            }
                        }
                    },
                    addCama: {
                        UI: async function (data) {
                            const habitacionUID = data.habitacionUID
                            const main = document.querySelector("main")
                            const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                            const instanciaUID = ui.getAttribute("instanciaUID")
                            const contenedor = ui.querySelector("[componente=contenedor]")
                            main.appendChild(ui)

                            const spinner = casaVitini.ui.componentes.spinner({
                                mensaje: "Obteniendo camas...",
                                textoBoton: "Cancelar"
                            })
                            contenedor.appendChild(spinner)

                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/listarCamasDisponbilesApartamentoConfiguracion",
                                habitacionUID: String(habitacionUID)
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            if (!instanciaRenderizada) { return }

                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                contenedor.innerHTML = null
                                const camasDisponibles = respuestaServidor?.ok
                                if (camasDisponibles.length === 0) {
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    const error = "Ya estÃ¡n todas las camas insertadas en esta habitaciÃ³n"
                                    casaVitini.ui.componentes.advertenciaInmersiva(error)
                                }
                                if (camasDisponibles.length > 0) {
                                    contenedor.innerText = null
                                    for (const detallesCama of camasDisponibles) {
                                        const camaIDV = detallesCama.camaIDV
                                        const camaUI = detallesCama.camaUI
                                        const tituloHabitacion = document.createElement("div")
                                        tituloHabitacion.classList.add("confApartamento_contenedorMenu_tituloApartamento")
                                        tituloHabitacion.addEventListener("click", () => {
                                            this.transactor({
                                                habitacionUID,
                                                camaIDV
                                            })
                                        })
                                        tituloHabitacion.innerText = camaUI
                                        contenedor.appendChild(tituloHabitacion)
                                    }

                                }

                                const botonCancelar = document.createElement("div")
                                botonCancelar.classList.add("boton")
                                botonCancelar.setAttribute("boton", "cancelar")
                                botonCancelar.innerText = "Cancelar y volver a tras"
                                botonCancelar.addEventListener("click", () => {
                                    return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                })
                                contenedor.appendChild(botonCancelar)
                            }
                        },
                        transactor: async (data) => {

                            const habitacionUID = data.habitacionUID
                            const camaIDV = data.camaIDV
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const mensaje = "AÃ±adiendo cama..."
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID,
                                mensaje: mensaje
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/addCamaToConfiguracionApartamentoHabitacion",
                                camaIDV: camaIDV,
                                habitacionUID: String(habitacionUID)
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            if (!instanciaRenderizada) { return }
                            instanciaRenderizada.remove()
                            if (respuestaServidor?.error) {
                                casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                const metadatos = {
                                    camaUID: respuestaServidor?.nuevoUID,
                                    camaIDV: respuestaServidor?.camaIDV,
                                    camaUI: respuestaServidor?.camaUI,
                                    capacidad: respuestaServidor?.capaciad
                                }
                                const componenteCama = casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.componentesUI.camaUI(metadatos)
                                const selectorContenedorHabitacion = document.querySelector(`[habitacionUID="${habitacionUID}"]`)
                                selectorContenedorHabitacion.querySelector("[componente=infoVolatilCamasHabitacion]")?.remove()
                                selectorContenedorHabitacion.appendChild(componenteCama)
                            }
                        }
                    },
                    eliminarConfiguracion: {
                        UI: async () => {

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = "Eliminar configuraciÃ³n de alojamiento"
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = "Confirma la eliminaciÃ³n de toda la configuraciÃ³n del apartamento. Esto implica la configuraciÃ³n del apartamento, el perfil de precios y los bloqueos vigentes. Si este apartamento aparece en un comportamiento de precios, serÃ¡ eliminado el apartamento del comportamiento de precios, pero el resto del comportamiento seguirÃ¡ vigente a no ser que sea el Ãºnico apartamento en algÃºn comportamiento de precios. Sus implicaciones serÃ¡n inmediatas."

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = "Comfirmar la eliminaciÃ³n"
                            botonAceptar.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.eliminarConfiguracion.confirmar)
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar la eliminaciÃ³n"

                            document.querySelector("main").appendChild(pantallaInmersiva)



                        },
                        confirmar: async () => {
                            const apartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const mensaje = "Eliminado configuraciÃ³n de alojamiento..."
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID,
                                mensaje: mensaje
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/eliminarConfiguracionDeAlojamiento",
                                apartamentoIDV: apartamentoIDV
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            if (!instanciaRenderizada) { return }
                            instanciaRenderizada.remove()
                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                const reservasActivas = respuestaServidor.reservasActivas


                                const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                                const contenedor = constructor.querySelector("[componente=contenedor]")

                                const titulo = constructor.querySelector("[componente=titulo]")
                                titulo.innerText = `No se puede borrar esta configuraciÃ³n de alojamiento`
                                const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                mensaje.innerText = respuestaServidor?.error


                                /*
                                      {
                                            "componenteUID": "2908",
                                            "reservaUID": "8497950",
                                            "apartamentoIDV": "test",
                                            "apartamentoUI": "test"
                                        }
                                */
                                const contenedorReservas = document.createElement("div")
                                contenedorReservas.classList.add(
                                    "flexVertical",
                                    "gap6",
                                )
                                contenedor.appendChild(contenedorReservas)

                                reservasActivas.forEach(reservaActiva => {
                                    const reservaUID = reservaActiva.reservaUID
                                    const apartamentoUI = reservaActiva.apartamentoUI

                                    const reservaActivaContenedorUI = document.createElement("a")
                                    reservaActivaContenedorUI.classList.add(
                                        "borderRadius10",
                                        "areaSinDecoracionPredeterminada",
                                        "backgroundGrey1",
                                        "padding12",
                                        "comportamientoBoton"
                                    )
                                    reservaActivaContenedorUI.setAttribute("href", `/administracion/reservas/reserva:${reservaUID}/alojamiento`)
                                    reservaActivaContenedorUI.setAttribute("vista", `/administracion/reservas/reserva:${reservaUID}/alojamiento`)
                                    reservaActivaContenedorUI.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                    contenedorReservas.appendChild(reservaActivaContenedorUI)

                                    const titulo = document.createElement("div")
                                    titulo.innerText = "Reserva UID"
                                    reservaActivaContenedorUI.appendChild(titulo)

                                    const reservaIdentificador = document.createElement("div")
                                    reservaIdentificador.classList.add(
                                        "negrita"
                                    )
                                    reservaIdentificador.innerText = reservaUID
                                    reservaActivaContenedorUI.appendChild(reservaIdentificador)


                                })



                                const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                botonAceptar.remove()
                                //botonAceptar.innerText = "Comfirmar y aceptar reserva"
                                //botonAceptar.addEventListener("click", () => {
                                //    this.confirmarNuevoEstado({
                                //        reservaUID,
                                //        instanciaUID_aceptarReserva,
                                //        nuevoEstado: "confirmada"
                                //    })
                                //})
                                const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                botonCancelar.innerText = "Volver"
                                document.querySelector("main").appendChild(pantallaInmersiva)



                            }
                            if (respuestaServidor?.ok) {
                                const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                                selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                    advertenciaInmersiva.remove()
                                })
                                const navegacion = {
                                    "vista": "/administracion/arquitectura_del_alojamiento/configuraciones",
                                    "tipoOrigen": "menuNavegador"
                                }
                                casaVitini.shell.navegacion.controladorVista(navegacion)
                            }
                        }
                    },
                    eliminarHabitacion: {
                        UI: async function (data) {

                            const habitacionUID = data.habitacionUID
                            const habitacionUI = data.habitacionUI

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                            const instanciaUID = pantallaInmersiva.getAttribute("instanciaUID")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = `Eliminar ${habitacionUI}`
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = `Confirmas eliminar ${habitacionUI} con identificador universal ${habitacionUID}`

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = `Comfirmar y eliminar ${habitacionUI}`
                            botonAceptar.addEventListener("click", () => {
                                this.confirmar({
                                    habitacionUID,
                                    instanciaUID
                                })
                            })
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar y volver"
                            document.querySelector("main").appendChild(pantallaInmersiva)
                        },
                        confirmar: async (data) => {
                            const habitacionUID = data.habitacionUID
                            const instanciaUID_pro = casaVitini.utilidades.codigoFechaInstancia()
                            const mensaje = "Eliminando habitaciÃ³n..."
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID_pro,
                                mensaje: mensaje
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/eliminarHabitacionDeConfiguracionDeAlojamiento",
                                habitacionUID: String(habitacionUID)
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_pro}"]`)
                            if (!instanciaRenderizada) { return }
                            instanciaRenderizada.remove()
                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                document.querySelector(`[habitacionUID="${habitacionUID}"]`)?.remove()
                            }
                        }
                    },
                    eliminarCama: {
                        UI: async function (data) {

                            const camaUID = data.camaUID
                            const camaUI = data.camaUI
                            const camaIDV = data.camaIDV

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")
                            const instanciaUID = pantallaInmersiva.getAttribute("instanciaUID")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = `Eliminar ${camaUI}`
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = `Confirmas eliminar ${camaUI} con identificador universal ${camaIDV}`

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = `Comfirmar y eliminar ${camaUI}`
                            botonAceptar.addEventListener("click", () => {
                                this.confirmar({
                                    camaUID,
                                    camaIDV,
                                })
                            })
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar y volver"
                            document.querySelector("main").appendChild(pantallaInmersiva)
                        },
                        confirmar: async (data) => {

                            const camaUID = data.camaUID
                            const habitacionUID = data.habitacionUID
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const mensaje = "Eliminado cama..."
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID,
                                mensaje: mensaje
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/eliminarCamaDeConfiguracionDeAlojamiento",
                                camaUID: String(camaUID)
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            if (!instanciaRenderizada) { return }

                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                document.querySelector(`[camaUID="${camaUID}"]`)?.remove()
                                const selectorContenedoresHabitacion = document.querySelectorAll(`[habitacionUID]`)
                                selectorContenedoresHabitacion.forEach((habitacion) => {

                                    const camasDeLaHabitacion = habitacion.querySelectorAll("[camaUID]")
                                    const selectorInfoRenderizada = habitacion.querySelector("[componente=infoVolatilCamasHabitacion]")
                                    if (camasDeLaHabitacion.length === 0 && !selectorInfoRenderizada) {
                                        const infoNoCamas = casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.componentesUI.noCamaInfoUI()
                                        habitacion.appendChild(infoNoCamas)
                                    }


                                })
                            }
                        }
                    },
                    actualizarEstadoConfiguracion: {
                        UI: async function (data) {
                            const estadoActual = data.estadoActual
                            let tituloBoton
                            let nuevoEstado
                            if (estadoActual === "nodisponible") {
                                tituloBoton = "Cambiar estado a Disponible"
                                nuevoEstado = "disponible"
                            }
                            if (estadoActual === "disponible") {
                                tituloBoton = "Cambiar estado a No disponible"
                                nuevoEstado = "nodisponible"
                            }

                            const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                            const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                            const titulo = constructor.querySelector("[componente=titulo]")
                            titulo.innerText = `Actualizar el estado de la configuraciÃ³n`
                            const mensaje = constructor.querySelector("[componente=mensajeUI]")
                            mensaje.innerText = `Seleccione el nuevo estado de la configuraciÃ³n. Su aplicaciÃ³n serÃ¡ inmediata. Es recomendable que cambie al estado disponible cuando se asegure de que tiene la configuraciÃ³n del apartamento correctamente configurada.`

                            const botonAceptar = constructor.querySelector("[boton=aceptar]")
                            botonAceptar.innerText = tituloBoton
                            botonAceptar.addEventListener("click", () => {
                                this.transactor({
                                    nuevoEstado
                                })
                            })
                            const botonCancelar = constructor.querySelector("[boton=cancelar]")
                            botonCancelar.innerText = "Cancelar el cambio de estado"
                            document.querySelector("main").appendChild(pantallaInmersiva)
                        },
                        transactor: async (data) => {
                            const nuevoEstado = data.nuevoEstado
                            const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                            const mensaje = "Actualizando estado..."
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID,
                                mensaje: mensaje
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const apartamentoIDV = document.querySelector(`[apartamentoIDV]`).getAttribute("apartamentoIDV")
                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/cambiarEstadoConfiguracionAlojamiento",
                                apartamentoIDV,
                                nuevoEstado
                            }

                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                            if (!instanciaRenderizada) { return }
                            instanciaRenderizada.remove()
                            if (respuestaServidor?.error) {
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                const selectorEstadoActualIDV = document.querySelector("[estadoActual]")
                                selectorEstadoActualIDV.setAttribute("estadoActual", nuevoEstado)
                                let estadoConfiguracionUI
                                if (nuevoEstado === "nodisponible") {
                                    estadoConfiguracionUI = "No disponible"
                                }
                                if (nuevoEstado === "disponible") {
                                    estadoConfiguracionUI = "Disponible"
                                }
                                const selectorEstadoActualUI = document.querySelector("[componente=estadoActualUI]")
                                selectorEstadoActualUI.innerText = estadoConfiguracionUI
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            }
                        }
                    },
                    gestionZona: {
                        ui: async function (data) {
                            const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                            const instanciaUID_gestionZonaUI = ui.getAttribute("instanciaUID")
                            const contenedor = ui.querySelector("[componente=contenedor]")
                            const apartamentoIDV = data.apartamentoIDV


                            const t1 = document.createElement("div")
                            t1.classList.add("titulo")
                            t1.innerText = "Cambiar zona de publicaciÃ³n"
                            contenedor.appendChild(t1)

                            const botonCancelar = document.createElement("div")
                            botonCancelar.classList.add("boton")
                            botonCancelar.setAttribute("boton", "cancelar")
                            botonCancelar.innerText = "Cancelar y volver a tras"
                            botonCancelar.addEventListener("click", () => {
                                return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                            })
                            contenedor.appendChild(botonCancelar)


                            const t2 = document.createElement("div")
                            t2.innerText = "La zona de publicaciÃ³n determina dÃ³nde se mostrarÃ¡ esta configuraciÃ³n de alojamiento. Existen tres zonas. La zona pÃºblica que determina que esta configuraciÃ³n se anuncie solo desde la plaza, para los clientes y fuera de la zona administrativa. La zona privada que establece que esta configuraciÃ³n solo se anuncie dentro de la zona administrativa y, por Ãºltima, estÃ¡ la zona global, que anuncia esta configuraciÃ³n en toda Casa Vitini"
                            contenedor.appendChild(t2)


                            const botonZonaPublica = document.createElement("div")
                            botonZonaPublica.classList.add("boton")
                            botonZonaPublica.setAttribute("zona", "publica")
                            botonZonaPublica.innerText = "Cambiar a Zona PÃºblica"
                            botonZonaPublica.addEventListener("click", () => {
                                this.cambiarZona({
                                    apartamentoIDV,
                                    nuevaZona: "publica",
                                    instanciaUID_gestionZonaUI
                                })
                            })
                            contenedor.appendChild(botonZonaPublica)

                            const botonZonaPrivada = document.createElement("div")
                            botonZonaPrivada.classList.add("boton")
                            botonZonaPrivada.setAttribute("zona", "privada")
                            botonZonaPrivada.innerText = "Cambiar a Zona Privada"
                            botonZonaPrivada.addEventListener("click", () => {
                                this.cambiarZona({
                                    apartamentoIDV,
                                    nuevaZona: "privada",
                                    instanciaUID_gestionZonaUI
                                })
                            })
                            contenedor.appendChild(botonZonaPrivada)

                            const botonZonaGlobal = document.createElement("div")
                            botonZonaGlobal.classList.add("boton")
                            botonZonaGlobal.setAttribute("zona", "global")
                            botonZonaGlobal.innerText = "Cambiar a Zona Global"
                            botonZonaGlobal.addEventListener("click", () => {
                                this.cambiarZona({
                                    apartamentoIDV,
                                    nuevaZona: "global",
                                    instanciaUID_gestionZonaUI
                                })
                            })
                            contenedor.appendChild(botonZonaGlobal)


                            document.querySelector("main").appendChild(ui)
                        },
                        cambiarZona: async (data) => {

                            const nuevaZona = data.nuevaZona
                            const apartamentoIDV = data.apartamentoIDV
                            const instanciaUID_gestionZonaUI = data.instanciaUID_gestionZonaUI


                            const instanciaUID_pantallaCargaSuperPuesta = casaVitini.utilidades.codigoFechaInstancia()
                            const mensaje = "Actualizando zona de la configuraciÃ³n de alojamiento..."
                            const datosPantallaSuperpuesta = {
                                instanciaUID: instanciaUID_pantallaCargaSuperPuesta,
                                mensaje: mensaje
                            }
                            casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/actualizarZonaDeLaConfiguracionApartamento",
                                nuevaZona,
                                apartamentoIDV
                            }
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID_gestionZonaUI}"]`)
                            if (!instanciaRenderizada) { return }

                            if (respuestaServidor?.error) {
                                document.querySelector(`[instanciaUID="${instanciaUID_pantallaCargaSuperPuesta}"]`)?.remove()
                                return casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {
                                const nuevaZona = respuestaServidor.nuevaZona
                                const selectorZonaUI_renderizada = document.querySelector(`[instanciaUID="${instanciaUID_gestionZonaUI}"]`)
                                if (!selectorZonaUI_renderizada) {
                                    return
                                }
                                casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                const selectorZonaUI = document.querySelector(`[contenedor=configuracionAlojamiento][apartamentoIDV="${apartamentoIDV}"]`).querySelector("[data=zonaPublicacion]")

                                let zonaUI
                                if (nuevaZona === "publica") {
                                    zonaUI = "Publica"
                                }
                                if (nuevaZona === "global") {
                                    zonaUI = "Global"
                                }
                                if (nuevaZona === "privada") {
                                    zonaUI = "Privada"
                                }
                                selectorZonaUI.innerText = zonaUI
                            }
                        }
                    },
                    gestionImagen: {
                        subirImagen: () => {
                            const contenedorImagen = document.querySelector("[componente=contenedorImagenConfiguracion]")
                            const apartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                            const selectorEspacio = document.querySelector("[componente=espacioConfiguracionDelAlojamiento]")
                            const campoEntrada = document.createElement("input")
                            campoEntrada.id = "campoEntrada"
                            campoEntrada.type = "file"
                            campoEntrada.style.display = "none"
                            campoEntrada.addEventListener("change", (event) => {
                                const archivoSeleccionado = event.target.files[0];
                                if (archivoSeleccionado) {
                                    contenedorImagen.innerHTML = null
                                    const iconoProceso = casaVitini.ui.componentes.spinnerSimple()
                                    iconoProceso.style.background = "white"
                                    iconoProceso.style.paddingLeft = "4px"
                                    iconoProceso.style.background = "#ffffff7d"
                                    iconoProceso.style.borderRadius = "18px"
                                    iconoProceso.style.webkitBackdropFilter = "blur(20px)"
                                    iconoProceso.style.backdropFilter = "blur(20px)"
                                    contenedorImagen.appendChild(iconoProceso)

                                    const iconoProcesoRenderizado = document.querySelector("[componente=iconoProceso]")
                                    const lector = new FileReader();
                                    lector.onload = async (eventoCarga) => {
                                        const contenidoBuffer = eventoCarga.target.result;
                                        //Convierte el contenido del buffer a una cadena base64
                                        const contenidoBase64 = btoa(new Uint8Array(contenidoBuffer).reduce((datos, byte) => datos + String.fromCharCode(byte), ""));
                                        //Crea el objeto JSON con el contenido de la imagen
                                        const transaccion = {
                                            zona: "administracion/arquitectura/configuraciones/gestionImagenConfiguracionApartamento",
                                            apartamentoIDV: apartamentoIDV,
                                            contenidoArchivo: contenidoBase64
                                        };
                                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                        if (respuestaServidor?.error) {
                                            iconoProceso.remove()
                                            document.getElementById("campoEntrada").remove()
                                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                            await casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.obtenerImgen()
                                        }
                                        if (respuestaServidor?.ok) {
                                            iconoProceso.remove()
                                            contenedorImagen.style.backgroundImage = `url(data:image/png;base64,${contenidoBase64})`;
                                            document.getElementById("campoEntrada").remove()
                                            casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.opcionesImagen()
                                        }
                                        //AquÃ­ puedes realizar acciones con el archivo seleccionado, como subirlo a tu servidor
                                        // 
                                    }
                                    lector.readAsArrayBuffer(archivoSeleccionado);
                                };
                            })
                            const selectorCampoRederizado = document.getElementById("campoEntrada")
                            if (!selectorCampoRederizado) {
                                selectorEspacio.appendChild(campoEntrada)
                            }
                            document.getElementById("campoEntrada").click()
                        },
                        obtenerImgen: async (IDV) => {
                            const apartamentoIDV = IDV || document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                            const contenedorImagen = document.querySelector("[componente=contenedorImagenConfiguracion]")
                            contenedorImagen.innerHTML = null
                            const transaccion = {
                                zona: "administracion/arquitectura/configuraciones/obtenerImagenConfiguracionAdministracion",
                                apartamentoIDV: apartamentoIDV
                            }

                            const iconoProceso = casaVitini.ui.componentes.spinnerSimple()
                            iconoProceso.style.background = "white"
                            iconoProceso.style.paddingLeft = "4px"
                            iconoProceso.style.background = "#ffffff7d"
                            iconoProceso.style.borderRadius = "18px"
                            iconoProceso.style.webkitBackdropFilter = "blur(20px)"
                            iconoProceso.style.backdropFilter = "blur(20px)"
                            contenedorImagen.appendChild(iconoProceso)
                            const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                            iconoProceso?.remove()
                            if (respuestaServidor?.error) {

                                return casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                            if (respuestaServidor?.ok) {

                                const imagenBase64 = respuestaServidor?.imagen
                                if (!imagenBase64) {
                                    contenedorImagen.innerText = "Haz click para aÃ±adir una imagen del apartamento"
                                    contenedorImagen.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.subirImagen)
                                    contenedorImagen.removeEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.mostrarOpciones)
                                } else {
                                    const detectarTipoDeImagen = (base64String) => {
                                        const binarioMagicoPNG = new Uint8Array([137, 80, 78, 71, 13, 10, 26, 10]);
                                        const binarioMagicoJPEG = new Uint8Array([255, 216, 255]);
                                        const binarioMagicoTIFF = new Uint8Array([73, 73, 42]);
                                        const arrayBuffer = Uint8Array.from(atob(base64String), c => c.charCodeAt(0));
                                        const buffer = new Uint8Array(arrayBuffer);
                                        if (buffer.subarray(0, 8).every((value, index) => value === binarioMagicoPNG[index])) {
                                            "PNG";
                                        } else if (buffer.subarray(0, 3).every((value, index) => value === binarioMagicoJPEG[index])) {
                                            "JPEG";
                                        } else if (buffer.subarray(0, 3).every((value, index) => value === binarioMagicoTIFF[index])) {
                                            "TIFF";
                                        } else {
                                            "Tipo de imagen desconocido";
                                        }
                                    };
                                    const tipoDeImagen = detectarTipoDeImagen(imagenBase64);
                                    contenedorImagen.style.backgroundImage = `url(data:image/${tipoDeImagen};base64,${imagenBase64})`;
                                    casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.opcionesImagen()
                                }
                            }
                        },
                        mostrarOpciones: (e) => {
                            const contenedorOpcionesImagen = document.querySelector("[componente=contenedorOpcionesImagen]")
                            const estadoVision = contenedorOpcionesImagen.style?.display
                            const componente = e.target.getAttribute("componente")
                            if (componente === "opcionImagen") {

                            }
                            if (estadoVision === "none" || !estadoVision) {
                                contenedorOpcionesImagen.style.display = "flex"
                            } else {
                                contenedorOpcionesImagen.style.display = "none"
                            }
                        },
                        eliminarImagen: {
                            UI: async function () {

                                const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                                const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                                const titulo = constructor.querySelector("[componente=titulo]")
                                titulo.innerText = `Eliminar imagen de la configuraciÃ³n del apartamento.`
                                const mensaje = constructor.querySelector("[componente=mensajeUI]")
                                mensaje.innerText = `Â¿Confirmas eliminar la imagen actual de la configuraciÃ³n de alojamiento?`

                                const botonAceptar = constructor.querySelector("[boton=aceptar]")
                                botonAceptar.innerText = `Confirmar y eliminar la imagen`
                                botonAceptar.addEventListener("click", this.confirmar)
                                const botonCancelar = constructor.querySelector("[boton=cancelar]")
                                botonCancelar.innerText = "Cancelar y volver"
                                document.querySelector("main").appendChild(pantallaInmersiva)
                            },
                            confirmar: async () => {
                                const apartamentoIDV = document.querySelector("[apartamentoIDV]").getAttribute("apartamentoIDV")
                                const contenedorImagen = document.querySelector("[componente=contenedorImagenConfiguracion]")
                                contenedorImagen.innerHTML = null
                                const iconoProceso = casaVitini.ui.componentes.spinnerSimple()
                                iconoProceso.style.background = "white"
                                iconoProceso.style.paddingLeft = "4px"
                                iconoProceso.style.background = "#ffffff7d"
                                iconoProceso.style.borderRadius = "18px"
                                iconoProceso.style.webkitBackdropFilter = "blur(20px)"
                                iconoProceso.style.backdropFilter = "blur(20px)"
                                contenedorImagen.appendChild(iconoProceso)
                                const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                                selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                    advertenciaInmersiva.remove()
                                })
                                const transaccion = {
                                    zona: "administracion/arquitectura/configuraciones/eliminarImagenConfiguracionApartamento",
                                    apartamentoIDV: apartamentoIDV
                                }
                                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                                if (respuestaServidor?.error) {
                                    iconoProceso?.remove()
                                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                                }
                                if (respuestaServidor?.ok) {
                                    iconoProceso.remove()
                                    contenedorImagen.removeAttribute("style")
                                    casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.obtenerImgen(apartamentoIDV)
                                }
                            }
                        },
                        opcionesImagen: () => {
                            const contenedorImagen = document.querySelector("[componente=contenedorImagenConfiguracion]")
                            contenedorImagen.removeEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.subirImagen)
                            contenedorImagen.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.mostrarOpciones)
                            const contenedorOpciones = document.createElement("div")
                            contenedorOpciones.classList.add("arquitecturaConfApartamento_contenedorImg_opciones")
                            contenedorOpciones.setAttribute("componente", "contenedorOpcionesImagen")
                            const actualizarImagen = document.createElement("div")
                            actualizarImagen.classList.add("arquitecturaConfApartamento_contenedorImg_opcion")
                            actualizarImagen.setAttribute("componente", "opcionImagen")
                            actualizarImagen.innerText = "Actualiar imagen"
                            actualizarImagen.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.subirImagen)
                            contenedorOpciones.appendChild(actualizarImagen)
                            const eliminarImagen = document.createElement("div")
                            eliminarImagen.classList.add("arquitecturaConfApartamento_contenedorImg_opcion")
                            eliminarImagen.setAttribute("componente", "opcionImagen")
                            eliminarImagen.innerText = "Eliminar imagen"
                            eliminarImagen.addEventListener("click", () => {
                                casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.gestionImagen.eliminarImagen.UI()
                            })
                            contenedorOpciones.appendChild(eliminarImagen)
                            const contenedorOpcionesRenderizado = document.querySelector("[componente=contenedorOpcionesImagen]")
                            if (!contenedorOpcionesRenderizado) {
                                contenedorImagen.appendChild(contenedorOpciones)
                            }
                        },
                    },
                    componentesUI: {
                        habitacionUI: (metadatos) => {
                            const habitacionUI = metadatos.habitacionUI
                            const habitacionIDV = metadatos.habitacionIDV
                            const habitacionUID = metadatos.habitacionUID
                            const contenedor = document.createElement("div")
                            contenedor.classList.add("arquitecturaConfApartamento_contenedorHabitacion")
                            contenedor.setAttribute("habitacionUID", habitacionUID)
                            contenedor.setAttribute("habitacionIDV", habitacionIDV)
                            const barraHerramientas = document.createElement("div")
                            barraHerramientas.classList.add("aquitecturaConfApartamento_barraHerrameintas")
                            const tituloHabitacion = document.createElement("div")
                            tituloHabitacion.classList.add("arquitecturaConfApartamento_tituloHabitacion")
                            tituloHabitacion.innerText = habitacionUI
                            barraHerramientas.appendChild(tituloHabitacion)
                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add("arquitecturaConfApartamento_barraHerramientas_contenedorBotones")
                            const botonEliminarHabitacion = document.createElement("div")
                            botonEliminarHabitacion.classList.add("arquitecturaConfApartamento_botonV2")
                            botonEliminarHabitacion.innerText = "Eliminar habitaciÃ³n"
                            botonEliminarHabitacion.addEventListener("click", () => {
                                casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.eliminarHabitacion.UI({
                                    habitacionUI,
                                    habitacionUID
                                })
                            })
                            contenedorBotones.appendChild(botonEliminarHabitacion)
                            const botonAddCama = document.createElement("div")
                            botonAddCama.classList.add("arquitecturaConfApartamento_botonV2")
                            botonAddCama.addEventListener("click", () => {
                                casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.addCama.UI({
                                    habitacionUID
                                })
                            })
                            botonAddCama.innerText = "Anadir cama"
                            contenedorBotones.appendChild(botonAddCama)
                            barraHerramientas.appendChild(contenedorBotones)
                            contenedor.appendChild(barraHerramientas)
                            return contenedor
                        },
                        camaUI: (metadatos) => {
                            const camaIDV = metadatos.camaIDV
                            const camaUID = metadatos.camaUID
                            const camaUI = metadatos.camaUI
                            const capacidad = metadatos.capacidad
                            const contenedorCama = document.createElement("div")
                            contenedorCama.classList.add("arquitecturaConfApartamento_contenedorCama")
                            contenedorCama.setAttribute("camaIDV", camaIDV)
                            contenedorCama.setAttribute("camaUID", camaUID)
                            const contenedorInfo = document.createElement("div")
                            contenedorInfo.classList.add("arquitecturaConfApartamento_contenedorCamaInfo")
                            const tituloCama = document.createElement("div")
                            tituloCama.classList.add("arquitecturaConfApartamento_tituloCama")
                            tituloCama.classList.add("negrita")
                            tituloCama.innerText = camaUI
                            contenedorInfo.appendChild(tituloCama)
                            const tituloCapacidadCama = document.createElement("div")
                            tituloCapacidadCama.classList.add("arquitecturaConfApartamento_tituloCama")
                            tituloCapacidadCama.innerText = `Capacidad pernoctativa: ${capacidad}`
                            contenedorInfo.appendChild(tituloCapacidadCama)
                            contenedorCama.appendChild(contenedorInfo)
                            const contenedorOpciones = document.createElement("div")
                            contenedorOpciones.classList.add("arquitecturaConfApartamento_contenedorCamaOpciones")
                            const botonEliminar = document.createElement("div")
                            botonEliminar.classList.add("arquitecturaConfApartamento_botonV3")
                            botonEliminar.innerText = "Eliminar cama"
                            botonEliminar.addEventListener("click", () => {
                                casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.detallesConfiguracion.eliminarCama.UI({
                                    camaUID,
                                    camaUI,
                                    camaIDV
                                })
                            })
                            contenedorOpciones.appendChild(botonEliminar)
                            contenedorCama.appendChild(contenedorOpciones)
                            return contenedorCama
                        },
                        noCamaInfoUI: () => {
                            const infoNoCamas = document.createElement("div")
                            infoNoCamas.classList.add("arquitecturaConfApartamento_infoNoCama")
                            infoNoCamas.setAttribute("componente", "infoVolatilCamasHabitacion")
                            infoNoCamas.innerText = "Esta habitaciÃ³n no tiene ninguna cama configurada, aÃ±ade una cama para hacer seleccionable esta habitaciÃ³n."
                            return infoNoCamas
                        }
                    }
                },
                crearConfiguracion: {
                    arranque: async () => {
                        const main = document.querySelector("main")
                        const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")

                        main.setAttribute("zonaCSS", "administracion/arquitectura_de_alojamiento/configuraciones/nuevo")
                        const transaccion = {
                            zona: "administracion/arquitectura/entidades/listarApartamentosComoEntidades"
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const seccionRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                        if (!seccionRenderizada)

                            if (respuestaServidor?.error) {
                                casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                            }
                        if (respuestaServidor?.ok) {
                            const apartamentosEntidad = respuestaServidor?.apartamentosComoEntidadesDisponibles
                            const espacioInfo = document.querySelector("[componente=info]")
                            if (apartamentosEntidad.length === 0) {
                                espacioInfo.innerHTML = `No hay entidades de apartamento disponibles para crear configuraciones. Si necesita crear una nueva configuraciÃ³n, primero genere un nuevo apartamento como entidad. Para ello, dirÃ­gete a: Arquitectura de alojamiento > Entidades de alojamiento > Generar nuevo apartamento.`
                                const enlace = document.createElement("a")
                                enlace.classList.add("enlace")
                                enlace.innerText = "Ir directo a crear un nuevo apartamento como entidad"
                                enlace.setAttribute("href", "/administracion/arquitectura_del_alojamiento/entidades/crear_entidad/tipo:apartamento")
                                enlace.setAttribute("vista", "/administracion/arquitectura_del_alojamiento/entidades/crear_entidad/tipo:apartamento")
                                enlace.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                                main.appendChild(enlace)
                            }
                            if (apartamentosEntidad.length > 0) {
                                espacioInfo.innerHTML = `Escoge un apartamento como entidad para construir la base de la configuraciÃ³n. Luego podrÃ¡s llenar este apartamento con habitaciones y asignarles camas. Recuerda que aquÃ­ se muestran los apartamentos como entidades que no has usado para construir configuraciones de alojamiento.`
                                const selectorZonaCreacionConfiguracion = document.querySelector("[componente=zonaCreacion]")
                                const contenedorOpciones = document.createElement("select")
                                contenedorOpciones.setAttribute("componente", "selectorApartamentoIDV")
                                contenedorOpciones.classList.add("arquitecturaConfCrearConfiguracion_selectorApartamento")
                                const opcion = document.createElement("option");
                                opcion.value = "";
                                opcion.disabled = true;
                                opcion.selected = true;
                                opcion.text = "Selecciona un apartamento como entidad para comenzar";
                                contenedorOpciones.add(opcion);
                                for (const detallesApartmentoComoEntidad of apartamentosEntidad) {
                                    const apartamentoUI = detallesApartmentoComoEntidad.apartamentoUI
                                    const apartamentoIDV = detallesApartmentoComoEntidad.apartamentoIDV
                                    const opcion = document.createElement("option");
                                    opcion.value = apartamentoIDV;
                                    opcion.text = `${apartamentoUI} (${apartamentoIDV})`;
                                    contenedorOpciones.add(opcion);
                                }
                                selectorZonaCreacionConfiguracion.appendChild(contenedorOpciones)
                                const botonCrearConfiguracion = document.createElement("div")
                                botonCrearConfiguracion.classList.add("arquitecturaConfCrearConfiguracion_botonCrearConfiguracion")
                                botonCrearConfiguracion.innerText = "Crear configuraciÃ³n"
                                botonCrearConfiguracion.addEventListener("click", casaVitini.administracion.arquitectura_del_alojamiento.configuraciones.crearConfiguracion.transactor)
                                selectorZonaCreacionConfiguracion.appendChild(botonCrearConfiguracion)
                            }
                        }
                    },
                    transactor: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Creando configuraciÃ³n de alojamiento..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const apartamentoSeleccionado = document.querySelector("[componente=selectorApartamentoIDV]").value
                        if (!apartamentoSeleccionado) {
                            const error = "Selecciona un apartamento primero desde el selector de lista"
                            casaVitini.ui.componentes.advertenciaInmersiva(error)
                        }
                        const transaccion = {
                            zona: "administracion/arquitectura/configuraciones/crearConfiguracionAlojamiento",
                            apartamentoIDV: apartamentoSeleccionado
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const apartamentoIDV = respuestaServidor?.apartamentoIDV
                            const vista = `/administracion/arquitectura_del_alojamiento/configuraciones/${apartamentoIDV}`
                            const navegacion = {
                                "vista": vista,
                                "tipoOrigen": "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                }
            }
        },
        usuarios: {
            arranque: async () => {
                const main = document.querySelector("main")
                const instanciaUID = main.getAttribute("instanciaUID")

                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const comandoInicial = granuladoURL.directorios[1]
                const numeroDirectorios = granuladoURL.directorios.length
                const parametroBuscar = granuladoURL.parametros.buscar
                const rawArray = granuladoURL.rawArray


                if (rawArray.length === 2) {

                    casaVitini.administracion.usuarios.portada.buscadorUI()
                } else if (parametroBuscar?.length > 0) {

                    main.setAttribute("zonaCSS", "administracion/usuarios/buscador")
                    casaVitini.administracion.usuarios.portada.buscadorUI()
                    if (!granuladoURL.parametros.buscar) {
                        return
                    }
                    const transaccion = {
                        zona: "administracion/usuarios/buscarUsuarios",
                        tipoBusqueda: "rapido",
                        tipoConstruccionGrid: "total",
                        origen: "url",
                        instanciaUID: instanciaUID,
                        ...granuladoURL.parametros,
                    }
                    transaccion.pagina = transaccion.pagina ? Number(transaccion.pagina) : 1
                    transaccion.buscar = decodeURI(transaccion.buscar)
                    if (transaccion.nombre_columna) {
                        transaccion.nombreColumna = transaccion.nombre_columna.replace(/_([a-z])/g, (match, group) => group.toUpperCase());
                        delete transaccion.nombre_columna
                    }
                    if (transaccion.sentido_columna) {
                        transaccion.sentidoColumna = transaccion.sentido_columna
                        delete transaccion.sentido_columna
                    }
                    const campoBuscador = document.querySelector("[componente=zonaNavegacionPaginadaUsuarios]")
                    campoBuscador.value = transaccion.buscar

                    casaVitini.administracion.usuarios.portada.mostrarUsuariosResueltos(transaccion)
                } else if (rawArray.length > 2) {

                    casaVitini.administracion.usuarios.detallesUsuario.arranque()
                }

                //if (comandoInicial === "crear") {
                //    main.setAttribute("zonaCSS", "administracion/usuarios/nuevo")
                //    casaVitini.administracion.usuarios.crearCuenta.UI()
                //}
            },
            portada: {
                buscadorUI: () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/usuarios/buscador")
                    const espacioClientes = document.querySelector("[componente=espacioUsuarios]")
                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.classList.add("usuarios_contenedorBotones")
                    const botonCrearCuenta = document.createElement("a")
                    botonCrearCuenta.classList.add("usuarios_botonV1")
                    botonCrearCuenta.setAttribute("href", "/administracion/usuarios/nuevo")
                    botonCrearCuenta.setAttribute("vista", "/administracion/usuarios/nuevo")
                    botonCrearCuenta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                    botonCrearCuenta.innerText = "Crear cuenta de usuario"
                    contenedorBotones.appendChild(botonCrearCuenta)
                    espacioClientes.appendChild(contenedorBotones)
                    const campoBuscador = document.createElement("input")
                    campoBuscador.classList.add("campoBuscadorClientes")
                    campoBuscador.setAttribute("componente", "zonaNavegacionPaginadaUsuarios")
                    campoBuscador.setAttribute("componenteCampo", "buscadorUsuarios")
                    campoBuscador.setAttribute("placeholder", "Busque un usuario por nombre de usuario, por nombre, por pasaporte, por correo o por telÃ©fono. TambiÃ©n puedes hacer bÃºsquedas combinadas.")
                    campoBuscador.addEventListener("input", casaVitini.administracion.usuarios.portada.buscadorUsuariosPorCampo)
                    espacioClientes.appendChild(campoBuscador)
                    const contenedorResultados = document.createElement("div")
                    contenedorResultados.setAttribute("contenedor", "resultados")
                    contenedorResultados.classList.add(
                        "flexVertical"
                    )
                    espacioClientes.appendChild(contenedorResultados)
                },
                resolverUsuarios: async (transaccion) => {
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    return respuestaServidor
                },
                buscadorUsuariosPorCampo: async (cliente) => {
                    const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                    const campo = document.querySelector("[componente=zonaNavegacionPaginadaUsuarios]")

                    const espacioUsuarios = document.querySelector("[contenedor=resultados]")
                    espacioUsuarios.innerHTML = null

                    const terminoBusqueda = cliente.target.value
                    document.querySelector("[componente=estadoBusqueda]")?.remove()
                    document.querySelector("[gridUID=gridUsuarios]")?.remove()
                    document.querySelector("[componenteID=navegacionPaginacion]")?.remove()
                    document.querySelector("[contenedor=filtrosOrden]")?.remove()

                    const estadoBusquedaUI = document.createElement("div")
                    estadoBusquedaUI.classList.add("buscadorClientesEstadoBusqueda")
                    estadoBusquedaUI.setAttribute("componente", "estadoBusqueda")
                    estadoBusquedaUI.innerText = "Buscando usuarios..."
                    campo.parentNode.insertBefore(estadoBusquedaUI, campo.nextSibling);


                    const campoVacio = cliente.target.value.length
                    if (campoVacio === 0) {
                        clearTimeout(casaVitini.componentes.temporizador);
                        document.querySelector("[componente=estadoBusqueda]")?.remove()
                        document.querySelector("[componenteID=gridUsuarios]")?.remove()
                        document.querySelector("[componenteID=navegacionPaginacion]")?.remove()
                        const vistaActual = document.getElementById("uiNavegacion").getAttribute("vistaActual")
                        const resetUrl = "/administracion/usuarios"
                        const titulo = "casavitini"
                        const estado = {
                            zona: vistaActual,
                            estadoInternoZona: "estado",
                            tipoCambio: "total"
                        }
                        window.history.replaceState(estado, titulo, resetUrl);
                        return;
                    }
                    clearTimeout(casaVitini.componentes.temporizador);
                    casaVitini.componentes.temporizador = setTimeout(async () => {
                        const transaccion = {
                            zona: "administracion/usuarios/buscarUsuarios",
                            tipoBusqueda: "rapido",
                            pagina: 1,
                            buscar: terminoBusqueda,
                            origen: "botonMostrarUsuarios",
                            tipoConstruccionGrid: "total",
                            instanciaUID: instanciaUID
                        }
                        casaVitini.administracion.usuarios.portada.mostrarUsuariosResueltos(transaccion)
                    }, 1500);
                },
                constructorGrid: (metadatos) => {
                    if (!metadatos.usuarios) {
                        const error = "no estoy recibiendo clientes, recuerda que constructorGridClientes, necesita el objeto ya proceador por el servidor, no lo envia"
                        casaVitini.ui.componentes.advertenciaInmersiva(error)
                    }
                    const usuarios = metadatos.usuarios
                    const metadatosBusqueda = { ...metadatos }
                    delete metadatosBusqueda.usuarios
                    const gridConstruido = document.querySelector("[componenteID=gridUsuarios]")
                    const constructorGrid = document.createElement("div")
                    constructorGrid.setAttribute("class", "administracionGridUsuarios")
                    constructorGrid.setAttribute("componenteID", "gridUsuarios")
                    constructorGrid.setAttribute("metadatosBusqueda", JSON.stringify(metadatosBusqueda))
                    const selectorTitulosColumnas = document.querySelectorAll("[componenteGrid=celdaTituloColumna]")
                    selectorTitulosColumnas.forEach((celdaTituloColumna) => {
                        celdaTituloColumna.style.removeProperty("background")
                        celdaTituloColumna.querySelector("[sentidoIconos]")?.remove()
                    })
                    let icononombreColumna
                    let descripcionnombreColumna
                    if (metadatos?.sentidoColumna) {
                        if (metadatos.sentidoColumna === "ascendente") {
                            icononombreColumna = "/componentes/iconos/ascendente.svg"
                            descripcionnombreColumna = "Ordenar acendentemente esta columna"
                        }
                        if (metadatos.sentidoColumna === "descendente") {
                            icononombreColumna = "/componentes/iconos/descendente.svg"
                            descripcionnombreColumna = "Ordenar descendentemente esta columna"
                        }
                    }
                    if (metadatos.tipoConstruccionGrid === "soloLista") {
                        if (metadatos.nombreColumna) {
                            const columnaSeleccionada = document.querySelector(`[componenteGrid=celdaTituloColumna][nombreColumna=${metadatos.nombreColumna}]`)
                            columnaSeleccionada.setAttribute("sentidoColumna", metadatos.sentidoColumna)
                            columnaSeleccionada.style.background = "#ffffff80"
                            const iconoColumna = document.createElement("img");
                            iconoColumna.src = icononombreColumna;
                            iconoColumna.alt = descripcionnombreColumna;
                            iconoColumna.classList.add("icononombreColumna");
                            iconoColumna.setAttribute("sentidoIconos", metadatos.sentidoColumna)
                            columnaSeleccionada.appendChild(iconoColumna)
                        }
                        let metadatosBusqueda = document.querySelector("[metadatosBusqueda]").getAttribute("metadatosBusqueda")
                        metadatosBusqueda = JSON.parse(metadatosBusqueda)
                        metadatosBusqueda.nombreColumna = metadatos.nombreColumna
                        metadatosBusqueda.sentidoColumna = metadatos.sentidoColumna
                        metadatosBusqueda = JSON.stringify(metadatosBusqueda)
                        document.querySelector("[metadatosBusqueda]").setAttribute("metadatosBusqueda", metadatosBusqueda)
                    }
                    const titulosColumnas = ["Usuario", "Nombre", "Primer apellido", "Segundo Apellido", "Pasaporte", "Correo electrÃ³nico", "TelÃ©fono"]
                    const nombreColumnas = ["usuarioIDX", "nombre", "primerApellido", "segundoApellido", "pasaporte", "mail", "telefono"]
                    const classesTitulos = ["idColumna", "entradaColumna", "salidaColuma", "estadoColumna", "pagoColumna"]
                    titulosColumnas.forEach((tituloColumna, ciclo) => {
                        const columnaElemento = document.createElement("div")
                        columnaElemento.innerText = tituloColumna
                        //columnaElemento.classList.add(classesTitulos[ciclo])
                        columnaElemento.classList.add("celdaTituloCompartidoGrid")
                        columnaElemento.classList.add("negrita")
                        columnaElemento.setAttribute("nombreColumna", nombreColumnas[ciclo])
                        columnaElemento.setAttribute("componenteGrid", "celdaTituloColumna")
                        columnaElemento.addEventListener("click", casaVitini.administracion.usuarios.portada.ordenarPorColumna)
                        if (metadatos.nombreColumna === nombreColumnas[ciclo]) {
                            if (metadatos.nombreColumna) {
                                columnaElemento.style.background = "#ffffff80"
                                columnaElemento.setAttribute("nombreColumna", metadatos.sentidoColumna)
                                const iconoColumna = document.createElement("img");
                                iconoColumna.src = icononombreColumna;
                                iconoColumna.alt = descripcionnombreColumna;
                                iconoColumna.classList.add("icononombreColumna");
                                iconoColumna.setAttribute("sentidoIconos", metadatos.sentidoColumna)
                                columnaElemento.appendChild(iconoColumna)
                            }
                        }
                        if (metadatos.tipoConstruccionGrid === "soloLista") {
                        } else {
                            constructorGrid.appendChild(columnaElemento)
                        }
                    })
                    if (metadatos.tipoConstruccionGrid === "soloLista") {
                        let selectorFilasGrid = document.querySelectorAll("[componenteGrid=fila]")
                        selectorFilasGrid.forEach((filaGrid) => {
                            filaGrid.remove()
                        })
                    }
                    usuarios.forEach((detallesDelUsuario) => {
                        const usuarioIDX = detallesDelUsuario.usuarioIDX
                        const nombre = detallesDelUsuario.nombre
                        const primerApellido = detallesDelUsuario.primerApellido
                        const segundoApellido = detallesDelUsuario.segundoApellido
                        const pasaporte = detallesDelUsuario.pasaporte
                        const mail = detallesDelUsuario.mail
                        const telefono = detallesDelUsuario.telefono
                        //               const titulosColumnas = ["Usuario", "Nombre", "Primer apellido", "Segundo Apellido", "Pasaporte", "Correo electrÃ³nico", "TelÃ©fono"]
                        const celdaUsuarioIDX = document.createElement("div")
                        celdaUsuarioIDX.setAttribute("class", "celdaCompartidoGrid")
                        celdaUsuarioIDX.setAttribute("nombreColumna", "usuarioIDX")
                        celdaUsuarioIDX.innerText = usuarioIDX
                        const celdaNombre = document.createElement("div")
                        celdaNombre.setAttribute("class", "celdaCompartidoGrid")
                        celdaNombre.setAttribute("nombreColumna", "nombre")
                        celdaNombre.innerText = nombre
                        const celdaPrimerApellido = document.createElement("div")
                        celdaPrimerApellido.setAttribute("class", "celdaCompartidoGrid")
                        celdaPrimerApellido.setAttribute("nombreColumna", "primerApellido")
                        celdaPrimerApellido.innerText = primerApellido
                        const celdaSegundoApellido = document.createElement("div")
                        celdaSegundoApellido.setAttribute("class", "celdaCompartidoGrid")
                        celdaSegundoApellido.setAttribute("nombreColumna", "segundoApellido")
                        celdaSegundoApellido.innerText = segundoApellido
                        const celdaPasaporte = document.createElement("div")
                        celdaPasaporte.setAttribute("class", "celdaCompartidoGrid")
                        celdaPasaporte.setAttribute("nombreColumna", "pasaporte")
                        celdaPasaporte.innerText = pasaporte
                        const celdaMail = document.createElement("div")
                        celdaMail.setAttribute("class", "celdaCompartidoGrid")
                        celdaMail.setAttribute("nombreColumna", "mail")
                        celdaMail.innerText = mail
                        const celdaTelefono = document.createElement("div")
                        celdaTelefono.setAttribute("nombreColumna", "telefono")
                        celdaTelefono.setAttribute("class", "celdaCompartidoGrid")
                        celdaTelefono.innerText = telefono
                        const fila = document.createElement("a")
                        fila.setAttribute("class", "adminitracionReservasFila")
                        fila.setAttribute("usuarioIDX", usuarioIDX)
                        fila.setAttribute("href", "/administracion/usuarios/" + usuarioIDX)
                        fila.setAttribute("componenteGrid", "fila")
                        fila.setAttribute("vista", "/administracion/usuarios/" + usuarioIDX)
                        fila.addEventListener("click", casaVitini.administracion.usuarios.portada.resolverFila)
                        fila.appendChild(celdaUsuarioIDX)
                        fila.appendChild(celdaNombre)
                        fila.appendChild(celdaPrimerApellido)
                        fila.appendChild(celdaSegundoApellido)
                        fila.appendChild(celdaPasaporte)
                        fila.appendChild(celdaMail)
                        fila.appendChild(celdaTelefono)
                        if (metadatos.tipoConstruccionGrid === "soloLista") {
                            gridConstruido.appendChild(fila)
                        } else {
                            constructorGrid.appendChild(fila)
                        }
                    })
                    if (metadatos.tipoConstruccionGrid === "soloLista") {
                    } else {
                        document.querySelector("[componenteID=gridReservas]")?.remove()
                        document.querySelector("[componente=espacioUsuarios]")?.appendChild(constructorGrid)
                    }
                },
                mostrarUsuariosResueltos: async function (transaccion) {
                    const instanciaUID = transaccion.instanciaUID
                    delete transaccion.instanciaUID
                    const origen = transaccion.origen
                    delete transaccion.origen
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    const tipoConstruccionGrid = transaccion.tipoConstruccionGrid
                    delete transaccion.tipoConstruccionGrid
                    const paginaTipo = transaccion.paginaTipo
                    delete transaccion.paginaTipo
                    const resolverUsuarios = await casaVitini.administracion.usuarios.portada.resolverUsuarios(transaccion)

                    const instanciaRenderizada = document.querySelector(`main[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada || !resolverUsuarios) {
                        return
                    }
                    //document.querySelector("[gridUID=gridUsuarios]")?.remove()
                    if (resolverUsuarios?.error) {
                        document.querySelector("[componente=estadoBusqueda]").innerText = resolverUsuarios?.error
                        return
                    }

                    if (resolverUsuarios.totalUsuarios === 0) {
                        document.querySelector("[componente=estadoBusqueda]").innerText = "No se han encontrado usuarios"
                        return
                    }
                    document.querySelector("[componente=estadoBusqueda]")?.remove()
                    const usuarios = resolverUsuarios.usuarios
                    const buscar = resolverUsuarios.buscar
                    const paginasTotales = resolverUsuarios.paginasTotales
                    const paginaActual = resolverUsuarios.pagina
                    const nombreColumna = resolverUsuarios.nombreColumna
                    const sentidoColumna = resolverUsuarios.sentidoColumna
                    const columnasGrid = [
                        {
                            columnaUI: "IDX",
                            columnaIDV: "usuario",
                            columnaClase: "idColumna"
                        },
                        {
                            columnaUI: "Correo",
                            columnaIDV: "mail",
                            columnaClase: "entradaColumna"
                        },
                        {
                            columnaUI: "Nombre",
                            columnaIDV: "nombre",
                            columnaClase: "salidaColuma"
                        },
                        {
                            columnaUI: "Primer apellido",
                            columnaIDV: "primerApellido",
                            columnaClase: "estadoColumna"
                        },
                        {
                            columnaUI: "Segundo Apellido",
                            columnaIDV: "segundoApellido",
                            columnaClase: "pagoColumna"
                        },
                        {
                            columnaUI: "Pasaporte",
                            columnaIDV: "pasaporte",
                            columnaClase: "pagoColumna"
                        },
                        {
                            columnaUI: "TelÃ©fono",
                            columnaIDV: "telefono",
                            columnaClase: "pagoColumna"
                        },
                    ]
                    const parametrosFinales = {
                        buscar: buscar
                    }
                    if (paginaActual > 1 && paginasTotales > 1) {
                        parametrosFinales.pagina = paginaActual
                    }
                    if (nombreColumna) {
                        parametrosFinales.pagina = paginaActual
                        parametrosFinales.nombre_columna = nombreColumna.replace(/([a-z])([A-Z])/g, "$1_$2").toLowerCase();
                        parametrosFinales.sentido_columna = sentidoColumna
                    }
                    const estructuraParametrosFinales = []
                    for (const [parametroFinal, valorFinal] of Object.entries(parametrosFinales)) {
                        const estructura = `${parametroFinal}:${valorFinal}`
                        estructuraParametrosFinales.push(estructura)
                    }
                    let parametrosURLFInal = ""
                    if (estructuraParametrosFinales.length > 0) {
                        parametrosURLFInal = "/" + estructuraParametrosFinales.join("/")
                    }
                    this.selectorFiltro.ui({
                        columnas: columnasGrid,
                        columnaSeleccioanda: nombreColumna,
                        sentidoSeleccionado: sentidoColumna,
                        destino: "[contenedor=resultados]"
                    })

                    this.constructorTarjetas({
                        tarjetas: usuarios,
                        destino: "[contenedor=resultados]"

                    })

                    const constructorURLFinal = granuladoURL.directoriosFusion + parametrosURLFInal
                    const metadatosGrid = {
                        filas: usuarios,
                        sentidoColumna: sentidoColumna,
                        nombreColumna: nombreColumna,
                        tipoConstruccionGrid: tipoConstruccionGrid,
                        buscar: buscar,
                        pagina: paginaActual,
                        destino: "[contenedor=resultados]",
                        columnasGrid: columnasGrid,
                        gridUID: "gridUsuarios",
                        numeroColumnas: 7,
                        metodoColumna: "casaVitini.administracion.usuarios.portada.ordenarPorColumna",
                        metodoFila: "casaVitini.administracion.usuarios.portada.resolverFila",
                        mascaraHref: {
                            urlStatica: "/administracion/usuarios/",
                            parametro: "usuario"
                        },
                        //mascaraURL: constructorURLFinal
                    }
                    casaVitini.ui.componentes.grid(metadatosGrid)
                    const metadatosPaginador = {
                        paginaActual: paginaActual,
                        paginasTotales: paginasTotales,
                        destino: "[componente=espacioUsuarios]",
                        metodoBoton: "casaVitini.administracion.usuarios.portada.cambiarPagina",
                        gridUID: "gridUsuarios",
                        granuladoURL: {
                            parametros: parametrosFinales,
                            directoriosFusion: granuladoURL.directoriosFusion
                        }
                    }
                    casaVitini.ui.componentes.paginador(metadatosPaginador)
                    transaccion.tipoConstruccionGrid = "soloLista"
                    const titulo = "ADminstar reservas"
                    const estado = {
                        zona: constructorURLFinal,
                        EstadoInternoZona: "estado",
                        tipoCambio: "parcial",
                        componenteExistente: "zonaNavegacionPaginadaUsuarios",
                        funcionPersonalizada: "casaVitini.administracion.usuarios.portada.mostrarUsuariosResueltos",
                        datosPaginacion: transaccion
                    }
                    if (origen === "url" || origen === "botonMostrarUsuarios") {
                        window.history.replaceState(estado, titulo, constructorURLFinal);
                    }
                    if ((origen === "botonNumeroPagina" && paginaTipo === "otra") || origen === "tituloColumna") {
                        window.history.pushState(estado, titulo, constructorURLFinal);
                    }
                    if (origen === "botonNumeroPagina" && paginaTipo === "actual") {
                        window.history.replaceState(estado, titulo, constructorURLFinal);
                    }
                },
                ordenarPorColumna: async (columna) => {
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")

                    const nombreColumna = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("nombreColumna")
                    const selectorColumnasentido = columna.target.closest("[componenteGrid=celdaTituloColumna]").getAttribute("sentidoColumna")
                    const numeroPagina = columna.target.closest("[gridUID]").getAttribute("numeroPagina")
                    const terminoBusqueda = columna.target.closest("[gridUID]").getAttribute("terminoBusqueda")
                    let sentidoColumna
                    const transaccion = {
                        zona: "administracion/usuarios/buscarUsuarios",
                        tipoBusqueda: "rapido",
                        pagina: Number(numeroPagina),
                        buscar: terminoBusqueda,
                        tipoConstruccionGrid: "soloLista",
                        origen: "tituloColumna",
                        instanciaUID: instanciaUID
                    }
                    if (selectorColumnasentido === "ascendente") {
                        transaccion.sentidoColumna = "descendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    if (!selectorColumnasentido) {
                        transaccion.sentidoColumna = "ascendente"
                        transaccion.nombreColumna = nombreColumna
                    }
                    casaVitini.administracion.usuarios.portada.mostrarUsuariosResueltos(transaccion)
                },
                cambiarPagina: async (cambiarPagina) => {
                    const main = document.querySelector("main")
                    const instanciaUID = main.getAttribute("instanciaUID")

                    const gridUID = cambiarPagina.gridUID
                    const gridEnlazado = document.querySelector(`[gridUID=${gridUID}]`)
                    const tipoBoton = cambiarPagina.componenteID
                    const nombreColumna = gridEnlazado.getAttribute("nombreColumnaSeleccionada")
                    const sentidoColumna = gridEnlazado.getAttribute("sentidoColumna")
                    const terminoBusqueda = gridEnlazado.getAttribute("terminoBusqueda")
                    const paginaActual = Number(gridEnlazado.getAttribute("numeroPagina"))
                    const paginaTipo = cambiarPagina.paginaTipo
                    const transacccion = {
                        nombreColumna: nombreColumna,
                        sentidoColumna: sentidoColumna,
                        buscar: terminoBusqueda,
                        paginaTipo: paginaTipo,
                        tipoBusqueda: "rapido",
                        instanciaUID: instanciaUID,
                    }
                    if (tipoBoton === "numeroPagina") {
                        const numeroPagina = cambiarPagina.numeroPagina
                        transacccion.pagina = Number(numeroPagina)
                        transacccion.origen = "botonNumeroPagina"
                    }
                    if (tipoBoton === "botonAdelantePaginacion") {
                        const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                        let mueveNavegadorHaciaAdelante = "Desactivado";
                        if (Number(posicionRelativa) === 10) {
                            mueveNavegadorHaciaAdelante = "Activado"
                        }
                        transacccion.pagina = paginaActual + 1
                        transacccion.origen = "botonNumeroPagina"
                        transacccion.moverHaciaAdelanteNavegacion = mueveNavegadorHaciaAdelante
                        transacccion.sentidoNavegacion = "Adelante"
                    }
                    if (tipoBoton === "botonAtrasPaginacion") {
                        const posicionRelativa = document.querySelector("[paginaTipo=actual]").getAttribute("posicionRelativa")
                        let mueveNavegadorHaciaAtras = "Desactivado";
                        if (Number(posicionRelativa) === 1) {
                            mueveNavegadorHaciaAtras = "Activado"
                        }
                        transacccion.pagina = paginaActual - 1
                        transacccion.origen = "botonNumeroPagina"
                        transacccion.mueveNavegadorHaciaAtras = mueveNavegadorHaciaAtras
                        transacccion.sentidoNavegacion = "Atras"
                    }
                    transacccion.tipoConstruccionGrid = "soloLista"
                    transacccion.zona = "administracion/usuarios/buscarUsuarios"
                    casaVitini.administracion.usuarios.portada.mostrarUsuariosResueltos(transacccion)
                },
                resolverFila: (transaccion) => {
                    transaccion.preventDefault()
                    transaccion.stopPropagation()
                    const href = transaccion.target.closest("[href]").getAttribute("href")
                    const navegacion = {
                        vista: href,
                        tipoOrigen: "menuNavegador"
                    }
                    casaVitini.shell.navegacion.controladorVista(navegacion)
                },
                constructorTarjetas: (data) => {
                    const usuarios = data.tarjetas
                    const destino = data.destino

                    const contenedorTarjetas = document.querySelector("[contenedor=tarjetas]")
                    contenedorTarjetas?.remove()

                    const contenedor = document.createElement("div")
                    contenedor.setAttribute("contenedor", "tarjetas")
                    contenedor.classList.add(
                        "flexVertical",
                        "gap6"
                    )

                    usuarios.forEach(u => {
                        const usuario = u.usuario
                        const nombre = u.nombre
                        const primerApellido = u.primerApellido
                        const segundoApellido = u.segundoApellido
                        const pasaporte = u.pasaporte
                        const telefono = u.telefono
                        const mail = u.mail




                        const tarjeta = document.createElement("a")
                        tarjeta.setAttribute("componente", "tarjeta")
                        tarjeta.classList.add(
                            "flexVertical",
                            "gap6",
                            "tarjeta",
                            "borderRadius10",
                            "backgroundGrey1",
                            "padding10",
                            "areaSinDecoracionPredeterminada",
                            "ratonDefault",
                            "comportamientoBoton"
                        )
                        tarjeta.href = `/administracion/usuarios/${usuario}`
                        tarjeta.setAttribute("vista", `/administracion/usuarios/${usuario}`)
                        tarjeta.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                        contenedor.appendChild(tarjeta)

                        const datosPar = {
                            "Usuario": usuario,
                            "Nombre": nombre,
                            "Primer apellido": primerApellido,
                            "Segundo apellido": segundoApellido,
                            "Pasaporte": pasaporte,
                            "TelÃ©fono": telefono,
                            "Mail": mail
                        }

                        Object.entries(datosPar).forEach(([datoUI, data]) => {

                            const contenedor = document.createElement("div")
                            contenedor.classList.add(
                                "flexVertical"
                            )
                            if (data) {
                                tarjeta.appendChild(contenedor)
                            }
                            const titulo = document.createElement("div")
                            titulo.innerHTML = datoUI
                            contenedor.appendChild(titulo)

                            const dataUI = document.createElement("div")
                            dataUI.classList.add(
                                "negrita",
                                "textoElipsis"
                            )
                            dataUI.innerText = data
                            contenedor.appendChild(dataUI)
                        })
                    })
                    document.querySelector(destino).appendChild(contenedor)
                },
                selectorFiltro: {
                    ui: function (data) {
                        const destino = data.destino
                        const columnas = data.columnas

                        const columnaSeleccioanda = data?.columnaSeleccioanda || null
                        const sentidoSeleccionado = data?.sentidoSeleccionado || null
                        const selectorFiltroOrden = document.querySelector("[contenedor=filtrosOrden]")
                        if (selectorFiltroOrden) {
                            const selectorOrdenPorColumna = selectorFiltroOrden.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = selectorFiltroOrden.querySelector("[selector=sentido]")

                            if (columnaSeleccioanda) {
                                selectorOrdenPorColumna.value = columnaSeleccioanda

                            } else {
                                selectorOrdenPorColumna.selectedIndex = 0
                            }
                            if (sentidoSeleccionado) {
                                selectorSentido.value = sentidoSeleccionado
                            } else {
                                selectorSentido.selectedIndex = 0
                            }
                            return
                        }

                        const contenedorFiltrosOrden = document.createElement("div")
                        contenedorFiltrosOrden.classList.add(
                            "gap6",
                            "flexDerecha"
                        )
                        contenedorFiltrosOrden.setAttribute("contenedor", "filtrosOrden")

                        const botonReseteo = document.createElement("div")
                        botonReseteo.classList.add(
                            "selector",
                            "textoCentrado",
                            "comportamientoBoton",
                            "noSelecionable",
                            "ratonDefault"
                        )
                        botonReseteo.innerText = "Resetear filtros"
                        botonReseteo.addEventListener("click", (e) => {
                            const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                            const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]")
                            const selectorSentido = contenedor.querySelector("[selector=sentido]")
                            selectorColumna.selectedIndex = 0
                            selectorSentido.selectedIndex = 0
                            this.pasarela(e)
                        })
                        contenedorFiltrosOrden.appendChild(botonReseteo)

                        const selectorColumna = document.createElement("select")
                        selectorColumna.setAttribute("selector", "ordenPorColumna")
                        selectorColumna.addEventListener("change", this.pasarela)
                        selectorColumna.classList.add(
                            "selector",
                            "textoCentrado"
                        )
                        contenedorFiltrosOrden.appendChild(selectorColumna)
                        const opcionPreterminada = document.createElement("option");
                        opcionPreterminada.disabled = "true"
                        opcionPreterminada.value = ""
                        opcionPreterminada.text = "Ordenar por columna";
                        if (!columnaSeleccioanda) {
                            opcionPreterminada.selected = "true"
                        }

                        selectorColumna.add(opcionPreterminada)

                        columnas.forEach((columna) => {
                            const columnaUI = columna.columnaUI
                            const columnaIDV = columna.columnaIDV
                            const opcion = document.createElement("option");
                            opcion.value = columnaIDV;
                            opcion.text = columnaUI;
                            if (columnaSeleccioanda === columnaIDV) {
                                opcion.selected = "true"
                            }
                            selectorColumna.add(opcion);
                        })

                        const selectorSentido = document.createElement("select")
                        selectorSentido.setAttribute("selector", "sentido")
                        selectorSentido.addEventListener("change", this.pasarela)

                        selectorSentido.classList.add(
                            "selector",
                            "textoCentrado"
                        )
                        contenedorFiltrosOrden.appendChild(selectorSentido)
                        const opcionSentido = document.createElement("option");
                        opcionSentido.disabled = "true"
                        opcionSentido.text = "Sentido";
                        opcionSentido.value = ""
                        if (!sentidoSeleccionado) {
                            opcionSentido.selected = "true"
                        }
                        selectorSentido.add(opcionSentido)

                        const sentidos = [
                            {
                                sentidoUI: "Ascendente",
                                sentidoIDV: "ascendente"
                            },
                            {
                                sentidoUI: "Descendente",
                                sentidoIDV: "descendente"
                            }
                        ]

                        sentidos.forEach((sentido) => {
                            const sentidoUI = sentido.sentidoUI
                            const sentidoIDV = sentido.sentidoIDV
                            const opcion = document.createElement("option");
                            opcion.value = sentidoIDV;
                            opcion.text = sentidoUI;
                            if (sentidoSeleccionado === sentidoIDV) {
                                opcion.selected = "true"
                            }
                            selectorSentido.add(opcion);
                        })
                        document.querySelector(destino).appendChild(contenedorFiltrosOrden)
                    },
                    pasarela: (e) => {
                        const contenedor = e.target.closest("[contenedor=filtrosOrden]")
                        const instanciaUID = document.querySelector("main[instanciaUID]").getAttribute("instanciaUID")
                        const selectorColumna = contenedor.querySelector("[selector=ordenPorColumna]").value
                        const selectorSentido = contenedor.querySelector("[selector=sentido]").value
                        const ui = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        const numeroPagina = ui.querySelector("[gridUID]").getAttribute("numeroPagina")
                        const terminoBusqueda = ui.querySelector("[gridUID]").getAttribute("terminoBusqueda")

                        //let parametros = ui.querySelector("[gridUID]").getAttribute("parametros")
                        //parametros = parametros ? JSON.parse(parametros) : {}
                        const transaccion = {
                            zona: "administracion/usuarios/buscarUsuarios",
                            tipoBusqueda: "rapido",
                            pagina: Number(numeroPagina),
                            buscar: terminoBusqueda,
                            tipoConstruccionGrid: "soloLista",
                            origen: "tituloColumna",
                            instanciaUID: instanciaUID,
                            granuladoURL: casaVitini.utilidades.granuladorURL()
                        }
                        transaccion.sentidoColumna = selectorSentido
                        transaccion.nombreColumna = selectorColumna

                        //for (const [parametro, valor] of Object.entries(parametros)) {
                        //    transaccion[parametro] = valor
                        //}
                        casaVitini.administracion.usuarios.portada.mostrarUsuariosResueltos(transaccion)
                    }
                },
            },
            detallesUsuario: {
                arranque: () => {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/usuarios/detallesDelUsuario")
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    const comandoInicial = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                    if (comandoInicial === "datos_personales") {
                        const usuarioUID = granuladoURL.directorios[granuladoURL.directorios.length - 2]
                        casaVitini.administracion.usuarios.detallesUsuario.datosUsuario.UI(usuarioUID)
                    } else if (comandoInicial === "modificar_idx") {
                        const usuarioUID = granuladoURL.directorios[granuladoURL.directorios.length - 2]
                        casaVitini.administracion.usuarios.detallesUsuario.modificarIDX.UI(usuarioUID)
                    } else if (comandoInicial === "cambiar_clave") {
                        const usuarioUID = granuladoURL.directorios[granuladoURL.directorios.length - 2]
                        casaVitini.administracion.usuarios.detallesUsuario.cambiarClave.UI(usuarioUID)
                    } else if (comandoInicial === "rol") {
                        const usuarioUID = granuladoURL.directorios[granuladoURL.directorios.length - 2]
                        casaVitini.administracion.usuarios.detallesUsuario.rol.UI(usuarioUID)
                    } else {
                        casaVitini.administracion.usuarios.detallesUsuario.portada.UI(comandoInicial)
                    }

                },
                portada: {
                    UI: async (usuarioIDX) => {
                        const espacioUsuario = document.querySelector("[componente=espacioUsuarios]")
                        const transaccion = {
                            zona: "administracion/usuarios/datosCuentaIDX",
                            usuarioIDX: usuarioIDX
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            const info = {
                                titulo: "No existe ningun usuario con ese identificador",
                                descripcion: "El usuario no existe.Prueba con otro identificador"
                            }
                            casaVitini.ui.componentes.mensajeSimple(info)
                        }
                        if (respuestaServidor?.ok) {
                            const detallesUsuario = respuestaServidor?.ok
                            const usuarioIDX = detallesUsuario.usuario
                            const rol = detallesUsuario.rol
                            const estadoCuenta = detallesUsuario.estadoCuenta
                            const contenedorDetallesUsuario = document.createElement("div")
                            contenedorDetallesUsuario.classList.add("detallesUsuario_contenedorGlobal")
                            contenedorDetallesUsuario.setAttribute("componente", "contenedorGlobal")
                            const datosBanner = {
                                usuarioIDX: usuarioIDX,
                                rol: rol
                            }
                            const contenedorUsuarioIDX = casaVitini.administracion.usuarios.detallesUsuario.componentes.bannerIDX(datosBanner)
                            contenedorDetallesUsuario.appendChild(contenedorUsuarioIDX)
                            espacioUsuario.appendChild(contenedorDetallesUsuario)
                            let estadoCuentaUI
                            if (estadoCuenta === "activado") {
                                estadoCuentaUI = "Desactivar cuenta"
                            }
                            if (estadoCuenta === "desactivado") {
                                estadoCuentaUI = "Activar cuenta"
                            }
                            const contenedorOpciones = document.createElement("div")
                            contenedorOpciones.classList.add("detallesUsuario_contenedorOpciones")
                            const opcionInformacion = document.createElement("a")
                            opcionInformacion.classList.add("detallesUsuario_opcionInformacion")
                            opcionInformacion.innerText = "Sus datos personales"
                            opcionInformacion.setAttribute("href", `/administracion/usuarios/${usuarioIDX}/datos_personales`)
                            opcionInformacion.setAttribute("vista", `/administracion/usuarios/${usuarioIDX}/datos_personales`)
                            opcionInformacion.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                            contenedorOpciones.appendChild(opcionInformacion)
                            const opcionCambiarIDX = document.createElement("a")
                            opcionCambiarIDX.classList.add("detallesUsuario_opcionInformacion")
                            opcionCambiarIDX.setAttribute("href", `/administracion/usuarios/${usuarioIDX}/modificar_idx`)
                            opcionCambiarIDX.setAttribute("vista", `/administracion/usuarios/${usuarioIDX}/modificar_idx`)
                            opcionCambiarIDX.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                            opcionCambiarIDX.innerText = "Modificar su VitiniID"
                            contenedorOpciones.appendChild(opcionCambiarIDX)
                            const opcionCambiarRol = document.createElement("a")
                            opcionCambiarRol.classList.add("detallesUsuario_opcionInformacion")
                            opcionCambiarRol.setAttribute("href", `/administracion/usuarios/${usuarioIDX}/rol`)
                            opcionCambiarRol.setAttribute("vista", `/administracion/usuarios/${usuarioIDX}/rol`)
                            opcionCambiarRol.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                            opcionCambiarRol.innerText = "Cambiar su rol"
                            contenedorOpciones.appendChild(opcionCambiarRol)
                            const opcionClave = document.createElement("a")
                            opcionClave.classList.add("detallesUsuario_opcionInformacion")
                            opcionClave.setAttribute("href", `/administracion/usuarios/${usuarioIDX}/cambiar_clave`)
                            opcionClave.setAttribute("vista", `/administracion/usuarios/${usuarioIDX}/cambiar_clave`)
                            opcionClave.addEventListener("click", casaVitini.shell.navegacion.cambiarVista)
                            opcionClave.innerText = "Cambiar su contrasena"
                            contenedorOpciones.appendChild(opcionClave)
                            const opcionCambiarEstado = document.createElement("a")
                            opcionCambiarEstado.classList.add("detallesUsuario_opcionInformacion")
                            opcionCambiarEstado.setAttribute("estadoCuenta", estadoCuenta)
                            opcionCambiarEstado.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.cambiarEstadoCuenta.UI)
                            opcionCambiarEstado.innerText = estadoCuentaUI
                            contenedorOpciones.appendChild(opcionCambiarEstado)
                            const opcionEliminarCuenta = document.createElement("a")
                            opcionEliminarCuenta.classList.add("detallesUsuario_opcionInformacion")
                            opcionEliminarCuenta.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.eliminarCuenta.UI)
                            opcionEliminarCuenta.innerText = "Eliminar su cuenta"
                            contenedorOpciones.appendChild(opcionEliminarCuenta)
                            espacioUsuario.appendChild(contenedorOpciones)
                        }
                    },
                },
                datosUsuario: {
                    UI: async (usuarioIDX) => {
                        const espacioUsuario = document.querySelector("[componente=espacioUsuarios]")
                        const transaccion = {
                            zona: "/administracion/usuarios/detallesUsuario",
                            usuarioIDX: usuarioIDX
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const detallesUsuario = respuestaServidor?.ok
                            const usuarioIDX = detallesUsuario.usuarioIDX
                            const rol = detallesUsuario.rol
                            const datosUsuario = detallesUsuario.datosUsuario
                            const nombre = datosUsuario.nombre || ""
                            const primerApellido = datosUsuario.primerApellido || ""
                            const segundoApellido = datosUsuario.segundoApellido || ""
                            const pasaporte = datosUsuario.pasaporte || ""
                            const telefono = datosUsuario.telefono || ""
                            const mail = datosUsuario.mail || ""
                            const contenedorDetallesUsuario = document.createElement("div")
                            contenedorDetallesUsuario.classList.add("detallesUsuario_contenedorGlobal")
                            contenedorDetallesUsuario.setAttribute("componente", "contenedorGlobal")
                            const datosBanner = {
                                usuarioIDX: usuarioIDX,
                                rol: rol
                            }
                            const contenedorUsuarioIDX = casaVitini.administracion.usuarios.detallesUsuario.componentes.bannerIDX(datosBanner)
                            contenedorDetallesUsuario.appendChild(contenedorUsuarioIDX)
                            espacioUsuario.appendChild(contenedorDetallesUsuario)
                            const contenedorDatosUsuario = document.createElement("div")
                            contenedorDatosUsuario.classList.add("detallesUsuario_contenedorDatosUsuario")
                            const nombreUI = document.createElement("a")
                            nombreUI.classList.add("detallesUsuario_contenedorCampoEInfo")
                            let titulo = document.createElement("p")
                            titulo.classList.add("tituloDato")
                            titulo.innerText = "Nombre"
                            nombreUI.appendChild(titulo)
                            const campoNombre = document.createElement("input")
                            campoNombre.classList.add("detallesUsuario_campoDatosUsuario")
                            campoNombre.setAttribute("campo", "nombre")
                            campoNombre.value = nombre
                            nombreUI.appendChild(campoNombre)
                            contenedorDatosUsuario.appendChild(nombreUI)
                            const primerApellidoUI = document.createElement("a")
                            primerApellidoUI.classList.add("detallesUsuario_contenedorCampoEInfo")
                            titulo = document.createElement("p")
                            titulo.classList.add("tituloDato")
                            titulo.innerText = "Primero apellido"
                            primerApellidoUI.appendChild(titulo)
                            const campoPrimerApellido = document.createElement("input")
                            campoPrimerApellido.classList.add("detallesUsuario_campoDatosUsuario")
                            campoPrimerApellido.setAttribute("campo", "primerApellido")
                            campoPrimerApellido.value = primerApellido
                            primerApellidoUI.appendChild(campoPrimerApellido)
                            contenedorDatosUsuario.appendChild(primerApellidoUI)
                            const segundoApellidoUI = document.createElement("a")
                            segundoApellidoUI.classList.add("detallesUsuario_contenedorCampoEInfo")
                            titulo = document.createElement("p")
                            titulo.classList.add("tituloDato")
                            titulo.innerText = "Segundo apellido"
                            segundoApellidoUI.appendChild(titulo)
                            const campoSegundoApellido = document.createElement("input")
                            campoSegundoApellido.classList.add("detallesUsuario_campoDatosUsuario")
                            campoSegundoApellido.setAttribute("campo", "segundoApellido")
                            campoSegundoApellido.value = segundoApellido
                            segundoApellidoUI.appendChild(campoSegundoApellido)
                            contenedorDatosUsuario.appendChild(segundoApellidoUI)
                            const pasaporteUI = document.createElement("a")
                            pasaporteUI.classList.add("detallesUsuario_contenedorCampoEInfo")
                            titulo = document.createElement("p")
                            titulo.classList.add("tituloDato")
                            titulo.innerText = "Pasaporte"
                            pasaporteUI.appendChild(titulo)
                            const campoPasaporte = document.createElement("input")
                            campoPasaporte.classList.add("detallesUsuario_campoDatosUsuario")
                            campoPasaporte.setAttribute("campo", "pasaporte")
                            campoPasaporte.value = pasaporte
                            pasaporteUI.appendChild(campoPasaporte)
                            contenedorDatosUsuario.appendChild(pasaporteUI)
                            const telefonoUI = document.createElement("a")
                            telefonoUI.classList.add("detallesUsuario_contenedorCampoEInfo")
                            titulo = document.createElement("p")
                            titulo.classList.add("tituloDato")
                            titulo.innerText = "TelÃ©fono"
                            telefonoUI.appendChild(titulo)
                            const campoTelefono = document.createElement("input")
                            campoTelefono.classList.add("detallesUsuario_campoDatosUsuario")
                            campoTelefono.setAttribute("campo", "telefono")
                            campoTelefono.value = telefono
                            telefonoUI.appendChild(campoTelefono)
                            contenedorDatosUsuario.appendChild(telefonoUI)
                            const mailUI = document.createElement("a")
                            mailUI.classList.add("detallesUsuario_contenedorCampoEInfo")
                            titulo = document.createElement("p")
                            titulo.classList.add("tituloDato")
                            titulo.innerText = "Correo electronÃ­co"
                            mailUI.appendChild(titulo)
                            const campomail = document.createElement("input")
                            campomail.classList.add("detallesUsuario_campoDatosUsuario")
                            campomail.setAttribute("campo", "mail")
                            campomail.value = mail
                            mailUI.appendChild(campomail)
                            contenedorDatosUsuario.appendChild(mailUI)
                            espacioUsuario.appendChild(contenedorDatosUsuario)
                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add("detallesUsuario_contenedorBotones")
                            contenedorBotones.setAttribute("componente", "contenedorBotones")
                            const botonGuardarCambios = document.createElement("div")
                            botonGuardarCambios.classList.add("detallesUsuario_botonV1")
                            botonGuardarCambios.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.datosUsuario.guardarCambios)
                            botonGuardarCambios.innerText = "Guardar cambios"
                            contenedorBotones.appendChild(botonGuardarCambios)
                            const botonCancelarCambios = document.createElement("div")
                            botonCancelarCambios.classList.add("detallesUsuario_botonV1")
                            botonCancelarCambios.innerText = "Cancelar cambios"
                            botonCancelarCambios.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.datosUsuario.cancelarCambios)
                            contenedorBotones.appendChild(botonCancelarCambios)
                            espacioUsuario.appendChild(contenedorBotones)
                            const campos = document.querySelectorAll("[campo]")
                            const controladorCampos = () => {
                                let estadoGlobalCampos = "vacios"
                                campos.forEach((campo) => {
                                    if (campo.value.length > 0) {
                                        estadoGlobalCampos = "noVacios"
                                    }
                                })
                                const selectorContenedorBotones = document.querySelector("[componente=contenedorBotones]")
                                if (estadoGlobalCampos === "vacios") {
                                    selectorContenedorBotones.removeAttribute("style")
                                }
                                if (estadoGlobalCampos === "noVacios") {
                                    selectorContenedorBotones.style.display = "flex"
                                }
                            }
                            campos.forEach((campo) => {
                                campo.addEventListener("input", controladorCampos)
                            })
                        }
                    },
                    editar: () => {
                        let camposLectura = document.querySelectorAll("[componenteDetalle]")
                        camposLectura.forEach((campo) => {
                            let datoCampo = campo.innerText
                            let idCampo = campo.getAttribute("componenteDetalle")
                            campo.style.display = "none"
                            let tipoElemento
                            if (idCampo === "notas") {
                                tipoElemento = "textarea"
                            } else {
                                tipoElemento = "input"
                            }
                            let campoEditable = document.createElement(tipoElemento)
                            campoEditable.classList.add("detallesClienteCampoEditable")
                            campoEditable.value = datoCampo
                            campoEditable.setAttribute("componenteEditable", idCampo)
                            let selectorContenedor = campo.parentNode
                            selectorContenedor.appendChild(campoEditable)
                        })
                        document.querySelector("[boton=editar]").classList.add("estadoInicialInvisible")
                        document.querySelector("[boton=dejarDeEditar]").classList.remove("estadoInicialInvisible")
                        document.querySelector("[boton=guardarCambios]").classList.remove("estadoInicialInvisible")
                    },
                    cancelarCambios: () => {
                        const campos = document.querySelectorAll("[campo]")
                        campos.forEach((campo) => {
                            campo.value = null
                        })
                        const selectorContenedorBotones = document.querySelector("[componente=contenedorBotones]")
                        selectorContenedorBotones.removeAttribute("style")
                    },
                    guardarCambios: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Actualizando datos del usuario..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const campos = document.querySelectorAll("[campo]")
                        const usuarioIDX = document.querySelector("[usuarioIDX]").getAttribute("usuarioIDX")
                        const datosParaActualizar = {
                            zona: "administracion/usuarios/actualizarDatosUsuarioDesdeAdministracion",
                            usuarioIDX: usuarioIDX
                        }
                        campos.forEach((campo) => {
                            const campoID = campo.getAttribute("campo")
                            const campoDato = campo.value
                            datosParaActualizar[campoID] = campoDato
                        })

                        const respuestaServidor = await casaVitini.shell.servidor(datosParaActualizar)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const detallesUsuario = respuestaServidor?.datosActualizados
                            const nombre = detallesUsuario.nombre
                            const primerApellido = detallesUsuario.primerApellido
                            const segundoApellido = detallesUsuario.segundoApellido
                            const pasaporte = detallesUsuario.pasaporte
                            const telefono = detallesUsuario.telefono
                            const mail = detallesUsuario.mail
                            campos.forEach((campo) => {
                                const campoID = campo.getAttribute("campo")
                                campo.value = detallesUsuario[campoID]
                            })
                            const selectorContenedorBotones = document.querySelector("[componente=contenedorBotones]")
                            selectorContenedorBotones.removeAttribute("style")
                        }
                    }
                },
                rol: {
                    UI: async (usuarioIDX) => {
                        let rol
                        const espacioUsuario = document.querySelector("[componente=espacioUsuarios]")
                        const transaccion = {
                            zona: "administracion/usuarios/detallesUsuario",
                            usuarioIDX: usuarioIDX
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            rol = respuestaServidor?.ok.rol
                            const usuariosIDX = respuestaServidor?.ok.usuarioIDX
                            const datosBanner = {
                                usuarioIDX: usuarioIDX,
                                rol: rol
                            }
                            const contenedorDetallesUsuario = document.createElement("div")
                            contenedorDetallesUsuario.classList.add("detallesUsuario_contenedorGlobal")
                            contenedorDetallesUsuario.setAttribute("componente", "contenedorGlobal")
                            const contenedorUsuarioIDX = casaVitini.administracion.usuarios.detallesUsuario.componentes.bannerIDX(datosBanner)
                            contenedorDetallesUsuario.appendChild(contenedorUsuarioIDX)
                            espacioUsuario.appendChild(contenedorDetallesUsuario)
                        }
                        const contenedorCampos = document.createElement("div")
                        contenedorCampos.classList.add("detallesUsuario_contenedorCampos")
                        const infoModificarIDX = document.createElement("div")
                        infoModificarIDX.classList.add("detallesUsuario_infoModificarIDX")
                        infoModificarIDX.innerText = `Cambia el rol de esta cuenta al rol que quieras. Recuerda que el rol determina el grado de acceso y autoridad dentro del sistema. El rol cliente es el rol que tiene que tener la cuentas de los clientes de casa vitini. Este rolo solo permite acceder a sus datos de usuario. Controlar solo su cuenta y ver sus reservas. El rol empleado permite acceder al panel de administraciÃ³n, pero solo para gestionar reservas y clientes y nada mÃ¡s. No puede, por ejemplo, modificar precios. El rol administrador es el rol de mÃ¡s autoridad y puede hacer cualquier cosa y tener acceso a todo.`
                        contenedorCampos.appendChild(infoModificarIDX)
                        const selectorRoles = document.createElement("select");
                        selectorRoles.classList.add("detallesUsuario_rol_selector")
                        selectorRoles.setAttribute("selector", "roles")
                        selectorRoles.addEventListener("change", casaVitini.administracion.usuarios.detallesUsuario.rol.guardarCambios)
                        const roles = [
                            {
                                rolUI: "Administrador",
                                rol: "administrador"

                            },
                            {
                                rolUI: "Empleado",
                                rol: "empleado"

                            },
                            {
                                rolUI: "Cliente",
                                rol: "cliente"

                            },
                        ]

                        for (const detallesRol of roles) {
                            const rolUI = detallesRol.rolUI
                            const rolIDX = detallesRol.rol
                            const opcionRol = document.createElement("option");
                            opcionRol.value = rolIDX;
                            opcionRol.text = rolUI;
                            if (rol === rolIDX) {
                                opcionRol.selected = true;
                            }
                            selectorRoles.appendChild(opcionRol);
                        }
                        contenedorCampos.appendChild(selectorRoles);
                        espacioUsuario.appendChild(contenedorCampos)
                        const contenedorBotones = document.createElement("div")
                        contenedorBotones.classList.add("detallesUsuario_contenedorBotones")
                        contenedorBotones.setAttribute("componente", "contenedorBotones")
                        const botonGuardarCambios = document.createElement("div")
                        botonGuardarCambios.classList.add("detallesUsuario_botonV1")
                        botonGuardarCambios.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.rol.guardarCambios)
                        botonGuardarCambios.innerText = "Cambiar rol de la cuenta"
                        contenedorBotones.appendChild(botonGuardarCambios)
                        espacioUsuario.appendChild(contenedorBotones)

                    },
                    guardarCambios: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Actualizando rol del VitiniIDX..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const usuarioIDX = document.querySelector("[usuarioIDX]").getAttribute("usuarioIDX")
                        const selectorRol = document.querySelector("[selector=roles]").value
                        const datosParaActualizar = {
                            zona: "administracion/usuarios/actualizarRolCuenta",
                            usuarioIDX: usuarioIDX,
                            nuevoRol: selectorRol
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(datosParaActualizar)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const rolIDV = respuestaServidor?.rolIDV
                            const rolUI = respuestaServidor?.rolUI
                            document.querySelector("[componente=rolUI]").innerText = rolUI
                            document.querySelector("[selector=roles]").value = rolIDV
                        }
                    },
                    cancelarCambios: () => {
                        const campos = document.querySelectorAll("[campo]")
                        campos.forEach((campo) => {
                            campo.value = null
                        })
                        const selectorContenedorBotones = document.querySelector("[componente=contenedorBotones]")
                        selectorContenedorBotones.removeAttribute("style")
                    },
                },
                cambiarEstadoCuenta: {
                    UI: async () => {
                        const estadoCuentaActual = document.querySelector("[estadoCuenta]").getAttribute("estadoCuenta")
                        let tituloBoton
                        let valorBoton
                        let textoDescriptivo
                        let tituloInformativo
                        if (estadoCuentaActual === "activado") {
                            tituloBoton = "Desactivar cuenta"
                            tituloInformativo = "Confirma la desactivacion de la cuenta"
                            textoDescriptivo = "Â¿Quieres Desactivar esta cuenta? El usuario de esta cuenta podra volver a logearse con ella. Sus implicaciones son inmediatas"
                            valorBoton = "desactivado"
                        }
                        if (estadoCuentaActual === "desactivado") {
                            tituloBoton = "Activar cuenta"
                            tituloInformativo = "Confirma la activacion de la cuenta"
                            textoDescriptivo = "Â¿Quieres Aactivar esta cuenta? El usuario de esta cuenta no podra volver a logearse con ella. Sus implicaciones son inmediatas"
                            valorBoton = "activado"
                        }
                        const advertenciaInmersivaIU = document.createElement("div")
                        advertenciaInmersivaIU.setAttribute("class", "advertenciaInmersiva")
                        advertenciaInmersivaIU.setAttribute("componente", "advertenciaInmersiva")
                        const contenedorAdvertenciaInmersiva = document.createElement("div")
                        contenedorAdvertenciaInmersiva.classList.add("contenedorAdvertencaiInmersiva")
                        const tituloCancelarReserva = document.createElement("p")
                        tituloCancelarReserva.classList.add("detallesReservaTituloCancelarReserva")
                        tituloCancelarReserva.innerText = tituloInformativo
                        contenedorAdvertenciaInmersiva.appendChild(tituloCancelarReserva)
                        const bloqueBloqueoApartamentos = document.createElement("div")
                        bloqueBloqueoApartamentos.classList.add("detallesReservaCancelarReservaBloqueBloqueoApartamentos")
                        const tituloBloquoApartamentos = document.createElement("div")
                        tituloBloquoApartamentos.classList.add("detallesReservaCancelarReservaTituloBloquoApartamentos")
                        tituloBloquoApartamentos.innerText = textoDescriptivo
                        bloqueBloqueoApartamentos.appendChild(tituloBloquoApartamentos)
                        contenedorAdvertenciaInmersiva.appendChild(bloqueBloqueoApartamentos)
                        const bloqueBotones = document.createElement("div")
                        bloqueBotones.classList.add("detallesReservaCancelarReservabloqueBotones")
                        const botonCancelar = document.createElement("div")
                        botonCancelar.classList.add("detallesReservaCancelarBoton")
                        botonCancelar.setAttribute("componente", "botonConfirmarCancelarReserva")
                        botonCancelar.innerText = tituloBoton
                        botonCancelar.setAttribute("nuevoEstado", valorBoton)
                        botonCancelar.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.cambiarEstadoCuenta.transactor)
                        bloqueBotones.appendChild(botonCancelar)
                        const botonCancelarProcesoCancelacion = document.createElement("div")
                        botonCancelarProcesoCancelacion.classList.add("detallesReservaCancelarBoton")
                        botonCancelarProcesoCancelacion.innerText = "Cancelar el cambio de estado"
                        botonCancelarProcesoCancelacion.addEventListener("click", () => {
                            let selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                            selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                advertenciaInmersiva.remove()
                            })
                        })
                        bloqueBotones.appendChild(botonCancelarProcesoCancelacion)
                        contenedorAdvertenciaInmersiva.appendChild(bloqueBotones)
                        advertenciaInmersivaIU.appendChild(contenedorAdvertenciaInmersiva)
                        document.querySelector("main").appendChild(advertenciaInmersivaIU)
                    },
                    transactor: async (nuevoEstado) => {
                        const nuevoEstado_ = nuevoEstado.target.getAttribute("nuevoEstado")
                        const usuarioIDX = document.querySelector("[usuarioIDX]").getAttribute("usuarioIDX")
                        const transaccion = {
                            zona: "administracion/usuarios/actualizarEstadoCuentaDesdeAdministracion",
                            "usuarioIDX": usuarioIDX,
                            "nuevoEstado": nuevoEstado_
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                            selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                advertenciaInmersiva.remove()
                            })
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const estadoActual = respuestaServidor?.estadoCuenta
                            let estadoCuentaUI
                            if (estadoActual === "activado") {
                                estadoCuentaUI = "Desactivar cuenta"
                            }
                            if (estadoActual === "desactivado") {
                                estadoCuentaUI = "Activar cuenta"
                            }
                            const selectorEstadoCuentaUI = document.querySelector("[estadoCuenta]")
                            selectorEstadoCuentaUI.innerText = estadoCuentaUI
                            selectorEstadoCuentaUI.setAttribute("estadoCuenta", estadoActual)
                            const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                            selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                advertenciaInmersiva.remove()
                            })
                        }
                    }
                },
                cambiarClave: {
                    UI: async (usuarioIDX) => {
                        const espacioUsuario = document.querySelector("[componente=espacioUsuarios]")
                        const transaccion = {
                            zona: "administracion/usuarios/detallesUsuario",
                            usuarioIDX: usuarioIDX
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const rol = respuestaServidor?.ok.rol
                            const usuariosIDX = respuestaServidor?.ok.usuarioIDX
                            const datosBanner = {
                                usuarioIDX: usuarioIDX,
                                rol: rol
                            }
                            const contenedorDetallesUsuario = document.createElement("div")
                            contenedorDetallesUsuario.classList.add("detallesUsuario_contenedorGlobal")
                            contenedorDetallesUsuario.setAttribute("componente", "contenedorGlobal")
                            const contenedorUsuarioIDX = casaVitini.administracion.usuarios.detallesUsuario.componentes.bannerIDX(datosBanner)
                            contenedorDetallesUsuario.appendChild(contenedorUsuarioIDX)
                            espacioUsuario.appendChild(contenedorDetallesUsuario)
                            const contenedorCampos = document.createElement("div")
                            contenedorCampos.classList.add("detallesUsuario_contenedorCampos")
                            const infoModificarIDX = document.createElement("div")
                            infoModificarIDX.classList.add("detallesUsuario_infoModificarIDX")
                            infoModificarIDX.innerText = `Escriba la nueva clave que quiera establecer`
                            contenedorCampos.appendChild(infoModificarIDX)
                            /*
                            const campoClaveActual = document.createElement("input")
                            campoClaveActual.classList.add("detallesUsuario_campoNuevoIDX")
                            campoClaveActual.setAttribute("campo", "nuevoIDX")
                            campoClaveActual.setAttribute("componente", "nuevoIDX")
                            campoClaveActual.placeholder = "Escriba su contrasena actual"
                            contenedorCampos.appendChild(campoClaveActual)
                            */
                            const campoNuevaClave = document.createElement("input")
                            campoNuevaClave.classList.add("detallesUsuario_campoNuevoIDX")
                            campoNuevaClave.setAttribute("campo", "claveNueva")
                            campoNuevaClave.setAttribute("componente", "claveNueva")
                            campoNuevaClave.placeholder = "Escriba la nueva contrasena"
                            contenedorCampos.appendChild(campoNuevaClave)
                            const campoVerificaClave = document.createElement("input")
                            campoVerificaClave.classList.add("detallesUsuario_campoNuevoIDX")
                            campoVerificaClave.setAttribute("campo", "claveNuevaDos")
                            campoVerificaClave.setAttribute("componente", "claveNuevaDos")
                            campoVerificaClave.placeholder = "Escriba de nueva la nueva contrasena"
                            contenedorCampos.appendChild(campoVerificaClave)
                            espacioUsuario.appendChild(contenedorCampos)
                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add("detallesUsuario_contenedorBotones")
                            contenedorBotones.setAttribute("componente", "contenedorBotones")
                            const botonGuardarCambios = document.createElement("div")
                            botonGuardarCambios.classList.add("detallesUsuario_botonV1")
                            botonGuardarCambios.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.cambiarClave.guardarCambios)
                            botonGuardarCambios.innerText = "Cambiar contrasena"
                            contenedorBotones.appendChild(botonGuardarCambios)
                            const botonCancelarCambios = document.createElement("div")
                            botonCancelarCambios.classList.add("detallesUsuario_botonV1")
                            botonCancelarCambios.innerText = "Cancelar cambio"
                            botonCancelarCambios.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.cambiarClave.cancelarCambios)
                            contenedorBotones.appendChild(botonCancelarCambios)
                            espacioUsuario.appendChild(contenedorBotones)
                            const controladorCampos = () => {
                                let estadoGlobalCampos = "vacios"
                                campos.forEach((campo) => {
                                    if (campo.value.length > 0) {
                                        estadoGlobalCampos = "noVacios"
                                    }
                                })
                                const selectorContenedorBotones = document.querySelector("[componente=contenedorBotones]")
                                if (estadoGlobalCampos === "vacios") {
                                    selectorContenedorBotones.removeAttribute("style")
                                }
                                if (estadoGlobalCampos === "noVacios") {
                                    selectorContenedorBotones.style.display = "flex"
                                }
                            }
                            const campos = document.querySelectorAll("[campo]")
                            campos.forEach((campo) => {
                                campo.addEventListener("input", controladorCampos)
                            })
                        }
                    },
                    guardarCambios: async () => {
                        const usuarioIDX = document.querySelector("[usuarioIDX]").getAttribute("usuarioIDX")

                        const instanciaUIDPantallaDeCarga = casaVitini.utilidades.codigoFechaInstancia()
                        const instanciaUID = document.querySelector("main").getAttribute("instanciaUID")
                        const mensaje = `Actualizando contraseÃ±a del usuario ${usuarioIDX}...`
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUIDPantallaDeCarga,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const claveNueva = document.querySelector("[componente=claveNueva]")
                        const claveNuevaDos = document.querySelector("[componente=claveNuevaDos]")
                        const datosParaActualizar = {
                            zona: "administracion/usuarios/actualizarClaveUsuarioAdministracion",
                            usuarioIDX: usuarioIDX,
                            claveNueva: claveNueva.value,
                            claveNuevaDos: claveNuevaDos.value
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(datosParaActualizar)
                        const pantallaDeCargaRenderizada = document.querySelector(`[instanciaUID="${instanciaUIDPantallaDeCarga}"]`)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)

                        if (!pantallaDeCargaRenderizada) { }
                        pantallaDeCargaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor.error)
                        }
                        if (respuestaServidor?.ok) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor.ok)
                            const campos = instanciaRenderizada.querySelectorAll("[campo]")
                            campos.forEach((campo) => {
                                campo.value = ""
                            })

                        }
                    },
                    cancelarCambios: () => {
                        const campos = document.querySelectorAll("[campo]")
                        campos.forEach((campo) => {
                            campo.value = null
                        })
                        const selectorContenedorBotones = document.querySelector("[componente=contenedorBotones]")
                        selectorContenedorBotones.removeAttribute("style")
                    },
                },
                cambiarEstadoCuenta: {
                    UI: async () => {
                        const estadoCuentaActual = document.querySelector("[estadoCuenta]").getAttribute("estadoCuenta")
                        let tituloBoton
                        let valorBoton
                        let textoDescriptivo
                        let tituloInformativo
                        if (estadoCuentaActual === "activado") {
                            tituloBoton = "Desactivar cuenta"
                            tituloInformativo = "Confirma la desactivaciÃ³n de la cuenta"
                            textoDescriptivo = "Â¿Quieres desactivar esta cuenta? El usuario de esta cuenta podrÃ­a volver a loguearse con ella. Sus implicaciones son inmediatas."
                            valorBoton = "desactivado"
                        }
                        if (estadoCuentaActual === "desactivado") {
                            tituloBoton = "Activar cuenta"
                            tituloInformativo = "Confirma la activaciÃ³n de la cuenta"
                            textoDescriptivo = "Â¿Quieres activar esta cuenta? El usuario de esta cuenta no podrÃ¡ volver a loguearse con ella. Sus implicaciones son inmediatas."
                            valorBoton = "activado"
                        }


                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                        const titulo = constructor.querySelector("[componente=titulo]")
                        titulo.innerText = tituloInformativo
                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                        mensaje.innerText = textoDescriptivo

                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                        botonAceptar.innerText = tituloBoton
                        botonAceptar.setAttribute("nuevoEstado", valorBoton)
                        botonAceptar.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.cambiarEstadoCuenta.transactor)
                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                        botonCancelar.innerText = "Cancelar y volver"

                        document.querySelector("main").appendChild(pantallaInmersiva)
                    },
                    transactor: async (nuevoEstado) => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Actualizando estado del VitiniIDX..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const nuevoEstado_ = nuevoEstado.target.getAttribute("nuevoEstado")
                        const usuarioIDX = document.querySelector("[usuarioIDX]").getAttribute("usuarioIDX")
                        const transaccion = {
                            zona: "administracion/usuarios/actualizarEstadoCuentaDesdeAdministracion",
                            "usuarioIDX": usuarioIDX,
                            "nuevoEstado": nuevoEstado_
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                            selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                advertenciaInmersiva.remove()
                            })
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const estadoActual = respuestaServidor?.estadoCuenta
                            let estadoCuentaUI
                            if (estadoActual === "activado") {
                                estadoCuentaUI = "Desactivar cuenta"
                            }
                            if (estadoActual === "desactivado") {
                                estadoCuentaUI = "Activar cuenta"
                            }
                            const selectorEstadoCuentaUI = document.querySelector("[estadoCuenta]")
                            selectorEstadoCuentaUI.innerText = estadoCuentaUI
                            selectorEstadoCuentaUI.setAttribute("estadoCuenta", estadoActual)
                            const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                            selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                advertenciaInmersiva.remove()
                            })
                        }
                    }
                },
                eliminarCuenta: {
                    UI: async () => {

                        const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizadaMoldeada()
                        const constructor = pantallaInmersiva.querySelector("[componente=constructor]")

                        const titulo = constructor.querySelector("[componente=titulo]")
                        titulo.innerText = "Confirma la eliminaciÃ³n de esta cuenta"
                        const mensaje = constructor.querySelector("[componente=mensajeUI]")
                        mensaje.innerText = "Si quieres eliminar esta cuenta, confirma su eliminaciÃ³n. Esta operaciÃ³n es inmediata e irreversible. Una vez eliminada la cuenta, sus datos son irrecuperables. Si deseas mantener los datos de esta cuenta, pero a su vez congelar su funcionalidad, es recomendable desactivar la cuenta antes que eliminarla."

                        const botonAceptar = constructor.querySelector("[boton=aceptar]")
                        botonAceptar.innerText = "Comfirmar la eliminacion de la cuenta"
                        botonAceptar.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.eliminarCuenta.transactor)
                        const botonCancelar = constructor.querySelector("[boton=cancelar]")
                        botonCancelar.innerText = "Cancelar la eliminacion y volver"

                        document.querySelector("main").appendChild(pantallaInmersiva)

                    },
                    transactor: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Elimiando el VitiniIDX..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const usuarioIDX = document.querySelector("[usuarioIDX]").getAttribute("usuarioIDX")
                        const transaccion = {
                            zona: "administracion/usuarios/eliminarCuentaDesdeAdministracion",
                            "usuarioIDX": usuarioIDX
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                            selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                advertenciaInmersiva.remove()
                            })
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const selectorAdvertenciaInmersiva = document.querySelectorAll("[componente=advertenciaInmersiva]")
                            selectorAdvertenciaInmersiva.forEach((advertenciaInmersiva) => {
                                advertenciaInmersiva.remove()
                            })
                            const navegacion = {
                                "vista": "/administracion/usuarios",
                                "tipoOrigen": "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    }
                },
                componentes: {
                    bannerIDX: (metadatos) => {
                        const usuarioIDX = metadatos.usuarioIDX
                        const rol = metadatos.rol
                        const rolUITexto = rol.substring(0, 1).toUpperCase() + rol.substring(1);
                        const contenedorUsuarioIDX = document.createElement("div")
                        contenedorUsuarioIDX.classList.add("detallesUsuario_contenedorUsuarioIDX")
                        contenedorUsuarioIDX.setAttribute("componente", "contenedorUsuarioUX")
                        const esferaUsuario = document.createElement("div")
                        esferaUsuario.classList.add("detallesUsuario_esferaUsuario")
                        esferaUsuario.setAttribute("componente", "esferaUsuario")
                        contenedorUsuarioIDX.appendChild(esferaUsuario)
                        const contenedorDatosGlobales = document.createElement("div")
                        contenedorDatosGlobales.classList.add("detallesUsuario_contenedorDatosGlobales")
                        contenedorDatosGlobales.setAttribute("componente", "contenedorDatosGlobales")
                        const usuarioIDXUI = document.createElement("div")
                        usuarioIDXUI.classList.add("detallesUsuario_usuarioUI")
                        usuarioIDXUI.setAttribute("usuarioIDX", usuarioIDX)
                        usuarioIDXUI.innerText = usuarioIDX
                        contenedorDatosGlobales.appendChild(usuarioIDXUI)
                        const rolUI = document.createElement("div")
                        rolUI.classList.add("detallesUsuario_rolUI")
                        rolUI.setAttribute("componente", "rolUI")
                        rolUI.innerText = rolUITexto
                        contenedorDatosGlobales.appendChild(rolUI)
                        contenedorUsuarioIDX.appendChild(contenedorDatosGlobales)
                        return contenedorUsuarioIDX
                    }
                },
                modificarIDX: {
                    UI: async (usuarioIDX) => {
                        const espacioUsuario = document.querySelector("[componente=espacioUsuarios]")
                        const transaccion = {
                            zona: "administracion/usuarios/detallesUsuario",
                            usuarioIDX: usuarioIDX
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const rol = respuestaServidor?.ok.rol
                            const usuariosIDX = respuestaServidor?.ok.usuarioIDX
                            const datosBanner = {
                                usuarioIDX: usuarioIDX,
                                rol: rol
                            }
                            const contenedorDetallesUsuario = document.createElement("div")
                            contenedorDetallesUsuario.classList.add("detallesUsuario_contenedorGlobal")
                            contenedorDetallesUsuario.setAttribute("componente", "contenedorGlobal")
                            const contenedorUsuarioIDX = casaVitini.administracion.usuarios.detallesUsuario.componentes.bannerIDX(datosBanner)
                            contenedorDetallesUsuario.appendChild(contenedorUsuarioIDX)
                            espacioUsuario.appendChild(contenedorDetallesUsuario)
                            const contenedorCampos = document.createElement("div")
                            contenedorCampos.classList.add("detallesUsuario_contenedorCampos")
                            const infoModificarIDX = document.createElement("div")
                            infoModificarIDX.classList.add("detallesUsuario_infoModificarIDX")
                            infoModificarIDX.innerText = `Escriba el nuevo VitiniID para este usuario en el campo de abajo. Recuerde que modificar el IDX deja libre el anterior IDX para que otro usuario, si quiere, lo obtenga.`
                            contenedorCampos.appendChild(infoModificarIDX)
                            const campoNuevoIDX = document.createElement("input")
                            campoNuevoIDX.classList.add("detallesUsuario_campoNuevoIDX")
                            campoNuevoIDX.setAttribute("campo", "nuevoIDX")
                            campoNuevoIDX.setAttribute("componente", "nuevoIDX")
                            campoNuevoIDX.placeholder = usuariosIDX
                            contenedorCampos.appendChild(campoNuevoIDX)
                            espacioUsuario.appendChild(contenedorCampos)
                            const contenedorBotones = document.createElement("div")
                            contenedorBotones.classList.add("detallesUsuario_contenedorBotones")
                            contenedorBotones.setAttribute("componente", "contenedorBotones")
                            const botonGuardarCambios = document.createElement("div")
                            botonGuardarCambios.classList.add("detallesUsuario_botonV1")
                            botonGuardarCambios.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.modificarIDX.guardarCambios)
                            botonGuardarCambios.innerText = "Guardar el nuevo VitiniID"
                            contenedorBotones.appendChild(botonGuardarCambios)
                            const botonCancelarCambios = document.createElement("div")
                            botonCancelarCambios.classList.add("detallesUsuario_botonV1")
                            botonCancelarCambios.innerText = "Cancelar cambios"
                            botonCancelarCambios.addEventListener("click", casaVitini.administracion.usuarios.detallesUsuario.modificarIDX.cancelarCambios)
                            contenedorBotones.appendChild(botonCancelarCambios)
                            espacioUsuario.appendChild(contenedorBotones)
                            const controladorCampos = () => {
                                let estadoGlobalCampos = "vacios"
                                campos.forEach((campo) => {
                                    if (campo.value.length > 0) {
                                        estadoGlobalCampos = "noVacios"
                                    }
                                })
                                const selectorContenedorBotones = document.querySelector("[componente=contenedorBotones]")
                                if (estadoGlobalCampos === "vacios") {
                                    selectorContenedorBotones.removeAttribute("style")
                                }
                                if (estadoGlobalCampos === "noVacios") {
                                    selectorContenedorBotones.style.display = "flex"
                                }
                            }
                            const campos = document.querySelectorAll("[campo]")
                            campos.forEach((campo) => {
                                campo.addEventListener("input", controladorCampos)
                            })
                        }
                    },
                    guardarCambios: async () => {
                        const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                        const mensaje = "Actualizando el VitiniIDX..."
                        const datosPantallaSuperpuesta = {
                            instanciaUID: instanciaUID,
                            mensaje: mensaje
                        }
                        casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                        const usuarioIDX = document.querySelector("[usuarioIDX]")
                        const nuevoIDX = document.querySelector("[componente=nuevoIDX]")
                        const datosParaActualizar = {
                            zona: "administracion/usuarios/actualizarIDXAdministracion",
                            usuarioIDX: usuarioIDX.getAttribute("usuarioIDX"),
                            nuevoIDX: nuevoIDX.value
                        }
                        const respuestaServidor = await casaVitini.shell.servidor(datosParaActualizar)

                        const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                        if (!instanciaRenderizada) { return }
                        instanciaRenderizada.remove()
                        if (respuestaServidor?.error) {
                            casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                        }
                        if (respuestaServidor?.ok) {
                            const IDXEstablecido = respuestaServidor?.usuarioIDX
                            nuevoIDX.value = null
                            nuevoIDX.placeholder = IDXEstablecido
                            usuarioIDX.innerHTML = IDXEstablecido
                            usuarioIDX.setAttribute("usuarioIDX", IDXEstablecido)
                            const selectorContenedorBotones = document.querySelector("[componente=contenedorBotones]")
                            selectorContenedorBotones.removeAttribute("style")
                            const vistaActual = `/administracion/usuarios/${IDXEstablecido}/modificar_idx`
                            const estado = {
                                zona: vistaActual,
                                estadoInternoZona: "estado",
                                tipoCambio: "total"
                            }
                            const titulo = "Casa Vitini"
                            window.history.replaceState(estado, titulo, vistaActual);
                            casaVitini.shell.controladoresUI.controladorEstadoIDX()

                        }
                    },
                    cancelarCambios: () => {
                        const campos = document.querySelectorAll("[campo]")
                        campos.forEach((campo) => {
                            campo.value = null
                        })
                        const selectorContenedorBotones = document.querySelector("[componente=contenedorBotones]")
                        selectorContenedorBotones.removeAttribute("style")
                    },
                },
            },
            nuevoUsuario: {
                arranque: function () {
                    const main = document.querySelector("main")
                    main.setAttribute("zonaCSS", "administracion/usuarios/nuevo")
                    const espacioUsuario = document.querySelector("[componente=espacioUsuarios]")
                    const contenedorGlobal = document.createElement("div")
                    contenedorGlobal.classList.add("usuariosCrearCuenta_contenedorGlobal")
                    const informacionCuenta = document.createElement("div")
                    informacionCuenta.classList.add("usuariosCrearCuenta_informacion")
                    informacionCuenta.innerText = `Escriba el nombre de usuario de la nueva cuenta, este serÃ¡ el VitiniID de la nueva cuenta. Luego pulse en el botÃ³n crear cuenta y, tras crearse la cuenta, irÃ¡ al panel de la cuenta creada donde podrÃ¡ seguir con las modificaciones pertinentes. Una vez establezca la contraseÃ±a, deberÃ¡ activar la cuenta.`
                    contenedorGlobal.appendChild(informacionCuenta)
                    const campoNuevoUsuario = document.createElement("input")
                    campoNuevoUsuario.classList.add("usuariosCrearCuenta_campoUsuario")
                    campoNuevoUsuario.setAttribute("campo", "usuarioIDX")
                    campoNuevoUsuario.placeholder = "Escriba el nuevo VitiniID"
                    contenedorGlobal.appendChild(campoNuevoUsuario)
                    const infoPass = document.createElement("div")
                    infoPass.classList.add("usuariosCrearCuenta_informacion")
                    infoPass.innerText = `Escribe la contraseÃ±a de esta cuenta. Una vez creada la cuenta, siempre puedes cambiar la contraseÃ±a desde el panel del usuario. Es recomendable escribir una contraseÃ±a compleja creada con un generador de contraseÃ±as para que sea irrecordable y usar un gestor de contraseÃ±as para gestionar las contraseÃ±as.  `
                    contenedorGlobal.appendChild(infoPass)
                    const campoClave = document.createElement("input")
                    campoClave.classList.add("usuariosCrearCuenta_campoUsuario")
                    campoClave.setAttribute("campo", "clave")
                    campoClave.placeholder = "Escriba una contraseÃ±a para este nuevo usuario"
                    campoClave.type = "password"
                    contenedorGlobal.appendChild(campoClave)
                    const informacionRol = document.createElement("div")
                    informacionRol.classList.add("usuariosCrearCuenta_informacion")
                    informacionRol.innerText = `Selecciona el rol de la nueva cuenta. Si es una cuenta para un cliente de Casa Vitini escoge el rol Cliente. Si es una cuenta para un Empleado de Casa Vitini escoge el rol Empleado y, si es para un administrador de Casa Vitini escoge el rol Administrador. Cada rol otorga un acceso y autoridad distintos. Por ejemplo, el rol Cliente solo permite administrar la propia cuenta, no da acceso al panel de control de administraciÃ³n. El rol empleado sÃ­ da acceso al panel de administraciÃ³n, pero hay ciertas operaciones que no puede hacer, como por ejemplo alterar precios, ofertas o configuraciones de alojamiento. Si puede realizar reservas, modificar reservas, cancelar reservas, pero no eliminarlas. El rol de Administrador puede hacer cualquier cosa.`
                    contenedorGlobal.appendChild(informacionRol)
                    const selectorRol = document.createElement("select")
                    selectorRol.classList.add("usuariosCrearCuenta_campoUsuario")
                    selectorRol.setAttribute("campo", "selectorRol")
                    const opcionInical = document.createElement("option");
                    opcionInical.value = "";
                    opcionInical.selected = "true"
                    opcionInical.disabled = "true"
                    opcionInical.text = "Selecciona el rol de la nueva cuenta";
                    selectorRol.add(opcionInical);
                    const rolAdministrador = document.createElement("option");
                    rolAdministrador.value = "administrador";
                    rolAdministrador.text = "Administrador";
                    selectorRol.add(rolAdministrador);
                    const rolEmpleado = document.createElement("option");
                    rolEmpleado.value = "empleado";
                    rolEmpleado.text = "Empleado";
                    selectorRol.add(rolEmpleado);
                    const rolCliente = document.createElement("option");
                    rolCliente.value = "cliente";
                    rolCliente.text = "Cliente";
                    selectorRol.add(rolCliente);
                    contenedorGlobal.appendChild(selectorRol)
                    espacioUsuario.appendChild(contenedorGlobal)
                    const contenedorBotones = document.createElement("div")
                    contenedorBotones.classList.add("usuariosCrearCuenta_contenedorBotones")
                    const botonCrearUsuario = document.createElement("div")
                    botonCrearUsuario.classList.add("usuarioCrearCuenta_botonV1")
                    botonCrearUsuario.innerText = "Crear nueva cuenta de usuario"
                    botonCrearUsuario.addEventListener("click", this.transactor)
                    contenedorBotones.appendChild(botonCrearUsuario)
                    espacioUsuario.appendChild(contenedorBotones)
                },
                transactor: async () => {
                    const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                    const mensaje = "Creando usuarios..."
                    const datosPantallaSuperpuesta = {
                        instanciaUID: instanciaUID,
                        mensaje: mensaje
                    }
                    casaVitini.ui.componentes.pantallaDeCargaSuperPuesta(datosPantallaSuperpuesta)
                    const nuevoUsuarioIDX = document.querySelector("[campo=usuarioIDX]").value
                    const clave = document.querySelector("[campo=clave]").value
                    const rol = document.querySelector("[campo=selectorRol]").value
                    const metadatos = {
                        zona: "administracion/usuarios/crearCuentaDesdeAdministracion",
                        usuarioIDX: nuevoUsuarioIDX,
                        clave: clave,
                        rolIDV: rol
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(metadatos)
                    const instanciaRenderizada = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                    if (!instanciaRenderizada) { return }
                    instanciaRenderizada.remove()
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const usuarioIDX = respuestaServidor?.usuarioIDX
                        const navegacion = {
                            "vista": "/administracion/usuarios/" + usuarioIDX,
                            "tipoOrigen": "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    }
                }
            }
        },
        calendario: {
            arranque: async () => {
                const html = document.querySelector("html")
                html.style.height = "100%"

                const main = document.querySelector("main")
                main.setAttribute("zonaCSS", "administracion/calendario")
                //main.style.background = "pink"
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const parametros = granuladoURL.parametros
                const contenedorSeguroParaParametros = granuladoURL.contenedorSeguroParaParametros
                const calendario = {}
                const ultimoDirectorio = granuladoURL.directorios[granuladoURL.directorios.length - 1]
                //document.body.style.backgroundImage = "url("/componentes/imagenes/f5.jpeg")";
                //document.body.classList.add("fondoConDesenfoque")
                //Llama a la funciÃ³n al cargar la pÃ¡gina y en eventos que puedan cambiar la altura del div
                //window.removeEventListener("resize", casaVitini.administracion.calendario.controlVertical);
                //window.addEventListener("resize", casaVitini.administracion.calendario.controlVertical);
                const instanciaUID = casaVitini.utilidades.codigoFechaInstancia()
                const sectionRenderizada = document.querySelector("main")
                sectionRenderizada.style.maxWidth = "100%"
                const instanciaUID_seccion = sectionRenderizada.getAttribute("instanciaUID")
                const metadatosControaldorLogo = {
                    sectionUID: instanciaUID_seccion,
                    elementoScroll: ""
                }
                casaVitini.shell.controladoresUI.controlLogoScroll(metadatosControaldorLogo)
                calendario.instanciaUID = instanciaUID
                calendario.instanciaUIDMes = "uidInicialMes"
                const contenedorCapas = {
                    capas: [],
                    capasCompuestas: {}
                }
                if (parametros.fecha) {
                    const fecha = parametros.fecha.split("-")
                    const mes = Number(fecha[0])
                    const ano = Number(fecha[1])
                    calendario.tipo = "personalizado"
                    calendario.comando = "construyeObjeto"
                    calendario.ano = ano
                    calendario.mes = mes
                    let parametrosURL = []
                    for (const conjunto of contenedorSeguroParaParametros) {
                        const par = conjunto.split(":")
                        const parametro = par[0]
                        const valor = par[1]
                        const estructuraURLParametro = `${parametro}:${valor}`
                        parametrosURL.push(estructuraURLParametro)
                        if (parametro === "capa") {
                            const capaEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(valor)
                            contenedorCapas.capas.push(capaEnCamel)
                        }
                        if (parametro !== "fecha" && parametro !== "capa") {
                            const parametroEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(parametro)
                            const composicionCapa = valor.split("=")
                            contenedorCapas.capasCompuestas[parametroEnCamel] = composicionCapa
                        }
                    }
                    if (parametrosURL.length === 0) {
                        calendario.url = ""
                    } else {
                        calendario.url = parametrosURL.join("/")
                    }
                } else if (parametros.dia) {
                    casaVitini.administracion.calendario.detallesDelDia()
                } else if (ultimoDirectorio === "calendario") {
                    const calendarioActual = {
                        tipo: "actual",
                        comando: "construyeObjeto"
                    }
                    calendario.tipo = "actual"
                    calendario.comando = "construyeObjeto"
                    const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendarioActual)
                    calendario.tipo = "personalizado"
                    calendario.comando = "construyeObjeto"
                    calendario.ano = calendarioResuelto.ano
                    calendario.mes = calendarioResuelto.mes
                    /*
                   
                                                   {
                                       "calendario": "ok",
                                       "ano": 2024,
                                       "mes": 1,
                                       "dia": 31,
                                       "tiempo": "presente",
                                       "posicionDia1": 1,
                                       "numeroDiasPorMes": 31
                                   }               
                                   */
                    contenedorCapas.capas = ["global"]
                    calendario.url = `fecha:${calendarioResuelto.mes}-${calendarioResuelto.ano}/capa:global`
                } else {

                }
                calendario.tipoRegistro = "actualizar"
                casaVitini.administracion.calendario.controladorRegistros(calendario)
                const tipoFecha = {
                    almacenamientoCalendarioID: "calendarioGlobal",
                    instanciaUID: instanciaUID
                }
                casaVitini.administracion.calendario.constructorCalendarioNuevo(tipoFecha)
                const calendarioRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                //const selectorCapas = calendarioRenderizado.querySelector("[componente=selectorCapas]")
                const apartamentosLista = await casaVitini.administracion.calendario.obtenerConfiguracionesApartamento()

                if (apartamentosLista.length > 0) {
                    const tituloApartamentos = document.createElement("option");
                    tituloApartamentos.value = "";
                    tituloApartamentos.disabled = "true"
                    tituloApartamentos.text = "Apartamentos";
                    //selectorCapas.add(tituloApartamentos);
                    for (const detallesApartamento of apartamentosLista) {
                        const apartamentoIDV = detallesApartamento.apartamentoIDV
                        const apartamentoUI = detallesApartamento.apartamentoUI
                        const selectorApartamento = document.createElement("option");
                        selectorApartamento.value = apartamentoIDV;
                        selectorApartamento.setAttribute("tipoCapa", "porApartamento")
                        selectorApartamento.text = apartamentoUI;
                        //selectorCapas.add(selectorApartamento);
                    }
                }
                const calendariosListaAirnbnb = await casaVitini.administracion.calendario.obtenerCalendariosSincronizados.airbnb()
                if (calendariosListaAirnbnb.length > 0) {
                    const tituloApartamentos = document.createElement("option");
                    tituloApartamentos.value = "";
                    tituloApartamentos.disabled = "true"
                    tituloApartamentos.text = "Airbnb";
                    //selectorCapas.add(tituloApartamentos);
                    for (const detallesCalendario of calendariosListaAirnbnb) {
                        const apartamentoIDV = detallesCalendario.apartamentoIDV
                        const apartamentoUI = detallesCalendario.apartamentoUI
                        const calendarioUID = detallesCalendario.calendarioUID
                        const nombre = detallesCalendario.nombre
                        const selectorApartamento = document.createElement("option");
                        selectorApartamento.value = calendarioUID;
                        selectorApartamento.setAttribute("tipoCapa", "calendarioSincronizadoAirbnb")
                        selectorApartamento.text = `${nombre} (${apartamentoUI})`;
                        //selectorCapas.add(selectorApartamento);
                    }
                }
                await casaVitini.administracion.calendario.configuraMes(calendario)
                const metadatos = {
                    instanciaUID: instanciaUID,
                    contenedorCapas: contenedorCapas
                }
                casaVitini.administracion.calendario.capas(metadatos)
            },
            constructorCalendarioNuevo: (metadatos) => {
                const almacenamientoVolatilUID = metadatos.almacenamientoCalendarioID
                if (!almacenamientoVolatilUID) {
                    let error = "El constructor del calendario, necesita un nombre para el almacenamiento volÃ¡til"
                    casaVitini.ui.componentes.advertenciaInmersiva(error)
                }
                const instanciaUID = metadatos.instanciaUID
                if (!instanciaUID) {
                    const error = "El constructor del calendario necesita una instanciaUID para el contenedor del calendario"
                    casaVitini.ui.componentes.advertenciaInmersiva(error)
                }
                const calendario = document.createElement("div")
                calendario.setAttribute("class", "administracion_calendario_calendarioUI")
                calendario.setAttribute("campo", "calendario")
                calendario.setAttribute("contenedor", "calendario")
                calendario.setAttribute("componente", "marcoCalendarioGlobal")
                calendario.setAttribute("almacenamientoCalendarioID", almacenamientoVolatilUID)
                //calendario.setAttribute("tipoCalendario", tipoFecha)
                //calendario.setAttribute("calendarioIO", calendarioIO)
                calendario.setAttribute("elemento", "flotante")
                //calendario.setAttribute("perfilMes", perfilMes)
                //calendario.setAttribute("IO", calendarioIO)
                calendario.style.display = "none"
                const cartelInfoCalendarioEstado = document.createElement("div")
                cartelInfoCalendarioEstado.setAttribute("class", "cartelInfoCalendarioEstado")
                cartelInfoCalendarioEstado.setAttribute("componente", "infoCalendario")
                cartelInfoCalendarioEstado.setAttribute("campo", "calendario")
                //cartelInfoCalendarioEstado.innerText = mensajeInfo
                const marcoBotonesGlobales = document.createElement("nav")
                marcoBotonesGlobales.setAttribute("class", "marcoBotonesGlobales")
                const botonSelectorMultiCapa = document.createElement("div")
                botonSelectorMultiCapa.classList.add("botonSelectorMulticapa")
                botonSelectorMultiCapa.innerText = "Capas del calendario"
                botonSelectorMultiCapa.addEventListener("click", async () => {
                    const granuladoURL = casaVitini.utilidades.granuladorURL()
                    const contenedorSeguroParaParametros = granuladoURL.contenedorSeguroParaParametros
                    const contenedorCapas = {
                        capas: [],
                        capasCompuestas: {}
                    }
                    for (const conjunto of contenedorSeguroParaParametros) {
                        const par = conjunto.split(":")
                        const parametro = par[0]
                        const valor = par[1]
                        if (parametro === "capa") {
                            const capaEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(valor)
                            contenedorCapas.capas.push(capaEnCamel)
                        }
                        if (parametro !== "fecha" && parametro !== "capa") {
                            const parametroEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(parametro)
                            const composicionCapa = valor.split("=")
                            contenedorCapas.capasCompuestas[parametroEnCamel] = composicionCapa
                        }
                    }
                    const contenedorMenuCapas = document.createElement("div")
                    contenedorMenuCapas.classList.add("contenedorMenuCapas")
                    contenedorMenuCapas.setAttribute("componente", "contenedorMenuCapas")
                    const titulo = document.createElement("div")
                    titulo.classList.add("titulo")
                    titulo.innerText = "Capas del calendario"
                    contenedorMenuCapas.appendChild(titulo)
                    //Falta la ccapa global
                    const botonAplicar = document.createElement("div")
                    botonAplicar.classList.add("boton")
                    botonAplicar.innerText = "Aplicar y cerrar"
                    botonAplicar.addEventListener("click", () => {
                        const instanciaUIDMes = casaVitini.utilidades.codigoFechaInstancia()
                        document.querySelector(`[instanciaUID="${instanciaUID}"] [componente=marcoMes]`)
                            .setAttribute("instanciaUID", instanciaUIDMes)
                        const capasSelecionadas = []
                        const estructura = {
                            capas: [],
                            capasCompuestas: {}
                        }
                        const elementosSeleccionados = document.querySelectorAll("[componente=contenedorMenuCapas] [estado=seleccionado]")
                        for (const elementoSeleccionado of elementosSeleccionados) {
                            const capaUID = elementoSeleccionado.getAttribute("capaUID")
                            capasSelecionadas.push(capaUID)
                        }
                        if (capasSelecionadas.includes("global")) {
                            estructura.capas.push("global")
                        } else {
                            const capasSimples = document.querySelectorAll("[componente=contenedorMenuCapas] [capaUID][tipo=capaSimple][estado=seleccionado]")
                            capasSimples.forEach((capa) => {
                                const capaUID = capa.getAttribute("capaUID")
                                estructura.capas.push(capaUID)
                            })
                            if (!capasSelecionadas.includes("todosLosApartamentos")) {
                                const apartametnosSeleccionados = document.querySelectorAll("[componente=contenedorMenuCapas] [capaUID=porApartamento][estado=seleccionado]")
                                const porApartamento = []
                                apartametnosSeleccionados.forEach((apartamento) => {
                                    const apartamentoIDV = apartamento.getAttribute("porApartamento")
                                    porApartamento.push(apartamentoIDV)
                                })
                                if (apartametnosSeleccionados.length > 0) {
                                    estructura.capasCompuestas.porApartamento = porApartamento
                                    estructura.capas.push("porApartamento")
                                }
                            } else {
                                estructura.capas.push("todosLosApartamentos")
                            }
                            if (!capasSelecionadas.includes("todoAirbnb")) {
                                const calendariosAirBnbSeleccionados = document.querySelectorAll("[componente=contenedorMenuCapas] [capaUID=calendariosAirbnb][estado=seleccionado]")
                                const calendariosAirbnb = []
                                calendariosAirBnbSeleccionados.forEach((calendario) => {
                                    const calendarioUID = calendario.getAttribute("calendariosAirbnb")
                                    calendariosAirbnb.push(calendarioUID)
                                })
                                if (calendariosAirBnbSeleccionados.length > 0) {
                                    estructura.capasCompuestas.calendariosAirbnb = calendariosAirbnb
                                    estructura.capas.push("calendariosAirbnb")
                                }
                            } else {
                                estructura.capas.push("todoAirbnb")
                            }
                        }
                        if (estructura.capas.length === 0) {
                            const mensaje = "Selecciona alguna capa para aplicarla en el calendario. No has seleccionado ninguna capa. SÃ­, por el contrario, lo que quieres es cerrar la pantalla de capas. Pulsa en el botÃ³n cerrar"
                            casaVitini.ui.componentes.advertenciaInmersivaSuperPuesta(mensaje)
                        }
                        casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                        const metadatos = {
                            contenedorCapas: estructura,
                            instanciaUID: instanciaUID,
                            origen: "menuDesplegable",
                            instanciaUIDMes: instanciaUIDMes
                        }
                        casaVitini.administracion.calendario.capas(metadatos)
                    })
                    contenedorMenuCapas.appendChild(botonAplicar)
                    const botonCancelar = document.createElement("div")
                    botonCancelar.classList.add("boton")
                    botonCancelar.innerText = "Cerrar"
                    botonCancelar.addEventListener("click", casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas)
                    contenedorMenuCapas.appendChild(botonCancelar)
                    const grupoGlobalCapas = document.createElement("div")
                    grupoGlobalCapas.classList.add("contenedorGrupoSinFondo")
                    const contenedorCapaGlobal = document.createElement("div")
                    contenedorCapaGlobal.classList.add("contenedorCapa")
                    contenedorCapaGlobal.setAttribute("capaUID", "global")
                    let filaIconoTitulo = document.createElement("div")
                    filaIconoTitulo.classList.add("filaIconoTexto")
                    const iconoGlobal = document.createElement("div")
                    iconoGlobal.classList.add("icono")
                    let estadoSelector = document.createElement("div")
                    estadoSelector.classList.add("estadoSelector")
                    estadoSelector.setAttribute("componente", "icono")
                    iconoGlobal.appendChild(estadoSelector)
                    filaIconoTitulo.appendChild(iconoGlobal)
                    const tituloGlobal = document.createElement("div")
                    tituloGlobal.classList.add("tituloCapa")
                    tituloGlobal.classList.add("negrita")
                    tituloGlobal.innerText = "Global"
                    filaIconoTitulo.appendChild(tituloGlobal)
                    contenedorCapaGlobal.appendChild(filaIconoTitulo)
                    grupoGlobalCapas.appendChild(contenedorCapaGlobal)
                    const contenedorCapaReservas = document.createElement("div")
                    contenedorCapaReservas.classList.add("contenedorCapa")
                    contenedorCapaReservas.setAttribute("capaUID", "reservas")
                    contenedorCapaReservas.setAttribute("tipo", "capaSimple")
                    filaIconoTitulo = document.createElement("div")
                    filaIconoTitulo.classList.add("filaIconoTexto")
                    const iconoReservas = document.createElement("div")
                    iconoReservas.classList.add("icono")
                    estadoSelector = document.createElement("div")
                    estadoSelector.classList.add("estadoSelector")
                    estadoSelector.setAttribute("componente", "icono")
                    iconoReservas.appendChild(estadoSelector)
                    filaIconoTitulo.appendChild(iconoReservas)
                    const tituloReservas = document.createElement("div")
                    tituloReservas.classList.add("tituloCapa")
                    tituloReservas.classList.add("negrita")
                    tituloReservas.innerText = "Reservas"
                    filaIconoTitulo.appendChild(tituloReservas)
                    contenedorCapaReservas.appendChild(filaIconoTitulo)
                    grupoGlobalCapas.appendChild(contenedorCapaReservas)
                    const contenedorTodosLosBloqueos = document.createElement("div")
                    contenedorTodosLosBloqueos.classList.add("contenedorCapa")
                    contenedorTodosLosBloqueos.setAttribute("capaUID", "todosLosBloqueos")
                    contenedorTodosLosBloqueos.setAttribute("tipo", "capaSimple")
                    filaIconoTitulo = document.createElement("div")
                    filaIconoTitulo.classList.add("filaIconoTexto")
                    const iconoTodosLosBloqueos = document.createElement("div")
                    iconoTodosLosBloqueos.classList.add("icono")
                    estadoSelector = document.createElement("div")
                    estadoSelector.classList.add("estadoSelector")
                    estadoSelector.setAttribute("componente", "icono")
                    iconoTodosLosBloqueos.appendChild(estadoSelector)
                    filaIconoTitulo.appendChild(iconoTodosLosBloqueos)
                    const tituloTodosLosBloqueos = document.createElement("div")
                    tituloTodosLosBloqueos.classList.add("tituloCapa")
                    tituloTodosLosBloqueos.classList.add("negrita")
                    tituloTodosLosBloqueos.innerText = "Todos los bloqueos"
                    filaIconoTitulo.appendChild(tituloTodosLosBloqueos)
                    contenedorTodosLosBloqueos.appendChild(filaIconoTitulo)
                    grupoGlobalCapas.appendChild(contenedorTodosLosBloqueos)
                    contenedorMenuCapas.appendChild(grupoGlobalCapas)
                    const apartamentosLista = await casaVitini.administracion.calendario.obtenerConfiguracionesApartamento()

                    if (apartamentosLista.length > 0) {
                        const contenedorTodosLosApartamentos = document.createElement("div")
                        contenedorTodosLosApartamentos.classList.add("contenedorGrupoFondo")
                        contenedorTodosLosApartamentos.setAttribute("grupo", "campo")
                        filaIconoTitulo = document.createElement("div")
                        filaIconoTitulo.classList.add("filaIconoTexto")
                        filaIconoTitulo.setAttribute("capaUID", "todosLosApartamentos")
                        filaIconoTitulo.setAttribute("tipo", "global")
                        filaIconoTitulo.setAttribute("grupo", "cabeza")
                        const iconoTodosLosApartamentos = document.createElement("div")
                        iconoTodosLosApartamentos.classList.add("icono")
                        estadoSelector = document.createElement("div")
                        estadoSelector.classList.add("estadoSelector")
                        estadoSelector.setAttribute("componente", "icono")
                        iconoTodosLosApartamentos.appendChild(estadoSelector)
                        filaIconoTitulo.appendChild(iconoTodosLosApartamentos)
                        const tituloTodosLosApartamentos = document.createElement("div")
                        tituloTodosLosApartamentos.classList.add("tituloCapa")
                        tituloTodosLosApartamentos.innerText = "Todos los apartamentos"
                        tituloTodosLosApartamentos.classList.add("negrita")
                        filaIconoTitulo.appendChild(tituloTodosLosApartamentos)
                        contenedorTodosLosApartamentos.appendChild(filaIconoTitulo)
                        const contenedorListaPorApartamento = document.createElement("div")
                        contenedorListaPorApartamento.classList.add("contenedorListaApartamentos")
                        for (const detallesApartamento of apartamentosLista) {
                            const apartamentoIDV = detallesApartamento.apartamentoIDV
                            const apartamentoUI = detallesApartamento.apartamentoUI
                            const contenedorApartamento = document.createElement("div")
                            contenedorApartamento.classList.add("contenedorCapa")
                            contenedorApartamento.setAttribute("porApartamento", apartamentoIDV)
                            contenedorApartamento.setAttribute("capaUID", "porApartamento")
                            contenedorApartamento.setAttribute("grupo", "elemento")
                            filaIconoTitulo = document.createElement("div")
                            filaIconoTitulo.classList.add("filaIconoTexto")
                            const iconoApartamento = document.createElement("div")
                            iconoApartamento.classList.add("icono")
                            estadoSelector = document.createElement("div")
                            estadoSelector.classList.add("estadoSelector")
                            estadoSelector.setAttribute("componente", "icono")
                            iconoApartamento.appendChild(estadoSelector)
                            filaIconoTitulo.appendChild(iconoApartamento)
                            const tituloApartamento = document.createElement("div")
                            tituloApartamento.classList.add("tituloCapa")
                            tituloApartamento.innerText = apartamentoUI
                            filaIconoTitulo.appendChild(tituloApartamento)
                            contenedorApartamento.appendChild(filaIconoTitulo)
                            contenedorListaPorApartamento.appendChild(contenedorApartamento)
                        }
                        contenedorTodosLosApartamentos.appendChild(contenedorListaPorApartamento)
                        contenedorMenuCapas.appendChild(contenedorTodosLosApartamentos)
                    }
                    const calendariosListaAirnbnb = await casaVitini.administracion.calendario.obtenerCalendariosSincronizados.airbnb()
                    if (calendariosListaAirnbnb.length > 0) {
                        const grupoAirbnb = document.createElement("div")
                        grupoAirbnb.classList.add("contenedorGrupoFondo")
                        grupoAirbnb.setAttribute("grupo", "campo")
                        filaIconoTitulo = document.createElement("div")
                        filaIconoTitulo.classList.add("filaIconoTexto")
                        filaIconoTitulo.setAttribute("capaUID", "todoAirbnb")
                        filaIconoTitulo.setAttribute("tipo", "global")
                        filaIconoTitulo.setAttribute("grupo", "cabeza")
                        const iconoTodosAirbnb = document.createElement("div")
                        iconoTodosAirbnb.classList.add("icono")
                        estadoSelector = document.createElement("div")
                        estadoSelector.classList.add("estadoSelector")
                        estadoSelector.setAttribute("componente", "icono")
                        iconoTodosAirbnb.appendChild(estadoSelector)
                        filaIconoTitulo.appendChild(iconoTodosAirbnb)
                        const tituloTodoAirbnb = document.createElement("div")
                        tituloTodoAirbnb.classList.add("tituloCapa")
                        tituloTodoAirbnb.classList.add("negrita")
                        tituloTodoAirbnb.innerText = "Todos los calendarios de Airbnb"
                        filaIconoTitulo.appendChild(tituloTodoAirbnb)
                        grupoAirbnb.appendChild(filaIconoTitulo)
                        const contenedorListaPorApartamento = document.createElement("div")
                        contenedorListaPorApartamento.classList.add("contenedorListaApartamentos")
                        for (const detallesCalendario of calendariosListaAirnbnb) {
                            const apartamentoIDV = detallesCalendario.apartamentoIDV
                            const apartamentoUI = detallesCalendario.apartamentoUI
                            const calendarioUID = detallesCalendario.calendarioUID
                            const nombre = detallesCalendario.nombre
                            const contenedorCalendarioAirbnb = document.createElement("div")
                            contenedorCalendarioAirbnb.classList.add("contenedorCapa")
                            contenedorCalendarioAirbnb.setAttribute("capaUID", "calendariosAirbnb")
                            contenedorCalendarioAirbnb.setAttribute("calendariosAirbnb", calendarioUID)
                            contenedorCalendarioAirbnb.setAttribute("grupo", "elemento")
                            filaIconoTitulo = document.createElement("div")
                            filaIconoTitulo.classList.add("filaIconoTexto")
                            const iconoCalendarioAirbnb = document.createElement("div")
                            iconoCalendarioAirbnb.classList.add("icono")
                            estadoSelector = document.createElement("div")
                            estadoSelector.classList.add("estadoSelector")
                            estadoSelector.setAttribute("componente", "icono")
                            iconoCalendarioAirbnb.appendChild(estadoSelector)
                            filaIconoTitulo.appendChild(iconoCalendarioAirbnb)
                            const tituloCalendarioAirbnb = document.createElement("div")
                            tituloCalendarioAirbnb.classList.add("tituloCapa")
                            tituloCalendarioAirbnb.innerText = nombre
                            filaIconoTitulo.appendChild(tituloCalendarioAirbnb)
                            contenedorCalendarioAirbnb.appendChild(filaIconoTitulo)
                            contenedorListaPorApartamento.appendChild(contenedorCalendarioAirbnb)
                        }
                        grupoAirbnb.appendChild(contenedorListaPorApartamento)
                        contenedorMenuCapas.appendChild(grupoAirbnb)
                    }
                    const pantallaInmersiva = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                    const destino = pantallaInmersiva.querySelector("[destino=inyector]")
                    destino.appendChild(contenedorMenuCapas)
                    document.querySelector("main").appendChild(pantallaInmersiva)
                    const controladorSelectoresCapas = (selector) => {
                        const contenedorCapa = selector.target.closest("[capaUID]")
                        const todasLasCapas = document.querySelectorAll("[componente=contenedorMenuCapas] [capaUID]")
                        const capaUID = contenedorCapa.getAttribute("capaUID")
                        const todoLosIconos = document.querySelectorAll("[componente=contenedorMenuCapas] [componente=icono]")
                        const todasLasCapasGlobales = document.querySelectorAll("[componente=contenedorMenuCapas] [tipo=global]")
                        const grupo = contenedorCapa.getAttribute("grupo")
                        const iconoSelecionado = contenedorCapa.querySelector("[componente=icono]")
                        const estadoCapa = contenedorCapa.getAttribute("estado")
                        const controlBotonGlobal = () => {
                            const capasGlobales = document.querySelectorAll("[componente=contenedorMenuCapas] [tipo=global], [componente=contenedorMenuCapas] [tipo=capaSimple]")
                            const capaGlobal = document.querySelector("[componente=contenedorMenuCapas] [capaUID=global]")
                            const iconoCapa = capaGlobal.querySelector("[componente=icono]")
                            let estadoFinal = "seleccionado"
                            for (const capa of capasGlobales) {
                                const estado = capa.getAttribute("estado")
                                if (estado !== "seleccionado") {
                                    estadoFinal = "noSeleccionado"
                                    break
                                }
                            }
                            if (estadoFinal === "seleccionado") {
                                iconoCapa.style.background = "blue"
                                capaGlobal.setAttribute("estado", "seleccionado")
                            } else {
                                iconoCapa.removeAttribute("style")
                                capaGlobal.removeAttribute("estado")
                            }
                        }
                        if (estadoCapa === "seleccionado") {
                            iconoSelecionado.removeAttribute("style")
                            contenedorCapa.removeAttribute("estado")
                        } else {
                            iconoSelecionado.style.background = "blue"
                            contenedorCapa.setAttribute("estado", "seleccionado")
                        }
                        if (capaUID === "global") {
                            if (estadoCapa === "seleccionado") {
                                todasLasCapas.forEach((capa) => {
                                    capa.removeAttribute("estado")
                                    capa.querySelector("[componente=icono]").removeAttribute("style")
                                })
                            } else {
                                todasLasCapas.forEach((capa) => {
                                    capa.setAttribute("estado", "seleccionado")
                                    capa.querySelector("[componente=icono]").style.background = "blue"
                                })
                            }
                        }
                        if (grupo === "cabeza") {
                            const elementosDelGrupo = contenedorCapa.closest("[grupo=campo]").querySelectorAll("[grupo=elemento]")
                            if (estadoCapa === "seleccionado") {
                                elementosDelGrupo.forEach((capa) => {
                                    capa.removeAttribute("estado")
                                    capa.querySelectorAll("[componente=icono]").forEach((icono) => {
                                        icono.removeAttribute("style")
                                    })
                                })
                            } else {
                                elementosDelGrupo.forEach((capa) => {
                                    capa.setAttribute("estado", "seleccionado")
                                    capa.querySelectorAll("[componente=icono]").forEach((icono) => {
                                        icono.style.background = "blue"
                                    })
                                })
                            }
                        }
                        if (grupo === "elemento") {
                            const elementosDelGrupo = contenedorCapa.closest("[grupo=campo]").querySelectorAll("[grupo=elemento]")
                            const cabezaGrupo = contenedorCapa.closest("[grupo=campo]").querySelector("[grupo=cabeza]")
                            let estadoFinal = "seleccionado"
                            for (const elemento of elementosDelGrupo) {
                                const estado = elemento.getAttribute("estado")
                                if (estado !== "seleccionado") {
                                    estadoFinal = "noSeleccionado"
                                    cabezaGrupo.removeAttribute("estado")
                                    cabezaGrupo.querySelector("[componente=icono]").removeAttribute("style")
                                    break
                                }
                            }
                            if (estadoFinal === "seleccionado") {
                                cabezaGrupo.setAttribute("estado", "seleccionado")
                                cabezaGrupo.querySelector("[componente=icono]").style.background = "blue"
                            }
                        }
                        controlBotonGlobal()
                    }
                    const capasPorVerificar = contenedorCapas.capas
                    const composicionCapaCompuesta = contenedorCapas.capasCompuestas
                    const contenedorMenuCapasRenderizado = document.querySelector("[componente=contenedorMenuCapas]")
                    if (capasPorVerificar.includes("global")) {
                        contenedorMenuCapasRenderizado.querySelectorAll("[capaUID]").forEach((capa) => {
                            capa.setAttribute("estado", "seleccionado")
                            capa.querySelector("[componente=icono]").style.background = "blue"
                        })
                    } else {
                        for (const capaPorVeriticar of capasPorVerificar) {
                            if (composicionCapaCompuesta[capaPorVeriticar]) {
                                const capasSimplesEnCapaCompuesta = composicionCapaCompuesta[capaPorVeriticar]
                                for (const capaSimpleEnCapaCompuesta of capasSimplesEnCapaCompuesta) {
                                    const capaUIDConstructor = `[capaUID="${capaPorVeriticar}"][${capaPorVeriticar}="${capaSimpleEnCapaCompuesta}"]`
                                    const selectorCapaRenderizada = contenedorMenuCapasRenderizado.querySelector(capaUIDConstructor)
                                    selectorCapaRenderizada.setAttribute("estado", "seleccionado")
                                    selectorCapaRenderizada.querySelector("[componente=icono]").style.background = "blue"
                                }
                            } else {
                                const capaUIDConstructor = `[capaUID="${capaPorVeriticar}"]`
                                const selectorCapaRenderizada = contenedorMenuCapasRenderizado.querySelector(capaUIDConstructor)
                                selectorCapaRenderizada.setAttribute("estado", "seleccionado")
                                selectorCapaRenderizada.querySelector("[componente=icono]").style.background = "blue"
                                const tipoRolGrupo = selectorCapaRenderizada.getAttribute("grupo")
                                if (tipoRolGrupo === "cabeza") {
                                    selectorCapaRenderizada.closest("[grupo=campo]").querySelectorAll("[grupo=elemento]").forEach((elemento) => {
                                        elemento.setAttribute("estado", "seleccionado")
                                        elemento.querySelector("[componente=icono]").style.background = "blue"
                                    })
                                }
                            }
                        }
                    }
                    const selectorCapas = document.querySelectorAll("[componente=contenedorMenuCapas] [capaUID]")
                    selectorCapas.forEach((selector) => {
                        selector.addEventListener("click", controladorSelectoresCapas)
                    })
                })
                marcoBotonesGlobales.appendChild(botonSelectorMultiCapa)
                calendario.appendChild(marcoBotonesGlobales)
                const navegacionMes = document.createElement("nav")
                navegacionMes.setAttribute("class", "adminitracion_calendario_navegacionMes")
                calendario.appendChild(navegacionMes)
                // calendario.appendChild(cartelInfoCalendarioEstado)
                const botonNavegacionMesAtras = document.createElement("div")
                botonNavegacionMesAtras.setAttribute("class", "administracion_calendario_botonNavegacion")
                botonNavegacionMesAtras.setAttribute("id", "botonAtras")
                botonNavegacionMesAtras.setAttribute("sentido", "atras")
                botonNavegacionMesAtras.innerText = "Atras"
                botonNavegacionMesAtras.addEventListener("click", casaVitini.administracion.calendario.navegacionCalendarioNuevo)
                navegacionMes.appendChild(botonNavegacionMesAtras)
                const contenedorCentralCalendario = document.createElement("div")
                contenedorCentralCalendario.classList.add("adminitracion_calendario_contenedorCentralCalendario")
                const contenedorHerramientasCalendario = document.createElement("div")
                contenedorHerramientasCalendario.classList.add("adminitracion_calendario_contenedorHerramientasCalendario")
                const botonHoy = document.createElement("div")
                botonHoy.classList.add("adminitracion_calendario_selectorCapa")
                botonHoy.innerText = "Hoy"
                botonHoy.addEventListener("click", casaVitini.administracion.calendario.verHoy)
                contenedorHerramientasCalendario.appendChild(botonHoy)
                const selectorCapa = document.createElement("select")
                selectorCapa.classList.add("adminitracion_calendario_selectorCapa")
                selectorCapa.setAttribute("componente", "selectorCapas")
                selectorCapa.addEventListener("change", (e) => {
                    const capaIDV = e.target.value
                    const instanciaUID = e.target.closest("[instanciaUID]").getAttribute("instanciaUID")
                    const opcionSeleccionada = e.target.options[e.target.selectedIndex];
                    const tipoCapa = opcionSeleccionada.getAttribute("tipoCapa")
                    const metadatos = {
                        capaContenido: capaIDV,
                        capaUID: tipoCapa,
                        instanciaUID: instanciaUID,
                        origen: "menuDesplegable"
                    }
                    casaVitini.administracion.calendario.capas(metadatos)
                })
                const opcionPreterminada = document.createElement("option");
                opcionPreterminada.value = "";
                opcionPreterminada.selected = "true"
                opcionPreterminada.disabled = "true"
                opcionPreterminada.text = "Capa";
                selectorCapa.add(opcionPreterminada);
                const capaReservas = document.createElement("option");
                capaReservas.value = "reservas";
                capaReservas.setAttribute("tipoCapa", "reservas")
                capaReservas.text = "Reservas";
                selectorCapa.add(capaReservas);
                const capaTodosLosApartamentos = document.createElement("option");
                capaTodosLosApartamentos.value = "todosLosApartamentos";
                capaTodosLosApartamentos.setAttribute("tipoCapa", "todosLosApartamentos")
                capaTodosLosApartamentos.text = "Todos los apartamentos";
                selectorCapa.add(capaTodosLosApartamentos);
                const capaTodosLosBloqueos = document.createElement("option");
                capaTodosLosBloqueos.value = "todosLosBloqueos";
                capaTodosLosBloqueos.setAttribute("tipoCapa", "todosLosBloqueos")
                capaTodosLosBloqueos.text = "Todos los bloqueos";
                selectorCapa.add(capaTodosLosBloqueos);
                //contenedorHerramientasCalendario.appendChild(selectorCapa)
                contenedorCentralCalendario.appendChild(contenedorHerramientasCalendario)
                const navegacionMesReferencia = document.createElement("div")
                navegacionMesReferencia.setAttribute("id", "navegacionMesReferencia")
                navegacionMesReferencia.setAttribute("class", "navegacionMesReferencia")
                navegacionMesReferencia.setAttribute("componente", "mesReferencia")
                contenedorCentralCalendario.appendChild(navegacionMesReferencia)
                navegacionMes.appendChild(contenedorCentralCalendario)
                const botonNavegacionMesAdelante = document.createElement("div")
                botonNavegacionMesAdelante.setAttribute("class", "administracion_calendario_botonNavegacion")
                botonNavegacionMesAdelante.setAttribute("id", "botonAdelante")
                botonNavegacionMesAdelante.innerText = "Adelante"
                botonNavegacionMesAdelante.setAttribute("sentido", "adelante")
                botonNavegacionMesAdelante.addEventListener("click", casaVitini.administracion.calendario.navegacionCalendarioNuevo)
                navegacionMes.appendChild(botonNavegacionMesAdelante)
                const marcoMes = document.createElement("ol")
                marcoMes.setAttribute("id", "marcoMes")
                marcoMes.setAttribute("class", "administracion_calendario_marcoMes")
                marcoMes.setAttribute("componente", "marcoMes")
                marcoMes.setAttribute("instanciaUID", "uidInicialMes")
                const pilaDias = ["Lunes", "Martes", "MiÃ©rcoles", "Jueves", "Viernes", "SÃ¡bado", "Domingo"]
                for (const nombreDia of pilaDias) {
                    let diaSemana = document.createElement("li")
                    diaSemana.setAttribute("class", "nombreDia")
                    diaSemana.setAttribute("tipoNombreDia", "extendido")
                    diaSemana.innerText = nombreDia
                    marcoMes.appendChild(diaSemana)
                }
                const pilaDiasAbreviados = ["L", "M", "X", "J", "V", "S", "D"]
                for (const nombreDia of pilaDiasAbreviados) {
                    let diaSemana = document.createElement("li")
                    diaSemana.setAttribute("class", "nombreDia")
                    diaSemana.setAttribute("tipoNombreDia", "abreviado")
                    diaSemana.innerText = nombreDia
                    marcoMes.appendChild(diaSemana)
                }
                calendario.appendChild(marcoMes)
                const seccion = document.querySelector("main:not([estado=obsoleto])")
                const bloqueCalendario = document.createElement("div")
                bloqueCalendario.setAttribute("class", "adminsitracion_calendario_bloqueCalendario")
                bloqueCalendario.setAttribute("instanciaUID", instanciaUID)
                bloqueCalendario.setAttribute("componente", "calendarioGlobal")
                //bloqueCalendario.style.top = alturaDinamica + "px"
                const contenedoCalendarioIntermedio = document.createElement("div")
                contenedoCalendarioIntermedio.setAttribute("class", "administracion_calendario_contenedorCalentadioIntermedio")
                //bloqueCalendario.appendChild(cartelInfoCalendarioEstado)
                //bloqueCalendario.style.visibility = "hidden"
                const mensajeSpinner = "Construyendo calendario..."
                const spinner = casaVitini.ui.componentes.spinner(mensajeSpinner)
                const contenedorCarga = document.createElement("div")
                contenedorCarga.classList.add("administracion_calendario_componente_calendario_contenedoCarga")
                contenedorCarga.setAttribute("contenedor", "construyendoCalendario")
                //contenedorCarga.setAttribute("elemento", "flotante")
                contenedorCarga.appendChild(spinner)
                contenedoCalendarioIntermedio.appendChild(calendario)
                contenedoCalendarioIntermedio.appendChild(contenedorCarga)
                bloqueCalendario.appendChild(contenedoCalendarioIntermedio)
                document.querySelector("main").appendChild(bloqueCalendario)
            },
            constructorMesNuevo: async (calendario) => {
                const instanciaUID = calendario.instanciaUID
                const instanciaUIDMes = calendario.instanciaUIDMes
                const selectorCalendarioRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                if (!selectorCalendarioRenderizado) {
                    return
                }
                const nombreMes = ["Enero", "Febrero", "Marzo", "Abrir", "Mayo", "Junio", "Julio", "Agost", "Septiembre", "Octubre", "Noviembre", "Diciembre"]
                const nombreMesFinal = nombreMes[calendario.mes - 1]
                const indicadorMesAno = nombreMesFinal + " " + calendario.ano
                const navegacionMesReferencia = selectorCalendarioRenderizado.querySelector("[componente=mesReferencia]")
                navegacionMesReferencia.innerText = indicadorMesAno
                navegacionMesReferencia.setAttribute("ano", calendario.ano)
                navegacionMesReferencia.setAttribute("mes", calendario.mes)
                const posicionDia1 = calendario.posicionDia1
                const numeroDiasPorMes = calendario.numeroDiasPorMes;
                const diaActual = calendario.dia
                selectorCalendarioRenderizado.querySelectorAll("[dia]").forEach(diaObsoleto => {
                    diaObsoleto.remove()
                });
                selectorCalendarioRenderizado.querySelectorAll("[componente=diaVacio]").forEach(diaObsoleto => {
                    diaObsoleto.remove()
                });
                const marcoCalendario = selectorCalendarioRenderizado.querySelector("[componente=marcoCalendarioGlobal]")
                const perfilMes = marcoCalendario?.getAttribute("perfilMes")
                //await new Promise(resolve => setTimeout(resolve, 1000));
                const controlDiasCompletos = {
                    zona: "componentes/diasOcupadosTotalmentePorMes",
                    mes: Number(calendario.mes),
                    ano: Number(calendario.ano)
                }
                const resuelveDiasCompletos = await casaVitini.shell.servidor(controlDiasCompletos)
                if (resuelveDiasCompletos?.error) {
                    casaVitini.shell.controladoresUI.limpiarMain()
                    casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                    return casaVitini.ui.componentes.mensajeSimple({
                        titulo: resuelveDiasCompletos.error
                    })
                }
                const selectorCalendarioRenderizado_control = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                if (!selectorCalendarioRenderizado_control) {
                    return
                }

                const detallesDiasOcupacion = resuelveDiasCompletos.ok.dias
                let mesActual = calendario.mes
                let anoActual = calendario.ano
                mesActual = String(mesActual).padStart(2, "0");
                mesActual = Number(mesActual)
                anoActual = Number(anoActual)
                const marcoMes = marcoCalendario.querySelector(`[componente=marcoMes][instanciaUID="${instanciaUIDMes}"]`)
                for (let index = 1; index < posicionDia1; index++) {
                    const bloqueDia = document.createElement("li")
                    bloqueDia.setAttribute("componente", "diaVacio")
                    const numeroDiaUI = document.createElement("div")
                    numeroDiaUI.classList.add("administracion_calendario_numeroDiaUI")
                    //numeroDiaUI.innerText = "VACIO"
                    bloqueDia.appendChild(numeroDiaUI)
                    marcoMes?.appendChild(bloqueDia)
                }
                marcoCalendario?.setAttribute("perfilMes", perfilMes)
                for (let numeroDia = 0; numeroDia < numeroDiasPorMes; numeroDia++) {
                    let diaFinal = numeroDia + 1;
                    diaFinal = Number(diaFinal)
                    const bloqueDia = document.createElement("li")
                    bloqueDia.setAttribute("class", "administracion_calendario_componenteCalendario_dia")
                    const contenedorDia = document.createElement("div")
                    contenedorDia.classList.add("administracion_calendario_contenedorInformacionDia")
                    contenedorDia.setAttribute("componente", "contenedorDia")
                    const numeroDiaUI = document.createElement("div")
                    numeroDiaUI.classList.add("administracion_calendario_numeroDiaUI")
                    numeroDiaUI.innerText = diaFinal
                    contenedorDia.appendChild(numeroDiaUI)
                    const contenedorCapa = document.createElement("div")
                    contenedorCapa.classList.add("administracion_calendario_contenedorCapa")
                    contenedorCapa.setAttribute("contenedor", "capa")
                    //contenedorCapa.innerText = "espacio capa"
                    //contenedorDia.appendChild(contenedorCapa)
                    if (diaFinal === 1) {
                        //  bloqueDia.style.gridColumnStart = posicionDia1
                    }
                    bloqueDia.setAttribute("dia", diaFinal)
                    bloqueDia.setAttribute("estado", "disponible")
                    //bloqueDia.addEventListener("click", casaVitini.administracion.reservas.nuevaReserva.seleccionarDia)
                    if (calendario.tiempo === "presente") {
                        if (diaFinal === diaActual) {
                            bloqueDia.classList.add("diaDeHoy")
                        }
                    }
                    if (detallesDiasOcupacion[diaFinal]?.estadoDia === "diaParcial") {
                        bloqueDia.classList.add("diaParcial")
                    } else if (detallesDiasOcupacion[diaFinal]?.estadoDia === "diaCompleto") {
                        bloqueDia.classList.add("diaCompleto")
                    } else {
                        bloqueDia.classList.add("diaDisponible")
                    }
                    bloqueDia.appendChild(contenedorDia)
                    marcoMes?.appendChild(bloqueDia)
                }
                if (selectorCalendarioRenderizado) {
                    selectorCalendarioRenderizado.querySelector("#botonAtras").style.opacity = 1
                    selectorCalendarioRenderizado.querySelector("#botonAtras").style.pointerEvents = "all"
                    selectorCalendarioRenderizado.querySelector("#botonAdelante").style.opacity = 1
                    selectorCalendarioRenderizado.querySelector("#botonAdelante").style.pointerEvents = "all"
                    const contenedorMes = selectorCalendarioRenderizado.querySelector(`[componente=marcoMes][instanciaUID="${instanciaUIDMes}"]`)
                    if (contenedorMes) {
                        selectorCalendarioRenderizado.querySelector("[contenedor=construyendoCalendario]")?.remove()
                    }
                    contenedorMes?.removeAttribute("style")
                    selectorCalendarioRenderizado.querySelector("[contenedor=calendario]").removeAttribute("style")
                }
            },
            navegacionCalendarioNuevo: async (calendarioRenderizado) => {
                const boton = calendarioRenderizado.target.getAttribute("sentido")
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const parametros = granuladoURL.parametros
                const instanciaUIDMes = casaVitini.utilidades.codigoFechaInstancia()
                const contenedorSeguroParaParametros = granuladoURL.contenedorSeguroParaParametros
                const instanciaUID = calendarioRenderizado.target.closest("[instanciaUID]").getAttribute("instanciaUID")
                document.querySelector(`[instanciaUID="${instanciaUID}"] [componente=marcoMes]`)
                    .setAttribute("instanciaUID", instanciaUIDMes)
                let mesActual = Number(document.querySelector("[componente=mesReferencia]").getAttribute("mes"))
                let anoActual = Number(document.querySelector("[componente=mesReferencia]").getAttribute("ano"))
                if (boton === "adelante") {
                    if (mesActual + 1 < 13) {
                        mesActual = mesActual + 1
                    } else {
                        mesActual = 1
                        anoActual = anoActual + 1
                    }
                }
                if (boton === "atras") {
                    if (mesActual - 1 > 0) {
                        mesActual = mesActual - 1
                    } else {
                        mesActual = 12
                        anoActual = anoActual - 1
                    }
                }
                const calendario = {
                    tipo: "personalizado",
                    comando: "construyeObjeto",
                    ano: anoActual,
                    mes: mesActual,
                    instanciaUID: instanciaUID,
                    tipoRegistro: "crear",
                }
                let parametrosURL = []
                const contenedorCapas = {
                    capas: [],
                    capasCompuestas: {}
                }
                for (const conjunto of contenedorSeguroParaParametros) {
                    const par = conjunto.split(":")
                    const parametro = par[0]
                    const valor = par[1]
                    const estructuraURLParametro = `${parametro}:${valor}`
                    if (parametro.toLowerCase() !== "fecha") {
                        parametrosURL.push(estructuraURLParametro)
                    }
                    if (parametro === "capa") {
                        const capaEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(valor)
                        contenedorCapas.capas.push(capaEnCamel)
                    }
                    if (parametro !== "fecha" && parametro !== "capa") {
                        const parametroEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(parametro)
                        const composicionCapa = valor.split("=")
                        contenedorCapas.capasCompuestas[parametroEnCamel] = composicionCapa
                    }
                }
                calendario.url = `fecha:${mesActual}-${anoActual}/` + parametrosURL.join("/")
                casaVitini.administracion.calendario.controladorRegistros(calendario)
                calendario.instanciaUIDMes = instanciaUIDMes
                await casaVitini.administracion.calendario.configuraMes(calendario)
                const metadatos = {
                    instanciaUID: instanciaUID,
                    origen: "navegacionEntreMeses",
                    contenedorCapas: contenedorCapas,
                    instanciaUIDMes: instanciaUIDMes
                }
                casaVitini.administracion.calendario.capas(metadatos)
            },
            verHoy: async (calendarioActual) => {
                const instanciaUID = calendarioActual.target.closest("[instanciaUID]").getAttribute("instanciaUID")
                const calendarioRenderizado = document.querySelector(`[componente=calendarioGlobal][instanciaUID="${instanciaUID}"]`)
                const mesRenderizado = Number(calendarioRenderizado.querySelector("[componente=mesReferencia]").getAttribute("mes"))
                const anoRenderizado = Number(calendarioRenderizado.querySelector("[componente=mesReferencia]").getAttribute("ano"))
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const contenedorSeguroParaParametros = granuladoURL.contenedorSeguroParaParametros
                const parametros = granuladoURL.parametros
                //const mesRenderizado = 
                const instanciaUIDMes = casaVitini.utilidades.codigoFechaInstancia()
                const marcoMes = calendarioRenderizado.querySelector(`[componente=marcoMes]`)
                marcoMes.setAttribute("instanciaUID", instanciaUIDMes)
                marcoMes.style.flex = "0"
                const selectorDiasRenderizados = calendarioRenderizado.querySelectorAll("[dia], [componente=diaVacio]")
                selectorDiasRenderizados.forEach((diaRenderizado) => {
                    diaRenderizado.remove()
                })
                const contenedorCalendario = calendarioRenderizado.querySelector(`[contenedor=calendario]`)
                const spinner = casaVitini.ui.componentes.spinnerSimple()
                const contenedorCarga = document.createElement("div")
                contenedorCarga.classList.add("componente_calendario_contenedoCarga_Mes")
                contenedorCarga.setAttribute("contenedor", "construyendoCalendario")
                contenedorCarga.setAttribute("elemento", "flotante")
                contenedorCarga.appendChild(spinner)
                const construyendoCalendarioRenderizado = calendarioRenderizado.querySelector("[contenedor=construyendoCalendario]")
                if (!construyendoCalendarioRenderizado) contenedorCalendario.appendChild(contenedorCarga)
                const contenedorCapas = {
                    capas: [],
                    capasCompuestas: {}
                }
                const parametrosURL = []
                for (const conjunto of contenedorSeguroParaParametros) {
                    const par = conjunto.split(":")
                    const parametro = par[0]
                    const valor = par[1]
                    const estructuraURLParametro = `${parametro}:${valor}`
                    parametrosURL.push(estructuraURLParametro)
                    if (parametro === "capa") {
                        const capaEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(valor)
                        contenedorCapas.capas.push(capaEnCamel)
                    }
                    if (parametro !== "fecha" && parametro !== "capa") {
                        const parametroEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(parametro)
                        const composicionCapa = valor.split("=")
                        contenedorCapas.capasCompuestas[parametroEnCamel] = composicionCapa
                    }
                }
                const soloCapasURL = []
                for (const parDeParametro of parametrosURL) {
                    const parametro = parDeParametro.split(":")
                    if (parametro[0] !== "fecha") {
                        soloCapasURL.push(parDeParametro)
                    }
                }
                const calendario = {
                    tipo: "actual",
                    comando: "construyeObjeto",
                    instanciaUID: instanciaUID,
                    instanciaUIDMes: instanciaUIDMes
                }
                const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                const anoPresente = calendarioResuelto.ano
                const mesPresente = calendarioResuelto.mes
                calendario.url = `fecha:${mesPresente}-${anoPresente}/${soloCapasURL.join("/")}`
                if ((mesRenderizado !== mesPresente && anoRenderizado === anoPresente) || (anoRenderizado !== anoPresente)) {
                    //ADquitir la url actual, que puede ser diferente segun la capa
                    calendario.tipoRegistro = "crear"
                    casaVitini.administracion.calendario.controladorRegistros(calendario)
                } else {
                    //en el mdo dos siempre actualizar por is la url ha cambiado a selecionar una capa en hoy
                    calendario.tipoRegistro = "actualizar"
                    casaVitini.administracion.calendario.controladorRegistros(calendario)
                }
                await casaVitini.administracion.calendario.configuraMes(calendario)
                const metadatos = {
                    instanciaUID: instanciaUID,
                    contenedorCapas: contenedorCapas
                }
                casaVitini.administracion.calendario.capas(metadatos)
            },
            configuraMes: async (calendario) => {
                const instanciaUID = calendario.instanciaUID
                delete calendario.instanciaUID
                const instanciaUIDMes = calendario.instanciaUIDMes
                const calendarioRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                const selectorDiasRenderizados = calendarioRenderizado.querySelectorAll("[dia], [componente=eventoUI], [componente=diaVacio]")
                selectorDiasRenderizados.forEach((diaRenderizado) => {
                    diaRenderizado.remove()
                })
                const contenedorCalendario = calendarioRenderizado.querySelector(`[contenedor=calendario]`)
                const contenedorMes = calendarioRenderizado.querySelector(`[componente=marcoMes]`)
                marcoMes.style.flex = "0"
                //contenedorMes.setAttribute("instanciaUID", instanciaUIDMes)
                const mensajeSpinner = "Construyendo mes..."
                const spinner = casaVitini.ui.componentes.spinnerSimple(mensajeSpinner)
                const contenedorCarga = document.createElement("div")
                contenedorCarga.classList.add("componente_calendario_contenedoCarga_Mes")
                contenedorCarga.setAttribute("contenedor", "construyendoCalendario")
                contenedorCarga.setAttribute("elemento", "flotante")
                contenedorCarga.appendChild(spinner)
                const construyendoCalendarioRenderizado = calendarioRenderizado.querySelector("[contenedor=construyendoCalendario]")
                if (!construyendoCalendarioRenderizado) contenedorCalendario.appendChild(contenedorCarga)
                const calendarioResuelto = await casaVitini.ui.componentes.calendario.resolverCalendarioNuevo(calendario)
                calendarioResuelto.instanciaUID = instanciaUID
                calendarioResuelto.instanciaUIDMes = instanciaUIDMes
                await casaVitini.administracion.calendario.constructorMesNuevo(calendarioResuelto)
                //casaVitini.administracion.calendario.controlVertical();
            },
            controlVertical: () => {

                const selectorSeccion = document.querySelector("main")
                const selectorCalendarioGlobal = document.querySelector("[componente=calendarioGlobal]")
                if (!selectorCalendarioGlobal) {
                    window.removeEventListener("resize", casaVitini.administracion.calendario.controlVertical);

                }
                const altoRenderizadoSection = selectorSeccion.scrollHeight;
                const alturaVentana = window.innerHeight;
                if (alturaVentana > altoRenderizadoSection) {
                    selectorCalendarioGlobal.style.position = "absolute"
                } else if (alturaVentana < altoRenderizadoSection) {
                    selectorCalendarioGlobal.style.position = "relative"
                } else if (alturaVentana === altoRenderizadoSection) {
                    selectorCalendarioGlobal.style.position = "absolute"
                }
            },
            controladorRegistros: (metadatos) => {
                const titulo = "Administracion"
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const parametros = granuladoURL.parametros
                const tipoRegistro = metadatos.tipoRegistro
                //investigar por que cuando el calendario se arranca no hay ninguna url en el objeto, eso puede ser
                const urlActual = metadatos.url || ""
                const configuracion = { ...metadatos }
                delete configuracion.url
                delete configuracion.tipoRegistro
                delete configuracion.instanciaUID
                const estructuraParametrosFinales = []
                for (const [parametroFinal, valorFinal] of Object.entries(parametros)) {
                    const estructura = `${parametroFinal}:${valorFinal}`
                    estructuraParametrosFinales.push(estructura)
                }
                let parametrosURLFInal = ""
                if (estructuraParametrosFinales.length > 0) {
                    parametrosURLFInal = "/" + estructuraParametrosFinales.join("/")
                }
                let constructorURLFinal
                if (urlActual === "") {
                    constructorURLFinal = ""
                } else {
                    constructorURLFinal = granuladoURL.directoriosFusion + "/" + urlActual
                }
                const estado = {
                    zona: constructorURLFinal,
                    EstadoInternoZona: "estado",
                    tipoCambio: "parcial",
                    componenteExistente: "marcoCalendarioGlobal",
                    funcionPersonalizada: "casaVitini.administracion.calendario.irAFecha",
                    datosPaginacion: configuracion
                }
                if (tipoRegistro === "crear") {
                    window.history.pushState(estado, titulo, constructorURLFinal);
                }
                if (tipoRegistro === "actualizar") {
                    window.history.replaceState(estado, titulo, constructorURLFinal);
                }
            },
            irAFecha: async (calendario) => {
                const instanciaUID = document.querySelector("[instanciaUID]").getAttribute("instanciaUID")
                const instanciaUIDMes = casaVitini.utilidades.codigoFechaInstancia()
                document.querySelector(`[instanciaUID="${instanciaUID}"] [componente=marcoMes]`)
                    .setAttribute("instanciaUID", instanciaUIDMes)
                calendario.instanciaUIDMes = instanciaUIDMes
                calendario.instanciaUID = instanciaUID
                await casaVitini.administracion.calendario.configuraMes(calendario)
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const contenedorSeguroParaParametros = granuladoURL.contenedorSeguroParaParametros
                const contenedorCapas = {
                    capas: [],
                    capasCompuestas: {}
                }
                for (const conjunto of contenedorSeguroParaParametros) {
                    const par = conjunto.split(":")
                    const parametro = par[0]
                    const valor = par[1]
                    const estructuraURLParametro = `${parametro}:${valor}`
                    if (parametro.toLowerCase() !== "fecha") {
                        //parametrosURL.push(estructuraURLParametro)
                    }
                    if (parametro === "capa") {
                        const capaEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(valor)
                        contenedorCapas.capas.push(capaEnCamel)
                    }
                    if (parametro !== "fecha" && parametro !== "capa") {
                        const parametroEnCamel = casaVitini.utilidades.cadenas.snakeToCamel(parametro)
                        const composicionCapa = valor.split("=")
                        contenedorCapas.capasCompuestas[parametroEnCamel] = composicionCapa
                    }
                }
                const metadatos = {
                    instanciaUID: instanciaUID,
                    contenedorCapas: contenedorCapas,
                    instanciaUIDMes: instanciaUIDMes,
                    origen: "historial"
                }
                casaVitini.administracion.calendario.capas(metadatos)
            },
            capas: async (metadatos) => {
                const contenedorCapas = metadatos.contenedorCapas
                const instanciaUID = metadatos.instanciaUID
                const origen = metadatos.origen
                const calendarioRenderizado = document.querySelector(`[instanciaUID="${instanciaUID}"]`)
                if (!document.querySelector(`[instanciaUID="${instanciaUID}"]`)) { return }
                let instanciaUIDMes
                if (origen === "navegacionEntreMeses" || origen === "menuDesplegable" || origen === "historial") {
                    instanciaUIDMes = metadatos.instanciaUIDMes
                } else {
                    instanciaUIDMes = calendarioRenderizado.querySelector("[componente=marcoMes]").getAttribute("instanciaUID")
                }
                const mesRenderizado = Number(calendarioRenderizado.querySelector("[componente=mesReferencia]").getAttribute("mes"))
                const anoRenderizado = Number(calendarioRenderizado.querySelector("[componente=mesReferencia]").getAttribute("ano"))
                const granuladoURL = casaVitini.utilidades.granuladorURL()
                const parametros = granuladoURL.parametros
                const selectorCapaRenderizada = calendarioRenderizado.querySelectorAll("[componente=eventoUI]")
                selectorCapaRenderizada.forEach((capaRenderizada) => {
                    capaRenderizada.remove()
                })
                //tipoRegistroFinal puede ser actualizar o crear
                let tipoRegistroFinal
                if (origen === "menuDesplegable" || origen === "navegacionEntreMeses") {
                    tipoRegistroFinal = "crear"
                }
                //casaVitini.administracion.calendario.controlVertical()
                const calendario = {
                    tipo: "personalizado",
                    comando: "construyeObjeto",
                    ano: anoRenderizado,
                    mes: mesRenderizado,
                    instanciaUID: instanciaUID,
                    tipoRegistro: tipoRegistroFinal,
                }
                const ventanaDetallesDelEventoTruncado = (data) => {

                    const urlUI = data.urlUI
                    const eventoUID = data.eventoUID
                    const nombreEventoFinal = data.nombreEventoFinal
                    const detallesDelEventoUI = data.detallesDelEventoUI
                    const main = document.querySelector("main")
                    const ui = casaVitini.ui.componentes.pantallaInmersivaPersonalizada()
                    main.appendChild(ui)
                    const contenedor = ui.querySelector("[componente=contenedor]")

                    const titulo = document.createElement("div")
                    titulo.classList.add(
                        "titulo"
                    )
                    titulo.innerText = `Detalles del evento`
                    contenedor.appendChild(titulo)

                    const info = document.createElement("p")
                    info.classList.add(
                        "textoCentrado"
                    )
                    info.innerText = "Se ha desplegado esta pantalla de informaciÃ³n porque el texto del evento no cabÃ­a en la celda del evento y se mostraba truncado con elipsis."
                    contenedor.appendChild(info)

                    const infoDetallesDelEvento = document.createElement("p")
                    infoDetallesDelEvento.classList.add(
                        "textoCentrado"
                    )
                    infoDetallesDelEvento.innerText = detallesDelEventoUI
                    if (detallesDelEventoUI) {
                        contenedor.appendChild(infoDetallesDelEvento)
                    }

                    const nobreDelEvento = document.createElement("p")
                    nobreDelEvento.classList.add(
                        "textoCentrado",
                        "negrita"
                    )
                    nobreDelEvento.innerText = nombreEventoFinal
                    contenedor.appendChild(nobreDelEvento)

                    const botonIrAlEvento = document.createElement("div")
                    botonIrAlEvento.classList.add("boton")
                    botonIrAlEvento.setAttribute("boton", "cancelar")
                    botonIrAlEvento.innerText = "Ir al evento"
                    botonIrAlEvento.addEventListener("click", () => {
                        const navegacion = {
                            vista: urlUI,
                            tipoOrigen: "menuNavegador"
                        }
                        casaVitini.shell.navegacion.controladorVista(navegacion)
                    })
                    if (urlUI) {
                        contenedor.appendChild(botonIrAlEvento)
                    }

                    const botonCancelar = document.createElement("div")
                    botonCancelar.classList.add("boton")
                    botonCancelar.setAttribute("boton", "cancelar")
                    botonCancelar.innerText = "Cerrar y volver a la reserva"
                    botonCancelar.addEventListener("click", () => {
                        return casaVitini.shell.controladoresUI.limpiarAdvertenciasInmersivas()
                    })
                    contenedor.appendChild(botonCancelar)
                }
                const obtenerCoordenadasCeldaGrid = (celdaGrid) => {
                    const selectorDiaRenderizado = document.querySelector(`[dia="${celdaGrid}"]`);
                    const gridContainer = selectorDiaRenderizado.parentElement;
                    const items = Array.from(gridContainer.children);
                    const index = items.indexOf(selectorDiaRenderizado);
                    const columns = parseInt(getComputedStyle(gridContainer).gridTemplateColumns.split(" ").length);
                    const row = Math.floor(index / columns) + 1;
                    const column = (index % columns) + 1;

                    const estructuraFinal = {
                        fila: row,
                        columna: column
                    }
                    return estructuraFinal
                }
                const obtenerNumeroDeCeldasEnFila = (filaDeseada) => {
                    const gridContainer = document.querySelector("[componente=marcoMes]");
                    //ObtÃ©n todas las celdas dentro del contenedor del grid
                    const celdas = Array.from(gridContainer.children);
                    //ObtÃ©n el nÃºmero de columnas en el grid
                    const columnas = parseInt(getComputedStyle(gridContainer).gridTemplateColumns.split(" ").length);
                    //Calcula el Ã­ndice inicial y final de la fila deseada
                    const indiceInicial = (filaDeseada - 1) * columnas;
                    const indiceFinal = filaDeseada * columnas;
                    //Filtra las celdas que pertenecen a la fila deseada
                    const celdasEnFila = celdas.slice(indiceInicial, indiceFinal);
                    //Muestra el nÃºmero de celdas en la fila deseada
                    //
                    return celdasEnFila.length
                }
                const obtenerNumeroDeCeldasConAtributoEnFila = (filaDeseada, atributo) => {
                    const gridContainer = document.querySelector("[componente=marcoMes]");
                    //ObtÃ©n todas las celdas dentro del contenedor del grid
                    const celdas = Array.from(gridContainer.children);
                    //ObtÃ©n el nÃºmero de columnas en el grid
                    const columnas = parseInt(getComputedStyle(gridContainer).gridTemplateColumns.split(" ").length);
                    //Calcula el Ã­ndice inicial y final de la fila deseada
                    const indiceInicial = (filaDeseada - 1) * columnas;
                    const indiceFinal = filaDeseada * columnas;
                    //Filtra y cuenta las celdas que pertenecen a la fila deseada y tienen el atributo especÃ­fico
                    const celdasEnFilaConAtributo = celdas.slice(indiceInicial, indiceFinal).filter(celda => celda.getAttribute(atributo) !== null);
                    //Muestra el nÃºmero de celdas en la fila deseada con el atributo especÃ­fico
                    //
                    return celdasEnFilaConAtributo.length;
                }
                const filaDeseada = 2; //Puedes cambiar esto segÃºn la fila que te interese
                const numeroDeFilasTotales = (gridUID) => {
                    const grid = document.querySelector("[componente=marcoMes]");
                    const gridStyles = window.getComputedStyle(grid);
                    const gridRows = gridStyles.gridTemplateRows.split(" ").length;
                    return gridRows
                }
                const numeroDeFilasConDia = () => {
                    const grid = document.querySelector("[componente=marcoMes]");

                    // Selecciona todas las celdas con el atributo 'dia'
                    const celdasConDia = grid.querySelectorAll("[dia]");

                    // Crear un Set para almacenar las filas Ãºnicas
                    const filasUnicas = new Set();

                    celdasConDia.forEach(celda => {
                        // Obtener el nÃºmero de fila de la celda (usando su propiedad de estilo gridRow)
                        const numeroDeFila = window.getComputedStyle(celda).gridRowStart;
                        filasUnicas.add(numeroDeFila);
                    });

                    // El tamaÃ±o del Set es el nÃºmero de filas con al menos una celda con el atributo 'dia'
                    return filasUnicas.size;
                };
                const diferenciaDeDias = (fechaIncioMes_ISO, fechaSalidaEvento_ISO) => {
                    const fecha1 = new Date(fechaIncioMes_ISO); // Primera fecha en formato ISO
                    const fecha2 = new Date(fechaSalidaEvento_ISO); // Segunda fecha en formato ISO
                    fecha1.setHours(0, 0, 0, 0);
                    fecha2.setHours(0, 0, 0, 0);
                    // Calcula la diferencia en milisegundos
                    const diferenciaEnMilisegundos = fecha2.getTime() - fecha1.getTime();
                    // Convierte la diferencia a dÃ­as y aÃ±ade 1 para incluir ambos dÃ­as
                    const diferenciaEnDiasSalida = diferenciaEnMilisegundos / (1000 * 60 * 60 * 24) + 1;
                    return diferenciaEnDiasSalida;
                }
                const constructorEventoUI = (metadatos) => {
                    const eventoUID = metadatos.eventoUID
                    const altura = metadatos.altura
                    const url = metadatos.url
                    const css = metadatos.css
                    const inicioColumna = metadatos.inicioColumna
                    const finalColumna = metadatos.finalColumna
                    const inicioFila = metadatos.inicioFila
                    const tipoEvento = metadatos.tipoEvento
                    //detallesDelEvento


                    const detallesDelEvento = metadatos.detallesDelEvento

                    let nombreEventoFinal = "Evento sin infomraciÃ³n"
                    let detallesDelEventoUI
                    let urlUI
                    if (tipoEvento === "reserva") {
                        const reservaUID = detallesDelEvento.reservaUID
                        nombreEventoFinal = "Reserva " + reservaUID
                        urlUI = "/administracion/reservas/reserva:" + reservaUID
                    } else if (tipoEvento === "todosLosApartamentos") {
                        const reservaUID = detallesDelEvento.reservaUID
                        const apartamentoUI = detallesDelEvento.apartamentoUI
                        nombreEventoFinal = apartamentoUI
                        urlUI = `/administracion/reservas/reserva:${reservaUID}`
                    } else if (tipoEvento === "porApartamento") {
                        const reservaUID = detallesDelEvento.reservaUID
                        const apartamentoUI = detallesDelEvento.apartamentoUI
                        nombreEventoFinal = apartamentoUI
                        urlUI = `/administracion/reservas/reserva:${reservaUID}`
                    } else if (tipoEvento === "todosLosBloqueos") {
                        const bloqueoUID = detallesDelEvento.bloqueoUID
                        const apartamentoIDV = detallesDelEvento.apartamentoIDV
                        const apartamentoUI = detallesDelEvento.apartamentoUI
                        nombreEventoFinal = `Bloqueo ${apartamentoUI}`
                        urlUI = `/administracion/gestion_de_bloqueos_temporales/${apartamentoIDV}/${bloqueoUID}`
                    } else if (tipoEvento === "calendarioAirbnb") {
                        const descripcion = detallesDelEvento.descripcion || ""
                        const apartamentoUI = detallesDelEvento.apartamentoUI
                        const regex = /Reservation URL: (https:\/\/www\.airbnb\.com\/hosting\/reservations\/details\/[A-Za-z0-9]+)/;
                        const match = descripcion.match(regex);
                        if (match) {
                            const urlEvento = match?.[1] ?? null;
                            nombreEventoFinal = `Airbnb (${apartamentoUI})`
                            urlUI = urlEvento
                        } else {
                            nombreEventoFinal = `Airbnb (${apartamentoUI}), sin informaciÃ³n`
                            detallesDelEventoUI = "Este evento proviene de Airbnb y no proporciona mÃ¡s informaciÃ³n. Esto suele ser debido cuando el evento de calendario de Airbnb proviene de otra fuente como Booking"
                            //urlUI = ""
                        }
                    }

                    const nombreClaseDinamica = `evento_margin-top-${altura}`;
                    if (!document.querySelector(`.${nombreClaseDinamica}`)) {
                        // Si no existe, crea un nuevo estilo
                        const style = document.createElement('style');
                        style.innerHTML = `
                            .${nombreClaseDinamica} {
                                margin-top: ${altura}px;
                        `;
                        document.querySelector("main").appendChild(style);
                    }

                    const eventoUI = document.createElement("a")

                    const contenedorInfoEvento = document.createElement("div")
                    contenedorInfoEvento.classList.add(
                        "infoEvento"
                    )
                    contenedorInfoEvento.setAttribute("dato", "textoEvento")
                    contenedorInfoEvento.innerText = nombreEventoFinal
                    eventoUI.appendChild(contenedorInfoEvento)

                    eventoUI.classList.add(
                        nombreClaseDinamica,
                        css,
                        "animacion_eventoUI"
                    )

                    //eventoUI.style.marginTop = altura + "px"
                    eventoUI.setAttribute("componente", "eventoUI")
                    eventoUI.setAttribute("eventoUID", eventoUID)
                    if (urlUI) {
                        eventoUI.setAttribute("vista", urlUI)
                        eventoUI.setAttribute("href", urlUI)
                    }
                    eventoUI.style.gridColumn = `${inicioColumna} /${finalColumna} span `
                    eventoUI.style.gridRow = `${inicioFila}`
                    eventoUI.addEventListener("mouseover", () => {
                        const selectorEventoUIRenderizado = document.querySelectorAll(`[eventoUID="${eventoUID}"]`)
                        selectorEventoUIRenderizado.forEach((eventoRenderizado) => {
                            eventoRenderizado.classList.add("administracion_calendario_eventoUI_selecionado")
                        })
                    })
                    eventoUI.addEventListener("mouseout", () => {
                        const selectorEventoUIRenderizado = document.querySelectorAll(`[eventoUID="${eventoUID}"]`)
                        selectorEventoUIRenderizado.forEach((eventoRenderizado) => {
                            eventoRenderizado.classList.remove("administracion_calendario_eventoUI_selecionado")
                        })
                    })
                    eventoUI.addEventListener("click", (e) => {
                        e.preventDefault()
                        const contnedorTexto = e.target.querySelector("[dato=textoEvento]")
                        const tieneElipsis = (elemento) => {
                            return elemento.scrollWidth > elemento.clientWidth;
                        }

                        if (tieneElipsis(contnedorTexto)) {
                            ventanaDetallesDelEventoTruncado({
                                urlUI,
                                eventoUID,
                                nombreEventoFinal,
                                detallesDelEventoUI
                            })
                        } else if (urlUI) {
                            const navegacion = {
                                vista: urlUI,
                                tipoOrigen: "menuNavegador"
                            }
                            casaVitini.shell.navegacion.controladorVista(navegacion)
                        }
                    })
                    return eventoUI
                }
                const siguienteLunes = (primerDiaDelMes) => {
                    if (primerDiaDelMes === 1) {
                        return 8;
                    }
                    else if (primerDiaDelMes > 1) {
                        return 8 - (primerDiaDelMes - 1);
                    }
                    else {
                        return 1 + (1 - primerDiaDelMes);
                    }
                }
                const renderizadorEventos = (contenedorEventos) => {
                    const eventosMes = contenedorEventos.eventosMes
                    const eventosEnDetalle = contenedorEventos.eventosEnDetalle
                    const instanciaUIDMes = contenedorEventos.instanciaUIDMes
                    const selectorMesDestino = calendarioRenderizado.querySelector(`[instanciaUID="${instanciaUIDMes}"]`)
                    if (selectorMesDestino) {
                        //Solo queda este error - Esto deberia estar dentro de renderizados de eventos
                        const selectorDias = selectorMesDestino.querySelectorAll("[dia]")
                        selectorDias.forEach((dia) => {
                            dia.removeAttribute("eventosContenedor")
                        })
                        for (const detallesDia of Object.entries(eventosMes)) {
                            const fechaDestino = detallesDia[0].split("-")
                            const diaDestino = Number(fechaDestino[2])
                            const selectorContenedorDia = selectorMesDestino.querySelector(`[dia="${diaDestino}"]`)
                            //Analizar por que salta este error
                            const selectorArrayRenderizado = selectorContenedorDia?.getAttribute("eventosContenedor")
                            const objetoEventos = JSON.parse(selectorArrayRenderizado) || {}
                            let posicionEvento = 0
                            const posicionColumnaDia = obtenerCoordenadasCeldaGrid(diaDestino).columna
                            const posicionesEventosReservadas = {}
                            if (!objetoEventos.eventos) {
                                objetoEventos.eventos = {}
                            }
                            if (diaDestino === 1) {
                                let posicionesIninical = posicionEvento
                                for (const eventosDiaActual of detallesDia[1]) {
                                    const reservaUID_diaActual = eventosDiaActual.eventoUID
                                    objetoEventos.eventos[reservaUID_diaActual] = posicionesIninical
                                    posicionesEventosReservadas[posicionesIninical] = "posicionReservada"
                                    posicionesIninical++
                                }
                            } else {
                                const numeroDiaAnterior = diaDestino - 1
                                const selectorContenedorDiaAnterior = selectorMesDestino
                                    .querySelector(`[dia="${numeroDiaAnterior}"]`)
                                    ?.getAttribute("eventosContenedor") || "{}"
                                const eventosDelDiaAnterior = JSON.parse(selectorContenedorDiaAnterior) || {}
                                const contenedorEventosDiaAnterior = eventosDelDiaAnterior.eventos ? eventosDelDiaAnterior.eventos : {}
                                //Primer loop, se comprueba que eventos de hoy estan el dia anterior para reservas posiciones.
                                for (const [eventoAnteriorUID, posicionEventoAnterior] of Object.entries(contenedorEventosDiaAnterior)) {
                                    for (const eventosDiaActual of detallesDia[1]) {
                                        const eventoActualUID = eventosDiaActual.eventoUID
                                        if (String(eventoActualUID) === String(eventoAnteriorUID)) {
                                            const posicionDelApartamentoDelDiaAnteior = contenedorEventosDiaAnterior[eventoActualUID]
                                            objetoEventos.eventos[eventoActualUID] = posicionDelApartamentoDelDiaAnteior
                                            posicionesEventosReservadas[posicionDelApartamentoDelDiaAnteior] = "posicionReservada"
                                        }
                                    }
                                }
                                if (posicionColumnaDia === 1) {
                                    let posicionesIninical = posicionEvento
                                    objetoEventos.eventos = {}
                                    Object.keys(posicionesEventosReservadas).forEach((posicion) => {
                                        delete posicionesEventosReservadas[posicion]
                                    })
                                    for (const eventosDiaActual of detallesDia[1]) {
                                        const evendoDiaActualUID = eventosDiaActual.eventoUID
                                        objetoEventos.eventos[evendoDiaActualUID] = posicionesIninical
                                        posicionesEventosReservadas[posicionesIninical] = "posicionReservada"
                                        posicionesIninical++
                                    }
                                }
                            }
                            for (const eventosDelDia of detallesDia[1]) {
                                const eventoUID = eventosDelDia.eventoUID
                                if (posicionColumnaDia === 1) {
                                }
                                if (objetoEventos.eventos[eventoUID] === undefined) {
                                    while (posicionesEventosReservadas[posicionEvento] === "posicionReservada") {
                                        posicionEvento++;
                                    }
                                    objetoEventos.eventos[eventoUID] = Number(posicionEvento)
                                    posicionEvento++;
                                }
                            }
                            selectorMesDestino.querySelector(`[dia="${diaDestino}"]`)
                                .setAttribute("eventosContenedor", JSON.stringify(objetoEventos))
                        }

                        for (const detallesDelEvento of eventosEnDetalle) {
                            const reservaUID = detallesDelEvento.reservaUID
                            const eventoUID = detallesDelEvento.eventoUID
                            const reservaUI = detallesDelEvento.reserva
                            const nombreEventoUI = detallesDelEvento.nombreEventoUI
                            const fechaEntrada = detallesDelEvento.fechaEntrada
                            const fechaSalida = detallesDelEvento.fechaSalida
                            const duracion_en_dias = detallesDelEvento.duracion_en_dias

                            const tipoEvento = detallesDelEvento.tipoEvento
                            let diaEntrada
                            let mesEntrada
                            let anoEntrada
                            let diaSalida
                            let mesSalida
                            let anoSalida
                            if (fechaEntrada) {
                                const fechaEntradaArray = fechaEntrada.split("-")
                                diaEntrada = Number(fechaEntradaArray[2])
                                mesEntrada = Number(fechaEntradaArray[1])
                                anoEntrada = Number(fechaEntradaArray[0])
                            }
                            if (fechaSalida) {
                                const fechaSalidaArray = fechaSalida.split("-")
                                diaSalida = Number(fechaSalidaArray[2])
                                mesSalida = Number(fechaSalidaArray[1])
                                anoSalida = Number(fechaSalidaArray[0])
                            }
                            const configuracionEventoUI = {
                                eventoUID: eventoUID,
                                tipoEvento: tipoEvento,
                                detallesDelEvento: detallesDelEvento
                            }


                            // Inicio del renderizador de eventos
                            if (mesRenderizado === mesEntrada && anoRenderizado === anoEntrada) {
                            } else {
                                diaEntrada = 1
                            }

                            const selectorContenedorDia = selectorMesDestino.querySelector(`[dia="${diaEntrada}"]`)
                            const eventosContenedor = selectorContenedorDia.getAttribute("eventosContenedor")
                            const posicionEventoUI = (JSON.parse(eventosContenedor)).eventos[eventoUID]
                            const conteoEventos = Object.keys(JSON.parse(eventosContenedor).eventos).length - 1
                            const coordenadasDiaInicio = obtenerCoordenadasCeldaGrid(diaEntrada);
                            const inicioFila = coordenadasDiaInicio.fila - 1
                            const celdasPorFilaConAtributo = obtenerNumeroDeCeldasConAtributoEnFila(inicioFila + 1, "dia")
                            const inicioColumna = coordenadasDiaInicio.columna
                            const celdasNoExistentes = 7 - celdasPorFilaConAtributo
                            const inicioColumnaSinPrimeraPosicion = inicioColumna - 1
                            const inicioFilaDia = inicioFila - 1
                            let restoDeCeldas
                            let diasRestantes

                            if (inicioFilaDia === 1 || inicioFilaDia < numeroDeFilasConDia()) {
                                restoDeCeldas = celdasPorFilaConAtributo - (inicioColumnaSinPrimeraPosicion - celdasNoExistentes)
                            } else if (inicioFilaDia === numeroDeFilasConDia()) {
                                restoDeCeldas = celdasPorFilaConAtributo - inicioColumnaSinPrimeraPosicion
                            }
                            let finalColumna

                            if (mesRenderizado === mesEntrada && anoRenderizado === anoEntrada) {
                                finalColumna = (duracion_en_dias) >= restoDeCeldas ? (restoDeCeldas) : (duracion_en_dias);

                            } else {
                                const fechaIncioMes_ISO = `${anoRenderizado}-${String(mesRenderizado).padStart(2, "0")}-01`
                                diasRestantes = diferenciaDeDias(fechaIncioMes_ISO, fechaSalida);
                                finalColumna = diasRestantes >= restoDeCeldas ? (restoDeCeldas) : (diasRestantes)
                                // finalColumna = restoDeDiasDelEvento >= celdasPorFilaConAtributo ? celdasPorFilaConAtributo : restoDeDiasDelEvento;
                            }

                            let filaSiguiente = inicioFila
                            let alturaFinal
                            if (posicionEventoUI === 0) {
                                alturaFinal = 40
                            } else if (posicionEventoUI === 1) {
                                alturaFinal = 90
                            } else if (posicionEventoUI > 1) {
                                alturaFinal = (posicionEventoUI * 40) + ((posicionEventoUI + 1) * 10) + 30
                            }
                            const numeroFilasTotales = numeroDeFilasConDia()

                            let restoDeDiasDelEvento
                            if (mesRenderizado === mesEntrada && anoRenderizado === anoEntrada) {
                                restoDeDiasDelEvento = restoDeCeldas > duracion_en_dias ? 0 : (duracion_en_dias) - restoDeCeldas

                                if (restoDeDiasDelEvento === 0) {
                                    configuracionEventoUI.css = "administracion_calendario_eventoUI_inicioFinal"
                                } else {
                                    configuracionEventoUI.css = "administracion_calendario_eventoUI_inicioSolo"
                                }
                            } else {
                                restoDeDiasDelEvento = restoDeCeldas > diasRestantes ? 0 : Math.abs((diasRestantes) - restoDeCeldas)
                                if (restoDeDiasDelEvento <= 0) {
                                    configuracionEventoUI.css = "administracion_calendario_eventoUI_finalSolo"
                                } else {
                                    configuracionEventoUI.css = "administracion_calendario_eventoUI_transicion"
                                }
                            }
                            configuracionEventoUI.altura = alturaFinal
                            configuracionEventoUI.inicioColumna = inicioColumna
                            configuracionEventoUI.finalColumna = finalColumna
                            configuracionEventoUI.inicioFila = inicioFila
                            const eventoUI = constructorEventoUI(configuracionEventoUI)
                            selectorMesDestino.appendChild(eventoUI)
                            const posicionDiaUno = obtenerCoordenadasCeldaGrid(1).columna
                            const filaInicialDelEvento = (obtenerCoordenadasCeldaGrid(diaEntrada).fila - 2)
                            let sumadorDiaFila

                            if (filaInicialDelEvento === 1) {
                                sumadorDiaFila = siguienteLunes(posicionDiaUno)
                            } else {
                                let sumaDias = 7 * (filaInicialDelEvento - 1)
                                sumadorDiaFila = siguienteLunes(posicionDiaUno) + sumaDias
                            }
                            while (restoDeDiasDelEvento > 0 && numeroFilasTotales >= filaSiguiente) {
                                filaSiguiente = filaSiguiente + 1

                                const selectorContenedorDia_loop = selectorMesDestino.querySelector(`[dia="${sumadorDiaFila}"]`)
                                const eventosContenedor_loop = selectorContenedorDia_loop.getAttribute("eventosContenedor")
                                sumadorDiaFila = 7 + sumadorDiaFila
                                const posicionEventoUI_loop = (JSON.parse(eventosContenedor_loop)).eventos[eventoUID]
                                let alturaFinal
                                if (posicionEventoUI_loop === 0) {
                                    alturaFinal = 40
                                } else if (posicionEventoUI_loop === 1) {
                                    alturaFinal = 90
                                } else if (posicionEventoUI_loop > 1) {
                                    alturaFinal = (posicionEventoUI_loop * 40) + ((posicionEventoUI_loop + 1) * 10) + 30
                                }
                                const celdasPorFilaConAtributo = obtenerNumeroDeCeldasConAtributoEnFila(filaSiguiente + 1, "dia")
                                const finalColumna_ = restoDeDiasDelEvento >= celdasPorFilaConAtributo ? celdasPorFilaConAtributo : (restoDeDiasDelEvento);
                                restoDeDiasDelEvento = Math.abs(restoDeDiasDelEvento - finalColumna_)
                                if (restoDeDiasDelEvento <= 0) {
                                    configuracionEventoUI.css = "administracion_calendario_eventoUI_finalSolo"
                                } else {
                                    configuracionEventoUI.css = "administracion_calendario_eventoUI_transicion"
                                }
                                configuracionEventoUI.altura = alturaFinal
                                configuracionEventoUI.inicioColumna = 1
                                configuracionEventoUI.finalColumna = finalColumna_
                                configuracionEventoUI.inicioFila = filaSiguiente
                                const eventoUI = constructorEventoUI(configuracionEventoUI)
                                selectorMesDestino.appendChild(eventoUI)
                            }

                        }
                    }
                }
                const capasSimples = contenedorCapas.capas
                const capasCompuestas = contenedorCapas.capasCompuestas
                const primerFormatoURL = []
                for (const capaSimple of capasSimples) {
                    const capaSimpleURL = casaVitini.utilidades.cadenas.camelToSnake(capaSimple)
                    const composicioCapa = capasCompuestas[capaSimple]
                    let final
                    if (composicioCapa) {
                        final = `capa:${capaSimpleURL}/${capaSimpleURL}:${composicioCapa.join("=")}`
                    } else {
                        final = `capa:${capaSimpleURL}`
                    }
                    primerFormatoURL.push(final)
                }
                const segundoFormatoURL = primerFormatoURL.join("/")
                if (origen === "menuDesplegable") {
                    calendario.url = `fecha:${mesRenderizado}-${anoRenderizado}/` + segundoFormatoURL
                    casaVitini.administracion.calendario.controladorRegistros(calendario)
                }
                const transaccion = {
                    zona: "administracion/calendario/capas/multiCapa",
                    fecha: `${mesRenderizado}-${anoRenderizado}`,
                    contenedorCapas: contenedorCapas
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                if (respuestaServidor?.error) {
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    const contenedorEventos = {
                        eventosMes: respuestaServidor.eventosMes,
                        eventosEnDetalle: respuestaServidor.eventosEnDetalle,
                        instanciaUIDMes: instanciaUIDMes
                    }
                    renderizadorEventos(contenedorEventos)
                }
                //casaVitini.administracion.calendario.controlVertical()
            },
            obtenerConfiguracionesApartamento: async () => {
                const transaccion = {
                    zona: "administracion/arquitectura/configuraciones/listarConfiguracionApartamentos"
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)

                if (respuestaServidor?.error) {
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    const estructuraFinal = []
                    const configuracionesApartamentos = respuestaServidor?.ok
                    if (configuracionesApartamentos.length > 0) {
                        for (const detalleApartamento of configuracionesApartamentos) {
                            const apartamentoIDV = detalleApartamento.apartamentoIDV
                            const apartamentoUI = detalleApartamento.apartamentoUI
                            const estadoConfiguracion = detalleApartamento.estadoConfiguracion
                            const detallesApartamento = {
                                apartamentoIDV: apartamentoIDV,
                                apartamentoUI: apartamentoUI,
                                estadoConfiguracion: estadoConfiguracion,
                            }
                            estructuraFinal.push(detallesApartamento)
                        }
                    }
                    return estructuraFinal
                }
            },
            obtenerCalendariosSincronizados: {
                airbnb: async () => {
                    const transaccion = {
                        zona: "administracion/calendario/obtenerNombresCalendarios/airbnb"
                    }
                    const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                    if (respuestaServidor?.error) {
                        casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                    }
                    if (respuestaServidor?.ok) {
                        const estructuraFinal = []
                        const calendariosSincronizados = respuestaServidor?.calendariosSincronizados
                        if (calendariosSincronizados.length > 0) {
                            for (const detallesDelCalendario of calendariosSincronizados) {
                                const apartamentoIDV = detallesDelCalendario.apartamentoIDV
                                const apartamentoUI = detallesDelCalendario.apartamentoUI
                                const nombre = detallesDelCalendario.nombre
                                const calendarioUID = detallesDelCalendario.calendarioUID
                                const detallesApartamento = {
                                    apartamentoIDV: apartamentoIDV,
                                    apartamentoUI: apartamentoUI,
                                    nombre: nombre,
                                    calendarioUID: calendarioUID
                                }
                                estructuraFinal.push(detallesApartamento)
                            }
                        }
                        return estructuraFinal
                    }
                }
            }
        },
        componentes: {
            obtenerApartamentos: async () => {
                const transaccion = {
                    zona: "administracion/componentes/apartamentosDisponiblesConfigurados"
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                if (respuestaServidor?.error) {
                    casaVitini.ui.componentes.advertenciaInmersiva(respuestaServidor?.error)
                }
                if (respuestaServidor?.ok) {
                    return respuestaServidor?.ok
                }
            },
            obtenerConfiguracionAlojamiento: async (apartamentoIDV) => {
                const transaccion = {
                    zona: "administracion/arquitectura/configuraciones/detalleConfiguracionAlojamiento",
                    apartamentoIDV
                }
                const respuestaServidor = await casaVitini.shell.servidor(transaccion)
                if (respuestaServidor?.error) {
                    // console.error(respuestaServidor)
                }
                if (respuestaServidor.ok) {
                    return respuestaServidor
                }
            }
        }
    }
}

const convertirFuncionesEnCadenas = (objeto) => {
    for (const clave in objeto) {
        if (typeof objeto[clave] === "function") {
            objeto[clave] = objeto[clave].toString();
        } else if (typeof objeto[clave] === "object") {
            //Si la propiedad es un objeto, llama recursivamente a la funciÃ³n
            convertirFuncionesEnCadenas(objeto[clave]);
        }
    }
}
export const administracionJS = () => {
    convertirFuncionesEnCadenas(casaVitini.administracion);
    const objetoComoJSON = JSON.stringify(casaVitini.administracion);
    return objetoComoJSON
}
